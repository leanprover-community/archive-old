---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html">#12182 add_monoid_with_one</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282496261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282496261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282496261">(May 16 2022 at 13:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>, do you need help with this?</p>



<a name="282498137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282498137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282498137">(May 16 2022 at 13:54)</a>:</h4>
<p>Okay, I've merged master now.</p>



<a name="282498583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282498583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282498583">(May 16 2022 at 13:57)</a>:</h4>
<p>Since <a href="https://github.com/leanprover-community/mathlib/pull/12126">#12126</a> has been merged now it might be good to revisit <code>function.injective.ring</code> &amp; co.  These currently take <code>add_group_with_one</code> arguments instead of <code>has_zero</code>/<code>has_one</code>/<code>has_add</code>/<code>has_inv</code>/..., which is really inconsistent.  There is also a type class diamond issue now in <code>ring_theory/integral_closure</code> that could be related.  We should probably add <code>has_nat_cast</code>/<code>has_int_cast</code> type classes and handle the casts like any other operation in <code>function.injective.ring</code>.</p>



<a name="282498744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282498744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282498744">(May 16 2022 at 13:58)</a>:</h4>
<p>I'm swamped with stuff do.  So if you want to take the lead and split up the PR (like you've suggested in the comment) then please go ahead.</p>



<a name="282504562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282504562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282504562">(May 16 2022 at 14:37)</a>:</h4>
<p>Fancy! I will have a go soon then.</p>



<a name="282506104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282506104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282506104">(May 16 2022 at 14:46)</a>:</h4>
<p>Why can't <code>has_coe</code> be used in place of your <code>has_nat_cast</code>/<code>has_int_cast</code>?</p>



<a name="282506768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282506768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282506768">(May 16 2022 at 14:50)</a>:</h4>
<p>That might end badly for <code>T = nat</code></p>



<a name="282506829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282506829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282506829">(May 16 2022 at 14:51)</a>:</h4>
<p>Also, <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.cast_coe">docs#nat.cast_coe</a> is <code>has_coe_t ℕ α</code> not <code>has_coe ℕ α</code>, so likely the <code>_t</code> version is more appropriate</p>



<a name="282507005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282507005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282507005">(May 16 2022 at 14:52)</a>:</h4>
<p>(see <a href="https://leanprover-community.github.io/mathlib_docs/notes.html#coercion%20into%20rings">https://leanprover-community.github.io/mathlib_docs/notes.html#coercion%20into%20rings</a> for context)</p>



<a name="282508588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282508588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282508588">(May 16 2022 at 15:03)</a>:</h4>
<p>But we won't ever apply it for <code>T = nat</code>, right? I'm talking about the arguments to <code>function.injective.ring</code> and I claim that we can take in <code>has_coe nat R</code> or <code>has_coe_t nat R</code>.</p>



<a name="282509083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312182%20add_monoid_with_one/near/282509083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one.html#282509083">(May 16 2022 at 15:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2312182.20add_monoid_with_one/near/282506104">said</a>:</p>
<blockquote>
<p>Why can't <code>has_coe</code> be used in place of your <code>has_nat_cast</code>/<code>has_int_cast</code>?</p>
</blockquote>
<p>Mainly for future-proofing with regard to Lean 4.  Coercions are changing, and a <code>HasNatCast R</code> type class is guaranteed to continue working, while a <code>[Coe ℕ R]</code> argument in a definition might behave differently.</p>
<p>One such difference is already there, "regular" coercions are unfolded.  That is, when you type <code>(n : R)</code> it elaborates to <code>Nat.cast n</code> and there remains no trace of any coercion type class.  But this unfolding doesn't happen with <code>[Coe ℕ R]</code>.  Of course the difference doesn't really matter unless you <code>unfold Function.Injective.Semiring</code>, but I'd rather stay on the safe side.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>