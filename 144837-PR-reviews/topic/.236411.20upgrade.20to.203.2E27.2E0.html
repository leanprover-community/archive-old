---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html">#6411 upgrade to 3.27.0</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="227774793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227774793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227774793">(Feb 25 2021 at 14:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> gave us a new Lean today! The upgrade was relatively painless, except for two category theory proofs that are no longer <code>dec_trivial</code>.</p>



<a name="227774885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227774885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227774885">(Feb 25 2021 at 14:27)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/538">lean#538</a> looks like the most likely culprit, although I'm not sure. Anyone feel like investigating?</p>



<a name="227775600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227775600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227775600">(Feb 25 2021 at 14:32)</a>:</h4>
<p>What are the decidable instances in question?</p>



<a name="227775689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227775689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227775689">(Feb 25 2021 at 14:32)</a>:</h4>
<p><code>(ùü≠ (discrete Œ±)·µí·µñ).map f ‚â´ (_.mpr (iso.refl Y)).hom = (_.mpr (iso.refl X)).hom ‚â´ (F.left_op ‚ãô F).map f</code></p>



<a name="227775794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227775794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227775794">(Feb 25 2021 at 14:33)</a>:</h4>
<p>and </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">‚àÄ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="o">(</span><span class="n">pairwise</span> <span class="n">Œπ</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">),</span>
    <span class="o">(</span><span class="n">cocone</span> <span class="n">U</span><span class="o">)</span><span class="bp">.</span><span class="n">op.œÄ.app</span> <span class="n">j</span> <span class="bp">=</span>
      <span class="o">(</span><span class="n">iso.refl</span> <span class="o">(</span><span class="n">cocone</span> <span class="n">U</span><span class="o">)</span><span class="bp">.</span><span class="n">op.X</span><span class="o">)</span><span class="bp">.</span><span class="n">hom</span> <span class="bp">‚â´</span>
        <span class="o">((</span><span class="n">cones.postcompose_equivalence</span> <span class="o">(</span><span class="n">nat_iso.op</span> <span class="o">(</span><span class="n">pairwise_diagram_iso</span> <span class="n">U</span><span class="o">)))</span><span class="bp">.</span><span class="n">functor.obj</span>
           <span class="o">(</span><span class="n">cone.whisker</span> <span class="o">(</span><span class="n">pairwise_to_opens_le_cover</span> <span class="n">U</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span> <span class="o">(</span><span class="n">opens_le_cover_cocone</span> <span class="n">U</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span><span class="o">))</span><span class="bp">.</span><span class="n">œÄ.app</span>
          <span class="n">j</span>
</code></pre></div>



<a name="227776172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776172">(Feb 25 2021 at 14:35)</a>:</h4>
<p>what's the type of that equality?</p>



<a name="227776301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776301">(Feb 25 2021 at 14:36)</a>:</h4>
<p><code>(ùü≠ (discrete Œ±)·µí·µñ).obj X ‚ü∂ (F.left_op ‚ãô F).obj Y</code></p>



<a name="227776363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776363">(Feb 25 2021 at 14:36)</a>:</h4>
<p>and <code>((functor.const (pairwise Œπ)·µí·µñ).obj (cocone U).op.X).obj j ‚ü∂ (diagram U).op.obj j</code></p>



<a name="227776466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776466">(Feb 25 2021 at 14:37)</a>:</h4>
<p>hm, can you make a MWE so I can <code>#check</code> that expression?</p>



<a name="227776601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776601">(Feb 25 2021 at 14:38)</a>:</h4>
<p>It's probably easiest just to look at <code>discrete_category.lean:142</code> on master</p>



<a name="227776638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776638">(Feb 25 2021 at 14:38)</a>:</h4>
<p>The goal hasn't changed in the new branch</p>



<a name="227776707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776707">(Feb 25 2021 at 14:39)</a>:</h4>
<p>the proof is by tidy, you claim it's by <code>apply_instance : decidable ...</code>?</p>



<a name="227776745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776745">(Feb 25 2021 at 14:39)</a>:</h4>
<p>Try <code>tidy?</code></p>



<a name="227776778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227776778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227776778">(Feb 25 2021 at 14:39)</a>:</h4>
<p>it's <code>intros, exact dec_trivial</code></p>



<a name="227777434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777434">(Feb 25 2021 at 14:43)</a>:</h4>
<p>geez, the decidability proof is huge</p>



<a name="227777539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777539">(Feb 25 2021 at 14:44)</a>:</h4>
<p>once again I wish lean had printing for dag-like terms</p>



<a name="227777644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777644">(Feb 25 2021 at 14:44)</a>:</h4>
<p>As in, printed <code>g (f a) (f a)</code> as <code>let fa := f a in g fa fa</code>?</p>



<a name="227777701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777701">(Feb 25 2021 at 14:45)</a>:</h4>
<p>Or actually renders to graphviz</p>



<a name="227777745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777745">(Feb 25 2021 at 14:45)</a>:</h4>
<p>the first</p>



<a name="227777886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777886">(Feb 25 2021 at 14:46)</a>:</h4>
<p>ideally it would only do this when <code>f a</code> is large enough or multitudinous enough that there is a character count decrease by the replacement</p>



<a name="227777984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227777984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227777984">(Feb 25 2021 at 14:46)</a>:</h4>
<p>Even if it didn't, it would still be useful if a bit low level</p>



<a name="227778039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227778039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227778039">(Feb 25 2021 at 14:47)</a>:</h4>
<p>Can you resolve this for your case by introducing dummy instances?</p>



<a name="227778090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227778090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227778090">(Feb 25 2021 at 14:47)</a>:</h4>
<p>So that instead of finding <code>f a : decidable foo</code> it finds <code>fa : decidable foo</code></p>



<a name="227778767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227778767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227778767">(Feb 25 2021 at 14:52)</a>:</h4>
<p>I tried to get it into the goal view using</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">foo</span><span class="o">,</span>
  <span class="n">swap</span><span class="o">,</span>
  <span class="n">apply</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">P</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">P</span><span class="o">,</span> <span class="n">P</span> <span class="bp">‚Üí</span> <span class="n">P</span> <span class="bp">‚Üí</span> <span class="n">P</span><span class="o">),</span> <span class="n">apply</span> <span class="n">foo</span><span class="o">,</span>
  <span class="n">swap</span><span class="o">,</span> <span class="n">dec_trivial</span><span class="o">,</span>
</code></pre></div>
<p>so I can use widgets to drill down, but it's really sluggish</p>



<a name="227779105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227779105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227779105">(Feb 25 2021 at 14:54)</a>:</h4>
<p>yeah it straight up refuses to open a popup</p>



<a name="227780385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227780385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227780385">(Feb 25 2021 at 15:02)</a>:</h4>
<p>Ah, I managed to get a mwe out:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.discrete_category</span>
<span class="kd">universe</span> <span class="n">u</span>
<span class="kn">open</span> <span class="n">category_theory</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span>
  <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">discrete</span> <span class="n">Œ±</span> <span class="bp">‚•§</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">decidable_eq</span> <span class="o">((</span><span class="mi">ùü≠</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="o">(</span><span class="n">F.left_op</span> <span class="bp">‚ãô</span> <span class="n">F</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">Y</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>



<a name="227781904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227781904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227781904">(Feb 25 2021 at 15:11)</a>:</h4>
<p>found it</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span>
  <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">discrete</span> <span class="n">Œ±</span> <span class="bp">‚•§</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">decidable_eq</span> <span class="o">((</span><span class="mi">ùü≠</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="o">(</span><span class="n">F.left_op</span> <span class="bp">‚ãô</span> <span class="n">F</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">Y</span><span class="o">)</span> <span class="o">:=</span>
<span class="c1">-- by show_term {apply_instance} -- decidable_eq_of_subsingleton ...</span>
<span class="bp">Œª</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="o">(</span><span class="mi">ùü≠</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="o">(</span><span class="n">functor.left_op</span> <span class="n">F</span> <span class="bp">‚ãô</span> <span class="n">F</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">Y</span><span class="o">),</span>
<span class="bp">@</span><span class="n">decidable_eq_of_subsingleton</span> <span class="n">_</span> <span class="o">(</span><span class="n">id</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">apply_instance</span><span class="o">)</span> <span class="n">a</span> <span class="n">b</span>
<span class="c1">-- exact tactic failed, type mismatch, given expression has type</span>
<span class="c1">--   subsingleton</span>
<span class="c1">--     (ulift (plift (opposite.unop ((F.left_op ‚ãô F).obj Y) = opposite.unop ((ùü≠ (discrete Œ±)·µí·µñ).obj X))))</span>
<span class="c1">-- but is expected to have type</span>
<span class="c1">--   subsingleton ((ùü≠ (discrete Œ±)·µí·µñ).obj X ‚ü∂ (F.left_op ‚ãô F).obj Y)</span>
</code></pre></div>



<a name="227784364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227784364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227784364">(Feb 25 2021 at 15:25)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.discrete_category</span>

<span class="kn">open</span> <span class="n">category_theory</span>
<span class="kd">universe</span> <span class="n">u</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">subsingleton</span> <span class="n">Œ±</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">:</span> <span class="n">subsingleton</span> <span class="o">(</span><span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply_instance</span> <span class="c1">-- unification fail</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">subsingleton</span> <span class="n">Œ±</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="o">(</span><span class="n">discrete</span> <span class="n">Œ±</span><span class="o">)</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">:</span> <span class="n">subsingleton</span> <span class="o">(</span><span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">has_hom.hom</span><span class="o">],</span> <span class="n">apply_instance</span> <span class="o">}</span> <span class="c1">-- ok</span>
</code></pre></div>



<a name="227785355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227785355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227785355">(Feb 25 2021 at 15:31)</a>:</h4>
<p>The offending instance is <code>attribute [irreducible] has_hom.opposite</code></p>



<a name="227786009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227786009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227786009">(Feb 25 2021 at 15:35)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.has_hom.opposite">docs#category_theory.has_hom.opposite</a>?</p>



<a name="227787553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227787553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227787553">(Feb 25 2021 at 15:45)</a>:</h4>
<p>Adding these to <code>category_theory.opposites</code> should fix the issue</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">[</span><span class="n">subsingleton</span> <span class="o">(</span><span class="n">unop</span> <span class="n">B</span> <span class="bp">‚ü∂</span> <span class="n">unop</span> <span class="n">A</span><span class="o">)]</span> <span class="o">:</span> <span class="n">subsingleton</span> <span class="o">(</span><span class="n">A</span> <span class="bp">‚ü∂</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">op_equiv</span> <span class="n">A</span> <span class="n">B</span><span class="o">)</span><span class="bp">.</span><span class="n">subsingleton_iff.2</span> <span class="o">(</span><span class="kd">by</span> <span class="n">apply_instance</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="o">(</span><span class="n">unop</span> <span class="n">B</span> <span class="bp">‚ü∂</span> <span class="n">unop</span> <span class="n">A</span><span class="o">)]</span> <span class="o">:</span> <span class="n">decidable_eq</span> <span class="o">(</span><span class="n">A</span> <span class="bp">‚ü∂</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">op_equiv</span> <span class="n">A</span> <span class="n">B</span><span class="o">)</span><span class="bp">.</span><span class="n">decidable_eq</span>
</code></pre></div>
<p>but it causes the proof just after to break</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">category.opposite</span> <span class="o">:</span> <span class="n">category.</span><span class="o">{</span><span class="n">v‚ÇÅ</span><span class="o">}</span> <span class="n">C</span><span class="bp">·µí·µñ</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">comp</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="o">(</span><span class="n">g.unop</span> <span class="bp">‚â´</span> <span class="n">f.unop</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span><span class="o">,</span>
  <span class="n">id</span>   <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">X</span><span class="o">,</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="o">(</span><span class="n">unop</span> <span class="n">X</span><span class="o">))</span><span class="bp">.</span><span class="n">op</span> <span class="o">}</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">category</span> <span class="n">C</span><span class="o">,</span>
<span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">,</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span>
<span class="bp">‚ä¢</span> <span class="o">(</span><span class="n">f.unop</span> <span class="bp">‚â´</span> <span class="mi">ùüô</span> <span class="o">(</span><span class="n">unop</span> <span class="n">X</span><span class="o">))</span><span class="bp">.</span><span class="n">op</span> <span class="bp">=</span> <span class="n">f</span>
<span class="n">opposites.lean</span><span class="o">:</span><span class="mi">97</span><span class="o">:</span><span class="mi">0</span>
<span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">category</span> <span class="n">C</span><span class="o">,</span>
<span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">,</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span>
<span class="bp">‚ä¢</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="o">(</span><span class="n">unop</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">‚â´</span> <span class="n">f.unop</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span> <span class="bp">=</span> <span class="n">f</span>
<span class="n">opposites.lean</span><span class="o">:</span><span class="mi">97</span><span class="o">:</span><span class="mi">0</span>
<span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">category</span> <span class="n">C</span><span class="o">,</span>
<span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">,</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">‚ü∂</span> <span class="n">X</span><span class="o">,</span>
<span class="n">g</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">Y</span> <span class="bp">‚ü∂</span> <span class="n">Z</span>
<span class="bp">‚ä¢</span> <span class="o">(</span><span class="n">h.unop</span> <span class="bp">‚â´</span> <span class="n">g.unop</span> <span class="bp">‚â´</span> <span class="n">f.unop</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span> <span class="bp">=</span> <span class="o">((</span><span class="n">h.unop</span> <span class="bp">‚â´</span> <span class="n">g.unop</span><span class="o">)</span> <span class="bp">‚â´</span> <span class="n">f.unop</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span>
</code></pre></div>



<a name="227790265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227790265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227790265">(Feb 25 2021 at 16:00)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">)</span> <span class="o">[</span><span class="n">subsingleton</span> <span class="o">(</span><span class="n">unop</span> <span class="n">B</span> <span class="bp">‚ü∂</span> <span class="n">unop</span> <span class="n">A</span><span class="o">)]</span> <span class="o">:</span> <span class="n">subsingleton</span> <span class="o">(</span><span class="n">A</span> <span class="bp">‚ü∂</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">op_equiv</span> <span class="n">A</span> <span class="n">B</span><span class="o">)</span><span class="bp">.</span><span class="n">subsingleton_iff.2</span> <span class="o">(</span><span class="kd">by</span> <span class="n">apply_instance</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">}</span>
  <span class="o">[</span><span class="n">category</span> <span class="n">C</span><span class="o">]</span>
  <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">C</span><span class="bp">·µí·µñ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚ü∂</span> <span class="n">Y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">unop</span> <span class="n">Y</span> <span class="bp">‚ü∂</span> <span class="n">unop</span> <span class="n">X</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">f.unop</span> <span class="bp">‚â´</span> <span class="mi">ùüô</span> <span class="o">(</span><span class="n">unop</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f.unop</span> <span class="bp">‚â´</span> <span class="mi">ùüô</span> <span class="o">(</span><span class="n">unop</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">h</span><span class="o">]</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="227790454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227790454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227790454">(Feb 25 2021 at 16:01)</a>:</h4>
<p>Actually I think this is probably just a side effect of the bug that 3.27 fixes, so I won't try to track this down more</p>



<a name="227795929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227795929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227795929">(Feb 25 2021 at 16:32)</a>:</h4>
<p>Thanks Mario! That's some impressive debugging work</p>



<a name="227796000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227796000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227796000">(Feb 25 2021 at 16:32)</a>:</h4>
<p>I thought we got rid of all the <code>attribute [irreducible]</code>s, but there's one right after <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.has_hom.hom.unop/src">src#category_theory.has_hom.hom.unop</a></p>



<a name="227799540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236411%20upgrade%20to%203.27.0/near/227799540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0.html#227799540">(Feb 25 2021 at 16:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/144837-PR-reviews/topic/.236411.20upgrade.20to.203.2E27.2E0/near/227790454">said</a>:</p>
<blockquote>
<p>Actually I think this is probably just a side effect of the bug that 3.27 fixes, so I won't try to track this down more</p>
</blockquote>
<p>As in, after adding the two instances, old lean breaks but you expect new lean to succeed?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>