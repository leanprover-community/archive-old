---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html">#12132 add normed_division_ring</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="273237711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273237711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273237711">(Feb 25 2022 at 14:46)</a>:</h4>
<p>Any new ideas? I don't even know how to begin troubleshooting.</p>



<a name="273239308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273239308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273239308">(Feb 25 2022 at 14:58)</a>:</h4>
<p>Should we just bump the threshold?</p>



<a name="273240219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273240219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273240219">(Feb 25 2022 at 15:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197836">Jireh Loreaux</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring/near/272877090">said</a>:</p>
<blockquote>
<p>okay, I got it. I just needed 5GB of memory. Should I post the output here?</p>
</blockquote>
<p>Note that the server started by vscode <a href="https://github.com/leanprover-community/lean/blob/c6f789e73ca072c0f9ad9add96957c910fca802e/src/shell/lean.cpp#L168-L170">appears to only use 1 GiB</a></p>



<a name="273240591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273240591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273240591">(Feb 25 2022 at 15:07)</a>:</h4>
<p>This PR seems innocent. The linter fails because you're adding a type-class along one of the longest branches in the type-class hierarchy.<br>
So bumping the threshold seems fine here.</p>



<a name="273240727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273240727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273240727">(Feb 25 2022 at 15:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring/near/272929025">said</a>:</p>
<blockquote>
<p>Half of the instance search is because of the subgoal <code>has_continuous_smul ℝ β</code> from the <a href="https://leanprover-community.github.io/mathlib_docs/find/topological_add_group.path_connected">docs#topological_add_group.path_connected</a> instance.  It might be worth a try to swap the last two arguments there so that it searches for <code>toplogical_add_group β</code> first.</p>
</blockquote>
<p>I'll take a look if that improves anything.</p>



<a name="273241839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273241839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273241839">(Feb 25 2022 at 15:17)</a>:</h4>
<p>It would be need if <a href="https://github.com/leanprover-community/lean/blob/65ad4ffdb3abac75be748554e3cbe990fb1c6500/src/util/interrupt.cpp#L15"><code>g_heartbeat</code></a> were exposed somehow by a variant of <code>try_for</code> that returned <code>option (prod nat T)</code>, where if the try_for succeeds it returns how long it actually took</p>



<a name="273242028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273242028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273242028">(Feb 25 2022 at 15:19)</a>:</h4>
<p>That way you could do <code>(ret, count) ← try_for (threshold*k)</code> then include <code>count</code> in the error message <code>if threshold &lt; count</code></p>



<a name="273242281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273242281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273242281">(Feb 25 2022 at 15:21)</a>:</h4>
<p><del>Bumping from 15000 to 25000 seems to just result in errors downstream</del> Nevermind, these are just in <code>nolints.txt</code></p>



<a name="273242375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273242375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273242375">(Feb 25 2022 at 15:22)</a>:</h4>
<p>(tested with <code>#lint_all only fails_quickly'</code> where <code>fails_quickly'</code> is just a copy of <code>fails_quickly</code> with a different timeout)</p>



<a name="273254057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273254057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273254057">(Feb 25 2022 at 16:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring/near/272929025">said</a>:</p>
<blockquote>
<p>Half of the instance search is because of the subgoal <code>has_continuous_smul ℝ β</code> from the <a href="https://leanprover-community.github.io/mathlib_docs/find/topological_add_group.path_connected">docs#topological_add_group.path_connected</a> instance.  It might be worth a try to swap the last two arguments there so that it searches for <code>toplogical_add_group β</code> first.</p>
</blockquote>
<p>I changed the order in <a href="https://github.com/leanprover-community/mathlib/tree/lower_fails_quickly">branch#lower_fails_quickly</a>, but the <code>fails_quickly</code> check needs basically the same number of steps on that branch and master branch.</p>



<a name="273254236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/273254236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#273254236">(Feb 25 2022 at 16:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring/near/273242375">said</a>:</p>
<blockquote>
<p>(tested with <code>#lint_all only fails_quickly'</code> where <code>fails_quickly'</code> is just a copy of <code>fails_quickly</code> with a different timeout)</p>
</blockquote>
<p>If you only want to check a single declaration, you can save some time by doing</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">all</span>

<span class="kn">open</span> <span class="n">tactic</span>
<span class="kd">run_cmd</span> <span class="k">do</span>
  <span class="n">d</span> <span class="bp">←</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">prod.nonempty</span><span class="o">,</span>
  <span class="n">t</span> <span class="bp">←</span> <span class="n">fails_quickly</span> <span class="mi">15000</span> <span class="n">d</span> <span class="bp">&gt;&gt;=</span> <span class="n">trace</span>
</code></pre></div>



<a name="274065732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/274065732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#274065732">(Mar 04 2022 at 01:18)</a>:</h4>
<p>Shall we just increase the timeout then? This PR has picked up some conflicts in the meantime</p>



<a name="275085674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/275085674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#275085674">(Mar 12 2022 at 08:47)</a>:</h4>
<p>Thoughts?</p>



<a name="275269654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/275269654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#275269654">(Mar 14 2022 at 17:21)</a>:</h4>
<p>See <a href="https://github.com/leanprover-community/mathlib/pull/12675">#12675</a> for a related issue.</p>



<a name="275602235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/275602235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#275602235">(Mar 17 2022 at 02:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>  any idea why <code>normed_division_ring</code> also creates such huge type class search problems? Is there a suitable fix, like lowering the instance priority? Or does this just mean I should abandon this as a typeclass (which seems a shame)?</p>



<a name="275608199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/275608199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#275608199">(Mar 17 2022 at 05:11)</a>:</h4>
<p>actually, I should have merged master first before I asked. Maybe CI will be okay on this branch now that <a href="https://github.com/leanprover-community/mathlib/pull/12675">#12675</a> is in.</p>



<a name="275615522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/275615522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#275615522">(Mar 17 2022 at 07:34)</a>:</h4>
<p>And indeed, that seemed to do the trick!</p>



<a name="275649532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2312132%20add%20normed_division_ring/near/275649532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2312132.20add.20normed_division_ring.html#275649532">(Mar 17 2022 at 13:10)</a>:</h4>
<p>Indeed, thanks!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>