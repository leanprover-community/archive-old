---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html">#13483 `move_add`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="280108215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280108215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280108215">(Apr 25 2022 at 18:13)</a>:</h4>
<p>Sorry, this got posted before I was finished typing!</p>



<a name="280109312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280109312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280109312">(Apr 25 2022 at 18:22)</a>:</h4>
<p>The tactic should have functioning "unused arguments, target" detection and functionality!  Feel free to comment or test!</p>
<p>Thanks!</p>



<a name="280170797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280170797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280170797">(Apr 26 2022 at 07:32)</a>:</h4>
<p>To show-case the <code>move_add</code>-niche, let me give an example from Sébastien's recent PR <a href="https://github.com/leanprover-community/mathlib/pull/13696">#13696</a>.</p>
<p>He proves</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">add_sq'</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_sq</span><span class="o">,</span> <span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_comm</span> <span class="n">_</span> <span class="o">(</span><span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span><span class="o">),</span> <span class="n">add_assoc</span><span class="o">]</span>
</code></pre></div>
<p>and <code>move_add</code> is designed to make the <code>add_assoc/add_comm</code> stuff more automatic.  Indeed, this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">add_sq'</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">add_sq</span><span class="o">,</span>
  <span class="c1">-- Goal: `a ^ 2 + 2 * a * b + b ^ 2 = a ^ 2 + b ^ 2 + 2 * a * b`</span>
  <span class="c1">-- so we move the terms that involve a `mul` to the right</span>
 <span class="n">move_add</span> <span class="n">_</span> <span class="bp">*</span> <span class="n">_</span>  <span class="c1">-- and we are done! }</span>
</code></pre></div>
<p>(Of course, in this case, also <code>abel</code> or <code>ring</code> would have solved the goal instead of <code>move_add</code>.  The scope of <code>move_add</code> is that you tell Lean which terms you want to go to the beginning and which ones you want to the end.)</p>
<p>We could have also decided to move the terms involving a power of <code>b</code> to the left and used <code>move_add ← b ^ _</code>.</p>



<a name="280186499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280186499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280186499">(Apr 26 2022 at 09:58)</a>:</h4>
<p>I'm curious about the speed of each solution <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> (although it's probably impossible to beat the sequence of rewrites)</p>
<p>Btw, I recall the initial motivation being that laborious proof involving degrees of monomials. Does <code>move_add</code> make it easier?</p>



<a name="280186754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280186754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280186754">(Apr 26 2022 at 10:00)</a>:</h4>
<p>Let me just say that in this early file, neither <code>abel</code> nor <code>ring</code> is available yet, hence the tedious chain of rewrites.</p>



<a name="280188181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280188181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280188181">(Apr 26 2022 at 10:15)</a>:</h4>
<p>I am not sure about speed and it would probably make sense to measure it on a longer chain: this one looks instantaneous regardless of whether I use <code>abel, ring, move_add</code> (and of course the chain of rewrites).</p>
<p>Regarding imports, <code>move_add</code> wants <code>algebra.group.basic</code> to work: its "mathlib-input" is <code>add_comm, add_assoc, add_left_comm</code>.  (Almost) everything else happens directly on expressions.</p>



<a name="280188430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280188430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280188430">(Apr 26 2022 at 10:18)</a>:</h4>
<p>Regarding computing degrees, the use of <code>move_add</code> is that it allows you easily to "isolate"  a summand in an expression.  Thus, to get a computation of the degree of a polynomial, you would <code>move_add</code> to the right the highest degree term, use <code>nat_degree_add_eq_right_of_nat_degree_lt</code> to break the proof into</p>
<ol>
<li>proving that the degree of the highest degree term is what it is,</li>
<li>proving that everything else has degree smaller than that.</li>
</ol>
<p>All of this can be automated for a polynomials that is written as a sum of monomials with exponents that are closed natural numbers.  You can push the computation further for different representations, of course, but with more work.</p>



<a name="280188579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280188579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280188579">(Apr 26 2022 at 10:20)</a>:</h4>
<p>As you can imagine, it gets somewhat tricky when the polynomial has individual summands of the form <code>X ^ 5 * C r * X ^ 4 * X * C 5 * 7</code>, but, with more effort, many of these common expressions can be converted to standard form.</p>



<a name="280188693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280188693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280188693">(Apr 26 2022 at 10:21)</a>:</h4>
<p>Also, Sébastien, I was not really suggesting that <code>add_sq'</code> is a "good" application for <code>move_add</code>, just that it is a place where the sequence of <code>rw</code> does what a human would describe as "move terms around" and <code>move_add</code> "sounds" closer to what a human would say and think!</p>



<a name="280189543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280189543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280189543">(Apr 26 2022 at 10:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60/near/280186754">said</a>:</p>
<blockquote>
<p>Let me just say that in this early file, neither <code>abel</code> nor <code>ring</code> is available yet, hence the tedious chain of rewrites.</p>
</blockquote>
<p>Is <code>ac_refl</code> available?</p>



<a name="280189657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280189657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280189657">(Apr 26 2022 at 10:33)</a>:</h4>
<p>Still, you could <code>import tactic.move_add</code> in <code>algebra.group_power.basic</code> and the proof above would work.</p>



<a name="280189673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280189673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280189673">(Apr 26 2022 at 10:33)</a>:</h4>
<p>Let me check <code>ac_refl</code>, likely yes.</p>



<a name="280189778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280189778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280189778">(Apr 26 2022 at 10:34)</a>:</h4>
<p><code>ac_refl</code> does work, though I could actually notice that it was elaborating, unlike any of the other tactics.</p>



<a name="280189956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280189956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280189956">(Apr 26 2022 at 10:36)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rw</span> <span class="n">add_sq</span><span class="o">,</span>  <span class="n">ac_refl</span><span class="o">,</span>  <span class="c1">-- elaboration of add_sq' took 1.03s</span>
<span class="n">rw</span> <span class="n">add_sq</span><span class="o">,</span> <span class="n">move_add</span> <span class="n">_</span> <span class="bp">*</span> <span class="n">_</span><span class="o">,</span> <span class="c1">-- elaboration of add_sq' took 48.2ms</span>
</code></pre></div>



<a name="280189964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280189964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280189964">(Apr 26 2022 at 10:36)</a>:</h4>
<p>Yeah, the two main arguments for <code>move_add</code> over <code>ac_change</code> seem to be:</p>
<ul>
<li><code>ac_change</code> and <code>ac_refl</code> seem to be really slow. Hopefully we can improve this in Lean4.</li>
<li>It looks like <code>move_add</code> has much better support for wildcards</li>
</ul>
<p>Of course, <code>ac_change</code> is happy to reorder plenty of other operators too, so has its own advantages.</p>



<a name="280190199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280190199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280190199">(Apr 26 2022 at 10:39)</a>:</h4>
<p>I would also like to point out that <code>move_add</code> is intended not only to close a goal (for which <code>abel</code> may work better), but especially to massage a sum to a form that is convenient to continue: for instance exposing a summand that has a special shape, grouping together important terms, preparing for a <code>congr</code> or <code>congr_arg</code> to remove unwanted fluff...</p>



<a name="280190316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280190316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280190316">(Apr 26 2022 at 10:40)</a>:</h4>
<p>Indeed; so <code>ac_change</code> is a more apt comparison than <code>ac_refl</code> or <code>abel</code></p>



<a name="280190473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280190473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280190473">(Apr 26 2022 at 10:42)</a>:</h4>
<p>I have actually never used <code>ac_change</code> until it was brought up while thinking about this tactic.  You should produce a target type for <code>ac_change</code>, right?  For <code>move_add</code> you just select the terms you want to move around, you do not need to specify the target sum.</p>



<a name="280209744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280209744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280209744">(Apr 26 2022 at 13:29)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> , you asked about a <code>mul</code> version of this tactic <a href="#narrow/stream/144837-PR-reviews/topic/.2313483.20.60sort_summands.60/near/279592486">here</a>, before the tactic changed name from <code>sort_summands</code> to <code>move_add</code>.</p>
<p>Here is now a more informed answer.  To literally port the tactic so that it "works" with multiplication is completely trivial: it is basically the result of <code>s/add/mul/g</code> and then removing the definitions that can be recycled as they are.</p>
<p>However, if you want to work with a structure that has <em>simultaneously</em> a commutative multiplication and a commutative addition (I will let you pick your favourite such typeclass), then there is likely the need for some further special support.</p>
<p>The main reason is that most expressions in a ring end up being written as sum of products, not products of sums.  Thus, it is easy enough to access the summands and they tend to be "more different".  However, suppose that you have an expression such as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span>
</code></pre></div>
<p>and you want to <code>move_mul b</code> to move all <code>b</code>s to the right, so that you would obtain</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">b</span>
</code></pre></div>
<p>(maybe to collect the <code>b</code>s into <code>(a + a * c) * b</code>).</p>
<p>Now, you run into the (slight) issue that, currently, the tactic will zoom into the first summand <code>a * b</code>, will match the given <code>b</code>, decide that this was the substitution that you wanted to perform, observe that there is nothing to do... and report that you did not need to call it!</p>
<p>A possible fix would be to make the behaviour of <code>move_mul</code> more granular than <code>move_add</code> and make it try "itself" on all instances separately, possibly using also <code>congr</code> to focus on each individual factor.  This of course may run into further problems, since the tactic will be more complex, but it might work well.</p>
<p>To conclude, making <code>move_add</code> the "<code>meta</code>-to_additive" of <code>move_mul</code> is literally something that could be done by <code>sed</code>.  This will work well in a <code>comm_semigroup</code> <em>that is not a ring</em>.</p>
<p>To be able to work with <code>move_mul</code> in a <code>comm_semiring</code> would require some thinking about how to produce results that would match with what a human might want.</p>



<a name="280210265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210265">(Apr 26 2022 at 13:33)</a>:</h4>
<p>Can you take in an expression which corresponds to the summand you want to rewrite?</p>



<a name="280210344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210344">(Apr 26 2022 at 13:34)</a>:</h4>
<p>Can you take in an expression which corresponds to the summand you want to rewrite?</p>



<a name="280210348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210348">(Apr 26 2022 at 13:34)</a>:</h4>
<p>It <em>can</em> be done (and would not be hard to do), but currently <code>move_add</code> does not do it.</p>



<a name="280210440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210440">(Apr 26 2022 at 13:35)</a>:</h4>
<p>I have a feeling that this is highlighting a difference between <code>add</code> and <code>mul</code>, at least in terms of the expectations that humans expect on them.</p>



<a name="280210469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210469">(Apr 26 2022 at 13:35)</a>:</h4>
<p>Can you take in an expression which corresponds to the summand you want to rewrite?</p>



<a name="280210574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210574">(Apr 26 2022 at 13:36)</a>:</h4>
<p>If you are working in a <code>comm_monoid</code> or in an <code>add_comm_monoid</code>, the two would work just as well.  When you combine the two, I think that <code>move_mul</code> will require more work to be actually equally useful as <code>move_add</code>.</p>



<a name="280210840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210840">(Apr 26 2022 at 13:38)</a>:</h4>
<p>I can certainly imagine an (easy) modification of <code>move_add</code> that also takes in a specification as <code>move_mul [vars] in (expr)</code>.</p>



<a name="280210916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280210916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280210916">(Apr 26 2022 at 13:38)</a>:</h4>
<p>Though in this case, it may be closer to <code>conv in (...) { use move_mul here }</code>.</p>



<a name="280211026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280211026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280211026">(Apr 26 2022 at 13:39)</a>:</h4>
<p>It would probably make more sense to develop a more interactive <code>conv</code> and use the "current, non-existing" <code>move_mul</code> there (and possibly also <code>move_add</code> in some edge cases).</p>



<a name="280211130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280211130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280211130">(Apr 26 2022 at 13:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60/near/280210265">said</a>:<br>
<span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60/near/280210344">said</a>:<br>
<span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60/near/280210469">said</a>:</p>
<blockquote>
<p>Can you take in an expression which corresponds to the summand you want to rewrite?</p>
</blockquote>
<p>Looks like the Zulip API has some idempotence problems...</p>



<a name="280211260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280211260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280211260">(Apr 26 2022 at 13:41)</a>:</h4>
<p><span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="280211367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280211367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280211367">(Apr 26 2022 at 13:42)</a>:</h4>
<p>Argh... I will blame that on the train's crappy wifi. on the train's crappy wifi. on the train's crappy wifi.</p>



<a name="280213077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280213077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280213077">(Apr 26 2022 at 13:55)</a>:</h4>
<p>I am thinking now that <code>move_add</code> would probably run into similar issues as the ones described above, if we had a product of sums and we wanted to rearrange the sums in each factor.</p>
<p>If there is some need for this, then it would not be hard to implement, either as the <code>move_add/mul [...] in [...]</code>, or by trying to get <code>move_add/mul</code> to act in a more granular way, focusing on individual subexpressions that are sums/products and performing the rearrangements separately.</p>



<a name="280213170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280213170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280213170">(Apr 26 2022 at 13:55)</a>:</h4>
<p>(Yaël, if you do not mind, I will not post my messages 3 times.)</p>



<a name="280213740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280213740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280213740">(Apr 26 2022 at 14:00)</a>:</h4>
<p><span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="280738162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/280738162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#280738162">(Apr 30 2022 at 14:07)</a>:</h4>
<p>Yaël, you had expressed interest in a <code>move_mul</code> tactic, analogous to <code>move_add</code>.  In <a href="https://github.com/leanprover-community/mathlib/tree/adomani_move_op">branch#adomani_move_op</a>, there is a file <code>tactic.move_op</code>, defining a tactic unsurprisingly called <code>move_op</code>!  If you call</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">move_op</span> <span class="o">(</span><span class="n">name</span> <span class="n">of</span> <span class="n">your</span> <span class="n">operation</span><span class="o">)</span> <span class="o">(</span><span class="n">optional</span> <span class="n">list</span> <span class="n">of</span> <span class="n">symbols</span> <span class="n">to</span> <span class="n">move</span> <span class="n">around</span><span class="o">)</span> <span class="o">(</span><span class="n">optional</span> <span class="n">at</span> <span class="n">locations</span><span class="o">)</span>
</code></pre></div>
<p>it will try to do what you can probably imagine.</p>
<p>Right now, this only supports <code>has_add.add</code> or <code>has_mul.mul</code>, since, in order to do the rearranging, the tactic calls <code>add/mul_comm, add/mul_assoc, </code>add/mul_left_comm`.  Adding support for further operations is straightforward.  (You can already use any named operation; however, the tactic will invariably fail to prove that the rewrite works, since it does not know to use the right lemmas.)</p>
<p>The tactic works well (if I may say so myself!) with <code>has_add.add</code>.</p>
<p>Using it with <code>has_mul.mul</code> requires more love: it works well for terms that only involve multiplication (i.e. no sums of terms), since then it is harder for previously reordered terms to affect terms that you are changing later.  If your expressions involve sums of products and are reasonably "repetitions-free", it should also work well.  Note that, due to the pattern-matching, "repetitions" are quite common, if you do not steer them strongly.</p>
<p>If you want to try it out, feel free to do so!  If you do, please, give me lots of comments!</p>



<a name="281644933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/281644933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#281644933">(May 09 2022 at 06:44)</a>:</h4>
<p>Dear All,</p>
<p>I thought of trying to get this PR moving again.  Right now, CI is unhappy for some <a href="#narrow/stream/113488-general/topic/unhappy.20user.20ID.20104802998/near/281642954">transient issue</a>.</p>
<p>In the meantime, I've based <a href="https://github.com/leanprover-community/mathlib/pull/14040">#14040</a> on top of this one to compute <code>nat_degree</code>s of polynomials with some success.</p>
<p>If anyone has any further comment on <code>move_add</code>, I'd be happy to address them!</p>
<p>Thank you very much!</p>



<a name="281645417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/281645417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#281645417">(May 09 2022 at 06:52)</a>:</h4>
<p>Meanwhile, if you want oleans to go with this PR (<a href="https://github.com/leanprover-community/mathlib/pull/13483">#13483</a>), you can get the oleans of <a href="https://github.com/leanprover-community/mathlib/pull/14040">#14040</a>, which are available.  The reason <a href="https://github.com/leanprover-community/mathlib/pull/13483">#13483</a> needs lots of new oleans is that I modified the doc-string for <code>ac_change</code> in <code>tactic.congr</code>, a file that is imported a lot!</p>



<a name="282746714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/282746714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#282746714">(May 18 2022 at 06:58)</a>:</h4>
<p>Dear All,</p>
<p>are there any further comments or suggestions for this tactic?  If people feel that it would help, I can look for place in mathlib where using this tactic would shorten/simplify some proofs.</p>



<a name="282773198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/282773198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#282773198">(May 18 2022 at 11:26)</a>:</h4>
<p>Yeah I think that's the common motivation to merge tactics: you can write less and do more. And if it accomplishes the goal of being <em>faster</em> that's even better. I don't recall a tactic being merged as a standalone patch</p>



<a name="282824704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/282824704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#282824704">(May 18 2022 at 17:55)</a>:</h4>
<p>I have created a sample PR <a href="https://github.com/leanprover-community/mathlib/pull/14228">#14228</a> on top of <a href="https://github.com/leanprover-community/mathlib/pull/13483">#13483</a>.  I am not especially attached to any of these golfing suggestions, they are mostly there to see what can be done.</p>
<p><a href="https://github.com/leanprover-community/mathlib/compare/aa_sort...adomani_move_add_random_golf">Here</a> is a direct link to the diff between the PR where <code>move_add</code> is introduced and its sample usage.</p>
<p>I hope that this helps!</p>



<a name="285569816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/285569816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#285569816">(Jun 09 2022 at 17:33)</a>:</h4>
<p>I revamped the <code>move_add</code> tactic, after a little bit of prodding!  Now, there is a <code>tactic.move_op</code> that moves "operands" around for a generic, user-supplied (binary, associative, commutative) operation.  This does not work out of the box.</p>
<p>What does work out of the box are two interactive tactics <code>move_add</code> and <code>move_mul</code>.</p>



<a name="285569966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/285569966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#285569966">(Jun 09 2022 at 17:34)</a>:</h4>
<p>Even though the PR adds almost 500 lines, this includes a file with tests and <em>a lot</em> of documentation for the various definitions and tactics.</p>



<a name="287125838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/287125838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#287125838">(Jun 22 2022 at 23:16)</a>:</h4>
<p>Does anyone feel like giving some comments on <a href="https://github.com/leanprover-community/mathlib/pull/13483">#13483</a>?</p>
<p>The current version is quite stable.</p>
<p>I'd be more than happy to hear any feedback on the tactic!</p>
<p>Thanks!</p>



<a name="287154190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/287154190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#287154190">(Jun 23 2022 at 07:34)</a>:</h4>
<p>I'll try to take a look today</p>



<a name="288150928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288150928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288150928">(Jul 01 2022 at 10:35)</a>:</h4>
<p>Dear All,</p>
<p>is there any further comment that anyone has on <a href="https://github.com/leanprover-community/mathlib/pull/13483">#13483</a>?</p>



<a name="288151937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288151937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288151937">(Jul 01 2022 at 10:46)</a>:</h4>
<p>Looking now!</p>



<a name="288186902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288186902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288186902">(Jul 01 2022 at 15:48)</a>:</h4>
<p>Dear All,</p>
<p>Eric found a puzzle with <code>move_add</code>.  With the current implementation, this example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.list.of_fn</span>
<span class="kn">import</span> <span class="n">tactic.move_add</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">list.of_fn</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">))</span> <span class="bp">=</span> <span class="n">list.of_fn</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="mi">3</span> <span class="bp">+</span> <span class="n">n</span><span class="o">),</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">move_add</span> <span class="o">[</span><span class="bp">←</span><span class="n">n</span><span class="o">],</span>   <span class="c1">-- fails</span>
<span class="kd">end</span>
</code></pre></div>
<p>fails, even though <code>rw add_comm</code> works and closes the goal.  Eric also proposed an approach to solve this issue, using <code>ext_simplify_core</code>.  However, there are some un-instantiated metavariables that are resisting instantiation.</p>
<p>Could someone take a look, please?</p>
<p>I am going to ping <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> and <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> , since I know that whatever problem there is with Lean, they are able to solve it!  <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>Thank you very much!</p>



<a name="288194846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288194846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288194846">(Jul 01 2022 at 16:31)</a>:</h4>
<p>Does <code>rw</code> work, or does it need <code>simp_rw</code>? I only tested with the latter.</p>



<a name="288204307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288204307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288204307">(Jul 01 2022 at 17:49)</a>:</h4>
<p>I tried <code>rw</code>, after seeing that you had <code>simp_rw</code> and it did work.  Since I know that you can sometimes rewrite under binders, I wanted to push the limits!  <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="288326943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288326943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288326943">(Jul 03 2022 at 13:09)</a>:</h4>
<p>I'll make a spin-off PR with the broken ext_simplify_core version to make it easier for an expert to diagnose what's going wrong</p>



<a name="288389871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288389871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288389871">(Jul 04 2022 at 10:01)</a>:</h4>
<p>I had some luck in <a href="https://github.com/leanprover-community/mathlib/tree/aa_sort-ext_simplify">branch#aa_sort-ext_simplify</a>, but there's some weirdness going on which is duplicating all of the hypotheses in the goal view.</p>



<a name="288390624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288390624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288390624">(Jul 04 2022 at 10:09)</a>:</h4>
<p>Could it be that replacehyp is acting on the local constants and is not able to clear them?</p>



<a name="288390761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288390761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288390761">(Jul 04 2022 at 10:10)</a>:</h4>
<p>(sorry if this is a really basic suggestion: I had been stumped by something similar earlier...)</p>



<a name="288391140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288391140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288391140">(Jul 04 2022 at 10:15)</a>:</h4>
<p>It looks exactly like what was happening to me at some point.  Let me see if I can fix it the same way I did it earlier.</p>



<a name="288391437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288391437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288391437">(Jul 04 2022 at 10:18)</a>:</h4>
<p>does what is below fix it?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- in `reorder_hyp`</span>
<span class="o">(</span><span class="n">unchanged</span><span class="o">,</span> <span class="n">unused</span><span class="o">)</span> <span class="bp">←</span> <span class="n">tactic.unwrap</span> <span class="n">result</span><span class="o">,</span>  <span class="c1">-- this is line 211, unchanged until here</span>
<span class="k">if</span> <span class="n">unchanged</span> <span class="k">then</span> <span class="n">skip</span> <span class="k">else</span>  <span class="c1">-- add this as the next line</span>
</code></pre></div>



<a name="288393401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288393401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288393401">(Jul 04 2022 at 10:40)</a>:</h4>
<p>Ah yes, that does help</p>



<a name="288394433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288394433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288394433">(Jul 04 2022 at 10:53)</a>:</h4>
<p>Now the next failure is that we seem to be instiating the universe metavariables twice in different ways</p>



<a name="288394508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288394508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288394508">(Jul 04 2022 at 10:54)</a>:</h4>
<p>Because <code>example {R : Type*} : ... := prf</code> means "I'm not going to decide what universe <code>R</code> is until I see the proof".</p>



<a name="288394724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288394724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288394724">(Jul 04 2022 at 10:57)</a>:</h4>
<p>Ok, I think that I have run into a similar problem using <code>move_add</code> in conjunction with <code>compute_degree</code>, but have not been able to understand what the issue was.  I can see that it gets fixed by <code>universe u, {R : Type u}</code>, but this was the extent of my understanding...</p>



<a name="288395041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288395041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288395041">(Jul 04 2022 at 11:00)</a>:</h4>
<p>It's specifically caused by <code>example</code> due to it behaving like <code>def</code></p>



<a name="288395221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288395221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288395221">(Jul 04 2022 at 11:02)</a>:</h4>
<p>Ok, I had not realized that using <code>example</code> in tests was stronger than using <code>lemmas</code>.  Still, I had tried investigating the matter, but I made no progress.  I had tried supplying explicitly instances somewhere, but with no luck.</p>



<a name="288395463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288395463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288395463">(Jul 04 2022 at 11:05)</a>:</h4>
<p>Maybe, since I had run into this issue earlier, it means that it is not caused by <code>ext_simplify_core</code>, but that it was already present in the initial version of <code>move_add</code>?</p>



<a name="288399971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288399971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288399971">(Jul 04 2022 at 11:56)</a>:</h4>
<p>I suspect you ran into it in your original recursive version</p>



<a name="288415628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/288415628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#288415628">(Jul 04 2022 at 14:26)</a>:</h4>
<p>Should I look into how to make sure that the universe parameters are "preserved"?  I found <a href="https://leanprover-community.github.io/mathlib_docs/find/expr.instantiate_univ_params">docs#expr.instantiate_univ_params</a>, but have so far been unsuccessful at the instantiation.</p>



<a name="289096340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2313483%20%60move_add%60/near/289096340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2313483.20.60move_add.60.html#289096340">(Jul 10 2022 at 10:56)</a>:</h4>
<p>I have not been able to make progress with <code>ext_simplify_core</code>.  Would it make sense to merge <code>move_add</code> as is and leave the possible tightening as an on-going attempt?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>