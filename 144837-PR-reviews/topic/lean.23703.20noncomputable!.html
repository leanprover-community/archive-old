---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html">lean#703 noncomputable!</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="275605925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275605925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275605925">(Mar 17 2022 at 04:18)</a>:</h4>
<p>This is a PR to add the ability to completely turn off the noncomputability checker and the VM compiler.  There are two user-visible features: the <code>noncomputable!</code> modifier for definitions and the <code>noncomputable! theory</code> command (for when you <em>really</em> mean it).</p>
<p>The current <code>noncomputable theory</code> is sort of misleading in that it actually just causes Lean to ignore whether you applied <code>noncomputable</code> correctly. It still VM compiles things it thinks are computable.  To avoid this, you can do <code>noncomputable! theory</code> at the top of your file and never see another noncomputability checker or VM compilation error ever again.</p>
<p>I'm posting this message as an RFC, and there are some more details in the PR message at <a href="https://github.com/leanprover-community/lean/pull/703">lean#703</a>. I believe this is a completely reverse-compatible change.</p>



<a name="275605948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275605948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275605948">(Mar 17 2022 at 04:19)</a>:</h4>
<p>I don't think it would be a good idea to use this in mathlib, I think it will increase the number of VM error messages</p>



<a name="275606011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606011">(Mar 17 2022 at 04:20)</a>:</h4>
<p>plus this will be another thing to support in mathport, I'm not sure lean 4 has what we need</p>



<a name="275606111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606111">(Mar 17 2022 at 04:22)</a>:</h4>
<p>Why do you think it would increase the number of VM error messages? This causes declarations to be marked noncomputable in the environment, so nothing VM compiled could ever use them.</p>



<a name="275606121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606121">(Mar 17 2022 at 04:23)</a>:</h4>
<p>until you try to use anything from the file in the next file down</p>



<a name="275606122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606122">(Mar 17 2022 at 04:23)</a>:</h4>
<p>Regarding Lean 4, isn't <code>noncomputable!</code> equivalent to its <code>noncomputable</code>?</p>



<a name="275606129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606129">(Mar 17 2022 at 04:23)</a>:</h4>
<p>we need to support all three settings with this version</p>



<a name="275606178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606178">(Mar 17 2022 at 04:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!/near/275606121">said</a>:</p>
<blockquote>
<p>until you try to use anything from the file in the next file down</p>
</blockquote>
<p>How so?</p>



<a name="275606214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606214">(Mar 17 2022 at 04:25)</a>:</h4>
<p>For mathport, you can replace <code>noncomputable theory</code> with explicit <code>noncomputable</code>s, and all the information you need is in the noncomputability marking in the environment, I'm pretty sure.</p>



<a name="275606269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606269">(Mar 17 2022 at 04:26)</a>:</h4>
<p>synport does syntax porting, it does not do syntactic transformations like that unless they reflect the user's intent</p>



<a name="275606284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606284">(Mar 17 2022 at 04:26)</a>:</h4>
<p>What are you porting <code>noncomputable theory</code> to then?</p>



<a name="275606289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606289">(Mar 17 2022 at 04:26)</a>:</h4>
<p><code>noncomputable section</code> I believe</p>



<a name="275606311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606311">(Mar 17 2022 at 04:27)</a>:</h4>
<p>That means it's all completely not compiled, right? So if that behavior remains the same in Lean 4, both <code>noncomputable theory</code> and <code>noncomputable! theory</code> can become <code>noncomputable section</code></p>



<a name="275606373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606373">(Mar 17 2022 at 04:28)</a>:</h4>
<p>no, this works</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kn">section</span>

<span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="k">#eval</span> <span class="n">foo</span>
</code></pre></div>



<a name="275606381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606381">(Mar 17 2022 at 04:28)</a>:</h4>
<p>only the <code>noncomputable</code> modifier on defs forces noncomputable</p>



<a name="275606395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606395">(Mar 17 2022 at 04:29)</a>:</h4>
<p>I think that "don't compile anything in this section" is dangerous because tactics might want to create and compile auxiliary defs in a section</p>



<a name="275606464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606464">(Mar 17 2022 at 04:31)</a>:</h4>
<p><code>noncomputable</code> is also incompatible with <code>partial</code>/<code>unsafe</code></p>



<a name="275606482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606482">(Mar 17 2022 at 04:31)</a>:</h4>
<p>I'm still not sure what you're referring to about VM error messages</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- mod1.lean</span>
<span class="kd">noncomputable</span><span class="bp">!</span> <span class="kd">def</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="mi">37</span>

<span class="c1">-- mod2.lean</span>
<span class="kn">import</span> <span class="n">mod1</span>

<span class="k">#print</span> <span class="n">n</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">noncomputable def n : ℕ :=</span>
<span class="cm">37</span>
<span class="cm">-/</span>

<span class="kd">def</span> <span class="n">m</span> <span class="o">:=</span> <span class="n">n</span>
<span class="c">/-</span><span class="cm"> definition 'm' is noncomputable, it depends on 'n' -/</span>
</code></pre></div>



<a name="275606536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606536">(Mar 17 2022 at 04:32)</a>:</h4>
<p>I have occasionally hit issues with <code>noncomputable lemma foo := 1</code> definitions in old lean 3 (which is also essentially "force noncomputable")</p>



<a name="275606556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606556">(Mar 17 2022 at 04:33)</a>:</h4>
<p>luckily this pattern is used very rarely so it hasn't been a problem but I guess this will make it more common</p>



<a name="275606563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606563">(Mar 17 2022 at 04:33)</a>:</h4>
<p>The issue being that a thing that really should be computable has accidentally been marked noncomputable</p>



<a name="275606609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606609">(Mar 17 2022 at 04:34)</a>:</h4>
<p>it's very annoying to fix this when the thing is an auxiliary def</p>



<a name="275606628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606628">(Mar 17 2022 at 04:35)</a>:</h4>
<p>in fact I'm pretty sure all current issues with <code>noncomputable theory</code> not just working are of this form</p>



<a name="275606636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606636">(Mar 17 2022 at 04:35)</a>:</h4>
<p>What kinds of things happen when you have noncomputable lemmas?</p>



<a name="275606644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606644">(Mar 17 2022 at 04:35)</a>:</h4>
<p>Note that it's a noncomputable lemma which has a type which is data</p>



<a name="275606650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606650">(Mar 17 2022 at 04:35)</a>:</h4>
<p>i.e. the thing that you get linter warnings about</p>



<a name="275606703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606703">(Mar 17 2022 at 04:36)</a>:</h4>
<p>unfortunately I can't remember the details, but it is something along the lines of the VM not finding a definition it is supposed to</p>



<a name="275606764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606764">(Mar 17 2022 at 04:38)</a>:</h4>
<p>Can you give an example where <code>noncomputable!</code> is the right thing to do?</p>



<a name="275606861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606861">(Mar 17 2022 at 04:40)</a>:</h4>
<p>as far as I see it <code>noncomputable theory</code> is the correct option if you never want to think about computability</p>



<a name="275606878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606878">(Mar 17 2022 at 04:41)</a>:</h4>
<p>This is for people like <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> where they don't care if the VM compiler runs, and he's been reporting examples with timeout errors that as far as I can tell all come from exponential blowups in VM compiler preprocessing steps</p>



<a name="275606883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606883">(Mar 17 2022 at 04:41)</a>:</h4>
<p>maybe there are bugs in the implementation but spec-wise it has exactly the right semantics</p>



<a name="275606891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606891">(Mar 17 2022 at 04:41)</a>:</h4>
<p>They've been using <code>force_noncomputable</code> as a stop-gap</p>



<a name="275606899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606899">(Mar 17 2022 at 04:41)</a>:</h4>
<p>These are also things that they're never going to evaluate, so why waste cycles VM compiling them?</p>



<a name="275606903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606903">(Mar 17 2022 at 04:41)</a>:</h4>
<p>or checking whether they could be VM compiled?</p>



<a name="275606962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606962">(Mar 17 2022 at 04:43)</a>:</h4>
<p>Okay, that works for <code>noncomputable!</code> on an individual def but not a whole section</p>



<a name="275606967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606967">(Mar 17 2022 at 04:43)</a>:</h4>
<p>I would use it only when there is a definite gain</p>



<a name="275606981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275606981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275606981">(Mar 17 2022 at 04:43)</a>:</h4>
<p>and also fix the noncomputable checker to not be slow if that's the issue</p>



<a name="275607050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607050">(Mar 17 2022 at 04:44)</a>:</h4>
<p>You will also need a <code>computable!</code> modifier for when you want a computable def in a <code>noncomputable! theory</code> file, no?</p>



<a name="275607051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607051">(Mar 17 2022 at 04:45)</a>:</h4>
<p>Yeah, that's fair, and I'm not suggesting <code>noncomputable! theory</code> should be used in mathlib. The main feature here is the <code>noncomputable!</code> modifier, and I added the command since I was touching all this code anyway.</p>



<a name="275607056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607056">(Mar 17 2022 at 04:45)</a>:</h4>
<p>(flashbacks to CSS <code>!important</code>)</p>



<a name="275607288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607288">(Mar 17 2022 at 04:51)</a>:</h4>
<p>I still don't see why we care about finding opportunities to VM compile theoretical definitions.  Where would these ever be used?</p>
<p>Lean 4's noncomputability system seems to be much more robust, and it very likely <code>noncomputable!</code> and <code>noncomputable</code> could be translated to the same thing.</p>



<a name="275607308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607308">(Mar 17 2022 at 04:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!/near/275606981">said</a>:</p>
<blockquote>
<p>and also fix the noncomputable checker to not be slow if that's the issue</p>
</blockquote>
<p>The issue is that the definitions Kevin's shared are all computable, but the VM compiler is horrendously slow -- I poked around a bit, but it doesn't seem to be a good use of time trying to fix that.</p>



<a name="275607372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607372">(Mar 17 2022 at 04:53)</a>:</h4>
<p>If this is being used to better express intent in the code than I have no issues with adding these things. But I would not recommend <code>noncomputable! theory</code> to people who don't know the tradeoffs</p>



<a name="275607376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607376">(Mar 17 2022 at 04:53)</a>:</h4>
<p>As far as I can tell, neither <code>noncomputable!</code> nor <code>noncomputable! theory</code> affects auxiliary definitions. This is either a bug or a feature, I suppose.</p>



<a name="275607431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607431">(Mar 17 2022 at 04:54)</a>:</h4>
<p>that can be bad if an auxiliary definition refers to a user definition and everything in sight is noncomputable except the auxiliary</p>



<a name="275607462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607462">(Mar 17 2022 at 04:55)</a>:</h4>
<p>If it refers to the user definition, I think it will be marked noncomputable, too. They seem to be processed as if they were under <code>noncomputable theory</code>.</p>



<a name="275607512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607512">(Mar 17 2022 at 04:56)</a>:</h4>
<p>What might be a bug is that <code>noncomputable! theory</code> causes all lemmas to be marked noncomputable. Does that have any affect on anything?</p>



<a name="275607519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607519">(Mar 17 2022 at 04:56)</a>:</h4>
<p>lemmas are always noncomputable</p>



<a name="275607526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607526">(Mar 17 2022 at 04:56)</a>:</h4>
<p>like I said, <code>noncomputable lemma</code> is a way to get the effect of <code>noncomputable! def</code> in old lean 3</p>



<a name="275607527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607527">(Mar 17 2022 at 04:56)</a>:</h4>
<p>They're not marked noncomputable</p>



<a name="275607539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607539">(Mar 17 2022 at 04:57)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span><span class="bp">!</span>
<span class="kd">lemma</span> <span class="n">foo1</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span> <span class="n">trivial</span>

<span class="kd">lemma</span> <span class="n">foo2</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span> <span class="n">trivial</span>

<span class="k">#print</span> <span class="n">foo1</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">noncomputable theorem foo1 : true :=</span>
<span class="cm">trivial</span>
<span class="cm">-/</span>

<span class="k">#print</span> <span class="n">foo2</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">theorem foo2 : true :=</span>
<span class="cm">trivial</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="275607544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607544">(Mar 17 2022 at 04:57)</a>:</h4>
<p>well, it might put the modifier on but it doesn't have code</p>



<a name="275607620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607620">(Mar 17 2022 at 04:59)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">foo1</span> <span class="o">:</span> <span class="n">nat</span> <span class="o">:=</span> <span class="mi">1</span> <span class="c1">-- incorrectly marked as noncomputable, but proceeds anyway</span>
<span class="kd">lemma</span> <span class="n">foo2</span> <span class="o">:</span> <span class="n">nat</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">foo3</span> <span class="o">:</span> <span class="n">nat</span> <span class="o">:=</span> <span class="mi">1</span>

<span class="k">#eval</span> <span class="n">foo1</span> <span class="c1">-- no code</span>
<span class="k">#eval</span> <span class="n">foo2</span> <span class="c1">-- no code</span>
<span class="k">#eval</span> <span class="n">foo3</span> <span class="c1">-- 1</span>
</code></pre></div>



<a name="275607743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607743">(Mar 17 2022 at 05:00)</a>:</h4>
<p>I'm not talking about a modifier here, but the noncomputable mark in the environment. That's what the <code>#print</code> command checks when deciding to write <code>noncomputable</code>, and it's also what things like the noncomputability checker use, or the VM compiler when deciding when to compile something</p>



<a name="275607785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607785">(Mar 17 2022 at 05:01)</a>:</h4>
<p>This is the problem that occurs when the modifier does not match the presence of code:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">foo2</span> <span class="o">:</span> <span class="n">nat</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">foo3</span> <span class="o">:</span> <span class="n">nat</span> <span class="o">:=</span> <span class="n">foo2</span>
<span class="c1">-- failed to generate bytecode for 'foo3'</span>
<span class="c1">-- code generation failed, VM does not have code for 'test.foo2'</span>
</code></pre></div>



<a name="275607838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607838">(Mar 17 2022 at 05:02)</a>:</h4>
<p>I see no good reason for these to ever differ</p>



<a name="275607850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275607850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275607850">(Mar 17 2022 at 05:03)</a>:</h4>
<p>i.e. all lemmas which produce data should be marked <code>noncomputable</code></p>



<a name="275608155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275608155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275608155">(Mar 17 2022 at 05:10)</a>:</h4>
<p>That seems like it's a bug in the noncomputability checker -- it should be able to tell when a declaration has no value</p>



<a name="275608712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275608712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275608712">(Mar 17 2022 at 05:22)</a>:</h4>
<p>well, currently you can't actually put <code>noncomputable</code> on a lemma, it just ignores it. With your version you can, so we should probably be consistent about what it means</p>



<a name="275710930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275710930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275710930">(Mar 17 2022 at 19:07)</a>:</h4>
<p>For what it's worth, you <em>can</em> put <code>noncomputable</code> on a lemma, and it's not ignored:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.lattice</span>

<span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">Sup</span> <span class="n">set.univ</span>
</code></pre></div>
<p>This then correctly causes definitions that use it to need to be noncomputable as well:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo'</span> <span class="o">:=</span> <span class="n">foo</span>
<span class="c1">-- definition 'foo'' is noncomputable, it depends on 'foo'</span>
</code></pre></div>



<a name="275711518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275711518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275711518">(Mar 17 2022 at 19:12)</a>:</h4>
<p>I guess what should happen is that <code>get_noncomputable_reason</code> should check whether it's a theorem with data. It already lets through definitions/theorems whose type is a Prop, so it might just need to require it if it's a theorem</p>



<a name="275745008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275745008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275745008">(Mar 18 2022 at 00:06)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <a href="https://github.com/leanprover-community/lean/pull/704">lean#704</a> addresses the "code generation failed" error when you use a theorem that produces data by having non-Prop theorems be marked as noncomputable. It's more restrictive than necessary and could also allow other computationally irrelevant types, but this was easiest and mathlib's linters don't allow them anyway.</p>



<a name="275745145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/lean%23703%20noncomputable%21/near/275745145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/lean.23703.20noncomputable!.html#275745145">(Mar 18 2022 at 00:08)</a>:</h4>
<p>Somewhere along the way I saw a commit message by Leo from many years ago, when the noncomputability checker was mostly built, saying that we should refactor things to use the VM compiler to determine noncomputability, otherwise it will be this endless task of trying to keep the checker and the compiler in sync. That's what Lean 4 does now, right?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>