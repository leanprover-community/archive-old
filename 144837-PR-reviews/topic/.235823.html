---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.235823.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html">#5823</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="223455162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223455162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223455162">(Jan 21 2021 at 00:13)</a>:</h4>
<p>I just made a PR <a href="https://github.com/leanprover-community/mathlib/issues/5823">#5823</a> deleting a bunch of imports that are unneeded as they are imported transitively.<br>
Its rather huge (705 lines over 447 files) and I appreciate there may be differing opinions on whether this is useful, so I'd like to hear some comments / establish consensus before asking for review, splitting up, excluding some files or closing as necessary.</p>



<a name="223455666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223455666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223455666">(Jan 21 2021 at 00:20)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> made a few PRs like this a while back so there's precedent at least.</p>



<a name="223455704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223455704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223455704">(Jan 21 2021 at 00:20)</a>:</h4>
<p>cf. <a href="https://github.com/leanprover-community/mathlib/issues/3235">#3235</a> and <a href="https://github.com/leanprover-community/mathlib/issues/3421">#3421</a></p>



<a name="223456449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223456449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223456449">(Jan 21 2021 at 00:31)</a>:</h4>
<p>I'd argue this is actively harmful - it creates a lot of work when moving around files if I have to track down all the transitive includes that are now broken</p>



<a name="223456504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223456504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223456504">(Jan 21 2021 at 00:32)</a>:</h4>
<p>Vs finding just the direct includes</p>



<a name="223456542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223456542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223456542">(Jan 21 2021 at 00:32)</a>:</h4>
<p>It's almost tempting to try a script that does the reverse</p>



<a name="223456599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223456599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223456599">(Jan 21 2021 at 00:33)</a>:</h4>
<p>I'm happy to be convinced I'm wrong though - my instinct is based on how things are in C++, which might not be a good match</p>



<a name="223456737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223456737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223456737">(Jan 21 2021 at 00:36)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> can you give an example, if one simply wants to rename a file this would result in less work if there are as few explicit references to that filename as possible.</p>



<a name="223456936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223456936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223456936">(Jan 21 2021 at 00:38)</a>:</h4>
<p>Ah, I guess I mean when splitting files in two then</p>



<a name="223457347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223457347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223457347">(Jan 21 2021 at 00:45)</a>:</h4>
<p>I'll try to come up with an example tomorrow</p>



<a name="223457399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223457399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223457399">(Jan 21 2021 at 00:46)</a>:</h4>
<p>I argued against this sort of change at <a href="#narrow/stream/113488-general/topic/unnecessary.20imports/near/195077370">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/unnecessary.20imports/near/195077370</a></p>



<a name="223457419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223457419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223457419">(Jan 21 2021 at 00:46)</a>:</h4>
<p>Updating references to a renamed file is trivial; what's not trivial is trying to figure out what file contains a simp lemma or instance that was implicitly relied upon</p>



<a name="223459060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223459060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223459060">(Jan 21 2021 at 01:14)</a>:</h4>
<p>Thanks, I had a feeling this had been discussed before, but couldn't find the thread / Pr. Those are interesting points.<br>
My main motivation was that I wanted to reduce visual clutter in the top of files I've written where I have &gt;= 7 imports because I've copy pasted all sorts of junk in, so I'm not necessarily attached to or arguing for merging this PR either.<br>
I wonder how common these semantically unnecessary imports you talk about are though?<br>
In the example you gave there wouldn't "if C broke when you deleted <code>import A</code> from B add <code>import A</code> to C" be an easy thing to fix , or am I missing something here? I guess if you made a bunch of these changes at once and only then tried to build your project it would be a bit more of a mess, but I don't know how common that is either.</p>



<a name="223459519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223459519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223459519">(Jan 21 2021 at 01:23)</a>:</h4>
<p>The script is PRd at <a href="https://github.com/leanprover-community/mathlib-tools/issues/92">mathlib-tools#92</a></p>



<a name="223469837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223469837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223469837">(Jan 21 2021 at 04:47)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span> whether or not the PR is merged, the script is definitely useful! Because I sometimes don't want to bother with thinking about imports, so I just import some huge files in mathlib. Having a script minimize those will be very helpful.</p>



<a name="223470055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223470055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223470055">(Jan 21 2021 at 04:53)</a>:</h4>
<p>Unfortunately this doesn't do the far more useful thing of replacing imports that are unused by ones higher up the import tree, though I would also like to give that a go at some point <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="223470120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/223470120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#223470120">(Jan 21 2021 at 04:54)</a>:</h4>
<p>aah, I see. I thought it was doing that.</p>



<a name="225277181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/225277181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#225277181">(Feb 05 2021 at 09:36)</a>:</h4>
<p>In principle I think it's possible to automate the desired cleanup, without any fancy meta-analysis. For each import <code>X</code>, you see if the file still compiles if you replace <code>X</code> with <code>X</code>'s own imports. If it does, you then compile the rest of mathlib, inserting <code>import X</code> into any file which now breaks. Now repeat as often as you have patience for.</p>
<p>In practice a human can do this so much more efficiently than such a dumb script, that it's unclear it's worth attempting.</p>
<p>The "clever" approach of actually analysing a file to determine its true imports (e.g. by enumerating all the identifiers appearing in it and working out where they originate) sounds pretty intimidating with what we have in Lean 3.</p>



<a name="245795923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/245795923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#245795923">(Jul 13 2021 at 09:01)</a>:</h4>
<p>I'm currently cleaning up the analysis import file on <span class="user-mention" data-user-id="260507">@Heather Macbeth</span>'s suggestion and this tool would actually be quite useful because waiting for each file to build is a pain.</p>



<a name="245796358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/245796358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#245796358">(Jul 13 2021 at 09:05)</a>:</h4>
<p>I assume by "this tool" you mean the one Scott proposes, and not the tool in the referenced PR?</p>



<a name="245796831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/245796831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#245796831">(Jul 13 2021 at 09:10)</a>:</h4>
<p>Yeah, Scott's one, although James' one would already be great.</p>



<a name="245798854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%235823/near/245798854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.235823.html#245798854">(Jul 13 2021 at 09:26)</a>:</h4>
<p>I've been using Scott's algorithm by hand so far.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>