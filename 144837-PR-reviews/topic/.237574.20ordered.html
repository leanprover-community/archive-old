---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.237574.20ordered.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html">#7574 ordered</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="238261826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238261826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238261826">(May 11 2021 at 07:13)</a>:</h4>
<p>Dear All,</p>
<p>I just created the latest iteration of the refactoring of the <code>ordered</code> hierarchy (PR <a href="https://github.com/leanprover-community/mathlib/issues/7574">#7574</a>).  While there is still room for weakening of assumptions, I believe that the current level already shows a good balance between flexibility and usability.</p>
<p>Of course, any comments are welcome!  I plan to weaken further assumptions on <code>ordered</code> classes, but have decided that this is a good point for really attempting at getting this PR merged.</p>
<p>As mentioned, this is the third iteration.  The previous ones are <a href="https://github.com/leanprover-community/mathlib/issues/7371">#7371</a> and <a href="https://github.com/leanprover-community/mathlib/issues/7396">#7396</a>.  I plan to close those PRs soon, since all that I have learned from them and from the comments is implemented in the current one.</p>



<a name="238262107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238262107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238262107">(May 11 2021 at 07:16)</a>:</h4>
<p>The main guiding principle is that "technical" lemmas are proven with separate assumptions:</p>
<ul>
<li>an assumption on what properties the operation has (the operation is currently add or mul);</li>
<li>an assumption on what kind of order there is (e.g. <code>preorder</code>, <code>partial_order</code>, <code>linear_order</code>,...);</li>
<li>a mix of the two in the form of some kind of monotonicity is assumed (these follow a general pattern of <code>covariant</code> and <code>contravariant</code> definitions that are part of this PR).</li>
</ul>



<a name="238262212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238262212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238262212">(May 11 2021 at 07:17)</a>:</h4>
<p>On top of those technical lemmas, there are more "standard" lemmas that only assume a single typeclass, such as <code>linear_ordered_comm_group_with_zero</code>, that fixes all three parameters "in the background".</p>



<a name="238305826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238305826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238305826">(May 11 2021 at 13:22)</a>:</h4>
<p>Dear All,</p>
<p>it seems that this PR is breaking something structural and I do not know what to do.  CI came with this error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Error</span><span class="o">:</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">runner</span><span class="bp">/</span><span class="n">work</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">test</span><span class="bp">/</span><span class="n">norm_num.lean</span><span class="o">:</span><span class="mi">49</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span>
<span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid</span> <span class="n">ℤ</span> <span class="n">_</span>
<span class="n">term</span>
  <span class="bp">@</span><span class="n">norm_num.lt_one_bit0</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_comm_ring.to_linear_ordered_semiring</span> <span class="n">ℤ</span> <span class="n">int.linear_ordered_comm_ring</span><span class="o">)</span> <span class="mi">1</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">le_refl</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">directed_order.to_preorder</span> <span class="n">ℤ</span> <span class="o">(</span><span class="bp">@</span><span class="n">linear_order.to_directed_order</span> <span class="n">ℤ</span> <span class="n">int.linear_order</span><span class="o">))</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="mi">1</span> <span class="bp">&lt;</span> <span class="mi">2</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">add_group</span> <span class="n">ℤ</span>
<span class="n">Error</span><span class="o">:</span> <span class="n">Process</span> <span class="n">completed</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span><span class="bp">.</span>
</code></pre></div>



<a name="238305964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238305964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238305964">(May 11 2021 at 13:23)</a>:</h4>
<p>In previous runs, I had noticed that <code>norm_num</code> caused some funny behaviour and I replaced <code>norm_num</code> proofs with actual explicit proofs and that solved the issue.  But now, it seems that Lean really wants to get to the bottom of this and I do not know what I did to break this...</p>



<a name="238306071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238306071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238306071">(May 11 2021 at 13:24)</a>:</h4>
<p>I am really at a loss: what should I do, now that tests are failing?  <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>
<p>Direct link to error:</p>
<p><a href="https://github.com/leanprover-community/mathlib/pull/7574/checks?check_run_id=2555528374">https://github.com/leanprover-community/mathlib/pull/7574/checks?check_run_id=2555528374</a></p>



<a name="238308580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238308580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238308580">(May 11 2021 at 13:39)</a>:</h4>
<p>Did you change the parameters to <code>neg_lt_neg</code>? From my understanding of <code>norm_num</code>, it looks like the error occurs <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/norm_num.lean#L480">here</a>. I suspect <code>norm_num</code> should be updated to handle the changed parameters.</p>



<a name="238309194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238309194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238309194">(May 11 2021 at 13:42)</a>:</h4>
<p>I did not change <code>neg_lt_neg</code>, certainly not intentionally, and, I think, also not unintentionally...</p>



<a name="238309254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238309254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238309254">(May 11 2021 at 13:43)</a>:</h4>
<p>Also, which parameters are those?  I introduced more typeclasses, but I did not do funny things with the old ones...</p>



<a name="238309491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238309491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238309491">(May 11 2021 at 13:44)</a>:</h4>
<p>Anne, looking at the link that you gave, I had to fix a broken proof in a <code>match</code> environment.  I had never used that, but now you make me wonder that this might be the issue?</p>



<a name="238309787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238309787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238309787">(May 11 2021 at 13:46)</a>:</h4>
<p>I meant the new typeclass parameters that you introduced, so yes, <code>neg_lt_neg</code> does have different parameters now :)</p>



<a name="238309987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238309987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238309987">(May 11 2021 at 13:48)</a>:</h4>
<p>What's going on is that this call to <code>ic.mk_app</code> fills in only one typeclass parameter, which used to work when it was just <code>[ordered_add_group α]</code>. But now it's <code>[add_group α] [preorder α] [has_add_lt_add_left α] [has_add_lt_add_right α]</code></p>



<a name="238310019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310019">(May 11 2021 at 13:48)</a>:</h4>
<p>I am trying to understand, but I am failing.  Though, maybe I am starting!  This should come from a <code>inv_lt_inv</code>, via <code>to_additive</code>, right?</p>



<a name="238310100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310100">(May 11 2021 at 13:48)</a>:</h4>
<p>Ok, I am getting there, slowly!</p>



<a name="238310127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310127">(May 11 2021 at 13:48)</a>:</h4>
<p>Yes, and a bit higher up you have the <code>variables [has_mul_lt_mul_left α] [has_mul_lt_mul_right α]</code> line, which adds these parameters to all the theorems below</p>



<a name="238310139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310139">(May 11 2021 at 13:48)</a>:</h4>
<p>so, should I simply go to the test file and make it work, as I would a normal file?</p>



<a name="238310228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310228">(May 11 2021 at 13:49)</a>:</h4>
<p>(this is probably a silly question, but in my mind, tests were "outside my reach"!)</p>



<a name="238310278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310278">(May 11 2021 at 13:49)</a>:</h4>
<p>Not really: the test file tells us when there's something broken inside <code>norm_num</code>, so we'll have to fix the tactic.</p>



<a name="238310372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310372">(May 11 2021 at 13:50)</a>:</h4>
<p>Ah, ok.  So, I will give a try to fixing norm_num...</p>



<a name="238310434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310434">(May 11 2021 at 13:50)</a>:</h4>
<p>(although this seems like something that will require someone else's help!)</p>



<a name="238310522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310522">(May 11 2021 at 13:50)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> wrote most of this code</p>



<a name="238310868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310868">(May 11 2021 at 13:53)</a>:</h4>
<p>Summary of my diagnosis for Mario: <code>instance_cache.mk_app</code> only fills in one typeclass parameter, but now the theorems used by <code>norm_num</code> require multiple typeclass parameters. What is the best way to fix this?</p>



<a name="238310903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238310903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238310903">(May 11 2021 at 13:53)</a>:</h4>
<p>is there a mwe?</p>



<a name="238311039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311039">(May 11 2021 at 13:54)</a>:</h4>
<p>I would prefer for there to be only one typeclass for efficiency reasons. Can the necessary typeclasses be bundled into one composite?</p>



<a name="238311055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311055">(May 11 2021 at 13:54)</a>:</h4>
<p>Mario, I can dig out one of the fixes where I removed a norm_num, if you want.</p>



<a name="238311126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311126">(May 11 2021 at 13:54)</a>:</h4>
<p>Is this what you are asking?  I am really unsure about much of this conversation...</p>



<a name="238311128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311128">(May 11 2021 at 13:54)</a>:</h4>
<p>Did you modify the norm_num lemmas?</p>



<a name="238311167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311167">(May 11 2021 at 13:54)</a>:</h4>
<p>I do not think that I did... I only worked "inside" mathlib...</p>



<a name="238311284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311284">(May 11 2021 at 13:55)</a>:</h4>
<p>There are a number of lemmas called by <code>norm_num</code> that got changed, but nothing inside the <code>tactic/norm_num.lean</code> file AFAICT</p>



<a name="238311316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311316">(May 11 2021 at 13:56)</a>:</h4>
<p>there are a couple regular lemmas that norm_num uses too</p>



<a name="238311372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311372">(May 11 2021 at 13:56)</a>:</h4>
<p>which of them changed and how?</p>



<a name="238311547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311547">(May 11 2021 at 13:57)</a>:</h4>
<p>Ok, so, I found an example of a proof that I changed so that it would not use norm_num: this one</p>
<p><a href="https://github.com/leanprover-community/mathlib/pull/7574/commits/48b19fffacde0f99e0498b38b25a42fc7e08c318">https://github.com/leanprover-community/mathlib/pull/7574/commits/48b19fffacde0f99e0498b38b25a42fc7e08c318</a></p>



<a name="238311703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311703">(May 11 2021 at 13:58)</a>:</h4>
<p>I do not remember going into <code>tactic</code>.</p>



<a name="238311798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311798">(May 11 2021 at 13:58)</a>:</h4>
<p>No, I mean regular theorems that changed their signature</p>



<a name="238311866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311866">(May 11 2021 at 13:59)</a>:</h4>
<p>the tactic is using a lemma like <code>neg_le_neg</code> and expecting that it has a particular signature</p>



<a name="238311989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238311989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238311989">(May 11 2021 at 13:59)</a>:</h4>
<p>A signature is the statement of the theorem?</p>
<p>I am finding some lemmas tagged with <code>norm_cast</code> whose assumptions I revised</p>



<a name="238312014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312014">(May 11 2021 at 14:00)</a>:</h4>
<p>yes</p>



<a name="238312033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312033">(May 11 2021 at 14:00)</a>:</h4>
<p>(mostly their typeclasses, I think)</p>



<a name="238312099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312099">(May 11 2021 at 14:00)</a>:</h4>
<p>typeclass changes count</p>



<a name="238312120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312120">(May 11 2021 at 14:00)</a>:</h4>
<p>Ok, so some statements that are tagged <code>norm_cast</code> have been changed due to this, certainly.</p>



<a name="238312128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312128">(May 11 2021 at 14:00)</a>:</h4>
<p>norm_cast is not relevant to norm_num</p>



<a name="238312234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312234">(May 11 2021 at 14:00)</a>:</h4>
<p>the relevant lemmas are not tagged or anything, they are referred to by name in <code>tactic/norm_num</code></p>



<a name="238312244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312244">(May 11 2021 at 14:00)</a>:</h4>
<p>I am failing to find <code>norm_num</code> tags, but they might be there: I simply did not pay attention to those, I simply left the tags alone.</p>



<a name="238312315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312315">(May 11 2021 at 14:01)</a>:</h4>
<p>ah, ok, so let me find out the list and which ones have been changed!</p>



<a name="238312356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238312356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238312356">(May 11 2021 at 14:01)</a>:</h4>
<p>(likely quite a few, since the changes happen at the very early lemmas on inequalities...)</p>



<a name="238313218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238313218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238313218">(May 11 2021 at 14:06)</a>:</h4>
<p>sorry for the long stream of questions, but I have never looked carefully at any tactic.  I extracted this from <code>tactic/norm_num</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Given `a` a rational numeral, returns `⊢ 1 ≤ a`. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">prove_nonneg</span> <span class="o">(</span><span class="n">ic</span> <span class="o">:</span> <span class="n">instance_cache</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">instance_cache</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">e</span><span class="bp">@`</span><span class="o">(</span><span class="n">has_zero.zero</span><span class="o">)</span> <span class="o">:=</span> <span class="n">ic.mk_app</span> <span class="bp">``</span><span class="n">le_refl</span> <span class="o">[</span><span class="n">e</span><span class="o">]</span>
<span class="bp">|</span> <span class="n">e</span> <span class="o">:=</span>
  <span class="k">if</span> <span class="n">ic.α</span> <span class="bp">=</span> <span class="bp">`</span><span class="o">(</span><span class="n">ℕ</span><span class="o">)</span> <span class="k">then</span>
    <span class="n">return</span> <span class="o">(</span><span class="n">ic</span><span class="o">,</span> <span class="bp">`</span><span class="o">(</span><span class="n">nat.zero_le</span><span class="o">)</span><span class="bp">.</span><span class="n">mk_app</span> <span class="o">[</span><span class="n">e</span><span class="o">])</span>
  <span class="k">else</span> <span class="k">do</span>
    <span class="o">(</span><span class="n">ic</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span> <span class="bp">←</span> <span class="n">prove_pos</span> <span class="n">ic</span> <span class="n">e</span><span class="o">,</span>
    <span class="n">ic.mk_app</span> <span class="bp">``</span><span class="n">nonneg_pos</span> <span class="o">[</span><span class="n">e</span><span class="o">,</span> <span class="n">p</span><span class="o">]</span>
</code></pre></div>
<p>I interpret the last line as saying that <code>nonneg_pos</code> is implied.  Is this what I should be looking out for?<br>
<del>I am almost certain that I have changed the assumptions on <code>nonneg_pos</code>.</del>  Ok, I did not touch this, there was a lemma with a similar, but different, name.</p>



<a name="238314137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314137">(May 11 2021 at 14:11)</a>:</h4>
<p><code>has_zero.zero</code>, <code>zero_mul</code>, <code>mul_zero</code>, <code>mul_one</code>, <code>one_mul</code>, <code>bit0_pos</code>, <code>bit1_pos'</code>, <code>div_pos</code>, <code>nat.zero_le</code>, <code>neg_lt_neg</code>, <code>neg_neg_of_pos</code>, <code>neg_le_neg</code>, <code>neg_nonpos_of_nonneg</code>, <code>ne_of_lt</code>, <code>ne_of_gt</code>, <code>rat.cast_zero</code>, <code>rat.cast_one</code>, <code>has_div.div</code>, <code>has_neg.neg</code>, <code>has_one.one</code>, <code>neg_neg</code>, <code>neg_zero</code>, <code>sub_zero</code>, <code>pow_zero</code>, <code>pow_one</code>, <code>lt_irrefl</code>, <code>not_lt_of_gt</code>, <code>le_refl</code>, <code>not_le_of_gt</code>, <code>has_lt.lt</code>, <code>has_le.le</code></p>



<a name="238314142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314142">(May 11 2021 at 14:11)</a>:</h4>
<p>The last line means "given the instance cache  <code>ic</code> and proof <code>p</code> that we've fetched using <code>prove_pos</code>, construct the proof that <code>nonneg_pos</code> implies, using the expression <code>e</code> that we are carrying around"</p>



<a name="238314185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314185">(May 11 2021 at 14:11)</a>:</h4>
<p>those are the lemmas used by norm_num that are not in the norm_num file</p>



<a name="238314242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314242">(May 11 2021 at 14:12)</a>:</h4>
<p>any changes to them could break norm_num</p>



<a name="238314249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314249">(May 11 2021 at 14:12)</a>:</h4>
<p>Ok, I have just found an example: <code>neg_neg_of_pos</code> has changed.</p>



<a name="238314285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314285">(May 11 2021 at 14:12)</a>:</h4>
<p>can you make your change the primed version?</p>



<a name="238314411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314411">(May 11 2021 at 14:13)</a>:</h4>
<p>At the moment, I replaced the lemmas with the weaker assumptions.  I can duplicate all lemmas, if this is what is preferred.</p>



<a name="238314458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314458">(May 11 2021 at 14:13)</a>:</h4>
<p>then again, this is also possibly evidence that tactics like norm_num should make local aliases of all lemmas they intend to use</p>



<a name="238314562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314562">(May 11 2021 at 14:14)</a>:</h4>
<p>what is the change?</p>



<a name="238314613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314613">(May 11 2021 at 14:14)</a>:</h4>
<p>I can certainly use primes, however, my intention was to weaken the assumption of existing lemmas, not adding further lemmas whose assumptions are weaker and then prove the earlier lemmas as applications of the weaker ones...</p>



<a name="238314678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314678">(May 11 2021 at 14:14)</a>:</h4>
<p>If there are more typeclasses then it is a potential performance issue</p>



<a name="238314694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314694">(May 11 2021 at 14:14)</a>:</h4>
<p>If I am correct, the new lemmas have a subset of the assumptions, but they are bundled differently.</p>



<a name="238314797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314797">(May 11 2021 at 14:15)</a>:</h4>
<p>It will be a lot more work to have to prove that in a given context this type is both an add_left thing and and add_right thing</p>



<a name="238314853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314853">(May 11 2021 at 14:15)</a>:</h4>
<p>I don't know what you've actually changed though so I'm making things up</p>



<a name="238314923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314923">(May 11 2021 at 14:16)</a>:</h4>
<p>if you want, I can be more specific about the changes.</p>



<a name="238314952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314952">(May 11 2021 at 14:16)</a>:</h4>
<p>could you <code>#print neg_neg_of_pos</code></p>



<a name="238314970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238314970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238314970">(May 11 2021 at 14:16)</a>:</h4>
<p>before and after</p>



<a name="238315023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238315023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238315023">(May 11 2021 at 14:16)</a>:</h4>
<p>actually here's the before</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">neg_neg_of_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">ordered_add_comm_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">},</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">-</span><span class="n">a</span> <span class="bp">&lt;</span> <span class="mi">0</span> <span class="o">:=</span>
</code></pre></div>



<a name="238315319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238315319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238315319">(May 11 2021 at 14:18)</a>:</h4>
<p>This is the after:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">neg_neg_of_pos</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_3</span> <span class="o">:</span> <span class="n">has_add_lt_add_left</span> <span class="n">α</span><span class="o">],</span>
  <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">-</span><span class="n">a</span> <span class="bp">&lt;</span> <span class="mi">0</span> <span class="o">:=</span>
</code></pre></div>



<a name="238315402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238315402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238315402">(May 11 2021 at 14:19)</a>:</h4>
<p>The new typeclasses are subsets of the old ones and they do not cover all the old ones, just pick out some of them.</p>



<a name="238315743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238315743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238315743">(May 11 2021 at 14:21)</a>:</h4>
<p>(for instance, <code>ordered_add_comm_group</code> contains <code>add_comm</code> which is not implied by any of the later ones.)</p>



<a name="238315780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238315780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238315780">(May 11 2021 at 14:21)</a>:</h4>
<p>True, but does it matter?</p>



<a name="238315910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238315910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238315910">(May 11 2021 at 14:22)</a>:</h4>
<p>I do not know that it matters: I have changed some proofs, but the "mathematical formula" should be the same...</p>



<a name="238316006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316006">(May 11 2021 at 14:23)</a>:</h4>
<p>I mean using all the axioms piecemeal like this is much more expensive than having everything bundled into one typeclass</p>



<a name="238316068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316068">(May 11 2021 at 14:23)</a>:</h4>
<p>you have to run every typeclass search three times</p>



<a name="238316149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316149">(May 11 2021 at 14:24)</a>:</h4>
<p>and in case you were not aware typeclass search is one of the biggest performance issues in mathlib</p>



<a name="238316216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316216">(May 11 2021 at 14:24)</a>:</h4>
<p>Ah, for instance, this allows to have lemmas on ordered stuff without having them commutative, for instance.  This is something that is useful, and not done at the moment in lean.</p>



<a name="238316246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316246">(May 11 2021 at 14:24)</a>:</h4>
<p>Since typeclasses are cached I don't know whether it makes a real difference in terms of performance?</p>



<a name="238316291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316291">(May 11 2021 at 14:24)</a>:</h4>
<p>they are cached until they have to be searched again</p>



<a name="238316320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316320">(May 11 2021 at 14:25)</a>:</h4>
<p>Ok, I have no idea of what the expensive things are in mathlib, so I certainly defer to you to the performance of these changes!</p>



<a name="238316329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316329">(May 11 2021 at 14:25)</a>:</h4>
<p>the cache doesn't last that long</p>



<a name="238316363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316363">(May 11 2021 at 14:25)</a>:</h4>
<p>The cache lasts for a whole proof, no?</p>



<a name="238316391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316391">(May 11 2021 at 14:25)</a>:</h4>
<p>okay, mathlib has many proofs</p>



<a name="238316424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316424">(May 11 2021 at 14:25)</a>:</h4>
<p>also <code>haveI</code> clears the cache</p>



<a name="238316510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316510">(May 11 2021 at 14:26)</a>:</h4>
<p>Ok, so I can certainly argue that mathematically there is value in picking your own assumptions on commutativity/left/right/ orders.  Whether this is implementable in Lean in a performing way, I do not know...</p>



<a name="238316584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316584">(May 11 2021 at 14:26)</a>:</h4>
<p>Sure, but most proofs don't have <code>haveI</code>. I am not claiming it's not creating a performance problem, I'm just saying it's not obvious to me if it really does.</p>



<a name="238316586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316586">(May 11 2021 at 14:26)</a>:</h4>
<p>What I would like to know is what the motivation is, besides reverse mathematics</p>



<a name="238316685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316685">(May 11 2021 at 14:27)</a>:</h4>
<p>yes you can just take the absolute minimal assumptions for everything but specifying minimal assumptions is a lot more complicated than using generic classes</p>



<a name="238316728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316728">(May 11 2021 at 14:27)</a>:</h4>
<p>Left/right/bi/ordered groups are fairly studied, especially in the geometric group theory community, for instance.</p>



<a name="238316911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316911">(May 11 2021 at 14:28)</a>:</h4>
<p>If it is only used by a small subcommunity then that would be a good candidate for a primed lemma</p>



<a name="238316949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238316949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238316949">(May 11 2021 at 14:28)</a>:</h4>
<p>Just for my understanding, a small number of typeclass assumptions (even with many fields) is better than many typeclasses assumptions (with fewer combined fields)?</p>



<a name="238317059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317059">(May 11 2021 at 14:29)</a>:</h4>
<p>yes, although defeq of different paths to the same typeclass is also expensive</p>



<a name="238317081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317081">(May 11 2021 at 14:29)</a>:</h4>
<p>Damiano, what was the original reason you embarked on this refactor? Was there some actual mathematics which was inconvenient to do in Lean as it is right now?</p>



<a name="238317398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317398">(May 11 2021 at 14:31)</a>:</h4>
<p>At the moment, it was informed by the possibility of applying these lemmas with not necessarily commutative rings, but I had not started doing anything with it.</p>
<p>Also, note that I do not mind using primes for the lemmas that Mario mentioned above.  I am trying to understand a bit of how lean works, so that in the future I may not be taking similar wrong paths!</p>



<a name="238317595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317595">(May 11 2021 at 14:32)</a>:</h4>
<p>So can you give an explicit example of a statement involving noncommutative rings which is not possible to do right now in Lean?</p>



<a name="238317606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317606">(May 11 2021 at 14:32)</a>:</h4>
<p>Specifically, I had been trying to prove a lemma for the nnreals, but the needed lemmas were not accessible, so I decided to make them work!</p>



<a name="238317641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317641">(May 11 2021 at 14:33)</a>:</h4>
<p>But nnreal is commutative?</p>



<a name="238317674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317674">(May 11 2021 at 14:33)</a>:</h4>
<p>I'm only following this at a distance but I wouldn't call this a "wrong path". At worst this sort of effort is exactly how we learn what works best etc.</p>



<a name="238317734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317734">(May 11 2021 at 14:33)</a>:</h4>
<p>With time, I can find an example in nnreal, but for non-commutative, anything involving orders is out of the question.</p>



<a name="238317813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317813">(May 11 2021 at 14:33)</a>:</h4>
<p>can you be more precise?</p>



<a name="238317879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317879">(May 11 2021 at 14:34)</a>:</h4>
<p>I mean, write down a mathematical statement which is somehow problematic in Lean?</p>



<a name="238317886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317886">(May 11 2021 at 14:34)</a>:</h4>
<p>Here is a reference that was shown to me when I brought this up earlier:<br>
<a href="https://hal.archives-ouvertes.fr/hal-02872310/document">https://hal.archives-ouvertes.fr/hal-02872310/document</a></p>



<a name="238317986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238317986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238317986">(May 11 2021 at 14:34)</a>:</h4>
<p>Notice that these results are provable in Lean, and this is why I had started this refactor! <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="238318056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318056">(May 11 2021 at 14:35)</a>:</h4>
<p>Can you name a precise result rather than just linking to a paper? I'm still trying to understand what the exact problem is.</p>



<a name="238318258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318258">(May 11 2021 at 14:36)</a>:</h4>
<p>At the moment, there is no typeclass expressing the fact that a non-commutative group has an order and multiplication is left-monotone.  So giving this example is tricky.</p>



<a name="238318311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318311">(May 11 2021 at 14:36)</a>:</h4>
<p>Would Proposition 2.2 of the link work as an example?</p>



<a name="238318386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318386">(May 11 2021 at 14:37)</a>:</h4>
<p>I can certainly formulate the statement without using typeclasses, though.</p>



<a name="238318444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318444">(May 11 2021 at 14:37)</a>:</h4>
<p>So the issue is that for some reason you cannot make the relevant typeclass? I still don't understand</p>



<a name="238318450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318450">(May 11 2021 at 14:37)</a>:</h4>
<p>just like you can always explicitly copy the fields in as assumptions.  I would not consider this a good solution, though.</p>



<a name="238318657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318657">(May 11 2021 at 14:38)</a>:</h4>
<p>To prove these results, I would like to use lemmas like if you multiply by the inverse on the left an inequality, the inequality still holds.  This lemma has the same proof as the one with the commutativity assumption, but would have to be reproven to work without assuming commutativity.</p>



<a name="238318818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318818">(May 11 2021 at 14:39)</a>:</h4>
<p>So yes, I would like to use the order API that already exists, but remove unused assumptions, so that it applies to noncommutative groups (or even commutative groups with zero, which is tricky at the moment, even in the presence of a linear order).</p>



<a name="238318939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238318939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238318939">(May 11 2021 at 14:40)</a>:</h4>
<p>so the proposal is to make a bunch of new typeclasses, but to keep the old typeclasses?</p>



<a name="238319080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238319080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238319080">(May 11 2021 at 14:41)</a>:</h4>
<p>I had initially proposed introducing only two typeclasses are removing <em>all</em> <code>ordered_...</code> ones.  However, I have been told that this was not the way to go, but introducing more typeclasses was better.</p>



<a name="238319130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238319130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238319130">(May 11 2021 at 14:41)</a>:</h4>
<p>If so, you can just not mess with Mario's lemmas like <code>neg_neg_of_pos</code>, and make your own versions but called <code>neg_neg_of_pos'</code> with your more general assumptions.</p>



<a name="238319307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238319307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238319307">(May 11 2021 at 14:42)</a>:</h4>
<p>I can get all the flexibility needed introducing only 2 typeclasses, and removing everything that has an <code>order_</code> in.  The cost is that I would need to use more typeclasses simultaneously.  At the moment, the largest number of typeclass assumptions that I have seen is 5.</p>



<a name="238319310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238319310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238319310">(May 11 2021 at 14:42)</a>:</h4>
<p>and then the tests will start working again</p>



<a name="238319419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238319419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238319419">(May 11 2021 at 14:42)</a>:</h4>
<p>Sure, this is certainly something that I can and intend to do!  <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
<p>I was simply trying to get more into the mechanics of this, to understand what was going on!</p>



<a name="238319702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238319702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238319702">(May 11 2021 at 14:44)</a>:</h4>
<p>Anyway, I think that I understand better why the test broke, what the issue is and that it can be fixed easily by simply changing a name!</p>
<p>At the beginning of this thread, I did not know that this was the case, so I am much happier now!</p>



<a name="238322124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238322124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238322124">(May 11 2021 at 14:59)</a>:</h4>
<p>If there is still some interest left in this conversation, these are the lemmas that appear to use the new typeclasses and that I will now replace with primed versions:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">neg_lt_neg</span>
<span class="n">neg_neg_of_pos</span>
<span class="n">neg_le_neg</span>
<span class="n">neg_nonpos_of_nonneg</span>
</code></pre></div>



<a name="238423714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238423714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238423714">(May 12 2021 at 05:36)</a>:</h4>
<p>As an update, the current commit was successfully built by CI!</p>



<a name="238616747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238616747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238616747">(May 13 2021 at 12:53)</a>:</h4>
<p>Dear All,</p>
<p>Jannis kindly timed the two proposed ordered refactors against the same version of master from which they branched.  The results are here:</p>
<ul>
<li>
<p><code>master</code>:<br>
a7e1696f5b1bd29f1575d99162e9f80141b28e4c: 2h15m49s/2h16m15s</p>
</li>
<li>
<p>refactor with 16 new typeclasses:<br>
88d6a72d98b13d5bcae1a4560260cae17f60d309: 2h17m16s/2h16m3s</p>
</li>
<li>
<p>refactor with two new typeclasses:<br>
03b502c386905abef9892d59d09c36220c04a0da: 2h12m28s</p>
</li>
</ul>
<p>(this is a link to the actual conversation:<br>
<a href="#narrow/stream/113488-general/topic/performance.20of.20ordered.20refactor/near/238609226">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/performance.20of.20ordered.20refactor/near/238609226</a>)</p>
<p>The results seem to show that, marginally, the refactor with two new typeclasses performs better than <code>master</code>.  Thus, I would like to go on with that one.</p>
<p>Is there any reason not to?  Anything else that I might have overlooked?</p>
<p>In the long run, I could even see that the <code>ordered_</code> typeclasses might disappear (at least some of them), giving way to simply mixing assumptions as needed.  This would not be part of the current refactor anyway.</p>



<a name="238617987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238617987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238617987">(May 13 2021 at 13:05)</a>:</h4>
<p>For ease of reference, these are the two refactors:</p>
<ul>
<li>PR <a href="https://github.com/leanprover-community/mathlib/issues/7371">#7371</a> - the "fast" one, with two new typeclasses</li>
<li>PR <a href="https://github.com/leanprover-community/mathlib/issues/7574">#7574</a> - the "slow" one, with 16 new typeclasses</li>
</ul>



<a name="238624992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238624992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238624992">(May 13 2021 at 14:02)</a>:</h4>
<p>Wow, so the timing is not at all what we expected. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> what do you think? Should we reconsider mixins in other places as well?</p>



<a name="238625941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238625941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238625941">(May 13 2021 at 14:09)</a>:</h4>
<p>I am not sure how relevant my opinion is, but using the two typeclasses felt "right"...</p>



<a name="238625942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238625942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238625942">(May 13 2021 at 14:09)</a>:</h4>
<p>This is evidence that this particular refactor isn't going to impact things too much, but I haven't looked at exactly how much of mathlib was directly affected by the change, so I wouldn't draw general conclusions from this noisy data.</p>



<a name="238626033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238626033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238626033">(May 13 2021 at 14:10)</a>:</h4>
<p>I'm fine with the two typeclasses version; what was done about the norm num lemmas?</p>



<a name="238626081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238626081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238626081">(May 13 2021 at 14:10)</a>:</h4>
<p>Mario, you are right (of course, just stating the obvious!).  I have not implemented the change very extensively, but I am more willing to try it now.</p>



<a name="238626173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238626173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238626173">(May 13 2021 at 14:11)</a>:</h4>
<p>Actually, the norm_num lemmas were not affected by the 2 typeclass change.  In the other refactor, I simply added primes to the versions of the lemmas with different assumptions and that was that.</p>



<a name="238626339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238626339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238626339">(May 13 2021 at 14:12)</a>:</h4>
<p>Also, I will do the same in the 2 typeclass refactor, I just did not get around to that stage of the change yet.</p>



<a name="238626495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237574%20ordered/near/238626495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237574.20ordered.html#238626495">(May 13 2021 at 14:13)</a>:</h4>
<p>Before I continue with extending the refactor, I will wait for the current "winning" PR <a href="https://github.com/leanprover-community/mathlib/issues/7371">#7371</a> to be accepted.  It is already fairly extensive, though mostly for moving lemmas from one file to another.</p>
<p>I also changed its status to <code>awaiting-review</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>