---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html">#15088 rewrite cubics</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="288228726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288228726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288228726">(Jul 01 2022 at 22:05)</a>:</h4>
<p>This PR is a genuine "request for comment".  I delete the <a href="https://leanprover-community.github.io/mathlib_docs/find/cubic">docs#cubic</a> structure introduced in <a href="https://github.com/leanprover-community/mathlib/pull/11483">#11483</a> and replace it with a new constructor for polynomials of degree <code>&lt; N</code> given the <code>N</code>-vector of their coefficients.</p>



<a name="288229403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288229403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288229403">(Jul 01 2022 at 22:14)</a>:</h4>
<p>I think this is a great idea! I had the same concern about <code>cubic</code> and came up with the same fix, but didn't have time to implement it.</p>



<a name="288230237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230237">(Jul 01 2022 at 22:24)</a>:</h4>
<p>I have something similar on a local repo, where I construct a poly directly from a list. One could do that, or use your API and list.of_fn.</p>



<a name="288230275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230275">(Jul 01 2022 at 22:25)</a>:</h4>
<p>What one loses by using the list API is that the constructor is an add_hom</p>



<a name="288230354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230354">(Jul 01 2022 at 22:26)</a>:</h4>
<p>Yakov, indeed as I was writing this I was thinking to myself that you had probably considered the idea before :)</p>



<a name="288230408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230408">(Jul 01 2022 at 22:27)</a>:</h4>
<p>I ended up going down the path of upgrading a list to an add_monoid_algebra</p>



<a name="288230457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230457">(Jul 01 2022 at 22:28)</a>:</h4>
<p>So one does get the add_hom when operating on those.</p>



<a name="288230605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230605">(Jul 01 2022 at 22:30)</a>:</h4>
<p>For your to_poly, what's the rationale to not have the codomain be the subtype?</p>



<a name="288230619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230619">(Jul 01 2022 at 22:30)</a>:</h4>
<p>And bundle the degree ceiling proof?</p>



<a name="288230645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230645">(Jul 01 2022 at 22:31)</a>:</h4>
<p>Or have it as a linear hom?</p>



<a name="288230740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230740">(Jul 01 2022 at 22:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics/near/288230605">said</a>:</p>
<blockquote>
<p>For your to_poly, what's the rationale to not have the codomain be the subtype?</p>
</blockquote>
<p>I have a lot of <code>(to_poly P).degree</code>, <code>(to_poly P).nat_degree </code>, <code>(to_poly P).leading_coeff</code>,<code>(to_poly P).roots</code>, where it would be more cumbersome to write <code>(to_poly P : R[X]).degree</code> etc.</p>



<a name="288230822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288230822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288230822">(Jul 01 2022 at 22:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics/near/288230645">said</a>:</p>
<blockquote>
<p>Or have it as a linear hom?</p>
</blockquote>
<p>You're right, it should be an <code>R</code>-linear map rather than an additive homomorphism.  Thanks!</p>



<a name="288231204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288231204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288231204">(Jul 01 2022 at 22:39)</a>:</h4>
<p>You could have two constructors, one that is to the subtype, and one that is to the base type.</p>



<a name="288231291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288231291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288231291">(Jul 01 2022 at 22:41)</a>:</h4>
<p>The subtype constructor already exists, as the symm of <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.degree_lt_equiv">docs#polynomial.degree_lt_equiv</a></p>



<a name="288231300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288231300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288231300">(Jul 01 2022 at 22:41)</a>:</h4>
<p>Ah, right.</p>



<a name="288231301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288231301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288231301">(Jul 01 2022 at 22:41)</a>:</h4>
<p>And that's what you're using</p>



<a name="288231314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288231314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288231314">(Jul 01 2022 at 22:41)</a>:</h4>
<p>It'd be interesting to know how <code>to_poly</code> works with our induction/recursion principles that induct over the degree of a polynomial.</p>



<a name="288231409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288231409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288231409">(Jul 01 2022 at 22:43)</a>:</h4>
<p>By the way, I think it would also be quite reasonable to have a constructor from <code>list R</code>, as you're describing.  But that would not be a drop-in replacement for <a href="https://leanprover-community.github.io/mathlib_docs/find/cubic">docs#cubic</a> the way that this constructor from <code>fin N → R</code> is: if you try to do say <code>P 2</code> on the coefficients list (as happens often in the cubics file), you'll get an <code>option</code>.</p>



<a name="288233818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288233818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288233818">(Jul 01 2022 at 23:21)</a>:</h4>
<p>...except that you could use <a href="https://leanprover-community.github.io/mathlib_docs/find/list.inth">docs#list.inth</a> which I bet has the correct behavior in most cases (although unprovably) because it defaults to <code>default</code> (whcih is most liekly <code>0</code>) when the index is out of bound.</p>



<a name="288233822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288233822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288233822">(Jul 01 2022 at 23:21)</a>:</h4>
<p>Or just <code>l.get_or_else 0 n</code>.</p>



<a name="288233873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288233873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288233873">(Jul 01 2022 at 23:22)</a>:</h4>
<p>Uncleaned WIP:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.factorization.basic</span>
<span class="kn">import</span> <span class="n">data.rat</span>
<span class="kn">import</span> <span class="n">data.polynomial.taylor</span>
<span class="kn">import</span> <span class="n">data.zmod.basic</span>
<span class="kn">import</span> <span class="n">data.nat.digits</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">option.get_or_else_eq_iff</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">option.get_or_else</span> <span class="n">x</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">↔</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">some</span> <span class="n">a</span> <span class="bp">∨</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">none</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">x</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">}</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">fin.coe_embedding_apply</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">fin.coe_embedding</span> <span class="n">n</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">namespace</span> <span class="n">list</span>

<span class="kd">instance</span> <span class="n">decidable_nth_le_ne_of_decidable_mem_and_ne</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
  <span class="o">[</span><span class="n">decidable_pred</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">a</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">decidable_pred</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">l.length</span><span class="o">,</span> <span class="n">l.nth_le</span> <span class="n">i</span> <span class="n">i.is_lt</span> <span class="bp">≠</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">decidable_of_iff</span> <span class="o">(</span><span class="n">l.nth_le</span> <span class="n">i</span> <span class="n">i.is_lt</span> <span class="bp">∈</span> <span class="n">l</span> <span class="bp">∧</span> <span class="n">l.nth_le</span> <span class="n">i</span> <span class="n">i.is_lt</span> <span class="bp">≠</span> <span class="n">a</span><span class="o">)</span> <span class="bp">$</span>
  <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">nth_le_mem</span><span class="o">]</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">R</span><span class="o">)</span>
  <span class="o">[</span><span class="n">decidable_pred</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">l.length</span><span class="o">,</span> <span class="n">l.nth_le</span> <span class="n">i</span> <span class="n">i.is_lt</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">to_finsupp</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→₀</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">support</span> <span class="o">:=</span> <span class="n">finset.map</span> <span class="o">(</span><span class="n">fin.coe_embedding</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">to_embedding</span>
  <span class="o">(</span><span class="n">finset.filter</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">l.nth_le</span> <span class="n">i</span> <span class="n">i.is_lt</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">finset.fin_range</span> <span class="n">l.length</span><span class="o">)),</span>
  <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">l.nth</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">mem_support_to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="kd">begin</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">not_or_distrib</span><span class="o">,</span> <span class="n">ne.def</span><span class="o">,</span> <span class="n">finset.mem_map</span><span class="o">,</span> <span class="n">finset.mem_filter</span><span class="o">,</span>
               <span class="n">finset.mem_fin_range</span><span class="o">,</span> <span class="n">true_and</span><span class="o">,</span> <span class="n">rel_embedding.coe_fn_to_embedding</span><span class="o">,</span>
               <span class="n">exists_prop</span><span class="o">,</span> <span class="n">option.get_or_else_eq_iff</span><span class="o">,</span> <span class="n">nth_eq_none_iff</span><span class="o">,</span> <span class="n">not_le</span><span class="o">,</span>
               <span class="n">fin.coe_embedding_apply</span><span class="o">,</span> <span class="n">nth_eq_some</span><span class="o">,</span> <span class="n">not_exists</span><span class="o">],</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="o">⟨⟨</span><span class="n">j</span><span class="o">,</span> <span class="n">hj</span><span class="o">⟩,</span> <span class="n">hne</span><span class="o">,</span> <span class="n">h</span><span class="o">⟩,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fin.coe_mk</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span> <span class="n">hne</span><span class="o">,</span>
      <span class="n">subst</span> <span class="n">h</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">hne</span><span class="o">,</span> <span class="n">hj</span><span class="o">⟩</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="o">⟨</span><span class="n">hne</span><span class="o">,</span> <span class="n">hi</span><span class="o">⟩,</span>
      <span class="n">exact</span> <span class="o">⟨⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="o">⟩,</span> <span class="n">hne</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩</span> <span class="o">}</span>
  <span class="kd">end</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">to_finsupp_support</span> <span class="o">:</span>
  <span class="n">l.to_finsupp.support</span> <span class="bp">=</span> <span class="n">finset.map</span> <span class="o">(</span><span class="n">fin.coe_embedding</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">to_embedding</span>
  <span class="o">(</span><span class="n">finset.filter</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">l.nth_le</span> <span class="n">i</span> <span class="n">i.is_lt</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">finset.fin_range</span> <span class="n">l.length</span><span class="o">))</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">lemma</span> <span class="n">to_finsupp_apply</span> <span class="o">:</span> <span class="n">l.to_finsupp</span> <span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">l.nth</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">lemma</span> <span class="n">to_finsupp_apply_lt</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="n">l.length</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">l.to_finsupp</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">l.nth_le</span> <span class="n">n</span> <span class="n">hn</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">l.to_finsupp_apply</span><span class="o">,</span> <span class="n">nth_eq_some.mpr</span> <span class="o">⟨</span><span class="n">hn</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span> <span class="n">option.get_or_else_some</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">to_finsupp_apply_le</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">l.length</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">l.to_finsupp</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">finsupp.not_mem_support_iff</span><span class="o">,</span> <span class="n">l.to_finsupp_support</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">ne.def</span><span class="o">,</span> <span class="n">finset.mem_map</span><span class="o">,</span> <span class="n">finset.mem_filter</span><span class="o">,</span> <span class="n">finset.mem_fin_range</span><span class="o">,</span> <span class="n">true_and</span><span class="o">,</span>
             <span class="n">rel_embedding.coe_fn_to_embedding</span><span class="o">,</span> <span class="n">fin.coe_embedding_apply</span><span class="o">,</span> <span class="n">exists_prop</span><span class="o">,</span>
             <span class="n">not_exists</span><span class="o">,</span> <span class="n">not_and</span><span class="o">],</span>
  <span class="n">rintro</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="o">⟩</span> <span class="bp">-</span><span class="o">,</span>
  <span class="n">exact</span> <span class="o">(</span><span class="n">hi.trans_le</span> <span class="n">hn</span><span class="o">)</span><span class="bp">.</span><span class="n">ne</span>
<span class="kd">end</span>

<span class="kd">instance</span> <span class="n">decidable_nth_le_nil_ne</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">decidable_pred</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">([]</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">length</span><span class="o">),</span> <span class="o">([]</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">nth_le</span> <span class="n">i</span> <span class="n">i.elim0</span> <span class="bp">≠</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fin.elim0</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">to_finsupp_nil</span> <span class="o">:</span> <span class="n">to_finsupp</span> <span class="o">([]</span> <span class="o">:</span> <span class="n">list</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ext</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="o">[</span><span class="bp">←</span><span class="n">finsupp.not_mem_support_iff</span><span class="o">,</span> <span class="n">to_finsupp_support</span><span class="o">,</span> <span class="bp">-</span><span class="n">finsupp.mem_support_iff</span><span class="o">]</span>
    <span class="n">using</span> <span class="n">fin.elim0</span>
<span class="kd">end</span>
</code></pre></div>



<a name="288233893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288233893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288233893">(Jul 01 2022 at 23:22)</a>:</h4>
<p>this is on the way to getting a <code>padic.digits</code> a la <code>nat.digits</code>. I don't want to derail this PR review discussion, so feel free to move this to another topic.</p>



<a name="288233994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288233994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288233994">(Jul 01 2022 at 23:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics/near/288233818">said</a>:</p>
<blockquote>
<p>...except that you could use <a href="https://leanprover-community.github.io/mathlib_docs/find/list.inth">docs#list.inth</a> which I bet has the correct behavior in most cases (although unprovably) because it defaults to <code>default</code> (whcih is most liekly <code>0</code>) when the index is out of bound.</p>
</blockquote>
<blockquote>
<p>Or just <code>l.get_or_else 0 n</code>.</p>
</blockquote>
<p>Do you really want to change every <code>P 2</code>in <a href="https://github.com/leanprover-community/mathlib/blob/61eae7fc8d76f4376049af9422c57c12214f4ffc/src/algebra/cubic_discriminant.lean#L240">this line</a> to <code>P.inth 2</code>?</p>



<a name="288234089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288234089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288234089">(Jul 01 2022 at 23:26)</a>:</h4>
<p>I didn't review the cubics PR when it joined mathlib, but as I understand it, the point of this ad hoc <a href="https://leanprover-community.github.io/mathlib_docs/find/cubic">docs#cubic</a> structure is to give <em>very fast</em>  and robust access to the coefficients of the associated polynomial.  Let's try to preserve that property in whatever change is made.</p>



<a name="288234093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288234093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288234093">(Jul 01 2022 at 23:26)</a>:</h4>
<p>That looks quite ugly, but to be fair it's a matter of getting a shorthand notation and the right API.</p>



<a name="288234471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288234471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288234471">(Jul 01 2022 at 23:34)</a>:</h4>
<p>Don't do this at home:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.cubic_discriminant</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span>

<span class="kd">notation</span> <span class="n">p</span><span class="bp">`</span> <span class="bp">`</span><span class="n">x</span> <span class="o">:=</span> <span class="n">p.coeff</span> <span class="n">x</span>

<span class="k">#check</span> <span class="n">p</span> <span class="mi">2</span> <span class="c1">-- R</span>
</code></pre></div>



<a name="288234475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288234475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288234475">(Jul 01 2022 at 23:34)</a>:</h4>
<p>That's not a regular space</p>



<a name="288234484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288234484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288234484">(Jul 01 2022 at 23:34)</a>:</h4>
<p>And that way it works on any poly!</p>



<a name="288238572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288238572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Ang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288238572">(Jul 02 2022 at 00:53)</a>:</h4>
<p>Yeah, I wrote it in such an ad-hoc way to get the coefficients easily, but mainly to be able to write down the discriminant as a product of differences of roots. I haven’t had time to look into this but hopefully the change doesn’t delete the discriminant API.</p>



<a name="288239806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288239806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288239806">(Jul 02 2022 at 01:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="464700">David Ang</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics/near/288238572">said</a>:</p>
<blockquote>
<p>hopefully the change doesn’t delete the discriminant API.</p>
</blockquote>
<p><span class="user-mention" data-user-id="464700">@David Ang</span> If I understand you correctly, it hasn't deleted it.  But you'd better look at the PR.</p>



<a name="288239945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288239945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288239945">(Jul 02 2022 at 01:24)</a>:</h4>
<p>I tried another experiment locally, and got a reasonably ergonomic outcome by replacing <a href="https://leanprover-community.github.io/mathlib_docs/find/cubic">docs#cubic</a> with <code>degree_lt R 4</code> everywhere (cf <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.degree_lt">docs#polynomial.degree_lt</a>) and replacing lemmas about <code>cubic</code> by additions to the <code>degree_lt</code> API, after introducing notation <code>Pᗮ 2</code> for <code>(P : R[X]).coeff 2</code> via</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">postfix</span> <span class="bp">`ᗮ`</span><span class="o">:</span><span class="mi">1000</span> <span class="o">:=</span> <span class="n">polynomial.coeff</span> <span class="bp">∘</span> <span class="o">(</span><span class="bp">@</span><span class="n">degree_lt</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">subtype</span>
</code></pre></div>
<p>(the actual symbol should be changed, of course).</p>



<a name="288239968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288239968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288239968">(Jul 02 2022 at 01:25)</a>:</h4>
<p>I can share this version if people would consider it an improvement (cc <span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> )</p>



<a name="288240149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288240149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288240149">(Jul 02 2022 at 01:30)</a>:</h4>
<p>The disadvantage here is that it's awkward to construct an element of <code>degree_lt R 4</code>, you have to say something like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">P</span> <span class="o">:=</span> <span class="o">(</span><span class="n">degree_lt_equiv</span> <span class="n">R</span> <span class="mi">4</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span>
</code></pre></div>
<p>and this loses the fact (previously transparent) that <code>Pᗮ 2 = 2</code>.</p>



<a name="288240225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/288240225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#288240225">(Jul 02 2022 at 01:31)</a>:</h4>
<p>So I prefer the version with <code>fin 4</code> rather than <code>degree_lt R 4</code>.</p>



<a name="289908074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/289908074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#289908074">(Jul 17 2022 at 22:35)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/15477">#15477</a> should give that <code>of_list_lt [1, 0, 2, 0]</code> gives you the <code>degree_lt R 4</code> that you expect, I hope.</p>



<a name="290018596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/290018596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#290018596">(Jul 18 2022 at 20:27)</a>:</h4>
<p><span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> Nice!</p>



<a name="290018725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/290018725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#290018725">(Jul 18 2022 at 20:28)</a>:</h4>
<p>And <code>(of_list [1, 0, 2, 0]).coeff 2 = 2</code> by <code>rfl</code>.</p>



<a name="290497119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2315088%20rewrite%20cubics/near/290497119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wrenna Robson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2315088.20rewrite.20cubics.html#290497119">(Jul 22 2022 at 12:07)</a>:</h4>
<p>I was inventing something relatively similar to this recently (that is to say, constructing polynomials by their tuples and vice versa, using the degree_lt_equiv correspondance). I'm not sure I have detailed comments on this PR in particular other than to say I think this is the right sort of approach.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>