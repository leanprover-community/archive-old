---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html">#7526 number of derangements</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="238936808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/238936808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#238936808">(May 16 2021 at 00:42)</a>:</h4>
<p>hey all, just found out about this stream. can i get some eyes on 7526? i pulled in people's suggestions, but there's still a few more quirks that need to get ironed out. specifically, in the proof of <code>derangements_equiv_sigma_opfp</code>, i need this predicate "<a href="https://github.com/leanprover-community/mathlib/pull/7526/files#diff-0c967491788d8afe4b67bc9a1be1c96c00cd57ab8c83e656ed83d225b492c425R150-R153">foo</a>", and i'm not sure whether to bury it in the body of the proof, or have it exposed so that it's accessible.</p>



<a name="238968325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/238968325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#238968325">(May 16 2021 at 10:55)</a>:</h4>
<p><code>desc_fac</code> has now landed, for what it's worth</p>



<a name="244645986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244645986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244645986">(Jul 02 2021 at 01:07)</a>:</h4>
<p>this PR is essentially done, can i get a final review on it?</p>



<a name="244659919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244659919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244659919">(Jul 02 2021 at 05:00)</a>:</h4>
<p>Can you merge the latest master into your branch, to check it hasnt gone stale?</p>



<a name="244660771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244660771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244660771">(Jul 02 2021 at 05:22)</a>:</h4>
<p>Sure thing</p>



<a name="244661101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244661101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244661101">(Jul 02 2021 at 05:31)</a>:</h4>
<p>alrighty, it's merged with origin/master. merged with origin/derangements at first, on accident</p>



<a name="244661169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244661169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244661169">(Jul 02 2021 at 05:33)</a>:</h4>
<p>I think nat.desc_fac was renamed to nat.asc_fac or similar, so you'll probably need to make some tweaks</p>



<a name="244664187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244664187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244664187">(Jul 02 2021 at 06:37)</a>:</h4>
<p>dang, looks like i gotta rebuild the whole thing -- vscode isn't able to figure out the incremental changes</p>



<a name="244666097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244666097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244666097">(Jul 02 2021 at 07:06)</a>:</h4>
<p>What do you mean "figure out" incremental changes?</p>



<a name="244668827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244668827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244668827">(Jul 02 2021 at 07:36)</a>:</h4>
<p>there's that little "lean infoview" tab, and sometimes it shows me the state of the lean environment at my cursor position, and sometimes it just says "loading" forever. today's one of those latter days. i'm running <code>leanproject build</code> in the hope that resets everything</p>



<a name="244668993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244668993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244668993">(Jul 02 2021 at 07:38)</a>:</h4>
<p><span aria-label="flame" class="emoji emoji-1f525" role="img" title="flame">:flame:</span> Welcome to the orange bar hell <span aria-label="flame" class="emoji emoji-1f525" role="img" title="flame">:flame:</span></p>



<a name="244669040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244669040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244669040">(Jul 02 2021 at 07:39)</a>:</h4>
<p>To get out, type <code>leanproject get-cache --rev origin/derangements</code></p>



<a name="244677576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/244677576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#244677576">(Jul 02 2021 at 09:16)</a>:</h4>
<p>Sometimes it's useful to close VS Code, run <code>lean --make src/path_to/file_you_are_working_on.lean</code>, and then reopen.</p>



<a name="246299642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/246299642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#246299642">(Jul 17 2021 at 02:38)</a>:</h4>
<p><span class="user-mention" data-user-id="402311">@Henry Swanson</span>, just checking if you need any help with this, or if you're still updating the <code>desc_fac</code>/<code>asc_fac</code> issue.</p>



<a name="246306038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/246306038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#246306038">(Jul 17 2021 at 05:27)</a>:</h4>
<p>Oh shoot, I went on vacation and after that it slipped my mind. I'll get back to it this weekend</p>



<a name="246306322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/246306322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#246306322">(Jul 17 2021 at 05:34)</a>:</h4>
<p>If you need help, I'm there too, as I brought in <code>asc_fac</code>, <code>desc_fac</code>.</p>



<a name="247111094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/247111094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#247111094">(Jul 25 2021 at 06:08)</a>:</h4>
<p>alrighty, finally got around to this. sorry for the delay</p>
<p>just pushed the (hopefully final?) version; let's see if it lints</p>



<a name="251827996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/251827996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henry Swanson <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#251827996">(Sep 03 2021 at 06:17)</a>:</h4>
<p>polishing things up again -- any suggestions for renaming <code>derangements_recursion_equiv</code>, or is it fine as-is?</p>



<a name="251828184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/251828184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#251828184">(Sep 03 2021 at 06:20)</a>:</h4>
<p>Here's the culprit:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">derangements_recursion_equiv</span> <span class="o">:</span>
  <span class="n">derangements</span> <span class="o">(</span><span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="bp">≃</span> <span class="bp">Σ</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="o">(</span><span class="n">derangements</span> <span class="o">(({</span><span class="n">a</span><span class="o">}</span><span class="bp">ᶜ</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="bp">⊕</span> <span class="n">derangements</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>



<a name="251828202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237526%20number%20of%20derangements/near/251828202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237526.20number.20of.20derangements.html#251828202">(Sep 03 2021 at 06:20)</a>:</h4>
<p>And what do people think of this one?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">derangements_equiv_sigma_opfp</span> <span class="o">:</span>
  <span class="n">derangements</span> <span class="o">(</span><span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="bp">≃</span> <span class="bp">Σ</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">perm</span> <span class="n">α</span> <span class="bp">|</span> <span class="n">fixed_points</span> <span class="n">f</span> <span class="bp">⊆</span> <span class="o">{</span><span class="n">a</span><span class="o">}}</span> <span class="o">:=</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>