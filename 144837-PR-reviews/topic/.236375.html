---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.236375.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html">#6375</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="228120937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228120937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228120937">(Feb 28 2021 at 10:18)</a>:</h4>
<p>Leanchecker fails on this one, while everything seems to be fine. Is there a way to diagnose what is going on?</p>



<a name="228120961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228120961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228120961">(Feb 28 2021 at 10:19)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/6375">#6375</a> for mobile</p>



<a name="228121200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228121200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228121200">(Feb 28 2021 at 10:23)</a>:</h4>
<p>Have you tried restarting the test?</p>



<a name="228122827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228122827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228122827">(Feb 28 2021 at 10:55)</a>:</h4>
<p>Yes, it failed twice, both on the last commit and on the one referenced by 213b4cf on the PR page.</p>



<a name="228125648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228125648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228125648">(Feb 28 2021 at 11:49)</a>:</h4>
<p>Exit code 137 looks like it can mean out of memory</p>



<a name="228248573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228248573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228248573">(Mar 01 2021 at 15:22)</a>:</h4>
<p><a href="https://github.com/leanprover/lean/issues/1716">https://github.com/leanprover/lean/issues/1716</a> seems relevant</p>



<a name="228369502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228369502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228369502">(Mar 02 2021 at 08:09)</a>:</h4>
<p>I have merged master, and I get the same leanchecker failure, so this is pretty deterministic. <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> , any idea?</p>



<a name="228369700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228369700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228369700">(Mar 02 2021 at 08:11)</a>:</h4>
<p>Can you binary search by commenting out half the file etc until the build succeeds?</p>



<a name="228369754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228369754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228369754">(Mar 02 2021 at 08:11)</a>:</h4>
<p>In case it's one particular nasty lemma</p>



<a name="228403074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228403074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228403074">(Mar 02 2021 at 12:44)</a>:</h4>
<p>I have bisected the problem. It is in the <code>add_comm_group</code> instance on <code>normed_group_hom V₁ V₂</code>, which is currently given by</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="o">(</span><span class="n">normed_group_hom</span> <span class="n">V₁</span> <span class="n">V₂</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">refine_struct</span>
<span class="o">{</span> <span class="bp">..</span> <span class="n">normed_group_hom.has_add</span><span class="o">,</span> <span class="bp">..</span> <span class="n">normed_group_hom.has_zero</span><span class="o">,</span>
  <span class="bp">..</span> <span class="n">normed_group_hom.has_neg</span><span class="o">,</span> <span class="bp">..</span><span class="n">normed_group_hom.has_sub</span> <span class="o">}</span><span class="bp">;</span>
<span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_comm</span><span class="o">,</span> <span class="n">add_left_comm</span><span class="o">,</span> <span class="n">sub_eq_add_neg</span><span class="o">]</span> <span class="o">}</span>
</code></pre></div>
<p>I have tried to expand the proof, removing the <code>refine_struct</code> and adding more type annotation, like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="o">(</span><span class="n">normed_group_hom</span> <span class="n">V₁</span> <span class="n">V₂</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add_assoc</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">add_left_comm</span><span class="o">,</span> <span class="n">coe_add</span><span class="o">]</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">zero_add</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">add_zero</span><span class="o">,</span> <span class="n">coe_zero</span><span class="o">,</span> <span class="n">coe_add</span><span class="o">]</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">add_zero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">add_zero</span><span class="o">,</span> <span class="n">coe_zero</span><span class="o">,</span> <span class="n">coe_add</span><span class="o">]</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">add_comm</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">coe_add</span><span class="o">]</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">add_left_neg</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">coe_zero</span><span class="o">,</span> <span class="n">coe_add</span><span class="o">,</span> <span class="n">add_right_neg</span><span class="o">,</span> <span class="n">coe_neg</span><span class="o">]</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">sub_eq_add_neg</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="n">sub_apply</span><span class="o">,</span> <span class="n">pi.add_apply</span><span class="o">,</span> <span class="n">pi.neg_apply</span><span class="o">,</span> <span class="n">coe_neg</span><span class="o">,</span> <span class="n">coe_add</span><span class="o">]</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="bp">..</span> <span class="bp">@</span><span class="n">normed_group_hom.has_zero</span> <span class="n">V₁</span> <span class="n">V₂</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="bp">..</span> <span class="bp">@</span><span class="n">normed_group_hom.has_neg</span> <span class="n">V₁</span> <span class="n">V₂</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="bp">..</span> <span class="bp">@</span><span class="n">normed_group_hom.has_add</span> <span class="n">V₁</span> <span class="n">V₂</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="bp">..</span> <span class="bp">@</span><span class="n">normed_group_hom.has_sub</span> <span class="n">V₁</span> <span class="n">V₂</span> <span class="n">_</span> <span class="n">_</span> <span class="o">}</span>
</code></pre></div>
<p>It doesn't change anything: leanchecker still chokes on this.</p>



<a name="228404963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228404963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228404963">(Mar 02 2021 at 12:59)</a>:</h4>
<p>Does proving it with <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.add_comm_group_sub">docs#function.injective.add_comm_group_sub</a> do any better?</p>



<a name="228405040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228405040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228405040">(Mar 02 2021 at 13:00)</a>:</h4>
<p>That is, something like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="n">coe_inj</span> <span class="o">:</span> <span class="n">function.injective</span> <span class="n">coe_fn</span><span class="o">)</span><span class="bp">.</span><span class="n">add_comm_group_sub</span> <span class="n">coe_fn</span> <span class="n">rfl</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>
</code></pre></div>



<a name="228405688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228405688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228405688">(Mar 02 2021 at 13:04)</a>:</h4>
<p>Which would be easier if you defined a new</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">coe_injective</span> <span class="o">:</span> <span class="bp">@</span><span class="n">function.injective</span> <span class="o">(</span><span class="n">normed_group_hom</span> <span class="n">V₁</span> <span class="n">V₂</span><span class="o">)</span> <span class="o">(</span><span class="n">V₁</span> <span class="bp">→</span> <span class="n">V₂</span><span class="o">)</span> <span class="n">coe_fn</span> <span class="o">:=</span> <span class="n">coe_inj</span>
</code></pre></div>
<p>first</p>



<a name="228422260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228422260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228422260">(Mar 02 2021 at 14:53)</a>:</h4>
<p>No, it doesn't change anything. I have also tried adding some <code>@[reducible]</code> on constructors for addition and so on, to no avail. This must be a weird bug in leanchecker...</p>



<a name="228422398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228422398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228422398">(Mar 02 2021 at 14:54)</a>:</h4>
<p>Does it make sense to split the PR and get everything up to but not including that instance merged?</p>



<a name="228425064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228425064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228425064">(Mar 02 2021 at 15:08)</a>:</h4>
<p>I don't think so: the <code>add_comm_group</code> instance is really something we want to have.</p>



<a name="228425648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228425648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228425648">(Mar 02 2021 at 15:11)</a>:</h4>
<p>I don't doubt that, but there's at least 300 lines of other stuff from that PR that you could have in mathlib today while waiting for leanchecker to be fixed</p>



<a name="228427163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228427163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228427163">(Mar 02 2021 at 15:20)</a>:</h4>
<p>This is for lean-liquid, so <span class="user-mention" data-user-id="112680">@Johan Commelin</span> will know what he wants.</p>



<a name="228427311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228427311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228427311">(Mar 02 2021 at 15:21)</a>:</h4>
<p>I think it's fine to just try to get this right.</p>



<a name="228427346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228427346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228427346">(Mar 02 2021 at 15:21)</a>:</h4>
<p>We have a copy in lean-liquid, and I'll just adapt to whatever ends up in mathlib</p>



<a name="228427377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228427377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228427377">(Mar 02 2021 at 15:21)</a>:</h4>
<p>But there is no hurry. So let's just try to sort this out.</p>



<a name="228427466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228427466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228427466">(Mar 02 2021 at 15:22)</a>:</h4>
<p>Also, <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> thanks a lot for refactoring this PR!</p>



<a name="228427850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228427850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228427850">(Mar 02 2021 at 15:24)</a>:</h4>
<p>This is an impressive bug!  I've tried sorrying out all of the proofs in <code>add_comm_group</code> and then it works.  But even putting back one proof (e.g. just zero_add) causes leanchecker to use up insane amounts of memory.</p>



<a name="228430713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228430713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228430713">(Mar 02 2021 at 15:40)</a>:</h4>
<p>I've taken the liberty of pushing a small fix(?) to make leanchecker happy.</p>



<a name="228434062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228434062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228434062">(Mar 02 2021 at 15:58)</a>:</h4>
<p>Will it fail if we use <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.add_comm_group">docs#function.injective.add_comm_group</a> to define this instance?</p>



<a name="228434456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228434456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228434456">(Mar 02 2021 at 16:01)</a>:</h4>
<p>Out of curiosity, I tried <a href="https://github.com/ammkrn/nanoda">nanoda</a> on the commit before Gabriel's fix, but it is giving what seems to be an unrelated error (and a similar error appears when I run <code>nanoda</code> on <code>master</code>):</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>expr line 74; Expected a `Sort` term in inductive mod, got App(App(App(Const(Anon :: "category_theory" :: "presieve", [Param(Anon :: "v"), Param(Anon :: "u")]), Local(serial : "149954", of : Binding { pp_name: Anon :: "C", ty: Sort(1 + Param(Anon :: "u")), style: Implicit }), Local(serial : "149960", of : Binding { pp_name: Anon :: "_inst_1", ty: App(Const(Anon :: "category_theory" :: "category", [Param(Anon :: "v"), Param(Anon :: "u")]), Local(serial : "149954", of : Binding { pp_name: Anon :: "C", ty: Sort(1 + Param(Anon :: "u")), style: Implicit }), style: InstImplicit }), Local(serial : "149963", of : Binding { pp_name: Anon :: "X", ty: Local(serial : "149954", of : Binding { pp_name: Anon :: "C", ty: Sort(1 + Param(Anon :: "u")), style: Implicit }, style: Implicit })
</code></pre></div>
<p>Going to see if I can get <a href="https://github.com/ammkrn/nanoda_lib"><code>nanoda_lib</code></a> working next.</p>
<p><strong>edit</strong>: no luck, <code>nanoda_lib</code> panics with an error:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>thread 'main' panicked at 'internal error: entered unreachable code: ensur_sort could not produce a sort!', src/tc/infer.rs:190:26
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre></div>
<p>opened an issue: <a href="https://github.com/ammkrn/nanoda_lib/issues/1">https://github.com/ammkrn/nanoda_lib/issues/1</a></p>



<a name="228435238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228435238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228435238">(Mar 02 2021 at 16:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/144837-PR-reviews/topic/.236375/near/228434062">said</a>:</p>
<blockquote>
<p>Will it fail if we use <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.add_comm_group">docs#function.injective.add_comm_group</a> to define this instance?</p>
</blockquote>
<p>I suggested essentially this above already, but <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.add_comm_group_sub">docs#function.injective.add_comm_group_sub</a> is preferable</p>



<a name="228444567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228444567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228444567">(Mar 02 2021 at 16:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/144837-PR-reviews/topic/.236375/near/228434062">said</a>:</p>
<blockquote>
<p>Will it fail if we use <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.add_comm_group">docs#function.injective.add_comm_group</a> to define this instance?</p>
</blockquote>
<p>It's probably fine.  I didn't look very hard into the issue yet.  What really worries me though is that if you replace <code>rw</code> by <code>simp</code>, then leanchecker fails.  Which is to say: maybe another <code>by simp</code> could also fail for the same reason.</p>



<a name="228445876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228445876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228445876">(Mar 02 2021 at 17:06)</a>:</h4>
<p>BTW, trepplein has no problems with this definition.</p>



<a name="228452889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228452889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228452889">(Mar 02 2021 at 17:43)</a>:</h4>
<p>I added some minor workarounds to the simp lemmas so that <code>by simp</code> doesn't crash leanchecker.</p>



<a name="228453176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228453176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228453176">(Mar 02 2021 at 17:44)</a>:</h4>
<p>Thanks a lot for your help <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span></p>



<a name="228453761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228453761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228453761">(Mar 02 2021 at 17:47)</a>:</h4>
<p>Thanks indeed! Gabriel, do you mind putting some TODO comments near the various workarounds so future readers will be able to see what's going on?</p>



<a name="228454772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228454772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228454772">(Mar 02 2021 at 17:53)</a>:</h4>
<p>If only I had a good idea of what's going on here...  From what I've observed, the problem seems to occur if there is a term of the form <code>@has_add.add (has_coe_to_fun.F (normed_group_hom V₁ V₂)) pi.has_add x y</code>.  That is, if <code>pi.has_add</code> is used as an instance for a type that is not syntactically a pi. (But this surely can't be the only place we're doing this??!?!)</p>



<a name="228454883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228454883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228454883">(Mar 02 2021 at 17:54)</a>:</h4>
<p>So I've "fixed" this by adding some type annotations and double-checking that they have the right effect..</p>



<a name="228456737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228456737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228456737">(Mar 02 2021 at 18:04)</a>:</h4>
<p>Ok, I've added a library note and filed a Lean bug: <a href="https://github.com/leanprover-community/lean/issues/543">https://github.com/leanprover-community/lean/issues/543</a></p>



<a name="228460605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236375/near/228460605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236375.html#228460605">(Mar 02 2021 at 18:28)</a>:</h4>
<p>Let me join the chorus of people thanking you Gabriel. Without people like you these ambitious projects such as this Scholze thing would be much more painful. Projects such as this are designed to make an impact on the research mathematical community so it's important that they succeed.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>