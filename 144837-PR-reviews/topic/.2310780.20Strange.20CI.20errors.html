---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html">#10780 Strange CI errors</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="266559741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266559741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266559741">(Jan 01 2022 at 14:21)</a>:</h4>
<p>I received a segmentation fault on the linting stage. This error persists through commits and retries, so I suspect this is more a me problem than a github problem. <br>
However I don't know how to debug this. Any tips?</p>



<a name="266559959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266559959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266559959">(Jan 01 2022 at 14:27)</a>:</h4>
<p>Can you reproduce the segfault on your own machine?</p>



<a name="266560379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266560379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266560379">(Jan 01 2022 at 14:38)</a>:</h4>
<p>I'm trying to, but my machine is struggling to even open up <code>all.lean</code> without the orange bar.</p>



<a name="266560988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266560988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266560988">(Jan 01 2022 at 14:55)</a>:</h4>
<p>Turns out that there are errors despite it passing the build mathlib stage.<br>
But after I tried to fix it and pushed, it passed the build mathlib stage again in 13s, which is unreasonably fast.<br>
I suspect it is somehow not compiling my stuff at all?</p>



<a name="266562088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266562088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266562088">(Jan 01 2022 at 15:24)</a>:</h4>
<p>It's still broken after merging master. I suspect the cache for these commits are somehow corrupted. Is there any way to force the CI to compile from scratch?</p>



<a name="266562447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266562447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266562447">(Jan 01 2022 at 15:35)</a>:</h4>
<p>You can try to push to a new branch?</p>



<a name="266562498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266562498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266562498">(Jan 01 2022 at 15:36)</a>:</h4>
<p>That's not the "correct" solution, but it might work.</p>



<a name="266562835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266562835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266562835">(Jan 01 2022 at 15:46)</a>:</h4>
<p>On my machine, the cache for your branch seems to be fine. Running: <code>lean --json -T100000 --make docs archive roadmap test counterexamples</code> works too, even though it's failing on the runner. Maybe the runner is running out of memory or something?</p>



<a name="266563111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266563111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266563111">(Jan 01 2022 at 15:54)</a>:</h4>
<p>Hmmm I pushed to a brand new branch but the tests and lint are still failing : (<br>
I guess I have no idea what causes this problem now.</p>



<a name="266563247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266563247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266563247">(Jan 01 2022 at 15:58)</a>:</h4>
<p>Ultimate test now would be pushing some gibberish change like adding an extra empty space in a docstring, such that the diff would contain this only change</p>



<a name="266563849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266563849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266563849">(Jan 01 2022 at 16:12)</a>:</h4>
<p><span class="user-mention" data-user-id="439483">@Andrew Yang</span> I can run this test if you aren't doing it. Are you?</p>



<a name="266563908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266563908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266563908">(Jan 01 2022 at 16:14)</a>:</h4>
<p>No I'm not. Actually I'm not sure what you mean by your previous suggestion.<br>
Feel free to push to that branch and do tests. I have no idea how to solve this error and any help is much appreciated.</p>



<a name="266564199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266564199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266564199">(Jan 01 2022 at 16:22)</a>:</h4>
<p>Ah, not trying to solve the issue. I'm just trying to make sure something fishy is going on with the CI steps:<br>
<a href="https://github.com/leanprover-community/mathlib/pull/11182">#11182</a></p>



<a name="266564337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266564337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266564337">(Jan 01 2022 at 16:26)</a>:</h4>
<p>Oh. I suppose CI itself is fine?<br>
Only this PR is hitting this error if I'm not mistaken.<br>
Also this error occurred last year (?) when I first started and eventually put this branch on hold.<br>
So I think the problem is caused by this particular PR and not github.</p>



<a name="266564496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266564496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266564496">(Jan 01 2022 at 16:31)</a>:</h4>
<p>I can reproduce the error locally here with the cached oleans. Investigating...</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">lean</span> <span class="c1">--run scripts/lint_mathlib.lean</span>
<span class="n">Segmentation</span> <span class="n">fault</span> <span class="o">(</span><span class="n">core</span> <span class="n">dumped</span><span class="o">)</span>
</code></pre></div>



<a name="266564623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266564623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266564623">(Jan 01 2022 at 16:35)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Thread</span> <span class="mi">11</span> <span class="s2">"lean"</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGSEGV</span><span class="o">,</span> <span class="n">Segmentation</span> <span class="n">fault.</span>
<span class="o">[</span><span class="n">Switching</span> <span class="n">to</span> <span class="n">LWP</span> <span class="mi">84502</span><span class="o">]</span>
<span class="mi">0x0000000000939896</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">remove_unnecessary_casts</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="o">(</span><span class="n">gdb</span><span class="o">)</span> <span class="n">bt</span>
<span class="bp">#</span><span class="mi">0</span>  <span class="mi">0x0000000000939896</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">remove_unnecessary_casts</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">1</span>  <span class="mi">0x000000000093d745</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">try_auto_eq_congr</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">2</span>  <span class="mi">0x00000000009425e6</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">visit_app</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">3</span>  <span class="mi">0x000000000093e38f</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">visit</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">optional</span><span class="bp">&lt;</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span><span class="bp">&gt;</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">4</span>  <span class="mi">0x000000000093d00d</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">try_auto_eq_congr</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">5</span>  <span class="mi">0x00000000009425e6</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">visit_app</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">6</span>  <span class="mi">0x000000000093e38f</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">visit</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">optional</span><span class="bp">&lt;</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span><span class="bp">&gt;</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">7</span>  <span class="mi">0x000000000093b7b6</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">simplify</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">8</span>  <span class="mi">0x000000000093ba73</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">simplify_core_fn</span><span class="o">::</span><span class="n">operator</span><span class="o">()(</span><span class="n">lean</span><span class="o">::</span><span class="n">name</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">expr</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">9</span>  <span class="mi">0x000000000094500d</span> <span class="k">in</span> <span class="n">lean</span><span class="o">::</span><span class="n">tactic_simplify</span><span class="o">(</span><span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">,</span> <span class="n">lean</span><span class="o">::</span><span class="n">vm_obj</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="o">()</span>
<span class="bp">...</span>
</code></pre></div>
<p>I think it'll be easier to rebuild lean with asan</p>



<a name="266565039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266565039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266565039">(Jan 01 2022 at 16:46)</a>:</h4>
<p>Even <code>lean --make src</code> segfaults for me, not just trying to run the linter</p>



<a name="266566307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266566307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266566307">(Jan 01 2022 at 17:18)</a>:</h4>
<p>Yeah, the cache does seem to be weird, since <code>lean --make src/</code> is building stuff for me too (no segfault yet, but it's not done yet). The CI even runs <code>lean --make src/</code> twice before uploading the oleans; maybe we have to run it 3 times??</p>



<a name="266566448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266566448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266566448">(Jan 01 2022 at 17:22)</a>:</h4>
<p>There's some rare but possible thing where two hashes collide. My only understanding of this phrase is that I've seen branches of mathlib where you could get the cache and then <code>lean --make src/</code> would still build some random bits of mathlib anyway. Could it be anything to do with this?</p>



<a name="266566520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266566520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266566520">(Jan 01 2022 at 17:24)</a>:</h4>
<p>Asan says it's a buffer overflow in cast_args (a local variable in the topmost function in the above stack trace). I am doing a debug build to see if some assert is useful.</p>



<a name="266566802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266566802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266566802">(Jan 01 2022 at 17:31)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">LEAN</span> <span class="n">ASSERTION</span> <span class="n">VIOLATION</span>
<span class="n">File</span><span class="o">:</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">collares</span><span class="bp">/</span><span class="n">lean0</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">tactic</span><span class="bp">/</span><span class="n">simplify.cpp</span>
<span class="n">Line</span><span class="o">:</span> <span class="mi">175</span>
<span class="n">Task</span><span class="o">:</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">collares</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">category_theory</span><span class="bp">/</span><span class="n">limits</span><span class="bp">/</span><span class="n">shapes</span><span class="bp">/</span><span class="n">pullbacks.lean</span><span class="o">:</span> <span class="n">category_theory.limits.walking_cospan_functor</span>
<span class="n">cast_args.size</span><span class="o">()</span> <span class="bp">==</span> <span class="mi">6</span>
<span class="o">(</span><span class="n">C</span><span class="o">)</span><span class="n">ontinue</span><span class="o">,</span> <span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="n">bort</span><span class="bp">/</span><span class="n">exit</span><span class="o">,</span> <span class="o">(</span><span class="n">S</span><span class="o">)</span><span class="n">top</span><span class="bp">/</span><span class="n">trap</span>
</code></pre></div>
<p>at <a href="https://github.com/leanprover-community/lean/blob/v3.35.1/src/library/tactic/simplify.cpp#L175">https://github.com/leanprover-community/lean/blob/v3.35.1/src/library/tactic/simplify.cpp#L175</a></p>



<a name="266567550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266567550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266567550">(Jan 01 2022 at 17:50)</a>:</h4>
<p>Thanks! Though I have no idea what that assert means and why it fails.<br>
At least I could try to remove the usage of <code>simp</code> in the definition of <code>category_theory.limits.walking_cospan_functor</code>.</p>



<a name="266567852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266567852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266567852">(Jan 01 2022 at 17:59)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- The functor between two `walking_cospan`s in different universes. -/</span>
<span class="kd">def</span> <span class="n">walking_cospan_functor</span> <span class="o">:</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="bp">⥤</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₂</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">one</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">hom.id</span> <span class="n">_</span><span class="o">,</span> <span class="n">hom.inl</span><span class="o">,</span> <span class="n">hom.inr</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map_id'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span><span class="o">,</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="o">}</span> <span class="c1">-- change me to `by tidy` to get segfault</span>
</code></pre></div>



<a name="266567990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266567990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266567990">(Jan 01 2022 at 18:01)</a>:</h4>
<p>This compiles:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- The functor between two `walking_cospan`s in different universes. -/</span>
<span class="kd">def</span> <span class="n">walking_cospan_functor</span> <span class="o">:</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="bp">⥤</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₂</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">one</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">hom.id</span> <span class="n">_</span><span class="o">,</span> <span class="n">hom.inl</span><span class="o">,</span> <span class="n">hom.inr</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">cc</span> <span class="o">}</span>
</code></pre></div>



<a name="266568039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266568039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266568039">(Jan 01 2022 at 18:03)</a>:</h4>
<p>Hmmm. Why does it do so though. It's not heavy tidy at all. <br>
I've changed it to <code>map_comp' := λ _ _ _ _ _, subsingleton.elim _ _</code> and CI indeed appears to be willing to compile my stuff again.</p>



<a name="266568046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266568046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266568046">(Jan 01 2022 at 18:03)</a>:</h4>
<p>It's because of a bug in <code>simp</code> which you've discovered. Very impressive!</p>



<a name="266568086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266568086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266568086">(Jan 01 2022 at 18:04)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- The functor between two `walking_cospan`s in different universes. -/</span>
<span class="kd">def</span> <span class="n">walking_cospan_functor</span> <span class="o">:</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="bp">⥤</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₂</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">one</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">hom.id</span> <span class="n">_</span><span class="o">,</span> <span class="n">hom.inl</span><span class="o">,</span> <span class="n">hom.inr</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span> <span class="c1">-- segfault</span>
  <span class="kd">end</span> <span class="o">}</span>
</code></pre></div>
<p>In 2018 these sorts of things were more commonplace, but seeing Lean segfault now is a real rarity.</p>



<a name="266568251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266568251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266568251">(Jan 01 2022 at 18:09)</a>:</h4>
<p>Here's the segfault on master:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.limits.shapes.wide_pullbacks</span>
<span class="kn">import</span> <span class="n">category_theory.limits.shapes.binary_products</span>

<span class="kn">open</span> <span class="n">category_theory</span>

<span class="kn">namespace</span> <span class="n">category_theory.limits</span>

<span class="kd">universes</span> <span class="n">v₁</span> <span class="n">v₂</span> <span class="n">v</span>

<span class="kd">abbreviation</span> <span class="n">walking_cospan</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span> <span class="o">:=</span> <span class="n">wide_pullback_shape</span> <span class="n">walking_pair</span>

<span class="kd">@[pattern]</span> <span class="kd">abbreviation</span> <span class="n">walking_cospan.left</span> <span class="o">:</span> <span class="n">walking_cospan</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">walking_pair.left</span>
<span class="kd">@[pattern]</span> <span class="kd">abbreviation</span> <span class="n">walking_cospan.right</span> <span class="o">:</span> <span class="n">walking_cospan</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">walking_pair.right</span>
<span class="kd">@[pattern]</span> <span class="kd">abbreviation</span> <span class="n">walking_cospan.one</span> <span class="o">:</span> <span class="n">walking_cospan</span> <span class="o">:=</span> <span class="n">none</span>

<span class="kn">namespace</span> <span class="n">walking_cospan</span>

<span class="kd">abbreviation</span> <span class="n">hom</span> <span class="o">:</span> <span class="n">walking_cospan</span> <span class="bp">→</span> <span class="n">walking_cospan</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span> <span class="o">:=</span> <span class="n">wide_pullback_shape.hom</span>

<span class="kd">@[pattern]</span> <span class="kd">abbreviation</span> <span class="n">hom.inl</span> <span class="o">:</span> <span class="n">left</span> <span class="bp">⟶</span> <span class="n">one</span> <span class="o">:=</span> <span class="n">wide_pullback_shape.hom.term</span> <span class="n">_</span>
<span class="kd">@[pattern]</span> <span class="kd">abbreviation</span> <span class="n">hom.inr</span> <span class="o">:</span> <span class="n">right</span> <span class="bp">⟶</span> <span class="n">one</span> <span class="o">:=</span> <span class="n">wide_pullback_shape.hom.term</span> <span class="n">_</span>
<span class="kd">@[pattern]</span> <span class="kd">abbreviation</span> <span class="n">hom.id</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">walking_cospan</span><span class="o">)</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">⟶</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">wide_pullback_shape.hom.id</span> <span class="n">X</span>

<span class="kd">end</span> <span class="n">walking_cospan</span>

<span class="kn">open</span> <span class="n">walking_cospan</span>

<span class="kd">def</span> <span class="n">walking_cospan_functor</span> <span class="o">:</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="bp">⥤</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₂</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">one</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span> <span class="n">exacts</span> <span class="o">[</span><span class="n">hom.id</span> <span class="n">_</span><span class="o">,</span> <span class="n">hom.inl</span><span class="o">,</span> <span class="n">hom.inr</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span> <span class="c1">-- segfault</span>
  <span class="kd">end</span> <span class="o">}</span>
</code></pre></div>



<a name="266568267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266568267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266568267">(Jan 01 2022 at 18:09)</a>:</h4>
<p>Unrelated, but these <code>rintro ..., exacts ...</code> should probably be changed to a def using <code>match</code></p>



<a name="266569677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266569677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266569677">(Jan 01 2022 at 18:47)</a>:</h4>
<p>Might be worth creating <a href="https://github.com/leanprover-community/lean/issues">an issue on the community Lean 3 repository</a>, just in case anyone else runs into this.</p>



<a name="266570077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266570077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266570077">(Jan 01 2022 at 18:56)</a>:</h4>
<p>Might be worth checking if this is a regression from <a href="https://github.com/leanprover-community/lean/pull/134">lean#134</a>, but I don't know how to do that (cc <span class="user-mention" data-user-id="238446">@Anne Baanen</span> but feel free to ignore ofc)</p>



<a name="266606596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266606596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266606596">(Jan 02 2022 at 10:16)</a>:</h4>
<p>Hmm, so this seems to be more that <code>eq.rec</code> or <code>eq.drec</code> is being applied to the wrong number of arguments.</p>



<a name="266606825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266606825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266606825">(Jan 02 2022 at 10:22)</a>:</h4>
<p>More specifically, the simplifier is doing a kind of ad-hoc pattern match to turn <code>@eq.rec _ _ _ %x _ rfl</code> into <code>%x</code> itself, and for some reason there are not enough (given the buffer overflow) arguments to the pattern.</p>



<a name="266606869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266606869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266606869">(Jan 02 2022 at 10:23)</a>:</h4>
<p>I might do some more investigating tomorrow, since I'm messing with the simplifier anyways. Could you do a core dump or precisely point out the commit + olean combination that triggers the failure?</p>



<a name="266608688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266608688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Yang <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266608688">(Jan 02 2022 at 11:06)</a>:</h4>
<p>Thanks for looking into it. I think the current mathlib (<code>ebdbe6b</code>) with the MWE that Kevin gave above produces this error.<br>
If you want to look at a commit, the commit <code>32425a9</code> (along with the remote cache) should also reproduce the error.</p>



<a name="266613945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266613945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266613945">(Jan 02 2022 at 13:19)</a>:</h4>
<p>I also tested with the same commit (<code>32425a9bd635d3f39dac89afa8715c07575519f7</code> with the oleans at <code>https://oleanstorage.azureedge.net/mathlib/32425a9bd635d3f39dac89afa8715c07575519f7.tar.xz</code>). Running <code>lean src/category_theory/limits/shapes/pullbacks.lean</code> is enough to trigger the crash. Also, running <code>print(e)</code> in gdb for the expression that makes <code>remove_unnecessary_casts</code> fail returns this: <a href="https://gist.github.com/collares/12e3a1628ad90d4104aaa312e88bffd1">https://gist.github.com/collares/12e3a1628ad90d4104aaa312e88bffd1</a></p>



<a name="266614483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266614483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266614483">(Jan 02 2022 at 13:33)</a>:</h4>
<p>I also tried to minify Kevin's example and got it to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.limits.shapes.wide_pullbacks</span>
<span class="kn">import</span> <span class="n">category_theory.limits.shapes.binary_products</span>

<span class="kn">open</span> <span class="n">category_theory</span>
<span class="kn">open</span> <span class="n">category_theory.limits</span>
<span class="kn">open</span> <span class="n">category_theory.limits.walking_cospan</span>


<span class="kd">universes</span> <span class="n">v₁</span>

<span class="kd">def</span> <span class="n">walking_cospan_functor</span> <span class="o">:</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="bp">⥤</span> <span class="n">walking_cospan.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">),</span><span class="n">exacts</span> <span class="o">[</span><span class="n">one</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">)</span><span class="bp">;</span><span class="gr">sorry</span><span class="o">},</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="n">dsimp</span><span class="o">,</span>
    <span class="c1">-- simp, -- segfault</span>
  <span class="kd">end</span> <span class="o">}</span>
</code></pre></div>



<a name="266614648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266614648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266614648">(Jan 02 2022 at 13:37)</a>:</h4>
<p>I don't know how portable rr recordings are (I'm on a Ryzen 4700U on NixOS), but they're much smaller than a core dump so here's an rr trace if it's useful: <a href="https://www.dropbox.com/s/lltw4eluvbbcawg/rr-pack.tar.xz?dl=0">https://www.dropbox.com/s/lltw4eluvbbcawg/rr-pack.tar.xz?dl=0</a></p>
<div class="message_inline_ref"><a href="https://www.dropbox.com/s/lltw4eluvbbcawg/rr-pack.tar.xz?dl=0" title="rr-pack.tar.xz"><img src="https://uploads.zulipusercontent.net/5988eb9fd8511387eeea052d50aeaf0db268ece4/68747470733a2f2f7777772e64726f70626f782e636f6d2f7374617469632f696d616765732f737065637472756d2d69636f6e732f67656e6572617465642f636f6e74656e742f636f6e74656e742d756e6b6e6f776e2d6c617267652e706e67"></a><div><div class="message_inline_image_title">rr-pack.tar.xz</div><desc class="message_inline_image_desc"></desc></div></div>



<a name="266630991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266630991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266630991">(Jan 02 2022 at 20:14)</a>:</h4>
<p>Thank you very much! It seems we have pinpointed the proximate cause of the crash, now to figure out how to fix it...</p>



<a name="266731930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266731930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266731930">(Jan 03 2022 at 20:15)</a>:</h4>
<p>I won't have time to look at this until next week, but I've uploaded the rr trace to Pernosco if it helps: <a href="https://pernos.co/debug/xTMRQEO34MjIm4VLCRHBwA/index.html#f{m[jZo,AA_,t[Aw,AsZ5_,f{e[jWQ,Apkg_,s{aAA,bBA,uApoc1A,oAqBzqg___/">https://pernos.co/debug/xTMRQEO34MjIm4VLCRHBwA/index.html#f{m[jZo,AA_,t[Aw,AsZ5_,f{e[jWQ,Apkg_,s{aAA,bBA,uApoc1A,oAqBzqg___/</a></p>



<a name="266732029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266732029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266732029">(Jan 03 2022 at 20:16)</a>:</h4>
<p>Double-click on the pointer value (0x7f7b76fc64c0) to get some nice dataflow analysis</p>



<a name="266732238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/266732238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#266732238">(Jan 03 2022 at 20:18)</a>:</h4>
<p>Also there's a "gdb terminal" option in the Toolbox dropdown to inspect stuff at a given state of the program execution (if you click on the orange square to the left of an executed line, gdb will be inspecting the execution at that point in time)</p>



<a name="267143023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/267143023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#267143023">(Jan 07 2022 at 02:13)</a>:</h4>
<p>Minimized a bit more, perhaps:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.limits.shapes.wide_pullbacks</span>
<span class="kn">import</span> <span class="n">category_theory.limits.shapes.binary_products</span>

<span class="kn">namespace</span> <span class="n">category_theory.limits</span>

<span class="kd">abbreviation</span> <span class="n">walking_cospan</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">:=</span> <span class="n">wide_pullback_shape</span> <span class="n">walking_pair</span>

<span class="kd">def</span> <span class="n">walking_cospan_functor</span> <span class="o">:</span> <span class="n">walking_cospan</span> <span class="bp">⥤</span> <span class="n">walking_cospan</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="bp">|</span><span class="n">_</span><span class="o">)</span><span class="bp">;</span> <span class="gr">sorry</span> <span class="o">},</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">eq_rec_constant</span><span class="o">]</span> <span class="o">}</span> <span class="c1">-- segfault</span>
</code></pre></div>



<a name="267198424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/267198424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#267198424">(Jan 07 2022 at 15:01)</a>:</h4>
<p>It doesn't crash with <code>eta := ff</code>, though.</p>



<a name="267208299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/267208299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#267208299">(Jan 07 2022 at 16:19)</a>:</h4>
<p>Thanks for the detailed bug report!  The key info was that the crash happened in simplify.cpp:175.  Since the assert was obviously wrong there, I could trivially write a mathlib-free mwe:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">ss</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">subsingleton</span> <span class="n">ss</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="o">⟨⟩</span> <span class="o">⟨⟩,</span> <span class="n">rfl</span><span class="o">⟩</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">decidable_eq</span> <span class="n">ss</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">⟨⟩</span> <span class="o">⟨⟩,</span> <span class="n">decidable.is_true</span> <span class="n">rfl</span>
<span class="kd">instance</span> <span class="n">ss.inst</span> <span class="o">:</span> <span class="n">ss</span> <span class="o">:=</span> <span class="o">⟨⟩</span>

<span class="kd">def</span> <span class="n">vector</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span>

<span class="kd">def</span> <span class="n">vector.get</span> <span class="o">{</span><span class="n">n</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">ss</span><span class="o">]</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">vector</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
<span class="n">v</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">h</span><span class="o">⟩</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">vector</span> <span class="mi">7</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">vector.get</span> <span class="n">_</span> <span class="n">nat</span> <span class="o">(</span><span class="n">eq.rec</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="o">:</span> <span class="n">unit</span><span class="o">,</span> <span class="n">ss.inst</span><span class="o">)</span> <span class="o">(</span><span class="n">eq.refl</span> <span class="mi">42</span><span class="o">)</span> <span class="o">())</span> <span class="n">v</span> <span class="mi">3</span> <span class="n">dec_trivial</span> <span class="bp">&gt;</span> <span class="mi">42</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="k">show</span> <span class="mi">3</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span> <span class="k">from</span> <span class="n">rfl</span><span class="o">],</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p><a href="https://github.com/leanprover-community/lean/pull/661">https://github.com/leanprover-community/lean/pull/661</a> (the fix isn't particularly insightful)</p>



<a name="267219336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310780%20Strange%20CI%20errors/near/267219336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310780.20Strange.20CI.20errors.html#267219336">(Jan 07 2022 at 17:48)</a>:</h4>
<p>OK so at the end of that round, Andrew scores one point for finding the bug and Gabriel scores 2 for fixing it.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>