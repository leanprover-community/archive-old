---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html">#2847 displace zero_ne_one_class</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="199142356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142356">(May 29 2020 at 11:40)</a>:</h4>
<p>what is this test error?</p>



<a name="199142364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142364">(May 29 2020 at 11:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">runner</span><span class="bp">/</span><span class="n">work</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">test</span><span class="bp">/</span><span class="n">lint</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">96</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">failed</span>
<span class="n">state</span><span class="o">:</span>
<span class="err">⊢</span> <span class="n">true</span>
</code></pre></div>



<a name="199142379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142379">(May 29 2020 at 11:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">foo_has_mul</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">infer_instance</span>
<span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">1</span><span class="o">]</span> <span class="n">foo_has_mul</span>
<span class="n">run_cmd</span> <span class="n">do</span>
  <span class="n">d</span> <span class="err">←</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">has_mul</span><span class="o">,</span>
  <span class="n">some</span> <span class="n">s</span> <span class="err">←</span> <span class="n">fails_quickly</span> <span class="mi">300</span> <span class="n">d</span><span class="o">,</span>
  <span class="n">guard</span> <span class="err">$</span> <span class="n">s</span> <span class="bp">=</span> <span class="s2">&quot;type-class inference timed out&quot;</span>
</code></pre></div>



<a name="199142383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142383">(May 29 2020 at 11:41)</a>:</h4>
<p>and what does it have to do with my PR?</p>



<a name="199142387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142387">(May 29 2020 at 11:41)</a>:</h4>
<p>and can I just ignore this error?</p>



<a name="199142528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142528">(May 29 2020 at 11:42)</a>:</h4>
<p>permalink: <a href="https://github.com/leanprover-community/mathlib/runs/720072871">https://github.com/leanprover-community/mathlib/runs/720072871</a></p>



<a name="199142547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142547">(May 29 2020 at 11:42)</a>:</h4>
<p>because I'm gonna push more commits</p>



<a name="199142564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142564">(May 29 2020 at 11:42)</a>:</h4>
<p>maybe this time it won't complain</p>



<a name="199142645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142645">(May 29 2020 at 11:43)</a>:</h4>
<p>This is strange.  <code>lean test/lint.lean</code> works for me locally.</p>



<a name="199142753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142753">(May 29 2020 at 11:45)</a>:</h4>
<p>so what should I do if I see this again?</p>



<a name="199142786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142786">(May 29 2020 at 11:45)</a>:</h4>
<p>The next time please make sure that <code>leanproject get mathlib:nonzero</code> shows the error.  I have found the correct revision now.</p>



<a name="199142890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142890">(May 29 2020 at 11:46)</a>:</h4>
<p>no I pushed a commit just now</p>



<a name="199142900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142900">(May 29 2020 at 11:46)</a>:</h4>
<p>to merge into master</p>



<a name="199142911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142911">(May 29 2020 at 11:46)</a>:</h4>
<p>the error showed up before that</p>



<a name="199142943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142943">(May 29 2020 at 11:47)</a>:</h4>
<p>in commit 5f693c0</p>



<a name="199142952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142952">(May 29 2020 at 11:47)</a>:</h4>
<blockquote>
<p>I have found the correct revision now.</p>
</blockquote>



<a name="199142953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199142953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199142953">(May 29 2020 at 11:47)</a>:</h4>
<p>I apologize for any confusion</p>



<a name="199143340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199143340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199143340">(May 29 2020 at 11:51)</a>:</h4>
<p>The test complains that the linter produces the wrong error message.  If nothing else works, just remove the <code>guard</code> in that test.  The <code>some s ← ..</code> already makes sure the linter complains.  <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> Why is the error message important here?  I can't really tell the difference between the error messages.</p>



<a name="199143572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199143572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199143572">(May 29 2020 at 11:54)</a>:</h4>
<p>wait but why doesn't it complain in the current revision then?</p>



<a name="199143599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199143599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199143599">(May 29 2020 at 11:55)</a>:</h4>
<p>Other potential fix: replace <code>300</code> by <code>100</code>.</p>



<a name="199143623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199143623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199143623">(May 29 2020 at 11:55)</a>:</h4>
<p>The test in question checks that type-class inference takes longer than 300, and returns an error message within 3000.</p>



<a name="199143649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199143649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199143649">(May 29 2020 at 11:55)</a>:</h4>
<p>Now it only takes 227.  It's gotten faster!</p>



<a name="199144800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199144800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199144800">(May 29 2020 at 12:07)</a>:</h4>
<p>300 <span aria-label="clock" class="emoji emoji-1f557" role="img" title="clock">:clock:</span></p>



<a name="199213854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199213854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199213854">(May 29 2020 at 21:21)</a>:</h4>
<p>The idea of this test was that the linter can spot the difference between a type class problem that obviously loops (2nd test), and a type class problem that just takes a long time to resolve before exhausting the search space (first test). <br>
It's nice that the type-class inference sped up. I think the best fix of the test is to replace the <code>300</code> by <code>100</code> (or lower).</p>



<a name="199214226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232847%20displace%20zero_ne_one_class/near/199214226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.232847.20displace.20zero_ne_one_class.html#199214226">(May 29 2020 at 21:24)</a>:</h4>
<p>I did that</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>