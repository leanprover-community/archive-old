---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/Style.20guide.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html">Style guide</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="221447278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221447278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221447278">(Jan 03 2021 at 11:42)</a>:</h4>
<p>I have opened a PR to actualize the style guide at <a href="https://github.com/leanprover-community/leanprover-community.github.io/pull/155">https://github.com/leanprover-community/leanprover-community.github.io/pull/155</a>. I won't merge it myself because I am not sure everyone has the same feeling on our current style as I do. Comments/improvements welcome!</p>



<a name="221447552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221447552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221447552">(Jan 03 2021 at 11:50)</a>:</h4>
<p>Thanks for this! Looks great to me.</p>



<a name="221447745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221447745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221447745">(Jan 03 2021 at 11:57)</a>:</h4>
<p>I love that you are now reviewing your own PRs. Who needs AI or other maintainers?</p>



<a name="221447798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221447798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221447798">(Jan 03 2021 at 11:58)</a>:</h4>
<p>I sometimes review my own PR's when I'm glancing over them and notice a slip -- I make a suggestion and then commit it!</p>



<a name="221448048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221448048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221448048">(Jan 03 2021 at 12:06)</a>:</h4>
<p>oh lol I just looked and it's exactly what he was doing too :-)</p>



<a name="221475863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221475863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221475863">(Jan 03 2021 at 23:00)</a>:</h4>
<p>Do we want  the "single tactic per line, unless 1 line closes the whole goal" style convention?<br>
I myself have basically been doing "anything goes, as long as there are at most 100 characters per line". I feel that there are many combinations of tactics that feel like "1 step" that I like to put on one line, examples:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">begin</span>
  <span class="bp">...</span>
  <span class="n">dsimp</span><span class="o">,</span> <span class="n">simp</span>
<span class="kd">end</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">...</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">foo</span><span class="o">],</span> <span class="n">simp_rw</span> <span class="o">[</span><span class="n">bar</span><span class="o">],</span>
  <span class="bp">...</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">...</span>
  <span class="n">apply</span> <span class="n">foo</span><span class="o">,</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="bp">...</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">...</span>
  <span class="n">rcases</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">...</span><span class="o">,</span> <span class="n">rcases</span> <span class="n">y</span> <span class="k">with</span> <span class="bp">...</span><span class="o">,</span>
  <span class="bp">...</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">...</span>
  <span class="n">apply</span> <span class="n">foo</span><span class="o">,</span> <span class="n">apply</span> <span class="n">bar</span><span class="o">,</span>
  <span class="bp">...</span>
</code></pre></div>
<p>I also put many other tactics on 1 line (that often aren't really a single step). For example, here is a snippet from <code>haar_measure.lean</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">apply</span> <span class="n">nat.Inf_le</span><span class="o">,</span> <span class="n">refine</span> <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mem_set_of_eq</span><span class="o">],</span> <span class="n">refine</span> <span class="n">subset.trans</span> <span class="n">h1s</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">bUnion_subset</span><span class="o">,</span> <span class="n">intros</span> <span class="n">g₁</span> <span class="n">hg₁</span><span class="o">,</span> <span class="n">rw</span> <span class="n">preimage_subset_iff</span><span class="o">,</span> <span class="n">intros</span> <span class="n">g₂</span> <span class="n">hg₂</span><span class="o">,</span>
</code></pre></div>
<p>Is the proof more readable if that is 8 lines?</p>
<p>I prefer allowing any number of tactics on one line.</p>



<a name="221475892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221475892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221475892">(Jan 03 2021 at 23:01)</a>:</h4>
<p>Fighting talk! I completely agree that "one line" can sometimes be very different to "one mathematical idea".</p>



<a name="221476031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221476031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221476031">(Jan 03 2021 at 23:05)</a>:</h4>
<p>Arguably you should indicate "one mathematical idea" with a lemma / tactic / comment which contains the name of that idea, but that's perhaps not pragmatic</p>



<a name="221476715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221476715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221476715">(Jan 03 2021 at 23:20)</a>:</h4>
<p>I think "1 step" examples should be allowed on one line like <code>dsimp, simp</code> or <code>rw [foo], simp_rw [bar] </code>, but would prefer multiple lines for your last example. I do believe it is a lot more readable if I can step through a proof using the down key, rather than having to move to the next comma manually.<br>
Its also easier to rearrange and fix / modify proofs when you don't have too much happening on one line, at least with most IDEs or text editors, cutting and pasting whole lines are common operations and have easily accessible shortcuts.<br>
I also don't really see what compressing proofs too much helps with when the proof is already long (small golfs to indicate that a lemma is a triviality is ok, but in the haar measure stuff you're really proving things that people may want to read for some reason)</p>



<a name="221482322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221482322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221482322">(Jan 04 2021 at 01:46)</a>:</h4>
<p>Ok, it seems I'm outvoted, and I'm happy to adapt.</p>
<p>Then I suggest adding something like "Multiple tactics are allowed on one line, if they feel like 1 step" with some examples.</p>



<a name="221484989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221484989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221484989">(Jan 04 2021 at 03:00)</a>:</h4>
<p>I routinely use complex lines, and I think many very short lines is a readability issue because you can't see as much of the proof at once. As you've identified, I try to keep it to one "mathematical idea", but this is admittedly vague and I'm not sure we can or should do anything about this.</p>



<a name="221485109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221485109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221485109">(Jan 04 2021 at 03:03)</a>:</h4>
<p>I agree that the "down arrow sequence" should give you a sensible sequence of proof steps. I sometimes deliberately do things like <code>cases bla, clear h</code> because I don't want people to have to look at the intermediate point. That also makes sense with the "one mathematical idea" definition</p>



<a name="221485117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221485117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221485117">(Jan 04 2021 at 03:03)</a>:</h4>
<p>I'm sure that an automated formatter will hate us for this though</p>



<a name="221492111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221492111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221492111">(Jan 04 2021 at 06:06)</a>:</h4>
<p>I often do <code>induction n, { simp },</code> to discharge the case <code>n = 0</code> without using two <code>{ ... }</code> blocks.</p>



<a name="221496315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/Style%20guide/near/221496315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/Style.20guide.html#221496315">(Jan 04 2021 at 07:42)</a>:</h4>
<p>I have added to the PR a comment that tactics corresponding to a single idea, like <code>cases bla, clear h</code> or <code>induction n, { simp }</code> or <code>rw [foo], simp_rw [bar]</code> can be put on a single line. Don't hesitate to push more changes!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>