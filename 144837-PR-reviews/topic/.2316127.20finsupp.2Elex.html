---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html">#16127 finsupp.lex</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="294845826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294845826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294845826">(Aug 23 2022 at 11:23)</a>:</h4>
<p>Dear All,</p>
<p>can I interest anyone in reviewing  <a href="https://github.com/leanprover-community/mathlib/pull/16127">#16127</a>?  It defines the lexicographic ordering on finsupps.  The actual order has been rewritten by Eric to work decidably.  My remaining contribution are the 4 covariant instances at the bottom.</p>
<p>This PR is a step in proving that (some) <code>add_monoid_algebra</code>s have no non-trivial zero-divisors.  In particular, this will work for <code>mv_polynomial</code>s (see <a href="https://github.com/leanprover-community/mathlib/pull/15983">#15983</a> for the zero-divisor stuff and <a href="https://github.com/leanprover-community/mathlib/pull/16157">#16157</a> to bring everything together).</p>
<p>Thanks!</p>



<a name="294890089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294890089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294890089">(Aug 23 2022 at 15:19)</a>:</h4>
<p>Don't we already have no zero divisors for mv_polynomial?</p>



<a name="294890170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294890170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294890170">(Aug 23 2022 at 15:20)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/mv_polynomial.is_domain">docs#mv_polynomial.is_domain</a>?</p>



<a name="294890330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294890330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294890330">(Aug 23 2022 at 15:21)</a>:</h4>
<p>I guess that has commutativity and nontriviality preconditions that you don't need, but it might generalize trivially</p>



<a name="294895590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294895590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294895590">(Aug 23 2022 at 15:46)</a>:</h4>
<p>Yes, for polynomials it already is there in the guise of <code>is_domain</code>.  However, for more general <code>add_monoid_algebra</code>s it is not there.</p>
<p>Moreover, even though it is not my main concern, commutativity of the semiring is also not necessary (but may be required for <code>mv_polynomial</code>s?).</p>
<p>The version in this PR also applies to <code>laurent_polynomial</code>s, as <span class="user-mention" data-user-id="284160">@Eric Rodriguez</span> reminded me.</p>



<a name="294897299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294897299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294897299">(Aug 23 2022 at 15:54)</a>:</h4>
<p>In fact, one of the PRs linked above should remove the then unnecessary instances.</p>



<a name="294938849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294938849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294938849">(Aug 23 2022 at 20:07)</a>:</h4>
<p>I just checked: currently, the <code>is_domain</code> instance on <code>mv_polynomial</code>s assumes <code>comm_ring</code>, whereas the one in the PR applies to <code>semiring</code>s.  Note that <code>mv_polynomial</code> assumes the ground semiring to be commutative, so the gain here is simply <code>comm_ring</code> to <code>comm_semiring</code>.  I have not tracked down where the <code>ring</code> vs <code>semiring</code> assumption sneaks in: it is possible that it could be avoided in the proof that mathlib currently has.</p>
<p>Still, I view the fact that the new proof is independent of the one for <code>mv_polynomial</code>s, it is strictly more general and also applies to <code>laurent_polynomial</code>s like all positive facts!  We also get to remove the older instance and some of the auxiliary lemmas leading up to it, which is what the last PR in the sequence does.</p>



<a name="294990782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/294990782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#294990782">(Aug 24 2022 at 07:07)</a>:</h4>
<p>I went ahead and golfed the <code>no_zero_divisors</code> instance on polynomials as well!</p>



<a name="295004192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004192">(Aug 24 2022 at 08:52)</a>:</h4>
<p>I created <a href="https://github.com/leanprover-community/mathlib/pull/16226">#16226</a> to rewrite <code>mv_polynomial.is_domain</code> to <code>mv_polynomial.no_zero_divisors</code></p>



<a name="295004544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004544">(Aug 24 2022 at 08:55)</a>:</h4>
<p>Do you then thing that if the <code>no_zero_divisors</code> instance on <code>add_monoid_algebra</code> gets merged, then it should not be used to golf the analogous instance on <code>mv_polynomial</code>s?</p>
<p>Also, this conversation has shifted from <code>finsupp.lex</code> to <code>no_zero_divisors</code>.  Should I create a new thread?</p>



<a name="295004692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004692">(Aug 24 2022 at 08:56)</a>:</h4>
<p>No, it definitely should be used to golf the instance on <code>mv_polynomial</code>!</p>



<a name="295004721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004721">(Aug 24 2022 at 08:56)</a>:</h4>
<p>I'm just curious why you need this lex stuff for the generalization when we didn't need it for the original</p>



<a name="295004770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004770">(Aug 24 2022 at 08:57)</a>:</h4>
<p>(which isn't to say we shouldn't have the lex stuff)</p>



<a name="295004811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004811">(Aug 24 2022 at 08:57)</a>:</h4>
<p>Ah, <code>add_monoid_algebra</code>s do not satisfy <code>no_zero_divisors</code> in general, but they do when the grading type is linearly ordered.</p>



<a name="295004915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295004915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295004915">(Aug 24 2022 at 08:58)</a>:</h4>
<p>And, <code>(mv_/laurent)polynomial</code>s fit this.  The <code>mv_polynomial</code>s using the <code>finsupp.lex</code> stuff.</p>



<a name="295005024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295005024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295005024">(Aug 24 2022 at 08:59)</a>:</h4>
<p>So, to latch onto the <code>no_zero_divisors</code> instance on <code>mv_polynomial</code> I want to get a linear order on the grading type, hence the <code>finsupp.lex</code>.</p>



<a name="295005051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295005051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295005051">(Aug 24 2022 at 08:59)</a>:</h4>
<p>(I have a meeting now: will be back once it is over!)</p>



<a name="295005587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295005587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295005587">(Aug 24 2022 at 09:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex/near/295004811">said</a>:</p>
<blockquote>
<p>Ah, <code>add_monoid_algebra</code>s do not satisfy <code>no_zero_divisors</code> in general, but they do when the grading type is linearly ordered.</p>
</blockquote>
<p>What's the full set of conditions you were able to prove the result under? Presumably the order needs to interact with the algebra in some way?</p>



<a name="295019825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295019825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295019825">(Aug 24 2022 at 10:45)</a>:</h4>
<p>Eric, here is an answer: on the branch <code>adomani_ama_nzd</code> this works and has explicit typeclasses:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.monoid_algebra.no_zero_divisors</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">no_zero_divisors</span> <span class="n">R</span><span class="o">]</span>  <span class="c1">-- no further assumptions on `R`</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">has_add</span> <span class="n">A</span><span class="o">]</span>
  <span class="o">[</span><span class="n">covariant_class</span> <span class="n">A</span> <span class="n">A</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span> <span class="o">(</span><span class="bp">&lt;</span><span class="o">)]</span>
  <span class="o">[</span><span class="n">covariant_class</span> <span class="n">A</span> <span class="n">A</span> <span class="o">(</span><span class="n">function.swap</span> <span class="o">(</span><span class="bp">+</span><span class="o">))</span> <span class="o">(</span><span class="bp">&lt;</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">no_zero_divisors</span> <span class="o">(</span><span class="n">add_monoid_algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">add_monoid_algebra.no_zero_divisors</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">N</span><span class="o">}</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">N</span><span class="o">]</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">N</span><span class="o">]</span>
  <span class="o">[</span><span class="n">covariant_class</span> <span class="n">N</span> <span class="n">N</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span> <span class="o">(</span><span class="bp">&lt;</span><span class="o">)]</span> <span class="o">[</span><span class="n">covariant_class</span> <span class="n">N</span> <span class="n">N</span> <span class="o">(</span><span class="n">function.swap</span> <span class="o">(</span><span class="bp">+</span><span class="o">))</span> <span class="o">(</span><span class="bp">&lt;</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">no_zero_divisors</span> <span class="o">(</span><span class="n">add_monoid_algebra</span> <span class="n">R</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→₀</span> <span class="n">N</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">add_monoid_algebra.finsupp_no_zero_divisors</span>
</code></pre></div>



<a name="295022980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295022980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295022980">(Aug 24 2022 at 11:07)</a>:</h4>
<p>If the question was about whether I know a "closed form iff" for deciding which <code>add_monoid_algebra</code>s satisfy <code>no_zero_divisors</code>, then the answer is that I do not know of a non-tautological characterisation.</p>
<p>I suspect that the typeclasses above cut out a portion of the available cases, but I also suspect that there will be <code>add_monoid_algebra</code>s that do not satisfy those requirements, but that happen to only have zero as a zero-divisor.</p>



<a name="295025398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/295025398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#295025398">(Aug 24 2022 at 11:27)</a>:</h4>
<p>Dear All,</p>
<p>can I interest anyone in reviewing <a href="https://github.com/leanprover-community/mathlib/pull/16127">#16127</a>? It defines the lexicographic ordering on finsupps. The actual order has been rewritten by Eric to work decidably. My remaining contribution are the 4 covariant instances at the bottom.</p>
<p>Thanks!</p>
<p>PS  If you are interested in discussing the application of this PR to <code>add_monoid_algebra</code>s, I am very happy about this and it is my motivation behind this PR!  The discussion is <a href="#narrow/stream/144837-PR-reviews/topic/.2316157.20no-zero-divisors.20in.20add_monoid_algebras">here</a>.</p>



<a name="296335624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316127%20finsupp.lex/near/296335624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316127.20finsupp.2Elex.html#296335624">(Aug 31 2022 at 14:24)</a>:</h4>
<p>Dear All,</p>
<p>are there any further comments on this PR?  I personally find that it is ready!  <span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>