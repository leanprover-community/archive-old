---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html">#16531: refactor `alg_equiv`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="299240148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299240148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299240148">(Sep 16 2022 at 20:55)</a>:</h4>
<p>I'm running into another weird issue in my refactor of <code>alg_equiv</code>.  The build hits a time out on <a href="https://leanprover-community.github.io/mathlib_docs/find/galois_field.equiv_zmod_p">docs#galois_field.equiv_zmod_p</a>, and when I run <code>lean --make</code>, it gives me this error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">field_theory</span><span class="bp">/</span><span class="n">finite</span><span class="bp">/</span><span class="n">galois_field.lean</span><span class="o">:</span><span class="mi">142</span><span class="o">:</span><span class="mi">81</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">synthesized</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">is</span> <span class="n">not</span> <span class="n">definitionally</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">expression</span> <span class="n">inferred</span> <span class="kd">by</span> <span class="n">typing</span> <span class="n">rules</span><span class="o">,</span> <span class="n">synthesized</span>
  <span class="n">has_mul.to_has_smul</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
<span class="n">inferred</span>
  <span class="n">smul_with_zero.to_has_smul</span>
<span class="n">Additional</span> <span class="n">information</span><span class="o">:</span>
<span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">field_theory</span><span class="bp">/</span><span class="n">finite</span><span class="bp">/</span><span class="n">galois_field.lean</span><span class="o">:</span><span class="mi">142</span><span class="o">:</span><span class="mi">81</span><span class="o">:</span> <span class="n">context</span><span class="o">:</span> <span class="n">switched</span> <span class="n">to</span> <span class="n">simple</span> <span class="n">application</span> <span class="n">elaboration</span> <span class="n">procedure</span> <span class="n">because</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">use</span> <span class="n">expected</span> <span class="n">type</span> <span class="n">to</span> <span class="n">elaborate</span> <span class="n">it</span><span class="o">,</span> <span class="n">error</span> <span class="n">message</span>
  <span class="n">type</span> <span class="n">mismatch</span><span class="o">,</span> <span class="n">term</span>
    <span class="o">(</span><span class="n">is_splitting_field.alg_equiv</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">X</span><span class="o">))</span><span class="bp">.</span><span class="n">symm</span>
  <span class="n">has</span> <span class="n">type</span>
    <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">X</span><span class="o">)</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">zmod</span> <span class="n">p</span><span class="o">]</span> <span class="n">zmod</span> <span class="n">p</span>
  <span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
    <span class="n">galois_field</span> <span class="n">p</span> <span class="mi">1</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">zmod</span> <span class="n">p</span><span class="o">]</span> <span class="n">zmod</span> <span class="n">p</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="n">p</span><span class="o">),</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">^</span> <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">^</span> <span class="n">fintype.card</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">),</span>
<span class="n">inst</span> <span class="o">:</span> <span class="n">is_splitting_field</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">X</span> <span class="bp">^</span> <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">X</span><span class="o">)</span>
<span class="bp">⊢</span> <span class="n">galois_field</span> <span class="n">p</span> <span class="mi">1</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">zmod</span> <span class="n">p</span><span class="o">]</span> <span class="n">zmod</span> <span class="n">p</span>
</code></pre></div>
<p>which made me think I introduced some kind of diamond (I have no idea how I would have managed to do that in this PR), but this compiles just fine:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">has_mul.to_has_smul</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="bp">=</span> <span class="n">smul_with_zero.to_has_smul</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>If I turn the <code>def</code> into a <code>lemma</code>, the timeout goes away, and it immediately comes back with this, with <code>set_option pp.implicit true</code>:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">synthesized</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">is</span> <span class="n">not</span> <span class="n">definitionally</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">expression</span> <span class="n">inferred</span> <span class="kd">by</span> <span class="n">typing</span> <span class="n">rules</span><span class="o">,</span> <span class="n">synthesized</span>
  <span class="bp">@</span><span class="n">has_mul.to_has_smul</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">distrib.to_has_mul</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_distrib</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))))</span>
<span class="n">inferred</span>
  <span class="bp">@</span><span class="n">smul_with_zero.to_has_smul</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class.to_has_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_one_class.to_mul_zero_class</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_one_class</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">semifield.to_comm_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_semifield</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))))))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">semifield.to_comm_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_semifield</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                               <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))))))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">module.to_mul_action_with_zero</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">semifield.to_comm_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_semifield</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">non_unital_non_assoc_semiring.to_add_comm_monoid</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">non_assoc_semiring.to_non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_non_assoc_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">algebra.to_module</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">semifield.to_comm_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_semifield</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span>
             <span class="bp">?</span><span class="n">m_1</span><span class="o">)))</span>
<span class="n">Additional</span> <span class="n">information</span><span class="o">:</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jireh</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">field_theory</span><span class="bp">/</span><span class="n">finite</span><span class="bp">/</span><span class="n">galois_field.lean</span><span class="o">:</span><span class="mi">146</span><span class="o">:</span><span class="mi">81</span><span class="o">:</span> <span class="n">context</span><span class="o">:</span> <span class="n">switched</span> <span class="n">to</span> <span class="n">simple</span> <span class="n">application</span> <span class="n">elaboration</span> <span class="n">procedure</span> <span class="n">because</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">use</span> <span class="n">expected</span> <span class="n">type</span> <span class="n">to</span> <span class="n">elaborate</span> <span class="n">it</span><span class="o">,</span> <span class="n">error</span> <span class="n">message</span>
  <span class="n">type</span> <span class="n">mismatch</span><span class="o">,</span> <span class="n">term</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">is_splitting_field.alg_equiv</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)</span> <span class="bp">?</span><span class="n">m_5</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                 <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span> <span class="bp">^</span>
            <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">-</span>
          <span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))))</span>
       <span class="bp">?</span><span class="n">m_6</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span>
  <span class="n">has</span> <span class="n">type</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span> <span class="bp">^</span>
           <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">-</span>
         <span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
                 <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))))</span><span class="bp">.</span><span class="n">splitting_field</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">zmod</span> <span class="n">p</span><span class="o">]</span>
      <span class="n">zmod</span> <span class="n">p</span>
  <span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
    <span class="bp">@</span><span class="n">galois_field</span> <span class="n">p</span> <span class="n">_inst_1</span> <span class="mi">1</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">zmod</span> <span class="n">p</span><span class="o">]</span> <span class="n">zmod</span> <span class="n">p</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="n">p</span><span class="o">),</span>
<span class="n">h</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span> <span class="bp">^</span>
      <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">=</span>
    <span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span> <span class="bp">^</span>
      <span class="bp">@</span><span class="n">fintype.card</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.fintype</span> <span class="n">p</span> <span class="n">_</span><span class="o">),</span>
<span class="n">inst</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_splitting_field</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">zmod.algebra</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))</span>
       <span class="n">p</span>
       <span class="n">_</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">))))</span> <span class="bp">^</span>
         <span class="n">p</span> <span class="bp">^</span> <span class="mi">1</span> <span class="bp">-</span>
       <span class="bp">@</span><span class="n">X</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">zmod.field</span> <span class="n">p</span> <span class="n">_inst_1</span><span class="o">)))))</span>
<span class="bp">⊢</span> <span class="bp">@</span><span class="n">galois_field</span> <span class="n">p</span> <span class="n">_inst_1</span> <span class="mi">1</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">zmod</span> <span class="n">p</span><span class="o">]</span> <span class="n">zmod</span> <span class="n">p</span>
</code></pre></div>
</div></div>
<p>Ideas? What did i screw up?</p>



<a name="299244221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299244221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299244221">(Sep 16 2022 at 21:31)</a>:</h4>
<p>Seems to be <a href="#narrow/stream/113488-general/topic/diamond.3A.20galois_field.20algebras">this diamond</a> which <a href="#narrow/stream/304774-FLT-regular/topic/Project.20status/near/292628667">has been fixed</a> (if I understand correctly) but not yet PR'd.</p>



<a name="299247929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299247929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299247929">(Sep 16 2022 at 22:05)</a>:</h4>
<p>Sorry, yeah, I'm just not sure of what the best way is to fix this, honestly</p>



<a name="299247977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299247977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299247977">(Sep 16 2022 at 22:05)</a>:</h4>
<p>I'm tempted to disable the instance from charp to algebra and then leave it as a Def with 'use at your own risk'</p>



<a name="299248061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299248061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299248061">(Sep 16 2022 at 22:06)</a>:</h4>
<p>Turning char_p into a <code>Type*</code> is not really a great option... It also causes a bunch of other issues</p>



<a name="299251804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299251804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Frédéric Dupuis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299251804">(Sep 16 2022 at 22:44)</a>:</h4>
<p>You could try putting <code>by exact</code> after the <code>:=</code>, sometimes that works.</p>



<a name="299252420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299252420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299252420">(Sep 16 2022 at 22:50)</a>:</h4>
<p>they're genuinely different Frédéric</p>



<a name="299254697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299254697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299254697">(Sep 16 2022 at 23:16)</a>:</h4>
<p>I'm a bit confused about what I did to make this fail when it's fine on master, but maybe tc inference just got bumped slightly.</p>



<a name="299572888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299572888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299572888">(Sep 19 2022 at 14:15)</a>:</h4>
<p>Any tips for how I should proceed here <span class="user-mention" data-user-id="284160">@Eric Rodriguez</span>? Even if there's just an acceptable temporary solution until the diamond gets resolved in mathlib, it would be nice to be able to proceed with this refactor.</p>



<a name="299593773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299593773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299593773">(Sep 19 2022 at 15:52)</a>:</h4>
<p>I think the best solution would be to change any <code>char_p</code>s into <code>algebra (zmod p) _</code>, and then use <code>by convert</code> (I think the subsingleton instances are there already)</p>



<a name="299593899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299593899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299593899">(Sep 19 2022 at 15:52)</a>:</h4>
<p>If you can point me to a branch I can have a look</p>



<a name="299594103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299594103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299594103">(Sep 19 2022 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224323">Junyan Xu</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60/near/299244221">said</a>:</p>
<blockquote>
<p>Seems to be <a href="#narrow/stream/113488-general/topic/diamond.3A.20galois_field.20algebras">this diamond</a> which <a href="#narrow/stream/304774-FLT-regular/topic/Project.20status/near/292628667">has been fixed</a> (if I understand correctly) but not yet PR'd.</p>
</blockquote>
<p>also I don't think it's that diamond Junyan, although I do think that resolving it may have the side effect of fixing it</p>



<a name="299594134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299594134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299594134">(Sep 19 2022 at 15:54)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/tree/j-loreaux/refactor-alg-equiv">branch#j-loreaux/refactor-alg-equiv</a></p>



<a name="299594241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299594241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299594241">(Sep 19 2022 at 15:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="325367">Mauricio Collares</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60/near/299594134">said</a>:</p>
<blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/tree/j-loreaux/refactor-alg-equiv">branch#j-loreaux/refactor-alg-equiv</a></p>
</blockquote>
<p>that seems to have the check issue elsewhere</p>



<a name="299595100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2316531%3A%20refactor%20%60alg_equiv%60/near/299595100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2316531.3A.20refactor.20.60alg_equiv.60.html#299595100">(Sep 19 2022 at 15:58)</a>:</h4>
<p><code>src/field_theory/finite/galois_field.lean</code> from that branch has the error described in the original post, although there's also a timeout in <code>src/field_theory/galois.lean</code> if you compile with <code>-T100000</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>