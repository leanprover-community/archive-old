---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.236355.20finsum.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html">#6355 finsum</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="231180734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231180734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231180734">(Mar 21 2021 at 00:13)</a>:</h4>
<p>Hi, I made quite a few changes to <a href="https://github.com/leanprover-community/mathlib/issues/6355">#6355</a>:</p>
<ul>
<li>moved <code>finsupp.of_finite_support</code> to <a href="https://github.com/leanprover-community/mathlib/issues/6777">#6777</a>, add <code>can_lift</code> instance;</li>
<li>simplify many proofs by using <code>lift s to finset α</code>;</li>
<li>drop <code>set.to_finset'</code> - not required for <code>finsum</code>; IMHO should be PRd separately;</li>
<li>add <code>function.mul_support</code> in <a href="https://github.com/leanprover-community/mathlib/issues/6791">#6791</a> so that we can have <code>finprod</code>;</li>
<li>drop connection to <code>finsupp</code>; I have a (not yet coded) idea to redo <code>finsupp</code> without <code>finset</code>s using <code>finsum</code> instead of <code>finset.sum</code>;</li>
<li>drop some lemmas about intersection, possibly they should be restored (IMHO they are superseded by <code>finsum_in_eq_sum_of_inter_support_eq</code> and <code>finsum_in_eq_sum_of_subset</code> but I may be wrong).</li>
</ul>
<p><span class="user-mention" data-user-id="243312">@Jason KY.</span> <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Please let me know if you don't like the changes.</p>



<a name="231182306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231182306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231182306">(Mar 21 2021 at 00:48)</a>:</h4>
<p>One more reason for removing <code>inter</code> lemmas was that they abused <code>set α = α → Prop</code> (i.e., they used <code>s ∩ p</code> and <code>p x</code> instead of <code>s ∩ {x | p x}</code> or <code>s ∩ t</code> and <code>x ∈ t</code>).</p>



<a name="231183820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231183820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason KY. <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231183820">(Mar 21 2021 at 01:21)</a>:</h4>
<p>This is great! I really like this refactor. I guess we can simply change the sums to prods after <a href="https://github.com/leanprover-community/mathlib/pull/6791/files">#6791</a> gets merged</p>



<a name="231186732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231186732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231186732">(Mar 21 2021 at 02:28)</a>:</h4>
<p>I'm going to merge the <code>mul_support</code> branch and migrate to <code>to_additive</code></p>



<a name="231191609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231191609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231191609">(Mar 21 2021 at 04:14)</a>:</h4>
<ul>
<li>[x] multiplicative support <a href="https://github.com/leanprover-community/mathlib/issues/6791">#6791</a></li>
<li>[x] multiplicative indicator <a href="https://github.com/leanprover-community/mathlib/issues/6794">#6794</a> (waiting for CI to fix build)</li>
<li>[ ] finprod</li>
</ul>



<a name="231201522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231201522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231201522">(Mar 21 2021 at 08:10)</a>:</h4>
<p>Wow, many thanks for all this Yury. I agree that these are good ideas. Thanks for working on this!</p>



<a name="231222377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231222377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231222377">(Mar 21 2021 at 15:20)</a>:</h4>
<p>It doesn't compile. I'm fixing it now.</p>



<a name="231222948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231222948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231222948">(Mar 21 2021 at 15:32)</a>:</h4>
<p>(I need both <code>finsum</code> and <code>finprod</code> for partition of unity; it's possible to define it without <code>finsum</code>/<code>finprod</code> but it's much less convenient)</p>



<a name="231223601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231223601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231223601">(Mar 21 2021 at 15:43)</a>:</h4>
<p>Can I help in any way?</p>



<a name="231229952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231229952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231229952">(Mar 21 2021 at 17:40)</a>:</h4>
<p>I'm waiting for CI; should compile now.</p>



<a name="231229985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231229985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231229985">(Mar 21 2021 at 17:41)</a>:</h4>
<p>Now I have another idea: what if we use some <code>plift</code> magic to make <code>∑ᶠ i &lt; 5, f i</code> work?</p>



<a name="231230006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231230006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231230006">(Mar 21 2021 at 17:42)</a>:</h4>
<p>With <code>∑ᶠ i ∈ s, f i</code> as a special case.</p>



<a name="231230311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231230311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231230311">(Mar 21 2021 at 17:47)</a>:</h4>
<p>I mean this definition:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[irreducible]</span> <span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">finsum</span> <span class="o">{</span><span class="n">M</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="n">finite</span> <span class="o">(</span><span class="n">support</span> <span class="o">(</span><span class="n">f</span> <span class="bp">∘</span> <span class="n">plift.down</span><span class="o">))</span> <span class="k">then</span> <span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">h.to_finset</span><span class="o">,</span> <span class="n">f</span> <span class="n">i.down</span> <span class="k">else</span> <span class="mi">0</span>
</code></pre></div>



<a name="231231207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231231207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231231207">(Mar 21 2021 at 18:01)</a>:</h4>
<p><code>plift</code> is needed because <code>finite</code> is defined on <code>Type*</code> not <code>Sort*</code>?</p>



<a name="231231304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231231304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231231304">(Mar 21 2021 at 18:02)</a>:</h4>
<p>I tried to fix that in <a href="https://github.com/leanprover-community/lean/issues/533">leanprover-community/lean#533</a>, but the failures are nasty</p>



<a name="231232547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231232547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231232547">(Mar 21 2021 at 18:25)</a>:</h4>
<p>All I want is for sums over finite sets to be easier for mathematicians who don't understand when we say "finset is data, and decidable equality is important, but don't just open_locale classical if you're sometimes using naturals because then you might get diamonds; by the way <code>convert</code> is important", and when all they want to do is to sum over a set which is obviously (to them) finite.</p>



<a name="231233183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231233183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231233183">(Mar 21 2021 at 18:37)</a>:</h4>
<p>Yurt's suggestion nicely solves the question "why do I sometimes write <code>in</code> and sometimes write <code>\in</code>", by making only the latter necessary</p>



<a name="231233245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231233245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231233245">(Mar 21 2021 at 18:38)</a>:</h4>
<p>Oh -- the reason we went for <code>in</code> instead of <code>\in</code> was that we couldn't get <code>\in</code> to parse properly.</p>



<a name="231233385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231233385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231233385">(Mar 21 2021 at 18:42)</a>:</h4>
<p>Yury's approach solves that</p>



<a name="231233453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231233453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231233453">(Mar 21 2021 at 18:42)</a>:</h4>
<p>And I believe allows for stranger constructs like <code>\sum x y (h : x + y \in s), sorry</code></p>



<a name="231241374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231241374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231241374">(Mar 21 2021 at 21:10)</a>:</h4>
<p>If we are talking about notation in sums, one thing I noticed in the liquid tensor experiment is we really need to define <code>\sum k &lt; n, ...</code> to mean <code>\sum f in range n, ...</code> and<code>\sum k \le n, ...</code> to mean <code>\sum f in range (n + 1), ...</code>. These are very common cases and the range version is really painfully long.</p>



<a name="231243676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231243676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231243676">(Mar 21 2021 at 21:55)</a>:</h4>
<p>We'll get this with <code>finsum</code>.</p>



<a name="231243776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231243776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231243776">(Mar 21 2021 at 21:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> What kind of <code>@[congr]</code> lemma I have to add to make <code>@[simp]</code> simplify inside <code>(h : x ∈ s)</code> in <code>∑ᶠ x ∈ s, f x</code>?</p>



<a name="231243860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231243860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231243860">(Mar 21 2021 at 21:58)</a>:</h4>
<p>I guess it would be like <code>p = q -&gt; f = g -&gt; ∑ᶠ (_ : p), f = ∑ᶠ (_ : q), g</code>, although I am not sure if that actually works</p>



<a name="231243891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231243891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231243891">(Mar 21 2021 at 21:59)</a>:</h4>
<p>Is it worth putting <code>plift</code> inside the definition of <code>finite</code>?</p>



<a name="231243987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231243987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231243987">(Mar 21 2021 at 22:00)</a>:</h4>
<p>We don't have <code>set</code>s for <code>Sort*</code></p>



<a name="231244027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244027">(Mar 21 2021 at 22:01)</a>:</h4>
<p>Huh, I thought that was only lists. Is there a reason for that?</p>



<a name="231244037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244037">(Mar 21 2021 at 22:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <code>@[congr]</code> expects <code>finprod f = finprod g</code>, not <code>finrpod (λ _, a) = finprod (λ _, g)</code>.</p>



<a name="231244118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244118">(Mar 21 2021 at 22:02)</a>:</h4>
<p>I tried</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive]</span> <span class="kd">lemma</span> <span class="n">finprod_congr_Prop</span> <span class="o">{</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">g</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">hpq</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">q</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hfg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">h</span> <span class="o">:</span> <span class="n">q</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">hpq.mpr</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">h</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">finprod</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">finprod</span> <span class="n">g</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">subst</span> <span class="n">q</span><span class="o">,</span> <span class="n">exact</span> <span class="n">finprod_congr</span> <span class="n">hfg</span> <span class="o">}</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">congr</span><span class="o">]</span> <span class="n">finprod_congr_Prop</span> <span class="n">finsum_congr_Prop</span>
</code></pre></div>
<p>and it doesn't work.</p>



<a name="231244153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244153">(Mar 21 2021 at 22:03)</a>:</h4>
<p>I'll try to post an MWE in a few minutes</p>



<a name="231244155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244155">(Mar 21 2021 at 22:03)</a>:</h4>
<p>Yeah, if that doesn't work then I don't think it's possible</p>



<a name="231244203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244203">(Mar 21 2021 at 22:04)</a>:</h4>
<p>maybe if it was another constant? But I guess the whole point here is to reuse <code>finprod</code></p>



<a name="231244223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244223">(Mar 21 2021 at 22:05)</a>:</h4>
<p>I don't think you can rewrite in the binder of a forall either, with <code>simp</code></p>



<a name="231244312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244312">(Mar 21 2021 at 22:06)</a>:</h4>
<p>Actually, now that I come to think about it, how does rewriting the lhs of an implication work?</p>



<a name="231244325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244325">(Mar 21 2021 at 22:06)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">@[irreducible]</span> <span class="kd">def</span> <span class="n">finprod</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">1</span>

<span class="kd">lemma</span> <span class="n">finprod_congr_Prop</span> <span class="o">{</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">g</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">hpq</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">q</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hfg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">h</span> <span class="o">:</span> <span class="n">q</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">hpq.mpr</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">h</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">finprod</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">finprod</span> <span class="n">g</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">subst</span> <span class="n">q</span><span class="o">,</span> <span class="n">congr</span><span class="o">,</span> <span class="n">funext</span> <span class="n">x</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hfg</span> <span class="n">x</span> <span class="o">}</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="n">finprod</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∨</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">finprod</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span>
</code></pre></div>



<a name="231244453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244453">(Mar 21 2021 at 22:08)</a>:</h4>
<p>OTOH,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">order.complete_lattice</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">β</span><span class="o">]</span>


<span class="kd">example</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">β</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="bp">⨆</span> <span class="n">i</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∨</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">⨆</span> <span class="n">i</span> <span class="o">:</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span>
</code></pre></div>
<p>works</p>



<a name="231244550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244550">(Mar 21 2021 at 22:10)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[congr]</span> <span class="kd">theorem</span> <span class="n">supr_congr_Prop</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_Sup</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">f₁</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">→</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">f₂</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">→</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">pq</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">↔</span> <span class="n">q</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">x</span><span class="o">,</span> <span class="n">f₁</span> <span class="o">(</span><span class="n">pq.mpr</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f₂</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">supr</span> <span class="n">f₁</span> <span class="bp">=</span> <span class="n">supr</span> <span class="n">f₂</span> <span class="o">:=</span>
</code></pre></div>



<a name="231244585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244585">(Mar 21 2021 at 22:11)</a>:</h4>
<p>What's the difference between 2 lemmas?</p>



<a name="231244648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244648">(Mar 21 2021 at 22:12)</a>:</h4>
<p>other than the <code>p &lt;-&gt; q</code> (which doesn't seem to matter), I don't see anything different</p>



<a name="231244651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244651">(Mar 21 2021 at 22:12)</a>:</h4>
<p>maybe the argument order?</p>



<a name="231244671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244671">(Mar 21 2021 at 22:12)</a>:</h4>
<p>oh oops it's not marked <code>@[congr]</code></p>



<a name="231244694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244694">(Mar 21 2021 at 22:13)</a>:</h4>
<p>It is in the main file. In the <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> <code>@[congr]</code> says that it's a bad congr lemma. Trying to understand.</p>



<a name="231244807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244807">(Mar 21 2021 at 22:15)</a>:</h4>
<p><code>finprod</code> has two <code>_inst_1</code>'s in it</p>



<a name="231244868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244868">(Mar 21 2021 at 22:16)</a>:</h4>
<p>yep that fixes it</p>



<a name="231244869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244869">(Mar 21 2021 at 22:16)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">@[irreducible]</span> <span class="kd">def</span> <span class="n">finprod</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span> <span class="mi">1</span>

<span class="kd">@[congr]</span> <span class="kd">lemma</span> <span class="n">finprod_congr_Prop</span> <span class="o">{</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">g</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">→</span> <span class="n">M</span><span class="o">}</span> <span class="o">(</span><span class="n">hpq</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">↔</span> <span class="n">q</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hfg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">h</span> <span class="o">:</span> <span class="n">q</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">hpq.mpr</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">h</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">finprod</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">finprod</span> <span class="n">g</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">propext</span> <span class="n">hpq</span><span class="o">,</span> <span class="n">congr</span><span class="o">,</span> <span class="n">funext</span> <span class="n">x</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hfg</span> <span class="n">x</span> <span class="o">}</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="n">finprod</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∨</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">finprod</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span>
</code></pre></div>



<a name="231244886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231244886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231244886">(Mar 21 2021 at 22:17)</a>:</h4>
<p>Now I have to understand what's wrong in the main file.</p>



<a name="231245024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231245024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231245024">(Mar 21 2021 at 22:20)</a>:</h4>
<p>UPD: <code>simp</code> works, <code>simp only</code> doesn't.</p>



<a name="231247511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231247511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231247511">(Mar 21 2021 at 23:09)</a>:</h4>
<p>Throw in a <code>dsimp</code> before the <code>simp only</code>?</p>



<a name="231254014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231254014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231254014">(Mar 22 2021 at 01:30)</a>:</h4>
<p>I wanted to simplify <code>← finset.coe_union</code> inside the binder. I found a workaround but I wonder <strong>why</strong> <code>simp only</code> fails.</p>



<a name="231254300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231254300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231254300">(Mar 22 2021 at 01:36)</a>:</h4>
<p>I tried using <code>finprod</code>/<code>finsum</code> for partition of unity, and it works very well.</p>



<a name="231465374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231465374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231465374">(Mar 23 2021 at 13:00)</a>:</h4>
<p>A nasty side effect of the new definition and working <code>@[congr]</code> lemmas: now Lean simplifies <code>∑ᶠ x ∈ f '' s, g x</code> to <code>∑ᶠ x (h : ∃ y, y ∈ s ∧ f y = x), g x</code>, so we need to redesign simp lemmas.</p>



<a name="231548116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231548116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231548116">(Mar 23 2021 at 21:38)</a>:</h4>
<p>Yes, I noticed that one too, and wasn't particularly happy about it. :-)</p>



<a name="231549073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231549073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231549073">(Mar 23 2021 at 21:46)</a>:</h4>
<p>What's the preferred form for that then?</p>



<a name="231557727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231557727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231557727">(Mar 23 2021 at 23:06)</a>:</h4>
<p>I feel like a bare <code>x ∈ f '' s</code> should already be considered <code>simp</code> normal form. Perhaps various things wrapped around that should simplify.</p>



<a name="231683414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/231683414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#231683414">(Mar 24 2021 at 18:16)</a>:</h4>
<p>But this is a pretty big refactor: we have simp lemmas for <code>y ∈ f '' s</code>, <code>y ∈ s ∩ t</code>, <code>y ∈ s ∪ t</code>, <code>y ∈ range f</code>. Should we remove (or move to a simp set) all of them? Some of them? I guess this will feel like a regression in some cases.</p>



<a name="232009555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232009555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232009555">(Mar 26 2021 at 18:09)</a>:</h4>
<p>I removed some <code>@[simp]</code> attributes to make linter happy.</p>



<a name="232009597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232009597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232009597">(Mar 26 2021 at 18:09)</a>:</h4>
<p>Now it passes CI and is ready for review.</p>



<a name="232011284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232011284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232011284">(Mar 26 2021 at 18:23)</a>:</h4>
<p>Can you update the PR description to mention the various things I've assumed you've added since you took oven from Kevin and Jason?</p>



<a name="232011708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232011708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232011708">(Mar 26 2021 at 18:27)</a>:</h4>
<p>I should also update the module docstring. I'll do it in 1-h hrs.</p>



<a name="232012283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232012283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232012283">(Mar 26 2021 at 18:31)</a>:</h4>
<p>Should all the <code>finsum_in</code> lemmas be renamed to <code>finsum_mem</code>, now that there is no <code>finsum_in</code> definition any more?</p>



<a name="232140418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232140418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232140418">(Mar 28 2021 at 04:20)</a>:</h4>
<p>I was more busy than I expected. Renamed, fixed compile&amp;lint, applied review suggestions.</p>



<a name="232317475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232317475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232317475">(Mar 29 2021 at 18:54)</a>:</h4>
<p>Ping here.</p>



<a name="232796236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/232796236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#232796236">(Apr 01 2021 at 17:42)</a>:</h4>
<p>This PR is ready for review again.</p>



<a name="233156576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233156576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233156576">(Apr 05 2021 at 10:19)</a>:</h4>
<p>I guess I have a meta-worry here. How much is this API meant to mirror the existing API for <code>finset.prod</code>? Do we intend to require any sort of synchronisation between them, or is it okay if they drift apart?</p>



<a name="233157854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233157854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233157854">(Apr 05 2021 at 10:39)</a>:</h4>
<p>And I just PRed a (new?) lemma about <code>finset.prod</code>...</p>



<a name="233165553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233165553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233165553">(Apr 05 2021 at 12:28)</a>:</h4>
<p>How viable is eventually eliminating almost all uses of <code>finset.prod</code> in lemma statements?</p>



<a name="233165621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233165621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233165621">(Apr 05 2021 at 12:29)</a>:</h4>
<p>With the end goal of any definition using <code>finset.prod</code> coming with a lemma saying "it's equal to finprod"?</p>



<a name="233667287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233667287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233667287">(Apr 08 2021 at 14:59)</a>:</h4>
<p><code>finset.prod</code> and <code>finprod</code> take different approaches. In one case the product is finite "by construction" and does not require proofs of something like <code>set.finite (mul_support f)</code> to apply a lemma; in the other case it's easy to construct a <code>finprod</code> term but one has to prove <code>set.finite (mul_support f)</code> here and there. I think that both approaches have their use cases, and we shouldn't try to eliminate one of them.</p>



<a name="233668098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233668098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233668098">(Apr 08 2021 at 15:01)</a>:</h4>
<p>I mean, we can migrate some parts of the library to <code>finprod</code> (e.g., I think whether it makes sense to use it instead of <code>finsupp.sum</code>) but I see no reason to deprecate <code>finset.prod</code>.</p>



<a name="233670450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233670450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233670450">(Apr 08 2021 at 15:09)</a>:</h4>
<p>I guess my point is that the notation for <code>finsum</code> is much more powerful than that for <code>finset.sum</code>, suggesting it might be acceptable to remove the notation for the latter entirely in order to enable repurposing <code>\sum</code> for the former</p>



<a name="233671536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236355%20finsum/near/233671536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236355.20finsum.html#233671536">(Apr 08 2021 at 15:14)</a>:</h4>
<p>I would prefer to have notation for both cases but we can reserve <code>∑</code> for <code>finsum</code> and use some modifier for <code>finset.sum</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>