---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html">#7138 neighbor set of compl</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="265649872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265649872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265649872">(Dec 21 2021 at 05:47)</a>:</h4>
<p>Resuscitated this old PR by <span class="user-mention" data-user-id="303889">@Alena Gusakov</span></p>
<p>There's an oddness in typeclass inference that I don't understand here. (Edit: this example was silly, there's a better one below.)</p>



<a name="265649961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265649961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alena Gusakov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265649961">(Dec 21 2021 at 05:49)</a>:</h4>
<p>oh no typeclass hell, my favorite</p>



<a name="265649976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265649976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alena Gusakov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265649976">(Dec 21 2021 at 05:49)</a>:</h4>
<p>yeah that's weird, degree is defined on fintypes of vertex neighbors</p>



<a name="265649977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265649977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265649977">(Dec 21 2021 at 05:49)</a>:</h4>
<p>Oh, I see the problem with the code I pasted -- the example I had earlier made more sense.</p>



<a name="265649989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265649989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alena Gusakov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265649989">(Dec 21 2021 at 05:49)</a>:</h4>
<p>ah yeah, card of V</p>



<a name="265650037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265650037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alena Gusakov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265650037">(Dec 21 2021 at 05:50)</a>:</h4>
<p>wait</p>



<a name="265650081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265650081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alena Gusakov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265650081">(Dec 21 2021 at 05:51)</a>:</h4>
<p>is it that the decidability is what lets us work with cardinalities</p>



<a name="265650082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265650082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alena Gusakov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265650082">(Dec 21 2021 at 05:51)</a>:</h4>
<p>it's been a while, sorry</p>



<a name="265650183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265650183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265650183">(Dec 21 2021 at 05:52)</a>:</h4>
<p>Oops, I didn't notice the two <code>v : V</code>'s in that example.  Here's the main one I didn't know what was going on with:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">card_neighbor_set_union_compl_neighbor_set</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">V</span><span class="o">]</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">simple_graph</span> <span class="n">V</span><span class="o">)</span>
  <span class="o">[</span><span class="n">fintype</span> <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)]</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)</span><span class="bp">.</span><span class="n">to_finset.card</span> <span class="bp">=</span> <span class="n">fintype.card</span> <span class="n">V</span> <span class="bp">-</span> <span class="mi">1</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>gives</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="n">v</span> <span class="o">:</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">V</span><span class="o">,</span>
<span class="n">G</span> <span class="o">:</span> <span class="n">simple_graph</span> <span class="n">V</span><span class="o">,</span>
<span class="n">_inst_2</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">↥</span><span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span><span class="o">)</span>
<span class="bp">⊢</span> <span class="n">fintype</span> <span class="bp">↥</span><span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span><span class="o">)</span>
</code></pre></div>
<p>This is the workaround for now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">card_neighbor_set_union_compl_neighbor_set</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">V</span><span class="o">]</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">simple_graph</span> <span class="n">V</span><span class="o">)</span>
  <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_rel</span> <span class="n">G.adj</span><span class="o">]</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)</span><span class="bp">.</span><span class="n">to_finset.card</span> <span class="bp">=</span> <span class="n">fintype.card</span> <span class="n">V</span> <span class="bp">-</span> <span class="mi">1</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="265650299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265650299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265650299">(Dec 21 2021 at 05:55)</a>:</h4>
<p>There must be something somewhere inside these two <code>fintype</code> terms that are subtly different. I checked that they're defeq at least, but that's as far as I've gone.</p>



<a name="265651470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265651470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265651470">(Dec 21 2021 at 06:19)</a>:</h4>
<p>More details:</p>
<p>This fails:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">card_neighbor_set_union_compl_neighbor_set</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">V</span><span class="o">]</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">simple_graph</span> <span class="n">V</span><span class="o">)</span>
  <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">fintype</span> <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)]</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)</span><span class="bp">.</span><span class="n">to_finset.card</span> <span class="bp">=</span> <span class="n">fintype.card</span> <span class="n">V</span> <span class="bp">-</span> <span class="mi">1</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>The output of <code>set_option trace.class_instances true</code> has as its first few lines</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span>  <span class="kd">class</span><span class="bp">-</span><span class="kd">instance</span> <span class="n">resolution</span> <span class="n">trace</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">↥</span><span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span> <span class="n">h</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="bp">...</span>
</code></pre></div>
<p>However, this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">card_neighbor_set_union_compl_neighbor_set</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">V</span><span class="o">]</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">simple_graph</span> <span class="n">V</span><span class="o">)</span>
  <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">fintype</span> <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)]</span> <span class="o">:</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">set.to_finset</span> <span class="n">_</span> <span class="o">(</span><span class="n">G.neighbor_set</span> <span class="n">v</span> <span class="bp">∪</span> <span class="n">G</span><span class="bp">ᶜ.</span><span class="n">neighbor_set</span> <span class="n">v</span> <span class="o">:</span> <span class="n">set</span> <span class="n">V</span><span class="o">)</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">card</span> <span class="bp">=</span> <span class="n">fintype.card</span> <span class="n">V</span> <span class="bp">-</span> <span class="mi">1</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="265941929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237138%20neighbor%20set%20of%20compl/near/265941929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237138.20neighbor.20set.20of.20compl.html#265941929">(Dec 23 2021 at 18:41)</a>:</h4>
<p><span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> Here's the TC issue in the message above. For some reason it's not able to find the <code>fintype</code> instance itself, but if you pass it explicitly it's ok. I'm guessing some reducibility thing is causing it to fail the <code>is_def_eq</code> check.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>