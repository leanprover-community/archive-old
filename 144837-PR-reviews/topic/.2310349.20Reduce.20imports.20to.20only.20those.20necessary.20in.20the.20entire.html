---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html">#10349 Reduce imports to only those necessary in the entire</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261639206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639206">(Nov 16 2021 at 13:24)</a>:</h4>
<p>Out of curiosity, how much time does your tool need to run on the entire library?</p>



<a name="261639353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639353">(Nov 16 2021 at 13:25)</a>:</h4>
<p>Right now its:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">real</span>    <span class="mi">45</span><span class="n">m6</span><span class="o">,</span><span class="mi">682</span><span class="n">s</span>
<span class="n">user</span>    <span class="mi">525</span><span class="n">m1</span><span class="o">,</span><span class="mi">633</span><span class="n">s</span>
<span class="n">sys</span>     <span class="mi">0</span><span class="n">m23</span><span class="o">,</span><span class="mi">632</span><span class="n">s</span>
</code></pre></div>
<p>(on 20 cpu cores)</p>



<a name="261639457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639457">(Nov 16 2021 at 13:26)</a>:</h4>
<p>I still have some ideas to speed it up a bit, but I'm not sure it will ever be less than a couple of hours on a single core</p>



<a name="261639482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639482">(Nov 16 2021 at 13:26)</a>:</h4>
<p>So it's too big to be run by the linter, but reasonable to run by hand once a week.</p>



<a name="261639534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639534">(Nov 16 2021 at 13:26)</a>:</h4>
<p>Yeah that's exactly the sort of thing we were hoping for</p>



<a name="261639656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639656">(Nov 16 2021 at 13:27)</a>:</h4>
<p>Did I mention it's awesome, by the way? :-)</p>



<a name="261639803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639803">(Nov 16 2021 at 13:28)</a>:</h4>
<p>Am I right in thinking that this PR removes both imports which aren't used at all (fantastic), and imports which are used but already imported transitively (a previous topic of contention)? For instance, <code>algebra.algebra.basic</code> no longer imports <code>algebra.module.basic</code>, which I'm almost certain isn't indicating that the former didn't use the latter.</p>



<a name="261639968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261639968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261639968">(Nov 16 2021 at 13:29)</a>:</h4>
<p>Yes, that's right.</p>



<a name="261640077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261640077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261640077">(Nov 16 2021 at 13:30)</a>:</h4>
<p>Is it true that it could increase the number of imports for a given file. E.g., if files A, B were imported in C and D imported C but actually only needed A, B this will swap out D's import of C for A, B?</p>



<a name="261640121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261640121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261640121">(Nov 16 2021 at 13:30)</a>:</h4>
<p>Again, that's right</p>



<a name="261640135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261640135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261640135">(Nov 16 2021 at 13:30)</a>:</h4>
<p>Wow that's great. This is very cool.</p>



<a name="261640139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261640139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261640139">(Nov 16 2021 at 13:30)</a>:</h4>
<p>It also sorts the imports I see <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="261640336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261640336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261640336">(Nov 16 2021 at 13:32)</a>:</h4>
<p>The previous contention was in <a href="#narrow/stream/144837-PR-reviews/topic/.235823/near/223455162">this thread</a>. I'd argue it should leave transitive imports alone, and only prune unused ones, as the transitively-redundant imports frequently stop being redundant when things move, and without them you have a tiresome game of "hunt the lemma" to find which import you need to add back.</p>



<a name="261641826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261641826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261641826">(Nov 16 2021 at 13:43)</a>:</h4>
<p>wow, this looks amazing!</p>



<a name="261642161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261642161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261642161">(Nov 16 2021 at 13:46)</a>:</h4>
<p>I don't really see why we should keep the transitive imports, if we still have the tool and run it once a week. It would mean that when working on a branch, we would never remove imports even if pruning the file (because getting the imports right is hard), and so the problem of hunting a lemma in a dependent file should never appear.</p>



<a name="261642692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261642692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261642692">(Nov 16 2021 at 13:49)</a>:</h4>
<p>Yeah I'm just reiding the original objections way back in that thread and they seem to stem from </p>
<div class="codehilite" data-code-language="Markdown"><pre><span></span><code>Reid Barton: Now imagine A defines a, B defines b and imports A even though it doesn't use it, and someone wanting to write a module C wants to use both a and b. The natural thing to do in general is to import both A and B (otherwise you might have to carefully track down transitive imports to see that actually one is redundant).

Reid Barton: This creates a syntactically unnecessary import of A in C.

Reid Barton: Now suppose someone later notices that B doesn't actually use A at all, so B may as well not import A.

Reid Barton: If you still have the import of A in C, then C will continue to work. If you removed it, however, because it was syntactically unnecessary, now you broke C by changing B, and you have to figure out what module C was supposed to be importing that provided a.
</code></pre></div>
<p>if we now have a (coming soon to Zulip) tool that in the situation that <span class="user-mention" data-user-id="110032">@Reid Barton</span> describes "Now suppose someone later notices that B doesn't actually use A at all, so B may as well not import A." automatically creates a sed script for you that removes the <code>A</code> import from <code>B</code> _and_ adds the <code>A</code> import to all <code>C</code>s that need it still, does this problem go away?</p>



<a name="261642821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261642821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261642821">(Nov 16 2021 at 13:50)</a>:</h4>
<p>Concerning "hunt the lemma". This PR was constructed as follows:</p>
<ol>
<li>Write a bunch of meta code that collects info about declarations, their dependencies, and the import graph into some DAGs.</li>
<li>Do computations on the DAGs and output a sed-script that replaces imports by minimalized imports</li>
<li>Run the sed-script.</li>
</ol>



<a name="261642904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261642904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261642904">(Nov 16 2021 at 13:51)</a>:</h4>
<p>The tooling in 1 (+ a bit of 2) can be easily extended and modified to provide user-commands of the form</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span><span class="n">find_home</span> <span class="n">my_lemma</span>
</code></pre></div>



<a name="261642965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261642965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261642965">(Nov 16 2021 at 13:51)</a>:</h4>
<p>This is on our todo list. It would make the "hunt for the correct import" a lot easier.</p>



<a name="261643374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643374">(Nov 16 2021 at 13:54)</a>:</h4>
<p>I guess what I'm missing is why there is any advantage at all to removing the import of <code>A</code> in <code>C</code> in the above scenario</p>



<a name="261643474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643474">(Nov 16 2021 at 13:55)</a>:</h4>
<p>As far as I can see, with this script in the toolbox, there is also no advantage in keeping it.</p>



<a name="261643498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643498">(Nov 16 2021 at 13:55)</a>:</h4>
<p><a href="https://github.com/alexjbest/dag-tools">https://github.com/alexjbest/dag-tools</a></p>



<a name="261643582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643582">(Nov 16 2021 at 13:56)</a>:</h4>
<p>The downside is you have to know about the script and run the script and wait for it to finish</p>



<a name="261643683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643683">(Nov 16 2021 at 13:56)</a>:</h4>
<p>or just don't remove any import. And wait for the maintainers to do it for you, once a week, in the most efficient way.</p>



<a name="261643720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643720">(Nov 16 2021 at 13:57)</a>:</h4>
<p>ah I'm confused about something then</p>



<a name="261643828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643828">(Nov 16 2021 at 13:57)</a>:</h4>
<p>This is not a linter! So we're not forcing people to write PRs with minimal imports.</p>



<a name="261643832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643832">(Nov 16 2021 at 13:58)</a>:</h4>
<p>Right so another issue is breakage in external consumers</p>



<a name="261643877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643877">(Nov 16 2021 at 13:58)</a>:</h4>
<blockquote>
<p>I guess what I'm missing is why there is any advantage at all to removing the import of <code>A</code> in <code>C</code> in the above scenario</p>
</blockquote>
<p>It lets you reduce the imports of the split file much quicker.</p>



<a name="261643925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261643925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261643925">(Nov 16 2021 at 13:58)</a>:</h4>
<p>What split file?</p>



<a name="261644000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644000">(Nov 16 2021 at 13:59)</a>:</h4>
<p>I guess I'm talking about a slightly different scenario</p>



<a name="261644022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644022">(Nov 16 2021 at 13:59)</a>:</h4>
<p>I've been doing that by hand and despising the transitive imports.</p>



<a name="261644142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644142">(Nov 16 2021 at 14:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261642161">said</a>:</p>
<blockquote>
<p>It would mean that when working on a branch, we would never remove imports even if pruning the file (because getting the imports right is hard), and so the problem of hunting a lemma in a dependent file should never appear.</p>
</blockquote>
<p>This situation still arises when trying to reverse the direction of an import, where you do still need to remove imports manually</p>



<a name="261644149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644149">(Nov 16 2021 at 14:00)</a>:</h4>
<p>Another reason is that you want docgen to not lie to you and give you two files very far apart as close in the import tree</p>



<a name="261644266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644266">(Nov 16 2021 at 14:00)</a>:</h4>
<p>Yes exactly, Eric, but it'll still be much quicker.</p>



<a name="261644298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644298">(Nov 16 2021 at 14:00)</a>:</h4>
<p>I think the advantages of this reduction (build time) far outweigh these potential issues when removing transitive imports.  Note that we already have these issues today, just to a lesser degree.  I don't think anybody adds unnecessary imports unless they need a lemma that's not already imported.</p>



<a name="261644347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644347">(Nov 16 2021 at 14:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261644149">said</a>:</p>
<blockquote>
<p>give you two files very far apart as close in the import tree</p>
</blockquote>
<p>I don't really understand what this means, but of course docgen could just remove imports that are implied by transitivity itself</p>



<a name="261644407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644407">(Nov 16 2021 at 14:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261644298">said</a>:</p>
<blockquote>
<p>I think the advantages of this reduction (build time)</p>
</blockquote>
<p>But removing imports that are implied by transitivity doesn't affect build time, right?</p>



<a name="261644414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644414">(Nov 16 2021 at 14:01)</a>:</h4>
<p>Yeah that's what I was about to say, but nobody has taken over that yet</p>



<a name="261644429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644429">(Nov 16 2021 at 14:01)</a>:</h4>
<p>Otherwise, I would be totally on board</p>



<a name="261644439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644439">(Nov 16 2021 at 14:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261643498">said</a>:</p>
<blockquote>
<p><a href="https://github.com/alexjbest/dag-tools">https://github.com/alexjbest/dag-tools</a></p>
</blockquote>
<p>Oops I posted this link without changing the visibility settings</p>



<a name="261644531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644531">(Nov 16 2021 at 14:02)</a>:</h4>
<p>And there's still the problem of <code>.default</code> files...</p>



<a name="261644550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644550">(Nov 16 2021 at 14:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>, my understanding is that keeping / pruning imported-but-transitive imports should be a fairly straightforward thing to adjust in the script, so it's not an all or nothing choice</p>



<a name="261644625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644625">(Nov 16 2021 at 14:03)</a>:</h4>
<blockquote>
<p>I don't anybody adds an unnecessary import</p>
</blockquote>
<p>Beginners do, because they aren't quite aware of transitivity, so they add each file they pick a lemma from one by one without trying to reduce them.</p>



<a name="261644680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644680">(Nov 16 2021 at 14:03)</a>:</h4>
<p>I think that really this "beginner" behavior is the correct one, and relying on transitivity is questionable</p>



<a name="261644712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644712">(Nov 16 2021 at 14:03)</a>:</h4>
<p>I don't think there are too many authors of mathlib files conciously adding transitive imports in a way that makes it maximally useful to future file splitters anyway</p>



<a name="261644763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644763">(Nov 16 2021 at 14:04)</a>:</h4>
<p>Because relying on transitivity means that the entire import structure is part of the external API.</p>



<a name="261644784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644784">(Nov 16 2021 at 14:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261644149">said</a>:</p>
<blockquote>
<p>Another reason is that you want docgen to not lie to you and give you two files very far apart as close in the import tree</p>
</blockquote>
<p>If you're using "imports by" to find "extensions of the theory in this file" rather than just "critical import paths", the current behavior can be helpful.<br>
<span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261644531">said</a>:</p>
<blockquote>
<p>And there's still the problem of <code>.default</code> files...</p>
</blockquote>
<p><a href="https://github.com/leanprover-community/lean/pull/645">https://github.com/leanprover-community/lean/pull/645</a> is my attempt to expose the information to doc-gen</p>



<a name="261644866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644866">(Nov 16 2021 at 14:04)</a>:</h4>
<p>Ah great! Nice to hear</p>



<a name="261644991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261644991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261644991">(Nov 16 2021 at 14:05)</a>:</h4>
<p>Yeah, but transitive imports are not even theory extension-relevant... Most of the time, they are quite random.</p>



<a name="261645348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645348">(Nov 16 2021 at 14:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261644712">said</a>:</p>
<blockquote>
<p>I don't think there are too many authors of mathlib files conciously adding transitive imports in a way that makes it maximally useful to future file splitters anyway</p>
</blockquote>
<p>Many of the useful transitive imports are the ones that got left behind in a refactor, as those often link to where the core ideas were developed before more dependencies were pulled in that made them redundant</p>



<a name="261645403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645403">(Nov 16 2021 at 14:08)</a>:</h4>
<p>I'd argue imports are the wrong place to put this information. The correct place (which incidentally is more visible and less technical-sounding) is the module docstring.</p>



<a name="261645407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645407">(Nov 16 2021 at 14:08)</a>:</h4>
<p>I agree in practice it's random whether or not "redundant" imports get added (basically if you're going to use both <code>A</code> and <code>B</code> and <code>B</code> imports <code>A</code>, then it depends on which of <code>A</code> and <code>B</code> you discovered that you needed first) but the ones that we do end up with make the library easier to refactor</p>



<a name="261645538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645538">(Nov 16 2021 at 14:09)</a>:</h4>
<p>For having refactored and split convexity files, no not really.</p>



<a name="261645674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645674">(Nov 16 2021 at 14:10)</a>:</h4>
<p>The script can easily output a list of all files that contain direct dependencies of decls in a given file <code>X.lean</code>. So it could also "add" all direct dependencies to the <code>import</code> block.</p>



<a name="261645690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645690">(Nov 16 2021 at 14:10)</a>:</h4>
<p>It seems to me that this import reduction would speed up the local <code>lean --make ...</code> workflow.</p>
<p>E.g., sometimes I alter a file that is lowish in the import hierarchy and then resume working on something higher up. In this situation I sometimes run <code>lean --make src/higher/up/file</code> and get just the oleans I need but I do end up building a bunch of oleans that I don't need because of the imports, right?</p>



<a name="261645886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261645886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261645886">(Nov 16 2021 at 14:12)</a>:</h4>
<blockquote>
<p>The script can easily output a list of all files that contain direct dependencies of decls in a given file <code>X.lean</code>. So it could also "add" all direct dependencies to the <code>import</code> block.</p>
</blockquote>
<p>I think every file would start with <code>import logic.basic</code> then.</p>



<a name="261646028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646028">(Nov 16 2021 at 14:13)</a>:</h4>
<p>Yes, that's kind of why I think the script should just leave alone the imports that it knows are already transitively imported, since either extreme is probably less useful than the ocassionally useful ad-hoc imports we have today.</p>



<a name="261646086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646086">(Nov 16 2021 at 14:13)</a>:</h4>
<p>But certainly having a mode of the script that did that would be useful, and then a human could prune it to "interesting" imports</p>



<a name="261646109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646109">(Nov 16 2021 at 14:13)</a>:</h4>
<p>Or we just make a blacklist of "dumb" imports like logic.basic</p>



<a name="261646172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646172">(Nov 16 2021 at 14:14)</a>:</h4>
<p>And mostly do not show useless imports on docgen</p>



<a name="261646350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646350">(Nov 16 2021 at 14:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261646172">said</a>:</p>
<blockquote>
<p>And mostly do not show useless imports on docgen</p>
</blockquote>
<p>I suspect what constitutes "useful" in docgen is probably worthy of its own Zulip topic / github issue. The current behavior is only the way it is because it was better than nothing at all.</p>



<a name="261646447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646447">(Nov 16 2021 at 14:16)</a>:</h4>
<p>docgen currently shows <code>init.default</code> as an import on every file so it is not like the list is that high quality currently. I don't think I ever noticed this list of imports before.</p>



<a name="261646748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261646748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261646748">(Nov 16 2021 at 14:18)</a>:</h4>
<p>I use it all the time and, yes, <code>init.default</code> being there is annoying, but I end up mentally filtering it because it's always there anyway.</p>



<a name="261647778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261647778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261647778">(Nov 16 2021 at 14:25)</a>:</h4>
<p>Anyways I agree with Eric's comments. Normal programming languages have some kind of control over export lists and/or re-exporting imported names, which forces you to think about the public API of your modules. In Lean we don't have this so we end up relying on implicit re-exports a lot, which in turn means we don't generally provide an "official" way to import a collection of related things (though <code>.default</code> files are sort of like this). In principle I like Johan's idea to add explicit imports for whatever the module uses explicitly, but I worry that mathlib isn't really organized in a way to do this cleanly (I think there will be a lot more stuff than <code>logic.basic</code> imported "everywhere").</p>



<a name="261647913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261647913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261647913">(Nov 16 2021 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span>, is the change Reid and I are advocating for relatively straightforward to implement?</p>



<a name="261648016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261648016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261648016">(Nov 16 2021 at 14:27)</a>:</h4>
<p>It's not so easy to "merge and add it later", because after we merge we throw away all the imports that the change would preserve, with no easy path to add them back</p>



<a name="261649745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261649745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261649745">(Nov 16 2021 at 14:40)</a>:</h4>
<p>Unfortunately I don't think its trivial to do so, I've been thinking about this could work a bit and I think you need to keep track of more data in the algorithm, currently we keep a list of original transitive imports, and updated "correct" imports and work up the dag removing imports as needed (note that what were originally transitive imports can become non-transitive), this is all done in parallel where possible, you'd need to track the original syntactic imports too (rather than just their transitive closure) so you want another dag carried through the whole loop, and I don't know if there is a performance hit there yet with the increased memory usage. Maybe its possible to just do everything at the end instead? But it all requires some effort.<br>
I've spent a lot of energy on this so I don't know if I really have the time / mental energy / inclination when I could be working on other stuff to go and add this feature debug it to ensure its actually correct and prepare another PR (with the inevitable tweaking that will be needed), especially as my perception is that the transitive imports in mathlib files aren't really that useful data/well thought out anyway.<br>
If someone else wants to take it on feel free, you probably don't actually need to modify the tool as you just need to compute the import dag before and after this change, find the syntactic imports before that are still transitive imports after and just add them back in to each file (this will reorder still), but once again I personally still don't find the issue as big enough want to take on myself, there are many more actual features I'd like to implement, e.g. splitting files, finding homes for lemmas etc.<br>
I guess I still don't have a compelling enough example of how the old transitive imports are useful</p>



<a name="261649827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261649827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261649827">(Nov 16 2021 at 14:40)</a>:</h4>
<p>So I picked one of the smaller files near the start of the PR to look at (this is the whole file with comments removed for brevity):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.invertible</span>
<span class="kn">import</span> <span class="n">algebra.field</span>
<span class="kn">import</span> <span class="n">algebra.char_p.basic</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="kn">section</span> <span class="n">field</span>
<span class="kd">variables</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">invertible_of_ring_char_not_dvd</span>
  <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">not_dvd</span> <span class="o">:</span> <span class="bp">¬</span><span class="o">(</span><span class="n">ring_char</span> <span class="n">K</span> <span class="bp">∣</span> <span class="n">t</span><span class="o">))</span> <span class="o">:</span> <span class="n">invertible</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">invertible_of_nonzero</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">not_dvd</span> <span class="o">((</span><span class="n">ring_char.spec</span> <span class="n">K</span> <span class="n">t</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h</span><span class="o">))</span>

<span class="kd">lemma</span> <span class="n">not_ring_char_dvd_of_invertible</span> <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">[</span><span class="n">invertible</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">K</span><span class="o">)]</span> <span class="o">:</span>
  <span class="bp">¬</span><span class="o">(</span><span class="n">ring_char</span> <span class="n">K</span> <span class="bp">∣</span> <span class="n">t</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">ring_char.spec</span><span class="o">,</span> <span class="bp">←</span> <span class="n">ne.def</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">nonzero_of_invertible</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span>
<span class="kd">end</span>

<span class="kd">def</span> <span class="n">invertible_of_char_p_not_dvd</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">[</span><span class="n">char_p</span> <span class="n">K</span> <span class="n">p</span><span class="o">]</span>
  <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">not_dvd</span> <span class="o">:</span> <span class="bp">¬</span><span class="o">(</span><span class="n">p</span> <span class="bp">∣</span> <span class="n">t</span><span class="o">))</span> <span class="o">:</span> <span class="n">invertible</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">invertible_of_nonzero</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">not_dvd</span> <span class="o">((</span><span class="n">char_p.cast_eq_zero_iff</span> <span class="n">K</span> <span class="n">p</span> <span class="n">t</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h</span><span class="o">))</span>

<span class="kd">instance</span> <span class="n">invertible_of_pos</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">K</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">invertible</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">invertible_of_nonzero</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">simpa</span> <span class="o">[</span><span class="n">pos_iff_ne_zero</span><span class="o">]</span> <span class="n">using</span> <span class="n">h.out</span>
<span class="kd">end</span> <span class="n">field</span>

<span class="kn">section</span> <span class="n">division_ring</span>
<span class="kd">variables</span> <span class="o">[</span><span class="n">division_ring</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">K</span><span class="o">]</span>
<span class="kd">instance</span> <span class="n">invertible_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">invertible</span> <span class="o">(</span><span class="n">n.succ</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">invertible_of_nonzero</span> <span class="o">(</span><span class="n">nat.cast_ne_zero.mpr</span> <span class="o">(</span><span class="n">nat.succ_ne_zero</span> <span class="n">_</span><span class="o">))</span>

<span class="kd">instance</span> <span class="n">invertible_two</span> <span class="o">:</span> <span class="n">invertible</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">invertible_of_nonzero</span> <span class="o">(</span><span class="kd">by</span> <span class="n">exact_mod_cast</span> <span class="o">(</span><span class="n">dec_trivial</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">))</span>

<span class="kd">instance</span> <span class="n">invertible_three</span> <span class="o">:</span> <span class="n">invertible</span> <span class="o">(</span><span class="mi">3</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">invertible_of_nonzero</span> <span class="o">(</span><span class="kd">by</span> <span class="n">exact_mod_cast</span> <span class="o">(</span><span class="n">dec_trivial</span> <span class="o">:</span> <span class="mi">3</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">))</span>
<span class="kd">end</span> <span class="n">division_ring</span>
</code></pre></div>



<a name="261649972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261649972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261649972">(Nov 16 2021 at 14:41)</a>:</h4>
<p>The PR removes the imports <code>algebra.invertible</code> and <code>algebra.field</code> (which are where <code>invertible</code> and <code>field</code> are defined respectively) and adds an import of <code>data.nat.choose</code> (which doesn't appear to be used explicitly anywhere, but maybe I overlooked it).</p>



<a name="261650097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261650097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261650097">(Nov 16 2021 at 14:42)</a>:</h4>
<p>Which file is this?</p>



<a name="261650121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261650121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261650121">(Nov 16 2021 at 14:42)</a>:</h4>
<p>sorry! <code>algebra.char_p.invertible</code></p>



<a name="261650759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261650759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261650759">(Nov 16 2021 at 14:47)</a>:</h4>
<p>This is just my subjective opinion, but the old import list makes a lot more sense than the new import list. (Obviously <code>algebra.invertible</code> and <code>algebra.field</code> have to be imported transitively anyways.)</p>



<a name="261650843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261650843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261650843">(Nov 16 2021 at 14:47)</a>:</h4>
<p>Hm this could be an actual bug / merge mistake by me then</p>



<a name="261651088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261651088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261651088">(Nov 16 2021 at 14:49)</a>:</h4>
<p>Maybe also related--<code>data.nat.choose</code> was removed as an import of <code>algebra.char_p.basic</code> in favor of more specific imports</p>



<a name="261651386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261651386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261651386">(Nov 16 2021 at 14:51)</a>:</h4>
<p><code>data.nat.choose</code> is a default-style file so potentially special cased somehow</p>



<a name="261652050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261652050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261652050">(Nov 16 2021 at 14:55)</a>:</h4>
<p>Putting aside <code>data.nat.choose</code>, I think the main question here is whether it is good or bad for a file in which every declaration involves <code>invertible</code> to explicitly import <code>algebra.invertible</code>.</p>



<a name="261655985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261655985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261655985">(Nov 16 2021 at 15:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261649745">said</a>:</p>
<blockquote>
<p>I guess I still don't have a compelling enough example of how the old transitive imports are useful</p>
</blockquote>
<p>Basically, the set of modules that <code>B</code> imports (and hence implicitly re-exports) is an implementation detail of <code>B</code>--this whole tool is justified by that view, because it's saying that if <code>B</code> imports but doesn't actually use <code>A'</code> then we should remove the import of <code>A'</code> in <code>B</code>. Now if <code>C</code> uses <code>A</code> and <code>B</code> but <code>B</code> happens to also import <code>A</code> then removing the import of <code>A</code> in <code>C</code> makes <code>C</code> contingent on this implementation detail of <code>B</code>.</p>



<a name="261656458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261656458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261656458">(Nov 16 2021 at 15:21)</a>:</h4>
<blockquote>
<p>the set of modules that B imports (and hence implicitly re-exports) is an implementation detail of B</p>
</blockquote>
<p>In the case of Lean this is really not true.  The transitively imported modules are very much a part of the public API.  It's not even enough to ignore them by convention, some re-exported items can't be easily ignored at all (for example type-class instances, simp lemmas, etc.).</p>



<a name="261656650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261656650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261656650">(Nov 16 2021 at 15:22)</a>:</h4>
<p>(Note: I'd also personally prefer if we didn't have this re-exporting behavior.  But it's there for better or for worse.)</p>



<a name="261658793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261658793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261658793">(Nov 16 2021 at 15:35)</a>:</h4>
<p>But in practice we don't behave as though the re-exports are part of the API, for example, if we split <code>B</code> into <code>B</code> and <code>B'</code>, nobody is suggesting that we should leave imports in <code>B</code> if they are only needed in <code>B'</code>.</p>



<a name="261659075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261659075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261659075">(Nov 16 2021 at 15:36)</a>:</h4>
<p>From the perspective of a client of <code>B</code>, the sensible thing to do is to explicitly import our other dependencies even if <code>B</code> might happen to re-export them. Of course mathlib is not very stable anyways and it's hard to avoid ever accidentally relying on implicit re-exports, but it's better not to go looking for trouble.</p>



<a name="261660150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261660150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261660150">(Nov 16 2021 at 15:43)</a>:</h4>
<p>Or in a programming context, we might switch out an implementation using lists for one using rbtrees. Now either we continue to re-export lists forever or we break a client that relied on the implicit list re-export. I don't see how this is workable, and it seems to me that Lean 4 will eventually need some form of re-export control</p>



<a name="261660386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261660386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261660386">(Nov 16 2021 at 15:44)</a>:</h4>
<p>So my argument would be that for now, we should have some socially constructed notion of what a module is "supposed" to export and treat it as such for the purpose of deciding what imports we need</p>



<a name="261660478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261660478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261660478">(Nov 16 2021 at 15:45)</a>:</h4>
<p>and that currently, the redundant imports in mathlib are the best approximation we have to this information and it would be harmful to throw that information away</p>



<a name="261660784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261660784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261660784">(Nov 16 2021 at 15:47)</a>:</h4>
<p>I confess I for one am beginning to switch sides and lean toward Eric and Reid's POV now.</p>



<a name="261661810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261661810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261661810">(Nov 16 2021 at 15:53)</a>:</h4>
<p>I'm worried that including transitive imports will lead to enormous import lists, once we start doing serious math.  When we prove the Atiyah-Singer index theorem, will we import modules, vector bundles, manifolds, characteristic classes, Fredholm operators, the Laplacian, the heat kernel, Clifford algebras, pseudodifferential operators, ... all in one file?</p>



<a name="261661974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261661974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261661974">(Nov 16 2021 at 15:54)</a>:</h4>
<p>Well maybe we'll do the original cobordism theory proof avoid avoid he heat kernels ;-)</p>



<a name="261662037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261662037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261662037">(Nov 16 2021 at 15:54)</a>:</h4>
<p>Anyway, surely in such a file there is no reason to say <code>import linear_algebra.basic</code>.</p>



<a name="261704131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261704131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261704131">(Nov 16 2021 at 20:43)</a>:</h4>
<p>One reason I've found in favour of removing all transitive imports is that it makes it easier to do the actually interesting step of import reduction, which certainly can't be done by a script: splitting apart files when only a small fraction of a file requires an expensive import.</p>
<p>If I suspect that a file should be split, e.g. because there are some expensive imports required only for a few declarations near the end, the easiest way to verify this is to delete imports one at a time, checking where the first error appears in the file.</p>
<p>This analysis is much more tedious if some of the imports are already imported transitively.</p>



<a name="261704496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261704496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261704496">(Nov 16 2021 at 20:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261704131">said</a>:</p>
<blockquote>
<p>which certainly can't be done by a script: splitting apart files when only a small fraction of a file requires an expensive import.</p>
</blockquote>
<p>Ooh, we actually had some ideas that could maybe find such files. But we don't have any code yet. Maybe it won't work.</p>



<a name="261704778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261704778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261704778">(Nov 16 2021 at 20:49)</a>:</h4>
<p>This step is the key one if the end goal is reducing total compile time!</p>



<a name="261705105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261705105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261705105">(Nov 16 2021 at 20:52)</a>:</h4>
<p>Hmm, I thought it'd be the other way around. If you have dependencies A → B → C, and most of A depends on C, but only a little bit on B, wouldn't it be easier to discover that if A imports both B and C explicitly?</p>



<a name="261705964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261705964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261705964">(Nov 16 2021 at 21:00)</a>:</h4>
<p>I agree, if you remove all imports implied by transitivity like in this PR, the result may well be a single "expensive" import, and now you have to play hunt the lemma for everything if you want to try removing it.</p>



<a name="261706405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261706405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261706405">(Nov 16 2021 at 21:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261705105">said</a>:</p>
<blockquote>
<p>Hmm, I thought it'd be the other way around. If you have dependencies A → B → C, and most of A depends on C, but only a little bit on B, wouldn't it be easier to discover that if A imports both B and C explicitly?</p>
</blockquote>
<p>This is not what it's about. Have you tried reducing imports yourself? What happens most often is that the transitive imports in intermediate files clutter your imports list and you take 10 more minutes to reduce them to bits.<br>
The fast way of reducing imports is to replace them by their imports (if <code>A</code> imports <code>B</code> and <code>C</code>, you replace <code>import A</code> by <code>import B import C</code>). Transitive imports break that as you can replace them by their imports all the way down (if <code>A</code> imports <code>B</code> and <code>B</code> imports <code>C</code>, you can replace <code>B</code> by <code>C</code> and <code>C</code> by its imports, etc... and never notice that <code>B</code> was not even needed in the first place). The correct thing to do to counter this is to try deleting every import one by one (or with a dichotomy to go a bit faster), which doubles the amount of file recompilation required.</p>



<a name="261706568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261706568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261706568">(Nov 16 2021 at 21:04)</a>:</h4>
<p>In particular, transitive imports are not shortcuts, they are dead ends.</p>



<a name="261707070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261707070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261707070">(Nov 16 2021 at 21:08)</a>:</h4>
<p>Yaël I have no idea what you are trying to say, can you explain another way?</p>



<a name="261707709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261707709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261707709">(Nov 16 2021 at 21:14)</a>:</h4>
<p>One thing that many languages do when you want to import just small pieces of some module is allowing partial imports, like <code>from a.b import x, y, z</code>. It may even contribute to some contextualization just from reading imports. This approach, I think, talks more with the elimination of transitive imports as an attempt to make things more explicit and minimal ("minimal" in the sense that you're carrying out as little context as you need)</p>



<a name="261707929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261707929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261707929">(Nov 16 2021 at 21:16)</a>:</h4>
<p>Yaël's system seems to be: replace import by its imports, see what breaks (as it imports the same things bar that new file). Transitive imports can break this strategy as you think you're removing imports, but you're not.</p>



<a name="261708002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261708002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261708002">(Nov 16 2021 at 21:17)</a>:</h4>
<p>I assume we're in the case where nothing breaks. I don't understand why transitive imports affect this strategy.</p>



<a name="261708144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261708144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261708144">(Nov 16 2021 at 21:18)</a>:</h4>
<p>I assume you should always try to "expand" the "last" imports, and then if there are transitive imports you will notice it because you have two copies of <code>import C</code> and you can just delete one.</p>



<a name="261708400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261708400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261708400">(Nov 16 2021 at 21:20)</a>:</h4>
<p>(I also think this method is kind of misguided because your dependency <code>A</code> may import stuff that only gets used in its proofs, and isn't relevant to clients of <code>A</code>. I agree it works though. The "correct" method is to play hunt-the-lemma with everything you actually use.)</p>



<a name="261708972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261708972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261708972">(Nov 16 2021 at 21:25)</a>:</h4>
<p>I'm more interested in <span class="user-mention" data-user-id="110087">@Scott Morrison</span>'s scenario because this is a situation where I understand the motivation (splitting  off part of a large file which has imports not needed by the rest of the file) but I come to the opposite conclusion.</p>



<a name="261709141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709141">(Nov 16 2021 at 21:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261708400">said</a>:</p>
<blockquote>
<p>(I also think this method is kind of misguided because your dependency <code>A</code> may import stuff that only gets used in its proofs, and isn't relevant to clients of <code>A</code>. I agree it works though. The "correct" method is to play hunt-the-lemma with everything you actually use.)</p>
</blockquote>
<p>But... you aren't gonna check 500 lemmas, are you? Are you also willing to play the even harder "hunt-the-instance" or "hunt-the-simp-lemma"?</p>



<a name="261709337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709337">(Nov 16 2021 at 21:28)</a>:</h4>
<p>You only have to check 500 lemmas if you end up needing 500 imports. The simp lemma/class instance/etc. problem is the hard one, and for that it's good to keep a copy of the original file around to see how it works if you get stuck, but optimistically the simp lemmas/instances should come along with the associated definitions (orphans are bad)</p>



<a name="261709579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709579">(Nov 16 2021 at 21:30)</a>:</h4>
<p>Uh, have you ever reduced imports that way?</p>



<a name="261709758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709758">(Nov 16 2021 at 21:31)</a>:</h4>
<p>Yes</p>



<a name="261709840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709840">(Nov 16 2021 at 21:32)</a>:</h4>
<p>when splitting off part of a module</p>



<a name="261709889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709889">(Nov 16 2021 at 21:32)</a>:</h4>
<p>My strategy (which I think is the same as Yael's, so hopefully I'm just restating) is:</p>
<ul>
<li>For each import, see if removing it results in no errors. If no errors, remove that import.</li>
<li>Now, for each import, replace that import by its own imports, and see what breaks. If nothing, keep the replacement. If it breaks something, decide if the broken chunk makes sense to move to another file.</li>
</ul>



<a name="261709973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261709973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261709973">(Nov 16 2021 at 21:33)</a>:</h4>
<p>The advantage of this strategy is that you can implement it without much thought: you don't need to look at lemmas at all until after errors appears.</p>



<a name="261710030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710030">(Nov 16 2021 at 21:33)</a>:</h4>
<p>If you killed transitive dependencies in the file you're working on then the first step is much more likely to result in an error</p>



<a name="261710039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710039">(Nov 16 2021 at 21:33)</a>:</h4>
<p>The problem with this strategy is that if you skip the first step, you may find an endless chain of replacements of an import by its imports, because actually the import was transitively imported.</p>



<a name="261710099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710099">(Nov 16 2021 at 21:34)</a>:</h4>
<p>But meanwhile you can always ignore transitive dependencies in whatever you are doing in the second step, so you can't possibly come out ahead by having removed them</p>



<a name="261710179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710179">(Nov 16 2021 at 21:35)</a>:</h4>
<p>You don't literally mean an <em>endless</em> chain, do you? I hope mathlib's modules are well-founded <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="261710245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710245">(Nov 16 2021 at 21:35)</a>:</h4>
<p>Sorry. :-) Only bounded below by <code>logic.basic</code>.</p>



<a name="261710322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710322">(Nov 16 2021 at 21:36)</a>:</h4>
<p>When you say "for each import", do you mean you are doing this to every import at once? Or just one?</p>



<a name="261710328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710328">(Nov 16 2021 at 21:36)</a>:</h4>
<p>The problem is "ignore transitive dependencies" is not something I know how to do, without either keeping the import tree in my head, or deleting imports one by one to see what made no difference.</p>



<a name="261710363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710363">(Nov 16 2021 at 21:36)</a>:</h4>
<p>No, I mean remove one import at a time (in the first bullet), or replace one import by its imports at a time (in the second bullet).</p>



<a name="261710417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710417">(Nov 16 2021 at 21:37)</a>:</h4>
<p>So if you could always guess one of the imports that was maximal among the set of all imports of the current file then there would be no problem, right?</p>



<a name="261710450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710450">(Nov 16 2021 at 21:37)</a>:</h4>
<p>I still don't see where the problem is... maybe you can give an example?</p>



<a name="261710567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710567">(Nov 16 2021 at 21:38)</a>:</h4>
<p>I think I want a slightly stronger condition: I want to be able to identify all the maximal imports. Because I'm going to try removing/replacing them one after the other until I find something that suggests a valuable refactor.</p>



<a name="261710622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710622">(Nov 16 2021 at 21:39)</a>:</h4>
<p>Well if you replaced one, then anything else that was maximal before is still maximal.</p>



<a name="261710668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710668">(Nov 16 2021 at 21:39)</a>:</h4>
<p>There's no fundamental problem. I'm just pointing out that my/Yael's algorithm is cheaper to implement if someone has already removed all transitive imports, because then the step in the first bullet point is not needed.</p>



<a name="261710864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710864">(Nov 16 2021 at 21:41)</a>:</h4>
<p>That's not true is it? consider import diamonds (<code>A</code> imports <code>B</code> and <code>C</code>, which both import <code>D</code>--now after expanding <code>A</code> and then <code>B</code>, you have both <code>C</code> and <code>D</code> in your imports)</p>



<a name="261710994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261710994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261710994">(Nov 16 2021 at 21:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261710622">said</a>:</p>
<blockquote>
<p>Well if you replaced one, then anything else that was maximal before is still maximal.</p>
</blockquote>
<p>Yes. I was just referring to your statement "if you could always guess one of the imports that was maximal". If I only have an oracle that identifies a single maximal import, if I investigate that and decide I want to keep it, I don't know how to continue. That is, I want to iterate over all maximal imports.</p>



<a name="261711180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711180">(Nov 16 2021 at 21:44)</a>:</h4>
<p>Yes thanks Scott you're understanding me.</p>



<a name="261711198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711198">(Nov 16 2021 at 21:44)</a>:</h4>
<p>Have you tried using Zorn's Lemma?</p>



<a name="261711203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711203">(Nov 16 2021 at 21:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261710864">said</a>:</p>
<blockquote>
<p>That's not true is it? consider import diamonds (<code>A</code> imports <code>B</code> and <code>C</code>, which both import <code>D</code>--now after expanding <code>A</code> and then <code>B</code>, you have both <code>C</code> and <code>D</code> in your imports)</p>
</blockquote>
<p>Indeed. Once you make multiple expansions you may have transitive imports again. I was mostly imagining the situation where it is rare to proceed past a first expansion: I would typically either reject the first expansion, or go make a PR. :-)</p>



<a name="261711235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711235">(Nov 16 2021 at 21:44)</a>:</h4>
<p>OK I guess I have no idea what you're talking about either <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="261711324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711324">(Nov 16 2021 at 21:45)</a>:</h4>
<p>OK. It's not a big deal. If there is a vote about having more or fewer transitive imports in mathlib I would happily abstain. :-)</p>



<a name="261711390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711390">(Nov 16 2021 at 21:46)</a>:</h4>
<p>I thought we were talking about a situation like this:<br>
We have a long file that we want to split off part of, and we assume that there are some imports that are only needed by the part that's going to be split off.</p>



<a name="261711484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711484">(Nov 16 2021 at 21:47)</a>:</h4>
<p>Would it be possible to end up in a situation in which you could remove one of two imports but not both at the same time, but then removing one would take you to a better (smaller?) list of imports than if you removed the other?</p>



<a name="261711526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711526">(Nov 16 2021 at 21:47)</a>:</h4>
<p>After the split we want to reduce the imports of the original file. That's way easier to do if you didn't delete them all because they were implied by the later modules that the split off part imported.</p>



<a name="261711544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711544">(Nov 16 2021 at 21:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261711484">said</a>:</p>
<blockquote>
<p>Would it be possible to end up in a situation in which you could remove one of two imports but not both at the same time, but then removing one would take you to a better (smaller?) list of imports than if you removed the other?</p>
</blockquote>
<p>Yes that happens all the time.</p>



<a name="261711638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711638">(Nov 16 2021 at 21:48)</a>:</h4>
<p>Ah, no. I'm talking about a different situation --- I am trying to identify, with very little thought, potential splits that can be made.</p>



<a name="261711662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711662">(Nov 16 2021 at 21:48)</a>:</h4>
<p>I'm <em>not</em> worried about the task of cleaning up after actually making the split.</p>



<a name="261711841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711841">(Nov 16 2021 at 21:50)</a>:</h4>
<p>i.e. if I were writing a helpful script for my task, its output would be something like:<br>
"Suggestion: if you don't mind moving the last 37% of file X/Y/Z.lean to a new home, you can remove the import A.B.C"</p>



<a name="261711909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261711909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261711909">(Nov 16 2021 at 21:51)</a>:</h4>
<p>If the script were to group imports as something like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- fully reduced imports</span>
<span class="kn">import</span> <span class="n">foo</span>
<span class="kn">import</span> <span class="n">bar.baz</span>

<span class="c1">-- redundant transitive imports</span>
<span class="kn">import</span> <span class="n">foo.basic</span>
<span class="kn">import</span> <span class="n">bar.basic</span>
</code></pre></div>
<p>then you could always comment out the entire second block when trying to do the type of refactor Scott suggests, and then add them back when you're done</p>



<a name="261712322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261712322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261712322">(Nov 16 2021 at 21:54)</a>:</h4>
<p>That's true. I would not argue that this is worth doing. On the other hand, if you leave out the comments and just have the convention that a newline separates the groups (and the social convention that this is a robot's problem, and you can write whatever you like), then it would be rather lightweight.</p>



<a name="261713109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261713109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261713109">(Nov 16 2021 at 22:00)</a>:</h4>
<p>Suppose docgen only lists imports that are not implied by other imports by transitivity and you use that instead of the actual import list in the file, does that help with the Scott-Yaël method?</p>



<a name="261713346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261713346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261713346">(Nov 16 2021 at 22:02)</a>:</h4>
<p>The asymmetry here is that it's fairly trivial for any automated tool to just ignore redundant imports, but if you throw them away from the source files then  you can't get them back.</p>



<a name="261713896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261713896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261713896">(Nov 16 2021 at 22:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261711662">said</a>:</p>
<blockquote>
<p>I'm <em>not</em> worried about the task of cleaning up after actually making the split.</p>
</blockquote>
<p>One can imagine that this task is currently easy in practice because the stuff that we will later want to split off tends to get added to the bottom of the file and have its imports added to the existing ones (even if they make the existing imports redundant), but if we go deleting all those redundant imports then suddenly the process of making the split is not so easy.</p>



<a name="261715012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261715012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261715012">(Nov 16 2021 at 22:15)</a>:</h4>
<p>This is a fair point. In any case when there are transitive imports it's not particularly more difficult for the Yael/Scott method (particularly if doc-gen can help), so I'll count myself as convinced.</p>



<a name="261715150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261715150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261715150">(Nov 16 2021 at 22:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261713896">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261711662">said</a>:</p>
<blockquote>
<p>I'm <em>not</em> worried about the task of cleaning up after actually making the split.</p>
</blockquote>
<p>One can imagine that this task is currently easy in practice because the stuff that we will later want to split off tends to get added to the bottom of the file and have its imports added to the existing ones (even if they make the existing imports redundant), but if we go deleting all those redundant imports then suddenly the process of making the split is not so easy.</p>
</blockquote>
<p>As mentioned before my argument is that we should have tooling to help us do splits effectively, and that we are quite close to having it. Indeed right now you can split, copy the imports to both files and then either run this tool on each file, or rely on someone running this weekly. I appreciate that's not a 100% trivial but relying on everyone to put a "good" representative selection of transitive imports when there is no guideline / consensus that this is the right thing to be doing doesn't seem that effective either.</p>



<a name="261715303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261715303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261715303">(Nov 16 2021 at 22:18)</a>:</h4>
<p>That said, I have been preparing a version with transitive imports preserved (+- epsilon as always, its hard to make a PR that touches 1000 files without a few things slipping through the cracks), I hope that will be more widely accepted</p>



<a name="261715614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261715614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261715614">(Nov 16 2021 at 22:20)</a>:</h4>
<p>To add to this, if this is something we as a community want to encourage (treating the explicit imports as part of the external API of a file) then we should add some doc pages describing best practices for this</p>



<a name="261716118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261716118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261716118">(Nov 16 2021 at 22:24)</a>:</h4>
<p>I agree that a tool can be of great help as a means to minimize efforts and barriers for other people who want to contribute but then have to adjust their PRs with formatting rules that could be made by the machine. Optimizing imports and formatting files could also be made automatic with the use of <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">git hooks</a>, in particular the <code>pre-commit</code> one</p>



<a name="261716625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261716625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261716625">(Nov 16 2021 at 22:28)</a>:</h4>
<p>To be clear, I'm not advocating that people go out of their way to <em>add</em> redundant imports--certainly not with the current state of Lean/mathlib. I think in the interest of minimizing human efforrt, people should just write whatever imports they would naturally write to get their module to compile, and that will be a reasonably good approximation to the "correct" import set. Also in the interest of minimizing human effort, we shouldn't discard the information of which imports they wrote because it will make it easier to refactor the file later.</p>
<p>I understand there is some degree of tension between having a "natural" set of imports, and removing imports in order to minimize recompilations/critical path of the build. And thanks for working on this by the way--the conversation has been focused on the redundant imports but removing the genuinely unused imports is a great improvement. I sort of entered this conversation on the wrong foot perhaps, because I was pinged in connection with the redundant import issue.</p>



<a name="261717190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261717190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261717190">(Nov 16 2021 at 22:33)</a>:</h4>
<p>Well I did ping you <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="261743054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261743054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261743054">(Nov 17 2021 at 04:41)</a>:</h4>
<p>Ok I have refreshed the branch with a new version that mostly doesn't remove transitive imports, and works better in general, at least the example Reid picked earlier of <code>char_p/invertible</code> now does the right thing.</p>



<a name="261743079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261743079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261743079">(Nov 17 2021 at 04:41)</a>:</h4>
<p>Some lines got reordered in the mess which is a bit unfortunate</p>



<a name="261751431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751431">(Nov 17 2021 at 07:38)</a>:</h4>
<p>There is still something strange with the PR. For instance, in the first file of the diff (<code>abel_ruffini</code>), it adds one import, without removing any. I don't see how this should be possible, if the algorithm is: replace unused imports by the smallest necessary imports, and don't remove imports that are used but not necessary.</p>



<a name="261751464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751464">(Nov 17 2021 at 07:39)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> Maybe one of the existing imports was importing stuff that it didn't use. (I didn't check.)</p>



<a name="261751482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751482">(Nov 17 2021 at 07:39)</a>:</h4>
<p>No import is removed in this example, so they are all necessary.</p>



<a name="261751745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751745">(Nov 17 2021 at 07:44)</a>:</h4>
<p>Could it just be that one of the current imports is not actually needed, and the script "replaced" it with some transitive import, but then left that current import in place because of the recent change in response to the request to not remove transitive imports?</p>



<a name="261751765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751765">(Nov 17 2021 at 07:45)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># on the branch</span>
rg <span class="s2">"import ring_theory.eisenstein_criterion"</span>
archive/100-theorems-list/16_abel_ruffini.lean
<span class="m">8</span>:import ring_theory.eisenstein_criterion
</code></pre></div>



<a name="261751771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751771">(Nov 17 2021 at 07:45)</a>:</h4>
<p>It is currently the only file that imports the Eisenstein criterion</p>



<a name="261751818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751818">(Nov 17 2021 at 07:46)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># on master</span>
rg <span class="s2">"import ring_theory.eisenstein_criterion"</span>
src/field_theory/polynomial_galois_group.lean
<span class="m">10</span>:import ring_theory.eisenstein_criterion
</code></pre></div>



<a name="261751859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261751859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261751859">(Nov 17 2021 at 07:47)</a>:</h4>
<p>So the script removed <code>eisenstein</code> from <code>poly_galois_group</code>, but realised that it should then add the import to <code>abel_ruffini</code> because there it's actually using <code>eisenstein</code>.</p>



<a name="261752366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261752366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261752366">(Nov 17 2021 at 07:55)</a>:</h4>
<p>Ah, thanks for the clarification. The script has to be really clever! (more clever than me, at least :-)</p>



<a name="261752541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261752541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261752541">(Nov 17 2021 at 07:58)</a>:</h4>
<p>Well, it mainly has to have a global view of mathlib (-;</p>



<a name="261753616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261753616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261753616">(Nov 17 2021 at 08:12)</a>:</h4>
<p>I'd be in favor of merging this very quickly, since it will bitrot instantaneously, and now that it shouldn't be controversial. But since there was a big discussion, I'd like other people to check that they're also happy!</p>



<a name="261753800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261753800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261753800">(Nov 17 2021 at 08:15)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="310045">@Eric Wieser</span> <span class="user-mention" data-user-id="110032">@Reid Barton</span></p>



<a name="261757927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261757927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261757927">(Nov 17 2021 at 09:04)</a>:</h4>
<p>Looks great, thanks! What did you end up doing with the transitive imports - did you put them below the necessary ones, or just mix both lists? Either is fine, as we can change that later, no information has been lost; but there are a few places where the imports don't look sorted any more</p>



<a name="261757978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261757978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261757978">(Nov 17 2021 at 09:05)</a>:</h4>
<p>Maybe that's just a merge conflict, which we can solve by just rerunning the script after this gets merged</p>



<a name="261761813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261761813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261761813">(Nov 17 2021 at 09:45)</a>:</h4>
<p>I think we should also merge this quickly.<br>
I'm a little sad we're not removing transitive imports (for the same reasons others have mentioned). I think <em>most</em> transitive imports aren't intentionally stated explicitly, it just so happened during multiple refactors.</p>



<a name="261765472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261765472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261765472">(Nov 17 2021 at 10:21)</a>:</h4>
<p>We can always remove transitive imports later if we change our mind, but once we remove them we can't easily add back the ones that we currently have; so regardless of whether they're good or bad, it makes sense to handle them separately</p>



<a name="261768156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261768156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261768156">(Nov 17 2021 at 10:49)</a>:</h4>
<p>I mixed the lists in the end, but as you say, now they are preserved it should be easy to separate them if desired in another pr</p>



<a name="261768365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261768365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261768365">(Nov 17 2021 at 10:50)</a>:</h4>
<p>I'm happy to merge as is, but perhaps <span class="user-mention" data-user-id="110032">@Reid Barton</span> should take one last look</p>



<a name="261788807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261788807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261788807">(Nov 17 2021 at 14:12)</a>:</h4>
<p>There are some oddities with added <code>tactic.*</code> imports, I see this is semi-manual anyways so would it be okay if I make a branch with some more cleanup?</p>



<a name="261789344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261789344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261789344">(Nov 17 2021 at 14:16)</a>:</h4>
<p>Sure! You can just push directly to that branch</p>



<a name="261789387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261789387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261789387">(Nov 17 2021 at 14:16)</a>:</h4>
<p>I agree some cleanups are needed, my plan was to make them in followups</p>



<a name="261789646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261789646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261789646">(Nov 17 2021 at 14:18)</a>:</h4>
<p>And yes tactic* is never removed at the moment as this is quite difficult to automatically work out which tactics are used (probably one can do this with the ast export but thats just a whole extra layer of complexity), hence they are "added" a lot when they were there transitively.</p>



<a name="261791691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261791691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261791691">(Nov 17 2021 at 14:31)</a>:</h4>
<p>there's really a large number of files where the only change was to reorder imports, I'm guessing it's at least 25% of all the files touched</p>



<a name="261792697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261792697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261792697">(Nov 17 2021 at 14:38)</a>:</h4>
<p>hm the script itself wasn't meant to do that, it probably happened due to me doing things in two stages (one with a more advanced check)</p>



<a name="261792712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261792712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261792712">(Nov 17 2021 at 14:38)</a>:</h4>
<p>I'll try and revert  some</p>



<a name="261793246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261793246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261793246">(Nov 17 2021 at 14:43)</a>:</h4>
<p>Are you changing anything in a branch? I'll fix these based off sed6 and push, just want to make sure we don't clash</p>



<a name="261794232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261794232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261794232">(Nov 17 2021 at 14:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/10349/files#diff-7d4c3526d625e820fa942e2fe444349ccb8c2199032e9303a26a737cce3d414d">https://github.com/leanprover-community/mathlib/pull/10349/files#diff-7d4c3526d625e820fa942e2fe444349ccb8c2199032e9303a26a737cce3d414d</a><br>
I think this change is bad, because it will tend to make <code>interval_cases</code> not work for new users for mysterious reasons (the instances it needs are in those imports, and there's no other reason to import those files or way to find them)</p>



<a name="261794266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261794266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261794266">(Nov 17 2021 at 14:50)</a>:</h4>
<p>I am currently in the middle of a giant <code>git add -p</code></p>



<a name="261794439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261794439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261794439">(Nov 17 2021 at 14:51)</a>:</h4>
<p>where I'm manually judging whether the changes were just reorderings, which usually isn't too hard...</p>



<a name="261795438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261795438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261795438">(Nov 17 2021 at 14:58)</a>:</h4>
<p>Yes I agree</p>



<a name="261795536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261795536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261795536">(Nov 17 2021 at 14:59)</a>:</h4>
<p>Ok I'll wait to see the result then <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> thanks!</p>



<a name="261795894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261795894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261795894">(Nov 17 2021 at 15:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261794232">said</a>:</p>
<blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/pull/10349/files#diff-7d4c3526d625e820fa942e2fe444349ccb8c2199032e9303a26a737cce3d414d">https://github.com/leanprover-community/mathlib/pull/10349/files#diff-7d4c3526d625e820fa942e2fe444349ccb8c2199032e9303a26a737cce3d414d</a><br>
I think this change is bad, because it will tend to make <code>interval_cases</code> not work for new users for mysterious reasons (the instances it needs are in those imports, and there's no other reason to import those files or way to find them)</p>
</blockquote>
<p>This is one of the few changes that made tests fail, I manually reverted something similar for control/traversible where the tactic (almost) works without the lemmas in scope, but it certainly violates the principle of least surprise to be able to import a tactic that doesn't function without additional imports</p>



<a name="261796366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261796366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261796366">(Nov 17 2021 at 15:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261795894">said</a>:</p>
<blockquote>
<p>I manually reverted something similar for control/traversible where the tactic (almost) works without the lemmas in scope</p>
</blockquote>
<p>Which tactic?</p>



<a name="261796561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261796561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261796561">(Nov 17 2021 at 15:06)</a>:</h4>
<p>The derive handler for traversible</p>



<a name="261796576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261796576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261796576">(Nov 17 2021 at 15:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261794439">said</a>:</p>
<blockquote>
<p>where I'm manually judging whether the changes were just reorderings, which usually isn't too hard...</p>
</blockquote>
<p>Is it worth a warmup PR that just sorts all imports in all files?</p>



<a name="261796629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261796629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261796629">(Nov 17 2021 at 15:06)</a>:</h4>
<p>That should be a straightforward python script that doesn't need any knowledge of the lean import graph</p>



<a name="261796661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261796661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261796661">(Nov 17 2021 at 15:06)</a>:</h4>
<p>Definitely not, currently too much hand holding (of the import optimizer) is required so introducing merge conflicts just makes more work</p>



<a name="261796702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261796702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261796702">(Nov 17 2021 at 15:07)</a>:</h4>
<p>It might have been a good idea before starting this but not in the current state yeah</p>



<a name="261798034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261798034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261798034">(Nov 17 2021 at 15:16)</a>:</h4>
<p>By the way I forget--is it theoretically possible for reordering imports to cause a file to break?</p>



<a name="261798381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261798381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261798381">(Nov 17 2021 at 15:18)</a>:</h4>
<p>Yes, it can affect the order of <code>ext</code> lemmas</p>



<a name="261798413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261798413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261798413">(Nov 17 2021 at 15:18)</a>:</h4>
<p>And probably <code>instance</code>s, <code>simp</code> lemmas, ...</p>



<a name="261798486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261798486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261798486">(Nov 17 2021 at 15:18)</a>:</h4>
<p><del>More simply, I think a lean metaprogram can ask "is this imported yet", and fail if its not</del> (I'm not so sure about this)</p>



<a name="261798903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261798903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261798903">(Nov 17 2021 at 15:21)</a>:</h4>
<p>Yes, and its not just theoretical, I think at least once when fixing things up last night I reordered imports for this reason</p>



<a name="261798946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261798946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261798946">(Nov 17 2021 at 15:21)</a>:</h4>
<p>Though most of them are just mistakes in the way I applied the tools</p>



<a name="261837718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261837718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261837718">(Nov 17 2021 at 19:46)</a>:</h4>
<p>I'm also making similar changes to <code>tactic.equiv_rw</code> and <code>tactic.tfae</code> to make them re-export stuff they morally depend on</p>



<a name="261838566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261838566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261838566">(Nov 17 2021 at 19:51)</a>:</h4>
<p>actually every version of <code>tactic.tfae</code> I found imports <code>data.list.tfae</code>, so I don't know why the script added <code>data.list.tfae</code> as an import to a couple of other modules</p>



<a name="261839118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261839118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261839118">(Nov 17 2021 at 19:55)</a>:</h4>
<p>Huh thats weird yeah</p>



<a name="261840774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261840774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261840774">(Nov 17 2021 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span> <a href="https://github.com/leanprover-community/mathlib/tree/rwbarton-imports">branch#rwbarton-imports</a> is my current state, it is on top of your PR, with a smaller diff to master</p>



<a name="261840800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261840800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261840800">(Nov 17 2021 at 20:05)</a>:</h4>
<p>Thank you!</p>



<a name="261840808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261840808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261840808">(Nov 17 2021 at 20:05)</a>:</h4>
<p>still building it locally but I expect it should succeed</p>



<a name="261840930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261840930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261840930">(Nov 17 2021 at 20:06)</a>:</h4>
<p>Ok, I'll take a look and pull it into my branch then, we have to wait for CI eventually anyways</p>



<a name="261841248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261841248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261841248">(Nov 17 2021 at 20:08)</a>:</h4>
<p>There's still some weird stuff like <code>data.rat.enumerable</code> had its import list reduced like</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">-import data.rat</span>
 import set_theory.cardinal
</code></pre></div>
<p>because "obviously" we have <code>set_theory.cardinal</code> -&gt; <code>data.nat.enat</code> -&gt; <code>tactic.norm_num</code> -&gt; <code>data.rat.cast</code>, I didn't fix this or look for other things like it but now the diff is more reviewable</p>



<a name="261841334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261841334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261841334">(Nov 17 2021 at 20:09)</a>:</h4>
<p>Right I also did a merge with master, wasn't on purpose but I guess it is okay</p>



<a name="261841559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261841559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261841559">(Nov 17 2021 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire/near/261791691">said</a>:</p>
<blockquote>
<p>I'm guessing it's at least 25% of all the files touched</p>
</blockquote>
<p>this guess was stunningly accurate <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="261842008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261842008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261842008">(Nov 17 2021 at 20:14)</a>:</h4>
<p>oh was it, I didn't even notice haha</p>



<a name="261856167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261856167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261856167">(Nov 17 2021 at 21:59)</a>:</h4>
<p>It builds <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="261865675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261865675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261865675">(Nov 17 2021 at 23:28)</a>:</h4>
<p>I recalculated one stat: now the longest import chain is only 130 (from ~139)</p>



<a name="261865784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261865784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261865784">(Nov 17 2021 at 23:30)</a>:</h4>
<p>Is it worth running the speedbot on this PR to see if it improves compilation speeds?</p>



<a name="261866094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261866094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261866094">(Nov 17 2021 at 23:32)</a>:</h4>
<p><span class="user-mention" data-user-id="256311">@Jannis Limperg</span>, would you mind running the benchmark bot?</p>



<a name="261866133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261866133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261866133">(Nov 17 2021 at 23:32)</a>:</h4>
<p>Its plausible that it might speed up a little bit on a build of all of mathlib, but partial recompilation is where there is the most potential gain, I'm not sure how much time in a mathlib build is wasted just waiting around if you only have a couple of cores.</p>
<p>Edit: actually thinking about it more I'm even more quite curious, there are definitely a few things that will have decreased (e.g. simp sets and typeclasses instances in the environment) that will affect build speed, so I have no idea what the affect is</p>



<a name="261867909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261867909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261867909">(Nov 17 2021 at 23:55)</a>:</h4>
<p>Just the fact that you've reduced the longest chain should have an effect, as well.</p>



<a name="261920749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261920749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261920749">(Nov 18 2021 at 12:33)</a>:</h4>
<p>I just started a benchmark for this PR against current master.</p>



<a name="261990002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261990002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261990002">(Nov 18 2021 at 21:01)</a>:</h4>
<p><span class="user-mention" data-user-id="256311">@Jannis Limperg</span> did the benchmark finish already?</p>



<a name="261990325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/261990325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#261990325">(Nov 18 2021 at 21:03)</a>:</h4>
<p>Just now, I did two runs per commit. No difference whatsoever, both commits (2f3b18529a81046a890dae6ef52dbad851e56707 and 6e4d6b3f7d3733781df4bf704b5878f18295ddb6) take 1h50m (on my Desktop, so not the usual build bot) with 4 threads.</p>



<a name="262028605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262028605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262028605">(Nov 19 2021 at 05:23)</a>:</h4>
<p>Thanks! Well, in some sense that was expected. Because for a full compile, threads weren't idling too much anyways.</p>



<a name="262028607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262028607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262028607">(Nov 19 2021 at 05:23)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="2494">@maintainers</span> Shall we merge this?</p>



<a name="262048773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262048773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262048773">(Nov 19 2021 at 10:19)</a>:</h4>
<p>Ooh, it looks like Reid's branch isn't merged into this branch yet. <span class="user-mention" data-user-id="127136">@Alex J. Best</span> could you please do that?</p>



<a name="262050501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262050501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262050501">(Nov 19 2021 at 10:38)</a>:</h4>
<p>Should we pull it off the queue?</p>



<a name="262051581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262051581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262051581">(Nov 19 2021 at 10:50)</a>:</h4>
<p>Sorry, GH is trolling me <em>again</em></p>



<a name="262051611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262051611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262051611">(Nov 19 2021 at 10:50)</a>:</h4>
<p>I'm very sure I hit F5 on the page, and it didn't show me the updates.</p>



<a name="262051628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262051628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262051628">(Nov 19 2021 at 10:50)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> So no, we don't need to pull it off the queue. All is fine.</p>



<a name="262057808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262057808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262057808">(Nov 19 2021 at 12:04)</a>:</h4>
<p><img alt=":merge:" class="emoji" src="https://zulip-avatars.s3.amazonaws.com/3121/emoji/images/18527.png" title="merge"></p>



<a name="262269972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262269972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262269972">(Nov 22 2021 at 00:43)</a>:</h4>
<p>I'm looking at the diff just now, and what the hell is going on with the alphabetical order?</p>



<a name="262270024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262270024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262270024">(Nov 22 2021 at 00:44)</a>:</h4>
<p>I can't tell what rule the algorithm followed to order the imports. It got some right, but most wrong.</p>



<a name="262271658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262271658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262271658">(Nov 22 2021 at 01:25)</a>:</h4>
<p>I think at that time it was approximately necessary imports first alphabetised then transitive, but I'm not 100% sure. Certainly in the end a fair bit of manual tweaking was done too, so I wouldn't claim the imports were put in any specific order anymore</p>



<a name="262271712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%2310349%20Reduce%20imports%20to%20only%20those%20necessary%20in%20the%20entire/near/262271712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.2310349.20Reduce.20imports.20to.20only.20those.20necessary.20in.20the.20entire.html#262271712">(Nov 22 2021 at 01:26)</a>:</h4>
<p>Some things like the archive were just done by hand as making the one fix there was easier than teaching the tool about the archive directory</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>