---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.237084.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html">#7084</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="234315729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234315729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234315729">(Apr 13 2021 at 12:30)</a>:</h4>
<p>The nat smul refactor builds, and the <code>archive</code> and <code>test</code> directories also. Now it's <code>leanchecker</code> who is unhappy, and I don't know what to do about this.</p>



<a name="234325135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234325135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234325135">(Apr 13 2021 at 13:33)</a>:</h4>
<p>I'm really looking forward to this PR. (Or perhaps there is a follow-up for <code>int</code> smul?) I just ran into a <code>smul_with_zero.to_has_scalar = finsupp.has_scalar</code> goal.</p>



<a name="234326606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234326606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234326606">(Apr 13 2021 at 13:41)</a>:</h4>
<p>For what type of finsupp?</p>



<a name="234327257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234327257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234327257">(Apr 13 2021 at 13:44)</a>:</h4>
<p>I'm building the free R-linear completion of a category, so the morphisms are <code>R</code>-valued finsupps.</p>



<a name="234327308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234327308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234327308">(Apr 13 2021 at 13:45)</a>:</h4>
<p>I then show that this category is preadditive, which adds an instance of <code>add_comm_group</code> for each hom type.</p>



<a name="234327415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234327415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234327415">(Apr 13 2021 at 13:45)</a>:</h4>
<p>Then a moment later a proof picks up the <code>int.module</code> instance from the <code>add_comm_group</code>, and then we have two different <code>has_scalar</code>.</p>



<a name="234327506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234327506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234327506">(Apr 13 2021 at 13:46)</a>:</h4>
<p>Yes, there is a follow-up for ints, but hopefully all the difficulties will have been solved with this one, and the other one will be straightforward.</p>



<a name="234327607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234327607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234327607">(Apr 13 2021 at 13:46)</a>:</h4>
<p>(I was thinking that all the difficulties for this one had been solved, so you can imagine by disappointment when seeing the leanchecker failure :-)</p>



<a name="234328020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234328020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234328020">(Apr 13 2021 at 13:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> I just want to give you a big big thank you for this refactor! Know that I'm cheering you on!</p>



<a name="234331244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234331244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234331244">(Apr 13 2021 at 14:07)</a>:</h4>
<p>Yes this is a lot of work to solve a kind of rare but actually very annoying when it happens to you problem</p>



<a name="234363963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234363963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234363963">(Apr 13 2021 at 17:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234315729">said</a>:</p>
<blockquote>
<p>The nat smul refactor builds, and the <code>archive</code> and <code>test</code> directories also. Now it's <code>leanchecker</code> who is unhappy, and I don't know what to do about this.</p>
</blockquote>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> , I am afraid your wisdom would be be needed on this one :-(</p>



<a name="234364012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234364012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234364012">(Apr 13 2021 at 17:02)</a>:</h4>
<p>I can't reproduce this locally. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="234364155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234364155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234364155">(Apr 13 2021 at 17:03)</a>:</h4>
<p>Argh!</p>



<a name="234367980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234367980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234367980">(Apr 13 2021 at 17:27)</a>:</h4>
<p>Last time leanchecker did something hard to reproduce, wasn't it an olean cache hash collision? Could that have happened again?</p>



<a name="234370158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234370158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234370158">(Apr 13 2021 at 17:40)</a>:</h4>
<p>When I did <code>lean --make</code> after <code>leanproject up</code>, it <em>did</em> recompile some files.  So maybe there is indeed some issue with the cache.</p>



<a name="234379280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234379280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234379280">(Apr 13 2021 at 18:41)</a>:</h4>
<p>Same here: after <code>leanproject up</code> , then doing <code>lean --make src</code> recompiles some files, so there is something fishy with the cache.</p>



<a name="234383424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234383424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234383424">(Apr 13 2021 at 19:08)</a>:</h4>
<p>You can add a docstring somewhere in <code>logic/basic</code> to make the CI recompile the whole library.</p>



<a name="234386836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234386836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234386836">(Apr 13 2021 at 19:31)</a>:</h4>
<p>Perhaps bumping the hash from 32 to 64 bit (or, optimistically SHA1 or similar) can't wait till lean 4</p>



<a name="234390104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234390104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234390104">(Apr 13 2021 at 19:54)</a>:</h4>
<p>I am assuming that something with probability <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo>−</mo><mn>32</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{-32}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> didn't just happen twice?</p>



<a name="234390568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234390568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234390568">(Apr 13 2021 at 19:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234383424">said</a>:</p>
<blockquote>
<p>You can add a docstring somewhere in <code>logic/basic</code> to make the CI recompile the whole library.</p>
</blockquote>
<p>Good idea, I've just done that (although if the problem is that two olean files get the same hash, this shouldn't change after this).</p>



<a name="234422037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234422037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234422037">(Apr 14 2021 at 00:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234390104">said</a>:</p>
<blockquote>
<p>I am assuming that something with probability <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo>−</mo><mn>32</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{-32}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> didn't just happen twice?</p>
</blockquote>
<p>Well it might be closer to 2^-16 because of birthday problems, although this still seems a bit unlikely. It might be a weakness in the hash function</p>



<a name="234422209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234422209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234422209">(Apr 14 2021 at 00:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234390568">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234383424">said</a>:</p>
<blockquote>
<p>You can add a docstring somewhere in <code>logic/basic</code> to make the CI recompile the whole library.</p>
</blockquote>
<p>Good idea, I've just done that (although if the problem is that two olean files get the same hash, this shouldn't change after this).</p>
</blockquote>
<p>Docstrings should be in the olean files (because they are used by hovers in downstream files), so adding a docstring should change the hash of that file and all its dependents.</p>



<a name="234448346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234448346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234448346">(Apr 14 2021 at 06:37)</a>:</h4>
<p>It's passing CI! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>
<p>Anyone planning on reading through it all? :-)</p>



<a name="234454440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234454440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234454440">(Apr 14 2021 at 07:36)</a>:</h4>
<p>I suggest that we merge this asap.</p>



<a name="234454510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234454510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234454510">(Apr 14 2021 at 07:37)</a>:</h4>
<p>I'll take a look at it now, but, as with most of these massive refactors, I don't think there is much to be reviewd, once CI is happy.</p>



<a name="234455219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234455219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234455219">(Apr 14 2021 at 07:43)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">algebra_nat</span> <span class="n">ℕ</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">algebra.id</span> <span class="n">ℕ</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>
<p>Is that expected? I guess it's a diamond that should be solved in a future PR? By adding even more fields to <code>semiring</code>?</p>



<a name="234456737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234456737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234456737">(Apr 14 2021 at 07:55)</a>:</h4>
<p>Doesn't <a href="https://leanprover-community.github.io/mathlib_docs/find/algebra.id">docs#algebra.id</a> use the smul found by typeclass search?</p>



<a name="234456828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234456828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234456828">(Apr 14 2021 at 07:56)</a>:</h4>
<p>I expect that the problem is <code>to_ring_hom</code></p>



<a name="234456860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234456860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234456860">(Apr 14 2021 at 07:56)</a>:</h4>
<p>I think the problem is the use of to_ring_hom</p>



<a name="234456911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234456911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234456911">(Apr 14 2021 at 07:56)</a>:</h4>
<p>That should probably be <code>{ smul := (\smul), ..(ring_hom.id R).to_algebra}</code></p>



<a name="234456976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234456976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234456976">(Apr 14 2021 at 07:57)</a>:</h4>
<p>Possibly then needing a manual proof of <code>smul_def' :=</code></p>



<a name="234457060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234457060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234457060">(Apr 14 2021 at 07:58)</a>:</h4>
<p>That sounds like something that is actually fixable in master independent of this PR</p>



<a name="234457151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234457151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234457151">(Apr 14 2021 at 07:59)</a>:</h4>
<p>but <code>nat.cast_ring_hom nat</code> is not defeq to <code>ring_hom.id nat</code>, is it?</p>



<a name="234457454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234457454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234457454">(Apr 14 2021 at 08:00)</a>:</h4>
<p>This PR is only supposed to solve <code>smul</code> issues. And</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.normed_space.basic</span>
<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">@</span><span class="n">algebra_nat</span> <span class="n">ℕ</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">to_has_scalar</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">@</span><span class="n">algebra.id</span> <span class="n">ℕ</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">to_has_scalar</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>works fine. So this must be something with the other fields.</p>



<a name="234457882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234457882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234457882">(Apr 14 2021 at 08:03)</a>:</h4>
<p>Ok, understood.</p>



<a name="234457975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234457975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234457975">(Apr 14 2021 at 08:04)</a>:</h4>
<p>Indeed, what fails is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">nat.cast_ring_hom</span> <span class="n">ℕ</span> <span class="bp">=</span> <span class="n">ring_hom.id</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>
<p>This will probably be solved by Lean4-like numerics, i.e., embedding another data field containing the cast from nat into your ring as data.</p>



<a name="234458057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234458057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234458057">(Apr 14 2021 at 08:04)</a>:</h4>
<p>One question I have (but it's minor) is whether we want to keep <code>nsmul</code> as a name.</p>



<a name="234458110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234458110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234458110">(Apr 14 2021 at 08:05)</a>:</h4>
<p>Now that <code>\bul\N</code> is gone, I wonder if it should all be renamed to <code>nat_smul</code>. But this can perfectly well be done in a follow-up PR.</p>



<a name="234458606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234458606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234458606">(Apr 14 2021 at 08:09)</a>:</h4>
<p>Thanks a lot for writing these massive docs: <a href="https://github.com/leanprover-community/mathlib/pull/7084/files#diff-9860a3e2f558fa016e7026f97d27d9196714b9948782edcc6b572689d674d839R248">https://github.com/leanprover-community/mathlib/pull/7084/files#diff-9860a3e2f558fa016e7026f97d27d9196714b9948782edcc6b572689d674d839R248</a></p>



<a name="234458965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234458965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234458965">(Apr 14 2021 at 08:12)</a>:</h4>
<p>This is just moved from another file, since this library note should appear earlier than it used to be. But I indeed had written this, some time ago, for metric spaces :-)</p>



<a name="234459003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234459003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234459003">(Apr 14 2021 at 08:12)</a>:</h4>
<p>Aha, I see.</p>



<a name="234459019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234459019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234459019">(Apr 14 2021 at 08:13)</a>:</h4>
<p>Should it maybe just be put in a file on its own?</p>



<a name="234459025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234459025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234459025">(Apr 14 2021 at 08:13)</a>:</h4>
<p>It doesn't even mention groups! :-)</p>



<a name="234459058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234459058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234459058">(Apr 14 2021 at 08:13)</a>:</h4>
<p>Anyway, I also meant "thanks" for writing these docs: <a href="https://github.com/leanprover-community/mathlib/pull/7084/files#diff-9860a3e2f558fa016e7026f97d27d9196714b9948782edcc6b572689d674d839R304">https://github.com/leanprover-community/mathlib/pull/7084/files#diff-9860a3e2f558fa016e7026f97d27d9196714b9948782edcc6b572689d674d839R304</a></p>



<a name="234474834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234474834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234474834">(Apr 14 2021 at 10:23)</a>:</h4>
<p>There is this annoyance in category theory that the two "canonical" examples of abelian categories are Abelian Groups and R-modules, and every mathematician knows that an abelian group "is" a Z-module, but of course in practice life isn't so easy. In the future one can imagine this getting a little easier.</p>



<a name="234482588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234482588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234482588">(Apr 14 2021 at 11:32)</a>:</h4>
<p>Hooray! bors succesfully built the PR. A couple more hours till the linting is done, and then it's in mathlib (-;</p>



<a name="234491211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234491211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234491211">(Apr 14 2021 at 12:42)</a>:</h4>
<p>Is it expected that <code>leanchecker</code> time increased from ~35 to ~60 minutes after this PR? (Is there anything we can do about it?)</p>



<a name="234491328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234491328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234491328">(Apr 14 2021 at 12:43)</a>:</h4>
<p>Compile time apparently dropped by 6 minutes, because several slow proofs were refactored.</p>



<a name="234491359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234491359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234491359">(Apr 14 2021 at 12:43)</a>:</h4>
<p>So hopefully <code>leanchecker</code> sees similar benefits?</p>



<a name="234492012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234492012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234492012">(Apr 14 2021 at 12:47)</a>:</h4>
<p>I guess I'm seeing quite the opposite: <a href="https://github.com/leanprover-community/mathlib/runs/2342200929?check_suite_focus=true">the previous <code>staging</code> build</a>, <a href="https://github.com/leanprover-community/mathlib/runs/2342466534?check_suite_focus=true">the current one with #7084</a></p>



<a name="234519968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234519968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234519968">(Apr 14 2021 at 15:25)</a>:</h4>
<p>I think the reason is that there is still something fishy with the cache/hash: now when I do <code>leanproject up</code> on mathlib master, and then <code>lean --make</code>, then it starts recompiling stuff. The <code>leanchecker</code> step certainly had to do this recompiling step before exporting everything and checking it with <code>leanchecker</code>, which would explain the additional time.</p>



<a name="234520206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234520206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234520206">(Apr 14 2021 at 15:26)</a>:</h4>
<p>This is a question relating to the consequences of this PR.  The lemma below works with this proof.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.int.basic</span>

<span class="kd">lemma</span> <span class="n">nat_smul</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">•</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">a</span> <span class="k">with</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">zero_nsmul</span><span class="o">]</span> <span class="o">},</span> <span class="c1">--why not simp, and that's it?</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">ha</span><span class="o">,</span> <span class="n">succ_nsmul</span><span class="o">]</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>
<p>However, the "old" proof used to be</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">nat_smul</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">•</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[(</span><span class="bp">•</span><span class="o">)]</span>
</code></pre></div>
<p>I actually do not mind about the longer proof, but I have two questions.</p>
<ul>
<li>Am I missing a simple proof of the lemma?</li>
<li>Why does <code>zero_nsmul</code>, which is a <code>simp</code> lemma, have to be explicitly mentioned in the first proof above?</li>
</ul>
<p>Thanks!</p>



<a name="234520627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234520627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234520627">(Apr 14 2021 at 15:29)</a>:</h4>
<p>The reason is that you are too early in the import hierarchy, before the semimodule structure is registered. If you do it later in the hierarchy, <code>by simp</code> is enough.</p>



<a name="234520729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234520729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234520729">(Apr 14 2021 at 15:29)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.normed_space.basic</span>

<span class="kd">lemma</span> <span class="n">nat_smul</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">•</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span>
</code></pre></div>



<a name="234520833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234520833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234520833">(Apr 14 2021 at 15:30)</a>:</h4>
<p>Great, thanks!</p>
<p>Also:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.module.basic</span>

<span class="kd">lemma</span> <span class="n">nat_smul</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">•</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">a</span> <span class="k">with</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">[</span><span class="n">ha</span><span class="o">,</span> <span class="n">succ_nsmul</span><span class="o">]</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>
<p>and even, like Sébastien's, </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.module.basic</span>

<span class="kd">lemma</span> <span class="n">nat_smul</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">•</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span>
</code></pre></div>



<a name="234521125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234521125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234521125">(Apr 14 2021 at 15:31)</a>:</h4>
<p>Note that <code>zero_nsmul</code> is not a simp lemma, because it is superseded by <code>zero_smul</code> later on.</p>



<a name="234521385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234521385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234521385">(Apr 14 2021 at 15:33)</a>:</h4>
<p>Ok, thanks a lot for the explanation!  I really like this refactor and I am getting used to it!</p>



<a name="234523499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234523499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234523499">(Apr 14 2021 at 15:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234521125">said</a>:</p>
<blockquote>
<p>Note that <code>zero_nsmul</code> is not a simp lemma, because it is superseded by <code>zero_smul</code> later on.</p>
</blockquote>
<p>Should it be a simp lemma until the superseding lemma is created?</p>



<a name="234527274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234527274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234527274">(Apr 14 2021 at 16:07)</a>:</h4>
<p>That's what I did initially, but the <code>simp_nf</code> linter complained. Since it is only the case in a few files, I don't think it matters.</p>



<a name="234527734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234527734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234527734">(Apr 14 2021 at 16:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234519968">said</a>:</p>
<blockquote>
<p>I think the reason is that there is still something fishy with the cache/hash: now when I do <code>leanproject up</code> on mathlib master, and then <code>lean --make</code>, then it starts recompiling stuff. The <code>leanchecker</code> step certainly had to do this recompiling step before exporting everything and checking it with <code>leanchecker</code>, which would explain the additional time.</p>
</blockquote>
<p>This is very worrisome.  It took 2 minutes to finish compilation on my machine.</p>



<a name="234528317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234528317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234528317">(Apr 14 2021 at 16:13)</a>:</h4>
<p>I have seen this behaviour before with a branch I was working on with a student: after <code>leanproject get-cache</code> I would always have to compile with <code>lean --make</code>, and it always started at the same random place, and we could never explain why, but it was relatively late in the heirarchy so it would only ever take a couple of minutes and we learnt to live with it. The problem didn't go away for months.</p>



<a name="234529233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529233">(Apr 14 2021 at 16:19)</a>:</h4>
<p>It's the <code>koszul_cx</code> branch of mathlib FWIW. I'm no computer scientist but are we talking about the same issue? If I checkout this branch then <code>leanproject get-cache</code> and then <code>lean --make src</code> starts producing output. I just tried it again and it looks like the problem is still there. Poor Amelia Livingston has been dealing with this throughout her MSc.</p>



<a name="234529346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529346">(Apr 14 2021 at 16:19)</a>:</h4>
<p>Ah ok, then I'm a bit relieved.  This is apparently not a new problem.</p>



<a name="234529476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529476">(Apr 14 2021 at 16:20)</a>:</h4>
<p>I can confirm that we've had this problem since around January at the very least.</p>



<a name="234529519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529519">(Apr 14 2021 at 16:20)</a>:</h4>
<p>Can you reproduce by the way?</p>



<a name="234529635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529635">(Apr 14 2021 at 16:21)</a>:</h4>
<p>Yes, I'm observing exactly the same problem: running <code>lean --make src</code> after <code>leanproject up</code> recompiles files (for 2 minutes..).  This is not the intended behavior.</p>



<a name="234529722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529722">(Apr 14 2021 at 16:22)</a>:</h4>
<p>Fwiw, I think that 2 minutes on Gabriel's beast translates to 20 minutes on a normal laptop (-;</p>



<a name="234529789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529789">(Apr 14 2021 at 16:22)</a>:</h4>
<p>The difference between you and me is that when I observe unintended behaviour I just assume it's my own fault.</p>



<a name="234529899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529899">(Apr 14 2021 at 16:23)</a>:</h4>
<p>Yes every meeting we would have would start with me pulling her branch and then spending a few minutes chatting while it compiled and we'd muse on what we'd done for me to be in this mess.</p>



<a name="234529925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234529925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234529925">(Apr 14 2021 at 16:23)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/7192">#7192</a></p>



<a name="234530067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234530067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234530067">(Apr 14 2021 at 16:24)</a>:</h4>
<p>wow -- you can fix this by editing README.md only?</p>



<a name="234530105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234530105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234530105">(Apr 14 2021 at 16:24)</a>:</h4>
<p>If I'm correct, it should be also fixed after the next batch is merged.</p>



<a name="234530159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234530159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234530159">(Apr 14 2021 at 16:25)</a>:</h4>
<p>I didn't notice that we already had a batch running.</p>



<a name="234530284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234530284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234530284">(Apr 14 2021 at 16:26)</a>:</h4>
<p>AFAICT, all that's necessary to fix this is to upload the newly compiled olean files.</p>



<a name="234530631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234530631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234530631">(Apr 14 2021 at 16:28)</a>:</h4>
<p>In Amelia's branch, from what Kevin is saying, the problem has been there for a long time, even after updating the branch again and again. Could it be that two files have the same hash, and this doesn't change while these two files are not updated?</p>



<a name="234531414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234531414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234531414">(Apr 14 2021 at 16:33)</a>:</h4>
<p>Hmm, the issue with Amelia's branch might also be that it doesn't build.  The CI build terminates after the first error (or so).  If the error comes early, then there's still lots of files that have no oleans.</p>



<a name="234531490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234531490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234531490">(Apr 14 2021 at 16:33)</a>:</h4>
<p>I'm pretty sure that it sometimes built. [I might be wrong]</p>



<a name="234531700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234531700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234531700">(Apr 14 2021 at 16:34)</a>:</h4>
<p>All xs are red here: <a href="https://github.com/leanprover-community/mathlib/commits/koszul_cx">https://github.com/leanprover-community/mathlib/commits/koszul_cx</a></p>



<a name="234531796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234531796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234531796">(Apr 14 2021 at 16:35)</a>:</h4>
<p>(at least after the last merge)</p>



<a name="234531985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234531985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234531985">(Apr 14 2021 at 16:36)</a>:</h4>
<p>The reason this strikes me as odd is that I certainly remember meetings in e.g. Feb where leanproject get-cache wouldn't give me a fully compiled project but I could fix it with <code>lean --make src</code> and I'd get no errors.</p>



<a name="234532004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532004">(Apr 14 2021 at 16:36)</a>:</h4>
<p>Last <code>bors</code> run failed, at the <code>leanchecker</code> stage. <a href="https://app.bors.tech/batches/137714">https://app.bors.tech/batches/137714</a> Is there a way to download the oleans, to see if <code>lean --make src</code> has something to recompile?</p>



<a name="234532141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532141">(Apr 14 2021 at 16:37)</a>:</h4>
<p><code>leanproject get-mathlib-cache --rev df0b3be</code> should work</p>



<a name="234532230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532230">(Apr 14 2021 at 16:38)</a>:</h4>
<p>(after checking out the <code>df0b3be</code> commit)</p>



<a name="234532426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532426">(Apr 14 2021 at 16:39)</a>:</h4>
<p>Actually, <code>lean --make src/</code> starts compiling even with current <code>master</code>.</p>



<a name="234532501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532501">(Apr 14 2021 at 16:39)</a>:</h4>
<p>For me, it starts with <code>src/analysis/mean_inequalities.lean</code>.</p>



<a name="234532503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532503">(Apr 14 2021 at 16:39)</a>:</h4>
<p>Do you know how to fetch the df0b3be commit?</p>



<a name="234532773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532773">(Apr 14 2021 at 16:41)</a>:</h4>
<p>I assumed <code>git checkout df0b3be</code> would work after fetching, but if not I think <code>master</code> has the same problem right now.</p>



<a name="234532811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532811">(Apr 14 2021 at 16:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234532501">said</a>:</p>
<blockquote>
<p>For me, it starts with <code>src/analysis/mean_inequalities.lean</code>.</p>
</blockquote>
<p>For me, it starts with this file, but also with other files importing <code> src/analysis/special_functions/pow.lean</code>. I have created a branch modifying this file, to see if it makes a difference. <a href="https://github.com/leanprover-community/mathlib/tree/change_hash">branch#change_hash</a></p>



<a name="234532819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532819">(Apr 14 2021 at 16:41)</a>:</h4>
<p>df0b3be is the commit of the batch that just failed, right?</p>



<a name="234532845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532845">(Apr 14 2021 at 16:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234532819">said</a>:</p>
<blockquote>
<p>df0b3be is the commit of the batch that just failed, right?</p>
</blockquote>
<p>Yes, it is. I copied it from <a href="https://github.com/leanprover-community/mathlib/actions/runs/748360382">https://github.com/leanprover-community/mathlib/actions/runs/748360382</a></p>



<a name="234532957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234532957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234532957">(Apr 14 2021 at 16:42)</a>:</h4>
<p>Mmh, that recompiles for me as well.  (I downloaded the zip version.)</p>



<a name="234533056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234533056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234533056">(Apr 14 2021 at 16:43)</a>:</h4>
<p>The first file is ring_theory/polynomial/cyclotomic (also in master).</p>



<a name="234533705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234533705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234533705">(Apr 14 2021 at 16:47)</a>:</h4>
<p>Good news!  <code>leanproject get mathlib:bump</code> doesn't need recompilation.<br>
<a href="https://github.com/leanprover-community/mathlib/issues/7192">#7192</a> (probably requires <code>bors r+ p=42</code> so that it's in its own batch)</p>



<a name="234534085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234534085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234534085">(Apr 14 2021 at 16:49)</a>:</h4>
<p>Strange, I wonder why <code>df0b3be</code> failed then, since it also went through a recompilation step.</p>



<a name="234534478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234534478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234534478">(Apr 14 2021 at 16:52)</a>:</h4>
<p>There is probably a difference in how hashes are computed when files are loaded from olean as opposed to lean.  And then compilation is not idempotent.</p>



<a name="234534891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234534891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234534891">(Apr 14 2021 at 16:54)</a>:</h4>
<p>Would having GitHub Actions run <code>leanproject build</code> twice before uploading oleans prevent this in the future?</p>



<a name="234535051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234535051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234535051">(Apr 14 2021 at 16:55)</a>:</h4>
<p>(Assuming we don't want to fuss more with the hashing code in Lean.)</p>



<a name="234535083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234535083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234535083">(Apr 14 2021 at 16:55)</a>:</h4>
<p>Hmm, that might be a good workaround.</p>



<a name="234535205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234535205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234535205">(Apr 14 2021 at 16:56)</a>:</h4>
<p>Added to <a href="https://github.com/leanprover-community/mathlib/issues/7192">#7192</a></p>



<a name="234535625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234535625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234535625">(Apr 14 2021 at 16:58)</a>:</h4>
<p>OK, bors is running it now.</p>



<a name="234594005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234594005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234594005">(Apr 14 2021 at 23:44)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>, are you going to take on the <code>int</code> version as well, or would you like some help? :-)</p>



<a name="234628066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234628066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234628066">(Apr 15 2021 at 07:11)</a>:</h4>
<p>I'm working on it.</p>



<a name="234635516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234635516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234635516">(Apr 15 2021 at 08:17)</a>:</h4>
<p>Then I suppose the rat / division_ring version comes next?</p>



<a name="234639426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234639426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234639426">(Apr 15 2021 at 08:51)</a>:</h4>
<p>Finite fields are division rings but don't have an action of rat (at least not a mathematically natural one which is likely to give rise to diamonds), so it's not quite that.</p>



<a name="234639726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234639726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234639726">(Apr 15 2021 at 08:54)</a>:</h4>
<p>Maybe <code>algebra rat A</code>?</p>



<a name="234639750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234639750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234639750">(Apr 15 2021 at 08:54)</a>:</h4>
<p>or even <code>semimodule rat A</code>?</p>



<a name="234639822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234639822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234639822">(Apr 15 2021 at 08:55)</a>:</h4>
<p>the moment you have <code>algebra rat A</code> I think it's pretty clear which rat structure you want to be using! The issue with abelian groups is that sometimes they can inherit more than one Z-structure, all mathematically equal but sometimes not definitionally equal.</p>



<a name="234639870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234639870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234639870">(Apr 15 2021 at 08:55)</a>:</h4>
<p>Ah, so <code>char_zero</code> and field?</p>



<a name="234640470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234640470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234640470">(Apr 15 2021 at 09:00)</a>:</h4>
<p>But this happens for rat algebras too I think</p>



<a name="234640591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234640591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234640591">(Apr 15 2021 at 09:01)</a>:</h4>
<p>That is, <a href="https://leanprover-community.github.io/mathlib_docs/find/rat.algebra_rat">docs#rat.algebra_rat</a> at <a href="https://leanprover-community.github.io/mathlib_docs/find/algebra.id">docs#algebra.id</a> have non-defeq scalar actions for <code>algebra rat rat</code></p>



<a name="234643770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234643770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234643770">(Apr 15 2021 at 09:26)</a>:</h4>
<p>At some point we need to convince the devs that TC should use <code>subsingleton</code> instances when available to get past defeq problems...</p>



<a name="234643822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234643822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234643822">(Apr 15 2021 at 09:27)</a>:</h4>
<p>(Where by "convince" I mean see if they can work out a way to produce such magic for us. :-)</p>



<a name="234644092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234644092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234644092">(Apr 15 2021 at 09:29)</a>:</h4>
<p>They could just rename <code>exact</code> to <code>convert</code> and hope that we never notice.</p>



<a name="234644887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234644887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234644887">(Apr 15 2021 at 09:35)</a>:</h4>
<p>Does <code>convert</code> work every time that <code>exact</code> would?</p>



<a name="234645035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234645035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234645035">(Apr 15 2021 at 09:36)</a>:</h4>
<p>Yeah I think so. The issue is that sometimes you're not ready to go "this is exactly the answer", you just want to do e.g. a rewrite which fails because of a subsingleton typeclass problem</p>



<a name="234645221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234645221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234645221">(Apr 15 2021 at 09:38)</a>:</h4>
<p>Ok, thanks!  I have seen convert work very well when exact didn't, but had never tried replacing exacts with converts, at least not consciously!</p>



<a name="234645855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234645855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234645855">(Apr 15 2021 at 09:43)</a>:</h4>
<p>Well, <code>convert</code> is also a bit more expensive... so if <code>exact</code> works...</p>



<a name="234645996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234645996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234645996">(Apr 15 2021 at 09:44)</a>:</h4>
<p>Does a single convert always even help? Aren't there situations where instead of<code>convert f (g x)</code> uou need something like<code>convert f (by convert g (by convert x))</code>?</p>



<a name="234646828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234646828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234646828">(Apr 15 2021 at 09:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234644887">said</a>:</p>
<blockquote>
<p>Does <code>convert</code> work every time that <code>exact</code> would?</p>
</blockquote>
<p>No:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">p</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">true</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">p</span> <span class="mi">7</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="mi">5</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">convert</span> <span class="n">h</span> <span class="c1">-- produces goal 2 = 3</span>

<span class="c1">-- `exact h` works of course</span>
</code></pre></div>



<a name="234647116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234647116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234647116">(Apr 15 2021 at 09:54)</a>:</h4>
<p><code>convert h using 1</code> or perhaps <code>0</code> presumably works there?</p>



<a name="234649020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234649020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234649020">(Apr 15 2021 at 10:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234646828">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/144837-PR-reviews/topic/.237084/near/234644887">said</a>:</p>
<blockquote>
<p>Does <code>convert</code> work every time that <code>exact</code> would?</p>
</blockquote>
<p>No:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">p</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">true</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">p</span> <span class="mi">7</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="mi">5</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">convert</span> <span class="n">h</span> <span class="c1">-- produces goal 2 = 3</span>

<span class="c1">-- `exact h` works of course</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I'm very confused what's going on there; does <code>exact</code> force lean to unfold <code>p</code>? And why does <code>convert</code> create the goal <code>2=3</code>?</p>



<a name="234649056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234649056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234649056">(Apr 15 2021 at 10:08)</a>:</h4>
<p><code>using 0</code> does work Eric</p>



<a name="234651845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234651845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234651845">(Apr 15 2021 at 10:33)</a>:</h4>
<p>This might be a discussion which is better off elsewhere. Yes <code>exact h</code> tries to identify the goal with <code>h</code> definitionally so it will unfold and reduce</p>



<a name="234652967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234652967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234652967">(Apr 15 2021 at 10:43)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>'s example would be a nice addition to the docs for convert to explain why <code>using</code> is needed.</p>
<p><span class="user-mention" data-user-id="284160">@Eric Rodriguez</span>: <code>7 = bit1 3</code>, <code>5 = bit1 2</code></p>



<a name="234654516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%237084/near/234654516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.237084.html#234654516">(Apr 15 2021 at 10:58)</a>:</h4>
<p>Gabriel: thank you very much for the enlightening example!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>