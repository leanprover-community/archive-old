---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.236292.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html">#6292</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="228259645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228259645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228259645">(Mar 01 2021 at 16:25)</a>:</h4>
<p>Could someone who knows about tactics check that the tagging of <code>@[mono]</code> in <a href="https://github.com/leanprover-community/mathlib/issues/6292">#6292</a> is done correctly?  Otherwise, looks good to go.</p>



<a name="228259657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228259657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228259657">(Mar 01 2021 at 16:25)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="268315">@Anatole Dedecker</span></p>



<a name="228260829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228260829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228260829">(Mar 01 2021 at 16:32)</a>:</h4>
<p>Has it been tested to work? I don't know if/how <code>mono</code> deals with the <code>integrable</code> side conditions</p>



<a name="228260859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228260859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228260859">(Mar 01 2021 at 16:32)</a>:</h4>
<p>And unfortunately there's no doc for <code>@[mono]</code></p>



<a name="228274376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228274376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228274376">(Mar 01 2021 at 17:47)</a>:</h4>
<p>That makes sense.  <span class="user-mention" data-user-id="268315">@Anatole Dedecker</span>, could you please add one or two tests to<br>
<a href="https://github.com/leanprover-community/mathlib/blob/master/test/monotonicity/test_cases.lean">https://github.com/leanprover-community/mathlib/blob/master/test/monotonicity/test_cases.lean</a><br>
?</p>



<a name="228275242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228275242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228275242">(Mar 01 2021 at 17:52)</a>:</h4>
<p>Also, is there a reason you chose to give </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[mono]</span> <span class="kd">lemma</span> <span class="n">set_integral_mono</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">≤</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∫</span> <span class="n">a</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">∂</span><span class="n">μ</span> <span class="bp">≤</span> <span class="bp">∫</span> <span class="n">a</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">g</span> <span class="n">a</span> <span class="bp">∂</span><span class="n">μ</span> <span class="o">:=</span>
<span class="n">integral_mono</span> <span class="n">hf</span> <span class="n">hg</span> <span class="n">h</span>
</code></pre></div>
<p>the <code>@[mono]</code> tag rather than say</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">set_integral_mono_ae_restrict</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">≤ᵐ</span><span class="o">[</span><span class="n">μ.restrict</span> <span class="n">s</span><span class="o">]</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∫</span> <span class="n">a</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">∂</span><span class="n">μ</span> <span class="bp">≤</span> <span class="bp">∫</span> <span class="n">a</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">g</span> <span class="n">a</span> <span class="bp">∂</span><span class="n">μ</span> <span class="o">:=</span>
<span class="n">integral_mono_ae</span> <span class="n">hf</span> <span class="n">hg</span> <span class="n">h</span>
</code></pre></div>
<p>?  Likewise for the other lemma families.  I just have no idea what does/doesn't work with <code>@[mono]</code>.</p>



<a name="228407513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228407513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228407513">(Mar 02 2021 at 13:18)</a>:</h4>
<p>To be honest, I don't really know either <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> </p>
<p>My decision rule here was quite simple : I assumed (maybe I'm wrong) that <code>mono</code> is supposed to work only with "pure" <code>≤</code>, not <code>≤ᵐ</code> or <code>≤ᶠ</code>, so I just put the tag on lemmas that were only assuming <code>≤</code>. But again, maybe that's just false.</p>
<p>I did a bit of testing with the tags I had put, and found two problems :</p>
<ul>
<li>the first one was easily solved : putting <code>@[mono]</code> on both <code>integral_mono</code> and <code>set_integral_mono</code> is stupid, because those are really the same lemma (except the second one only accepts measure looking like <code>μ.restrict s), and it was confusing </code>mono`. Now, the following works perfectly :  </li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">∫</span> <span class="n">x</span> <span class="k">in</span> <span class="n">Icc</span> <span class="mi">0</span> <span class="mi">1</span><span class="o">,</span> <span class="n">real.exp</span> <span class="n">x</span> <span class="bp">≤</span> <span class="bp">∫</span> <span class="n">x</span> <span class="k">in</span> <span class="n">Icc</span> <span class="mi">0</span> <span class="mi">1</span><span class="o">,</span> <span class="n">real.exp</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">mono</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">real.continuous_exp.integrable_on_compact</span> <span class="n">compact_Icc</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="o">(</span><span class="n">real.continuous_exp.comp</span> <span class="bp">$</span> <span class="n">continuous_add_right</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="n">integrable_on_compact</span> <span class="n">compact_Icc</span> <span class="o">},</span>
  <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span>
  <span class="n">mono</span><span class="o">,</span>
  <span class="n">linarith</span>
<span class="kd">end</span>
</code></pre></div>
<ul>
<li>the second issue is stranger : if I replace <code>in Icc 0 1</code> by <code>in 0..1</code> in the above example, the first mono takes ages and I eventually get an "excessive memory usage" error (note that I have limited the memory Lean is allowed to use, but that doesn't explain the whole thing). I can't see where that comes from, so it would be great if someone who knows mono could explain what is wrong, and what is the good decision rule for "should I put <code>@[mono]</code> on this lemma"</li>
</ul>



<a name="228506318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228506318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228506318">(Mar 02 2021 at 23:30)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>, was it you who wrote <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#mono">tactic#mono</a>?  Are you able to take a look?</p>
<p>We can also just omit the <code>@[mono]</code> tag on the <code>interval_integral</code> version of the lemma.</p>



<a name="228739432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/228739432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#228739432">(Mar 04 2021 at 09:17)</a>:</h4>
<p>Yes indeed I wrote it. I'll have a look</p>



<a name="229201040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/229201040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#229201040">(Mar 07 2021 at 16:48)</a>:</h4>
<p>What was the issue with <code>mono</code>? I don't see that part of the conversation</p>



<a name="229202265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/229202265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#229202265">(Mar 07 2021 at 17:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="268315">Anatole Dedecker</span> <a href="#narrow/stream/144837-PR-reviews/topic/.236292/near/228407513">said</a>:</p>
<blockquote>
<ul>
<li>the second issue is stranger : if I replace <code>in Icc 0 1</code> by <code>in 0..1</code> in the above example, the first mono takes ages and I eventually get an "excessive memory usage" error (note that I have limited the memory Lean is allowed to use, but that doesn't explain the whole thing). I can't see where that comes from, so it would be great if someone who knows mono could explain what is wrong, and what is the good decision rule for "should I put <code>@[mono]</code> on this lemma"</li>
</ul>
</blockquote>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Thanks for looking at this!  It's this issue mentioned by Anatole.</p>



<a name="229202389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/229202389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#229202389">(Mar 07 2021 at 17:09)</a>:</h4>
<p>You would need to tag <a href="https://leanprover-community.github.io/mathlib_docs/find/interval_integral.integral_mono">docs#interval_integral.integral_mono</a> with <code>@[mono]</code> to see the issue.</p>



<a name="229211575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236292/near/229211575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236292.html#229211575">(Mar 07 2021 at 19:27)</a>:</h4>
<p>Ok, I'll see what's going on. Maybe I could clear up the documentation</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>