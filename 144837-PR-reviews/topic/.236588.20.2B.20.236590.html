---
layout: archive
title: Zulip Chat Archive
permalink: /stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/index.html">PR reviews</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html">#6588 + #6590</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="229326094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229326094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229326094">(Mar 08 2021 at 16:14)</a>:</h4>
<p>I have been alerted by Johan of PR <a href="https://github.com/leanprover-community/mathlib/issues/6588">#6588</a>.  I had been preparing <a href="https://github.com/leanprover-community/mathlib/issues/6590">#6590</a> that I just pushed.  My version is not really polished, but I thought that it might be simpler to discuss two coexisting PRs, rather than one PR and something somewhere else!  Do let me know if there is a better way of dealing with this!</p>



<a name="229326636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229326636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229326636">(Mar 08 2021 at 16:16)</a>:</h4>
<p>At first sight, it looks like the two PRs complement each other very well, but I have not yet had a chance to look carefully at <a href="https://github.com/leanprover-community/mathlib/issues/6588">#6588</a>.</p>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span></p>



<a name="229327917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229327917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229327917">(Mar 08 2021 at 16:21)</a>:</h4>
<p>It looks to me like <span class="user-mention" data-user-id="238446">@Anne Baanen</span>'s is just filling gaps in API, which looks like the obvious candidate to merge first - then your PR might be able to use some of the new definitions within its proofs</p>



<a name="229329516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229329516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229329516">(Mar 08 2021 at 16:27)</a>:</h4>
<p>Ok, I am happy to wait, of course.  I simply took the <code>algebra/regular</code> file as a template and started changing the statements since I needed injectivity of smultiplication maps on general modules, not only on <code>R</code> itself viewed as an <code>R</code>-module.  PR <a href="https://github.com/leanprover-community/mathlib/issues/6588">#6588</a> seems indeed to be adding the statement that in several cases, elements of algebras/rings/domains/... are regular/<code>M</code>-regular.  If I read correctly the PR!</p>



<a name="229329865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229329865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229329865">(Mar 08 2021 at 16:28)</a>:</h4>
<p>I am also planning to prove interactions between <code>M</code>-regular and left-regular, when the module <code>M</code> coincides with <code>R</code> itself.  This might be more in line with what Anne is doing, possibly.</p>



<a name="229330488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229330488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229330488">(Mar 08 2021 at 16:32)</a>:</h4>
<p>Thank you for pointing out the connection <span class="user-mention" data-user-id="112680">@Johan Commelin</span>. I agree with <span class="user-mention" data-user-id="310045">@Eric Wieser</span> (though I might be a bit biased <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span>) that <a href="https://github.com/leanprover-community/mathlib/issues/6588">#6588</a> would fit nicely as a dependency of <a href="https://github.com/leanprover-community/mathlib/issues/6590">#6590</a>, for example as a <code>is_regular.of_no_zero_smul_divisors</code> lemma.</p>



<a name="229330662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229330662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229330662">(Mar 08 2021 at 16:33)</a>:</h4>
<p>But my PR is mostly just a few dependencies for the trace form PR that I'm cleaning up at the moment, so I don't mind too much if it gets changed around, as long as <code>lmul_injective</code> and <code>lsmul_injective</code> are still available at the end.</p>



<a name="229330920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229330920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229330920">(Mar 08 2021 at 16:34)</a>:</h4>
<p>I think that I am simply developing some API for the <code>lsmul</code> injective concept, following the <code>regular</code> PR, which is probably something similar for the <code>mul_injective</code> one.</p>



<a name="229330989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229330989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229330989">(Mar 08 2021 at 16:34)</a>:</h4>
<p>Aren't you just developing api for <code>smul</code> injective?</p>



<a name="229331112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331112">(Mar 08 2021 at 16:35)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> doesn't seem to care about any API for it beyond "it's injective for <a href="https://leanprover-community.github.io/mathlib_docs/find/no_zero_smul_divisors">docs#no_zero_smul_divisors</a>", and "if smul is injective then obviously so is the defeq lsmul"</p>



<a name="229331119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331119">(Mar 08 2021 at 16:35)</a>:</h4>
<p>In any case, I am not completely sure that I understand the implication of what is a dependency on what else, but I was going to wait a bit longer before pushing mine, since I do not consider it "polished enough", still.  However, since it seemed timely to do it now, with <a href="https://github.com/leanprover-community/mathlib/issues/6588">#6588</a> in the queue, I just went for it!  So feel free to delay mine with no worries!</p>



<a name="229331316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331316">(Mar 08 2021 at 16:36)</a>:</h4>
<p>Yes, I do not think that there is much overlap, other than some of the things that Anne is formulating with <code>lsmul_injective</code> could also be formulated by saying that something is appropriately <code>regular</code></p>



<a name="229331406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331406">(Mar 08 2021 at 16:37)</a>:</h4>
<p>No problem, I'll mark <a href="https://github.com/leanprover-community/mathlib/issues/6590">#6590</a> as a work in progress to indicate that it doesn't need to merged soon, and you can continue developing at your pace.</p>



<a name="229331581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331581">(Mar 08 2021 at 16:38)</a>:</h4>
<p>What I meant by adding as a dependency is that you could do <code>git merge origin/smul_injective</code> on your branch, so you get access to the results before they are merged into master.</p>



<a name="229331627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331627">(Mar 08 2021 at 16:38)</a>:</h4>
<p>Eric, I will move the conversation to different types here, since Zulip seems better suited for a lengthy discussion!</p>



<a name="229331817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331817">(Mar 08 2021 at 16:39)</a>:</h4>
<p>Right, I'm suggesting your API contain something like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">is_regular.smul</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">R</span> <span class="n">S</span><span class="o">]</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">S</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">is_scalar_tower</span> <span class="n">R</span> <span class="n">S</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">ra</span> <span class="o">:</span> <span class="n">is_regular</span> <span class="n">M</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">))</span> <span class="o">(</span><span class="n">rb</span> <span class="o">:</span> <span class="n">is_regular</span> <span class="n">M</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">S</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">is_regular</span> <span class="n">M</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="c1">-- proof is what you have right now</span>
<span class="kd">lemma</span> <span class="n">is_regular.mul</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">ra</span> <span class="o">:</span> <span class="n">is_regular</span> <span class="n">M</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">))</span> <span class="o">(</span><span class="n">rb</span> <span class="o">:</span> <span class="n">is_regular</span> <span class="n">M</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">is_regular</span> <span class="n">M</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">is_regular.smul</span>
</code></pre></div>



<a name="229331837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331837">(Mar 08 2021 at 16:40)</a>:</h4>
<p>Are you suggesting defining injectivity across a scalar tower?  something like "an element <code>a</code> in <code>R</code> has injective multiplication on the <code>S</code>-module <code>M</code>, where <code>S</code> is an <code>R</code>-algebra"?</p>



<a name="229331943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331943">(Mar 08 2021 at 16:40)</a>:</h4>
<p>I'm not suggesting you touch the definition</p>



<a name="229331969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229331969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229331969">(Mar 08 2021 at 16:40)</a>:</h4>
<p>Just generalize the lemma statement</p>



<a name="229332024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229332024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229332024">(Mar 08 2021 at 16:40)</a>:</h4>
<p>ah, I see!  You want injectivity "through" smultiplication in a scalar tower!</p>



<a name="229332114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229332114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229332114">(Mar 08 2021 at 16:41)</a>:</h4>
<p>If you find yourself writing <code>is_scalar_tower R R M</code> it usually means you haven't generalized enough</p>



<a name="229332578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229332578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229332578">(Mar 08 2021 at 16:44)</a>:</h4>
<p>Anne, I did what you said: I am still a little worried by these "pyrotechnic" uses of git, but I think that I can handle this!</p>
<p>I imagine that <code>bors</code> will pick up on the dependency, and I have also explicitly mentioned it in the PR comment.</p>



<a name="229337768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229337768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229337768">(Mar 08 2021 at 17:13)</a>:</h4>
<p>Another instance that seems to be missing is <code>has_scalar G G</code> where <code>G</code> is a semigroup.  I do not actually need this for my PR, but some of the statements would be true in this generality and I am "forced" to prove them for <code>monoid</code>s because of a missing instance!  <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="229338693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229338693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229338693">(Mar 08 2021 at 17:19)</a>:</h4>
<p>Indeed, although I think there was a PR to turn <a href="https://leanprover-community.github.io/mathlib_docs/find/mul_action.regular">docs#mul_action.regular</a> into a real instance.</p>



<a name="229338916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229338916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229338916">(Mar 08 2021 at 17:20)</a>:</h4>
<p>Nevermind, that PR got merged already :P</p>



<a name="229432624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229432624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229432624">(Mar 09 2021 at 07:19)</a>:</h4>
<p>In my PR, at some point I would like to use a <code>monoid_with_zero R</code> and an action on an <code>add_comm_monoid M</code> that I would like to be a <code>smul_with_zero R M</code> action.  However, I could not find <code>smul_with_zero</code> or something similar: does it exist?  The typeclass should assert that there is a scalar multiplication between <code>R → M → M</code>and <code>0 : R</code> produces the constant map to <code>0 : M</code>.</p>
<p>My solution was to assume <code>semiring R</code> and <code>semimodule M</code>, but I do not actually use the addition on <code>R</code>.  I would like this to work for a <code>monoid_with_zero R</code> and a <code>smul_with_zero R M</code>.</p>



<a name="229433391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229433391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229433391">(Mar 09 2021 at 07:28)</a>:</h4>
<p><code>zero_smul</code> is the name for this axiom and I can quite believe that the structure you want isn't there. Go ahead and make it if others confirm it's missing! This stuff is very easy to make, all the proofs in the API are straightforward term mode one-liners.</p>



<a name="229434769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229434769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229434769">(Mar 09 2021 at 07:45)</a>:</h4>
<p>Yes, in the proof with <code>semiring</code> I use <code>zero_smul</code> and it stops working if I use <code>monoid_with_zero</code>.  I will wait to see if someone else comments on this, to see if it really is not in mathlib!</p>



<a name="229619734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229619734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229619734">(Mar 10 2021 at 08:25)</a>:</h4>
<p>Does beginning the class <code>smul_with_zero</code> like what is below look reasonable?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">class</span> <span class="n">smul_with_zero</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kn">namespace</span> <span class="n">smul_with_zero</span>

<span class="kd">lemma</span> <span class="n">zero_smul</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span>
  <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>
  <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">zero_smul'</span> <span class="n">m</span>

<span class="kd">end</span> <span class="n">smul_with_zero</span>
</code></pre></div>



<a name="229619873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229619873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229619873">(Mar 10 2021 at 08:26)</a>:</h4>
<p>After that, I think that I should probably create instances showing that this happens in most situations where you have a <code>scalar_tower</code>, a <code>semiring</code> and whatever else I can think of!</p>



<a name="229622517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229622517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229622517">(Mar 10 2021 at 08:51)</a>:</h4>
<p>I think you probably want to extend <code>has_scalar</code> rather than take it as an assumption</p>



<a name="229622672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229622672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229622672">(Mar 10 2021 at 08:53)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/mul_zero_class">docs#mul_zero_class</a> might be a good name to draw inspiration from</p>



<a name="229622888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229622888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229622888">(Mar 10 2021 at 08:54)</a>:</h4>
<p>Eric, I updated the definition with your <code>extends</code> suggestion.  I will look at the <code>mul_zero_class</code> later: I have to teach now!</p>
<p>Thanks!</p>



<a name="229639368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229639368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229639368">(Mar 10 2021 at 11:14)</a>:</h4>
<p>Why do you assume M has a zero?</p>



<a name="229639470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229639470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229639470">(Mar 10 2021 at 11:15)</a>:</h4>
<p>Note that this is half way to <code>distrib_mul_action</code></p>



<a name="229641018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229641018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229641018">(Mar 10 2021 at 11:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590/near/229639368">said</a>:</p>
<blockquote>
<p>Why do you assume M has a zero?</p>
</blockquote>
<p>Because it's needed on the RHS of <code>(0 : R) • m = 0</code></p>



<a name="229641222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229641222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229641222">(Mar 10 2021 at 11:31)</a>:</h4>
<p>Are there any interesting examples of <code>smul_with_zero</code> that don't also satisfy <code>r • (0 : M) = 0</code>? I'd be inclined to put both <code>smul_zero</code> and <code>zero_smul</code> in the same class.</p>
<p>From there, you could add a</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span> <span class="n">smul_zero_class</span> <span class="n">R</span> <span class="n">M</span>
</code></pre></div>
<p>and an instance</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span>  <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span>  <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="229644593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229644593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229644593">(Mar 10 2021 at 12:00)</a>:</h4>
<p>Eric, I think that you are right: in what I would consider, also the identity <code>r • (0 : M) = 0</code> holds and I am happy to assume it.</p>
<p>I like your suggestions: let me see how they play out!</p>



<a name="229704531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229704531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229704531">(Mar 10 2021 at 17:12)</a>:</h4>
<p>If I write what is below, lean complains about <code>smul_with_zero R M</code> (error message copied below).  What am I doing wrong?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">The</span> <span class="n">code</span> <span class="n">that</span> <span class="n">was</span> <span class="n">here</span> <span class="n">now</span> <span class="n">seems</span> <span class="n">to</span> <span class="n">work</span><span class="bp">!</span>
</code></pre></div>



<a name="229705217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229705217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229705217">(Mar 10 2021 at 17:16)</a>:</h4>
<p>I found a similar question where the answer was "use <code>set_option old_structure_cmd true</code>", which indeed removed the error.</p>
<p>Is this the correct way of proceeding?<br>
What does the <code>set_option old_structure_cmd true</code> command do?</p>



<a name="229706253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229706253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229706253">(Mar 10 2021 at 17:21)</a>:</h4>
<p>This seems to work: any input, especially on the <code>old_structure_cmd</code> line are especially welcome!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">true</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">class</span> <span class="n">smul_with_zero</span> <span class="kd">extends</span> <span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">smul_zero'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kn">namespace</span> <span class="n">smul_with_zero</span>

<span class="kd">lemma</span> <span class="n">smul_zero</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">smul_zero'</span> <span class="n">r</span>

<span class="kd">lemma</span> <span class="n">zero_smul</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">zero_smul'</span> <span class="n">m</span>

<span class="kd">class</span> <span class="n">mul_action_with_zero</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span> <span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span>

<span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="n">mul_action_with_zero.mk</span> <span class="o">(</span><span class="n">one_smul</span> <span class="n">R</span><span class="o">)</span> <span class="n">mul_smul</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">mul_zero</span> <span class="n">zero_mul</span>

<span class="kd">end</span> <span class="n">smul_with_zero</span>
</code></pre></div>



<a name="229706821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229706821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229706821">(Mar 10 2021 at 17:24)</a>:</h4>
<p><code>old_structure_cmd</code> is the right thing to do - you're adding new classes to a heirarchy of old structures, so your structures should be "old" too</p>



<a name="229706896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229706896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229706896">(Mar 10 2021 at 17:25)</a>:</h4>
<p><code>smul_with_zero</code> only requires <code>has_zero R</code>, not <code>monoid_with_zero R</code></p>



<a name="229707170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707170">(Mar 10 2021 at 17:26)</a>:</h4>
<p>Can golf the last bit with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_mul_action</span> <span class="o">}</span>
</code></pre></div>



<a name="229707191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707191">(Mar 10 2021 at 17:27)</a>:</h4>
<p>Also, the linter is complaining about a repetition on the <code>monoid_with_zero</code>: I will update in a sec!</p>



<a name="229707282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707282">(Mar 10 2021 at 17:27)</a>:</h4>
<p>Yes, that's because you repeated <code>[monoid_with_zero R]</code> in both <code>variables</code> and the lemmas statement</p>



<a name="229707325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707325">(Mar 10 2021 at 17:27)</a>:</h4>
<p>Liberal use of <code>section</code>s can avoid that type of issue</p>



<a name="229707371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707371">(Mar 10 2021 at 17:28)</a>:</h4>
<p>As can just not putting any typeclasses in <code>variables</code>, if you know you're going to jump around a lot, and you don't have very many</p>



<a name="229707785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707785">(Mar 10 2021 at 17:30)</a>:</h4>
<p>With your golfing, I get this error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_mul_action</span> <span class="o">}</span>

<span class="n">invalid</span> <span class="kd">structure</span> <span class="kd">notation</span> <span class="n">source</span><span class="o">,</span> <span class="n">not</span> <span class="n">a</span> <span class="kd">structure</span>
  <span class="n">monoid.to_mul_action</span>
<span class="n">which</span> <span class="n">has</span> <span class="n">type</span>
  <span class="bp">Π</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">?</span><span class="o">)</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">monoid</span> <span class="n">α</span><span class="o">],</span> <span class="n">mul_action</span> <span class="n">α</span> <span class="n">α</span>
<span class="n">mwe.lean</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mi">0</span>
<span class="n">invalid</span> <span class="kd">structure</span> <span class="n">value</span> <span class="o">{</span><span class="bp">...</span><span class="o">},</span> <span class="n">expected</span> <span class="n">type</span> <span class="n">is</span> <span class="n">known</span><span class="o">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="kd">structure</span>
  <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span>
</code></pre></div>



<a name="229707860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229707860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229707860">(Mar 10 2021 at 17:30)</a>:</h4>
<p>Could this be related to the fact that I was not able to get Lean to auto-generate a skeleton for a definition?</p>



<a name="229708350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229708350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229708350">(Mar 10 2021 at 17:33)</a>:</h4>
<p>This seems to work and the linting only complains about the missing doc-string!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">true</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span>

<span class="sd">/--  `smul_with_zero` is a class consisting of a Type `R` with `0 : R` and a scalar multiplication</span>
<span class="sd">of `R` on a Type `M` with `0`, such that the equality `r • m = 0` holds if at least one among `r`</span>
<span class="sd">or `m` equals `0`. -/</span>
<span class="kd">class</span> <span class="n">smul_with_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">smul_zero'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kn">namespace</span> <span class="n">smul_with_zero</span>

<span class="kd">lemma</span> <span class="n">smul_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">smul_zero'</span> <span class="n">r</span>

<span class="kd">lemma</span> <span class="n">zero_smul</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">zero_smul'</span> <span class="n">m</span>

<span class="kd">class</span> <span class="n">mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span> <span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span>

<span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="n">mul_action_with_zero.mk</span> <span class="o">(</span><span class="n">one_smul</span> <span class="n">R</span><span class="o">)</span> <span class="n">mul_smul</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">mul_zero</span> <span class="n">zero_mul</span>

<span class="kd">end</span> <span class="n">smul_with_zero</span>
</code></pre></div>



<a name="229709114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229709114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229709114">(Mar 10 2021 at 17:37)</a>:</h4>
<blockquote>
<p>Could this be related to the fact that I was not able to get Lean to auto-generate a skeleton for a definition?</p>
</blockquote>
<p>No, it's because I meant <code>monoid.to_mul_action _</code>. I'd encourage you to learn that pattern of error message, because I end up seeing that type of thing all the time!</p>



<a name="229720228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229720228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229720228">(Mar 10 2021 at 18:46)</a>:</h4>
<p>I am trying, but I think that I am misunderstanding something that you are saying: even like this, I still get an error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_mul_action</span> <span class="n">_</span> <span class="o">}</span>

<span class="c1">-- invalid structure value {...}, expected type is known, but it is not a structure</span>
<span class="c1">--   mul_action_with_zero R R</span>
</code></pre></div>



<a name="229720731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229720731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229720731">(Mar 10 2021 at 18:49)</a>:</h4>
<p>Does it become happier if you fill in the <code>_</code> with <code>R</code>?</p>



<a name="229720877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229720877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229720877">(Mar 10 2021 at 18:50)</a>:</h4>
<p>No, it had picked up <code>R</code> already: the error message is still the same</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="kd">structure</span> <span class="n">value</span> <span class="o">{</span><span class="bp">...</span><span class="o">},</span> <span class="n">expected</span> <span class="n">type</span> <span class="n">is</span> <span class="n">known</span><span class="o">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="kd">structure</span>
  <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span>
</code></pre></div>



<a name="229720948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229720948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229720948">(Mar 10 2021 at 18:50)</a>:</h4>
<p>I also tried to put <code>'</code> for the fields, since this is what I had, but that does not seem to affect the error</p>



<a name="229721251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721251">(Mar 10 2021 at 18:52)</a>:</h4>
<p>There's something wacky going on there...</p>



<a name="229721418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721418">(Mar 10 2021 at 18:53)</a>:</h4>
<p>In case it helps, here is the whole file</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">true</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span>

<span class="sd">/--  `smul_with_zero` is a class consisting of a Type `R` with `0 : R` and a scalar multiplication</span>
<span class="sd">of `R` on a Type `M` with `0`, such that the equality `r • m = 0` holds if at least one among `r`</span>
<span class="sd">or `m` equals `0`. -/</span>
<span class="kd">class</span> <span class="n">smul_with_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">smul_zero'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kn">namespace</span> <span class="n">smul_with_zero</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">smul_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">smul_zero'</span> <span class="n">r</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">zero_smul</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">zero_smul'</span> <span class="n">m</span>


<span class="kd">class</span> <span class="n">mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span> <span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span>

<span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="n">mul_action_with_zero.mk</span> <span class="o">(</span><span class="n">one_smul</span> <span class="n">R</span><span class="o">)</span> <span class="n">mul_smul</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">mul_zero</span> <span class="n">zero_mul</span>
<span class="c1">-- works with no problems</span>

<span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero'</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul'</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_mul_action</span> <span class="n">R</span> <span class="o">}</span>
<span class="c1">-- given an error, even if the previous one is not there</span>
</code></pre></div>



<a name="229721621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721621">(Mar 10 2021 at 18:54)</a>:</h4>
<p>Should <code>smul_with_zero</code> <em>extend</em> <code>has_zero R</code>, instead of assuming it?</p>



<a name="229721828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721828">(Mar 10 2021 at 18:55)</a>:</h4>
<p>No</p>



<a name="229721903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721903">(Mar 10 2021 at 18:56)</a>:</h4>
<p>Ok, here's a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> where I don't understand the problem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">true</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>

<span class="kd">structure</span> <span class="n">bad</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">dumb</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">bad</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">•</span><span class="o">)</span> <span class="o">}</span>  <span class="c1">-- invalid structure value</span>
</code></pre></div>



<a name="229721907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721907">(Mar 10 2021 at 18:56)</a>:</h4>
<p>I tried it and it did not work indeed!</p>



<a name="229721989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229721989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229721989">(Mar 10 2021 at 18:56)</a>:</h4>
<p>Ah, ok; the problem is that <code>has_scalar</code> does _not_ use <code>old_structure_cmd</code></p>



<a name="229722038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722038">(Mar 10 2021 at 18:57)</a>:</h4>
<p>To make your example more minimal, you can also eliminate the <code>variables</code>... <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="229722084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722084">(Mar 10 2021 at 18:57)</a>:</h4>
<p>To make this work, you'd need to make everything in <code>group_action/defs</code> an old structure too</p>



<a name="229722116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722116">(Mar 10 2021 at 18:57)</a>:</h4>
<p>so putting the old command before the import?</p>



<a name="229722154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722154">(Mar 10 2021 at 18:58)</a>:</h4>
<p>No, it would need to be in the file itself</p>



<a name="229722222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722222">(Mar 10 2021 at 18:58)</a>:</h4>
<p>I'd recommend maybe just creating a fresh branch where you do only that, and pushing it to kick off a build</p>



<a name="229722235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722235">(Mar 10 2021 at 18:58)</a>:</h4>
<p>ah, are there any issues with doing this?</p>



<a name="229722254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722254">(Mar 10 2021 at 18:58)</a>:</h4>
<p>That's what the build on the branch would tell you :)</p>



<a name="229722258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722258">(Mar 10 2021 at 18:58)</a>:</h4>
<p>ok, I will try that</p>



<a name="229722592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722592">(Mar 10 2021 at 19:00)</a>:</h4>
<p>already in the file <code>group_actions/defs</code> it causes problems</p>



<a name="229722761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722761">(Mar 10 2021 at 19:01)</a>:</h4>
<p>The other approach you could try is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span>

<span class="sd">/--  `smul_with_zero` is a class consisting of a Type `R` with `0 : R` and a scalar multiplication</span>
<span class="sd">of `R` on a Type `M` with `0`, such that the equality `r • m = 0` holds if at least one among `r`</span>
<span class="sd">or `m` equals `0`. -/</span>
<span class="kd">class</span> <span class="n">smul_with_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">smul_zero'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kn">namespace</span> <span class="n">smul_with_zero</span>

<span class="kd">lemma</span> <span class="n">smul_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">smul_zero'</span> <span class="n">r</span>

<span class="kd">lemma</span> <span class="n">zero_smul</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">zero_smul'</span> <span class="n">m</span>

<span class="kd">class</span> <span class="n">mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">,</span> <span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span>

<span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero'</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul'</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_mul_action</span> <span class="n">_</span> <span class="o">}</span>

<span class="kd">end</span> <span class="n">smul_with_zero</span>
</code></pre></div>
<p>where I changed <code>smul_with_zero</code> to not extend <code>has_scalar</code>. I don't know if that API makes much sense though.</p>



<a name="229722989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229722989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229722989">(Mar 10 2021 at 19:02)</a>:</h4>
<p>What are the implications of using <code>extends</code> as opposed to assuming the typeclass?</p>



<a name="229723178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229723178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229723178">(Mar 10 2021 at 19:03)</a>:</h4>
<p>Also, are we doing this simply so that the proof</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="n">mul_action_with_zero.mk</span> <span class="o">(</span><span class="n">one_smul</span> <span class="n">R</span><span class="o">)</span> <span class="n">mul_smul</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">mul_zero</span> <span class="n">zero_mul</span>
</code></pre></div>
<p>could be golfed to the other one, or are there further issues that I am not aware of?</p>



<a name="229723236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229723236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229723236">(Mar 10 2021 at 19:03)</a>:</h4>
<p>We're doing it so that <code>{}</code> notation can be used for creating instances</p>



<a name="229723359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229723359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229723359">(Mar 10 2021 at 19:04)</a>:</h4>
<p>because I haven't run into a class that didn't allow that before</p>



<a name="229723422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229723422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229723422">(Mar 10 2021 at 19:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590/near/229722592">said</a>:</p>
<blockquote>
<p>already in the file <code>group_actions/defs</code> it causes problems</p>
</blockquote>
<p>For reasons I don't understand, all those problems go away after adding <code>refl</code>s to the broken proofs</p>



<a name="229724101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229724101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229724101">(Mar 10 2021 at 19:08)</a>:</h4>
<p>Ah, ok; I understand them now - once you add <code>old_structure_cmd</code>, the lemmas in <code>mul_action</code> start referring to some weird <code>smul</code> that is defeq but not eq to the usual smul</p>



<a name="229724167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229724167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229724167">(Mar 10 2021 at 19:09)</a>:</h4>
<p>Which would be fixed by replacing <code>mul_smul</code> with <code>mul_smul'</code> etc</p>



<a name="229724472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229724472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229724472">(Mar 10 2021 at 19:10)</a>:</h4>
<p>I am trying to add <code>refl</code>, but it does not fix <em>all</em> broken proofs.</p>



<a name="229727314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229727314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229727314">(Mar 10 2021 at 19:27)</a>:</h4>
<p>I managed to fix the broken proofs, but I now have non-terminal simps...</p>



<a name="229727613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229727613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229727613">(Mar 10 2021 at 19:29)</a>:</h4>
<p>I pushed this branch, but I have very little faith that it will build...</p>



<a name="229728065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229728065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229728065">(Mar 10 2021 at 19:31)</a>:</h4>
<p>There seems to be something nasty here happening with <code>old_structure</code>s that somehow doesn't affect single-argument typeclasses like <code>ring</code></p>



<a name="229729154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229729154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229729154">(Mar 10 2021 at 19:38)</a>:</h4>
<p>Even though I have managed to finish the proofs, I did not really understand what was going on.</p>



<a name="229730399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229730399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229730399">(Mar 10 2021 at 19:46)</a>:</h4>
<p>I think the best bet might be the "lean 4" way:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">M</span><span class="o">]</span>

<span class="sd">/--  `smul_with_zero` is a class consisting of a Type `R` with `0 : R` and a scalar multiplication</span>
<span class="sd">of `R` on a Type `M` with `0`, such that the equality `r • m = 0` holds if at least one among `r`</span>
<span class="sd">or `m` equals `0`. -/</span>
<span class="kd">class</span> <span class="n">smul_with_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">smul_zero'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kn">namespace</span> <span class="n">smul_with_zero</span>

<span class="c1">-- todo: this should replace the global one</span>
<span class="kd">lemma</span> <span class="n">smul_zero</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">smul_zero'</span> <span class="n">r</span>

<span class="c1">-- this one has a typeclass that is neither stronger nor weaker than the global one</span>
<span class="kd">lemma</span> <span class="n">zero_smul</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">zero_smul'</span> <span class="n">m</span>

<span class="kd">end</span> <span class="n">smul_with_zero</span>

<span class="kd">class</span> <span class="n">mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">smul_zero'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>
<span class="o">(</span> <span class="n">zero_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">)</span>

<span class="kd">instance</span> <span class="n">mul_action_with_zero.smul_with_zero</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">m</span> <span class="o">:</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span><span class="bp">..</span><span class="n">m</span><span class="o">}</span>

<span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero'</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul'</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_mul_action</span> <span class="n">_</span> <span class="o">}</span>
</code></pre></div>



<a name="229730439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229730439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229730439">(Mar 10 2021 at 19:46)</a>:</h4>
<p>Where you abandon <code>extends smul_with_zero</code> entirely and manually write the code it generates - namely duplicating the axioms, and defining <code>mul_action_with_zero.smul_with_zero</code> by hand</p>



<a name="229730528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229730528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229730528">(Mar 10 2021 at 19:47)</a>:</h4>
<p>Lean 4 forces us to do this as far as I understand</p>



<a name="229733029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229733029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229733029">(Mar 10 2021 at 20:02)</a>:</h4>
<p>Ok, I will try with this option, since the build of the <code>old_structures</code> in <code>group_theory</code> gave further errors</p>



<a name="229735016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229735016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229735016">(Mar 10 2021 at 20:13)</a>:</h4>
<p>When I import your code with the line </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">mul_action_with_zero.smul_with_zero</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">m</span> <span class="o">:</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:=</span> <span class="o">{</span><span class="bp">..</span><span class="n">m</span><span class="o">}</span>
</code></pre></div>
<p>in the file where I would like to use it, Lean complains saying</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">maximum</span> <span class="kd">class</span><span class="bp">-</span><span class="kd">instance</span> <span class="n">resolution</span> <span class="n">depth</span> <span class="n">has</span> <span class="n">been</span> <span class="n">reached</span>
<span class="o">(</span><span class="n">the</span> <span class="n">limit</span> <span class="n">can</span> <span class="n">be</span> <span class="n">increased</span> <span class="kd">by</span> <span class="n">setting</span> <span class="n">option</span> <span class="bp">'</span><span class="kd">class</span><span class="bp">.</span><span class="n">instance_max_depth'</span><span class="o">)</span>
<span class="o">(</span><span class="n">the</span> <span class="kd">class</span><span class="bp">-</span><span class="kd">instance</span> <span class="n">resolution</span> <span class="n">trace</span> <span class="n">can</span> <span class="n">be</span> <span class="n">visualized</span> <span class="kd">by</span> <span class="n">setting</span> <span class="n">option</span>
<span class="bp">'</span><span class="n">trace.class_instances'</span><span class="o">)</span>
</code></pre></div>
<p>on some lemmas.  If I comment out just that line, then it does not complain</p>
<p>(Note that I have not yet used the new class, I simply imported the file at the top)</p>



<a name="229736066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229736066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229736066">(Mar 10 2021 at 20:19)</a>:</h4>
<p>Whoops</p>



<a name="229736069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229736069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229736069">(Mar 10 2021 at 20:19)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">m</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">{</span><span class="bp">..</span><span class="n">m</span><span class="o">}</span>
</code></pre></div>



<a name="229736093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229736093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229736093">(Mar 10 2021 at 20:19)</a>:</h4>
<p>What I wrote amounted to "all mul_actions are mul_actions"</p>



<a name="229736433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229736433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229736433">(Mar 10 2021 at 20:21)</a>:</h4>
<p>You'll want to remove the primes from your lemma names</p>



<a name="229741599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229741599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229741599">(Mar 10 2021 at 20:49)</a>:</h4>
<p>Ok, thanks: that fixed it!</p>



<a name="229741638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229741638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229741638">(Mar 10 2021 at 20:49)</a>:</h4>
<p>I will try to use the new class, but tomorrow: I am done for today!</p>



<a name="229741869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229741869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229741869">(Mar 10 2021 at 20:51)</a>:</h4>
<p>Just one more question: if I remove the primes from the field in the class, then I can no longer state the lemmas without the primes, since Lean says that the lemma already exists.  Does this mean that I can use the lemma, even if I did not prove it explicitly?  Will it be a simp lemma?</p>



<a name="229768819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229768819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229768819">(Mar 10 2021 at 23:55)</a>:</h4>
<p>Yes, lean automatically adds definitions ("projections") for every structure field. The ones it adds automatically in your case are identical to the ones you were after.</p>



<a name="229770313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229770313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229770313">(Mar 11 2021 at 00:08)</a>:</h4>
<p>They won't be <code>simp</code> lemmas, but you can <code>attribute [simp] S.X</code> later.</p>



<a name="229814319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229814319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229814319">(Mar 11 2021 at 08:47)</a>:</h4>
<p>Thanks!  I think that I managed to make the <code>class</code> and the <code>simp</code> <code>attribute</code> work!</p>
<p>I will now start testing it!</p>



<a name="229827117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229827117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229827117">(Mar 11 2021 at 10:32)</a>:</h4>
<p>Just to confirm that I am on the right track: the instance below should also be added, right?  Lean came as close to begging me to introduce it as is reasonable!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">*</span><span class="o">),</span>
  <span class="n">one_smul</span> <span class="o">:=</span> <span class="n">one_mul</span><span class="o">,</span>
  <span class="n">mul_smul</span> <span class="o">:=</span> <span class="n">mul_assoc</span><span class="o">,</span>
  <span class="n">smul_zero</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">zero_smul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">}</span>
</code></pre></div>



<a name="229828233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229828233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229828233">(Mar 11 2021 at 10:42)</a>:</h4>
<p>Also, the linter tells me that a priority should be lowered and with the command below it no longer complains:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[priority 100]</span> <span class="c1">-- see Note [lower instance priority]</span>
<span class="kd">instance</span> <span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="o">[</span><span class="n">m</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">smul_with_zero</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">{</span><span class="bp">..</span><span class="n">m</span><span class="o">}</span>
</code></pre></div>



<a name="229832721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229832721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229832721">(Mar 11 2021 at 11:21)</a>:</h4>
<p>You should also add <code>semimodule.to_mul_action_with_zero</code></p>



<a name="229833994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/229833994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#229833994">(Mar 11 2021 at 11:33)</a>:</h4>
<p>I just pushed the instance on <code>semimodule</code>, thanks!</p>



<a name="230064672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/230064672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#230064672">(Mar 12 2021 at 17:06)</a>:</h4>
<p>There has been quite a bit of movement on PR <a href="https://github.com/leanprover-community/mathlib/issues/6590">#6590</a>, but finally, it seems that it builds!</p>
<p>If anyone has any further comments, I would be very happy to hear them!  For my part, I am happy with it.  I plan to add something about <code>M</code>-regularity under injective maps, but this is for a separate PR, since I am not really willing to change this PR, unless requested to do so!  <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="230066309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/230066309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#230066309">(Mar 12 2021 at 17:18)</a>:</h4>
<p>It might make sense to split the PR into the scary new typeclass bit and the not-scary new <code>is_smul_regular</code> bit, but lets see whether any other reviewer feels strongly</p>



<a name="230066470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/230066470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#230066470">(Mar 12 2021 at 17:19)</a>:</h4>
<p>I agree that this should have been the correct way, but given how it is now, it might make sense to leave it as is.</p>
<p>Still, if it is preferred to split it, I can certainly do it!</p>



<a name="230067241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/230067241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#230067241">(Mar 12 2021 at 17:25)</a>:</h4>
<p>Splitting ought to be straightforward, since you can just delete the new <code>is_smul_regular</code> file</p>



<a name="230082116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/230082116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#230082116">(Mar 12 2021 at 19:10)</a>:</h4>
<p>Eric, you were right: I was just resisting, since I am not too comfortable with git!  I did manage to loose the <code>smul_regular</code> file on my machine, but I could copy it from the history in github!</p>



<a name="230082398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%236588%20%2B%20%236590/near/230082398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/144837-PR-reviews/topic/.236588.20.2B.20.236590.html#230082398">(Mar 12 2021 at 19:12)</a>:</h4>
<p>Now there are two separate PRs.</p>
<ul>
<li><a href="https://github.com/leanprover-community/mathlib/issues/6590">#6590</a>, introducing <code>smul_with_zero</code> and <code>mul_action_with_zero</code>: two typeclasses to deal with multiplicative actions of monoid with zero, without the need to assume the presence of an addition!</li>
<li><a href="https://github.com/leanprover-community/mathlib/issues/6659">#6659</a>, introducing <code>M</code>-regular elements, called <code>is_smul_regular</code>: the analogue of <code>is_left_regular</code>, but defined for an action of monoid_with_zero on a module <code>M</code>.</li>
</ul>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>