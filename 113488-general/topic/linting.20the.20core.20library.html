---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/linting.20the.20core.20library.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html">linting the core library</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="195738547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195738547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195738547">(Apr 29 2020 at 16:47)</a>:</h4>
<p>This is a thread to discuss <a href="https://github.com/leanprover-community/lean/issues/200" title="https://github.com/leanprover-community/lean/issues/200">lean#200</a>, which proposes linting the core library. I think it's a good idea. Should we have some guidelines for linting PRs? Also, any ideas for a good CI setup? <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span></p>



<a name="195738706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195738706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195738706">(Apr 29 2020 at 16:48)</a>:</h4>
<p>We definitely should lint core, but it's a little tricky I think. Ideally it would be part of core CI. But do we want to move the linter framework and definitions to core?</p>



<a name="195738729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195738729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195738729">(Apr 29 2020 at 16:48)</a>:</h4>
<p>I'm not sure that's a good idea.</p>



<a name="195738798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195738798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195738798">(Apr 29 2020 at 16:49)</a>:</h4>
<p>We could expand mathlib CI to also lint core, but then new errors don't show up until the version upgrade PRs to mathlib.</p>



<a name="195738979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195738979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195738979">(Apr 29 2020 at 16:50)</a>:</h4>
<p>What do you mean by guidelines for linting PRs? There's nothing of the kind in mathlib afaik, and the <a href="https://leanprover-community.github.io/mathlib_stats/nolints.png" title="https://leanprover-community.github.io/mathlib_stats/nolints.png">graph</a> shows we're doing a reasonable job of cleaning things up anyway.</p>
<div class="message_inline_image"><a href="https://leanprover-community.github.io/mathlib_stats/nolints.png" title="graph"><img src="https://leanprover-community.github.io/mathlib_stats/nolints.png"></a></div>



<a name="195739295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195739295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195739295">(Apr 29 2020 at 16:53)</a>:</h4>
<p>Yeah, I guess I'm not sure what such guidelines would look like. Maybe just some suggestions on which linting errors to prioritize?</p>



<a name="195739917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195739917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195739917">(Apr 29 2020 at 16:58)</a>:</h4>
<p>I think the easy change is just making mathlib CI also lint core. It's low effort and seems uncontroversial.</p>



<a name="195740007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195740007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195740007">(Apr 29 2020 at 16:59)</a>:</h4>
<p>For graphing purposes I'd rather keep the mathlib and core nolints files separate, but that's completely an aesthetic thing...</p>



<a name="195740726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195740726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195740726">(Apr 29 2020 at 17:05)</a>:</h4>
<p>I've mentioned this in the issue already, but I think it is better to run the  linters in mathlib CI instead of core CI.  There are some linters where declarations in mathlib can cause linting errors in core, and I'd like to catch these as well.</p>



<a name="195740955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195740955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195740955">(Apr 29 2020 at 17:07)</a>:</h4>
<p>Alternatively: core CI also checks mathlib...</p>



<a name="195741138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195741138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195741138">(Apr 29 2020 at 17:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/linting.20the.20core.20library/near/195740955" title="#narrow/stream/113488-general/topic/linting.20the.20core.20library/near/195740955">said</a>:</p>
<blockquote>
<p>Alternatively: core CI also checks mathlib...</p>
</blockquote>
<p>We want to be able to make non-backward compatible changes in core though.</p>



<a name="195741278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195741278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195741278">(Apr 29 2020 at 17:09)</a>:</h4>
<p>We can still manually overrule the complaints of CI, right?</p>



<a name="195741289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195741289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195741289">(Apr 29 2020 at 17:09)</a>:</h4>
<p>But I get your point</p>



<a name="195753884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195753884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195753884">(Apr 29 2020 at 18:52)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/tree/lint-core" title="https://github.com/leanprover-community/mathlib/tree/lint-core">https://github.com/leanprover-community/mathlib/tree/lint-core</a></p>



<a name="195754133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195754133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195754133">(Apr 29 2020 at 18:54)</a>:</h4>
<p>Question: is it possible that changes to mathlib will cause linter failures in core? These errors would be very annoying to fix.</p>



<a name="195754269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195754269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195754269">(Apr 29 2020 at 18:55)</a>:</h4>
<p>(<a href="https://github.com/leanprover-community/mathlib/runs/630728620" title="https://github.com/leanprover-community/mathlib/runs/630728620">This</a> should be a successful run. The next commit will move some declarations to another file that will force it to recompile everything.)</p>



<a name="195755907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195755907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195755907">(Apr 29 2020 at 19:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/linting.20the.20core.20library/near/195754133" title="#narrow/stream/113488-general/topic/linting.20the.20core.20library/near/195754133">said</a>:</p>
<blockquote>
<p>Question: is it possible that changes to mathlib will cause linter failures in core?</p>
</blockquote>
<p>Yes.  That's precisely why I'd like the linter to be run in mathlib.  One concrete example: if you write a simp lemma that is already a simp lemma in core, then the duplicate lemma in core will get an linting error.  This kind of error is easy to fix, namely in mathlib.<br>
As a general policy I would suggest that it is OK to add declarations to <code>nolints.txt</code> as long as you open a PR to fix it in core.</p>



<a name="195759009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linting%20the%20core%20library/near/195759009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linting.20the.20core.20library.html#195759009">(Apr 29 2020 at 19:30)</a>:</h4>
<p>I dunno, it doesn't really feel ergonomic. For one, it's best if people can ignore the <code>nolints</code> files completely just like they can ignore the rest of the CI stuff. It's confusing to tell people that the way to fix their PR is to edit some "read-only" file and make another PR to a different repo, no?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>