---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/nnreal.20lattice.20broken.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html">nnreal lattice broken</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282070414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282070414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282070414">(May 12 2022 at 07:56)</a>:</h4>
<p>While bumping mathlib in LTE, I hit the following issue.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.nnreal</span>

<span class="n">open_locale</span> <span class="n">nnreal</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nnreal.semilattice_inf</span> <span class="bp">=</span> <span class="n">lattice.to_semilattice_inf</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="282070948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282070948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282070948">(May 12 2022 at 08:01)</a>:</h4>
<p>I guess this is a bug in mathlib that wasn't there before. Can we somehow lint against introducing such bugs? I guess that's hard.</p>



<a name="282071383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282071383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282071383">(May 12 2022 at 08:05)</a>:</h4>
<p>FYI, the LHS is among these derived instances, where as the RHS comes from a chain of instances that ultimately leads to <code>conditionally_complete_linear_order_bot ℝ≥0</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[derive [</span>
<span class="kd">  ordered_semiring, comm_monoid_with_zero, -- to ensure these instance are computable</span>
<span class="kd">  floor_semiring,</span>
<span class="kd">  semilattice_inf, densely_ordered, order_bot,</span>
<span class="kd">  canonically_linear_ordered_add_monoid, linear_ordered_comm_group_with_zero, archimedean,</span>
<span class="kd">  linear_ordered_semiring, ordered_comm_semiring, canonically_ordered_comm_semiring,</span>
<span class="kd">  has_sub, has_ordered_sub, has_div, inhabited]</span><span class="o">]</span>
<span class="kd">def</span> <span class="n">nnreal</span> <span class="o">:=</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">//</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">r</span><span class="o">}</span>

<span class="c1">-- &lt;snip&gt;</span>

<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="o">:</span> <span class="n">conditionally_complete_linear_order_bot</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span> <span class="o">:=</span>
<span class="n">nonneg.conditionally_complete_linear_order_bot</span> <span class="n">real.Sup_empty.le</span>
</code></pre></div>



<a name="282075034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075034">(May 12 2022 at 08:40)</a>:</h4>
<p>Do you know which field disagrees?</p>



<a name="282075280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075280">(May 12 2022 at 08:42)</a>:</h4>
<p>Might it have to do with the <code>renaming min → inf, max → sup</code>?</p>



<a name="282075302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075302">(May 12 2022 at 08:43)</a>:</h4>
<p>looks like <code>inf</code></p>



<a name="282075331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075331">(May 12 2022 at 08:43)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">nnreal.semilattice_inf.inf</span> <span class="bp">=</span> <span class="o">(</span><span class="n">lattice.to_semilattice_inf</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span><span class="bp">.</span><span class="n">inf</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="282075560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075560">(May 12 2022 at 08:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="n">tactic.whnf</span> <span class="bp">`</span><span class="o">(</span><span class="n">nnreal.semilattice_inf.inf</span><span class="o">)</span> <span class="bp">&gt;&gt;=</span> <span class="n">tactic.trace</span>
<span class="c1">-- λ (x y : {x // (λ (x : ℝ), x ∈ set.Ici 0) x}), ⟨x.val ⊓ y.val, _⟩</span>
<span class="k">#eval</span> <span class="n">tactic.whnf</span> <span class="bp">`</span><span class="o">((</span><span class="n">lattice.to_semilattice_inf</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span><span class="bp">.</span><span class="n">inf</span><span class="o">)</span> <span class="bp">&gt;&gt;=</span> <span class="n">tactic.trace</span>
<span class="c1">-- λ (a b : {x // x ∈ set.Ici 0}), ite (a ≤ b) a b</span>
</code></pre></div>



<a name="282075565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075565">(May 12 2022 at 08:45)</a>:</h4>
<p>What happens if you replace the RHS with <code>(lattice.to_semilattice_inf ℝ≥0).min</code>?</p>



<a name="282075666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075666">(May 12 2022 at 08:46)</a>:</h4>
<p>so yes, it looks like the culprit is using <code>min</code> as <code>inf</code> instead of inheriting it</p>



<a name="282075803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282075803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282075803">(May 12 2022 at 08:47)</a>:</h4>
<p>Where does this happen? In <a href="https://leanprover-community.github.io/mathlib_docs/find/nonneg.conditionally_complete_linear_order_bot">docs#nonneg.conditionally_complete_linear_order_bot</a>?</p>



<a name="282078127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078127">(May 12 2022 at 09:09)</a>:</h4>
<p>it gets down to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">lattice.to_semilattice_inf</span> <span class="n">ℝ</span><span class="bp">≥</span><span class="mi">0</span><span class="o">)</span><span class="bp">.</span><span class="n">inf</span> <span class="bp">=</span>
  <span class="o">(</span><span class="n">distrib_lattice.to_lattice</span> <span class="o">(</span><span class="n">set.Ici</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">ℝ</span><span class="o">)))</span><span class="bp">.</span><span class="n">inf</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- ok</span>
<span class="kd">example</span> <span class="o">:</span>
  <span class="n">nnreal.semilattice_inf.inf</span> <span class="bp">=</span>
  <span class="o">(</span><span class="n">distrib_lattice.to_lattice</span> <span class="o">(</span><span class="n">set.Ici</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">ℝ</span><span class="o">)))</span><span class="bp">.</span><span class="n">inf</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fail</span>
</code></pre></div>



<a name="282078241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078241">(May 12 2022 at 09:10)</a>:</h4>
<p>this is via <a href="https://leanprover-community.github.io/mathlib_docs/find/ord_connected_subset_conditionally_complete_linear_order">docs#ord_connected_subset_conditionally_complete_linear_order</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/subset_conditionally_complete_linear_order">docs#subset_conditionally_complete_linear_order</a></p>



<a name="282078405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078405">(May 12 2022 at 09:12)</a>:</h4>
<p>note that one of the type class args in <code>distrib_lattice.to_lattice (set.Ici (0:ℝ))</code> is <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_order.to_distrib_lattice">docs#linear_order.to_distrib_lattice</a> which definitely introduces an <code>if</code> via <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_order.to_lattice">docs#linear_order.to_lattice</a> which uses <code>inf := min</code></p>



<a name="282078549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078549">(May 12 2022 at 09:13)</a>:</h4>
<p>Why do we still carry around <code>min</code> and <code>max</code>fields, actually? Surely it would be better and safer to only have <code>sup</code> and <code>inf</code>?</p>



<a name="282078606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078606">(May 12 2022 at 09:14)</a>:</h4>
<p>we don't</p>



<a name="282078669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078669">(May 12 2022 at 09:15)</a>:</h4>
<p><code>linear_order.to_lattice</code> clearly needs to make up an <code>inf</code> from <code>min</code></p>



<a name="282078706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078706">(May 12 2022 at 09:15)</a>:</h4>
<p>But why does it even have a <code>min</code> in the first place?</p>



<a name="282078720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078720">(May 12 2022 at 09:15)</a>:</h4>
<p><code>min</code> is a function</p>



<a name="282078731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078731">(May 12 2022 at 09:15)</a>:</h4>
<p>not a field</p>



<a name="282078826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078826">(May 12 2022 at 09:16)</a>:</h4>
<p>if you have a linear order and want a lattice, you have to make up an <code>inf</code> field and the obvious way to do so is <code>if a &lt;= b then a else b</code> also known as <code>min a b</code></p>



<a name="282078856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078856">(May 12 2022 at 09:17)</a>:</h4>
<p>I think it might make sense to put <code>inf</code>  in <code>linear_order</code> as a field though to avoid this</p>



<a name="282078887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078887">(May 12 2022 at 09:17)</a>:</h4>
<p>Yes; that was my question all along. Why does <code>linear_order</code> not have a <code>inf</code> field?</p>



<a name="282078897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078897">(May 12 2022 at 09:17)</a>:</h4>
<p>because it's an order typeclass</p>



<a name="282078960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078960">(May 12 2022 at 09:18)</a>:</h4>
<p>... precisely?</p>



<a name="282078965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282078965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282078965">(May 12 2022 at 09:18)</a>:</h4>
<p>back in the old days we weren't as aggressive about having things at the bottom of the hierarchy have literally everything</p>



<a name="282079037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282079037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282079037">(May 12 2022 at 09:19)</a>:</h4>
<p>Yeah, it's more and more common these days. I will myself add another two fields to <code>boolean_algebra</code> soonish.</p>



<a name="282079082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282079082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282079082">(May 12 2022 at 09:19)</a>:</h4>
<p>it's also possible to fix this issue in <a href="https://leanprover-community.github.io/mathlib_docs/find/subset_conditionally_complete_linear_order/src">src#subset_conditionally_complete_linear_order</a> without a huge refactor</p>



<a name="282079154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282079154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282079154">(May 12 2022 at 09:20)</a>:</h4>
<p>by overriding the <code>inf</code> fields inherited from <code>distrib_lattice.to_lattice s</code> with the ones coming from the lattice instance</p>



<a name="282080529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282080529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282080529">(May 12 2022 at 09:35)</a>:</h4>
<p>oh! <code>linear_order</code> already has a <code>min</code> field</p>



<a name="282080578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282080578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282080578">(May 12 2022 at 09:36)</a>:</h4>
<p>I guess the aggressive refactor has already happened</p>



<a name="282081009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282081009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282081009">(May 12 2022 at 09:41)</a>:</h4>
<p>so actually the real culprit is <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype.linear_order/src">src#subtype.linear_order</a></p>



<a name="282081298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282081298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282081298">(May 12 2022 at 09:43)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/linear_order.lift/src">src#linear_order.lift</a> can be forgiven for not overriding the <code>max</code> field since it wasn't given enough data to do so, but <code>subtype.linear_order</code> is definitely committing crimes against defeq</p>



<a name="282084663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282084663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282084663">(May 12 2022 at 10:17)</a>:</h4>
<blockquote>
<p>since it wasn't given enough data to do so</p>
</blockquote>
<p>I think we should probably add <code>has_inf</code> and <code>has_sup</code> arguments to it</p>



<a name="282084714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282084714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282084714">(May 12 2022 at 10:18)</a>:</h4>
<p>Having helper functions insiduously populate defaults with bad values seems like a bad thing.</p>



<a name="282084794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282084794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282084794">(May 12 2022 at 10:19)</a>:</h4>
<p>You can accomplish the same thing by applying <code>lattice.copy</code> to the result, but I see what you mean about bad defaults</p>



<a name="282084908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282084908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282084908">(May 12 2022 at 10:20)</a>:</h4>
<p>I think it is not uncommon for these kinds of non-instance helper definitions to fill in fields though</p>



<a name="282084939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282084939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282084939">(May 12 2022 at 10:21)</a>:</h4>
<p>after all, at some point you actually have to provide a value, you can't just always be delegating to the caller</p>



<a name="282085137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282085137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282085137">(May 12 2022 at 10:23)</a>:</h4>
<p>In this case I think we actually want two helper definitions, since the natural side condition for a <code>min</code> argument in <code>linear_order.lift</code> is <code>f (min a b) = min (f a) (f b)</code> and you can't easily discharge that by <code>rfl</code> if you want the default field</p>



<a name="282085843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282085843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282085843">(May 12 2022 at 10:28)</a>:</h4>
<p>Note that for things like <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.monoid">docs#function.injective.monoid</a> we just force the user to deal with that annoying side goal</p>



<a name="282085889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282085889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282085889">(May 12 2022 at 10:29)</a>:</h4>
<p>Because having duplicates is mainly just providing users extra tools to shoot themselves in the foot with (and a maintenance nightmare)</p>



<a name="282090722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282090722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282090722">(May 12 2022 at 11:20)</a>:</h4>
<p>In <code>function.injective.monoid</code> there is no possible default value though</p>



<a name="282090756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282090756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282090756">(May 12 2022 at 11:20)</a>:</h4>
<p>that's just the actual requirement on the definition</p>



<a name="282090837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282090837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282090837">(May 12 2022 at 11:21)</a>:</h4>
<p>the same would also be true for a <code>lattice.lift</code>, you would have <code>f (inf a b) = inf (f a) (f b)</code> and no possibility to otherwise discharge it, but for linear orders we have a default value for the field</p>



<a name="282091330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282091330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282091330">(May 12 2022 at 11:25)</a>:</h4>
<p>Luckily we have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">semilattice_inf.ext</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="o">(</span><span class="kd">by</span> <span class="n">haveI</span> <span class="o">:=</span> <span class="n">A</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">partial_order.ext</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">ss</span> <span class="o">:=</span> <span class="n">funext</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">funext</span> <span class="bp">$</span> <span class="n">semilattice_inf.ext_inf</span> <span class="n">H</span> <span class="n">x</span><span class="o">),</span>
  <span class="n">casesI</span> <span class="n">A</span><span class="o">,</span> <span class="n">casesI</span> <span class="n">B</span><span class="o">,</span>
  <span class="n">injection</span> <span class="n">this</span><span class="bp">;</span> <span class="n">congr'</span>
<span class="kd">end</span>
</code></pre></div>
<p>so I can at least keep that part of LTE sorry-free.</p>



<a name="282095777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282095777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282095777">(May 12 2022 at 12:08)</a>:</h4>
<p>In <code>function.injective.monoid</code> there's a perfectly sensible default for <code>has_pow M ℕ</code>; the one used by <a href="https://leanprover-community.github.io/mathlib_docs/find/monoid.mk">docs#monoid.mk</a></p>



<a name="282095825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282095825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282095825">(May 12 2022 at 12:08)</a>:</h4>
<p>But it's usually a trap to actually use it</p>



<a name="282095931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282095931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282095931">(May 12 2022 at 12:09)</a>:</h4>
<p>Which is why I refactored <code>function.injective.monoid</code> to not use those defaults any more</p>



<a name="282196593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282196593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Violeta Hernández <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282196593">(May 13 2022 at 02:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/nnreal.20lattice.20broken/near/282070948">said</a>:</p>
<blockquote>
<p>I guess this is a bug in mathlib that wasn't there before. Can we somehow lint against introducing such bugs? I guess that's hard.</p>
</blockquote>
<p>We can always add <code>example</code>s for things like these</p>



<a name="282203956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282203956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282203956">(May 13 2022 at 05:06)</a>:</h4>
<p>True. But I meant a more principled and generic way.</p>



<a name="282204013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/282204013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#282204013">(May 13 2022 at 05:07)</a>:</h4>
<p>That example would only test that this particular example (<code>semilattice_inf</code>) wouldn't break. But a similar issue might pop up involving <code>metric_space</code>, or whatever...</p>



<a name="287892478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287892478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287892478">(Jun 29 2022 at 17:51)</a>:</h4>
<p>In <a href="https://github.com/leanprover-community/mathlib/pull/15056">#15056</a> I'm trying to fix the diamond. In this branch, <code>subtype.lattice _ _</code> is definitionally equal to <code>linear_order.to_lattice</code> but this equality doesn't work with <code>instances</code> transparency. How do I find which semireducible definition it fails to unfold?</p>



<a name="287894093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894093">(Jun 29 2022 at 18:03)</a>:</h4>
<p>BTW, definitions line <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.linear_ordered_comm_monoid">docs#function.injective.linear_ordered_comm_monoid</a> use <code>linear_order.lift</code>, so they create diamonds whenever we use them for subtypes.</p>



<a name="287894152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894152">(Jun 29 2022 at 18:03)</a>:</h4>
<p>Should we move <code>has_sup</code> and <code>has_inf</code> to core?</p>



<a name="287894241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894241">(Jun 29 2022 at 18:04)</a>:</h4>
<p>Then rewrite <code>linear_order.lift</code> so that it takes <code>has_sup</code> and <code>has_inf</code> arguments?</p>



<a name="287894637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894637">(Jun 29 2022 at 18:07)</a>:</h4>
<p>BTW, why <code>tests/lean/perf/perm_ac_dlof_50.lean</code> in the lean3 test suite doesn't cause problems?</p>



<a name="287894657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894657">(Jun 29 2022 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="287894693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894693">(Jun 29 2022 at 18:07)</a>:</h4>
<p>It tries to import a non-existing file, then use a non-existing class.</p>



<a name="287894863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287894863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287894863">(Jun 29 2022 at 18:08)</a>:</h4>
<p>Another question: why <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_order.decidable_le">docs#linear_order.decidable_le</a> is not an instance but <a href="https://leanprover-community.github.io/mathlib_docs/find/has_le.le.decidable">docs#has_le.le.decidable</a> is an instance?</p>



<a name="287895733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287895733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287895733">(Jun 29 2022 at 18:14)</a>:</h4>
<p>What would be the advantage of moving has_inf to core?</p>



<a name="287895785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287895785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287895785">(Jun 29 2022 at 18:14)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/linear_order.lift">docs#linear_order.lift</a> should certainly take has_inf and has_sup arguments</p>



<a name="287896108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287896108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287896108">(Jun 29 2022 at 18:17)</a>:</h4>
<p>Or we can rename <code>min</code>/<code>max</code> fields of <code>linear_order</code> to <code>inf</code>/<code>sup</code>, then drop workarounds in <code>conditionally_complete_linear_order_with_bot</code> etc.</p>



<a name="287898389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287898389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287898389">(Jun 29 2022 at 18:33)</a>:</h4>
<p>What workarounds are you thinking of?</p>



<a name="287898846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287898846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287898846">(Jun 29 2022 at 18:37)</a>:</h4>
<p><code>renaming</code></p>



<a name="287899637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287899637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287899637">(Jun 29 2022 at 18:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/nnreal.20lattice.20broken/near/287894637">said</a>:</p>
<blockquote>
<p>BTW, why <code>tests/lean/perf/perm_ac_dlof_50.lean</code> in the lean3 test suite doesn't cause problems?</p>
</blockquote>
<p>I guess the perf subfolder just isn't run as part of any CI?</p>



<a name="287899882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287899882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287899882">(Jun 29 2022 at 18:45)</a>:</h4>
<p>Is <code>renaming</code> causing problems?</p>



<a name="287900066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287900066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287900066">(Jun 29 2022 at 18:46)</a>:</h4>
<p>No, but it is easy to forget to do it in some other case.</p>



<a name="287900744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287900744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287900744">(Jun 29 2022 at 18:52)</a>:</h4>
<p>The following works/fails in my branch:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">order.lattice</span>

<span class="kd">variables</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">P</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">(</span><span class="n">Psup</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">⦃</span><span class="n">x</span> <span class="n">y</span><span class="o">⦄,</span> <span class="n">P</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">P</span> <span class="n">y</span> <span class="bp">→</span> <span class="n">P</span> <span class="o">(</span><span class="n">x</span> <span class="bp">⊔</span> <span class="n">y</span><span class="o">))</span> <span class="o">(</span><span class="n">Pinf</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">⦃</span><span class="n">x</span> <span class="n">y</span><span class="o">⦄,</span> <span class="n">P</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">P</span> <span class="n">y</span> <span class="bp">→</span> <span class="n">P</span> <span class="o">(</span><span class="n">x</span> <span class="bp">⊓</span> <span class="n">y</span><span class="o">))</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">semilattice_sup.to_partial_order</span> <span class="n">_</span> <span class="o">(</span><span class="n">subtype.semilattice_sup</span> <span class="n">Psup</span><span class="o">)</span> <span class="bp">=</span> <span class="n">infer_instance</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">tactic.reflexivity</span> <span class="n">tactic.transparency.instances</span> <span class="c1">-- works</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">semilattice_sup.to_has_sup</span> <span class="n">_</span> <span class="o">(</span><span class="n">subtype.semilattice_sup</span> <span class="n">Psup</span><span class="o">)</span> <span class="bp">=</span> <span class="n">infer_instance</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">tactic.reflexivity</span> <span class="n">tactic.transparency.instances</span> <span class="c1">-- works</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">subtype.semilattice_sup</span> <span class="n">Psup</span> <span class="bp">=</span> <span class="n">infer_instance</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">tactic.reflexivity</span> <span class="n">tactic.transparency.instances</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="287900851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nnreal%20lattice%20broken/near/287900851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nnreal.20lattice.20broken.html#287900851">(Jun 29 2022 at 18:52)</a>:</h4>
<p>How can it happen?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>