---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html">Why are these not definitionally equal?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204321893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204321893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204321893">(Jul 18 2020 at 23:07)</a>:</h4>
<p>This project is sorry-free except for one theorem at the end of <code>archive/100-theorems-list/83_friendship/char_poly.lean</code>:<a href="https://github.com/leanprover-community/mathlib/compare/freek_83_friendship_theorem">https://github.com/leanprover-community/mathlib/compare/freek_83_friendship_theorem</a></p>



<a name="204321935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204321935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204321935">(Jul 18 2020 at 23:08)</a>:</h4>
<p>The sorries in that theorem seem like they should be solvable by <code>refl</code>, but there's some subtle difference in the definitions.</p>



<a name="204321944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204321944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204321944">(Jul 18 2020 at 23:09)</a>:</h4>
<p>Can anybody help figure out how to make lean realize these things are trivially equal, or even better, avoid using <code>transitivity</code> to begin with?</p>



<a name="204416548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204416548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204416548">(Jul 20 2020 at 12:37)</a>:</h4>
<p>By removing the <code>classical</code>, I managed to prove one of the remaining sorries with <code>refl</code>.</p>



<a name="204416634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204416634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204416634">(Jul 20 2020 at 12:38)</a>:</h4>
<p>The other one I popped out into a lemma immediately above. It looks completely doable, but when I try to rewrite by <code>matrix.map_sub</code> (which is missing, so I added) something goes wrong...</p>



<a name="204416657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204416657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204416657">(Jul 20 2020 at 12:39)</a>:</h4>
<p>Even using <code>convert</code> with <code>matrix.map_sub</code> times out, so there is still something definitionally sick hiding in these terms! :-)</p>



<a name="204417330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204417330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204417330">(Jul 20 2020 at 12:46)</a>:</h4>
<p>oof</p>



<a name="204419177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204419177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204419177">(Jul 20 2020 at 13:04)</a>:</h4>
<p>hmm I'm not sure how to show that <code>(X • 1)^p = X^p • 1</code> (I'm working on writing this as a sorry)</p>



<a name="204421025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204421025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204421025">(Jul 20 2020 at 13:21)</a>:</h4>
<p>I got it with this, which I wasn't able to find in the library</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">polynomial</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>

<span class="kn">lemma</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">smul_pow</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">r</span> <span class="err">•</span> <span class="n">a</span><span class="o">)</span><span class="bp">^</span><span class="n">k</span> <span class="bp">=</span> <span class="n">r</span><span class="bp">^</span><span class="n">k</span> <span class="err">•</span> <span class="n">a</span><span class="bp">^</span><span class="n">k</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">k</span> <span class="k">with</span> <span class="n">d</span> <span class="n">hd</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">pow_succ</span><span class="o">,</span> <span class="n">hd</span><span class="o">],</span> <span class="n">rw</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">smul_mul_assoc</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">smul_smul</span><span class="o">,</span> <span class="n">ring</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204426436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204426436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204426436">(Jul 20 2020 at 14:09)</a>:</h4>
<p>Clearly, we need a <code>smul_one</code> simp-lemma</p>



<a name="204428277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204428277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204428277">(Jul 20 2020 at 14:23)</a>:</h4>
<p>i have these but i'm not sure how they generalize</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">matrix</span>

<span class="kn">open</span> <span class="n">finset</span> <span class="n">matrix</span>
<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="n">universes</span> <span class="n">v</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">nat</span><span class="bp">.</span><span class="n">smul_one</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">d</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">d</span> <span class="k">with</span> <span class="n">k</span> <span class="n">hk</span><span class="o">,</span> <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ_eq_add_one</span><span class="o">,</span> <span class="n">push_cast</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">hk</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">add_smul</span><span class="o">],</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">int</span><span class="bp">.</span><span class="n">smul_one</span>  <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">d</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply</span> <span class="n">gsmul_one</span>
</code></pre></div>



<a name="204498809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204498809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204498809">(Jul 20 2020 at 23:58)</a>:</h4>
<p>I think something like <code>mat_poly_equiv_coeff_apply</code> can do a chunk of the work here</p>



<a name="204499139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204499139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204499139">(Jul 21 2020 at 00:02)</a>:</h4>
<p>yeah, we have to check an equality in <code>matrix n n (polynomial (zmod p))</code>, and it would be "just a computation" if we were thinking of it as <code>matrix n n (zmod p) \otimes polynomial (zmod p)</code></p>



<a name="204499150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204499150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204499150">(Jul 21 2020 at 00:03)</a>:</h4>
<p>so I guess i should go study scott's proof of cayley hamilton more closely</p>



<a name="204511730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204511730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204511730">(Jul 21 2020 at 04:35)</a>:</h4>
<p><span class="user-mention" data-user-id="252300">@Jalex Stark</span> Hmmm, are you sure that it makes a substantial difference? If <code>p</code> is arbitrary, than it's not like you can ask Lean to do the computation for you.</p>



<a name="204533932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204533932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204533932">(Jul 21 2020 at 10:55)</a>:</h4>
<p>Sorry, I don't mean that the proof will be <code>dec_trivial</code>, but rather it'll be <code>rw</code>with several forms of bilinearity of the tensor product</p>



<a name="204874627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Why%20are%20these%20not%20definitionally%20equal%3F/near/204874627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Why.20are.20these.20not.20definitionally.20equal.3F.html#204874627">(Jul 24 2020 at 02:51)</a>:</h4>
<p>we sorted this out! one of the several issues was that typeclass inference could not find the appropriate <code>char_p</code> instance, hence <a href="https://github.com/leanprover-community/mathlib/issues/3535">#3535</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>