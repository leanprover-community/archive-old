---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html">simps?, reassoc?, mk_iff?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="232349498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232349498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232349498">(Mar 29 2021 at 23:08)</a>:</h4>
<p>A proposal: all attributes on declarations which generate auxiliary declarations should have a <code>?</code> mode, which behaves just as normal but prints a trace message, either</p>
<ol>
<li>listing the full names of the new declarations</li>
<li>printing the full types of the new declarations</li>
</ol>



<a name="232349715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232349715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232349715">(Mar 29 2021 at 23:11)</a>:</h4>
<p>For me at least, it is a common problem deciphering what exactly has been generated. <code>@[simps]</code> has <code>set_option trace.simps.verbose</code> and <code>set_option trace.simps.debug</code>, but I would like a common interface, ideally extremely quick to add or remove in place: hence the proposal for <code>?</code>.</p>



<a name="232360330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232360330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232360330">(Mar 30 2021 at 01:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F/near/232349498">said</a>:</p>
<blockquote>
<p>A proposal: all attributes on declarations which generate auxiliary declarations should have a <code>?</code> mode, which behaves just as normal but prints a trace message, either</p>
<ol>
<li>listing the full names of the new declarations</li>
<li>printing the full types of the new declarations</li>
</ol>
</blockquote>
<p>I think both of those!</p>



<a name="232360358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232360358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232360358">(Mar 30 2021 at 01:29)</a>:</h4>
<p>By the way my temporary work-around for this problem is to use <code>#print prefix</code> afterwards, but I agree a <code>?</code> would be better</p>



<a name="232376269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232376269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232376269">(Mar 30 2021 at 05:33)</a>:</h4>
<p>I would like to see <code>instance</code>optionally report the name of the def it made too :-) I can never remember the rules and if I'm in mathlib I might not know if I'm in a namespace etc</p>



<a name="232376445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232376445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232376445">(Mar 30 2021 at 05:36)</a>:</h4>
<p>Yeah. I wonder if we should just outlaw unnamed instances.</p>



<a name="232377059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232377059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232377059">(Mar 30 2021 at 05:47)</a>:</h4>
<p>The problem with <code>instance?</code> is that it causes 85% of mathlib to recompile, if you use it on an instance low in the hierarchy</p>



<a name="232377071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232377071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232377071">(Mar 30 2021 at 05:47)</a>:</h4>
<p>As a user who is just becoming aware of these ghosts produced by Lean, I am finding this thread very useful!  Besides having a question mark, is there a way to simply <em>know</em> that Lean is producing more stuff than what I am actually typing?</p>
<p>I know that <code>print prefix</code> will sometimes give you more information, but I do not know when it would be useful.  On a separate note, I did not know that "unnamed" instances actually were "named by Lean"!  Is there a place where I can find a (not necessarily exhaustive) list of situations where I can assume that Lean is producing more in the background?</p>



<a name="232377072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232377072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232377072">(Mar 30 2021 at 05:47)</a>:</h4>
<p>I agree that it would be good to have a way to figure out instance names easily</p>



<a name="232378926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232378926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232378926">(Mar 30 2021 at 06:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F/near/232377059">said</a>:</p>
<blockquote>
<p>The problem with <code>instance?</code> is that it causes 85% of mathlib to recompile, if you use it on an instance low in the hierarchy</p>
</blockquote>
<p>I often just restart the server if I temporarily touch a file low down in the hierarchy.</p>



<a name="232381673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232381673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232381673">(Mar 30 2021 at 06:52)</a>:</h4>
<p>Right -- my use case is that I want to see the name generated by an instance command somewhere in mathlib, and then promptly return things to normal</p>



<a name="232381884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232381884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232381884">(Mar 30 2021 at 06:55)</a>:</h4>
<p>still, if VScode could show the name when you hover over <code>instance</code> that would be more ergonomical than appending <code>?</code> and restarting lean afterwards.</p>



<a name="232392325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232392325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232392325">(Mar 30 2021 at 08:43)</a>:</h4>
<p>That would be even better!</p>



<a name="232392953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232392953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232392953">(Mar 30 2021 at 08:49)</a>:</h4>
<p>Would we turn off the noisy linter for the <code>instance</code> decls then?<br>
To find instances, I usually make a scratch file like so:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">show_term</span> <span class="o">{</span> <span class="n">apply_instance</span> <span class="o">}</span>
</code></pre></div>



<a name="232393923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232393923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232393923">(Mar 30 2021 at 08:58)</a>:</h4>
<p>The problem with that approach is that it sometimes says "it was field.to_ring"</p>



<a name="232394080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232394080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232394080">(Mar 30 2021 at 08:59)</a>:</h4>
<p>I used to do it like that but now I tend to set things up in a tactic block so I can use the infoview to see the actual concrete instance which made it happen rather than just the projections which were applied afterwards.</p>



<a name="232447830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232447830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232447830">(Mar 30 2021 at 15:43)</a>:</h4>
<p>How about a more low level option? <code>set_option trace.new_definitions true</code> and then any time a declaration is added to the environment (via lean internals, user tactics, or directly), the full name of the definition is also printed</p>



<a name="232828895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/232828895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#232828895">(Apr 01 2021 at 21:39)</a>:</h4>
<p>I implemented this for <code>simps</code> specifically in <a href="https://github.com/leanprover-community/mathlib/issues/6995">#6995</a></p>



<a name="242308615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simps%3F%2C%20reassoc%3F%2C%20mk_iff%3F/near/242308615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simps.3F.2C.20reassoc.3F.2C.20mk_iff.3F.html#242308615">(Jun 11 2021 at 07:14)</a>:</h4>
<p>I am implementing this for <code>to_additive</code> in <a href="https://github.com/leanprover-community/mathlib/issues/7888">#7888</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>