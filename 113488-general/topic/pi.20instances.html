---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/pi.20instances.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html">pi instances</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="123598593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598593">(Mar 12 2018 at 08:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> and <span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> could you have a look at the wonderful tactics that <span class="user-mention" data-user-id="110026">@Simon Hudon</span> wrote for me in <a href="https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/indexed_product.lean" target="_blank" title="https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/indexed_product.lean">https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/indexed_product.lean</a> and tell me whether this is suitable for mathlib? Remember the mathematical goals is to have instances of algebraic structures for Pi products of groups, rings, modules etc. and the Lean goal is to avoids writing tons of lines like <a href="https://github.com/PatrickMassot/lean-differential-topology/blob/f47348abf8515e23bd485683d8b351c7fd89c70f/src/indexed_product.lean#L92" target="_blank" title="https://github.com/PatrickMassot/lean-differential-topology/blob/f47348abf8515e23bd485683d8b351c7fd89c70f/src/indexed_product.lean#L92">https://github.com/PatrickMassot/lean-differential-topology/blob/f47348abf8515e23bd485683d8b351c7fd89c70f/src/indexed_product.lean#L92</a></p>



<a name="123598652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598652">(Mar 12 2018 at 08:07)</a>:</h4>
<p>It seems a bit overkill, but it is clearly effective and I'd hate to throw a nice tactic like that away. Sure, PR away</p>



<a name="123598704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598704">(Mar 12 2018 at 08:09)</a>:</h4>
<p>(Re: overkill, consider that the tactic + proofs have actually <em>increased</em> the overall size of the file, from 100 to 156 lines, and it looks like you already have covered most of the algebraic hierarchy there, so I think that's nearly its complete applicability.)</p>



<a name="123598754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598754">(Mar 12 2018 at 08:11)</a>:</h4>
<p>I think the psychological impact will be different when those instances will be spread over five files instead of one</p>



<a name="123598756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598756">(Mar 12 2018 at 08:11)</a>:</h4>
<p>Would it make more worthwhile if we used the same tactic to prove that <code>vector n α</code> conforms to a given structure if <code>α</code> does and that it is true for other applicative functors than <code>vector n</code>?</p>



<a name="123598797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598797">(Mar 12 2018 at 08:12)</a>:</h4>
<p>And also, I think this is really cool tactic. I can't wait for the making of tutorial that Simon promised to write soon.</p>



<a name="123598844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123598844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123598844">(Mar 12 2018 at 08:14)</a>:</h4>
<p>:) I'll get right on that. I might procrastinate a bit with the <code>mono</code> tactic, I hope you'll forgive me</p>



<a name="123599072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599072">(Mar 12 2018 at 08:23)</a>:</h4>
<p>I can see how this would generalize to all applicative functors, and I agree that would increase the applicability. (Again, I'm not actually rejecting the tactic version, it is always nice to have a new tactic if only as a future example and base for later expermentation. I just probably would have tried to find a more efficient way to write the proofs, say by using <code>refine</code>, rather than automating the entire process.)</p>



<a name="123599166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599166">(Mar 12 2018 at 08:26)</a>:</h4>
<p>Cool</p>



<a name="123599179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599179">(Mar 12 2018 at 08:27)</a>:</h4>
<p>I do take your point that it's making more code rather than less. It should withstand a lot of reengineering of the hierarchy though.</p>



<a name="123599286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599286">(Mar 12 2018 at 08:31)</a>:</h4>
<p>I'm not sure you could do much better than the one-line proofs that were there. For me, I think that was an interesting exercise. I'm especially interested to see how the code can be improved now</p>



<a name="123599296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599296">(Mar 12 2018 at 08:31)</a>:</h4>
<p>since all the proofs follow the same script, you can abbreviate it with <code>refine {..}; funext; simp</code> or what have you</p>



<a name="123599342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599342">(Mar 12 2018 at 08:32)</a>:</h4>
<p>but for <code>simp</code> to work, don't you need all the laws of all the involved classes to be labelled <code>simp</code>?</p>



<a name="123599395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599395">(Mar 12 2018 at 08:34)</a>:</h4>
<p>I don't know how I'd implement it but if we could use the same tag system that the <code>case</code> system relies on, when we call <code>refine { .. }</code> we could tag each goal with the field that it responds to.</p>



<a name="123599401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599401">(Mar 12 2018 at 08:34)</a>:</h4>
<p>It would be more generally applicable and would probably shrink those scripts</p>



<a name="123599413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599413">(Mar 12 2018 at 08:35)</a>:</h4>
<p>I would just add anything that isn't a simp lemma to the bracket list until it works</p>



<a name="123599458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599458">(Mar 12 2018 at 08:36)</a>:</h4>
<p>Here obviously I'm thinking as a proof writer not a tactic writer</p>



<a name="123599468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599468">(Mar 12 2018 at 08:37)</a>:</h4>
<p>It's a cool idea to use tags with <code>refine {..}</code>. You would have to ask <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> about that</p>



<a name="123599469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599469">(Mar 12 2018 at 08:37)</a>:</h4>
<p>That makes sense and that's robust enough</p>



<a name="123599510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123599510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123599510">(Mar 12 2018 at 08:38)</a>:</h4>
<p>Glad you like it :) I'll talk to him about it</p>



<a name="123601977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123601977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123601977">(Mar 12 2018 at 10:05)</a>:</h4>
<blockquote>
<p>(Re: overkill, consider that the tactic + proofs have actually <em>increased</em> the overall size of the file, from 100 to 156 lines, and it looks like you already have covered most of the algebraic hierarchy there, so I think that's nearly its complete applicability.)</p>
</blockquote>
<p>Kenny and I had to prove that a slightly complicated structure was a ring, and our current effort looks like this:</p>



<a name="123601978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123601978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123601978">(Mar 12 2018 at 10:05)</a>:</h4>
<p><a href="https://github.com/kbuzzard/lean-stacks-project/blob/60db6a688861ec7a735e5818eb3d992cf8e2d7a5/src/scheme.lean#L368" target="_blank" title="https://github.com/kbuzzard/lean-stacks-project/blob/60db6a688861ec7a735e5818eb3d992cf8e2d7a5/src/scheme.lean#L368">https://github.com/kbuzzard/lean-stacks-project/blob/60db6a688861ec7a735e5818eb3d992cf8e2d7a5/src/scheme.lean#L368</a></p>



<a name="123602037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123602037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123602037">(Mar 12 2018 at 10:06)</a>:</h4>
<p>There's a lot of repeating <code>λ _, structure_presheaf_value.ext _ _ _ _ $ λ _ _, </code> which I felt might have been better dealt with by a general "maps to a ring with certain properties form a ring" tactic.</p>



<a name="123602167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123602167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123602167">(Mar 12 2018 at 10:10)</a>:</h4>
<p>I can have a look and see if the same tactics could apply</p>



<a name="123602301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/123602301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#123602301">(Mar 12 2018 at 10:14)</a>:</h4>
<p>I'll have a look tomorrow. Time for bed now</p>



<a name="188019557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pi%20instances/near/188019557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pi.20instances.html#188019557">(Feb 12 2020 at 15:25)</a>:</h4>
<p>Hi, <code>pi.monoid</code> defines <code>one := eq.mpr monoid._proof_2 (λ (_x : I), monoid.one (f _x))</code> where <code>monoid._proof_2</code> is a <code>rfl</code>. I tried to understand which line in <code>pi_instances</code> creates this <code>eq.mpr</code> but failed to understand the code of <code>derive_field</code>. <span class="user-mention" data-user-id="110026">@Simon Hudon</span>  Could you please explain what happens there?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>