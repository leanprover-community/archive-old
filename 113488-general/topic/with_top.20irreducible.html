---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/with_top.20irreducible.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html">with_top irreducible</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="260539316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539316">(Nov 06 2021 at 22:14)</a>:</h4>
<p>Should we make <code>with_top</code> and <code>with_bot</code> irreducible as Yury suggested on <a href="https://github.com/leanprover-community/mathlib/issues/4273">#4273</a>?</p>



<a name="260539422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539422">(Nov 06 2021 at 22:17)</a>:</h4>
<p>It breaks a lot of stuff. E.g., some instances on <code>with_top</code>/<code>with_bot</code> are defined in terms of the instances on the other type.</p>



<a name="260539435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539435">(Nov 06 2021 at 22:17)</a>:</h4>
<p>And once Lean fails to see through this, quite a few proofs fail.</p>



<a name="260539571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539571">(Nov 06 2021 at 22:21)</a>:</h4>
<p>Yeah, that's what I thought. Also, isn't there something with <code>order_dual</code> somehow swapping <code>with_top</code> and <code>with_bot</code>?</p>



<a name="260539842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539842">(Nov 06 2021 at 22:27)</a>:</h4>
<p>Yes, and this breaks with <code>@[irreducible]</code> too.</p>



<a name="260539849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539849">(Nov 06 2021 at 22:27)</a>:</h4>
<p>I really like the idea. I think that leaky proofs (when you have <code>a : with_top X</code> and then all of a sudden in the goal you see <code>a : option X</code>) cause confusion to undergraduates (and to me, when I was a beginner). They leak because sometimes the proof of <code>with_top.foo</code> is just <code>option.foo</code> and then Lean gets confused with the types. It's annoying not being able to apply some lemma about top because all of a sudden the term has become <code>none</code> somewhere along the line. The objection the other way is that this can cause code duplication -- these are somehow the same people who would rather <code>with_top.foo</code> simply didn't exist at all because "we have it already, it's just <code>option.foo</code>". We like type theory because we like that things keep their types!</p>



<a name="260539913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539913">(Nov 06 2021 at 22:28)</a>:</h4>
<p>We can replace <code>order_dual</code> proofs with a <code>to_additive</code>-style machinery but this would be a huge refactor.</p>



<a name="260539924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260539924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260539924">(Nov 06 2021 at 22:29)</a>:</h4>
<p>(and we need <code>order_dual</code> anyway)</p>



<a name="260540097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540097">(Nov 06 2021 at 22:32)</a>:</h4>
<p>I've myself suffered from this leaky implementation and I must say it's pretty annoying. Can't we make <code>with_top</code> and <code>with_bot</code> irreducible globally but rducible during API building?</p>



<a name="260540117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540117">(Nov 06 2021 at 22:34)</a>:</h4>
<p>Sounds like the best of both worlds, unless someone has been wrongly peeking in the API.</p>



<a name="260540162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540162">(Nov 06 2021 at 22:34)</a>:</h4>
<p>Irreducible stuff went out of fashion because of Lean 4.</p>



<a name="260540166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540166">(Nov 06 2021 at 22:35)</a>:</h4>
<p>We're meant to use structures instead.</p>



<a name="260540172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540172">(Nov 06 2021 at 22:35)</a>:</h4>
<p>Oh! So then is the proposal to make <code>with_top</code> a structure instead?</p>



<a name="260540176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540176">(Nov 06 2021 at 22:35)</a>:</h4>
<p>Heh :-)</p>



<a name="260540180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540180">(Nov 06 2021 at 22:35)</a>:</h4>
<p>Uh?</p>



<a name="260540181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540181">(Nov 06 2021 at 22:35)</a>:</h4>
<p>So then this will mean masses of code duplication!</p>



<a name="260540187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540187">(Nov 06 2021 at 22:35)</a>:</h4>
<p>Does that mean we have to define <code>option</code> five times or so?</p>



<a name="260540190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540190">(Nov 06 2021 at 22:35)</a>:</h4>
<p>oh wait</p>



<a name="260540194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540194">(Nov 06 2021 at 22:35)</a>:</h4>
<p>I mean "an inductive type"</p>



<a name="260540263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540263">(Nov 06 2021 at 22:37)</a>:</h4>
<p>yes, I think so Yael, unless we want to define <code>with_top X</code> as a structure with one field of type <code>option X</code></p>



<a name="260540320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540320">(Nov 06 2021 at 22:38)</a>:</h4>
<p>I think <code>continuous</code> was made into a structure because people had problems with it unfolding to "forall open U, ..." or something? (I don't know the details -- what I do know is that <code>continuous f</code> is definitely not defeq to <code>forall U,...</code>, you have to rewrite <code>continuous_def</code></p>



<a name="260540335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540335">(Nov 06 2021 at 22:39)</a>:</h4>
<p>This might not be the same reason, but having things made "irreducible" by wrapping them in a structure seemed to work well for <code>continuous</code></p>



<a name="260540419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540419">(Nov 06 2021 at 22:41)</a>:</h4>
<p>Maybe defining <code>with_top X</code> as a structure with one field of type <code>option X</code> gives us the possibility of an algorithmic way of pulling definitions over a la <code>to_additive</code>, like maybe <code>with_top.bind</code> can be auto-defined using <code>option.bind</code>?</p>



<a name="260540478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540478">(Nov 06 2021 at 22:42)</a>:</h4>
<p>I guess defining it in exactly the same way as <code>option</code> gives us the option of actually modifying <code>to_additive</code> so that it pulls definitions over. It could change <code>none</code> to <code>top</code> etc</p>



<a name="260540697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260540697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260540697">(Nov 06 2021 at 22:49)</a>:</h4>
<p>When I started with Lean, one of the things about it that I thought was really stupid was that they had defined additive groups and multiplicative groups as two different things. Later on as I began to understand that mathematicians used addition and multiplication in genuinely different ways, I realised that actually it was a great idea. Distributivity was somehow key -- it is the way addition and multiplication were related, it is the asymmetric thing that distinguishes between them when both are present. Heterogeneous distributivity is a multiplicative object acting on an additive object, e.g. "a group acting on an abelian group" as we mathematicians say, knowing full well (but never explaining) that we mean "a group with group law <code>*</code> acting on a group with group law <code>+</code>". Heterogeneous associativity is <code>is_scalar_tower</code> by the way. The fact that Leo explicitly decided to make two definitions not one caused (presumably) the development of <code>to_additive</code> and I wonder how much more we can use this tool. It seems to me to be a very similar situation -- mathematicians use the <code>bot</code> in <code>with_bot</code> in different, but similar, situations to the <code>zero</code> in <code>with_zero</code>, so maybe this approach would solve both code duplication problems and reducibility problems?</p>



<a name="260541268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260541268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260541268">(Nov 06 2021 at 23:02)</a>:</h4>
<p>Making <code>with_top</code> a structure is quite a different thing to making <code>order_dual</code> a structure. If we made the latter a structure, we'd lose <code>X = order_dual (order_dual X)</code> (it would be unprovable), and more importantly <code>to_dual (of_dual x) = x</code> stops being refl. This second point is like the "we should make <code>set</code> a structure" discussion; unless lean gains some eta-reduction rules for one-field structures (which I think doesn't impact soundness?), it makes a lot of things more awkward.</p>



<a name="260565423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260565423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260565423">(Nov 07 2021 at 10:07)</a>:</h4>
<p>So what are the plans for <code>order_dual</code> in Lean 4?</p>



<a name="260636525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260636525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260636525">(Nov 08 2021 at 10:07)</a>:</h4>
<blockquote>
<p>This second point is like the "we should make set a structure" discussion; unless lean gains some eta-reduction rules for one-field structures (which I think doesn't impact soundness?), it makes a lot of things more awkward.</p>
</blockquote>
<p>To expand on this.  What we'd lose is the definitional equality <code>s = { x | x ∈ s }</code>.  Adding this kind of eta for structures would not impact soundness afaict, but it is a kernel change which makes it hard to sell to Leo.</p>
<p>Practically speaking, it is not <em>that</em> awkward.  I got pretty far with this refactoring: <a href="https://github.com/leanprover-community/mathlib/commit/76451e89d6cbf0a145525555f1db1778285d9269">https://github.com/leanprover-community/mathlib/commit/76451e89d6cbf0a145525555f1db1778285d9269</a>  It was harder to get rid of the <code>inductive : X -&gt; set Y</code>.</p>



<a name="260639121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260639121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260639121">(Nov 08 2021 at 10:30)</a>:</h4>
<p>Is Leo aware that we would be interested in such a change?</p>



<a name="260639230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260639230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260639230">(Nov 08 2021 at 10:31)</a>:</h4>
<p>I guess such a kennel change wouldn't help with the <code>inductive</code> problem you describe anyway though.</p>



<a name="260649871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260649871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260649871">(Nov 08 2021 at 12:27)</a>:</h4>
<p>I have mentioned it to him before in the context of <code>opposite</code> in category theory--I'm still not sure what our plan is there either</p>



<a name="260679477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260679477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260679477">(Nov 08 2021 at 16:15)</a>:</h4>
<p>It would be good to at least have an issue for it in the lean4 repo and collect use cases, references to existing implementations etc. there</p>



<a name="260781950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260781950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260781950">(Nov 09 2021 at 11:04)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/issues/777">https://github.com/leanprover/lean4/issues/777</a></p>



<a name="260782489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260782489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260782489">(Nov 09 2021 at 11:10)</a>:</h4>
<p>At the risk of completely derailing this discussion, it would also be cool to have eta for decidable instances.  That is, make it so that <code>example (a b : Decidable p) := rfl</code>.  We have quite a bit of ugly library design in mathlib to work around decidability diamonds (i.e., if you have a theorem about classical.decidable you can't use it prove something about a computable instance).  See e.g. the noncomputable polynomials issue.</p>



<a name="260782733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260782733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260782733">(Nov 09 2021 at 11:13)</a>:</h4>
<p>I assume by <code>op (op x) = x</code> in that message you meant <code>op (unop x) = x</code>? The former makes the stronger claim that <code>opposite (opposite X) = X</code> where <code>x : X</code> (edit: fixed, thanks!)</p>



<a name="260785835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260785835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260785835">(Nov 09 2021 at 11:44)</a>:</h4>
<p>Maybe worth noting that we only really seem to need eta for structures with a single field--I sometimes think about inductives/structures as Haskell <code>data</code> and single-field structures with eta as Haskell <code>newtype</code></p>



<a name="260786017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786017">(Nov 09 2021 at 11:45)</a>:</h4>
<p>In the linked issue <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> mentions <code>e.symm.symm = e</code> which has two data fields, but I agree we care about that less</p>



<a name="260786076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786076">(Nov 09 2021 at 11:46)</a>:</h4>
<p>didn't eta for two fields come up with the <code>splitting_field</code> unsolvable diamond?</p>



<a name="260786212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786212">(Nov 09 2021 at 11:47)</a>:</h4>
<p>(xref <a href="https://github.com/leanprover-community/mathlib/issues/10220">#10220</a>)</p>



<a name="260786333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786333">(Nov 09 2021 at 11:49)</a>:</h4>
<p>Actually I don't think that's an eta problem</p>



<a name="260786459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786459">(Nov 09 2021 at 11:50)</a>:</h4>
<p>I'm very confused without context especially because the comment says something "should" be an instance but isn't, but in fact it is an <code>instance</code>. But I think we already pretty much take into account the possibility that entire class records might get eta expanded in random places.</p>



<a name="260786596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786596">(Nov 09 2021 at 11:51)</a>:</h4>
<p>It tends not to matter <em>too</em> much because ultimately the use of a class record is to project a field out of it (even if this might require unfolding some definitions to see, so there could be a performance issue)</p>



<a name="260786735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786735">(Nov 09 2021 at 11:53)</a>:</h4>
<p>I think this came up in the context of investigating that other extremely confusing bug (hopefully Eric can remember/guess which one I mean)</p>



<a name="260786934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260786934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260786934">(Nov 09 2021 at 11:55)</a>:</h4>
<p>The bug about the tensor algebra ring where an <code>irreducible</code> made two proof fields non-defeq?</p>



<a name="260787017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260787017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260787017">(Nov 09 2021 at 11:56)</a>:</h4>
<p>The kind of eta expansion I have in mind is if <code>bar</code> extends <code>foo</code> and you have something like <code>def x [h : foo T] : bar T := { ..., .. h }</code> and then <code>x.to_foo</code> isn't defeq to <code>h</code>, because it is an eta expanded version</p>



<a name="260787052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260787052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260787052">(Nov 09 2021 at 11:57)</a>:</h4>
<p>Right, which typeclass search seems to know how to perform somehow</p>



<a name="260787633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260787633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260787633">(Nov 09 2021 at 12:03)</a>:</h4>
<p>Hmm I was then mostly thinking about examples like if <code>foo = group</code> and I define the center of a group, the result will be defeq whether I used <code>h</code> or <code>x.to_foo</code> because <code>h.mul</code> and <code>x.to_foo.mul</code> are defeq... but I guess there's also the situation where you have a "mix-in" class that takes <code>[group T]</code> as a parameter, and then there should be an issue...</p>



<a name="260787727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260787727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260787727">(Nov 09 2021 at 12:03)</a>:</h4>
<p>The other reason why this isn't a big deal in practice is that once <code>h</code> becomes a specific instance (rather than a variable) it will usually be a constructor applied to something, and then <code>h</code> and <code>x.to_foo</code> will be defeq</p>



<a name="260787788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260787788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260787788">(Nov 09 2021 at 12:04)</a>:</h4>
<p>Maybe that was the reason we got rid of <code>module</code> / <code>semimodule</code></p>



<a name="260790281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260790281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260790281">(Nov 09 2021 at 12:29)</a>:</h4>
<p>Logically it seems like eta for structures with more than one field should be an issue for things like the product of two categories or a slice category... anyone encountered this?</p>



<a name="260796688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260796688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260796688">(Nov 09 2021 at 13:26)</a>:</h4>
<p>What do you mean with "should be an issue"?</p>



<a name="260796736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260796736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260796736">(Nov 09 2021 at 13:27)</a>:</h4>
<p>If we had eta for structures with more than one field, then <code>(C^op)^op</code> would have a category defeq to <code>C</code>. That would be cool.</p>



<a name="260797934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260797934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260797934">(Nov 09 2021 at 13:37)</a>:</h4>
<p>I would have to try it again to see exactly what goes wrong but if you try to make <code>opposite</code> a structure, things get awkward for the opposite category pretty quickly</p>



<a name="260803354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260803354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260803354">(Nov 09 2021 at 14:17)</a>:</h4>
<p>Would it even be possible to have <code>op (op G)</code> definitionally equal to <code>G</code>?</p>



<a name="260805269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260805269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260805269">(Nov 09 2021 at 14:32)</a>:</h4>
<p>I mean for monoids/groups, not just for categories like Johan asked.</p>



<a name="260816289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260816289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260816289">(Nov 09 2021 at 15:44)</a>:</h4>
<p>It already is true that <code>G = (Gᵒᵖ)ᵒᵖ</code> I think</p>



<a name="260837675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260837675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260837675">(Nov 09 2021 at 18:18)</a>:</h4>
<p>I assume you are talking about the types themselves. If <code>opposite</code> is implemented as a one-field structure then <code>opposite (opposite G)</code> will be definitionally different from <code>G</code>, just like <code>opposite G</code> will be.</p>



<a name="260845241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260845241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260845241">(Nov 09 2021 at 19:06)</a>:</h4>
<p>I believe I want both of the following to work -- currently the failure of the first means the second doesn't even typecheck:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.opposites</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">=</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span><span class="bp">ᵒᵖ</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="kd">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">group</span> <span class="n">G</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="kd">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">group</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span><span class="bp">ᵒᵖ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="260847470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260847470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260847470">(Nov 09 2021 at 19:21)</a>:</h4>
<p>Both are true in the presence of <code>local attribute [semireducible] opposite</code> I think</p>



<a name="260848162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260848162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260848162">(Nov 09 2021 at 19:26)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> This fails:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.opposites</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">_i</span> <span class="o">:</span> <span class="n">group</span> <span class="n">G</span><span class="o">]</span>

<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="n">semireducible</span><span class="o">]</span> <span class="n">opposite</span>

<span class="c1">-- works</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">=</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span><span class="bp">ᵒᵖ</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="c1">-- fails</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">_i</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">opposite.group</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">opposite.group</span> <span class="n">G</span> <span class="n">_i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="260849360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260849360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260849360">(Nov 09 2021 at 19:36)</a>:</h4>
<p>Ah yep, that's because we have no <code>rdiv</code> field</p>



<a name="260849394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260849394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260849394">(Nov 09 2021 at 19:36)</a>:</h4>
<p>This demonstrates why they mismatch:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">_i</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">opposite.group</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">opposite.group</span> <span class="n">G</span> <span class="n">_i</span><span class="o">)</span> <span class="o">:=</span><span class="kd">begin</span>
  <span class="n">casesI</span> <span class="n">_i</span><span class="o">,</span>
  <span class="n">dunfold</span> <span class="n">opposite.group</span><span class="o">,</span>
  <span class="n">unfold_projs</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span>
  <span class="n">congr'</span> <span class="k">with</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="k">show</span> <span class="n">div</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">mul</span> <span class="n">x</span> <span class="o">(</span><span class="n">inv</span> <span class="n">y</span><span class="o">),</span>
  <span class="gr">sorry</span><span class="o">,</span>  <span class="c1">-- this is not defeq, we need to apply `div_eq_mul_inv`</span>
<span class="kd">end</span>
</code></pre></div>



<a name="260849445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260849445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260849445">(Nov 09 2021 at 19:37)</a>:</h4>
<p>No, it's because we don't have eta for structures!</p>



<a name="260849488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260849488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260849488">(Nov 09 2021 at 19:37)</a>:</h4>
<p>Oh good point, It's both</p>



<a name="260865600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260865600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260865600">(Nov 09 2021 at 21:39)</a>:</h4>
<p>Yes, so for a more minimal example I should change <code>group</code> everywhere to <code>has_mul</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.opposites</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">_i</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="n">G</span><span class="o">]</span>

<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="n">semireducible</span><span class="o">]</span> <span class="n">opposite</span>

<span class="c1">-- works</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">=</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span><span class="bp">ᵒᵖ</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="c1">-- fails</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">_i</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">opposite.has_mul</span> <span class="o">(</span><span class="n">G</span><span class="bp">ᵒᵖ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">opposite.has_mul</span> <span class="n">G</span> <span class="n">_i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="260992812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260992812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260992812">(Nov 10 2021 at 14:03)</a>:</h4>
<p>I guess, you'll have better luck with <code>has_mul.mul</code>.</p>



<a name="260992840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%20irreducible/near/260992840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.20irreducible.html#260992840">(Nov 10 2021 at 14:03)</a>:</h4>
<p>Why <code>mul_equiv</code> is not good enough?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>