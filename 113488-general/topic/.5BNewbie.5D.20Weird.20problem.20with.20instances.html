---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/.5BNewbie.5D.20Weird.20problem.20with.20instances.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.5BNewbie.5D.20Weird.20problem.20with.20instances.html">[Newbie] Weird problem with instances</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="235022662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%5BNewbie%5D%20Weird%20problem%20with%20instances/near/235022662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arnoud van der Leer <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.5BNewbie.5D.20Weird.20problem.20with.20instances.html#235022662">(Apr 17 2021 at 22:09)</a>:</h4>
<p>Hi there. I am relatively new at this. I hope that this is the right place to post this.</p>
<p>I started working with classes and instances this week. I have been playing around a bit with groups, rings and categories. However, some weird thing happens. When defining a ring morphism structure on the composition of two ring morphisms, I have to explicitly specify the additive property, because if I don't, I get a "maximum class-instance resolution depth" error.</p>
<p>Here is my code:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Groups</span>
<span class="kd">class</span> <span class="n">group</span> <span class="o">(</span><span class="n">G</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">zero</span><span class="o">:</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">add</span><span class="o">:</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">neg</span><span class="o">:</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_zero</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">g</span><span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">add</span> <span class="n">zero</span> <span class="n">g</span> <span class="bp">=</span> <span class="n">g</span> <span class="bp">‚àß</span> <span class="n">add</span> <span class="n">g</span> <span class="n">zero</span> <span class="bp">=</span> <span class="n">g</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_neg</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">g</span><span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">add</span> <span class="o">(</span><span class="n">neg</span> <span class="n">g</span><span class="o">)</span> <span class="n">g</span> <span class="bp">=</span> <span class="n">zero</span> <span class="bp">‚àß</span> <span class="n">add</span> <span class="n">g</span> <span class="o">(</span><span class="n">neg</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="n">zero</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_assoc</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">add</span> <span class="o">(</span><span class="n">add</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">add</span> <span class="n">a</span> <span class="o">(</span><span class="n">add</span> <span class="n">b</span> <span class="n">c</span><span class="o">))</span>

<span class="kd">infix</span> <span class="bp">+</span> <span class="o">:=</span> <span class="n">group.add</span>
<span class="kd">notation</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">group.zero</span>

<span class="kd">class</span> <span class="n">group_morphism</span> <span class="o">{</span><span class="n">G</span> <span class="n">H</span><span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">H</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">additive</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">g</span> <span class="bp">+</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">f</span> <span class="n">h</span><span class="o">))</span>

<span class="kd">instance</span> <span class="n">identity_group_morphism</span> <span class="o">(</span><span class="n">G</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">group_morphism</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">g</span><span class="o">:</span> <span class="n">G</span><span class="o">),</span> <span class="n">g</span><span class="o">)</span> <span class="o">:=</span> <span class="o">‚ü®</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span> <span class="o">‚ü©</span>

<span class="kd">instance</span> <span class="n">compose_group_morphism</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">g</span><span class="o">:</span> <span class="n">B</span> <span class="bp">‚Üí</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span> <span class="n">A</span> <span class="bp">‚Üí</span> <span class="n">B</span><span class="o">)</span> <span class="o">[</span><span class="n">hg</span><span class="o">:</span> <span class="n">group_morphism</span> <span class="n">g</span><span class="o">]</span> <span class="o">[</span><span class="n">hf</span><span class="o">:</span> <span class="n">group_morphism</span> <span class="n">f</span><span class="o">]</span> <span class="o">:</span> <span class="n">group_morphism</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">))</span> <span class="o">:=</span> <span class="o">‚ü®</span> <span class="bp">Œª</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">hf.additive</span><span class="o">,</span> <span class="n">hg.additive</span><span class="o">]</span> <span class="o">‚ü©</span>

<span class="c1">-- Rings</span>
<span class="kd">class</span> <span class="n">ring</span> <span class="o">(</span><span class="n">R</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">group</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">one</span><span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul</span><span class="o">:</span> <span class="n">R</span> <span class="bp">‚Üí</span> <span class="n">R</span> <span class="bp">‚Üí</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_one</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">r</span><span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">mul</span> <span class="n">one</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">‚àß</span> <span class="n">mul</span> <span class="n">r</span> <span class="n">one</span> <span class="bp">=</span> <span class="n">r</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_assoc</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">mul</span> <span class="o">(</span><span class="n">mul</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">mul</span> <span class="n">a</span> <span class="o">(</span><span class="n">mul</span> <span class="n">b</span> <span class="n">c</span><span class="o">))</span>
<span class="o">(</span><span class="n">mul_distrib</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">mul</span> <span class="n">a</span> <span class="o">(</span><span class="n">add</span> <span class="n">b</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">add</span> <span class="o">(</span><span class="n">mul</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">mul</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="bp">‚àß</span> <span class="n">mul</span> <span class="o">(</span><span class="n">add</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">add</span> <span class="o">(</span><span class="n">mul</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">mul</span> <span class="n">b</span> <span class="n">c</span><span class="o">))</span>

<span class="kd">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">ring.mul</span>
<span class="kd">notation</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">ring.one</span>

<span class="kd">class</span> <span class="n">ring_morphism</span> <span class="o">{</span><span class="n">R</span> <span class="n">S</span><span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">S</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span> <span class="n">R</span> <span class="bp">‚Üí</span> <span class="n">S</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">group_morphism</span> <span class="n">f</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">multiplicative</span><span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">s</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">f</span> <span class="n">r</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">f</span> <span class="n">s</span><span class="o">))</span>
<span class="o">(</span><span class="n">preserves_one</span><span class="o">:</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="kd">instance</span> <span class="n">identity_ring_morphism</span> <span class="o">(</span><span class="n">R</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">ring_morphism</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">r</span><span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">r</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">multiplicative</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="n">rfl</span><span class="o">),</span>
  <span class="n">preserves_one</span> <span class="o">:=</span> <span class="n">rfl</span><span class="o">,</span>
<span class="o">}</span>

<span class="kd">instance</span> <span class="n">compose_ring_morphism</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span><span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">g</span><span class="o">:</span> <span class="n">B</span> <span class="bp">‚Üí</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span> <span class="n">A</span> <span class="bp">‚Üí</span> <span class="n">B</span><span class="o">)</span> <span class="o">[</span><span class="n">hg</span><span class="o">:</span> <span class="n">ring_morphism</span> <span class="n">g</span><span class="o">]</span> <span class="o">[</span><span class="n">hf</span><span class="o">:</span> <span class="n">ring_morphism</span> <span class="n">f</span><span class="o">]</span> <span class="o">:</span> <span class="n">ring_morphism</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">a</span><span class="o">:</span> <span class="n">A</span><span class="o">,</span> <span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">))</span> <span class="o">:=</span> <span class="o">{</span>

  <span class="n">additive</span>        <span class="o">:=</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">hf.additive</span><span class="o">,</span> <span class="n">hg.additive</span><span class="o">]),</span> <span class="c1">-- THIS LINE</span>

  <span class="n">multiplicative</span>  <span class="o">:=</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">hf.multiplicative</span><span class="o">,</span> <span class="n">hg.multiplicative</span><span class="o">]),</span>
  <span class="n">preserves_one</span>   <span class="o">:=</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">hf.preserves_one</span><span class="o">,</span> <span class="n">hg.preserves_one</span><span class="o">]</span>
<span class="o">}</span>

<span class="c1">-- Categories</span>

<span class="kd">universe</span> <span class="n">u</span>

<span class="kd">class</span> <span class="n">category</span> <span class="o">(</span><span class="bp">ùíû</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">Hom</span><span class="o">:</span> <span class="bp">ùíû</span> <span class="bp">‚Üí</span> <span class="bp">ùíû</span> <span class="bp">‚Üí</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="o">(</span><span class="n">id</span> <span class="o">(</span><span class="n">X</span><span class="o">:</span> <span class="bp">ùíû</span><span class="o">):</span> <span class="n">Hom</span> <span class="n">X</span> <span class="n">X</span><span class="o">)</span>
<span class="o">(</span><span class="n">compose</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="bp">ùíû</span><span class="o">}:</span> <span class="n">Hom</span> <span class="n">Y</span> <span class="n">Z</span> <span class="bp">‚Üí</span> <span class="n">Hom</span> <span class="n">X</span> <span class="n">Y</span> <span class="bp">‚Üí</span> <span class="n">Hom</span> <span class="n">X</span> <span class="n">Z</span><span class="o">)</span>
<span class="o">(</span><span class="n">compose_id</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="bp">ùíû</span><span class="o">}</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">f</span><span class="o">:</span> <span class="n">Hom</span> <span class="n">X</span> <span class="n">Y</span><span class="o">,</span> <span class="n">compose</span> <span class="n">f</span> <span class="o">(</span><span class="n">id</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="bp">‚àß</span> <span class="n">compose</span> <span class="o">(</span><span class="n">id</span> <span class="n">Y</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">compose_assoc</span> <span class="o">{</span><span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">:</span> <span class="bp">ùíû</span><span class="o">}</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">f</span><span class="o">:</span> <span class="n">Hom</span> <span class="n">W</span> <span class="n">X</span><span class="o">,</span> <span class="bp">‚àÄ</span> <span class="n">g</span><span class="o">:</span> <span class="n">Hom</span> <span class="n">X</span> <span class="n">Y</span><span class="o">,</span> <span class="bp">‚àÄ</span> <span class="n">h</span><span class="o">:</span> <span class="n">Hom</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">,</span> <span class="n">compose</span> <span class="o">(</span><span class="n">compose</span> <span class="n">h</span> <span class="n">g</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">compose</span> <span class="n">h</span> <span class="o">(</span><span class="n">compose</span> <span class="n">g</span> <span class="n">f</span><span class="o">))</span>

<span class="c1">-- Bundles</span>

<span class="kd">structure</span> <span class="n">bundled</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">‚Üí</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">u</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="o">(</span><span class="n">str</span> <span class="o">:</span> <span class="n">c</span> <span class="n">Œ±</span> <span class="bp">.</span> <span class="n">tactic.apply_instance</span><span class="o">)</span>

<span class="kd">structure</span> <span class="n">bundled_hom</span> <span class="o">{</span><span class="n">X</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">Y</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="bp">‚Üí</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">u</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="n">X</span> <span class="bp">‚Üí</span> <span class="n">Y</span><span class="o">)</span>
<span class="o">(</span><span class="n">str</span> <span class="o">:</span> <span class="n">c</span> <span class="n">Œ±</span> <span class="bp">.</span> <span class="n">tactic.apply_instance</span><span class="o">)</span>

<span class="c1">-- Category instances</span>

<span class="kd">instance</span> <span class="n">ring_category</span> <span class="o">:</span> <span class="n">category</span> <span class="o">(</span><span class="n">bundled</span> <span class="n">ring</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span>
  <span class="n">Hom</span>           <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">R</span> <span class="n">S</span><span class="o">,</span> <span class="n">bundled_hom</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring_morphism</span> <span class="n">R.Œ±</span> <span class="n">S.Œ±</span> <span class="n">R.str</span> <span class="n">S.str</span><span class="o">),</span>
  <span class="n">id</span>            <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">R</span><span class="o">,</span> <span class="o">‚ü®(</span><span class="bp">Œª</span> <span class="n">r</span><span class="o">,</span> <span class="n">r</span><span class="o">),</span> <span class="bp">@</span><span class="n">identity_ring_morphism</span> <span class="n">R.Œ±</span> <span class="n">R.str</span> <span class="o">‚ü©,</span>
  <span class="n">compose</span>       <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="n">g</span> <span class="n">f</span><span class="o">,</span> <span class="o">‚ü®</span> <span class="bp">Œª</span> <span class="n">a</span><span class="o">,</span> <span class="n">g.Œ±</span> <span class="o">(</span><span class="n">f.Œ±</span> <span class="n">a</span><span class="o">),</span> <span class="bp">@</span><span class="n">compose_ring_morphism</span> <span class="n">A.Œ±</span> <span class="n">B.Œ±</span> <span class="n">C.Œ±</span> <span class="n">A.str</span> <span class="n">B.str</span> <span class="n">C.str</span> <span class="n">g.Œ±</span> <span class="n">f.Œ±</span> <span class="n">g.str</span> <span class="n">f.str</span> <span class="o">‚ü©,</span>
  <span class="n">compose_id</span>    <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">compose_ring_morphism</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">f</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">f_str</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">f_str__to_group_morphism</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">compose_assoc</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">compose_ring_morphism</span>
  <span class="kd">end</span><span class="o">,</span>
<span class="o">}</span>
</code></pre></div>
<p>When I remove line 42, I get weird errors.<br>
Also, if you have any feedback about style or best practices, please let me know :-)</p>
<p>Now we're at it, is there a tactic to prove that two class instances are equal (like, for example, in the proof of compose_id) from the fact that the constituents/parameters are equal?</p>



<a name="235023415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%5BNewbie%5D%20Weird%20problem%20with%20instances/near/235023415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.5BNewbie.5D.20Weird.20problem.20with.20instances.html#235023415">(Apr 17 2021 at 22:22)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/notes.html#no%20instance%20on%20morphisms">https://leanprover-community.github.io/mathlib_docs/notes.html#no%20instance%20on%20morphisms</a> is relevant here, assuming <code>compose_ring_morphism</code> is the problem</p>



<a name="235023439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%5BNewbie%5D%20Weird%20problem%20with%20instances/near/235023439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.5BNewbie.5D.20Weird.20problem.20with.20instances.html#235023439">(Apr 17 2021 at 22:23)</a>:</h4>
<p>yeah, you can see it loops with <code>set_option trace.class_instances true</code></p>



<a name="235050056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%5BNewbie%5D%20Weird%20problem%20with%20instances/near/235050056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arnoud van der Leer <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.5BNewbie.5D.20Weird.20problem.20with.20instances.html#235050056">(Apr 18 2021 at 06:54)</a>:</h4>
<p>Oooooh, right. Thanks, that makes sense. So I should make this a lemma?<br>
But in the proof of compose_id (of <code>category (bundled ring)</code>), I can unfold an instance, whereas a lemma cannot be unfolded apparently. So should I make it a def? That sounds a bit weird too.</p>
<p>Oooooh, I realize only now that setting an option can just be done inline, instead of in some settings panel.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>