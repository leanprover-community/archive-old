---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html">typeclasses for orders with neg and inv</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="294182075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/294182075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#294182075">(Aug 18 2022 at 22:55)</a>:</h4>
<p>In <a href="https://github.com/leanprover-community/mathlib/pull/15652">#15652</a> it was discussed how it's unfortunate that various lemmas about the interaction of order properties with <code>neg</code> and <code>inv</code> end up needing separate <code>left</code> and <code>right</code> versions because they're deduced from order properties for addition and multiplication that have separate <code>left</code> and <code>right</code> versions, and how it might make sense to have typeclasses for the <code>neg</code> and <code>inv</code> properties to avoid that duplication.</p>
<p>What should such typeclasses look like? For example, would it be appropriate to add variants of <code>covariant_class</code> and <code>contravariant_class</code> that (a) are for a unary rather than a binary operation and (b) are for operations that reverse the order of the relation? If so, can someone suggest better (shorter) names than e.g. <code>covariant_unary_antitone_class</code>?</p>
<p>Some of the lemmas also need <code>neg_zero</code> or <code>inv_one</code>. Should we have typeclasses for those as well, so that the lemmas can be applied more generally than <code>subtraction_monoid</code> / <code>division_monoid</code> (the current context in which <code>neg_zero</code> and <code>inv_one</code> are proved)?</p>
<p>Examples of types for which such order properties, and <code>neg_zero</code> or <code>inv_one</code>, are relevant, but that aren't covered by the typeclasses for existing lemmas (and thus sometimes have their own duplicate lemmas), include <code>ereal</code>, <code>ennreal</code> and <code>sign_type</code>. (We have a separate <code>neg_zero'</code> lemma in the <code>mul_zero_class</code> <code>has_distrib_neg</code> case to cover that property for <code>sign_type</code>.)</p>



<a name="295013101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295013101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295013101">(Aug 24 2022 at 09:56)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="310045">@Eric Wieser</span> <span class="user-mention" data-user-id="387244">@Yaël Dillies</span></p>



<a name="295013221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295013221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295013221">(Aug 24 2022 at 09:56)</a>:</h4>
<p>I stand by my message on this PR: <a href="https://github.com/leanprover-community/mathlib/pull/15652#issuecomment-1193904087">https://github.com/leanprover-community/mathlib/pull/15652#issuecomment-1193904087</a></p>



<a name="295013256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295013256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295013256">(Aug 24 2022 at 09:56)</a>:</h4>
<p>I will think of the details shortly.</p>



<a name="295013298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295013298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295013298">(Aug 24 2022 at 09:57)</a>:</h4>
<p>Related PR</p>
<blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/pull/16187">#16187</a>  refactor(algebra/group/defs): inv_one_class, neg_zero_class</p>
</blockquote>



<a name="295013622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295013622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295013622">(Aug 24 2022 at 09:59)</a>:</h4>
<p><span class="user-mention" data-user-id="266253">@Joseph Myers</span>  I'm somewhat worried about</p>
<blockquote>
<p>These are <code>Prop</code>-valued classes, taking <code>has_one</code> and<br>
<code>has_inv</code> or <code>has_zero</code> and <code>has_neg</code> arguments rather than extending<br>
those classes, to allow them to be used together with other classes<br>
such as <code>div_inv_monoid</code> in the typeclass requirements of lemmas<br>
without needing to define extra classes for the combination of such a<br>
class with these new classes.</p>
</blockquote>
<p>I'm not an expert, but if I understand correctly then this might lead to performance problems. See also <a href="https://www.ralfj.de/blog/2019/05/15/typeclasses-exponential-blowup.html">https://www.ralfj.de/blog/2019/05/15/typeclasses-exponential-blowup.html</a></p>
<p>Do we have data about how this PR affects mathlib compile time?</p>



<a name="295018736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295018736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295018736">(Aug 24 2022 at 10:37)</a>:</h4>
<p>The current setup is <em>probably</em> OK since the inheritance depth is not so much. When you start writing <code>division_monoid [monoid α] [has_inv α] [inv_one_class α]</code> is when the blowup really starts...</p>



<a name="295018789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295018789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295018789">(Aug 24 2022 at 10:37)</a>:</h4>
<p>Still I think bundled inheritance is the best way to go here.</p>



<a name="295022031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295022031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295022031">(Aug 24 2022 at 11:00)</a>:</h4>
<p>With the way CI has been behaving lately with completely random timeouts and long delays lately unrelated to the content of PRs, getting meaningful compile time figures is hard.</p>



<a name="295022562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295022562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295022562">(Aug 24 2022 at 11:04)</a>:</h4>
<p>Note that <code>neg_zero_class</code> is definitely relevant in cases such as <code>sign_type</code> that do not have addition or subtraction at all; I don't think a solution for the inequality lemmas that removes <code>left</code>/<code>right</code> duplication but keeps dependence on having <code>add</code>/<code>sub</code>/<code>mul</code>/<code>div</code> for lemmas that don't actually involve those operations would be a particularly good solution.</p>



<a name="295033473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295033473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295033473">(Aug 24 2022 at 12:20)</a>:</h4>
<p>An argument for not bundling is that this matches the style of <a href="https://leanprover-community.github.io/mathlib_docs/find/covariant_class">docs#covariant_class</a></p>



<a name="295037581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295037581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295037581">(Aug 24 2022 at 12:37)</a>:</h4>
<p>Actually I've always seen this as an argument against <code>covariant_class</code>!</p>



<a name="295064440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295064440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295064440">(Aug 24 2022 at 15:01)</a>:</h4>
<p>My two cents on this:</p>
<ul>
<li>Definitions should be bundled as far as it remains reasonable, to avoid exponential blowup when building products, for instance.</li>
<li>But the bundled stuff should have instances to the most basic classes. For instance, <code>ordered_comm_semiring</code> or whatever should imply <code>covariant_class ...</code></li>
<li>Lemmas, on the other hand, are better stated with the most basic classes. Because in this way they will apply in the most possible general situations and still this will not create any blowup.</li>
</ul>



<a name="295065836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295065836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295065836">(Aug 24 2022 at 15:08)</a>:</h4>
<p>Since we are talking about <code>covariant_class</code>, I feel called in the discussion.  I also agree that creating big bundles,while at the same time also proving stuff for "atomic" typeclasses is helpful.  In particular, bundling a few of the <code>covariant_class</code> assumptions together in more comprehensive classes is certainly human friendly.</p>
<p>For instance, Yaël's recent PR with</p>
<ul>
<li><code>ordered_semiring</code> renamed to <code>ordered_cancel_semiring</code>;</li>
<li><code>ordered_semiring</code> used for something more meaningful;</li>
</ul>
<p>produces two typeclasses that bundle together a few <code>covariant_class</code>es into something that is way more meaningful.</p>



<a name="295066299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20for%20orders%20with%20neg%20and%20inv/near/295066299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20for.20orders.20with.20neg.20and.20inv.html#295066299">(Aug 24 2022 at 15:11)</a>:</h4>
<p>The silly <code>mul_left_of_le_of_lt_one_of_nonneg</code> are then useful because they would apply smoothly to <code>real, nat, ennreal</code> and who knows what other "real-world" type you want!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>