---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/dep.20hd.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html">dep hd</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="225538822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225538822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225538822">(Feb 08 2021 at 12:51)</a>:</h4>
<p>I am just trying to prove infectivity of :: directly (I know I can use injection). But lean doesn't like my dependent hd. Maybe I am overlooking something obvious?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Hd</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">A</span>

<span class="kd">def</span> <span class="n">hd</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="o">,</span> <span class="o">(</span><span class="n">Hd</span> <span class="n">l</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">hd</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit.star</span>
<span class="bp">|</span> <span class="n">hd</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span>
</code></pre></div>



<a name="225538990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225538990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225538990">(Feb 08 2021 at 12:53)</a>:</h4>
<p>This works for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">Hd</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">A</span>

<span class="kd">def</span> <span class="n">hd</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="o">,</span> <span class="o">(</span><span class="n">Hd</span> <span class="n">l</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit.star</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span>
</code></pre></div>



<a name="225539177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225539177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225539177">(Feb 08 2021 at 12:54)</a>:</h4>
<p>Why the equation compiler decides to give a "syntax error" instead of saying there are too many arguments I don't know.</p>



<a name="225539549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225539549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225539549">(Feb 08 2021 at 12:56)</a>:</h4>
<p>Ah stupid me. I always forget that lean doesn't repeat the function name like most functional languages.</p>



<a name="225540737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225540737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225540737">(Feb 08 2021 at 13:05)</a>:</h4>
<p><span class="user-mention" data-user-id="271218">@Thorsten Altenkirch</span> in private correspondence you have indicated to me that you don't like the syntax of Lean 3's equation compiler, and you showed me examples of syntax in other languages which you said were "more modern". You know we have a <a class="stream" data-stream-id="270676" href="/#narrow/stream/270676-lean4">#lean4</a> stream now lean 4 has been released. I wonder whether the more powerful elaborator of lean 4 would be more to your taste, and I think that right now might be a really good time to have a discussion about how far things can be pushed -- the lean 4 devs are watching that stream and seem to me to be very receptive to new ideas right now. Maybe you should post some of your comments about the lean 3 equation compiler there and ask if the things you're looking for are in lean 4?</p>



<a name="225541101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225541101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225541101">(Feb 08 2021 at 13:08)</a>:</h4>
<p>Now I have another problem when trying to use hd to prove infectivity:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Hd</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">A</span>

<span class="kd">def</span> <span class="n">hd</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="o">,</span> <span class="o">(</span><span class="n">Hd</span> <span class="n">l</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit.star</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span>


<span class="kd">theorem</span> <span class="n">inj_hd</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">a'</span><span class="o">:</span><span class="n">A</span><span class="o">)(</span><span class="n">l</span> <span class="n">l'</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">),</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">a'</span> <span class="o">::</span> <span class="n">l'</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a'</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">a</span> <span class="n">a'</span> <span class="n">l</span> <span class="n">l'</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">change</span> <span class="n">hd</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">hd</span> <span class="o">(</span><span class="n">a'</span> <span class="o">::</span> <span class="n">l'</span><span class="o">)),</span>
</code></pre></div>
<p>It says unexpected argument at application hd (a' :: l') and that it would expect a::l ???</p>



<a name="225541333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225541333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225541333">(Feb 08 2021 at 13:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/dep.20hd/near/225540737">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="271218">Thorsten Altenkirch</span> in private correspondence you have indicated to me that you don't like the syntax of Lean 3's equation compiler, and you showed me examples of syntax in other languages which you said were "more modern". You know we have a <a class="stream" data-stream-id="270676" href="/#narrow/stream/270676-lean4">#lean4</a> stream now lean 4 has been released. I wonder whether the more powerful elaborator of lean 4 would be more to your taste, and I think that right now might be a really good time to have a discussion about how far things can be pushed -- the lean 4 devs are watching that stream and seem to me to be very receptive to new ideas right now. Maybe you should post some of your comments about the lean 3 equation compiler there and ask if the things you're looking for are in lean 4?</p>
</blockquote>
<p>I can do but my impression was that people in the lean community got used to the syntax (which actually originates from coq).</p>



<a name="225541405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225541405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225541405">(Feb 08 2021 at 13:11)</a>:</h4>
<p>Lean 4 has a super-powerful macro system so what I am really interested in is whether the features you wanted can be emulated by these macros. It would be a good test for the system.</p>



<a name="225541514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225541514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225541514">(Feb 08 2021 at 13:12)</a>:</h4>
<p>People like you who have experience with multiple provers and languages can bring new ideas to Lean and what I'm saying is that right now is a good time to bring those ideas.</p>



<a name="225541625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225541625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225541625">(Feb 08 2021 at 13:13)</a>:</h4>
<p>So far I have been really impressed with what can be done. For example lean 3 has a <code>calc</code> environment and it's not in lean 4 but when someone mentioned this, someone else just knocked up a macro to emulate it.</p>



<a name="225541660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225541660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225541660">(Feb 08 2021 at 13:13)</a>:</h4>
<p>All this is happening in <a class="stream" data-stream-id="270676" href="/#narrow/stream/270676-lean4">#lean4</a></p>



<a name="225546775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/dep%20hd/near/225546775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/dep.20hd.html#225546775">(Feb 08 2021 at 13:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271218">Thorsten Altenkirch</span> <a href="#narrow/stream/113488-general/topic/dep.20hd/near/225541101">said</a>:</p>
<blockquote>
<p>Now I have another problem when trying to use hd to prove injectivity:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">Hd</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">A</span>

<span class="kd">def</span> <span class="n">hd</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span> <span class="o">,</span> <span class="o">(</span><span class="n">Hd</span> <span class="n">l</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">unit.star</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span>


<span class="kd">theorem</span> <span class="n">inj_hd</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">a'</span><span class="o">:</span><span class="n">A</span><span class="o">)(</span><span class="n">l</span> <span class="n">l'</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">),</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">a'</span> <span class="o">::</span> <span class="n">l'</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a'</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">a</span> <span class="n">a'</span> <span class="n">l</span> <span class="n">l'</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">change</span> <span class="n">hd</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">hd</span> <span class="o">(</span><span class="n">a'</span> <span class="o">::</span> <span class="n">l'</span><span class="o">)),</span>
</code></pre></div>
<p>It says unexpected argument at application hd (a' :: l') and that it would expect a::l ???</p>
</blockquote>
<p>The default elaboration strategy is outside-in and expects the type of the right-hand side to be <code>Hd (a :: l)</code> and doesn't consider that this might be the case even if the argument is not <code>a :: l</code>. You can force it to elaborate inside-out by inserting a <code>: _</code> inside those handy extra parentheses on the right-hand side.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>