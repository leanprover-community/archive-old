---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/alternate.20tactics.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html">alternate tactics</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198461853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198461853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198461853">(May 22 2020 at 16:21)</a>:</h4>
<p>What is the nice way to alternate two tactics until the goal is closed or neither make any progress? I know I can do <code>repeat (tac1 &lt;|&gt; tac2)</code> but this is stupid, right?</p>



<a name="198461997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198461997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198461997">(May 22 2020 at 16:22)</a>:</h4>
<p>why is it stupid? i thought the behavior is exactly as you described (so there probably isn't a more efficient implementation), and it's hard to imagine a shorter incantation</p>



<a name="198462078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462078">(May 22 2020 at 16:23)</a>:</h4>
<p>(also i usually write <code>repeat { tac1 &lt;|&gt; tac2}</code> instead, is there any difference?)</p>



<a name="198462304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462304">(May 22 2020 at 16:24)</a>:</h4>
<p>what would you like to type instead, and would the behavior be different from the repeat block?</p>



<a name="198462318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462318">(May 22 2020 at 16:24)</a>:</h4>
<p>I should have said that tac1 and tac2 cannot succeed twice in a row.</p>



<a name="198462385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462385">(May 22 2020 at 16:24)</a>:</h4>
<p>oh i see, the repeat block will incur possibly a factor of 2 penalty?</p>



<a name="198462387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462387">(May 22 2020 at 16:24)</a>:</h4>
<p>Say tac1 succeeds. Then you repeat and first try tac1 that you know will fail before trying tac2. etc.</p>



<a name="198462396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462396">(May 22 2020 at 16:24)</a>:</h4>
<p>Yes</p>



<a name="198462457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462457">(May 22 2020 at 16:25)</a>:</h4>
<p>I need a computer scientist. Is there a computer scientist in this plane?</p>



<a name="198462472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462472">(May 22 2020 at 16:25)</a>:</h4>
<p>i wonder if passing your tactics to tidy works?</p>



<a name="198462752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198462752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198462752">(May 22 2020 at 16:27)</a>:</h4>
<p>The penalty factor might shoot up a lot more then :-)</p>



<a name="198463039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463039">(May 22 2020 at 16:29)</a>:</h4>
<p>I'm not sure I understand what you want but is <code>repeat { tac1 , tac2} &lt;|&gt; repeat { tac2, tac1}</code> better?</p>



<a name="198463130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463130">(May 22 2020 at 16:30)</a>:</h4>
<p>Right, I really meant "does tidy specifically know how to not re-apply a tactic it know will fail", and then if the answer is yes, looking at the tidy source will tell you the answer</p>
<p>but probably the answer is no, <code>tidy</code> doesn't have a way to know that a tactic won't succeed twice</p>



<a name="198463305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463305">(May 22 2020 at 16:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/113488-general/topic/alternate.20tactics/near/198463039">said</a>:</p>
<blockquote>
<p>I'm not sure I understand what you want but is <code>repeat { tac1 , tac2} &lt;|&gt; repeat { tac2, tac1}</code> better?</p>
</blockquote>
<p>I think yes? I think this never applies <code>tac1</code> twice in a row and applies <code>tac2</code> twice in a row at most once</p>



<a name="198463449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463449">(May 22 2020 at 16:32)</a>:</h4>
<p>This will fail if tac1 closes the goal immediately for instance</p>



<a name="198463469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463469">(May 22 2020 at 16:32)</a>:</h4>
<p>then use a semicolon?</p>



<a name="198463511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463511">(May 22 2020 at 16:33)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">repeat</span> <span class="o">{</span> <span class="n">tac1</span><span class="bp">;</span> <span class="n">tac2</span> <span class="o">}</span> <span class="bp">&lt;|&gt;</span> <span class="n">repeat</span> <span class="o">{</span> <span class="n">tac2</span><span class="bp">;</span> <span class="n">tac1</span> <span class="o">}</span>
</code></pre></div>



<a name="198463540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463540">(May 22 2020 at 16:33)</a>:</h4>
<p>That one may work...</p>



<a name="198463863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463863">(May 22 2020 at 16:36)</a>:</h4>
<p>It works on 12 examples, and we're in meta-land so I guess it counts as a proof.</p>



<a name="198463946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198463946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198463946">(May 22 2020 at 16:37)</a>:</h4>
<p>did you have examples when you opened the question? it's possible that posting them may have led to us getting the answer faster</p>



<a name="198464092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198464092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198464092">(May 22 2020 at 16:38)</a>:</h4>
<p>oh, does "work" mean "close the goal" or "close the goal faster than <code>repeat { tac1 &lt;|&gt; tac2 }</code>"?</p>



<a name="198464210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198464210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198464210">(May 22 2020 at 16:39)</a>:</h4>
<p>Close the goal without applying the same tactic twice in a row.</p>



<a name="198464353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198464353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198464353">(May 22 2020 at 16:40)</a>:</h4>
<p>In my case  it seems we can even assume we always start with tac1</p>



<a name="198464392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198464392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198464392">(May 22 2020 at 16:41)</a>:</h4>
<p>so <code>repeat (tac1 ; tac 2)</code> is good enough</p>



<a name="198464642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198464642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198464642">(May 22 2020 at 16:43)</a>:</h4>
<p>Here's a direct implementation (untested, ymmv):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">namespace</span> <span class="n">tactic</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">iterate_alternating_aux</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="bp">→</span> <span class="n">bool</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="n">unit</span>
<span class="o">:=</span> <span class="bp">λ</span> <span class="n">t₁</span> <span class="n">t₂</span> <span class="n">stop_on_fail</span><span class="o">,</span> <span class="n">do</span>
  <span class="n">progress</span> <span class="err">←</span> <span class="n">try_core</span> <span class="n">t₁</span><span class="o">,</span>
  <span class="k">match</span> <span class="n">progress</span><span class="o">,</span> <span class="n">stop_on_fail</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">iterate_alternating_aux</span> <span class="n">t₂</span> <span class="n">t₁</span> <span class="n">ff</span>
  <span class="bp">|</span> <span class="n">none</span><span class="o">,</span> <span class="n">ff</span> <span class="o">:=</span> <span class="n">iterate_alternating_aux</span> <span class="n">t₂</span> <span class="n">t₁</span> <span class="n">tt</span>
  <span class="bp">|</span> <span class="n">none</span><span class="o">,</span> <span class="n">tt</span> <span class="o">:=</span> <span class="n">pure</span> <span class="o">()</span>
  <span class="kn">end</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">iterate_alternating</span> <span class="o">(</span><span class="n">t₁</span> <span class="n">t₂</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">iterate_alternating_aux</span> <span class="n">t₁</span> <span class="n">t₂</span> <span class="n">ff</span>

<span class="kn">end</span> <span class="n">tactic</span>


<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">iterate_alternating</span> <span class="o">(</span><span class="n">t₁</span> <span class="n">t₂</span> <span class="o">:</span> <span class="n">itactic</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">tactic</span><span class="bp">.</span><span class="n">iterate_alternating</span> <span class="n">t₁</span> <span class="n">t₂</span>

<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>
</code></pre></div>



<a name="198466069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198466069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198466069">(May 22 2020 at 16:54)</a>:</h4>
<p>Thanks. Is there any advantage over the naive method that Jalex found?</p>



<a name="198467327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198467327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198467327">(May 22 2020 at 17:04)</a>:</h4>
<p>Jalex's tactic looks fishy to me because <code>repeat t</code> never fails, so the <code>&lt;|&gt; ...</code> should never be executed.</p>
<p><code>repeat (tac1; tac2)</code> behaves slightly differently than my tactic: afaiu, it stops when <em>either</em> <code>tac1</code> or <code>tac2</code> fails for the first time, whereas my tactic only stops when <em>both</em> <code>tac1</code> and <code>tac2</code> fail. So my tactic permits the sequence <code>tac2, tac2, ...</code>whereas yours requires <code>tac1, tac2, tac1, ...</code>.</p>



<a name="198467392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198467392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198467392">(May 22 2020 at 17:05)</a>:</h4>
<p>Avoiding tac2, tac2 was exactly my request</p>



<a name="198467582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/alternate%20tactics/near/198467582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/alternate.20tactics.html#198467582">(May 22 2020 at 17:07)</a>:</h4>
<p>Then the <code>repeat</code> thing should have the right semantics.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>