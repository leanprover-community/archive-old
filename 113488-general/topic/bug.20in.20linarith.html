---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/bug.20in.20linarith.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html">bug in linarith</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="307452373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307452373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307452373">(Nov 02 2022 at 05:22)</a>:</h4>
<p>While writing tests for the port of <code>linarith</code> to Lean 4, I think I've encountered a bug in the implementation of Fourier-Motzkin elimination in Lean 3, but haven't yet identified what is wrong.</p>
<p>Here's the evidence:</p>
<p>If you add</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mathlib3ex</span> <span class="o">:</span> <span class="n">list</span> <span class="n">comp</span> <span class="o">:=</span>
<span class="o">[</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.lt</span><span class="o">,</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.lt</span><span class="o">,</span> <span class="o">[(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">)]⟩</span>
<span class="o">]</span>

<span class="kd">def</span> <span class="n">mathlib4ex</span> <span class="o">:</span> <span class="n">list</span> <span class="n">comp</span> <span class="o">:=</span>
<span class="o">[</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">10</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.lt</span><span class="o">,</span> <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.lt</span><span class="o">,</span> <span class="o">[(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩</span>
<span class="o">]</span>

<span class="k">#eval</span> <span class="n">fourier_motzkin.produce_certificate</span> <span class="n">mathlib3ex</span> <span class="mi">11</span> <span class="c1">-- succeeds, i.e. found a contradiction</span>
<span class="k">#eval</span> <span class="n">fourier_motzkin.produce_certificate</span> <span class="n">mathlib4ex</span> <span class="mi">11</span> <span class="c1">-- fails, i.e. no contradiction found</span>
</code></pre></div>
<p>to the bottom of <code>src/tactic/linarith/elimination.lean</code> (this is in mathlib3), you'll see that we find a contradiction from the first set of inequalities, but not from the second.</p>
<p>(This is available in the <a href="https://github.com/leanprover-community/mathlib/tree/linarith_bug">branch#linarith_bug</a>.)</p>
<p>However these sets of inequalities are the same, up to renaming variables (and then re-sorting the linear expressions so the terms are in descending order again), and hence should be equisatisfiable!</p>
<p>In <code>pcomp.maybe_minimal</code> there is an implementation of <a href="https://en.wikipedia.org/wiki/Fourier%E2%80%93Motzkin_elimination#Imbert's_acceleration_theorems">Imbert's first theorem</a>. If we remove this check we successfully find a contradiction in both cases, leading me to suspect that this check has been mis-implemented, but so far I don't see what could be wrong.</p>
<p>(I encountered this problem in the mathlib4 implementation, which is meant to be identical except that for unimportant reasons the variable orders are different; a test was failing that succeeded in mathlib3, and I could minimise to this.)</p>
<p>If anyone, e.g. <span class="user-mention" data-user-id="110596">@Rob Lewis</span> (who implemented <code>linarith</code> in the first place!) or <span class="user-mention" data-user-id="110032">@Reid Barton</span> (who I recall has an implementation of FM elsewhere) has any ideas about what's going on here, that would be very helpful.</p>



<a name="307453796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307453796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307453796">(Nov 02 2022 at 05:39)</a>:</h4>
<p>Does that mean that the test in mathlib3 that was succeeding is actually incorrect?</p>



<a name="307454450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307454450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307454450">(Nov 02 2022 at 05:48)</a>:</h4>
<p>What is the contradiction that was found? Is it actually a contradiction?</p>



<a name="307454785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307454785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307454785">(Nov 02 2022 at 05:51)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="k">do</span>
  <span class="n">coeff</span> <span class="bp">←</span> <span class="n">fourier_motzkin.produce_certificate</span> <span class="n">mathlib3ex</span> <span class="mi">11</span><span class="o">,</span>
  <span class="n">tactic.trace</span> <span class="n">coeff.to_list</span>
<span class="c1">-- [(11, 1), (9, 1), (8, 1), (7, 1), (6, 1), (5, 1), (4, 1), (3, 1), (2, 1), (1, 1), (0, 1)]</span>
</code></pre></div>



<a name="307455201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307455201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307455201">(Nov 02 2022 at 05:57)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mathlib3ex</span> <span class="o">:</span> <span class="n">list</span> <span class="n">comp</span> <span class="o">:=</span>
<span class="o">[</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
<span class="o">⟨</span><span class="n">ineq.lt</span><span class="o">,</span> <span class="o">[(</span><span class="mi">11</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">)]⟩</span>
<span class="o">]</span>

<span class="k">#eval</span> <span class="n">tactic.trace</span> <span class="o">(</span><span class="n">mathlib3ex.foldl</span> <span class="n">comp.add</span> <span class="o">⟨</span><span class="n">ineq.eq</span><span class="o">,</span> <span class="o">[]⟩)</span>
<span class="c1">-- []&lt;0</span>
</code></pre></div>
<p>The contradiction seems to be correct</p>



<a name="307457377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307457377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307457377">(Nov 02 2022 at 06:26)</a>:</h4>
<p>Here's a minimization of the example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">mathlib4ex</span> <span class="o">:</span> <span class="n">list</span> <span class="n">comp</span> <span class="o">:=</span>
<span class="o">[⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩,</span>
 <span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
 <span class="o">⟨</span><span class="n">ineq.le</span><span class="o">,</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">)]⟩,</span>
 <span class="o">⟨</span><span class="n">ineq.lt</span><span class="o">,</span> <span class="o">[(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)]⟩]</span>

<span class="k">#eval</span> <span class="n">fourier_motzkin.produce_certificate</span> <span class="o">(</span><span class="n">mathlib4ex.map</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="o">⟨</span><span class="n">x.1</span><span class="o">,</span> <span class="n">list.merge_sort</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">a.1</span> <span class="bp">&gt;</span> <span class="n">b.1</span><span class="o">)</span> <span class="n">x.2</span><span class="o">⟩))</span> <span class="mi">3</span>
</code></pre></div>
<p>changing <code>3</code> to <code>0</code>, or rearranging any of the coefficients (preserving the sum) makes the failure go away</p>



<a name="307469005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307469005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307469005">(Nov 02 2022 at 08:00)</a>:</h4>
<p>Okay, here's an explanation of what happens in the code. We start out with the initial equations E0, ..., E3:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">step</span> <span class="mi">0</span><span class="o">:</span>
<span class="n">E0</span><span class="o">:</span> <span class="bp">-</span><span class="n">x2</span> <span class="bp">&lt;=</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E0</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{}</span>
<span class="n">E1</span><span class="o">:</span> <span class="n">x2</span> <span class="bp">-</span> <span class="n">x0</span> <span class="bp">&lt;=</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E1</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{}</span>
<span class="n">E2</span><span class="o">:</span> <span class="bp">-</span><span class="n">x2</span> <span class="bp">+</span> <span class="n">x1</span> <span class="bp">&lt;=</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E2</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{}</span>
<span class="n">E3</span><span class="o">:</span> <span class="n">x2</span> <span class="bp">-</span> <span class="n">x1</span> <span class="bp">+</span> <span class="n">x0</span> <span class="bp">&lt;</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E3</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{}</span>
</code></pre></div>
<p>We eliminate <code>x2</code> by adding E0 + E1 and E2 + E3 (and also two others that won't matter):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">step</span> <span class="mi">1</span><span class="o">:</span>
<span class="n">E01</span> <span class="bp">=</span> <span class="n">E0</span> <span class="bp">+</span> <span class="n">E1</span><span class="o">:</span> <span class="bp">-</span><span class="n">x0</span> <span class="bp">&lt;=</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E0</span><span class="o">,</span> <span class="n">E1</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{</span><span class="n">x2</span><span class="o">},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{}</span>
<span class="n">E23</span> <span class="bp">=</span> <span class="n">E2</span> <span class="bp">+</span> <span class="n">E3</span><span class="o">:</span> <span class="n">x0</span> <span class="bp">&lt;</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E2</span><span class="o">,</span> <span class="n">E3</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{</span><span class="n">x2</span><span class="o">},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{</span><span class="n">x1</span><span class="o">}</span>
</code></pre></div>
<p>The <code>explicit</code> set indicates that <code>x2</code> was eliminated from each equation "on purpose", but <code>x1</code> was also eliminated from <code>E23</code> "on accident" and so it shows up in the <code>implicit</code> list for <code>E23</code>.</p>
<p>We then eliminate <code>x1</code>, which does nothing (except for deleting the extra unnecessary equations) because the equations already don't have <code>x1</code> present.</p>
<p>We then eliminate <code>x0</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">step</span> <span class="mi">2</span><span class="o">:</span>
<span class="n">E0123</span> <span class="bp">=</span> <span class="n">E01</span> <span class="bp">+</span> <span class="n">E23</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">0</span><span class="o">:</span> <span class="n">history</span> <span class="bp">=</span> <span class="o">{</span><span class="n">E0</span><span class="o">,</span> <span class="n">E1</span><span class="o">,</span> <span class="n">E2</span><span class="o">,</span> <span class="n">E3</span><span class="o">},</span> <span class="n">explicit</span> <span class="bp">=</span> <span class="o">{</span><span class="n">x0</span><span class="o">,</span> <span class="n">x2</span><span class="o">},</span> <span class="n">implicit</span> <span class="bp">=</span> <span class="o">{}</span>
</code></pre></div>
<p><code>x0</code> has been added to the <code>explicit</code> list because this is a new equation constructed by elimination of <code>x0</code>. <code>x1</code> is <em>not</em> in the implicit list because neither <code>E01</code> nor <code>E23</code> contains an occurrence of <code>x1</code>. </p>
<p>We apply the theorem now and conclude that since <code>|history| = 4 &gt; 3 = |explicit ∪ implicit| + 1</code>, the newly generated equation <code>E0123</code> is redundant, so we discard it and get a consistent state, leading to failure of the algorithm.</p>



<a name="307472925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307472925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307472925">(Nov 02 2022 at 08:32)</a>:</h4>
<p>Here's a standalone test case:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">_</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">z</span><span class="o">)</span> <span class="o">(</span><span class="n">E0</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">E1</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">E2</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">c</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="c1">-- fail</span>
</code></pre></div>



<a name="307484788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307484788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307484788">(Nov 02 2022 at 09:46)</a>:</h4>
<p>Thanks for the minimization! So... the conclusion we've reached here is that either</p>
<ol>
<li>our interpretation (i.e. as implemented in mathlib3) of the theorem must be incorrect, because it is incorrect to discard E01234, or</li>
<li>our interpretation is correct and the theorem is false?</li>
</ol>



<a name="307485447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307485447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307485447">(Nov 02 2022 at 09:50)</a>:</h4>
<p>I think the implementation of the theorem is incorrect in the interpretation of <code>x1</code> as not being an implicitly eliminated variable of <code>E0123</code>. Wikipedia says that it should include all variables from equations in the history which are not in the explicit list, and <code>x1</code> is in <code>E2</code> which is in the history of <code>E0123</code>. I think the fix is to union the <code>vars</code> fields when you merge equations instead of recalculating it from the combined equation.</p>



<a name="307488191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307488191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307488191">(Nov 02 2022 at 10:06)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/17307">#17307</a></p>



<a name="307490080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307490080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307490080">(Nov 02 2022 at 10:16)</a>:</h4>
<p>Actually, I better rewrite some doc-strings.</p>



<a name="307491916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307491916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307491916">(Nov 02 2022 at 10:27)</a>:</h4>
<p>Okay, I've updated the doc-strings.</p>
<p>However over on the mathlib4 side, while this fix does fix the failure I initially reported in this thread, it doesn't appear to fix the failure I originally identified (and semi-minimised to put in this thread). So perhaps let's not hurry to merge this fix until I have that sorted out too.</p>



<a name="307505600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307505600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307505600">(Nov 02 2022 at 11:53)</a>:</h4>
<p>Thank you so much Scott and Mario for this work. There's one thing I'm confused about -- if the lean 3 implementation has a bug then why is the output of the lean 3 test not incorrect?</p>



<a name="307523338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307523338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307523338">(Nov 02 2022 at 13:32)</a>:</h4>
<p>What do you mean by "incorrect"? It doesn't output anything incorrect but rather thinks it can't solve cases that should be able to.</p>



<a name="307528887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307528887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307528887">(Nov 02 2022 at 13:58)</a>:</h4>
<p>I wonder how many proofs could be golfed now because of this bugfix...</p>



<a name="307652690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307652690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307652690">(Nov 03 2022 at 03:47)</a>:</h4>
<p>I'm still seeing problems in the mathlib4 implementation (i.e. cases where linarith fails, but should succeed), but where if I ask it to reject fewer constraints according to Imbert's theorem, it succeeds. This suggests I still have the implementation of Imbert's theorem incorrect. :-(</p>



<a name="307652739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307652739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307652739">(Nov 03 2022 at 03:48)</a>:</h4>
<p>Does someone have access to <a href="https://doi.org/10.1016/B978-0-444-88771-9.50019-2">https://doi.org/10.1016/B978-0-444-88771-9.50019-2</a>, and could send me a copy?</p>



<a name="307652762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307652762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307652762">(Nov 03 2022 at 03:48)</a>:</h4>
<p>I think I'd prefer to read it at the source than try to parse too many masters theses trying to restate the result. :-)</p>



<a name="307653007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307653007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307653007">(Nov 03 2022 at 03:52)</a>:</h4>
<p>Or if someone wants to compare the wikipedia description and the implementation, you can look either in <a href="https://github.com/leanprover-community/mathlib/pull/17307">#17307</a>, or <a href="https://github.com/leanprover-community/mathlib4/pull/526">mathlib4#526</a>. The mathlib4 PR has the advantage that it has a failing test, that succeeds if you change the <code>1 + </code> in <code>maybeMinimal</code> to <code>2 + </code>, so can be used to test alternative interpretations...</p>



<a name="307663367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307663367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307663367">(Nov 03 2022 at 06:17)</a>:</h4>
<p>Okay, I think I have this sorted out.</p>
<p>Sadly, the performance of Fourier-Motzkin elimination in larger examples is highly sensitive to the variable/equation ordering, and it's easy to have things either work fine or crash by adding and removing <code>.reverse</code>...</p>



<a name="307666986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307666986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307666986">(Nov 03 2022 at 07:02)</a>:</h4>
<p>Okay, I've got this sorted out, and updated the PR.</p>



<a name="307667098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307667098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307667098">(Nov 03 2022 at 07:03)</a>:</h4>
<p>The new interpretation of "implicitly eliminated variable" now results in all the tests (including the new one!) working in both mathlib3 and mathlib4, and follows the text of the original paper. (However, it doesn't seem to agree with a formula the original paper uses later, so I left a note for future readers... The original paper also has some confusing typos in a critical example... :-)</p>



<a name="307667354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307667354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307667354">(Nov 03 2022 at 07:06)</a>:</h4>
<p>Re the typos: clearly the solution to that is to formalise the paper.</p>



<a name="307667482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307667482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307667482">(Nov 03 2022 at 07:07)</a>:</h4>
<p>I was only able to access the author's later 1993 paper, but I found the description of the theorem and associated algorithm there very unclear and I'm not surprised that it might have been interpreted incorrectly.</p>



<a name="307683353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307683353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307683353">(Nov 03 2022 at 09:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/bug.20in.20linarith/near/307667354">said</a>:</p>
<blockquote>
<p>Re the typos: clearly the solution to that is to formalise the paper.</p>
</blockquote>
<p>Well if we formalize every math paper that has typos in it, we'd be here forever <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span></p>



<a name="307683474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307683474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307683474">(Nov 03 2022 at 09:13)</a>:</h4>
<p>the ones without typos are also helpful</p>



<a name="307683526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307683526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307683526">(Nov 03 2022 at 09:13)</a>:</h4>
<p>I don't know any papers without typos..</p>



<a name="307684197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/307684197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#307684197">(Nov 03 2022 at 09:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/bug.20in.20linarith/near/307667482">said</a>:</p>
<blockquote>
<p>I was only able to access the author's later 1993 paper, but I found the description of the theorem and associated algorithm there very unclear and I'm not surprised that it might have been interpreted incorrectly.</p>
</blockquote>
<p>Maybe you could find a master's student to clarify it in their thesis</p>



<a name="311269121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/311269121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#311269121">(Nov 21 2022 at 12:06)</a>:</h4>
<p>The fixed version seems much more likely to timeout than the original; for instance on</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span>
  <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">-</span> <span class="mi">3</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">-</span> <span class="mi">3</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">17</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">nlinarith</span> <span class="n">only</span> <span class="o">[</span><span class="n">h₁</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">hb</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>
<p>Perhaps it's a coincidence that <code>nlinarith</code> was able to solve this in the first place; but it also seems plausible that we're now stuck in an infinite loop somewhere.</p>



<a name="311730321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bug%20in%20linarith/near/311730321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bug.20in.20linarith.html#311730321">(Nov 22 2022 at 23:44)</a>:</h4>
<p>Yes, the bug was causing it to drop constraints, so it's no particular surprise if some big problems now timeout. The cost of correctness. :-)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>