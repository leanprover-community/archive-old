---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html">Using a mathlib branch in a project</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="277654185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277654185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277654185">(Apr 03 2022 at 18:37)</a>:</h4>
<p>Is there a way to tell my mathlib-using lean project to use a particular branch of mathlib, as I might want to do if I were developing a project in parallel to some changes to mathlib that hadn't been accepted yet? I sort of expected there to be a <code>leanproject get-mathlib-cache --rev my_branch</code> command, but it seems there is not.</p>



<a name="277654995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277654995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277654995">(Apr 03 2022 at 18:55)</a>:</h4>
<p>To do this, I manually edit the <code>leanpkg.toml</code> file with the exact version of mathlib I've needed.  The tricky thing then is figuring out the exact invocations of <code>leanpkg</code> and/or <code>leanproject</code> to download the oleans and build the project without upgrading mathlib.  Let me look back at my notes...</p>



<a name="277655018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277655018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277655018">(Apr 03 2022 at 18:55)</a>:</h4>
<p>I think <code>leanpkg configure; leanproject get-mathlib-cache</code> should do the trick</p>



<a name="277655608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277655608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277655608">(Apr 03 2022 at 19:07)</a>:</h4>
<p>Does anyone know how frequently the oleans are saved for a commit?  Can you do <code>leanproject get-mathlib-cache</code> for basically any commit on github, or only on select releases?</p>



<a name="277655690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277655690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277655690">(Apr 03 2022 at 19:09)</a>:</h4>
<p>Any commit</p>



<a name="277655756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277655756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277655756">(Apr 03 2022 at 19:10)</a>:</h4>
<p>Also, I've only ever done this for specific commit hashes?  (I just looked at the <code>leanpkg.toml</code> file and replaced the <code>rev</code> with the commit I want.)  Can you use branch names instead of commits?</p>



<a name="277656166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277656166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277656166">(Apr 03 2022 at 19:19)</a>:</h4>
<p>IIRC, Not every commit has a cache</p>



<a name="277656171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277656171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277656171">(Apr 03 2022 at 19:19)</a>:</h4>
<p>Only the one at the head of each bors batch</p>



<a name="277656245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277656245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277656245">(Apr 03 2022 at 19:20)</a>:</h4>
<p>Using a branch name is a bad idea, because then no one can reproduce your build if the branch moves</p>



<a name="277656566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277656566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277656566">(Apr 03 2022 at 19:27)</a>:</h4>
<p>My recollection is the following: on the <code>master</code> branch, we keep a cache for every commit at the head of every bors batch (more or less the commits with a green checkmark next to them <a href="https://github.com/leanprover-community/mathlib/commits/master">here</a>). We create a cache for every commit to any branch pushed to the repo, but they are deleted after ~3 days if they are not at the head of a branch.</p>
<p>The precise details are in <a href="https://github.com/leanprover-community/azure-scripts/blob/master/cleanup.py">this script</a>.</p>



<a name="277657585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277657585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277657585">(Apr 03 2022 at 19:50)</a>:</h4>
<p>Oh sorry, I had branches in mind.</p>



<a name="277658350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277658350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277658350">(Apr 03 2022 at 20:05)</a>:</h4>
<p>Even on a branch, CI only ever builds the head commit</p>



<a name="277658359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277658359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277658359">(Apr 03 2022 at 20:05)</a>:</h4>
<p>If you commit twice and push both simultaneously, only the second commit gets built</p>



<a name="277658410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277658410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277658410">(Apr 03 2022 at 20:06)</a>:</h4>
<p>Ah, is that what you call the head commit? Then sure. Sorry for the terminology confusion.</p>



<a name="277686183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277686183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277686183">(Apr 04 2022 at 06:13)</a>:</h4>
<p><code>HEAD</code> has a well-defined meaning in the gitiverse (-;</p>



<a name="277686822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277686822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277686822">(Apr 04 2022 at 06:25)</a>:</h4>
<p>Not answering anyone's questions, but here's a git trick I use sometimes: <code>HEAD</code> refers to what commit is currently checked out (I think it's just whatever <code>.git/HEAD</code> is referring to), and you can refer to its parents by repeatedly suffixing it with <code>^</code>. So for example if you've checked out a branch and you know CI hasn't finished, but still the oleans of its parent commit should be good enough, you can do</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>leanproject get-cache --rev=HEAD^
</code></pre></div>



<a name="277690306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Using%20a%20mathlib%20branch%20in%20a%20project/near/277690306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Using.20a.20mathlib.20branch.20in.20a.20project.html#277690306">(Apr 04 2022 at 07:14)</a>:</h4>
<p><code>get-cache --fallback=download-first</code> iteratively does that for you <span class="user-mention" data-user-id="306601">@Kyle Miller</span>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>