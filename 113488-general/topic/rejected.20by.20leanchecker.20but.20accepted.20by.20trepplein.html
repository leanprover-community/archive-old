---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html">rejected by leanchecker but accepted by trepplein</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="238005797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238005797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238005797">(May 09 2021 at 03:57)</a>:</h4>
<p>I've been running some fuzz testing on the various Lean 3 checkers. One finding is the following file, which is rejected by <code>leanchecker</code> but accepted by <code>trepplein</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">9</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">u</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">eq</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpha</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">UP</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">1</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">a</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpt</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">1</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">0</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">2</span> <span class="n">refl</span>
<span class="mi">7</span> <span class="bp">#</span><span class="n">EC</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="mi">8</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">7</span> <span class="mi">2</span>
<span class="mi">9</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">8</span> <span class="mi">1</span>
<span class="mi">10</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">9</span> <span class="mi">1</span>
<span class="mi">11</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">10</span>
<span class="mi">12</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">11</span>
<span class="bp">#</span><span class="n">IND</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">1</span>
</code></pre></div>
<p>I suspect the reason for the discrepancy has something to do with laziness, and that it does not imply the existence of any serious unsoundness. <br>
However, it's somewhat troubling to me that such a discrepancy exists at all.</p>
<p>Is this troubling to anyone else? Should there be an effort to standardize checker behavior to avoid this kind of discrepancy?</p>



<a name="238006456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238006456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238006456">(May 09 2021 at 04:08)</a>:</h4>
<p>There is at least one known theoretical discrepancy between trepplein and leanchecker, to do with universe handling</p>



<a name="238006799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238006799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238006799">(May 09 2021 at 04:14)</a>:</h4>
<p>Lean uses a normalization approach to defeq testing for level expressions, but the rules it uses for normalization are not complete for the language of nat with zero/succ/max/imax. As a result, there are some level expressions that lean will not think are equal even though they are equal for all concrete values of the universe variables:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">imax</span> <span class="n">u</span> <span class="o">(</span><span class="n">imax</span> <span class="n">v</span> <span class="n">w</span><span class="o">)))</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">imax</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="n">w</span><span class="o">))</span> <span class="o">:=</span> <span class="n">α</span> <span class="bp">=</span> <span class="n">β</span> <span class="c1">-- fails in lean, works in trepplein</span>
</code></pre></div>
<p>Trepplein uses a case splitting approach instead to normalize <code>imax</code> in the goal; as a result it has a complete decision procedure for this language. The rules given in my thesis are also following trepplein here instead of lean.</p>



<a name="238007918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238007918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238007918">(May 09 2021 at 04:36)</a>:</h4>
<p>I worked out that data by hand using <a href="https://github.com/leanprover-community/lean/blob/master/doc/export_format.md">export_format.md</a> as a guide.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">9</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">u</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">u</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">eq</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">eq</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpha</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">alpha</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">UP</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">u1</span> <span class="o">(</span><span class="bp">???</span><span class="o">)</span>
<span class="mi">0</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">1</span> <span class="bp">=</span> <span class="kt">Sort</span> <span class="n">u1</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">a</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">0</span> <span class="bp">=</span> <span class="bp">#</span><span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpt</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">alpt</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">1</span> <span class="bp">=</span> <span class="bp">#</span><span class="mi">1</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">0</span> <span class="bp">=</span> <span class="kt">Sort</span> <span class="mi">0</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span> <span class="bp">=</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">alpt</span> <span class="o">:</span> <span class="bp">#</span><span class="mi">1</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span> <span class="bp">=</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">#</span><span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">alpt</span> <span class="o">:</span> <span class="bp">#</span><span class="mi">0</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span> <span class="bp">=</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u1</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">)</span> <span class="o">(</span><span class="n">alpt</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">2</span> <span class="n">refl</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">refl</span>
<span class="mi">7</span> <span class="bp">#</span><span class="n">EC</span> <span class="mi">2</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span>
<span class="mi">8</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">7</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="bp">#</span><span class="mi">1</span>
<span class="mi">9</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">8</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="bp">#</span><span class="mi">1</span> <span class="bp">#</span><span class="mi">0</span>
<span class="mi">10</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">9</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="bp">#</span><span class="mi">1</span> <span class="bp">#</span><span class="mi">0</span> <span class="bp">#</span><span class="mi">0</span>
<span class="mi">11</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">10</span> <span class="bp">=</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">#</span><span class="mi">0</span><span class="o">),</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="bp">#</span><span class="mi">0</span> <span class="n">a</span> <span class="n">a</span>
<span class="mi">12</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">11</span> <span class="bp">=</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u1</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="n">alpha</span> <span class="n">a</span> <span class="n">a</span>
<span class="bp">#</span><span class="n">IND</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">1</span> <span class="bp">=</span>
  <span class="kd">inductive</span> <span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="n">eq</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u1</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">alpt</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span>
  <span class="bp">|</span> <span class="n">refl</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u1</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u1</span><span class="o">}</span> <span class="n">alpha</span> <span class="n">a</span> <span class="n">a</span>
</code></pre></div>
<p>It appears to be a perfectly correct definition of <code>eq</code> as an inductive type, except that line 4 constructs a universe parameter that I have called <code>u1</code> which references name index <code>1</code>, but there are no previous definitions of a name with that index (grep for <code>1 #N</code>), so it seems reasonable to throw an error.</p>



<a name="238008026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238008026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238008026">(May 09 2021 at 04:39)</a>:</h4>
<p>I guess the fuzz tester decided to change the first character in the file, since it looks like the first line was supposed to be the name</p>



<a name="238008108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238008108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238008108">(May 09 2021 at 04:41)</a>:</h4>
<blockquote>
<p>However, it's somewhat troubling to me that such a discrepancy exists at all.</p>
<p>Is this troubling to anyone else? Should there be an effort to standardize checker behavior to avoid this kind of discrepancy?</p>
</blockquote>
<p>I don't think the checkers have been fuzz tested before, so I would put high probability on you finding at least one bug. The checkers are not actually that well tested against things other than <code>mathlib.txt</code></p>



<a name="238027281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238027281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238027281">(May 09 2021 at 10:50)</a>:</h4>
<p>I also suspect that there at least some logical bugs in the checkers.  Like missing a side-condition for inductives, etc.  It is unfortunately hard to construct text files that should be rejected---everything that <code>lean --export</code> produces should be correct after all.  So you have to resort to constructing them by hand.</p>



<a name="238034427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238034427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238034427">(May 09 2021 at 12:58)</a>:</h4>
<p>Here's another example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">u</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">eq</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpha</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">UP</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">1</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">a</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpt</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">1</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">0</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">2</span> <span class="n">refl</span>
<span class="mi">7</span> <span class="bp">#</span><span class="n">EC</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="mi">8</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">7</span> <span class="mi">2</span>
<span class="mi">9</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">8</span> <span class="mi">1</span>
<span class="mi">10</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">9</span> <span class="mi">1</span>
<span class="mi">11</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">10</span>
<span class="mi">12</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">11</span>
<span class="bp">#</span><span class="n">IND</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">1</span>
</code></pre></div>
<p>This is rejected by <code>leanchecker</code> with output:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">line</span> <span class="mi">21</span><span class="o">:</span> <span class="n">eq</span><span class="o">:</span> <span class="n">invalid</span> <span class="n">anonymous</span> <span class="n">binder</span> <span class="n">name</span>
</code></pre></div>
<p>but accepted by <code>trepplein</code> with output:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- successfully checked 3 declarations</span>
</code></pre></div>



<a name="238036843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238036843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238036843">(May 09 2021 at 13:38)</a>:</h4>
<blockquote>
<p>I also suspect that there at least some logical bugs in the checkers. Like missing a side-condition for inductives, etc.</p>
</blockquote>
<p>I opened <a href="https://github.com/gebner/trepplein/issues/3">https://github.com/gebner/trepplein/issues/3</a>.</p>



<a name="238051913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238051913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238051913">(May 09 2021 at 18:20)</a>:</h4>
<p>I think leanchecker is being too strict here. The problem that was introduced here is the <code>11 #EP</code> line that uses <code>0 = [anon]</code> for the name instead of <code>4 = `a</code>. That is, it is a construction of:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="kd">inductive</span> <span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">eq</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">alpt</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span>
  <span class="bp">|</span> <span class="n">refl</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">([</span><span class="n">anon</span><span class="o">]</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">alpha</span> <span class="o">[</span><span class="n">anon</span><span class="o">]</span> <span class="o">[</span><span class="n">anon</span><span class="o">]</span>
</code></pre></div>
<p>A user can't write this, but <code>[anon]</code> here is only needed for pretty printing and I think that it should be allowed to just stub out all binder names in this way.</p>



<a name="238052698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238052698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238052698">(May 09 2021 at 18:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein/near/238007918">said</a>:</p>
<blockquote>
<p>It appears to be a perfectly correct definition of <code>eq</code> as an inductive type, except that line 4 constructs a universe parameter that I have called <code>u1</code> which references name index <code>1</code>, but there are no previous definitions of a name with that index (grep for <code>1 #N</code>), so it seems reasonable to throw an error.</p>
</blockquote>
<p>I think this should just produce a parse error.</p>



<a name="238052801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238052801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238052801">(May 09 2021 at 18:37)</a>:</h4>
<p>The rust one rejects the first one and accepts the second.</p>



<a name="238054013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238054013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238054013">(May 09 2021 at 18:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243791">David Renshaw</span> <a href="#narrow/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein/near/238005797">said</a>:</p>
<blockquote>
<p>However, it's somewhat troubling to me that such a discrepancy exists at all.</p>
<p>Is this troubling to anyone else? Should there be an effort to standardize checker behavior to avoid this kind of discrepancy?</p>
</blockquote>
<p>I'd like to think this is is redundancy working more or less as planned. What kind of standards would you suggest? There are still a bunch of open questions about how external checking will work for lean 4, but I think this points to a good idea of having a collection of known bad examples that shouldn't get past a type checker.</p>



<a name="238056524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238056524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238056524">(May 09 2021 at 19:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228466">Chris B</span> <a href="#narrow/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein/near/238054013">said</a>:</p>
<blockquote>
<p>What kind of standards would you suggest?</p>
</blockquote>
<p>Ideally, we would agree on the correct behavior for checkers on all edge cases, like the anonymous name case identified above.</p>



<a name="238056647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238056647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238056647">(May 09 2021 at 19:40)</a>:</h4>
<p>it's not like there was ever a standards committee meeting for this stuff</p>



<a name="238056784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238056784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238056784">(May 09 2021 at 19:44)</a>:</h4>
<p>Another source of discrepancy: <code>leanchecker</code> apparently can omit validation of lines that are not referenced by any declaration. So, e.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="n">p</span> <span class="n">l1</span>
</code></pre></div>
<p>is accepted by <code>leanchecker</code> but rejected by <code>trepplein</code>.</p>



<a name="238056930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238056930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238056930">(May 09 2021 at 19:46)</a>:</h4>
<p>All of these little discrepancies make it more difficult to validate the checkers against each other.</p>



<a name="238057198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238057198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238057198">(May 09 2021 at 19:51)</a>:</h4>
<p>That should definitely be a syntax error</p>



<a name="238057219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238057219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238057219">(May 09 2021 at 19:51)</a>:</h4>
<p>I can understand delaying some validation but that's a straight-up parse error, there is a letter instead of a number</p>



<a name="238057292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238057292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238057292">(May 09 2021 at 19:52)</a>:</h4>
<p>Yeah, I agree.</p>



<a name="238058334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238058334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238058334">(May 09 2021 at 20:09)</a>:</h4>
<p>I agree on the anonymous identifier thing. IMO those kinds of implementation details aren't unimportant, but it's hard to find them all before they come up in a context like this where someone's exploring edge cases. If you have a list, I can at least make sure the rust version conforms with the ones that seem reasonable.</p>



<a name="238058852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238058852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238058852">(May 09 2021 at 20:19)</a>:</h4>
<p>Yep, totally. I don't have a list (other than what I've reported above), and I don't expect anyone to just come up with one. My motivation in starting this discussion is mainly to gauge the interest in working towards more uniformity.</p>



<a name="238060006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238060006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238060006">(May 09 2021 at 20:38)</a>:</h4>
<p>I know this is a bad answer since "yeah well when Lean 4 is ready..." is sort of a weasle-ish way of justifying inaction, but when lean 4 is at a point where we can start hammering this out there will probably be much more interest from the broader community in tightening and battle-testing different verifiers. I think fuzzing and collecting negative examples is definitely a good idea for where to start beyond just "does it check mathlib".</p>



<a name="238065727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238065727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238065727">(May 09 2021 at 22:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243791">David Renshaw</span> <a href="#narrow/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein/near/238056784">said</a>:</p>
<blockquote>
<p>Another source of discrepancy: <code>leanchecker</code> apparently can omit validation of lines that are not referenced by any declaration. So, e.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="n">p</span> <span class="n">l1</span>
</code></pre></div>
<p>is accepted by <code>leanchecker</code> but rejected by <code>trepplein</code>.</p>
</blockquote>
<p>I took a look at the code that does the parsing, and it seems that the istream is not error checked, meaning that it will read the line as if it said <code>1 #NS 0 ""</code>. Not sure what it thinks about empty name components but that is a valid name otherwise</p>



<a name="238067502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238067502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238067502">(May 09 2021 at 22:47)</a>:</h4>
<p>Ah, interesting. I gather that this is the code you're referring to: <a href="https://github.com/leanprover-community/lean/blob/05dd36d1717649932fccaafa0868321fb87f916d/src/checker/text_import.cpp#L182">https://github.com/leanprover-community/lean/blob/05dd36d1717649932fccaafa0868321fb87f916d/src/checker/text_import.cpp#L182</a></p>



<a name="238067648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238067648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238067648">(May 09 2021 at 22:49)</a>:</h4>
<p>Yes. I'm preparing a fix PR now</p>



<a name="238067755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238067755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238067755">(May 09 2021 at 22:51)</a>:</h4>
<p>Regarding the anonymous name issue, I am thinking of just removing <a href="https://github.com/leanprover-community/lean/blob/05dd36d1717649932fccaafa0868321fb87f916d/src/kernel/type_checker.cpp#L114-L115">this line</a>, although that will have an effect on the kernel, not just the text importer. A more conservative change would be to have the text importer make up a fresh name if the name that was read is anonymous</p>



<a name="238068078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238068078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238068078">(May 09 2021 at 22:58)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/574">lean#574</a></p>



<a name="238068384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238068384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238068384">(May 09 2021 at 23:03)</a>:</h4>
<blockquote>
<p>Not sure what it thinks about empty name components but that is a valid name otherwise</p>
</blockquote>
<p>I guess lean is totally fine with empty names:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="bp">«»</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="k">#print</span> <span class="bp">«»</span>
</code></pre></div>



<a name="238071518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238071518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238071518">(May 10 2021 at 00:03)</a>:</h4>
<p>Could someone on macOS test <a href="https://github.com/leanprover-community/lean/issues/574">lean#574</a>? I think it's a line endings issue, but I'm not sure if the import or export is to blame</p>



<a name="238072089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238072089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238072089">(May 10 2021 at 00:13)</a>:</h4>
<p>Just <code>make test</code>? I'm doing that on MacOS right now...</p>



<a name="238072093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238072093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238072093">(May 10 2021 at 00:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="mi">2</span><span class="bp">/</span><span class="mi">1411</span> <span class="n">Test</span>    <span class="bp">#</span><span class="mi">2</span><span class="o">:</span> <span class="n">leanchecker</span> <span class="bp">.................................................***</span><span class="n">Failed</span>    <span class="mi">5</span><span class="bp">.</span><span class="mi">20</span> <span class="n">sec</span>
</code></pre></div>



<a name="238076306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238076306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238076306">(May 10 2021 at 01:33)</a>:</h4>
<p>You can do the test steps:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="k">in</span> library/:
../build/shell/lean --recursive --export<span class="o">=</span>../build/shell/library_export.out .
checker/leanchecker shell/library_export.out
</code></pre></div>



<a name="238076384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238076384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238076384">(May 10 2021 at 01:34)</a>:</h4>
<p>apparently this fails on line 1, so I would like to know what <code>library_export.out</code> looks like</p>



<a name="238076479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238076479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238076479">(May 10 2021 at 01:36)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">u</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">eq</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">α</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">UP</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">1</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">a</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">ᾰ</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">1</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">0</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">2</span> <span class="n">refl</span>
<span class="mi">7</span> <span class="bp">#</span><span class="n">EC</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="mi">8</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">7</span> <span class="mi">2</span>
<span class="mi">9</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">8</span> <span class="mi">1</span>
<span class="mi">10</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">9</span> <span class="mi">1</span>
<span class="mi">11</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">10</span>
<span class="mi">12</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">11</span>
<span class="bp">#</span><span class="n">IND</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">1</span>
<span class="bp">...</span>
</code></pre></div>



<a name="238076637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238076637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238076637">(May 10 2021 at 01:40)</a>:</h4>
<p>I'll see if I can narrow down the cause...</p>



<a name="238076764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238076764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238076764">(May 10 2021 at 01:43)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/pull/574/files#r629004579">https://github.com/leanprover-community/lean/pull/574/files#r629004579</a></p>



<a name="238228583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238228583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238228583">(May 10 2021 at 23:45)</a>:</h4>
<p><span class="user-mention" data-user-id="228466">@Chris B</span>  Here's an input that <code>leanchecker</code> and <code>trepplein</code> reject, but <code>nanoda_lib</code> accepts:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">8</span> <span class="n">u</span>
</code></pre></div>



<a name="238229108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238229108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238229108">(May 10 2021 at 23:50)</a>:</h4>
<p>and <a href="https://github.com/leanprover/tc"><code>tc</code></a> also accepts it</p>



<a name="238242038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238242038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238242038">(May 11 2021 at 02:27)</a>:</h4>
<p>Thanks. In my case it goes uncontested because there are no declarations, I suspect it's the same for tc. AFAIK Lean always puts the export items in order, but there's nothing in the (limited) spec which requires primitives to appear in order, they just have to appear before being used in a declaration. It's an easy fix though, if it'll make what you're doing easier I'll change it.</p>



<a name="238242391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238242391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238242391">(May 11 2021 at 02:32)</a>:</h4>
<p>I think it's probably preferable to require them to be in order in a future lean 4 export format since that should be easy to implement across the board. I think eagerly evaluated languages that don't use indirection for the graph elements would be annoyed with the unordered approach.</p>



<a name="238242566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238242566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238242566">(May 11 2021 at 02:34)</a>:</h4>
<blockquote>
<p>In my case it goes uncontested because there are no declarations</p>
</blockquote>
<p><code>nanoda_lib</code> also accepts it in this case (and <code>leanchecker</code> still rejects):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">8</span> <span class="n">u</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">eq</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpha</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">UP</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">1</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">a</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alphahat</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">1</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">0</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">2</span> <span class="n">refl</span>
<span class="mi">7</span> <span class="bp">#</span><span class="n">EC</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="mi">8</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">7</span> <span class="mi">2</span>
<span class="mi">9</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">8</span> <span class="mi">1</span>
<span class="mi">10</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">9</span> <span class="mi">1</span>
<span class="mi">11</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">10</span>
<span class="mi">12</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">11</span>
<span class="bp">#</span><span class="n">IND</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">1</span>
</code></pre></div>



<a name="238242753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238242753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238242753">(May 11 2021 at 02:36)</a>:</h4>
<blockquote>
<p>It's an easy fix though, if it'll make what you're doing easier I'll change it.</p>
</blockquote>
<p>It would help me find more such discrepancies. I'll leave it up to you to determine whether that is a positive outcome. :)</p>



<a name="238242884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238242884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238242884">(May 11 2021 at 02:38)</a>:</h4>
<p>lol touche. Do you need it to terminate nicely, or can it just panic?</p>



<a name="238243010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238243010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238243010">(May 11 2021 at 02:40)</a>:</h4>
<p>In my current setup, panic would be fine, because I'm just invoking <code>nanoda_lib</code> as a black box subprocess.</p>



<a name="238243066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238243066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238243066">(May 11 2021 at 02:41)</a>:</h4>
<p>But in general, richer error information and avoidance of panics is better.</p>



<a name="238243188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238243188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238243188">(May 11 2021 at 02:43)</a>:</h4>
<p>I should also note that I don't have a strong grasp the meanings of the generated inputs. I'm trusting you all to make good judgments about what the "correct" behavior a checker should be.</p>



<a name="238243383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238243383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238243383">(May 11 2021 at 02:46)</a>:</h4>
<p>Like, I don't want to encourage everyone to converge on a suboptimal standardization.</p>



<a name="238243705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238243705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238243705">(May 11 2021 at 02:51)</a>:</h4>
<p><a href="https://github.com/ammkrn/nanoda_lib/tree/ptr_check">https://github.com/ammkrn/nanoda_lib/tree/ptr_check</a></p>



<a name="238243919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238243919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238243919">(May 11 2021 at 02:54)</a>:</h4>
<p>I think you are right on this one since it's not actually "no declarations", it's "no declarations in which the identity of <code>1 #NS 8 u</code> matters enough to ever be read". It's wrong in a weird way but it's still wrong.</p>



<a name="238244390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238244390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238244390">(May 11 2021 at 03:00)</a>:</h4>
<p>I'm on a different computer, but I don't know why it's saying I'm six commits ahead of master. They seem to be the same other than those changes but lmk if it gives you any issues.</p>



<a name="238245642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238245642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238245642">(May 11 2021 at 03:18)</a>:</h4>
<p><span class="user-mention" data-user-id="228466">@Chris B</span> <code>nanoda_lib</code> seems to only check the prefix of commands, so it accepts this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NSBAD</span> <span class="mi">0</span> <span class="n">u</span>
</code></pre></div>
<p>(and <code>leanchecker</code> rejects it with <code>line 1: unknown term definition kind: #NSBAD</code>)</p>



<a name="238248095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238248095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238248095">(May 11 2021 at 03:54)</a>:</h4>
<p>Thanks. Should be fixed on that branch.</p>



<a name="238287564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238287564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238287564">(May 11 2021 at 11:01)</a>:</h4>
<p>Rejected by <code>leanchecker</code>, <code>trepplein</code>, and <code>tc</code>, but accepted by <code>nanoda_lib</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">1</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">u</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">eq</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alpha</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">UP</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">1</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">o</span>
<span class="mi">1</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">0</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">0</span> <span class="n">alphahat</span>
<span class="mi">2</span> <span class="bp">#</span><span class="n">EV</span> <span class="mi">1</span>
<span class="mi">3</span> <span class="bp">#</span><span class="n">ES</span> <span class="mi">0</span>
<span class="mi">4</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">5</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span>
<span class="mi">6</span> <span class="bp">#</span><span class="n">NS</span> <span class="mi">2</span> <span class="n">refl</span>
<span class="mi">7</span> <span class="bp">#</span><span class="n">EC</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="mi">8</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">7</span> <span class="mi">2</span>
<span class="mi">9</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">8</span> <span class="mi">1</span>
<span class="mi">10</span> <span class="bp">#</span><span class="n">EA</span> <span class="mi">9</span> <span class="mi">5</span>
<span class="mi">11</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BD</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">10</span>
<span class="mi">12</span> <span class="bp">#</span><span class="n">EP</span> <span class="bp">#</span><span class="n">BI</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">11</span>
<span class="bp">#</span><span class="n">IND</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">6</span> <span class="mi">12</span> <span class="mi">1</span>
</code></pre></div>



<a name="238319793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238319793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238319793">(May 11 2021 at 14:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228466">Chris B</span> <a href="#narrow/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein/near/238242038">said</a>:</p>
<blockquote>
<p>Thanks. In my case it goes uncontested because there are no declarations, I suspect it's the same for tc. AFAIK Lean always puts the export items in order, but there's nothing in the (limited) spec which requires primitives to appear in order, they just have to appear before being used in a declaration. It's an easy fix though, if it'll make what you're doing easier I'll change it.</p>
</blockquote>
<p>I agree that we should make this part of the spec. No forward references, not just to help eager checkers but also to avoid cyclic references</p>



<a name="238321601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238321601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238321601">(May 11 2021 at 14:56)</a>:</h4>
<p>The last one is a bug in <code>nanoda_lib</code>, and for a pretty reasonable example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="kd">inductive</span> <span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">eq</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">alphahat</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span>
  <span class="bp">|</span> <span class="n">refl</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">alpha</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">alpha</span><span class="o">),</span> <span class="n">eq.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">alpha</span> <span class="n">a</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">a'</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">alphahat</span> <span class="o">:</span> <span class="n">a</span><span class="o">),</span> <span class="kt">Sort</span> <span class="mi">0</span><span class="o">)</span>
</code></pre></div>
<p>You can see that the second argument in the type of <code>refl</code> has been corrupted. This is a type error because <code>Π (a' : a) (alphahat : a), Sort 0</code> has type <code>Sort 1</code> and it is expecting something of type <code>alpha</code></p>



<a name="238358686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rejected%20by%20leanchecker%20but%20accepted%20by%20trepplein/near/238358686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rejected.20by.20leanchecker.20but.20accepted.20by.20trepplein.html#238358686">(May 11 2021 at 18:18)</a>:</h4>
<p>These are helpful, thank you. That should be fixed now. I don't have a local export file for mathlib on this computer, but I'll test it more thoroughly tonight.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>