---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html">set_option trace.simplify.rewrite true</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="195956496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195956496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195956496">(May 01 2020 at 12:35)</a>:</h4>
<p>Maybe I am just extremely lazy, but I would really like a way to see what <code>simp</code> did without writing the 30+ characters making up the name of this topic somewhere that is often far away from the <code>simp</code> I am interested in. Perhaps we could add some lightweight syntax to <code>simp</code>, like <code>simp?</code> to enable the trace?</p>



<a name="195956631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195956631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195956631">(May 01 2020 at 12:37)</a>:</h4>
<p>There's also another incantation that does something slight different but requires only 8 additional characters: <code>squeeze_simp</code>.</p>



<a name="195956687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195956687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195956687">(May 01 2020 at 12:38)</a>:</h4>
<p><code>squeeze_simp</code> is not quite as informative, though.</p>



<a name="195956765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195956765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195956765">(May 01 2020 at 12:39)</a>:</h4>
<p><code>squeeze_simp</code> feels like I have just transformed the puzzle of guessing what <code>simp</code> is doing into the puzzle of understanding the <code>squeeze_simp</code> output. (I know its primary purpose is something else.)</p>



<a name="195956870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195956870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195956870">(May 01 2020 at 12:40)</a>:</h4>
<p>(In particular, I might actually want to replace the <code>simp</code> with a <code>rw</code> or something, and that's hard to judge from <code>squeeze_simp</code> output.)</p>



<a name="195957181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195957181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195957181">(May 01 2020 at 12:44)</a>:</h4>
<p>I also think this would be a great addition.  We don't even need to change core for this.</p>



<a name="195957205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195957205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195957205">(May 01 2020 at 12:44)</a>:</h4>
<p>Oh <span aria-label="question" class="emoji emoji-2753" role="img" title="question">:question:</span></p>



<a name="195957392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195957392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195957392">(May 01 2020 at 12:47)</a>:</h4>
<p>This "works" except that <code>set_bool_option `trace.simplify.rewrite` tt</code> has no effect. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>
<span class="n">setup_tactic_parser</span>

<span class="n">reserve</span> <span class="kn">notation</span> <span class="bp">`</span><span class="n">simp</span><span class="err">?</span><span class="bp">`</span>

<span class="n">meta</span> <span class="n">def</span> <span class="err">«</span><span class="n">simp</span><span class="err">?»</span> <span class="o">(</span><span class="n">use_iota_eqn</span> <span class="o">:</span> <span class="n">parse</span> <span class="err">$</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;!&quot;</span><span class="o">)</span><span class="err">?</span><span class="o">)</span> <span class="o">(</span><span class="n">no_dflt</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">only_flag</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hs</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">simp_arg_list</span><span class="o">)</span> <span class="o">(</span><span class="n">attr_names</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">with_ident_list</span><span class="o">)</span>
  <span class="o">(</span><span class="n">locat</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">location</span><span class="o">)</span> <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">simp_config_ext</span> <span class="o">:=</span> <span class="o">{})</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="n">do</span>
<span class="n">o</span> <span class="err">←</span> <span class="n">get_options</span><span class="o">,</span>
<span class="n">set_bool_option</span> <span class="bp">`</span><span class="n">trace</span><span class="bp">.</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span> <span class="n">tt</span><span class="o">,</span>
<span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">simp</span> <span class="n">use_iota_eqn</span> <span class="n">no_dflt</span> <span class="n">hs</span> <span class="n">attr_names</span> <span class="n">locat</span> <span class="n">cfg</span><span class="o">,</span>
<span class="n">set_options</span> <span class="n">o</span>

<span class="kn">end</span> <span class="n">interactive</span>
<span class="kn">end</span> <span class="n">tactic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span><span class="bp">+</span><span class="n">x</span><span class="bp">=</span><span class="n">x</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span><span class="err">?</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="195957498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195957498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195957498">(May 01 2020 at 12:49)</a>:</h4>
<p>Ah, I see <span aria-label="exclamation" class="emoji emoji-2757" role="img" title="exclamation">:exclamation:</span></p>



<a name="195958614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/195958614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#195958614">(May 01 2020 at 13:05)</a>:</h4>
<p>Unfortunately there doesn't seem to be any way to enable trace options without changes in the C++ code.</p>



<a name="209428197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209428197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209428197">(Sep 08 2020 at 18:51)</a>:</h4>
<p>Now that <code>set_bool_option `trace.simplify.rewrite tt</code> has the desired effect, is the above <code>«simp?» </code> method the best way to do this? Or would it be better to just add the flag in core?</p>



<a name="209470584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209470584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209470584">(Sep 09 2020 at 04:18)</a>:</h4>
<p>I would love to have <code>simp?</code>, but ideally with the helpful <code>Try this:</code> messages that <code>squeeze_simp</code> gives.</p>



<a name="209494015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209494015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209494015">(Sep 09 2020 at 10:29)</a>:</h4>
<p>Isn't that called <code>squeeze_simp</code>?</p>



<a name="209497389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209497389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209497389">(Sep 09 2020 at 11:10)</a>:</h4>
<p>I think the proposal is to rename <code>squeeze_simp</code> to <code>simp?</code> (like <code>rcases?</code>, etc.), and call the name tracing simp <code>simp?!</code>.</p>



<a name="209498279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209498279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209498279">(Sep 09 2020 at 11:22)</a>:</h4>
<p>this reminds me that <code>!</code> is already an option to <code>simp</code>, but I have no idea what it does</p>



<a name="209498768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209498768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209498768">(Sep 09 2020 at 11:28)</a>:</h4>
<p>Wait, shouldn't <code>simp?</code> use the name tracing, and replace <code>squeeze_simp</code>?</p>



<a name="209498808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209498808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209498808">(Sep 09 2020 at 11:29)</a>:</h4>
<p>Maybe I don't understand enough of the details of what has changed. But I thought that with the C++ changes, we could write a better <code>squeeze_simp</code></p>



<a name="209499094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209499094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209499094">(Sep 09 2020 at 11:33)</a>:</h4>
<p>The only C++ change is (in effect) that you can turn on <code>trace.simplify.rewrite</code> from inside a tactic block.</p>



<a name="209499131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209499131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209499131">(Sep 09 2020 at 11:33)</a>:</h4>
<p>Right. And that should allow a tactic to build better <code>squeeze_simp</code> output, right?</p>



<a name="209499135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209499135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209499135">(Sep 09 2020 at 11:33)</a>:</h4>
<p>More precisely, when the C++ part of the simplifier is entered, it uses the current options rather than the ones which were in effect when the declaration began.</p>



<a name="209499164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/set_option%20trace.simplify.rewrite%20true/near/209499164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/set_option.20trace.2Esimplify.2Erewrite.20true.html#209499164">(Sep 09 2020 at 11:34)</a>:</h4>
<p>I have no idea, I just want to see the output of <code>trace.simplify.rewrite</code>! I don't think there is a tactic interface to that, but maybe?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>