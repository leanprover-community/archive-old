---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html">goal is not well formed after simp??</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202177408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177408">(Jun 27 2020 at 09:41)</a>:</h4>
<p>After a <code>simp * at *</code>, I end up with the following goal stat (<code>pp.all</code> is <code>true</code>)</p>
<div class="codehilite"><pre><span></span><code><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">ring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span><span class="o">,</span>
<span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="bp">@</span><span class="n">polynomial</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span> <span class="bp">_</span><span class="n">inst_1</span><span class="o">),</span>
<span class="n">m</span> <span class="o">:</span> <span class="n">nat</span><span class="o">,</span>
<span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span>
<span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="o">,</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span>
<span class="n">h_2</span> <span class="o">:</span> <span class="n">not</span> <span class="o">(</span><span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="n">n</span> <span class="n">m</span><span class="o">),</span>
<span class="n">h_1</span> <span class="o">:</span> <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="n">n</span> <span class="n">m</span><span class="o">)</span> <span class="n">n</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">true</span>
<span class="err">⊢</span> <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">R</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_mul</span><span class="bp">.</span><span class="n">mul</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class</span><span class="bp">.</span><span class="n">to_has_mul</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span> <span class="o">(</span><span class="bp">@</span><span class="n">semiring</span><span class="bp">.</span><span class="n">to_mul_zero_class</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">R</span> <span class="bp">_</span><span class="n">inst_1</span><span class="o">)))</span>
       <span class="n">r</span>
       <span class="n">s</span><span class="o">)</span>
    <span class="n">n</span>
</code></pre></div>



<a name="202177455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177455">(Jun 27 2020 at 09:42)</a>:</h4>
<p>This looks like trouble, because the <code>n</code> at the end of the goal is a <code>nat</code>, but isn't coerced to <code>R</code>.</p>



<a name="202177659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177659">(Jun 27 2020 at 09:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Can you use this to prove false?</p>



<a name="202177708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177708">(Jun 27 2020 at 09:48)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a>?</p>



<a name="202177719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177719">(Jun 27 2020 at 09:49)</a>:</h4>
<p>wow what is happening</p>



<a name="202177735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177735">(Jun 27 2020 at 09:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/bad-goal/src/data/polynomial_cayley_hamilton.lean#L63">https://github.com/leanprover-community/mathlib/blob/bad-goal/src/data/polynomial_cayley_hamilton.lean#L63</a></p>



<a name="202177767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177767">(Jun 27 2020 at 09:50)</a>:</h4>
<p>I pushed to <code>bad-goal</code></p>



<a name="202177773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177773">(Jun 27 2020 at 09:50)</a>:</h4>
<p>you can't M it any more than that?</p>



<a name="202177777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177777">(Jun 27 2020 at 09:50)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">mul_coeff_zero</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">coeff</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">q</span><span class="o">)</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">coeff</span> <span class="n">p</span> <span class="mi">0</span> <span class="bp">*</span> <span class="n">coeff</span> <span class="n">q</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">polynomial</span><span class="bp">.</span><span class="n">induction_on&#39;</span> <span class="n">p</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">φ</span> <span class="n">ψ</span> <span class="n">hφ</span> <span class="n">hψ</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_mul</span><span class="o">,</span> <span class="n">coeff_add</span><span class="o">,</span> <span class="n">coeff_add</span><span class="o">,</span> <span class="n">add_mul</span><span class="o">,</span> <span class="n">hφ</span><span class="o">,</span> <span class="n">hψ</span><span class="o">],</span> <span class="o">},</span>
  <span class="n">intros</span> <span class="n">m</span> <span class="n">r</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">polynomial</span><span class="bp">.</span><span class="n">induction_on&#39;</span> <span class="n">q</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">φ</span> <span class="n">ψ</span> <span class="n">hφ</span> <span class="n">hψ</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">,</span> <span class="n">coeff_add</span><span class="o">,</span> <span class="n">coeff_add</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">,</span> <span class="n">hφ</span><span class="o">,</span> <span class="n">hψ</span><span class="o">],</span> <span class="o">},</span>
  <span class="n">intros</span> <span class="n">n</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">monomial_eq_smul_X</span><span class="o">,</span> <span class="n">monomial_eq_smul_X</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;</span><span class="o">,</span> <span class="n">X_pow_mul_assoc</span><span class="o">,</span> <span class="err">←</span> <span class="n">mul_assoc</span><span class="o">,</span>
      <span class="err">←</span> <span class="n">C_mul</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="err">←</span> <span class="n">pow_add</span><span class="o">,</span> <span class="n">coeff_C_mul</span><span class="o">,</span> <span class="n">coeff_C_mul</span><span class="o">,</span> <span class="n">coeff_C_mul</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">if_t_t</span><span class="o">,</span> <span class="n">mul_boole</span><span class="o">,</span> <span class="n">coeff_X_pow</span><span class="o">,</span> <span class="n">zero_mul</span><span class="o">,</span> <span class="n">ite_mul</span><span class="o">,</span> <span class="n">mul_ite</span><span class="o">,</span> <span class="n">mul_zero</span><span class="o">],</span>
  <span class="n">split_ifs</span><span class="bp">;</span> <span class="n">simp</span> <span class="bp">*</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="202177778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177778">(Jun 27 2020 at 09:50)</a>:</h4>
<p>This is on the Cayley--Hamilton branch</p>



<a name="202177781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177781">(Jun 27 2020 at 09:50)</a>:</h4>
<p>I'll see if I can M it more than that.</p>



<a name="202177799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177799">(Jun 27 2020 at 09:51)</a>:</h4>
<p>You might want to try closing the goal with <code>sorry</code> and see what the kernel has to say about it</p>



<a name="202177807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202177807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202177807">(Jun 27 2020 at 09:52)</a>:</h4>
<p>it might be that <code>simp</code> made a bad subgoal</p>



<a name="202178149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178149">(Jun 27 2020 at 10:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> This works on current <code>master</code></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">polynomial</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">ite</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">0</span> <span class="bp">=</span>
    <span class="n">ite</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">ite</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">=</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">*</span> <span class="o">(</span><span class="n">s</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">))</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">split_ifs</span><span class="bp">;</span> <span class="n">simp</span> <span class="bp">*</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="202178154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178154">(Jun 27 2020 at 10:01)</a>:</h4>
<p>Lunch time now...</p>



<a name="202178198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178198">(Jun 27 2020 at 10:02)</a>:</h4>
<p>and as I thought if you put <code>; sorry</code> at the end the kernel has the same complaint as you</p>



<a name="202178219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178219">(Jun 27 2020 at 10:03)</a>:</h4>
<p>what does the kernel say?</p>



<a name="202178303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178303">(Jun 27 2020 at 10:05)</a>:</h4>
<p>what you would expect:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h_1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span> <span class="bp">*</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">r</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">n</span>
<span class="n">term</span>
  <span class="n">n</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">ℕ</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">R</span>
</code></pre></div>



<a name="202178348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178348">(Jun 27 2020 at 10:06)</a>:</h4>
<p><code>simp</code> generates a subgoal that is not well typed, so of course if you try to close that goal by any means you will get a badly typed proof</p>



<a name="202178381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178381">(Jun 27 2020 at 10:07)</a>:</h4>
<p>conclusion: don't use simp</p>



<a name="202178384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178384">(Jun 27 2020 at 10:07)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span> <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="202178392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178392">(Jun 27 2020 at 10:07)</a>:</h4>
<p>The problem is that simp isn't good at distinguishing numerals from different types</p>



<a name="202178399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178399">(Jun 27 2020 at 10:07)</a>:</h4>
<p>so it thinks it can rewrite the <code>0</code> on the rhs of the goal using <code>h</code></p>



<a name="202178651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178651">(Jun 27 2020 at 10:14)</a>:</h4>
<p>It's ok, simp is being removed from lean 4 anyway <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="202178663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202178663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202178663">(Jun 27 2020 at 10:16)</a>:</h4>
<p>minimized:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span> <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="202181981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202181981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202181981">(Jun 27 2020 at 11:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Is this something that can be fixed? Or should we learn to live with this/</p>



<a name="202182214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/goal%20is%20not%20well%20formed%20after%20simp%3F%3F/near/202182214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/goal.20is.20not.20well.20formed.20after.20simp.3F.3F.html#202182214">(Jun 27 2020 at 11:46)</a>:</h4>
<p>I've pushed it onto the todo stack: <a href="https://github.com/leanprover-community/lean/issues/362">lean#362</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>