---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html">Deterministic timeout for class definition</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="205053134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053134">(Jul 26 2020 at 13:51)</a>:</h4>
<p>I'm assuming I've either done something silly here that I've missed, or my lean installation is broken. Should this be expected to timeout?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>

<span class="n">universes</span> <span class="n">u1</span> <span class="n">u2</span> <span class="n">u3</span> <span class="n">u4</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u1</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u2</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="n">class</span> <span class="n">tensor_algebra_class</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u3</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">T</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">T</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun&#39;</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">T</span><span class="o">)</span>
<span class="c1">-- (lift : Π {A : Type u4} [semiring A] [algebra R A], (M →ₗ[R] A) → (T →ₐ[R] A))</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">tensor_algebra_class</span>
</code></pre></div>



<a name="205053428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053428">(Jul 26 2020 at 14:00)</a>:</h4>
<p>I don't know what's going on, but I can tell you it times out for me too.</p>



<a name="205053436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053436">(Jul 26 2020 at 14:01)</a>:</h4>
<p>Also, I'm quite confident you should use the same universe level for <code>R</code>, <code>M</code>, <code>T</code>, <code>A</code>.</p>



<a name="205053539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053539">(Jul 26 2020 at 14:04)</a>:</h4>
<p>I suspect it has to do with the on the fly reconstruction of bits of the constructor into typeclasses in order to make things like <code>semimodule R T</code> work when you've only been given a bunch of fields. Making <code>algebra R T</code> a parameter fixes the issue</p>



<a name="205053550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053550">(Jul 26 2020 at 14:05)</a>:</h4>
<p>a workaround:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">tensor_algebra_mixin</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u3</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">T</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun&#39;</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">T</span><span class="o">)</span>
<span class="c1">-- (lift : Π {A : Type u4} [semiring A] [algebra R A], (M →ₗ[R] A) → (T →ₐ[R] A))</span>

<span class="n">class</span> <span class="n">tensor_algebra_class</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u3</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">T</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">T</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mixin</span> <span class="o">:</span> <span class="n">tensor_algebra_mixin</span> <span class="n">R</span> <span class="n">M</span> <span class="n">T</span><span class="o">)</span>
</code></pre></div>



<a name="205053555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053555">(Jul 26 2020 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205053436">said</a>:</p>
<blockquote>
<p>Also, I'm quite confident you should use the same universe level for <code>R</code>, <code>M</code>, <code>T</code>, <code>A</code>.</p>
</blockquote>
<p>I'd disagree with this simply because <code>algebra</code> and <code>module</code> use different universe levels today.</p>



<a name="205053561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053561">(Jul 26 2020 at 14:05)</a>:</h4>
<p>That is also a dubious, but more defensible choice</p>



<a name="205053613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053613">(Jul 26 2020 at 14:06)</a>:</h4>
<p>Once you try to characterize an object by a universal property that quantifies over all other objects, it will become extremely unpleasant.</p>



<a name="205053620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053620">(Jul 26 2020 at 14:07)</a>:</h4>
<p>As in, once I uncomment <code>lift</code>?</p>



<a name="205053627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053627">(Jul 26 2020 at 14:07)</a>:</h4>
<p>In the <code>is_def_eq_detail</code> trace I see stuff like</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">to_semimodule</span><span class="bp">._</span><span class="n">proof_5</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">to_semimodule</span><span class="bp">._</span><span class="n">proof_5</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">5</span><span class="o">]:</span> <span class="bp">_</span><span class="n">to_algebra</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="bp">_</span><span class="n">to_algebra_1</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="bp">_</span><span class="n">to_algebra</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="bp">_</span><span class="n">to_algebra_1</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="n">unfold</span> <span class="n">left</span><span class="bp">&amp;</span><span class="n">right</span><span class="o">:</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">to_semimodule</span><span class="bp">._</span><span class="n">proof_5</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">5</span><span class="o">]:</span> <span class="o">(</span><span class="n">id</span>
   <span class="o">((((</span><span class="n">forall_congr_eq</span> <span class="o">[</span><span class="bp">...</span> <span class="n">many</span> <span class="n">more</span> <span class="n">lines</span> <span class="n">omitted</span><span class="o">]</span>
</code></pre></div>



<a name="205053676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053676">(Jul 26 2020 at 14:08)</a>:</h4>
<p>I understand <code>_to_algebra</code> is probably an instance argument of <code>algebra.to_semimodule._proof_5</code>, but still why is it doing this work to check a defeq between proofs?</p>



<a name="205053728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053728">(Jul 26 2020 at 14:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205053550">said</a>:</p>
<blockquote>
<p>a workaround:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">tensor_algebra_mixin</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u3</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">T</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun&#39;</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">T</span><span class="o">)</span>
<span class="c1">-- (lift : Π {A : Type u4} [semiring A] [algebra R A], (M →ₗ[R] A) → (T →ₐ[R] A))</span>

<span class="n">class</span> <span class="n">tensor_algebra_class</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u3</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">T</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">T</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mixin</span> <span class="o">:</span> <span class="n">tensor_algebra_mixin</span> <span class="n">R</span> <span class="n">M</span> <span class="n">T</span><span class="o">)</span>
</code></pre></div>


</blockquote>
<p>Note that this is bad, as <code>tensor_algebra_class</code> has a parameter <code>M</code> which is not in <code>algebra R T</code>, so you should not extend it (unless I misunderstand something).</p>



<a name="205053729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053729">(Jul 26 2020 at 14:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205053620">said</a>:</p>
<blockquote>
<blockquote>
<p>it will become extremely unpleasant.</p>
</blockquote>
<p>As in, once I uncomment <code>lift</code>?</p>
</blockquote>
<p>Yes. You cannot quantify over universes so what you have defined is a <code>u3</code>-algebra <code>T</code> that satisfies a universal property with respect to all <code>u4</code>-algebras.</p>



<a name="205053740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053740">(Jul 26 2020 at 14:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> Ah, that's true, I didn't look at the original example carefully enough</p>



<a name="205053745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053745">(Jul 26 2020 at 14:11)</a>:</h4>
<p>so you probably want the mixin version anyway</p>



<a name="205053789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053789">(Jul 26 2020 at 14:12)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>, that's good advice</p>



<a name="205053796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053796">(Jul 26 2020 at 14:12)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> in the perfectoid project we thought we wanted to make a structure which involved quantifying over types in a random universe, but the type theory experts pointed out that we could just quantify over types in the same universe as part of our definition, and then prove the more general universal property as a theorem. My understanding was that you don't really want to be introducing new universe variables in your structures that can't be inferred from the inputs, but that was way back in 2019 before the fork and maybe things are better now</p>



<a name="205053798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053798">(Jul 26 2020 at 14:12)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">tensor_algebra_class</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u3</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">T</span><span class="o">]:=</span>
<span class="o">(</span><span class="n">to_fun&#39;</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">T</span><span class="o">)</span>
</code></pre></div>


<p>works just fine</p>



<a name="205053799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053799">(Jul 26 2020 at 14:12)</a>:</h4>
<p><span aria-label="four leaf clover" class="emoji emoji-1f340" role="img" title="four leaf clover">:four_leaf_clover:</span> ?</p>



<a name="205053814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053814">(Jul 26 2020 at 14:13)</a>:</h4>
<p>(as in, will the typeclass system in Lean 4 be better?)</p>



<a name="205053817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053817">(Jul 26 2020 at 14:13)</a>:</h4>
<p><span aria-label="rainbow" class="emoji emoji-1f308" role="img" title="rainbow">:rainbow:</span></p>



<a name="205053820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053820">(Jul 26 2020 at 14:13)</a>:</h4>
<p>I predict it will be better in at least some respects.</p>



<a name="205053825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053825">(Jul 26 2020 at 14:13)</a>:</h4>
<p>The motivation for A and T having different universes came from <a href="https://github.com/leanprover-community/mathlib/issues/3531">#3531</a>, for which I'm trying to work out if  a typeclass-style "Assume such a construction exists" type formalization can be used instead of assembling what to me seems like a rather uninteresting definition. That PR used different universes, so I figured I'd try the same</p>



<a name="205053875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053875">(Jul 26 2020 at 14:14)</a>:</h4>
<p>(although admittedly there <code>tensor_algebra R M</code> has universe <code>max u1 u2</code> instead of my <code>T</code> which is <code>u3</code>)</p>



<a name="205053885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053885">(Jul 26 2020 at 14:15)</a>:</h4>
<p><code>A</code> and <code>T</code> having different universes just doesn't work</p>



<a name="205053893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053893">(Jul 26 2020 at 14:15)</a>:</h4>
<p>because you cannot characterize an object by its maps into objects in another universe in general</p>



<a name="205053895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053895">(Jul 26 2020 at 14:15)</a>:</h4>
<p><code>A</code> and <code>T</code> having the same universe, distinct from <code>R</code> and <code>M</code> could work</p>



<a name="205053933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053933">(Jul 26 2020 at 14:16)</a>:</h4>
<p>Maybe I should mention that my initial construction of the tensor algebra is here:<br>
<a href="https://gist.github.com/adamtopaz/84315ae5b11319013707b2d0804fb37e">https://gist.github.com/adamtopaz/84315ae5b11319013707b2d0804fb37e</a></p>
<p>Here I quantified over all types of some random universe when defining the relation, and got exactly the universe issues that Kevin mentioned.</p>



<a name="205053936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053936">(Jul 26 2020 at 14:16)</a>:</h4>
<p>but it will just lead to strictly more headaches than simply putting everything in the same universe</p>



<a name="205053942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053942">(Jul 26 2020 at 14:16)</a>:</h4>
<p>I mean, they will be different headaches.</p>



<a name="205053948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053948">(Jul 26 2020 at 14:17)</a>:</h4>
<p>Does the PR suffer from the same issue, where <code>A</code> is <code>u3</code> and <code>T = tensor_algebra R M</code> is <code>max u1 u2</code>? Or is it exempt because the lemma using both universes does not attempt to be part of a type class?</p>



<a name="205053951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053951">(Jul 26 2020 at 14:17)</a>:</h4>
<p>We are doing mathematics here. In actual mathematics all our objects will be what ZFC people call sets, so in particular they will all be in the same universe. Universe polymorphism is important sometimes, but for definitions like this I don't think it is</p>



<a name="205053992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053992">(Jul 26 2020 at 14:18)</a>:</h4>
<p>The PR is different because it is performing a construction</p>



<a name="205053993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205053993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205053993">(Jul 26 2020 at 14:18)</a>:</h4>
<p>The universe level of <code>tensor_algebra R M</code> is the maximum of the universe levels of <code>R</code> and <code>M</code>, as it should be.</p>



<a name="205054001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054001">(Jul 26 2020 at 14:18)</a>:</h4>
<p>But the universal property is proved for maps into algebras with arbitrary universe levels.</p>



<a name="205054005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054005">(Jul 26 2020 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="243562">@Adam Topaz</span>, just to emphasize I'm super excited by your PR, and this is me trying to understand alternatives not criticise your approach :)</p>



<a name="205054006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054006">(Jul 26 2020 at 14:18)</a>:</h4>
<p>also, someone can always come along and set <code>u1 = u2 = u</code> to get the plain case where the universes agree</p>



<a name="205054009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054009">(Jul 26 2020 at 14:18)</a>:</h4>
<p>however, this will probably cause Lean some difficulties</p>



<a name="205054016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054016">(Jul 26 2020 at 14:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205053951">said</a>:</p>
<blockquote>
<p>We are doing mathematics here. In actual mathematics all our objects will be what ZFC people call sets, so in particular they will all be in the same universe. Universe polymorphism is important sometimes, but for definitions like this I don't think it is</p>
</blockquote>
<p>If you have as a component of your structure a lift into every set, then the structure isn't a set (in ZFC)</p>



<a name="205054019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054019">(Jul 26 2020 at 14:19)</a>:</h4>
<p>because unification with universe levels of the form <code>max ?u_1 ?u_2</code> is hard</p>



<a name="205054020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054020">(Jul 26 2020 at 14:19)</a>:</h4>
<p>Right, so in the perfectoid project our universal property in the definition stuck with the same universe and we proved a theorem afterwards saying it worked with different universes too</p>



<a name="205054025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054025">(Jul 26 2020 at 14:19)</a>:</h4>
<p>(or at least, too hard for Lean's elaborator)</p>



<a name="205054068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054068">(Jul 26 2020 at 14:20)</a>:</h4>
<p>Lean will not unify <code>max ?u_1 ?u_2 = u</code> anyway, it knows that <code>max</code> is not injective</p>



<a name="205054072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054072">(Jul 26 2020 at 14:20)</a>:</h4>
<p>it will not unify <code>max ?u_1 ?u_2 = max u v</code></p>



<a name="205054117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054117">(Jul 26 2020 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205054020">said</a>:</p>
<blockquote>
<p>we proved a theorem afterwards saying it worked with different universes too</p>
</blockquote>
<p>Would you mind linking to that theorem?</p>



<a name="205054120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054120">(Jul 26 2020 at 14:22)</a>:</h4>
<p>the workaround to "having a function quantify over a universe in a component in the structure" is "don't"</p>



<a name="205054123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054123">(Jul 26 2020 at 14:22)</a>:</h4>
<p>This comes up sometimes in the category theory library because there are a lot of constructions whose results live in various complicated universes, and I think there are even instances which are declared for the sole purpose of enabling instance search to guess the right values of universe levels.</p>



<a name="205054139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054139">(Jul 26 2020 at 14:23)</a>:</h4>
<p>It's really just not worth dealing with these issues if you don't have to.</p>



<a name="205054246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054246">(Jul 26 2020 at 14:26)</a>:</h4>
<p>Actually, I stand corrected, lean will unify <code>max u v = max ?u ?v</code> even though it really shouldn't</p>
<div class="codehilite"><pre><span></span><code><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">))</span>
<span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">universes</span> <span class="n">true</span>
<span class="bp">#</span><span class="kn">check</span> <span class="n">foo</span> <span class="bp">=</span> <span class="n">x</span> <span class="c1">-- foo.{u v} = x : Prop</span>
</code></pre></div>



<a name="205054258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054258">(Jul 26 2020 at 14:27)</a>:</h4>
<p>Kevin, in the perfectoid space project, I think you only used a single universe variable at a time, right?</p>



<a name="205054263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054263">(Jul 26 2020 at 14:27)</a>:</h4>
<p>this <code>max</code> problem causes issues with <code>cardinal.lift</code> etc</p>



<a name="205054303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054303">(Jul 26 2020 at 14:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205053895">said</a>:</p>
<blockquote>
<p><code>A</code> and <code>T</code> having the same universe, distinct from <code>R</code> and <code>M</code> could work</p>
</blockquote>
<p>Oh I remembered the other issue, which is that with three general universe levels for <code>R</code>, <code>M</code>, <code>A = T</code>, your definition might "work", but be wrong!</p>



<a name="205054319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054319">(Jul 26 2020 at 14:29)</a>:</h4>
<p><span class="user-mention" data-user-id="243562">@Adam Topaz</span> if you start playing with universes, don't forget to <code>git pull</code> first because I just pushed two commits to your branch.</p>



<a name="205054323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054323">(Jul 26 2020 at 14:29)</a>:</h4>
<p>The problem is if <code>R</code> lives in <code>u1</code>, <code>M</code> lives in <code>u2</code>, <code>T</code> lives in <code>u3</code>, and <code>u3</code> is not at least <code>max u1 u2</code>, then there might not be enough interesting <code>u3</code>-<code>R</code>-algebras with a map from <code>M</code> to map <code>T</code> into</p>



<a name="205054371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054371">(Jul 26 2020 at 14:30)</a>:</h4>
<p>so then you want <code>A</code> to live in <code>max u1 u2 u3</code></p>



<a name="205054385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054385">(Jul 26 2020 at 14:31)</a>:</h4>
<p>Because the actual tensor algebra will usually really live in universe <code>max u1 u2</code>, and so whatever the object <code>T</code> described by this universal property happens to be, it certainly can't be the correct tensor algebra (most likely, it simply doesn't exist).</p>



<a name="205054425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054425">(Jul 26 2020 at 14:32)</a>:</h4>
<p>Right, you can do that, but then Lean is likely to never understand how to guess <code>u3</code></p>



<a name="205054427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054427">(Jul 26 2020 at 14:32)</a>:</h4>
<p>it's in the type of <code>T</code> though?</p>



<a name="205054430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054430">(Jul 26 2020 at 14:32)</a>:</h4>
<p>Oh, <code>A</code> not <code>T</code></p>



<a name="205054447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054447">(Jul 26 2020 at 14:33)</a>:</h4>
<p>Ah, I think I see your complaint now -<code>u4</code> is part of the <code>tensor_algebra_class</code> type as I wrote it, not just part of the quantifier. Is that a correct interpretation?</p>



<a name="205054448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054448">(Jul 26 2020 at 14:33)</a>:</h4>
<p>that could work, but then you can't even prove that two different tensor algebras <code>T</code> are isomorphic without jumping through a bunch of <code>ulift</code> hoops</p>



<a name="205054450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054450">(Jul 26 2020 at 14:33)</a>:</h4>
<p>yeah it won't be pleasant</p>



<a name="205054451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054451">(Jul 26 2020 at 14:33)</a>:</h4>
<p>and all of these issues could have been dealt with up front by <code>ulift</code> anyways</p>



<a name="205054489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054489">(Jul 26 2020 at 14:34)</a>:</h4>
<p>by just moving <code>R</code> and <code>M</code> into the same universe</p>



<a name="205054491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054491">(Jul 26 2020 at 14:34)</a>:</h4>
<p>I agree with Kenny's recommendation: avoid universe quantification in definitions</p>



<a name="205054494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054494">(Jul 26 2020 at 14:35)</a>:</h4>
<p>if you can get an "internal" definition use that instead, and prove the universal property as a lemma</p>



<a name="205054498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054498">(Jul 26 2020 at 14:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition/near/205054447">said</a>:</p>
<blockquote>
<p>Ah, I think I see your complaint now -<code>u4</code> is part of the <code>tensor_algebra_class</code> type as I wrote it, not just part of the quantifier. Is that a correct interpretation?</p>
</blockquote>
<p>Yes, it is a parameter of the class, and it is impossible to quantify over universe variables in a forall like this.</p>



<a name="205054501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054501">(Jul 26 2020 at 14:35)</a>:</h4>
<blockquote>
<p>by just moving R and M into the same universe</p>
</blockquote>
<p>What's the motivation for <code>semimodule</code> putting <code>R</code> and <code>M</code> into different universes?</p>



<a name="205054506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054506">(Jul 26 2020 at 14:35)</a>:</h4>
<p>they are both parameters to <code>semimodule</code></p>



<a name="205054552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054552">(Jul 26 2020 at 14:36)</a>:</h4>
<p>the preferred default is to have all input types be in unconstrained universes and for the output type to be derived from the inputs. That way universe inference is always easy</p>



<a name="205054599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054599">(Jul 26 2020 at 14:38)</a>:</h4>
<p>generally if you have two "unrelated" types, they should probably be in different universes</p>



<a name="205054609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054609">(Jul 26 2020 at 14:39)</a>:</h4>
<p>but if you make a concrete definition like <code>real</code>, it should live in the lowest permissible universe</p>



<a name="205054663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054663">(Jul 26 2020 at 14:40)</a>:</h4>
<p>There's plenty of stuff you can do with <code>semimodule</code> before the universe headaches start, and once they do you can just specialize to the same universe and it doesn't cost too much.</p>



<a name="205054669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054669">(Jul 26 2020 at 14:40)</a>:</h4>
<p>And the definition is really correct for all possible pairs of universe levels</p>



<a name="205054723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054723">(Jul 26 2020 at 14:42)</a>:</h4>
<p>and because things like <code>real</code> being in a fixed universe <code>Type 0</code>, which penalizes the "just use a single universe and save yourself a lot of bother" approach, there's a range of applications where it's more convenient to allow distinct universes because it avoids <code>ulift</code></p>



<a name="205054733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054733">(Jul 26 2020 at 14:43)</a>:</h4>
<p>but as soon as you would have to use <code>ulift</code> <em>anyways</em> to prove things like "two objects with the same universal property are isomorphic" then it's no longer worth keeping it up</p>



<a name="205054781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054781">(Jul 26 2020 at 14:44)</a>:</h4>
<p>For another example, I think the usual definition of a projective module as "lifts against surjections" is wrong when the module's universe is less than the ring's universe.</p>



<a name="205054904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054904">(Jul 26 2020 at 14:48)</a>:</h4>
<p>And also, what Kevin said earlier. In real math, even if the objects are not just sets, we can always move them into the same universe and work there, and this is what people do. If supporting extra universe generality in the formalization doesn't cause any headaches, then great, but if it does, then it's just not worth it to create actual extra math problems for yourself.</p>



<a name="205054914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054914">(Jul 26 2020 at 14:49)</a>:</h4>
<p>(Unless of course you're specifically interested in those problems, similarly to proving something constructively for its own sake.)</p>



<a name="205054970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205054970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205054970">(Jul 26 2020 at 14:50)</a>:</h4>
<p>Also it's worth noting that working with everything in the same universe is no loss of generality since you can always pick a universe large enough and then <code>ulift</code> everything. So moving to one-universe is just deferring the <code>ulift</code> to the application rather than the theory</p>



<a name="205055147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205055147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205055147">(Jul 26 2020 at 14:56)</a>:</h4>
<p>A valuation on a ring R is a pair(Gamma,v) where Gamma is a (certain kind of) monoid and v : R -&gt; Gamma is a map with some properties. We initially let Gamma be in a different universe to R. Let M(v) be the image of v; this is a submonoid. Two valuations v1 and v2 are _equivalent_ if there's an isomorphism M(v1)=M(v2) making the diagram commute. We only cared about valuations up to equivalence.</p>



<a name="205055298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205055298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205055298">(Jul 26 2020 at 15:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> why not define it as an "ordered congruence" on R?</p>



<a name="205055352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205055352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205055352">(Jul 26 2020 at 15:02)</a>:</h4>
<p>We wanted that the type of equivalence class of valuations on R lived in the same universe as R. This was problematic for two reasons. Firstly, we had let Gamma vary through all universes, and secondly, even if we restricted to one universe, the equivalence  classes bumped the universe level up by one. </p>
<p>We solved both of these problems at the same time and it might be difficult to see the wood from the trees. In the perfectoid project the relevant files are <code>valuation.basic</code> and <code>valuation_spectrum</code>. The bump-universe-by-one issue is solved using a binary relation on R, and the universe issue was solved by only considering valuations taking values in monoids living in the same universe as R, and then proving that if we had a valuation R -&gt; Gamma where Gamma was in some different universe to R, then there was an equivalent valuation taking values in some Gamma' in the same universe as R. We did this by using the first isomorphism theorem: R/equiv-coming-from-v is isomorphic to im(v), and R/equiv-coming-from-v lives in the same universe as R.</p>



<a name="205055354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205055354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205055354">(Jul 26 2020 at 15:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> this is what we did in the end, but this was not because of the universe issue we're talking about, this was for a different universe issue.</p>



<a name="205055878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205055878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205055878">(Jul 26 2020 at 15:18)</a>:</h4>
<p>My takeaway:</p>
<ol>
<li>We should avoid using different universes in our (concrete) theory development without loss of generality since the chosen universe could be a sufficiently large one as pointed out by <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> .</li>
<li>We could use different universes when PRing mathlib but we should follow rules pointed out by <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> , and if we encounter any headaches about universes we could use the specializing strategy suggested by <span class="user-mention" data-user-id="110032">@Reid Barton</span> and it should be good enough for most interesting math.</li>
<li>Using the same universe for the definitions doesn’t stop us from proving that the theorems work for different universes later as long as the math allows the constructs to be dragged into the same universe as done in perfectoid project by <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> et al.</li>
<li>The discussions above make a great library note worth PRing.</li>
</ol>



<a name="205056120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205056120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205056120">(Jul 26 2020 at 15:26)</a>:</h4>
<p>1 is good enough for justifying using the same universe. I was just curious about how it could be relaxed later after fixing the same universe in 3 and it’s now perfectly explained.</p>



<a name="205056621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205056621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205056621">(Jul 26 2020 at 15:41)</a>:</h4>
<p>(deleted)</p>



<a name="205057726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205057726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205057726">(Jul 26 2020 at 16:15)</a>:</h4>
<p>Concerning this specific construction--</p>
<p>When I  originally made the construction in the "universal" way, i.e. using the following relation:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">rel</span> <span class="o">:</span> <span class="o">(</span><span class="n">pre</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">pre</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">A</span><span class="o">),</span> <span class="k">by</span> <span class="n">letI</span> <span class="o">:=</span> <span class="n">h1</span><span class="bp">;</span> <span class="n">exact</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">),</span> <span class="k">by</span> <span class="n">letI</span> <span class="o">:=</span> <span class="n">h2</span><span class="bp">;</span> <span class="n">exact</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">A</span><span class="o">),</span>
  <span class="o">(</span><span class="n">lift_fun</span> <span class="n">R</span> <span class="n">M</span> <span class="n">f</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">lift_fun</span> <span class="n">R</span> <span class="n">M</span> <span class="n">f</span><span class="o">)</span> <span class="n">y</span>
</code></pre></div>


<p>I obtained a construction <code>tensor_algebra.{u1 u2 u3}</code> with three universe levels. The <code>u1</code> is the universe level of <code>R</code>, the <code>u2</code> is the one of <code>M</code> and the <code>u3</code> is the one of <code>A</code> appearing in the definition of <code>rel</code>. </p>
<p>But note that <code>tensor_algebra.{u1 u2 u3} R M : Type (max u1 u2)</code>.</p>
<p>The issue with this is that the universal property (which is true "by construction" in this case) could only be easily proved for <code>R</code>-algebras whose underlying type has universe level <code>u3</code>. So as Reid, Kevin, and others mentioned, one would have had to prove the existence of some isomorphism between these objects for varying <code>u3</code>, and in particular for <code>u3 = max u1 u2</code>. It seemed much easier to just change the definition of <code>rel</code> to what it is now in <a href="https://github.com/leanprover-community/mathlib/issues/3531">#3531</a></p>



<a name="205064233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205064233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205064233">(Jul 26 2020 at 19:30)</a>:</h4>
<p>Unrelated to your point, but... is the <code>by letI := ...; exact</code> a workaround for something I haven't run into yet?</p>



<a name="205064307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205064307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205064307">(Jul 26 2020 at 19:33)</a>:</h4>
<p>It's a trick that <span class="user-mention" data-user-id="112680">@Johan Commelin</span> told me about that lets you introduce instances in term mode.</p>



<a name="205064315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205064315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205064315">(Jul 26 2020 at 19:34)</a>:</h4>
<p>But it's not really term mode.</p>



<a name="205064420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205064420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205064420">(Jul 26 2020 at 19:37)</a>:</h4>
<p>There's some information about the <code>fooI</code> tactics <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#Instance%20cache%20tactics">here</a>.</p>



<a name="205064960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205064960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205064960">(Jul 26 2020 at 19:55)</a>:</h4>
<p>Does the following not work there to avoid needing <code>letI</code>?</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">rel</span> <span class="o">:</span> <span class="o">(</span><span class="n">pre</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">pre</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">A</span><span class="o">),</span>
  <span class="o">(</span><span class="n">lift_fun</span> <span class="n">R</span> <span class="n">M</span> <span class="n">f</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">lift_fun</span> <span class="n">R</span> <span class="n">M</span> <span class="n">f</span><span class="o">)</span> <span class="n">y</span>
</code></pre></div>



<a name="205065446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065446">(Jul 26 2020 at 20:08)</a>:</h4>
<p>This doesn't work.</p>



<a name="205065459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065459">(Jul 26 2020 at 20:09)</a>:</h4>
<p>The following emoji has been mentioned in relation to this: <span aria-label="four leaf clover" class="emoji emoji-1f340" role="img" title="four leaf clover">:four_leaf_clover:</span></p>



<a name="205065462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065462">(Jul 26 2020 at 20:09)</a>:</h4>
<p>You want <code>exactI</code>, not <code>letI</code> here</p>



<a name="205065504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065504">(Jul 26 2020 at 20:10)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">rel</span> <span class="o">:</span> <span class="o">(</span><span class="n">pre</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">pre</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">],</span> <span class="k">by</span> <span class="n">exactI</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">A</span><span class="o">),</span>
  <span class="o">(</span><span class="n">lift_fun</span> <span class="n">R</span> <span class="n">M</span> <span class="n">f</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">lift_fun</span> <span class="n">R</span> <span class="n">M</span> <span class="n">f</span><span class="o">)</span> <span class="n">y</span>
</code></pre></div>



<a name="205065513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065513">(Jul 26 2020 at 20:10)</a>:</h4>
<p>Oh nice!</p>



<a name="205065528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065528">(Jul 26 2020 at 20:11)</a>:</h4>
<p>So exactI just picks up all the instances in context?</p>



<a name="205065581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Deterministic%20timeout%20for%20class%20definition/near/205065581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Deterministic.20timeout.20for.20class.20definition.html#205065581">(Jul 26 2020 at 20:12)</a>:</h4>
<p>yep</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>