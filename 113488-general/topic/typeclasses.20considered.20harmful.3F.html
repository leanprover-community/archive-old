---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html">typeclasses considered harmful?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="263248677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263248677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263248677">(Dec 01 2021 at 06:11)</a>:</h4>
<p>hmm they're used extensively in mathlib... but I heard that if I use typeclasses a lot I will get... diamonds? well color me clueless I haven't used typeclasses before even though I know the syntax... hmm so what are diamonds? are they dangerous? how can I avoid them?</p>



<a name="263248696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263248696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263248696">(Dec 01 2021 at 06:12)</a>:</h4>
<p>in rust there are traits, they are similar to typeclasses in many ways but diamonds don't exist in rust</p>



<a name="263249217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263249217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263249217">(Dec 01 2021 at 06:21)</a>:</h4>
<p>There's a description of "the diamond problem" with an example on page 5: <a href="https://arxiv.org/abs/2001.04301">https://arxiv.org/abs/2001.04301</a></p>



<a name="263250036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263250036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263250036">(Dec 01 2021 at 06:35)</a>:</h4>
<p>I'm not sure if it's mentioned in that paper, but another flavor of the diamond problem is when through diamond inheritance you get conflicting definitions for things -- a subtle problem that affects theorem proving in contrast to normal software development is that the conflicting definitions might be equal but not <em>definitionally</em> equal.</p>
<p>I'm half-remembering a case involving algebraic structures and the natural numbers where the two operations were equal, but one inducted on the left argument and the other on the right.  <em>Edit:</em> I think it was this: <a href="https://github.com/leanprover-community/mathlib/commit/63801552184f2a519c95a45561300547837915cc">https://github.com/leanprover-community/mathlib/commit/63801552184f2a519c95a45561300547837915cc</a></p>



<a name="263250483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263250483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263250483">(Dec 01 2021 at 06:45)</a>:</h4>
<p>That's a good point. In Rust you can only have one implementation of a trait for a given type, so it doesn't matter which path you chase to get to the bottom of what looks like a diamond (I'm sure there's a counter-example for some <code>unsafe box dyn &amp;&amp;*FnOnce</code> something or other).</p>



<a name="263250492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263250492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263250492">(Dec 01 2021 at 06:45)</a>:</h4>
<p>Does <a href="https://leanprover-community.github.io/glossary.html#diamond">glossary#diamond</a> work? [edit: yes it does <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span>]</p>



<a name="263262419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263262419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263262419">(Dec 01 2021 at 09:20)</a>:</h4>
<p>So when someone reports that they have found a diamond, how does that manifest?  Something running much more slowly than it should?  Or Lean thinking there's a mismatch between things that appear to be identical?</p>



<a name="263262519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263262519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263262519">(Dec 01 2021 at 09:21)</a>:</h4>
<p>You will get goals of the form <code>foo = foo</code> that aren't provable by <code>rfl</code>.</p>



<a name="263262560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263262560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263262560">(Dec 01 2021 at 09:21)</a>:</h4>
<p>That's a typical example of how a diamond manifests</p>



<a name="263262735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263262735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263262735">(Dec 01 2021 at 09:23)</a>:</h4>
<p>Because secretly under the hood the goal is something like <code>@foo (bar.to_baz _inst_1) = @foo (quux.to_baz (bar.to_quux _inst_1))</code> and the two ways of getting <code>baz</code> from <code>bar</code> aren't definitionally equal.</p>



<a name="263262899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263262899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263262899">(Dec 01 2021 at 09:24)</a>:</h4>
<p>In the past I've seen Lean complain that some function expected argument <code>x</code> but was provided <code>x</code> (for some expression <code>x</code>).  Might that be a result of a diamond?</p>



<a name="263264246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclasses%20considered%20harmful%3F/near/263264246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclasses.20considered.20harmful.3F.html#263264246">(Dec 01 2021 at 09:38)</a>:</h4>
<p>Possibly</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>