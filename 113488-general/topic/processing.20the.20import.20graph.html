---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/processing.20the.20import.20graph.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html">processing the import graph</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="264264273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264264273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264264273">(Dec 09 2021 at 07:14)</a>:</h4>
<p>I think the graphviz output from leanproject produces a graph laid out in that way, but I think the result is far too cluttered to be interpretable.</p>



<a name="264264978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264264978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264264978">(Dec 09 2021 at 07:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Is.20a.20monolithic.20mathlib.20sustainable.3F/near/264264273">said</a>:</p>
<blockquote>
<p>I think the graphviz output from leanproject produces a graph laid out in that way, but I think the result is far too cluttered to be interpretable.</p>
</blockquote>
<p>I might know some tricks.  Can someone point me to the .dot file behind that graph?   Even better the tool that generates the dot graph so I can also run it on the Lean4 codebase?</p>



<a name="264265188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264265188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264265188">(Dec 09 2021 at 07:31)</a>:</h4>
<p>A raw and auto-updated gexf file is available at <a href="https://leanprover-community.github.io/mathlib_docs/import.gexf">https://leanprover-community.github.io/mathlib_docs/import.gexf</a></p>



<a name="264265260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264265260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264265260">(Dec 09 2021 at 07:32)</a>:</h4>
<p>I think <code>leanproject import-graph</code> can generate a .dot file, but it's very slow and it's easy and faster to generate one from the gexf</p>



<a name="264265392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264265392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264265392">(Dec 09 2021 at 07:34)</a>:</h4>
<p><span class="user-mention" data-user-id="434989">@Chris Lovett</span> <span class="user-mention" data-user-id="310045">@Eric Wieser</span> I changed this to a new topic, because I think it's interesting enough to deserve further discussion.</p>



<a name="264265413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264265413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264265413">(Dec 09 2021 at 07:35)</a>:</h4>
<p><span class="user-mention" data-user-id="434989">@Chris Lovett</span> I don't think that the existing tools will work directly on Lean 4 code.</p>



<a name="264265618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264265618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264265618">(Dec 09 2021 at 07:38)</a>:</h4>
<p>If you can generate a similar gexf file you can point the online import viewer at it and it will mostly work</p>



<a name="264267678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264267678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264267678">(Dec 09 2021 at 08:09)</a>:</h4>
<p>It seems what's asked by <span class="user-mention" data-user-id="434989">@Chris Lovett</span> is along the lines of this:</p>
<blockquote>
<p>The problem of order preserving hierarchical agglomerative clustering can be said to belong to the family of acyclic graph partitioning problems (Herrmann et al., 2017). If we consider the<br>
strict partial order to be a directed acyclic graph (DAG), the task is to partition the vertices into groups (levels?) so that the groups together with the arrows still makes up a DAG.</p>
</blockquote>
<p>From the paper <a href="https://arxiv.org/abs/2004.12488">https://arxiv.org/abs/2004.12488</a> that I just found</p>



<a name="264276338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264276338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264276338">(Dec 09 2021 at 09:39)</a>:</h4>
<p>Thanks for the link.  I did grouping by simply splitting the names on "." and ":" and made a hierarchical graph that also automatically creates links between parent groups if any child node in group A has a link to a child node in group B.  Then I run tarjans algorithm on the resulting top level <a href="https://github.com/clovett/dgml/tree/master/demos/Lean/mathlib/mathlib.svg">graph for mathlib</a>, and it is essentially one big strongly coupled component (very circular, everything is reachable from everything pretty much), see all the red in the diagram.  </p>
<p>So when this happens another trick is to "slice and dice" by throwing away detail - for example, I can take one node and focus down to it's immediate neighborhood ( only links 1 step away from that node), and break all circularity turning it into a tree, and I saved each of those with the name of that node, for example <a href="https://raw.githubusercontent.com/clovett/dgml/master/demos/Lean/mathlib/data.svg">data.svg</a> or <a href="https://raw.githubusercontent.com/clovett/dgml/master/demos/Lean/mathlib/group_theory.svg">group_theory</a>, from this we find there are some top level things like <a href="https://raw.githubusercontent.com/clovett/dgml/master/demos/Lean/mathlib/representation_theory.svg">representation_theory</a>  and there are some bottom level things like order, data, tactic and <a href="https://raw.githubusercontent.com/clovett/dgml/master/demos/Lean/mathlib/logic.svg">logic</a> but <a href="https://raw.githubusercontent.com/clovett/dgml/master/demos/Lean/mathlib/number_theory.svg">number_theory</a> kind of turns that upside down).  You can also drill down and expand each one of these areas and see what is <a href="https://raw.githubusercontent.com/clovett/dgml/master/demos/Lean/mathlib/inside.svg">inside.svg</a> and you find that set_theory has a pretty loverly internal structure... I also see some diamonds :-)</p>



<a name="264278659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264278659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264278659">(Dec 09 2021 at 10:01)</a>:</h4>
<p>That first graph looks like some Chinese dragon (-;</p>



<a name="264404606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264404606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264404606">(Dec 10 2021 at 05:22)</a>:</h4>
<p>Here's another view inside "tactic" namespace, while it is complex, unlike most of the other namespaces it does not have any cycles which means it has very nice top to bottom layering.<br>
<a href="/user_uploads/3121/dG6sUAOgppVFRAGk5ScDwXYq/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/dG6sUAOgppVFRAGk5ScDwXYq/image.png" title="image.png"><img src="/user_uploads/3121/dG6sUAOgppVFRAGk5ScDwXYq/image.png"></a></div>



<a name="264404817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264404817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264404817">(Dec 10 2021 at 05:26)</a>:</h4>
<p>Group theory on the other hand has a couple cycles in it:<br>
<a href="/user_uploads/3121/c5k-WXzIBEs_E_pQS_56k4ho/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/c5k-WXzIBEs_E_pQS_56k4ho/image.png" title="image.png"><img src="/user_uploads/3121/c5k-WXzIBEs_E_pQS_56k4ho/image.png"></a></div>



<a name="264404860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264404860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264404860">(Dec 10 2021 at 05:27)</a>:</h4>
<p>What I don't know is whether the "import" graph is the right one to be looking at... I mean I guess it should be interesting because it implies some sort of type dependencies across those imports otherwise they would not be there, assuming we've done proper garbage collection on unnecessary imports.</p>



<a name="264406573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264406573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264406573">(Dec 10 2021 at 06:00)</a>:</h4>
<p>You should be looking at files, not folders. All of the cycles in your graph are coming from folders</p>



<a name="264406695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/processing%20the%20import%20graph/near/264406695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/processing.20the.20import.20graph.html#264406695">(Dec 10 2021 at 06:02)</a>:</h4>
<p>In particular, folders represent "topical" hierarchy, while files respect dependency hierarchy. A given topic might need to be revisited several times with more and more dependencies, and any given mathematical topic has no upper bound on the dependencies it might need, so you are sure to get cycles if you merge all nodes within a folder</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>