---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/proof_by_contra.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html">proof_by_contra</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="256574908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256574908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256574908">(Oct 07 2021 at 13:14)</a>:</h4>
<p>I would very much like to have the following tactic in mathlib. But presumably this should be merged into <code>by_contra</code>, which is locked in core. And the behaviour of this tactic depends on <code>push_neg</code>, which is only available in mathlib. What is the best way forward?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>

<span class="sd">/-- Turns a goal `P` into `¬¬P`, and uses `push_neg` to simplify the inner `¬P`. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">proof_by_contra</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[</span> <span class="n">by_contra</span> <span class="n">proof_by_contra_hyp</span><span class="o">,</span>
   <span class="n">try</span> <span class="o">{</span> <span class="n">push_neg</span> <span class="n">at</span> <span class="n">proof_by_contra_hyp</span> <span class="o">},</span>
   <span class="n">revert</span> <span class="n">proof_by_contra_hyp</span><span class="o">,</span>
   <span class="k">show</span> <span class="bp">¬</span> <span class="n">_</span> <span class="o">]</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">P</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">proof_by_contra</span><span class="o">,</span> <span class="c1">-- `¬¬P`</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">interactive</span>
<span class="kd">end</span> <span class="n">tactic</span>
</code></pre></div>



<a name="256575166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256575166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256575166">(Oct 07 2021 at 13:16)</a>:</h4>
<blockquote>
<p>But presumably this should be merged into by_contra</p>
</blockquote>
<p>It does something different than by_contra, so I don't think they should be merged.</p>



<a name="256577127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577127">(Oct 07 2021 at 13:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> I think this would be reasonable behaviour for <code>by_contra</code> if it doesn't get a new id for the hypothesis.</p>



<a name="256577154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577154">(Oct 07 2021 at 13:29)</a>:</h4>
<p>Or maybe <code>by_contra!</code>.</p>



<a name="256577172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577172">(Oct 07 2021 at 13:29)</a>:</h4>
<p>The push_neg is pretty mathlib-specific though.</p>



<a name="256577498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577498">(Oct 07 2021 at 13:31)</a>:</h4>
<p>Note that your tactic is a no-op for:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">P</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">proof_by_contra</span><span class="o">,</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>which is probably not what you want</p>



<a name="256577612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577612">(Oct 07 2021 at 13:32)</a>:</h4>
<p>I think it <em>is</em> what I want.</p>



<a name="256577653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577653">(Oct 07 2021 at 13:32)</a>:</h4>
<p>Aren't no-op tactics frowned upon?</p>



<a name="256577673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577673">(Oct 07 2021 at 13:32)</a>:</h4>
<p>eg <code>simp</code> fails by default if it does nothing</p>



<a name="256577683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577683">(Oct 07 2021 at 13:32)</a>:</h4>
<p>You mean that it should fail instead?</p>



<a name="256577688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577688">(Oct 07 2021 at 13:32)</a>:</h4>
<p>Yes</p>



<a name="256577701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577701">(Oct 07 2021 at 13:32)</a>:</h4>
<p>Aha... I don't know how to do that.</p>



<a name="256577733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577733">(Oct 07 2021 at 13:32)</a>:</h4>
<p>I'm a cargo-tactic-writer</p>



<a name="256577767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256577767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256577767">(Oct 07 2021 at 13:33)</a>:</h4>
<p>Probably you shouldn't inherit the <code>intro</code> behavior from <code>by_contra</code></p>



<a name="256579272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256579272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256579272">(Oct 07 2021 at 13:43)</a>:</h4>
<p>I just want support for writing</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="n">n</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">proof_by_contra</span><span class="o">,</span>
    <span class="k">assume</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">,</span>
</code></pre></div>



<a name="256579402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256579402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256579402">(Oct 07 2021 at 13:44)</a>:</h4>
<p>I don't care too much about what <code>proof_by_contra</code> is called, as long as it is more readable than <code>apply lt_of_not_ge</code>.</p>



<a name="256579455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256579455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256579455">(Oct 07 2021 at 13:45)</a>:</h4>
<p>Every random stranger understands what <code>proof_by_contra</code> does. But <code>lt_of_not_ge</code> is hieroglyphic.</p>



<a name="256579486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256579486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256579486">(Oct 07 2021 at 13:45)</a>:</h4>
<p>Just to comment that I'm extensively using <code>by_contra</code> as it stands in a lecture I'm about to give and also in my undergraduate teaching this term. It's a great way of introducing classical logic to mathematicians without going on about constructivism</p>



<a name="256579563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256579563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256579563">(Oct 07 2021 at 13:45)</a>:</h4>
<p><code>by_contra</code> is nice, except for the lack of automatic tidying up using <code>push_neg</code>.</p>



<a name="256579797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256579797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256579797">(Oct 07 2021 at 13:47)</a>:</h4>
<p>You don't always want to use <code>push_neg</code> next though</p>



<a name="256580032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580032">(Oct 07 2021 at 13:49)</a>:</h4>
<p>Why not?</p>



<a name="256580117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580117">(Oct 07 2021 at 13:49)</a>:</h4>
<p>A proof that doesn't name any Prop-assumptions or library lemmas:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">euclid</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="n">n</span><span class="o">,</span> <span class="n">p.prime</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">N</span> <span class="o">:=</span> <span class="n">n</span><span class="bp">!</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">p</span> <span class="o">:=</span> <span class="n">nat.min_fac</span> <span class="n">N</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">n</span><span class="bp">!</span> <span class="bp">&gt;</span> <span class="mi">0</span>    <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">N</span> <span class="bp">&gt;</span> <span class="mi">1</span>     <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">N</span> <span class="bp">≠</span> <span class="mi">1</span>     <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">p.prime</span>   <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="n">n</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">proof_by_contra</span><span class="o">,</span>
    <span class="k">assume</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="mi">0</span>   <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∣</span> <span class="n">n</span><span class="bp">!</span>  <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∣</span> <span class="n">N</span>   <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∣</span> <span class="mi">1</span>   <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">p</span> <span class="bp">∣</span> <span class="mi">1</span>  <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span><span class="o">,</span>
    <span class="n">contradiction</span> <span class="o">},</span>
  <span class="n">finish</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="256580363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580363">(Oct 07 2021 at 13:51)</a>:</h4>
<p>It's a bit long-winded. But this proof is readable by someone who has never read Lean before. I like that it doesn't contain any library lemmas.</p>



<a name="256580614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580614">(Oct 07 2021 at 13:52)</a>:</h4>
<p>That's pretty nice!</p>



<a name="256580624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580624">(Oct 07 2021 at 13:52)</a>:</h4>
<p>Impressive!</p>



<a name="256580626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580626">(Oct 07 2021 at 13:52)</a>:</h4>
<p>Can I use it in my talk?</p>



<a name="256580687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580687">(Oct 07 2021 at 13:53)</a>:</h4>
<p>But doesn't it set your CPU on fire?</p>



<a name="256580877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580877">(Oct 07 2021 at 13:54)</a>:</h4>
<p>Unfortunately you can't use</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">by</span> <span class="n">library_search</span> <span class="n">using</span> <span class="o">[‹</span><span class="n">p</span> <span class="bp">∣</span> <span class="n">n</span><span class="bp">!</span><span class="o">›]</span>
</code></pre></div>



<a name="256580933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580933">(Oct 07 2021 at 13:54)</a>:</h4>
<p>What imports does that example need?</p>



<a name="256580969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580969">(Oct 07 2021 at 13:54)</a>:</h4>
<p>The problem with <code>library_search</code> is that it only works with the right imports, and without them you have no idea what you need to import!</p>



<a name="256580994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256580994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256580994">(Oct 07 2021 at 13:54)</a>:</h4>
<p>Preamble:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.prime</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>

<span class="sd">/-- Turns a goal `P` into `¬¬P`, and uses `push_neg` to simplify the inner `¬P`. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">proof_by_contra</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[</span> <span class="n">by_contra</span> <span class="n">proof_by_contra_hyp</span><span class="o">,</span>
   <span class="n">try</span> <span class="o">{</span> <span class="n">push_neg</span> <span class="n">at</span> <span class="n">proof_by_contra_hyp</span> <span class="o">},</span>
   <span class="n">revert</span> <span class="n">proof_by_contra_hyp</span><span class="o">,</span>
   <span class="k">show</span> <span class="bp">¬</span> <span class="n">_</span> <span class="o">]</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">P</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">proof_by_contra</span><span class="o">,</span> <span class="c1">-- `¬¬P`</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">interactive</span>
<span class="kd">end</span> <span class="n">tactic</span>

<span class="n">open_locale</span> <span class="n">nat</span> <span class="c1">-- enable `!` as notation for factorial</span>
</code></pre></div>



<a name="256587267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256587267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256587267">(Oct 07 2021 at 14:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/proof_by_contra/near/256579272">said</a>:</p>
<blockquote>
<p>I just want support for writing</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">have</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">&gt;</span> <span class="n">n</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">proof_by_contra</span><span class="o">,</span>
    <span class="k">assume</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">,</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I don't like that the proposed version of the tactic introduces a negation for no reason. If this is the kind of proof you want to do, why not make it <code>proof_by_contra h? : p ≤ n</code>, i.e. the same style as <code>by_contra</code>?</p>



<a name="256587520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256587520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256587520">(Oct 07 2021 at 14:34)</a>:</h4>
<p>Mario, this is all due to the fact that I don't know how to properly write tactics.</p>



<a name="256587718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256587718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256587718">(Oct 07 2021 at 14:35)</a>:</h4>
<p>So, if I can write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">proof_by_contra</span><span class="o">,</span>
<span class="k">assume</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">,</span>
</code></pre></div>
<p>with a different implementation under the hood, then I certainly wont complain.</p>



<a name="256588367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256588367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256588367">(Oct 07 2021 at 14:38)</a>:</h4>
<p><code>proof_by_contra : p ≤ n</code> reads slightly weird. It's missing the <code>assume</code> verb.</p>



<a name="256588678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256588678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256588678">(Oct 07 2021 at 14:40)</a>:</h4>
<p>well then change the name of the tactic</p>



<a name="256588706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256588706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256588706">(Oct 07 2021 at 14:40)</a>:</h4>
<p>e.g. <code>assume_by_contra</code></p>



<a name="256588796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256588796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256588796">(Oct 07 2021 at 14:41)</a>:</h4>
<p>The existing <code>by_contra</code> has no <code>assume</code> in the name, though</p>



<a name="256588905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256588905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256588905">(Oct 07 2021 at 14:42)</a>:</h4>
<p>I think that it can also be merged into <code>by_contra</code> in this form; the only addition here is that we are explicitly type ascribing the hypothesis</p>



<a name="256589030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589030">(Oct 07 2021 at 14:42)</a>:</h4>
<p>and we use some <code>simpa</code> call involving push neg stuff to make the type match</p>



<a name="256589154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589154">(Oct 07 2021 at 14:43)</a>:</h4>
<p>Am I right in thinking the main advantages of <span class="user-mention" data-user-id="112680">@Johan Commelin</span>'s spelling:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">proof_by_contra</span><span class="o">,</span>
<span class="k">assume</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">,</span>
</code></pre></div>
<p>over</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">by_contra</span>
<span class="n">push_neg</span> <span class="n">at</span> <span class="n">h</span>
</code></pre></div>
<p>is that the former doesn't name the hypothesis and does show the type?</p>



<a name="256589299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589299">(Oct 07 2021 at 14:44)</a>:</h4>
<p>It also doesn't name <code>push_neg</code>. Which is an operation that should be performed "behind the scenes" whenever possible.</p>



<a name="256589308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589308">(Oct 07 2021 at 14:44)</a>:</h4>
<p>they both name the hypothesis</p>



<a name="256589322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589322">(Oct 07 2021 at 14:44)</a>:</h4>
<p>the first one names it <code>this</code></p>



<a name="256589357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589357">(Oct 07 2021 at 14:44)</a>:</h4>
<p>Eric means that the proof script doesn't name (i.e., mention explicitly) it.</p>



<a name="256589399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589399">(Oct 07 2021 at 14:45)</a>:</h4>
<p>Doesn't <code>by_contra</code> have a <code>!</code> version that calls <code>push_neg</code>?</p>



<a name="256589435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589435">(Oct 07 2021 at 14:45)</a>:</h4>
<p><code>by_contra</code> is in core, right?</p>



<a name="256589456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589456">(Oct 07 2021 at 14:45)</a>:</h4>
<p>I'd certainly be in favor of changing <code>by_contra</code> to accept an optional type annotation</p>



<a name="256589474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589474">(Oct 07 2021 at 14:45)</a>:</h4>
<p>Yes, it is; I changed it very recently</p>



<a name="256589510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589510">(Oct 07 2021 at 14:45)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#by_contra">tactic#by_contra</a> to give you the breadcrumb to find it</p>



<a name="256589637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589637">(Oct 07 2021 at 14:46)</a>:</h4>
<p>I could have sworn we had some souped up version of <code>by_contra</code> in mathlib</p>



<a name="256589648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589648">(Oct 07 2021 at 14:46)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/a0fb1e8c7ac81dfd2e80ad0de08f4e57ee853d82/library/init/meta/interactive.lean#L1624-L1638">https://github.com/leanprover-community/lean/blob/a0fb1e8c7ac81dfd2e80ad0de08f4e57ee853d82/library/init/meta/interactive.lean#L1624-L1638</a> is the parser</p>



<a name="256589734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589734">(Oct 07 2021 at 14:46)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/a0fb1e8c7ac81dfd2e80ad0de08f4e57ee853d82/library/init/meta/tactic.lean#L1481-L1487">https://github.com/leanprover-community/lean/blob/a0fb1e8c7ac81dfd2e80ad0de08f4e57ee853d82/library/init/meta/tactic.lean#L1481-L1487</a> is the tactic itself</p>



<a name="256589805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589805">(Oct 07 2021 at 14:47)</a>:</h4>
<p>ah, there is <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#contrapose">tactic#contrapose</a></p>



<a name="256589877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589877">(Oct 07 2021 at 14:47)</a>:</h4>
<p>I would be in favour of having <code>assume_by_contra</code> which also calls <code>push_neg</code> on the new hyp.</p>



<a name="256589889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256589889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256589889">(Oct 07 2021 at 14:47)</a>:</h4>
<p>I think it would make sense  to have a <code>push_neg</code> powered <code>by_contra</code></p>



<a name="256590024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590024">(Oct 07 2021 at 14:48)</a>:</h4>
<p>would it be too tricky to remove <code>by_contra</code> and just have <code>by_contradiction</code> in core?</p>



<a name="256590078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590078">(Oct 07 2021 at 14:48)</a>:</h4>
<p>It might break projects that don't use mathlib?</p>



<a name="256590111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590111">(Oct 07 2021 at 14:48)</a>:</h4>
<p>fair</p>



<a name="256590144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590144">(Oct 07 2021 at 14:49)</a>:</h4>
<p>I'm guessing it's not possible to have <code>by_contra</code> in core and <code>by_contra!</code> in mathlib?</p>



<a name="256590169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590169">(Oct 07 2021 at 14:49)</a>:</h4>
<p>Otoh, such project might not be using a recent Lean anyways.</p>



<a name="256590185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590185">(Oct 07 2021 at 14:49)</a>:</h4>
<p>there is always the old standby of <code>by_contra'</code></p>



<a name="256590189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590189">(Oct 07 2021 at 14:49)</a>:</h4>
<p>We never got complaints when we ripped algebra out of core.</p>



<a name="256590192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590192">(Oct 07 2021 at 14:49)</a>:</h4>
<p>Can we use replacement hooks like <code>obviously</code> does, and have the default for <code>by_contra!</code> to just print "sorry, needs mathlib"</p>



<a name="256590231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590231">(Oct 07 2021 at 14:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/proof_by_contra/near/256590185">said</a>:</p>
<blockquote>
<p>there is always the old standby of <code>by_contra'</code></p>
</blockquote>
<p>which is ugly. My goal is to have a way to write really slick proofs.</p>



<a name="256590352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590352">(Oct 07 2021 at 14:50)</a>:</h4>
<p><code>by_con</code>?</p>



<a name="256590401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590401">(Oct 07 2021 at 14:50)</a>:</h4>
<p>I don't think people will immediately understand that either.</p>



<a name="256590481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590481">(Oct 07 2021 at 14:51)</a>:</h4>
<p>The point is, when you write a proof that will be printed, there cannot be any mouse-over hover-texts, and there will be no goal state or infoview.</p>



<a name="256590542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590542">(Oct 07 2021 at 14:51)</a>:</h4>
<p>I think for demo purposes you can set up your own veneer over mathlib tactics, so they aren't intrinsically related</p>



<a name="256590630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590630">(Oct 07 2021 at 14:52)</a>:</h4>
<p>That's fair. And that's what I'm doing now.</p>



<a name="256590632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590632">(Oct 07 2021 at 14:52)</a>:</h4>
<p>like Patrick's "french mode"</p>



<a name="256590675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590675">(Oct 07 2021 at 14:52)</a>:</h4>
<p>Still, I would like to stay very close to mathlib.</p>



<a name="256590736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256590736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256590736">(Oct 07 2021 at 14:52)</a>:</h4>
<p>Ideally, someone should be able to go to the online editor, and type in my proof.</p>



<a name="256591072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256591072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256591072">(Oct 07 2021 at 14:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/proof_by_contra/near/256590736">said</a>:</p>
<blockquote>
<p>Ideally, someone should be able to go to the online editor, and type in my proof.</p>
</blockquote>
<p>I had complaints from a reviewer that attempts to copy my proof from a PDF version didn't work... So sharing a URL with <code>.lean</code> files might be more reasonable.</p>



<a name="256592471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256592471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256592471">(Oct 07 2021 at 15:01)</a>:</h4>
<p>That's a good idea.</p>



<a name="256592615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256592615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256592615">(Oct 07 2021 at 15:02)</a>:</h4>
<p>Especially since <code>∣</code> ≠ <code>|</code> which will certainly trip up hand-copying of proofs.</p>



<a name="256592830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256592830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256592830">(Oct 07 2021 at 15:03)</a>:</h4>
<p>In that case, can someone tell me how to write a <code>observe : some_prop</code> tactic that does</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:</span> <span class="n">some_prop</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>



<a name="256592954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256592954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256592954">(Oct 07 2021 at 15:04)</a>:</h4>
<p>I can then put <code>proof_by_contra</code> and <code>observe</code> in a prereq file that I import.</p>



<a name="256598946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256598946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256598946">(Oct 07 2021 at 15:37)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.push_neg</span>
<span class="kn">import</span> <span class="n">tactic.suggest</span>
<span class="kn">import</span> <span class="n">data.nat.prime</span>

<span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>
<span class="n">setup_tactic_parser</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">assume_by_contra</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="bp">?</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">parse</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">":"</span> <span class="bp">*&gt;</span> <span class="n">texpr</span><span class="o">)</span><span class="bp">?</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">h.get_or_else</span> <span class="bp">`</span><span class="n">this</span><span class="o">,</span>
  <span class="n">applyc</span> <span class="bp">``</span><span class="n">classical.by_contradiction</span><span class="o">,</span>
  <span class="n">h₁</span> <span class="bp">←</span> <span class="n">tactic.intro</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">t'</span> <span class="bp">←</span> <span class="n">infer_type</span> <span class="n">h₁</span><span class="o">,</span>
  <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">pr</span><span class="o">)</span> <span class="bp">←</span> <span class="n">push_neg.normalize_negations</span> <span class="n">t'</span> <span class="bp">&lt;|&gt;</span> <span class="n">refl_conv</span> <span class="n">t'</span><span class="o">,</span>
  <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">none</span> <span class="o">:=</span> <span class="o">()</span> <span class="bp">&lt;$</span> <span class="n">replace_hyp</span> <span class="n">h₁</span> <span class="n">e</span> <span class="n">pr</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">t</span> <span class="o">:=</span> <span class="k">do</span>
    <span class="n">t</span> <span class="bp">←</span> <span class="n">to_expr</span> <span class="bp">``</span><span class="o">(</span><span class="bp">%%</span><span class="n">t</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">),</span>
    <span class="n">unify</span> <span class="n">t</span> <span class="n">e</span><span class="o">,</span>
    <span class="o">()</span> <span class="bp">&lt;$</span> <span class="n">replace_hyp</span> <span class="n">h₁</span> <span class="n">t</span> <span class="n">pr</span>
  <span class="kd">end</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">observe</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="bp">?</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">parse</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">":"</span> <span class="bp">*&gt;</span> <span class="n">texpr</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">h.get_or_else</span> <span class="bp">`</span><span class="n">this</span><span class="o">,</span>
  <span class="n">t</span> <span class="bp">←</span> <span class="n">to_expr</span> <span class="bp">``</span><span class="o">(</span><span class="bp">%%</span><span class="n">t</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">),</span>
  <span class="n">assert</span> <span class="n">h</span> <span class="n">t</span><span class="o">,</span>
  <span class="c1">-- `[{library_search}]</span>
  <span class="n">solve1</span> <span class="bp">$</span> <span class="k">do</span>
    <span class="o">(</span><span class="n">lemma_thunks</span><span class="o">,</span> <span class="n">ctx_thunk</span><span class="o">)</span> <span class="bp">←</span> <span class="n">solve_by_elim.mk_assumption_set</span> <span class="n">ff</span> <span class="o">[]</span> <span class="o">[],</span>
    <span class="o">(()</span> <span class="bp">&lt;$</span> <span class="n">tactic.library_search</span>
      <span class="o">{</span> <span class="n">backtrack_all_goals</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">,</span>
        <span class="n">lemma_thunks</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">lemma_thunks</span><span class="o">,</span>
        <span class="n">ctx_thunk</span> <span class="o">:=</span> <span class="n">ctx_thunk</span><span class="o">,</span>
        <span class="n">md</span> <span class="o">:=</span> <span class="n">tactic.transparency.reducible</span> <span class="o">})</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="s2">"observe failed"</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">assume_by_contra</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">observe</span> <span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="256599187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599187">(Oct 07 2021 at 15:39)</a>:</h4>
<p>it was harder than it should have been because the porcelain tactics forgot to expose the plumbing version, so I had to copy and paste bits of the implementation of <code>push_neg</code> and <code>library_search</code> respectively</p>



<a name="256599240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599240">(Oct 07 2021 at 15:39)</a>:</h4>
<p>I had done</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">def</span> <span class="n">observe</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="bp">?</span><span class="o">)</span> <span class="o">(</span><span class="n">q₁</span> <span class="o">:</span> <span class="n">parse</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">":"</span> <span class="bp">*&gt;</span> <span class="n">texpr</span><span class="o">)</span><span class="bp">?</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">«</span><span class="k">have</span><span class="bp">»</span> <span class="n">h</span> <span class="n">q₁</span> <span class="n">none</span> <span class="bp">&gt;&gt;</span>
<span class="n">tactic.focus1</span> <span class="o">(</span><span class="n">tactic.library_search</span> <span class="o">{</span> <span class="n">backtrack_all_goals</span> <span class="o">:=</span> <span class="n">tt</span> <span class="o">}</span> <span class="bp">&gt;&gt;=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">skip</span><span class="o">))</span>
</code></pre></div>



<a name="256599290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599290">(Oct 07 2021 at 15:39)</a>:</h4>
<p><code>library_search</code> should really have an option to turn off the trace in <code>opt</code></p>



<a name="256599456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599456">(Oct 07 2021 at 15:40)</a>:</h4>
<p>You probably don't want the type arg of <code>observe</code> to be optional</p>



<a name="256599524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599524">(Oct 07 2021 at 15:41)</a>:</h4>
<p>I guess so <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="256599621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599621">(Oct 07 2021 at 15:41)</a>:</h4>
<p>I'm not really sure what the <code>mk_assumption_set</code> is doing, but <code>library_search</code> was doing that so I copied it</p>



<a name="256599969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256599969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256599969">(Oct 07 2021 at 15:43)</a>:</h4>
<p>ah, you do want that stuff, it adds some default lemmas like <code>rfl, trivial, congr_arg</code> to the simp set</p>



<a name="256604220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256604220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256604220">(Oct 07 2021 at 16:08)</a>:</h4>
<p>Thanks for your help, Mario!</p>



<a name="256604515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256604515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256604515">(Oct 07 2021 at 16:10)</a>:</h4>
<p>I'm a bit late to the party but I obviously support the idea of having a version of <code>by_contra</code> that uses <code>push_neg</code> (I wrote both <code>push_neg</code> and <code>contrapose</code>). I think we already had this conversation before and the fact that <code>by_contra</code> is in core is the only obstruction (we can't simply add the exclamation mark version in mathlib)</p>



<a name="256604626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256604626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256604626">(Oct 07 2021 at 16:10)</a>:</h4>
<p>I very frequently wish I could have this improved <code>by_contra</code> even outside of propaganda talks</p>



<a name="256605643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256605643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256605643">(Oct 07 2021 at 16:16)</a>:</h4>
<p>I think that we should just do <code>by_contra'</code>. We already have several tactics like that, they are basically TODOs for lean 4</p>



<a name="256611271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256611271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256611271">(Oct 07 2021 at 16:51)</a>:</h4>
<blockquote>
<p>(we can't simply add the exclamation mark version in mathlib)</p>
</blockquote>
<p>To be pedantic, you can:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">reserve</span> <span class="kd">notation</span> <span class="bp">`</span><span class="n">by_contra</span><span class="bp">!`</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">tactic.interactive.</span><span class="bp">«</span><span class="n">by_contra</span><span class="bp">!»</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">tactic.fail</span> <span class="s2">"todo"</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">by_contra</span><span class="bp">!</span>
</code></pre></div>
<p>PRs are of course also welcome, but Lean 4 is on the horizon.</p>



<a name="256654471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256654471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256654471">(Oct 07 2021 at 21:40)</a>:</h4>
<p>Just to add that "have p&gt;n, by contra, assume p&lt;=n" is pretty much exactly what a mathematician would write on a blackboard -- that's what Johan's idea has going for it</p>



<a name="256654900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256654900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256654900">(Oct 07 2021 at 21:44)</a>:</h4>
<p>I really like <code>observe</code> too</p>



<a name="256682364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256682364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256682364">(Oct 08 2021 at 03:14)</a>:</h4>
<p>I would love to have a <code>by_cases!</code> too, or even something that does</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:=</span> <span class="n">em</span> <span class="n">p</span><span class="o">,</span>
<span class="n">push_neg</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
<span class="n">rcases</span> <span class="n">this</span> <span class="k">with</span> <span class="o">(</span><span class="bp">...|...</span><span class="o">),</span>
</code></pre></div>



<a name="256682404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256682404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256682404">(Oct 08 2021 at 03:15)</a>:</h4>
<p>This is useful, e.g., when I want to say: either <code>∀ x, f x ≤ g x</code>, or <code>∃ x, g x &lt; f x</code>.</p>



<a name="256683299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256683299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256683299">(Oct 08 2021 at 03:30)</a>:</h4>
<p>Never See a Negation Again (TM)</p>



<a name="256694198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256694198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256694198">(Oct 08 2021 at 06:21)</a>:</h4>
<p>Classical mathematicians don't take them seriously :-)</p>



<a name="256695041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256695041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256695041">(Oct 08 2021 at 06:33)</a>:</h4>
<p>I personally became quite fluent in using <code>has_le.le.eq_or_lt</code>, <code>ne.lt_or_lt</code>, <code>lt_trichotomy</code> to optimize my case disjunctions, and I've been shortening quite a few existing proofs that doing <code>by_cases</code> then rewriting to what they actually wanted to end up with.</p>



<a name="256703014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256703014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256703014">(Oct 08 2021 at 08:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> do you want to PR your <code>assume_by_contra</code> as <code>by_contra'</code>? Or would you mind if I do that?</p>



<a name="256703038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256703038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256703038">(Oct 08 2021 at 08:05)</a>:</h4>
<p>go ahead</p>



<a name="256703835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256703835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256703835">(Oct 08 2021 at 08:13)</a>:</h4>
<p>I feel like the following doesn't really belong in <code>tactic.norm_num</code>. Which file should it move to?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Reflexivity conversion: given `e` returns `(e, ⊢ e = e)` -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">refl_conv</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">do</span> <span class="n">p</span> <span class="bp">←</span> <span class="n">mk_eq_refl</span> <span class="n">e</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span>

<span class="sd">/-- Turns a conversion tactic into one that always succeeds, where failure is interpreted as a</span>
<span class="sd">proof by reflexivity. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">or_refl_conv</span> <span class="o">(</span><span class="n">tac</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">))</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:=</span> <span class="n">tac</span> <span class="n">e</span> <span class="bp">&lt;|&gt;</span> <span class="n">refl_conv</span> <span class="n">e</span>

<span class="sd">/-- Transitivity conversion: given two conversions (which take an</span>
<span class="sd">expression `e` and returns `(e', ⊢ e = e')`), produces another</span>
<span class="sd">conversion that combines them with transitivity, treating failures</span>
<span class="sd">as reflexivity conversions. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">trans_conv</span> <span class="o">(</span><span class="n">t₁</span> <span class="n">t₂</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">))</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">tactic</span> <span class="o">(</span><span class="n">expr</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="k">do</span> <span class="o">(</span><span class="n">e₁</span><span class="o">,</span> <span class="n">p₁</span><span class="o">)</span> <span class="bp">←</span> <span class="n">t₁</span> <span class="n">e</span><span class="o">,</span>
  <span class="o">(</span><span class="k">do</span> <span class="o">(</span><span class="n">e₂</span><span class="o">,</span> <span class="n">p₂</span><span class="o">)</span> <span class="bp">←</span> <span class="n">t₂</span> <span class="n">e₁</span><span class="o">,</span>
    <span class="n">p</span> <span class="bp">←</span> <span class="n">mk_eq_trans</span> <span class="n">p₁</span> <span class="n">p₂</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">e₂</span><span class="o">,</span> <span class="n">p</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span>
  <span class="n">return</span> <span class="o">(</span><span class="n">e₁</span><span class="o">,</span> <span class="n">p₁</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span> <span class="n">t₂</span> <span class="n">e</span>
</code></pre></div>



<a name="256703903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256703903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256703903">(Oct 08 2021 at 08:14)</a>:</h4>
<p>If nowhere else fits, I guess <code>tactic/basic.lean</code>?</p>



<a name="256704746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256704746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256704746">(Oct 08 2021 at 08:21)</a>:</h4>
<p>That's just a long list of imports.</p>



<a name="256704852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256704852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256704852">(Oct 08 2021 at 08:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Can we soup up <code>by_contra' h : t</code>, so that <code>t</code> is equal to <code>\not goal</code> modulo <code>push_neg</code>?</p>



<a name="256704945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256704945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256704945">(Oct 08 2021 at 08:23)</a>:</h4>
<p>In other words, <code>t</code> doesn't have to be equal to the result of <code>push_neg(\not goal)</code>. But <code>push_neg(t)</code> should be.</p>



<a name="256708659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256708659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256708659">(Oct 08 2021 at 08:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Does this look right?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">def</span> <span class="n">by_contra'</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">ident</span><span class="bp">?</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">parse</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">":"</span> <span class="bp">*&gt;</span> <span class="n">texpr</span><span class="o">)</span><span class="bp">?</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">h.get_or_else</span> <span class="bp">`</span><span class="n">this</span><span class="o">,</span>
  <span class="n">applyc</span> <span class="bp">``</span><span class="n">classical.by_contradiction</span><span class="o">,</span>
  <span class="n">h₁</span> <span class="bp">←</span> <span class="n">tactic.intro</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">t'</span> <span class="bp">←</span> <span class="n">infer_type</span> <span class="n">h₁</span><span class="o">,</span>
  <span class="o">(</span><span class="n">e'</span><span class="o">,</span> <span class="n">pr'</span><span class="o">)</span> <span class="bp">←</span> <span class="n">push_neg.normalize_negations</span> <span class="n">t'</span> <span class="bp">&lt;|&gt;</span> <span class="n">refl_conv</span> <span class="n">t'</span><span class="o">,</span>
  <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">none</span> <span class="o">:=</span> <span class="o">()</span> <span class="bp">&lt;$</span> <span class="n">replace_hyp</span> <span class="n">h₁</span> <span class="n">e'</span> <span class="n">pr'</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">t</span> <span class="o">:=</span> <span class="k">do</span>
    <span class="n">t</span> <span class="bp">←</span> <span class="n">to_expr</span> <span class="bp">``</span><span class="o">(</span><span class="bp">%%</span><span class="n">t</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">),</span>
    <span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">pr</span><span class="o">)</span> <span class="bp">←</span> <span class="n">push_neg.normalize_negations</span> <span class="n">t</span> <span class="bp">&lt;|&gt;</span> <span class="n">refl_conv</span> <span class="n">t</span><span class="o">,</span>
    <span class="n">unify</span> <span class="n">e</span> <span class="n">e'</span><span class="o">,</span>
    <span class="o">()</span> <span class="bp">&lt;$</span> <span class="n">replace_hyp</span> <span class="n">h₁</span> <span class="n">e</span> <span class="bp">`</span><span class="o">(</span><span class="bp">@</span><span class="n">eq.trans</span> <span class="kt">Prop</span> <span class="bp">%%</span><span class="n">t'</span> <span class="bp">%%</span><span class="n">e</span> <span class="bp">%%</span><span class="n">t</span> <span class="bp">%%</span><span class="n">pr'</span> <span class="o">(</span><span class="n">eq.symm</span> <span class="bp">%%</span><span class="n">pr</span><span class="o">))</span>
  <span class="kd">end</span>
</code></pre></div>



<a name="256708778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256708778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256708778">(Oct 08 2021 at 08:56)</a>:</h4>
<p>you can use <code>mk_eq_trans</code> toward the end there</p>



<a name="256708807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256708807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256708807">(Oct 08 2021 at 08:57)</a>:</h4>
<p>see <code>trans_conv</code> above for inspiration</p>



<a name="256709301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256709301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256709301">(Oct 08 2021 at 09:01)</a>:</h4>
<p>Like so?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="n">p_aux</span> <span class="bp">←</span> <span class="n">mk_eq_symm</span> <span class="n">pr</span><span class="o">,</span>
    <span class="n">p</span> <span class="bp">←</span> <span class="n">mk_eq_trans</span> <span class="n">pr'</span> <span class="n">p_aux</span><span class="o">,</span>
    <span class="o">()</span> <span class="bp">&lt;$</span> <span class="n">replace_hyp</span> <span class="n">h₁</span> <span class="n">e</span> <span class="n">p</span>
</code></pre></div>



<a name="256709427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256709427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256709427">(Oct 08 2021 at 09:02)</a>:</h4>
<p>the cool kids write <code>mk_eq_symm pr &gt;&gt;= mk_eq_trans pr' &gt;&gt;= replace_hyp h₁ e</code> :D</p>



<a name="256709629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256709629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256709629">(Oct 08 2021 at 09:04)</a>:</h4>
<p>gotcha</p>



<a name="256709663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256709663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256709663">(Oct 08 2021 at 09:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> do you agree if I move those <code>refl_conv</code> things to <code>tactic/core.lean</code>?</p>



<a name="256709693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256709693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256709693">(Oct 08 2021 at 09:04)</a>:</h4>
<p>yes, go ahead. You are right that they are misplaced</p>



<a name="256716614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/proof_by_contra/near/256716614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/proof_by_contra.html#256716614">(Oct 08 2021 at 10:07)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/9619">#9619</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>