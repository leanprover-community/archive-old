---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/to_additive.20attribute.20order.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html">to_additive attribute order</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="209314438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/209314438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#209314438">(Sep 07 2020 at 17:01)</a>:</h4>
<p>If there are other attributes on a definition which I want <code>to_additive</code> to copy to the additive version, then <code>to_additive</code> should come <strong>last</strong>, right? Or does it not matter?</p>



<a name="209314449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/209314449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#209314449">(Sep 07 2020 at 17:01)</a>:</h4>
<p>I didn't see anything about this in the documentation.</p>



<a name="209317217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/209317217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#209317217">(Sep 07 2020 at 17:51)</a>:</h4>
<p>Yes, <code>to_additive</code> adds <code>simp</code> and some other attributes (but not all) to the generated declarations.</p>



<a name="209335737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/209335737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#209335737">(Sep 08 2020 at 00:10)</a>:</h4>
<p>I tested and you do need to put other attributes first if you want them to be copied.</p>



<a name="280408682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280408682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280408682">(Apr 27 2022 at 20:48)</a>:</h4>
<p>Is the attribute order documented anywhere? I found yet another interaction that can go wrong:<code>to_additive</code> and <code>norm_cast</code>. <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous_map.coe_smul">docs#continuous_map.coe_smul</a> gets it wrong.</p>



<a name="280409244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409244">(Apr 27 2022 at 20:53)</a>:</h4>
<p>I don't think the order is documented but the rule is always put to additive last, unless it complains, in which case do what the error message says.</p>



<a name="280409324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409324">(Apr 27 2022 at 20:53)</a>:</h4>
<p>... except <code>simps</code></p>



<a name="280409325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409325">(Apr 27 2022 at 20:53)</a>:</h4>
<p>Things slip through the cracks of course and I try and do a grep search and fix things occasionally, but that is also imperfect.</p>



<a name="280409410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409410">(Apr 27 2022 at 20:54)</a>:</h4>
<p>Well that comes under the unless it complains branch of my rule</p>



<a name="280409456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409456">(Apr 27 2022 at 20:54)</a>:</h4>
<p>Simps and mono are the only exceptions iirc but the user doesn't really have to remember that</p>



<a name="280409459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409459">(Apr 27 2022 at 20:54)</a>:</h4>
<p>and is there any other interaction between <code>norm_cast</code>, <code>simp</code> and others?</p>



<a name="280409537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409537">(Apr 27 2022 at 20:55)</a>:</h4>
<p>I don't think they interact, but I'm not 100% sure</p>



<a name="280409926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280409926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280409926">(Apr 27 2022 at 20:58)</a>:</h4>
<p>I know for a fact that <code>to_additive</code> and <code>alias</code> interact (in bad ways), but <a href="https://github.com/leanprover-community/mathlib/pull/13742">#13742</a> and <a href="https://github.com/leanprover-community/mathlib/pull/13743">#13743</a> should fix this.</p>



<a name="280411234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280411234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280411234">(Apr 27 2022 at 21:09)</a>:</h4>
<p>Yes most attribute pairs don't interact though. to_additive is one of the few attributes that creates a new declaration that needs attributes of it's own, so more care is needed</p>



<a name="280435246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20attribute%20order/near/280435246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20attribute.20order.html#280435246">(Apr 28 2022 at 01:33)</a>:</h4>
<p>I don't really understand how to_additive does its magic, but I've looked at the code a few times.  It seems that </p>
<p><a href="https://github.com/leanprover-community/mathlib/blob/dc589c890576488ae0df5d62a389aa49ca507938/src/algebra/group/to_additive.lean#L545">https://github.com/leanprover-community/mathlib/blob/dc589c890576488ae0df5d62a389aa49ca507938/src/algebra/group/to_additive.lean#L545</a></p>
<p>is where there is (at least part of) the handling of attributes.  You can also see that <code>simps, mono</code> and something with <code>alias</code> get singled out.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>