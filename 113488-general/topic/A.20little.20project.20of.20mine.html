---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/A.20little.20project.20of.20mine.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html">A little project of mine</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="276094734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276094734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276094734">(Mar 21 2022 at 18:28)</a>:</h4>
<p>hello, I want to share a little project I did in lean 4. Its nowhere near complete, nor do i plan on finishing it. It has some useful elements, that could be used in a project, like heterogeneous lists, range list syntax, accessing nth element of product; but in truth this was just a project to get some experience in lean 4, and I think it did just that. I also want to thank everyone who helped me on the zulip. This used to be <code>lean4-Tuple</code>, but now it is much more. Here is the repo: <a href="https://github.com/crabbo-rave/Soup">https://github.com/crabbo-rave/Soup</a></p>



<a name="276094761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276094761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276094761">(Mar 21 2022 at 18:29)</a>:</h4>
<p>I wouldn't mind any feadback</p>



<a name="276095652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276095652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276095652">(Mar 21 2022 at 18:34)</a>:</h4>
<p>Nice! Good learning experience. I'm glad to see your questions and the problems you face motivating some improvements on Lean 4. The piece of feedback that I have, just from looking at the README, is that you ate up multiple syntax variations to do the same thing here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫.</span><span class="n">nth</span> <span class="mi">1</span> <span class="c1">-- "2"</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫#</span><span class="mi">1</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫@</span><span class="mi">1</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫</span><span class="o">::</span><span class="mi">1</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫∧</span><span class="mi">1</span>
</code></pre></div>
<p>It's usually better to standardize an unique notation to avoid coding styles hell</p>



<a name="276095830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276095830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276095830">(Mar 21 2022 at 18:35)</a>:</h4>
<p>Oh yeah, the readme is very old</p>



<a name="276095853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276095853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276095853">(Mar 21 2022 at 18:35)</a>:</h4>
<p>The syntax has changed. It just uses brackets now.</p>



<a name="276096015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276096015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276096015">(Mar 21 2022 at 18:36)</a>:</h4>
<p>I updated it</p>



<a name="276096297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276096297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276096297">(Mar 21 2022 at 18:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/113488-general/topic/A.20little.20project.20of.20mine/near/276095652">said</a>:</p>
<blockquote>
<p>Nice! Good learning experience. I'm glad to see your questions and the problems you face motivating some improvements on Lean 4. The piece of feedback that I have, just from looking at the README, is that you ate up multiple syntax variations to do the same thing here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫.</span><span class="n">nth</span> <span class="mi">1</span> <span class="c1">-- "2"</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫#</span><span class="mi">1</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫@</span><span class="mi">1</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫</span><span class="o">::</span><span class="mi">1</span>
<span class="k">#eval</span> <span class="bp">⟪</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="bp">⟫∧</span><span class="mi">1</span>
</code></pre></div>
<p>It's usually better to standardize an unique notation to avoid coding styles hell</p>
</blockquote>
<p>Now i only have 3</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">notation</span><span class="o">:</span><span class="mi">90</span> <span class="n">p</span> <span class="s2">"#"</span> <span class="n">i</span> <span class="bp">=&gt;</span> <span class="n">nth</span> <span class="n">p</span> <span class="bp">#</span><span class="n">i</span>
<span class="kd">notation</span><span class="o">:</span><span class="mi">90</span> <span class="n">p</span> <span class="s2">"@"</span> <span class="n">i</span> <span class="bp">=&gt;</span> <span class="n">nth</span> <span class="n">p</span> <span class="bp">#</span><span class="n">i</span>
<span class="kd">notation</span><span class="o">:</span><span class="mi">90</span> <span class="n">p</span> <span class="s2">"["</span> <span class="n">i</span> <span class="s2">"]"</span> <span class="bp">=&gt;</span> <span class="n">nth</span> <span class="n">p</span> <span class="bp">#</span><span class="n">i</span>
</code></pre></div>
<p>Just for different programmers</p>



<a name="276097911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276097911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276097911">(Mar 21 2022 at 18:51)</a>:</h4>
<p>Languages that allow the creation of your own syntax/macros are usually feared because "Just for different programmers" can turn into "Just for different programmers not to understand each other". Taking Lean 4 source code as an example, I like that <code>#[...]</code> is <em>the way</em> to represent arrays and that I don't need to know other syntax to recognize them</p>



<a name="276098658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276098658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276098658">(Mar 21 2022 at 18:57)</a>:</h4>
<p>I don't mean to sound blunt though <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span> <br>
It's your creation afterall, your library. I'm just expressing a worry that would come to my mind if I were to use it as a dependency</p>



<a name="276099868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276099868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276099868">(Mar 21 2022 at 19:06)</a>:</h4>
<p>I see. Which do you suggest I stick to?</p>



<a name="276100207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276100207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276100207">(Mar 21 2022 at 19:10)</a>:</h4>
<p>That's totally up to you <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="276100479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276100479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276100479">(Mar 21 2022 at 19:12)</a>:</h4>
<p><code>@</code> is pretty neat</p>



<a name="276121114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276121114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276121114">(Mar 21 2022 at 22:16)</a>:</h4>
<p>I would suggest only <code>l[i]</code> if you want a notation like this, and you should use <code>getOp</code> which magically enables this notation</p>



<a name="276121220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276121220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276121220">(Mar 21 2022 at 22:17)</a>:</h4>
<p>the reason is that, like Arthur says, there is importance in consistency across the language to help people learn things</p>



<a name="276121235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276121235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276121235">(Mar 21 2022 at 22:18)</a>:</h4>
<p>and this syntax is already used for getting elements of an array</p>



<a name="276130929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276130929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276130929">(Mar 22 2022 at 00:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/A.20little.20project.20of.20mine/near/276121114">said</a>:</p>
<blockquote>
<p>I would suggest only <code>l[i]</code> if you want a notation like this, and you should use <code>getOp</code> which magically enables this notation</p>
</blockquote>
<p>What is getOp?</p>



<a name="276132543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276132543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276132543">(Mar 22 2022 at 00:58)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/blob/87bb299f085cc46ac9306820b85eecc59d447e85/src/Init/Data/String/Basic.lean#L55">Example</a>. Apparently defining/implementing a <code>getOp</code> function in the namespace of your type allows you to do <code>[i]</code> on the terms of your type automagically:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">MyType</span> <span class="bp">|</span> <span class="n">hi</span>

<span class="kd">def</span> <span class="n">MyType.getOp</span> <span class="o">(</span><span class="n">self</span> <span class="o">:</span> <span class="n">MyType</span><span class="o">)</span> <span class="o">(</span><span class="n">idx</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">idx</span>

<span class="k">#eval</span> <span class="n">MyType.hi</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="c1">-- 2</span>
<span class="k">#eval</span> <span class="n">MyType.hi</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="c1">-- 3</span>
</code></pre></div>



<a name="276132859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276132859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276132859">(Mar 22 2022 at 01:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/113488-general/topic/A.20little.20project.20of.20mine/near/276132543">said</a>:</p>
<blockquote>
<p><a href="https://github.com/leanprover/lean4/blob/87bb299f085cc46ac9306820b85eecc59d447e85/src/Init/Data/String/Basic.lean#L55">Example</a>. Apparently defining/implementing a <code>getOp</code> function in the namespace of your type allows you to do <code>[i]</code> on the terms of your type automagically:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">MyType</span> <span class="bp">|</span> <span class="n">hi</span>

<span class="kd">def</span> <span class="n">MyType.getOp</span> <span class="o">(</span><span class="n">self</span> <span class="o">:</span> <span class="n">MyType</span><span class="o">)</span> <span class="o">(</span><span class="n">idx</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="n">idx</span>

<span class="k">#eval</span> <span class="n">MyType.hi</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="c1">-- 2</span>
<span class="k">#eval</span> <span class="n">MyType.hi</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="c1">-- 3</span>
</code></pre></div><br>
</p>
</blockquote>
<p>That wont really work for me tbh</p>



<a name="276132871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276132871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276132871">(Mar 22 2022 at 01:04)</a>:</h4>
<p>Since i take in <code>Fin'</code> rather than <code>Nat</code></p>



<a name="276132916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276132916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276132916">(Mar 22 2022 at 01:05)</a>:</h4>
<p>so they would have to do <code>h[#i]</code>, but my notation abstracts that</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">notation</span><span class="o">:</span><span class="mi">90</span> <span class="n">p</span> <span class="s2">"["</span> <span class="n">i</span> <span class="s2">"]"</span> <span class="bp">=&gt;</span> <span class="n">nth</span> <span class="n">p</span> <span class="bp">#</span><span class="n">i</span>
</code></pre></div>



<a name="276136143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276136143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276136143">(Mar 22 2022 at 02:13)</a>:</h4>
<p>What if they have a <code>Fin'</code> that they want to pass in though? I'm not sure hiding the <code>#</code> is a good idea</p>



<a name="276160783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276160783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276160783">(Mar 22 2022 at 09:22)</a>:</h4>
<p>The proof <code>by decide</code> inside of <code>#</code> might not work if you do a little bit more complicated operations on indices. As an experiment, try to implement bubble sort with two <code>for</code> loops(not with recursion), would you run into a problem or not?</p>
<p>This might not apply to heterogenous lists, but for homogenous ones it is really nice to have <code>i</code> in <code>Fin n</code>. I often write a sum of all elements in a list: <code>sum fun i =&gt; a[i]</code>. In you notation l, <code>i</code> would be Nat and sum would need range specified. As I said, the use case for heterogeneous lists might be completely different and this might not apply.</p>



<a name="276335417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276335417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276335417">(Mar 23 2022 at 13:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/A.20little.20project.20of.20mine/near/276136143">said</a>:</p>
<blockquote>
<p>What if they have a <code>Fin'</code> that they want to pass in though? I'm not sure hiding the <code>#</code> is a good idea</p>
</blockquote>
<p>Hmm.</p>



<a name="276543939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276543939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276543939">(Mar 24 2022 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="467926">@Joseph O</span>  For quite some time I wanted some mechanism for n-fold currying and uncurrying. For example, turning <code>f : Nat -&gt; Int -&gt; (Unit -&gt; Nat) -&gt; Nat</code> to <code>fun x =&gt; f x[0] x[1] x[2]</code> of type <code>HList [Nat,Int,Unit-&gt;Nat] -&gt; Nat</code>.  I got inspired and motivated by your project, so I finally did it.</p>
<p>I has to do some tricky typeclasses but I have  a function <code>huncurry n</code> that uncurries <code>n</code> arguments:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">huncurry</span> <span class="mi">3</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">j</span><span class="o">)</span>
          <span class="bp">=</span>
          <span class="bp">λ</span> <span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">0</span><span class="o">]</span> <span class="bp">+</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">1</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rfl</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">huncurry</span> <span class="mi">2</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">j</span><span class="o">)</span>
          <span class="bp">=</span>
          <span class="bp">λ</span> <span class="n">xs</span> <span class="n">k</span> <span class="bp">=&gt;</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">0</span><span class="o">]</span> <span class="bp">+</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">1</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">by</span>  <span class="n">rfl</span>
</code></pre></div>
<p>What I particularly like is that the above is solved by <code>rfl</code>, so writing <code>huncurry 3 f</code> is identical to <code>λ xs =&gt;  f xs[#0] xs[#1] xs[#2]</code></p>
<p>The full code(have skipped most of the proofs):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">HArray</span> <span class="o">(</span><span class="n">Ts</span> <span class="o">:</span> <span class="n">List</span> <span class="kt">Type</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">data</span> <span class="o">:</span> <span class="n">Array</span> <span class="o">(</span><span class="n">Sigma</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">=&gt;</span> <span class="n">T</span><span class="o">))</span>
  <span class="n">h_len</span> <span class="o">:</span> <span class="n">Ts.length</span> <span class="bp">=</span> <span class="n">data.size</span>
  <span class="n">typed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">Ts.length</span><span class="o">,</span> <span class="o">(</span><span class="n">data.get</span> <span class="o">(</span><span class="n">h_len</span> <span class="bp">▸</span> <span class="n">i</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">Ts.get</span> <span class="n">i</span>

<span class="kn">namespace</span> <span class="n">HArray</span>

  <span class="kd">variable</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">Ts</span> <span class="o">:</span> <span class="n">List</span> <span class="kt">Type</span><span class="o">}</span>

  <span class="kd">def</span> <span class="n">get</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">HArray</span> <span class="n">Ts</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">Ts.length</span><span class="o">)</span> <span class="o">:</span> <span class="n">Ts.get</span> <span class="n">i</span>
    <span class="o">:=</span> <span class="n">u.typed</span> <span class="n">i</span> <span class="bp">▸</span> <span class="o">(</span><span class="n">u.data.get</span> <span class="o">(</span><span class="n">u.h_len</span> <span class="bp">▸</span> <span class="n">i</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>

  <span class="kd">def</span> <span class="n">getOp</span> <span class="o">(</span><span class="n">self</span> <span class="o">:</span> <span class="n">HArray</span> <span class="n">Ts</span><span class="o">)</span> <span class="o">(</span><span class="n">idx</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">Ts.length</span><span class="o">)</span> <span class="o">:</span> <span class="n">Ts.get</span> <span class="n">idx</span>
    <span class="o">:=</span> <span class="n">self.typed</span> <span class="n">idx</span> <span class="bp">▸</span> <span class="o">(</span><span class="n">self.data.get</span> <span class="o">(</span><span class="n">self.h_len</span> <span class="bp">▸</span> <span class="n">idx</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>

  <span class="kd">def</span> <span class="n">set</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">HArray</span> <span class="n">Ts</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">Ts.length</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Ts.get</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="n">HArray</span> <span class="n">Ts</span>
    <span class="o">:=</span> <span class="o">⟨</span><span class="n">u.data.set</span> <span class="o">(</span><span class="n">u.h_len</span> <span class="bp">▸</span> <span class="n">i</span><span class="o">)</span> <span class="o">(⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">x</span><span class="o">⟩),</span> <span class="gr">sorry</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">⟩</span>

<span class="kd">end</span> <span class="n">HArray</span>

<span class="kd">class</span> <span class="n">HCurryType</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">Xs</span> <span class="o">:</span> <span class="n">List</span> <span class="kt">Type</span>
  <span class="n">Y</span>  <span class="o">:</span> <span class="kt">Type</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">reducible</span><span class="o">]</span> <span class="n">HCurryType.Xs</span> <span class="n">HCurryType.Y</span>

<span class="kd">@[reducible]</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">HCurryType</span> <span class="mi">0</span> <span class="n">Y</span> <span class="n">where</span>
  <span class="n">Xs</span> <span class="o">:=</span> <span class="o">[]</span>
  <span class="n">Y</span> <span class="o">:=</span> <span class="n">Y</span>

<span class="kd">@[reducible]</span>
<span class="kd">instance</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">t</span> <span class="o">:</span> <span class="n">HCurryType</span> <span class="n">n</span> <span class="n">Y</span><span class="o">]</span> <span class="o">:</span> <span class="n">HCurryType</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">X</span> <span class="bp">→</span> <span class="n">Y</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">Xs</span> <span class="o">:=</span> <span class="n">X</span><span class="o">::</span><span class="n">t.Xs</span>
  <span class="n">Y</span> <span class="o">:=</span> <span class="n">t.Y</span>

<span class="kd">class</span> <span class="n">HCurry</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">(</span><span class="n">Xs'</span> <span class="n">Xs</span> <span class="o">:</span> <span class="n">List</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">Y</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">index_valid</span> <span class="o">:</span> <span class="n">Xs'.length</span> <span class="bp">+</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">Xs.length</span>
  <span class="n">types_valid</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">j</span><span class="o">,</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">j</span> <span class="bp">&lt;</span> <span class="n">Xs.length</span> <span class="bp">→</span> <span class="n">Xs'.get</span> <span class="o">⟨</span><span class="n">j</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">⟩</span> <span class="bp">=</span> <span class="n">Xs.get</span> <span class="o">⟨</span><span class="n">i</span> <span class="bp">+</span> <span class="n">j</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">⟩</span>
  <span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span>
  <span class="n">uncurry</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">→</span> <span class="o">(</span><span class="n">HArray</span> <span class="n">Xs</span> <span class="bp">→</span> <span class="n">Y</span><span class="o">)</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">reducible</span><span class="o">]</span> <span class="n">HCurry.F</span> <span class="n">HCurry.uncurry</span>

<span class="kd">@[reducible]</span>
<span class="kd">instance</span> <span class="o">(</span><span class="n">Xs</span> <span class="o">:</span> <span class="n">List</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">Y</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:</span> <span class="n">HCurry</span> <span class="n">n</span> <span class="o">[]</span> <span class="n">Xs</span> <span class="n">Y</span> <span class="n">where</span>
  <span class="n">index_valid</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">types_valid</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">F</span> <span class="o">:=</span> <span class="n">Y</span>
  <span class="n">uncurry</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">y</span> <span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">y</span>

<span class="kd">@[reducible]</span>
<span class="kd">instance</span> <span class="o">[</span><span class="n">c</span> <span class="o">:</span> <span class="n">HCurry</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">Xs'</span><span class="o">)</span> <span class="n">Xs</span> <span class="n">Y</span><span class="o">]</span> <span class="o">:</span> <span class="n">HCurry</span> <span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">X'</span><span class="o">::</span><span class="n">Xs'</span><span class="o">)</span> <span class="n">Xs</span> <span class="n">Y</span> <span class="n">where</span>
  <span class="n">index_valid</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">types_valid</span> <span class="o">:=</span> <span class="gr">sorry</span>
  <span class="n">F</span> <span class="o">:=</span> <span class="n">X'</span> <span class="bp">→</span> <span class="n">c.F</span>
  <span class="n">uncurry</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">xs</span> <span class="bp">=&gt;</span>
    <span class="k">let</span> <span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">Xs.get</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span><span class="gr">sorry</span><span class="o">⟩</span> <span class="bp">=</span> <span class="n">X'</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>
    <span class="k">let</span> <span class="n">xi</span> <span class="o">:</span> <span class="n">X'</span> <span class="o">:=</span> <span class="o">(</span><span class="n">h</span> <span class="bp">▸</span> <span class="n">xs</span><span class="o">[⟨</span><span class="n">i</span><span class="o">,</span><span class="gr">sorry</span><span class="o">⟩])</span>
    <span class="n">c.uncurry</span> <span class="o">(</span><span class="n">f</span> <span class="n">xi</span><span class="o">)</span> <span class="n">xs</span>

<span class="kd">def</span> <span class="n">huncurry</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">HCurryType</span> <span class="n">n</span> <span class="n">F</span><span class="o">]</span>
  <span class="o">[</span><span class="n">ci</span> <span class="o">:</span> <span class="n">HCurry</span> <span class="mi">0</span> <span class="o">(</span><span class="n">HCurryType.Xs</span> <span class="n">n</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">HCurryType.Xs</span> <span class="n">n</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">HCurryType.Y</span> <span class="n">n</span> <span class="n">F</span><span class="o">)]</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="n">h</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">=</span> <span class="n">ci.F</span> <span class="o">:=</span> <span class="gr">sorry</span>
    <span class="n">ci.uncurry</span> <span class="o">(</span><span class="n">h</span> <span class="bp">▸</span> <span class="n">f</span><span class="o">)</span>

<span class="n">macro</span><span class="o">:</span><span class="n">max</span> <span class="s2">"#"</span> <span class="n">noWs</span> <span class="n">t</span><span class="o">:</span><span class="n">term</span> <span class="o">:</span> <span class="n">term</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(⟨</span><span class="bp">$</span><span class="n">t</span><span class="o">,</span> <span class="kd">by</span> <span class="n">decide</span><span class="o">⟩)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">huncurry</span> <span class="mi">3</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">j</span><span class="o">)</span>
          <span class="bp">=</span>
          <span class="bp">λ</span> <span class="n">xs</span> <span class="bp">=&gt;</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">0</span><span class="o">]</span> <span class="bp">+</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">1</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">by</span>  <span class="n">rfl</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">huncurry</span> <span class="mi">2</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">j</span><span class="o">)</span>
          <span class="bp">=</span>
          <span class="bp">λ</span> <span class="n">xs</span> <span class="n">k</span> <span class="bp">=&gt;</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">0</span><span class="o">]</span> <span class="bp">+</span> <span class="n">xs</span><span class="o">[</span><span class="bp">#</span><span class="mi">1</span><span class="o">]</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rfl</span>
</code></pre></div>



<a name="276544310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276544310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276544310">(Mar 24 2022 at 21:54)</a>:</h4>
<p>Do you know about <a href="https://leanprover-community.github.io/mathlib_docs/find/function.has_uncurry">docs#function.has_uncurry</a> in Lean 3?</p>



<a name="276545097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276545097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276545097">(Mar 24 2022 at 22:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/A.20little.20project.20of.20mine/near/276544310">said</a>:</p>
<blockquote>
<p>Do you know about <a href="https://leanprover-community.github.io/mathlib_docs/find/function.has_uncurry">docs#function.has_uncurry</a> in Lean 3?</p>
</blockquote>
<p>Now I do :) thanks. I guess I did it partially as an exercise, but I will look into mathlib's implementation to see how it is done there.</p>



<a name="276545898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276545898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276545898">(Mar 24 2022 at 22:08)</a>:</h4>
<p>One of my motivation was that I wanted to end up with <code>fun x =&gt; f x[0] x[1] x[2]</code> instead of <code>fun x =&gt; f x.1 x.2.1 x.2.2</code>.</p>



<a name="276604041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/276604041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#276604041">(Mar 25 2022 at 11:13)</a>:</h4>
<p>I find the docstring for <code>has_uncurry</code> very confusing, as it uses alpha/beta/gamma in a totally different way to the lean code it describes.</p>



<a name="279890382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/279890382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#279890382">(Apr 22 2022 at 23:26)</a>:</h4>
<p><span class="user-mention" data-user-id="346070">@Tomas Skrivan</span> wow looks nice. Glad to hear you got inspired, though the code is perhaps a bit too complicated for me to understand yet. I hope to get there soon.</p>



<a name="279890492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/A%20little%20project%20of%20mine/near/279890492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph O <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/A.20little.20project.20of.20mine.html#279890492">(Apr 22 2022 at 23:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/A.20little.20project.20of.20mine/near/276136143">said</a>:</p>
<blockquote>
<p>What if they have a <code>Fin'</code> that they want to pass in though? I'm not sure hiding the <code>#</code> is a good idea</p>
</blockquote>
<p>ok I implemented <code>getOp</code> instead now. <br>
The current way to access the index is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="s2">"2"</span><span class="o">,</span><span class="mi">3</span><span class="bp">.</span><span class="mi">0</span><span class="o">][</span><span class="bp">#</span><span class="mi">1</span><span class="o">]</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>