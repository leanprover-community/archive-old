---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html">Commands for canonical variables declarations (was: Under...</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="260886880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260886880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260886880">(Nov 10 2021 at 01:09)</a>:</h4>
<p>Shall we move everything from <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/260869839">Kyle's message</a> onwards to its own thread?</p>



<a name="260890212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260890212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260890212">(Nov 10 2021 at 01:59)</a>:</h4>
<p>I have a prototype here: <a href="https://github.com/leanprover-community/mathlib/issues/10254">#10254</a> <a href="https://github.com/leanprover-community/mathlib/blob/kmill_tactic_declare/src/tactic/declare.lean">https://github.com/leanprover-community/mathlib/blob/kmill_tactic_declare/src/tactic/declare.lean</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">def_declare</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span> <span class="o">:=</span> <span class="s2">"variables [semiring %(A)] [algebra %(R) %(A)]"</span>
<span class="n">def_declare</span> <span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span> <span class="o">:=</span> <span class="s2">"variables [add_comm_group %(V)] [module %(K) %(V)]"</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">F</span> <span class="n">W</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
<span class="n">declare</span> <span class="n">vector_space</span> <span class="n">F</span> <span class="n">W</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="n">declare</span> <span class="n">algebra</span> <span class="n">F</span> <span class="n">α</span>

<span class="bp">#</span><span class="n">where</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">variables {F : Type u_1} {W : Type u_2} {α : Type u_3} [field F] [add_comm_group W] [module F W] [semiring α] [algebra F α]</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="260896896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260896896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260896896">(Nov 10 2021 at 02:24)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">def_declare</span> <span class="n">rep</span> <span class="n">k</span> <span class="n">G</span> <span class="n">V</span> <span class="o">:=</span>
<span class="s2">"variables [add_comm_monoid %(V)] [module %(k) %(V)]</span>
<span class="s2">  [distrib_mul_action %(G) %(V)] [smul_comm_class %(k) %(G) %(V)]"</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">k</span> <span class="n">G</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">k</span><span class="o">]</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">G</span><span class="o">]</span>
<span class="n">declare</span> <span class="n">rep</span> <span class="n">k</span> <span class="n">G</span> <span class="n">V</span>
</code></pre></div>



<a name="260905669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260905669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260905669">(Nov 10 2021 at 02:27)</a>:</h4>
<p>I think at this point I would encourage "please don't bother doing such things in Lean 3" :-)</p>



<a name="260944965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260944965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260944965">(Nov 10 2021 at 04:36)</a>:</h4>
<p>If <code>declare? vector_space K V</code> would emit a <code>Try this:</code> line, that would be really nice. Especially if <code>declare</code> will use TC inference to only add missing types and instances.</p>



<a name="260944989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260944989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260944989">(Nov 10 2021 at 04:37)</a>:</h4>
<p>Then there is nothing magical, but still a convenience booster. Might still be worth doing in Lean 3?</p>



<a name="260945639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260945639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260945639">(Nov 10 2021 at 04:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20.28was.3A.20Under.2E.2E.2E/near/260944965">said</a>:</p>
<blockquote>
<p>If <code>declare? vector_space K V</code> would emit a <code>Try this:</code> line, that would be really nice.</p>
</blockquote>
<p>Except for the <code>Try this:</code>, this is what it prints out:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare</span><span class="bp">?</span> <span class="n">vector_space</span> <span class="n">F</span> <span class="n">W</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">variables [add_comm_group W] [module F W]</span>
<span class="cm">-/</span>
</code></pre></div>
<p>(It doesn't do any inference though since it's just a dumb text substitution mechanism.)</p>



<a name="260945820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260945820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260945820">(Nov 10 2021 at 04:55)</a>:</h4>
<p>Cool. If you just prepend <code>Try this: </code> to that message, then VScode magic will take care of the "auto-replace" this line.</p>



<a name="260945945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260945945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260945945">(Nov 10 2021 at 04:58)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">F</span> <span class="n">W</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
<span class="n">declare</span><span class="bp">?</span> <span class="n">vector_space</span> <span class="n">F</span> <span class="n">W</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">Try this: variables [add_comm_group W] [module F W]</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="260945990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260945990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260945990">(Nov 10 2021 at 04:59)</a>:</h4>
<p>/me thinks: PR! PR! PR!</p>



<a name="260946844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260946844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260946844">(Nov 10 2021 at 05:14)</a>:</h4>
<p>The <code>?</code> version is okay.</p>



<a name="260958272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/260958272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#260958272">(Nov 10 2021 at 08:28)</a>:</h4>
<p>It would be nice to avoid adding more work for mathport at this point. But the <code>?</code> sounds great.</p>



<a name="261035353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Commands%20for%20canonical%20variables%20declarations%20%28was%3A%20Under.../near/261035353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Commands.20for.20canonical.20variables.20declarations.20(was.3A.20Under.2E.2E.2E.html#261035353">(Nov 10 2021 at 18:40)</a>:</h4>
<p>For now, I think it would be fair to have <code>declare</code> be in the same category as a non-terminal <code>simp</code>, in that, while library code shouldn't use it (at least until we better understand its properties), it would be helpful during development.</p>
<p>Doing this using a text-based macro system definitely makes me shudder (and I'm sure it will be better in Lean 4), but it demonstrates that some approximation of the ideal can work right now.  The implementation is also rather simple, which has its benefits.  (It's so simple that it also allows you to devise some truly horrible <code>def_declare</code>s, but I've restrained myself from sharing them because I don't want anyone to get the wrong idea...)</p>
<p>Before actually trying to PR it, I'd like to make it be somewhat more sophisticated.  It looks like it's not very hard to make it be aware of the current variables (with <code>get_variables</code>, like what <code>#where</code> uses) and have it not duplicate things.  It also seems very possible to have it do something like what Anne's patch does and make <code>declare</code> work for pre-existing typeclasses (and recursively), and then have <code>def_declare</code> be replaced by just class definitions, possibly with a special attribute to help <code>declare</code> out (that means they'd appear in the documentation and be searchable without further work).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>