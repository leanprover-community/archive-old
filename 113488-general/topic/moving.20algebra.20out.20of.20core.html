---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/moving.20algebra.20out.20of.20core.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html">moving algebra out of core</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197099043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197099043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197099043">(May 11 2020 at 04:30)</a>:</h4>
<p>Starting a new thread for this project.<br>
Can someone explain me: when I build core</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> build/releases
cmake ../../src
make
</code></pre></div>


<p>How is this aware of any <code>.lean</code> files in core? I grepped through all the Makefiles, and they don't seem to mention lean files anywhere.</p>



<a name="197099070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197099070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197099070">(May 11 2020 at 04:31)</a>:</h4>
<p>Or does it not care, but will you only notice once you run the tests if you've changed/moved a bunch of lean files?</p>



<a name="197100272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100272">(May 11 2020 at 04:56)</a>:</h4>
<p>Here is the relevant part of <code>CMakeLists.txt</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">add_custom_target</span><span class="p">(</span>
    <span class="s">standard_lib</span> <span class="s">ALL</span>
    <span class="s">COMMAND</span> <span class="s2">&quot;${LEAN_SOURCE_DIR}/../bin/lean&quot;</span> <span class="s">--make</span> <span class="o">${</span><span class="nv">LEAN_EXTRA_MAKE_OPTS</span><span class="o">}</span>
    <span class="s">DEPENDS</span> <span class="s">bin_lean</span>
    <span class="s">WORKING_DIRECTORY</span> <span class="s2">&quot;${LEAN_SOURCE_DIR}/../library&quot;</span>
    <span class="p">)</span>

<span class="nb">add_custom_target</span><span class="p">(</span>
    <span class="s">leanpkg</span> <span class="s">ALL</span>
    <span class="s">COMMAND</span> <span class="s2">&quot;${LEAN_SOURCE_DIR}/../bin/lean&quot;</span> <span class="s">--make</span> <span class="o">${</span><span class="nv">LEAN_EXTRA_MAKE_OPTS</span><span class="o">}</span>
    <span class="s">DEPENDS</span> <span class="s">standard_lib</span>
    <span class="s">WORKING_DIRECTORY</span> <span class="s2">&quot;${LEAN_SOURCE_DIR}/../leanpkg&quot;</span>
<span class="p">)</span>
</code></pre></div>



<a name="197100278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100278">(May 11 2020 at 04:57)</a>:</h4>
<p>It just runs this command. It doesn't care what it does.</p>



<a name="197100279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100279">(May 11 2020 at 04:57)</a>:</h4>
<p>/me should learn cmake</p>



<a name="197100333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100333">(May 11 2020 at 04:59)</a>:</h4>
<p>BTW, <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> do you want me to look at lean buildsystem? A few years ago I contributed several patches to cmake and to KDE cmake files.</p>



<a name="197100409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100409">(May 11 2020 at 05:01)</a>:</h4>
<p>If you only plan to edit Lean files, you can just mess around in <code>library</code> after compiling a binary from the latest commit.</p>



<a name="197100460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100460">(May 11 2020 at 05:02)</a>:</h4>
<p>In particular, writing build files to source tree is generally a bad idea. If I have two build directories with different configuration, then I expect these two builds to be completely independent.</p>



<a name="197100464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100464">(May 11 2020 at 05:02)</a>:</h4>
<p>Oh, maybe <a href="#narrow/stream/113488-general/topic/modifying.20lean.20core.20library.20code/near/194571633" title="#narrow/stream/113488-general/topic/modifying.20lean.20core.20library.20code/near/194571633">this post</a> by Jason will help? It could be an alternate way to play around with <code>library</code> without having to build Lean.</p>



<a name="197100473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100473">(May 11 2020 at 05:03)</a>:</h4>
<p>But I guess I will have to touch <code>.cpp</code> as well. Cut <code>norm_num</code> away.</p>



<a name="197100520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197100520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197100520">(May 11 2020 at 05:04)</a>:</h4>
<p>What should core know about natural and integer numbers? Only definitions of operations? Something else?</p>



<a name="197110201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197110201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197110201">(May 11 2020 at 07:40)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/224">lean#224</a> is the first step</p>



<a name="197111904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197111904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197111904">(May 11 2020 at 07:59)</a>:</h4>
<p>That PR removes all the CPP involving norm_num.</p>



<a name="197111948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197111948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197111948">(May 11 2020 at 07:59)</a>:</h4>
<p>A follow-up PR should strip most algebra from the core library. But that lean code is pretty tangled )-;</p>



<a name="197112369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197112369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197112369">(May 11 2020 at 08:03)</a>:</h4>
<p>/me is somewhat surprised that Lean code is faster than cpp code</p>



<a name="197112487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197112487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197112487">(May 11 2020 at 08:04)</a>:</h4>
<p>That's fine</p>



<a name="197113896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197113896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197113896">(May 11 2020 at 08:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197100333">said</a>:</p>
<blockquote>
<p>BTW, <span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> do you want me to look at lean buildsystem? A few years ago I contributed several patches to cmake and to KDE cmake files.</p>
</blockquote>
<p>Are you talking about removing the part that copies lean to <code>bin/lean</code>?  I've already gotten used to this horrible hack.  I don't think that there's an immediate need to change it.  See also previous discussion here: <a href="https://github.com/leanprover/lean/issues/1918">https://github.com/leanprover/lean/issues/1918</a></p>



<a name="197114605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197114605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197114605">(May 11 2020 at 08:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197100520">said</a>:</p>
<blockquote>
<p>What should core know about natural and integer numbers? Only definitions of operations? Something else?</p>
</blockquote>
<p>It needs a few lemmas for the equation compiler.  If you write <code>match n with 314 := a | 42 := b | _ := c end</code>, then it needs to prove that <code>314 ≠ 42</code>.  The definitions of natural numbers (including exponentiation) are also required for the VM (because they are overriden) and the tactic framework.</p>



<a name="197118328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197118328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197118328">(May 11 2020 at 09:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> The reason it's faster is because the C++ is using instance search and <code>norm_num</code> is (now) aggressively caching. It turns out that actual number crunching was nothing compared to finding typeclasses</p>



<a name="197121715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197121715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197121715">(May 11 2020 at 09:45)</a>:</h4>
<p>This is what we need to unclutter:<br>
<a href="/user_uploads/3121/WEHf9-B-Lka6tbRn01erZj_z/import_graph.pdf">import_graph.pdf</a></p>



<a name="197122013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122013">(May 11 2020 at 09:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you know by heart whether something like <code>init.meta.well_founded_tactics</code> has to stay in core?</p>



<a name="197122044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122044">(May 11 2020 at 09:49)</a>:</h4>
<p>that tactic is a mess, I'd like to see it gone</p>



<a name="197122074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122074">(May 11 2020 at 09:49)</a>:</h4>
<p>it should be <code>assumption</code></p>



<a name="197122501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122501">(May 11 2020 at 09:53)</a>:</h4>
<p>What does that mean for this project...</p>



<a name="197122654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122654">(May 11 2020 at 09:54)</a>:</h4>
<p>It can definitely be removed from core</p>



<a name="197122743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122743">(May 11 2020 at 09:55)</a>:</h4>
<p>Ok, I'll try my best</p>



<a name="197122820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122820">(May 11 2020 at 09:56)</a>:</h4>
<p>It is used by lean magic currently: if you leave off the <code>using_well_founded</code> clause in a well founded recursive definition, it will call the tactic in <code>well_founded_tactics</code> in order to solve the size decreasing theorem</p>



<a name="197122835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122835">(May 11 2020 at 09:56)</a>:</h4>
<p>that needs to be changed to another tactic, and I recommend <code>assumption</code></p>



<a name="197122895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122895">(May 11 2020 at 09:57)</a>:</h4>
<p>Does that mean a lot of proofs in mathlib will have to be fixed?</p>



<a name="197122902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122902">(May 11 2020 at 09:57)</a>:</h4>
<p>It does mean a regression for well founded definitions that currently are using the tactic to prove the size decreasing theorem; they will need to put the <code>using_well_founded</code> clause in and reference <code>well_founded_tactic</code> explicitly</p>



<a name="197122961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197122961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197122961">(May 11 2020 at 09:58)</a>:</h4>
<p>And does lean need to be changed before <code>well_founded_tactics</code> can be removed? You seem to suggest that lean depends on it.</p>



<a name="197123009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123009">(May 11 2020 at 09:58)</a>:</h4>
<p>Well founded definitions like this are extremely rare in mathlib, and even when they are used the result isn't great, because it does recursion on <code>T.sizeof</code> which has few lemmas</p>



<a name="197123399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123399">(May 11 2020 at 10:03)</a>:</h4>
<p><code>well_founded_tactics.default</code> is referenced by lean</p>



<a name="197123434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123434">(May 11 2020 at 10:03)</a>:</h4>
<p>and it uses default construction of <code>well_founded_tactics</code>, resulting in the use of <code>well_founded_tactics.default_dec_tac</code></p>



<a name="197123504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123504">(May 11 2020 at 10:04)</a>:</h4>
<p>So if you change the default value of <code>well_founded_tactics.dec_tac</code> to <code>assumption</code>, you should be able to remove <code>default_dec_tac</code></p>



<a name="197123633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123633">(May 11 2020 at 10:06)</a>:</h4>
<p>Another option is to use a <code>def_replacer</code> here, so that users can mark their own default dec_tac, changing the global default</p>



<a name="197123699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123699">(May 11 2020 at 10:07)</a>:</h4>
<p>This sounds orthogonal to <code>norm_num</code>, but maybe not to moving algebra out of core.</p>



<a name="197123753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197123753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197123753">(May 11 2020 at 10:08)</a>:</h4>
<p><code>well_founded_tactics.default_dec_tac</code> is basically a poor man's <code>linarith</code></p>



<a name="197181675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197181675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197181675">(May 11 2020 at 17:54)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/229">lean#229</a> is a wip PR that compiles</p>



<a name="197181717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197181717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197181717">(May 11 2020 at 17:55)</a>:</h4>
<p>I would like some advice on the way forward.</p>



<a name="197181902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197181902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197181902">(May 11 2020 at 17:56)</a>:</h4>
<p>Previously <code>init.data.nat.lemmas</code> imported <code>init.algebra.functions</code> and hence the entire algebraic hierarchy in core.<br>
Now <code>init.algebra.functions</code> only imports <code>init.algebra.order</code>, and hence <code>init.algebra.{group,field,ordered_ring}</code> etc can all be moved out of core.</p>



<a name="197182022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182022">(May 11 2020 at 17:57)</a>:</h4>
<p>I had to prove something like 20 lemmas specifically for <code>nat</code> and <code>int</code> that would otherwise follow from an <code>ordered_(semi)ring</code> instance.</p>



<a name="197182138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182138">(May 11 2020 at 17:58)</a>:</h4>
<p>Wow, so this really is the light at the end of the tunnel?</p>



<a name="197182155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182155">(May 11 2020 at 17:58)</a>:</h4>
<p>Also, <code>nat</code> now has a personal <code>has_dvd</code> instance, and <code>int</code> its own <code>has_sub</code> instance, because they can't get them from <code>comm_semiring</code> resp. <code>add_group</code>.</p>



<a name="197182168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182168">(May 11 2020 at 17:58)</a>:</h4>
<p>When you posted that graph earlier I was just thinking that this might be impossible</p>



<a name="197182266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182266">(May 11 2020 at 17:59)</a>:</h4>
<p>Nat also has its own has_pow instance though, and this causes lots of problems</p>



<a name="197182300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182300">(May 11 2020 at 17:59)</a>:</h4>
<p>But mine are defeq to what you would get otherwise</p>



<a name="197182327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197182327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197182327">(May 11 2020 at 18:00)</a>:</h4>
<p>I was hoping you'd say that :-)</p>



<a name="197201501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197201501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197201501">(May 11 2020 at 20:37)</a>:</h4>
<p>So, for <a href="https://github.com/leanprover-community/lean/issues/229">lean#229</a> should I now remove all the <code>init.algebra.*</code> stuff from core? Or should I wait for a bit, so that people can look at what the PR looks like now?</p>



<a name="197203205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197203205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197203205">(May 11 2020 at 20:52)</a>:</h4>
<p>For me, it would be easier to look at a version with deleted code (as opposed to commented out or not imported anymore).</p>



<a name="197203339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197203339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197203339">(May 11 2020 at 20:53)</a>:</h4>
<p>I wonder what should we do with copyrights when we move code to mathlib, especially when we move code out of files (c) Microsoft to files (c) list of authors.</p>



<a name="197203517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197203517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197203517">(May 11 2020 at 20:55)</a>:</h4>
<p>It would be more polite to ask Leo about this copyright thing.</p>



<a name="197204895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197204895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197204895">(May 11 2020 at 21:07)</a>:</h4>
<p>Who volunteers to ask Leo?</p>



<a name="197205318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197205318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197205318">(May 11 2020 at 21:10)</a>:</h4>
<p>I've removed the unshackled files, but I haven't yet cleaned up commented out code.</p>



<a name="197205321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197205321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197205321">(May 11 2020 at 21:10)</a>:</h4>
<p>Going to bed now.</p>



<a name="197205334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197205334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197205334">(May 11 2020 at 21:10)</a>:</h4>
<p>Others should feel absolutely free to also push to this PR branch</p>



<a name="197206451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197206451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197206451">(May 11 2020 at 21:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197204895">said</a>:</p>
<blockquote>
<p>Who volunteers to ask Leo?</p>
</blockquote>
<p>I volunteer Kevin. But I think it should be pretty easy to explain. We saw that Lean 4 removed a lot of maths from the core library hence we want to do the same, and we have a technical question about headers.</p>



<a name="197210501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197210501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197210501">(May 11 2020 at 22:05)</a>:</h4>
<p>I can certainly do it</p>



<a name="197373104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197373104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197373104">(May 13 2020 at 06:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>python3 script/gen_constants_cpp.py src/library/constants.txt
<span class="c1"># ------------------------------------------------------</span>
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_le_refl_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_mul_one_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_mul_zero_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_zero_le_one_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_zero_lt_one_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_zero_mul_name&#39;</span> is not used in the <span class="nb">source</span> code
</code></pre></div>



<a name="197373124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197373124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197373124">(May 13 2020 at 06:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code>lean ./tests/lean/run/check_constants.lean <span class="p">|</span> grep error <span class="p">|</span> sed <span class="s1">&#39;s/\/home.*error/error/&#39;</span>
<span class="c1"># ------------------------------------------------------</span>
error: identifier <span class="s1">&#39;add_comm_group&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;add_comm_semigroup&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;add_group&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;add_monoid&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;distrib&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;field&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.bit0_nonneg&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.bit0_pos&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.bit1_nonneg&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.bit1_pos&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.nat_abs_bit0_step&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.nat_abs_bit1_nonneg_step&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.ne_neg_of_ne&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.ne_neg_of_pos&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.ne_of_nat_ne_nonneg_case&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.neg_ne_of_pos&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.neg_ne_zero_of_ne&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.one_nonneg&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.one_pos&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.zero_ne_neg_of_ne&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;int.zero_nonneg&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;left_distrib&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;linear_ordered_ring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;linear_ordered_semiring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;monoid&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;mul_one&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;mul_zero&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;mul_zero_class&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;right_distrib&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;ring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;semiring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;zero_le_one&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;zero_lt_one&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;zero_mul&#39;</span> is not a constant, namespace nor attribute
</code></pre></div>



<a name="197373135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197373135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197373135">(May 13 2020 at 06:32)</a>:</h4>
<p>How much of these constants do we really want to keep in core?</p>



<a name="197373208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197373208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197373208">(May 13 2020 at 06:32)</a>:</h4>
<p>All the <code>int.*</code> stuff should probably stay. But whatever comes after that, I would rather see the end of it.</p>



<a name="197373235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197373235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197373235">(May 13 2020 at 06:33)</a>:</h4>
<p>We can have <code>nat.left_distrib</code> and <code>int.left_distrib</code> in core, and the general <code>left_distrib</code> in mathlib.</p>



<a name="197380613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197380613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197380613">(May 13 2020 at 08:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do we want to keep all those constants? I at least want <code>ordered_monoid</code> out of core. Which means that I need to reprove things like <code>neg_of_neg_pos</code> for <code>int</code> if we want to keep all the <code>int.*</code>. How important is that?</p>



<a name="197385448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197385448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197385448">(May 13 2020 at 09:09)</a>:</h4>
<p>I don't see any way to remove the stuff about integers.  This is required by the equation compiler to prove that <code>-42 ≠ 358</code>.</p>



<a name="197385602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197385602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197385602">(May 13 2020 at 09:10)</a>:</h4>
<p>Ok</p>



<a name="197385614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197385614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197385614">(May 13 2020 at 09:10)</a>:</h4>
<p>I'll reprove the ordered ring stuff for <code>int</code></p>



<a name="197407881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197407881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197407881">(May 13 2020 at 12:57)</a>:</h4>
<p>Ok, now the list looks like this</p>
<div class="codehilite"><pre><span></span><code>lean ./tests/lean/run/check_constants.lean <span class="p">|</span> grep error <span class="p">|</span> sed <span class="s1">&#39;s/\/home.*error/error/&#39;</span>
<span class="c1"># -------------------------------------</span>
error: identifier <span class="s1">&#39;add_comm_group&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;add_comm_semigroup&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;add_group&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;add_monoid&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;distrib&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;field&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;left_distrib&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;linear_ordered_ring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;linear_ordered_semiring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;monoid&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;mul_one&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;mul_zero&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;mul_zero_class&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;right_distrib&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;ring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;semiring&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;zero_le_one&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;zero_lt_one&#39;</span> is not a constant, namespace nor attribute
error: identifier <span class="s1">&#39;zero_mul&#39;</span> is not a constant, namespace nor attribute
</code></pre></div>



<a name="197407910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197407910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197407910">(May 13 2020 at 12:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> How do I tell lean that we want to move this out of core?</p>



<a name="197408122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197408122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197408122">(May 13 2020 at 12:59)</a>:</h4>
<p>You've already removed it from <code>constants.txt</code>?</p>



<a name="197408532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197408532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197408532">(May 13 2020 at 13:02)</a>:</h4>
<p>No, I've not</p>



<a name="197408541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197408541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197408541">(May 13 2020 at 13:02)</a>:</h4>
<p>I'll rerun the python script</p>



<a name="197408591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197408591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197408591">(May 13 2020 at 13:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>python3 script/gen_constants_cpp.py src/library/constants.txt
<span class="c1"># -----------------------------------</span>
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_le_refl_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_mul_one_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_mul_zero_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_zero_le_one_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_zero_lt_one_name&#39;</span> is not used in the <span class="nb">source</span> code
Warning: generated <span class="k">function</span> <span class="s1">&#39;get_zero_mul_name&#39;</span> is not used in the <span class="nb">source</span> code
</code></pre></div>



<a name="197408595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197408595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197408595">(May 13 2020 at 13:02)</a>:</h4>
<p>Is that bad?</p>



<a name="197409158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197409158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197409158">(May 13 2020 at 13:07)</a>:</h4>
<p>I've pushed what I have so far</p>



<a name="197409585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197409585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197409585">(May 13 2020 at 13:10)</a>:</h4>
<p>You need to remove more.</p>



<a name="197409668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197409668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197409668">(May 13 2020 at 13:10)</a>:</h4>
<p>Ok, I should do this manually? Not using some script?</p>



<a name="197409762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197409762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197409762">(May 13 2020 at 13:11)</a>:</h4>
<p>The contents of <code>constants.txt</code> are human-edited.</p>



<a name="197410601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197410601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197410601">(May 13 2020 at 13:17)</a>:</h4>
<p>Ok, I pushed again</p>



<a name="197410923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197410923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197410923">(May 13 2020 at 13:19)</a>:</h4>
<p>Errors during make:</p>
<div class="codehilite"><pre><span></span><code>/home/jmc/data/math/lean/src/library/app_builder.cpp: In member function ‘lean::expr lean::app_builder::mk_partial_left_distrib(const lean::expr&amp;)’:
/home/jmc/data/math/lean/src/library/app_builder.cpp:742:77: error: ‘get_distrib_name’ was not declared in this scope; did you mean ‘get_string_name’?
  742 |         auto A_distrib = m_ctx.mk_class_instance(::lean::mk_app(mk_constant(get_distrib_name(), {lvl}), A));
      |                                                                             ^~~~~~~~~~~~~~~~
      |                                                                             get_string_name
/home/jmc/data/math/lean/src/library/app_builder.cpp:747:43: error: ‘get_left_distrib_name’ was not declared in this scope; did you mean ‘get_left_comm_name’?
  747 |         return ::lean::mk_app(mk_constant(get_left_distrib_name(), {lvl}), A, *A_distrib);
      |                                           ^~~~~~~~~~~~~~~~~~~~~
      |                                           get_left_comm_name
/home/jmc/data/math/lean/src/library/app_builder.cpp: In member function ‘lean::expr lean::app_builder::mk_partial_right_distrib(const lean::expr&amp;)’:
/home/jmc/data/math/lean/src/library/app_builder.cpp:752:77: error: ‘get_distrib_name’ was not declared in this scope; did you mean ‘get_string_name’?
  752 |         auto A_distrib = m_ctx.mk_class_instance(::lean::mk_app(mk_constant(get_distrib_name(), {lvl}), A));
      |                                                                             ^~~~~~~~~~~~~~~~
      |                                                                             get_string_name
/home/jmc/data/math/lean/src/library/app_builder.cpp:757:43: error: ‘get_right_distrib_name’ was not declared in this scope; did you mean ‘get_iff_intro_name’?
  757 |         return ::lean::mk_app(mk_constant(get_right_distrib_name(), {lvl}), A, *A_distrib);
      |                                           ^~~~~~~~~~~~~~~~~~~~~~
      |                                           get_iff_intro_name
</code></pre></div>



<a name="197411051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197411051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197411051">(May 13 2020 at 13:20)</a>:</h4>
<p>I'm confused about the internals of lean</p>



<a name="197411808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197411808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197411808">(May 13 2020 at 13:25)</a>:</h4>
<p>Ok, so apparently you removed <code>left_distrib</code>, <code>right_distrib</code>, and <code>distrib</code> even though they're used.</p>



<a name="197411939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197411939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197411939">(May 13 2020 at 13:26)</a>:</h4>
<p>Mmmh, you might want to clean up <code>app_builder.h</code> and <code>app_builder.cpp</code>.</p>



<a name="197412047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197412047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197412047">(May 13 2020 at 13:27)</a>:</h4>
<p>I can also clean up if you're scared.</p>



<a name="197413521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197413521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197413521">(May 13 2020 at 13:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Yes, please go ahead.</p>



<a name="197413534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197413534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197413534">(May 13 2020 at 13:38)</a>:</h4>
<p>I can help again with fixing the tests.</p>



<a name="197413544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197413544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197413544">(May 13 2020 at 13:38)</a>:</h4>
<p>But this part, I don't really know what to do.</p>



<a name="197415772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197415772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197415772">(May 13 2020 at 13:55)</a>:</h4>
<p>Done: <a href="https://github.com/leanprover-community/lean/pull/229/commits/245b721f98fd11f565dfe8f985cc86381f896e4d">https://github.com/leanprover-community/lean/pull/229/commits/245b721f98fd11f565dfe8f985cc86381f896e4d</a></p>



<a name="197415812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197415812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197415812">(May 13 2020 at 13:55)</a>:</h4>
<p>Thanks!</p>



<a name="197430140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197430140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197430140">(May 13 2020 at 15:34)</a>:</h4>
<p><span aria-label="head bandage" class="emoji emoji-1f915" role="img" title="head bandage">:head_bandage:</span> There are 66 failing tests <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="197442782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197442782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197442782">(May 13 2020 at 16:57)</a>:</h4>
<p>Where do I actually find this test</p>
<div class="codehilite"><pre><span></span><code>1 - style_check (Failed)
</code></pre></div>



<a name="197443034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197443034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197443034">(May 13 2020 at 16:58)</a>:</h4>
<p>This is a python script.  Apparently I included <code>util.h</code> twice in <code>app_builder.cpp</code>.  Just delete the second occurrence.</p>



<a name="197444935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197444935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197444935">(May 13 2020 at 17:10)</a>:</h4>
<p>What should I do with a test like this</p>
<div class="codehilite"><pre><span></span><code><span class="kn">variable</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kn">variable</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="bp">-</span><span class="o">(</span><span class="bp">-</span><span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">R</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">trace_state</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">neg_neg</span> <span class="mi">1</span><span class="o">,</span>
<span class="kn">end</span>

<span class="bp">#</span><span class="kn">check</span> <span class="bp">-</span> <span class="bp">-</span><span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">R</span><span class="o">)</span>
</code></pre></div>



<a name="197450414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197450414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197450414">(May 13 2020 at 17:48)</a>:</h4>
<p>What is it supposed to check?</p>



<a name="197450552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197450552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197450552">(May 13 2020 at 17:49)</a>:</h4>
<p><a href="https://github.com/leanprover/lean/issues/1862">https://github.com/leanprover/lean/issues/1862</a></p>



<a name="197450583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197450583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197450583">(May 13 2020 at 17:49)</a>:</h4>
<p>There's lots of tests like that.</p>



<a name="197450624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197450624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197450624">(May 13 2020 at 17:49)</a>:</h4>
<p>They test for a specific bug report.</p>



<a name="197450827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197450827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197450827">(May 13 2020 at 17:50)</a>:</h4>
<p>I'd declare a custom class with <code>extends has_neg</code> and an axiom <code>neg_neg</code>.</p>



<a name="197450832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197450832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197450832">(May 13 2020 at 17:50)</a>:</h4>
<p>wooah, I try to prove it with <code>trivial</code>. What even is that?</p>



<a name="197451053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197451053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197451053">(May 13 2020 at 17:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197450827">said</a>:</p>
<blockquote>
<p>I'd declare a custom class with <code>extends has_neg</code> and an axiom <code>neg_neg</code>.</p>
</blockquote>
<p>I see. That seems like a reasonable approach.</p>



<a name="197461174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197461174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197461174">(May 13 2020 at 19:07)</a>:</h4>
<p>In case anyone wants to contribute:</p>
<div class="codehilite"><pre><span></span><code>        <span class="mi">588</span> <span class="bp">-</span> <span class="n">leanruntest_auto_quote1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">609</span> <span class="bp">-</span> <span class="n">leanruntest_bin_tree</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">640</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">641</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">642</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">644</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac5</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">645</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac_bug</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">687</span> <span class="bp">-</span> <span class="n">leanruntest_conv_tac1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">742</span> <span class="bp">-</span> <span class="n">leanruntest_dsimp_options</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">744</span> <span class="bp">-</span> <span class="n">leanruntest_dsimp_proj</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">767</span> <span class="bp">-</span> <span class="n">leanruntest_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">794</span> <span class="bp">-</span> <span class="n">leanruntest_eq_cases_on</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">815</span> <span class="bp">-</span> <span class="n">leanruntest_exhaustive_vm_impl_test</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">830</span> <span class="bp">-</span> <span class="n">leanruntest_funext_tactic</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">836</span> <span class="bp">-</span> <span class="n">leanruntest_handthen</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">848</span> <span class="bp">-</span> <span class="n">leanruntest_hinst_lemma1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">849</span> <span class="bp">-</span> <span class="n">leanruntest_hinst_lemmas1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">892</span> <span class="bp">-</span> <span class="n">leanruntest_interactive1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">894</span> <span class="bp">-</span> <span class="n">leanruntest_intros_defeq_canonizer_bug</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">929</span> <span class="bp">-</span> <span class="n">leanruntest_local_attribute</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">935</span> <span class="bp">-</span> <span class="n">leanruntest_mario_type_context</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">977</span> <span class="bp">-</span> <span class="n">leanruntest_mrw</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">987</span> <span class="bp">-</span> <span class="n">leanruntest_name_resolution_with_params_bug</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">994</span> <span class="bp">-</span> <span class="n">leanruntest_nat_sub_ematch</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1053</span> <span class="bp">-</span> <span class="n">leanruntest_psum_wf_rec</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1089</span> <span class="bp">-</span> <span class="n">leanruntest_rw1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1095</span> <span class="bp">-</span> <span class="n">leanruntest_sebastien_coe_simp</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1110</span> <span class="bp">-</span> <span class="n">leanruntest_show_goal</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1127</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemma_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1128</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemmas_with_mvars</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1139</span> <span class="bp">-</span> <span class="n">leanruntest_simp_tc_err</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1142</span> <span class="bp">-</span> <span class="n">leanruntest_simp_zeta</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1152</span> <span class="bp">-</span> <span class="n">leanruntest_smt_assert_define</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1154</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1157</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch_alg_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1162</span> <span class="bp">-</span> <span class="n">leanruntest_smt_tests</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1211</span> <span class="bp">-</span> <span class="n">leanruntest_term_app2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1224</span> <span class="bp">-</span> <span class="n">leanruntest_u_eq_max_u_v</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1247</span> <span class="bp">-</span> <span class="n">leanruntest_using_smt2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1287</span> <span class="bp">-</span> <span class="n">leanittest_goal_info</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>



<a name="197461212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197461212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197461212">(May 13 2020 at 19:07)</a>:</h4>
<p>I just pushed a fix of 10 tests. (Not included on the list above.)</p>



<a name="197461429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197461429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197461429">(May 13 2020 at 19:09)</a>:</h4>
<p>Looks like your local path snuck into the test output: <a href="https://github.com/leanprover-community/lean/pull/229/files#diff-9aa4d9cb8974761857542a0004292d74R1">https://github.com/leanprover-community/lean/pull/229/files#diff-9aa4d9cb8974761857542a0004292d74R1</a></p>



<a name="197462249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197462249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197462249">(May 13 2020 at 19:15)</a>:</h4>
<p>Ooh, I though I had fixed that.</p>



<a name="197462389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197462389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197462389">(May 13 2020 at 19:16)</a>:</h4>
<p>Should be fixed now</p>



<a name="197463999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197463999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197463999">(May 13 2020 at 19:28)</a>:</h4>
<p>I've broken runtest 1442: <a href="https://github.com/leanprover/lean/issues/1442">https://github.com/leanprover/lean/issues/1442</a></p>
<div class="codehilite"><pre><span></span><code><span class="kn">protected</span> <span class="n">def</span> <span class="n">rel</span> <span class="o">:</span> <span class="bp">ℤ</span> <span class="bp">×</span> <span class="bp">ℤ</span> <span class="bp">→</span> <span class="bp">ℤ</span> <span class="bp">×</span> <span class="bp">ℤ</span> <span class="bp">→</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="bp">⟨</span><span class="n">n₁</span><span class="o">,</span> <span class="n">d₁</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">n₂</span><span class="o">,</span> <span class="n">d₂</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">n₁</span> <span class="bp">*</span> <span class="n">d₂</span> <span class="bp">=</span> <span class="n">n₂</span> <span class="bp">*</span> <span class="n">d₁</span>

<span class="kn">private</span> <span class="n">def</span> <span class="n">mul&#39;</span> <span class="o">:</span> <span class="bp">ℤ</span> <span class="bp">×</span> <span class="bp">ℤ</span> <span class="bp">→</span> <span class="bp">ℤ</span> <span class="bp">×</span> <span class="bp">ℤ</span> <span class="bp">→</span> <span class="bp">ℤ</span> <span class="bp">×</span> <span class="bp">ℤ</span>
<span class="bp">|</span> <span class="bp">⟨</span><span class="n">n₁</span><span class="o">,</span> <span class="n">d₁</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">n₂</span><span class="o">,</span> <span class="n">d₂</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">n₁</span> <span class="bp">*</span> <span class="n">n₂</span><span class="o">,</span> <span class="n">d₁</span> <span class="bp">*</span> <span class="n">d₂</span><span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span> <span class="bp">×</span> <span class="bp">ℤ</span><span class="o">),</span> <span class="n">rel</span> <span class="n">a</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">rel</span> <span class="n">b</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">rel</span> <span class="o">(</span><span class="n">mul&#39;</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">mul&#39;</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ⟨</span><span class="n">n₁</span><span class="o">,</span> <span class="n">d₁</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">n₂</span><span class="o">,</span> <span class="n">d₂</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">n₃</span><span class="o">,</span> <span class="n">d₃</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">n₄</span><span class="o">,</span> <span class="n">d₄</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="k">assume</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">n₁</span> <span class="bp">*</span> <span class="n">d₃</span> <span class="bp">=</span> <span class="n">n₃</span> <span class="bp">*</span> <span class="n">d₁</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">n₂</span> <span class="bp">*</span> <span class="n">d₄</span> <span class="bp">=</span> <span class="n">n₄</span> <span class="bp">*</span> <span class="n">d₂</span><span class="o">),</span>
  <span class="k">show</span> <span class="o">(</span><span class="n">n₁</span> <span class="bp">*</span> <span class="n">n₂</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d₃</span> <span class="bp">*</span> <span class="n">d₄</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">n₃</span> <span class="bp">*</span> <span class="n">n₄</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d₁</span> <span class="bp">*</span> <span class="n">d₂</span><span class="o">),</span>
    <span class="k">by</span> <span class="n">cc</span>
</code></pre></div>


<p>This is specifically about <code>cc</code>, afaict.<br>
What should I do?</p>



<a name="197464139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197464139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197464139">(May 13 2020 at 19:29)</a>:</h4>
<p>do you have the proof that <code>*</code> is commutative and associative?</p>



<a name="197464151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197464151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197464151">(May 13 2020 at 19:29)</a>:</h4>
<p>Have you read <a href="https://github.com/leanprover-community/lean/pull/229#issuecomment-627220223">my comment</a>?  I'm pretty sure it's this:</p>
<blockquote>
<p><code>(by cc : a + b = b + a)</code> requires instances for <code>is_associative (+)</code> and <code>is_commutative (+)</code>.  Add them back (locally?).  Same goes for <code>ac_refl</code>.</p>
</blockquote>



<a name="197464391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197464391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197464391">(May 13 2020 at 19:31)</a>:</h4>
<p>Ok, thanks</p>



<a name="197467346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197467346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197467346">(May 13 2020 at 19:53)</a>:</h4>
<p>Hmm, how should I make this one happy?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">universe</span> <span class="kn">variables</span> <span class="n">u</span>

<span class="c1">-- jmc added this</span>
<span class="n">class</span> <span class="n">ring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_mul</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_add</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_assoc</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">))</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">ring</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="c1">-- jmc added this</span>
<span class="kn">instance</span> <span class="n">aa</span> <span class="o">:</span> <span class="n">is_associative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">ring</span><span class="bp">.</span><span class="n">add_assoc</span><span class="bp">⟩</span>
<span class="kn">instance</span> <span class="n">ac</span> <span class="o">:</span> <span class="n">is_commutative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">ring</span><span class="bp">.</span><span class="n">add_comm</span><span class="bp">⟩</span>
<span class="kn">constant</span> <span class="n">ma</span> <span class="o">:</span> <span class="n">is_associative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">lc</span> <span class="o">:</span> <span class="n">is_left_cancel</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">rc</span> <span class="o">:</span> <span class="n">is_right_cancel</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">ld</span> <span class="o">:</span> <span class="n">is_left_distrib</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">rd</span> <span class="o">:</span> <span class="n">is_right_distrib</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x1</span> <span class="n">x2</span> <span class="n">x3</span> <span class="n">x4</span> <span class="n">x5</span> <span class="n">x6</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">x1</span><span class="bp">*</span><span class="n">x4</span> <span class="bp">=</span> <span class="n">x1</span> <span class="bp">→</span> <span class="n">x3</span><span class="bp">*</span><span class="n">x6</span> <span class="bp">=</span> <span class="n">x5</span><span class="bp">*</span><span class="n">x5</span> <span class="bp">→</span> <span class="n">x5</span> <span class="bp">=</span> <span class="n">x4</span> <span class="bp">→</span> <span class="n">x6</span> <span class="bp">=</span> <span class="n">x2</span> <span class="bp">→</span> <span class="n">x1</span> <span class="bp">=</span> <span class="n">x1</span><span class="bp">*</span><span class="o">(</span><span class="n">x6</span><span class="bp">*</span><span class="n">x3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cc</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">y1</span> <span class="n">y2</span> <span class="n">x2</span> <span class="n">x3</span> <span class="n">x4</span> <span class="n">x5</span> <span class="n">x6</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="o">)</span><span class="bp">*</span><span class="n">x4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x3</span><span class="bp">*</span><span class="n">x6</span> <span class="bp">=</span> <span class="n">x5</span><span class="bp">*</span><span class="n">x5</span> <span class="bp">→</span> <span class="n">x5</span> <span class="bp">=</span> <span class="n">x4</span> <span class="bp">→</span> <span class="n">x6</span> <span class="bp">=</span> <span class="n">x2</span> <span class="bp">→</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="n">x6</span><span class="bp">*</span><span class="n">x3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cc</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">y1</span> <span class="n">y2</span> <span class="n">y3</span> <span class="n">x2</span> <span class="n">x3</span> <span class="n">x4</span> <span class="n">x5</span> <span class="n">x6</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="o">)</span><span class="bp">*</span><span class="n">x4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y3</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x3</span><span class="bp">*</span><span class="n">x6</span> <span class="bp">=</span> <span class="n">x5</span><span class="bp">*</span><span class="n">x5</span> <span class="bp">→</span> <span class="n">x5</span> <span class="bp">=</span> <span class="n">x4</span> <span class="bp">→</span> <span class="n">x6</span> <span class="bp">=</span> <span class="n">x2</span> <span class="bp">→</span> <span class="n">y2</span> <span class="bp">=</span> <span class="n">y3</span> <span class="bp">→</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y3</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="n">x6</span><span class="bp">*</span><span class="n">x3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cc</span>
</code></pre></div>



<a name="197472511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197472511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197472511">(May 13 2020 at 20:24)</a>:</h4>
<p>There's a whole bunch of tests using <code>smt</code> and <code>eblast</code> etc. And I have no idea what those are.</p>



<a name="197474840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197474840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197474840">(May 13 2020 at 20:41)</a>:</h4>
<p>I've pushed what I've done so far. That's it for tonight. I think most of the remaining tests require some help.</p>



<a name="197505957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197505957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197505957">(May 14 2020 at 04:48)</a>:</h4>
<p>We're now down to 20 failing tests:</p>
<div class="codehilite"><pre><span></span><code>        <span class="mi">559</span> <span class="bp">-</span> <span class="n">leanruntest_aexp</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">642</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">644</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac5</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">767</span> <span class="bp">-</span> <span class="n">leanruntest_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">815</span> <span class="bp">-</span> <span class="n">leanruntest_exhaustive_vm_impl_test</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
<span class="bp">~~</span>        <span class="mi">987</span> <span class="bp">-</span> <span class="n">leanruntest_name_resolution_with_params_bug</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span><span class="bp">~~</span>
        <span class="mi">994</span> <span class="bp">-</span> <span class="n">leanruntest_nat_sub_ematch</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1127</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemma_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
<span class="bp">~~</span>        <span class="mi">1128</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemmas_with_mvars</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span><span class="bp">~~</span>
        <span class="mi">1152</span> <span class="bp">-</span> <span class="n">leanruntest_smt_assert_define</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1154</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch1</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1157</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch_alg_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1162</span> <span class="bp">-</span> <span class="n">leanruntest_smt_tests</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
<span class="bp">~~</span>        <span class="mi">1211</span> <span class="bp">-</span> <span class="n">leanruntest_term_app2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span><span class="bp">~~</span>
<span class="bp">~~</span>        <span class="mi">1224</span> <span class="bp">-</span> <span class="n">leanruntest_u_eq_max_u_v</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span><span class="bp">~~</span>
        <span class="mi">1247</span> <span class="bp">-</span> <span class="n">leanruntest_using_smt2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>



<a name="197506351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197506351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197506351">(May 14 2020 at 04:59)</a>:</h4>
<p>Down to 16</p>



<a name="197507470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197507470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197507470">(May 14 2020 at 05:30)</a>:</h4>
<p>Down to 10</p>
<div class="codehilite"><pre><span></span><code>        <span class="mi">559</span> <span class="bp">-</span> <span class="n">leanruntest_aexp</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">644</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac5</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">767</span> <span class="bp">-</span> <span class="n">leanruntest_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
<span class="bp">~~</span>        <span class="mi">815</span> <span class="bp">-</span> <span class="n">leanruntest_exhaustive_vm_impl_test</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span><span class="bp">~~</span>
        <span class="mi">1127</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemma_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1157</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch_alg_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1247</span> <span class="bp">-</span> <span class="n">leanruntest_using_smt2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>



<a name="197507525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197507525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197507525">(May 14 2020 at 05:32)</a>:</h4>
<p>I'm removing <code>gcd</code> from core. Is that ok? Or is this something that should strictly stay there for VM reasons?</p>



<a name="197507761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197507761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197507761">(May 14 2020 at 05:39)</a>:</h4>
<p>I don't think so. It does seem a bit out of place, come to think of it</p>



<a name="197510140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197510140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197510140">(May 14 2020 at 06:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  Ok, then I feel good about removing it from the <code>exhaustive_vm_impl_test</code>.</p>



<a name="197511565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511565">(May 14 2020 at 06:53)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Do we want all these <code>smt</code> and <code>eblast</code> tests on <code>ring</code> and <code>field</code> if we are moving those structures out of core? I have no idea what <code>smt</code> and <code>eblast</code> do. I've been able to fix a bunch of tests by changing <code>add_comm</code> to <code>nat.add_comm</code>. But now I'm stuck.</p>



<a name="197511849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511849">(May 14 2020 at 06:54)</a>:</h4>
<p>You should be able to locally define <code>ring</code> and <code>field</code> in the test(s)</p>



<a name="197511863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511863">(May 14 2020 at 06:54)</a>:</h4>
<p>That's not enough, right?</p>



<a name="197511869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511869">(May 14 2020 at 06:54)</a>:</h4>
<p>You also need a ton of supporting lemmas</p>



<a name="197511877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511877">(May 14 2020 at 06:54)</a>:</h4>
<p>they work based on attributes like <code>simp</code> does</p>



<a name="197511893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511893">(May 14 2020 at 06:55)</a>:</h4>
<p>the lemmas don't have to be proven</p>



<a name="197511894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511894">(May 14 2020 at 06:55)</a>:</h4>
<p>That's what I mean</p>



<a name="197511899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511899">(May 14 2020 at 06:55)</a>:</h4>
<p>Aha</p>



<a name="197511914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511914">(May 14 2020 at 06:55)</a>:</h4>
<p>But still. It would mean that these tests become quite a bit longer</p>



<a name="197511927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511927">(May 14 2020 at 06:55)</a>:</h4>
<p>I guess it depends on the test</p>



<a name="197511976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197511976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197511976">(May 14 2020 at 06:56)</a>:</h4>
<p>For 56 tests I could do it (-;</p>



<a name="197512011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512011">(May 14 2020 at 06:56)</a>:</h4>
<p>I mean, is it something that is actually integration testing all these attributes in a library, or is it some particular feature of smt</p>



<a name="197512018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512018">(May 14 2020 at 06:57)</a>:</h4>
<p>I can also dump <code>init/algebra</code> in <code>tests/lean/run/algebra</code> and import stuff.</p>



<a name="197512026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512026">(May 14 2020 at 06:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197512011">said</a>:</p>
<blockquote>
<p>I mean, is it something that is actually integration testing all these attributes in a library, or is it some particular feature of smt</p>
</blockquote>
<p>How would I know?</p>



<a name="197512035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512035">(May 14 2020 at 06:57)</a>:</h4>
<p>These tests are mostly a mystery to me.</p>



<a name="197512047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512047">(May 14 2020 at 06:57)</a>:</h4>
<p>which one are you looking at now?</p>



<a name="197512049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512049">(May 14 2020 at 06:57)</a>:</h4>
<p>It's code, and if it compiles I'm happy. They mostly don't contain comments explaining what they test.</p>



<a name="197512065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512065">(May 14 2020 at 06:58)</a>:</h4>
<p>Any of</p>
<div class="codehilite"><pre><span></span><code>        <span class="mi">559</span> <span class="bp">-</span> <span class="n">leanruntest_aexp</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">644</span> <span class="bp">-</span> <span class="n">leanruntest_cc_ac5</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">767</span> <span class="bp">-</span> <span class="n">leanruntest_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1127</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemma_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1157</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch_alg_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1247</span> <span class="bp">-</span> <span class="n">leanruntest_using_smt2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>



<a name="197512116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512116">(May 14 2020 at 06:58)</a>:</h4>
<p>I've fixed all the others</p>



<a name="197512259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512259">(May 14 2020 at 07:00)</a>:</h4>
<p><code>aexp.lean</code> doesn't have any algebra in it</p>



<a name="197512280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512280">(May 14 2020 at 07:00)</a>:</h4>
<p>Right... so why is it failing?</p>



<a name="197512292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512292">(May 14 2020 at 07:00)</a>:</h4>
<p>what errors are you getting? <a href="https://github.com/leanprover-community/mathlib/wiki/Minimum-Working-Example-&#40;MWE&#41;">#mwe</a></p>



<a name="197512352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512352">(May 14 2020 at 07:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="mi">8</span> <span class="n">goals</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="n">uname</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">var</span> <span class="n">a_2</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="n">a_3</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_4</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">plus</span> <span class="n">a_2</span> <span class="n">a_3</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="n">a_3</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_4</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">times</span> <span class="n">a_2</span> <span class="n">a_3</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="n">uname</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">var</span> <span class="n">a_2</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="n">a_3</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_4</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">plus</span> <span class="n">a_2</span> <span class="n">a_3</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="n">a_3</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_4</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">times</span> <span class="n">a_2</span> <span class="n">a_3</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>
</code></pre></div>



<a name="197512513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512513">(May 14 2020 at 07:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> You say that it doesn't have any algebra in it. But it is building expressions with <code>*</code> and <code>+</code>.</p>



<a name="197512538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512538">(May 14 2020 at 07:04)</a>:</h4>
<p>I think it is applying those to <code>nat</code>s. And core no longer knows that <code>nat</code> is a <code>comm_semiring</code>. But all the relevant lemmas are there.</p>



<a name="197512563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512563">(May 14 2020 at 07:05)</a>:</h4>
<p>Adding the <code>ematch</code> attribute to <code>nat.zero_mul</code>, <code>nat.zero_add</code>, <code>nat.add_zero</code>, <code>nat.mul_zero</code> didn't help.</p>



<a name="197512650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512650">(May 14 2020 at 07:06)</a>:</h4>
<p>It's weird; I think the theorem being proven is actually true without any axioms about nat</p>



<a name="197512658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512658">(May 14 2020 at 07:07)</a>:</h4>
<p>the only thing that should be necessary is that <code>value</code> has + * 0 1</p>



<a name="197512680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512680">(May 14 2020 at 07:07)</a>:</h4>
<p>I thought it was simplifying <code>0 + x = x</code> and so on but that's not actually needed</p>



<a name="197512691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512691">(May 14 2020 at 07:07)</a>:</h4>
<p>but the proof method is really bizarre</p>



<a name="197512739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197512739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197512739">(May 14 2020 at 07:08)</a>:</h4>
<p>don't try this at home, kids</p>



<a name="197513171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197513171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197513171">(May 14 2020 at 07:14)</a>:</h4>
<p>I just managed to prove the theorem manually using no theorems at all about <code>value</code></p>



<a name="197513445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197513445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197513445">(May 14 2020 at 07:17)</a>:</h4>
<p>What is the state after <code>eblast</code>?</p>



<a name="197513525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197513525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197513525">(May 14 2020 at 07:18)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span> <span class="n">goal</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span><span class="o">,</span>
 <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">}</span>
<span class="n">equalities</span><span class="o">:</span>
<span class="o">{{</span><span class="n">val</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="n">a</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))},</span>
 <span class="o">{</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>
</code></pre></div>



<a name="197514217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514217">(May 14 2020 at 07:26)</a>:</h4>
<p>As a quick primer on how to read the state, each of the lists in "equalities" are collections of terms that smt knows how to prove are equal, and the collection as a whole is closed under taking subterms. What was supposed to happen was that since <code>aval a_a s</code> and <code>a_2</code> are in the same group, and <code>aval a_a_1 s</code> and <code>a</code> are as well, it will deduce that <code>a_2 + a</code> and <code>aval a_a s + aval a_a_1 s</code> are also in the same group, closing the goal. However, they are in different groups. Maybe the typeclass instance on them is different? I suspect that one is addition on <code>nat</code> and the other is addition on <code>value</code>, and the <code>@[reducible]</code> annotation on <code>value</code> is confusing things</p>



<a name="197514333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514333">(May 14 2020 at 07:28)</a>:</h4>
<p>You could try replacing <code>value</code> with <code>nat</code> everywhere and see if that fixes things</p>



<a name="197514373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514373">(May 14 2020 at 07:28)</a>:</h4>
<p>although if so this might just be an actual bug</p>



<a name="197514437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514437">(May 14 2020 at 07:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197514333">said</a>:</p>
<blockquote>
<p>You could try replacing <code>value</code> with <code>nat</code> everywhere and see if that fixes things</p>
</blockquote>
<p>Yup, now the error is gone</p>



<a name="197514684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514684">(May 14 2020 at 07:32)</a>:</h4>
<p>What do the two terms I mentioned look like with pp.all?</p>



<a name="197514740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514740">(May 14 2020 at 07:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> you mean this ¿?</p>
<div class="codehilite"><pre><span></span><code><span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">)</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">),</span>
 <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">)}</span>
<span class="n">equalities</span><span class="o">:</span> <span class="o">{{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span> <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
</code></pre></div>



<a name="197514755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514755">(May 14 2020 at 07:34)</a>:</h4>
<p>after <code>eblast</code></p>



<a name="197514822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514822">(May 14 2020 at 07:34)</a>:</h4>
<p>How do I print them?</p>



<a name="197514828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514828">(May 14 2020 at 07:34)</a>:</h4>
<p><code>goals accomplished</code></p>



<a name="197514841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514841">(May 14 2020 at 07:34)</a>:</h4>
<p>oh, I mean in the broken version</p>



<a name="197514882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514882">(May 14 2020 at 07:35)</a>:</h4>
<p>I mean, sure we could change the statement and fix the test, but that kind of defeats the purpose of having a test</p>



<a name="197514899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514899">(May 14 2020 at 07:36)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">a_3</span> <span class="o">:</span> <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">),</span>
 <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a</span><span class="o">),</span>
 <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">value</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">),</span>
 <span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="o">{</span><span class="mi">1</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">value</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">)}</span>
<span class="n">equalities</span><span class="o">:</span>
<span class="o">{{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)),</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="n">a_2</span> <span class="n">a</span><span class="o">))},</span>
 <span class="o">{</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="n">a_2</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="n">a_2</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="n">a_2</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">value</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">),</span> <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
</code></pre></div>



<a name="197514969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514969">(May 14 2020 at 07:36)</a>:</h4>
<p><code>@has_add.add.{0} nat nat.has_add a_2 a</code><br>
<code>@has_add.add.{0} imp.value nat.has_add (imp.aval a_a s) (imp.aval a_a_1 s)</code></p>



<a name="197514974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514974">(May 14 2020 at 07:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197514882">said</a>:</p>
<blockquote>
<p>I mean, sure we could change the statement and fix the test, but that kind of defeats the purpose of having a test</p>
</blockquote>
<p>Depends on what we're testing, I guess.</p>



<a name="197514990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197514990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197514990">(May 14 2020 at 07:36)</a>:</h4>
<p>the adds are indeed different</p>



<a name="197519133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519133">(May 14 2020 at 07:39)</a>:</h4>
<p>So, what do we do now?</p>



<a name="197519636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519636">(May 14 2020 at 07:45)</a>:</h4>
<p>hm, here's a version of the proof that captures the successful state just before close runs:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">aval_asimp_const</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">)</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a</span> <span class="n">s</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
 <span class="n">induction</span> <span class="n">a</span><span class="o">,</span>
 <span class="n">destruct</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
<span class="o">{</span> <span class="n">destruct</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">ematch</span><span class="o">,</span> <span class="n">ematch</span><span class="o">,</span>
    <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">ematch</span> <span class="bp">&gt;&gt;</span> <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">trace_state</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">admit</span><span class="o">}},</span>
<span class="n">all_goals</span> <span class="o">{</span><span class="n">admit</span><span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">equalities</span><span class="o">:</span>
<span class="bp">...</span>
 <span class="o">{</span><span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">imp</span><span class="bp">.</span><span class="n">value</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">),</span>
  <span class="bp">@</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_add</span> <span class="n">a_2</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">imp</span><span class="bp">.</span><span class="n">aval</span> <span class="o">(</span><span class="n">imp</span><span class="bp">.</span><span class="n">aexp</span><span class="bp">.</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
</code></pre></div>



<a name="197519658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519658">(May 14 2020 at 07:45)</a>:</h4>
<p>I have no idea what that means <span aria-label="oops" class="emoji emoji-1f643" role="img" title="oops">:oops:</span></p>



<a name="197519727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519727">(May 14 2020 at 07:46)</a>:</h4>
<p>I feel a bit like I'm a proxy between the master and the machine...</p>



<a name="197519747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519747">(May 14 2020 at 07:47)</a>:</h4>
<p>I've used smt a grand total of 0 times ever, but I know the theory</p>



<a name="197519774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519774">(May 14 2020 at 07:47)</a>:</h4>
<p>there is a commented out trace option for smt, what does that show?</p>



<a name="197519864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519864">(May 14 2020 at 07:48)</a>:</h4>
<p><code>pp.all</code> or not?</p>



<a name="197519877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519877">(May 14 2020 at 07:48)</a>:</h4>
<p>With <code>pp.all</code> you'll get a crapton of shit</p>



<a name="197519917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519917">(May 14 2020 at 07:49)</a>:</h4>
<p>Use my version of the proof</p>



<a name="197519926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519926">(May 14 2020 at 07:49)</a>:</h4>
<p>just posted above</p>



<a name="197519939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197519939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197519939">(May 14 2020 at 07:49)</a>:</h4>
<p>it stops at the first interesting point</p>



<a name="197520025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520025">(May 14 2020 at 07:50)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">65</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span>

<span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">65</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">2</span>
<span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">2</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span>
</code></pre></div>



<a name="197520075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520075">(May 14 2020 at 07:51)</a>:</h4>
<p>And</p>
<div class="codehilite"><pre><span></span><code><span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">66</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">3</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">3</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span><span class="o">,</span>
 <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">}</span>
<span class="n">equalities</span><span class="o">:</span>
<span class="o">{{</span><span class="n">val</span> <span class="n">a</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))},</span>
 <span class="o">{</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>
</code></pre></div>



<a name="197520246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520246">(May 14 2020 at 07:53)</a>:</h4>
<p>For comparison, here is my version:</p>
<div class="codehilite"><pre><span></span><code><span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">64</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span>
<span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">64</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">2</span>
<span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">2</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span>
<span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">65</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">3</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">3</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span>
 <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span><span class="o">,</span>
 <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">}</span>
<span class="n">equalities</span><span class="o">:</span>
<span class="o">{{</span><span class="n">val</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="n">a</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))},</span>
 <span class="o">{</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>
</code></pre></div>



<a name="197520340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520340">(May 14 2020 at 07:54)</a>:</h4>
<p>Am I supposed to solve some problem now? I still have no clue what I'm looking for.</p>



<a name="197520369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520369">(May 14 2020 at 07:55)</a>:</h4>
<p>I think that I would like to learn about SMT, but maybe not while trying  to get algebra out of core (-;</p>



<a name="197520413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520413">(May 14 2020 at 07:55)</a>:</h4>
<p>I'm just diffing</p>



<a name="197520594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520594">(May 14 2020 at 07:58)</a>:</h4>
<p>I'm ~60% sure you've uncovered a bug in smt, but given that I don't know what we should do about it</p>



<a name="197520616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520616">(May 14 2020 at 07:58)</a>:</h4>
<p>no one uses it or knows how it works</p>



<a name="197520684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197520684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197520684">(May 14 2020 at 07:59)</a>:</h4>
<p>And <code>smt</code> is 96% C++, I guess</p>



<a name="197521331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197521331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197521331">(May 14 2020 at 08:07)</a>:</h4>
<p>Aha, I think this might be relevant:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">aval_asimp_const</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">)</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a</span> <span class="n">s</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
  <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">get_lemmas</span> <span class="bp">&gt;&gt;=</span> <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">trace</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="o">{[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)}}],</span>
<span class="bp">...</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">one_mul</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">1</span> <span class="bp">*</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">zero_add</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">mul_one</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">zero_mul</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">0</span> <span class="bp">*</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">mul_zero</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">*</span> <span class="mi">0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="o">(</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_right</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="o">(</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">min_eq_right</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">min</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">min_eq_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">min</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span><span class="o">}}]}</span>
</code></pre></div>



<a name="197521363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197521363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197521363">(May 14 2020 at 08:07)</a>:</h4>
<p>I assume if you run the same thing most of those theorems won't be listed</p>



<a name="197521583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197521583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197521583">(May 14 2020 at 08:10)</a>:</h4>
<p>Try adding</p>
<div class="codehilite"><pre><span></span><code><span class="n">attribute</span> <span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="n">zero_add</span> <span class="n">add_zero</span> <span class="n">mul_one</span> <span class="n">zero_mul</span> <span class="n">mul_zero</span>
  <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_left</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_right</span> <span class="n">min_eq_right</span> <span class="n">min_eq_left</span>
</code></pre></div>


<p>and see if it fixes the issue</p>



<a name="197521597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197521597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197521597">(May 14 2020 at 08:10)</a>:</h4>
<p>and then remove lemmas until it breaks again</p>



<a name="197522910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197522910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197522910">(May 14 2020 at 08:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I'm back. (Had to put my daughter in bed.) With those attributes, the goal is still</p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span> <span class="n">goal</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">,</span>
<span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">a_ih_a</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_ih_a_1</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
<span class="n">a_2</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span><span class="o">,</span>
 <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">}</span>
<span class="n">equalities</span><span class="o">:</span>
<span class="o">{{</span><span class="n">val</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="n">a</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))},</span>
 <span class="o">{</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>
</code></pre></div>


<p>just before <code>end</code>.</p>



<a name="197523137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523137">(May 14 2020 at 08:27)</a>:</h4>
<p>Oh, I missed a couple: <code>nat.add_sub_cancel nat.add_sub_cancel_left</code></p>



<a name="197523255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523255">(May 14 2020 at 08:28)</a>:</h4>
<p>Too bad, peanut spread...<br>
It's still unhappy.</p>



<a name="197523453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523453">(May 14 2020 at 08:30)</a>:</h4>
<p>What do you get for this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">attribute</span> <span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="n">zero_add</span> <span class="n">add_zero</span> <span class="n">mul_one</span> <span class="n">zero_mul</span> <span class="n">mul_zero</span>
  <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_left</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_right</span> <span class="n">min_eq_right</span> <span class="n">min_eq_left</span>
  <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span>
<span class="kn">lemma</span> <span class="n">aval_asimp_const</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">)</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a</span> <span class="n">s</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
  <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">get_lemmas</span> <span class="bp">&gt;&gt;=</span> <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">trace</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="o">{[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_5</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_5</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="err">?</span><span class="n">x_0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_6</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_7</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_7</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_6</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">one_mul</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">1</span> <span class="bp">*</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">zero_add</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">mul_one</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">zero_mul</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">0</span> <span class="bp">*</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">mul_zero</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">*</span> <span class="mi">0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="o">(</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_right</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="o">(</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">min_eq_right</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">min</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">min_eq_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">min</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span><span class="o">}}]}</span>
</code></pre></div>



<a name="197523527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523527">(May 14 2020 at 08:31)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">{[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">mul_one</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">zero_add</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_5</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">one_mul</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">1</span> <span class="bp">*</span> <span class="err">?</span><span class="n">x_0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_5</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">mul_zero</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">*</span> <span class="mi">0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">zero_mul</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="mi">0</span> <span class="bp">*</span> <span class="err">?</span><span class="n">x_0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">var</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="err">?</span><span class="n">x_0</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_6</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_7</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_7</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_6</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_2</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="err">?</span><span class="n">x_0</span><span class="o">)</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_4</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">imp</span><span class="bp">.</span><span class="n">aval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="err">?</span><span class="n">x_0</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_2</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="o">(</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_2</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_right</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="err">?</span><span class="n">x_0</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span> <span class="bp">-</span> <span class="o">(</span><span class="err">?</span><span class="n">x_2</span> <span class="bp">+</span> <span class="err">?</span><span class="n">x_1</span><span class="o">)}}],</span>
 <span class="o">[</span><span class="n">min_eq_right</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">min</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span><span class="o">}}],</span>
 <span class="o">[</span><span class="n">min_eq_left</span><span class="o">,</span> <span class="n">patterns</span><span class="o">:</span> <span class="o">{{</span><span class="n">min</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span><span class="o">}}]}</span>
</code></pre></div>



<a name="197523692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523692">(May 14 2020 at 08:32)</a>:</h4>
<p>oh, you are using <code>nat.mul_one</code> instead of <code>mul_one</code> et al</p>



<a name="197523730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523730">(May 14 2020 at 08:32)</a>:</h4>
<p><code>mul_one</code> doesn't exist</p>



<a name="197523759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197523759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197523759">(May 14 2020 at 08:32)</a>:</h4>
<p>try replicating <code>mul_one</code> in this file, i.e. define a dummy <code>ring</code> and the lemmas</p>



<a name="197524117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524117">(May 14 2020 at 08:36)</a>:</h4>
<p>Here's my theory: <code>ematch</code> isn't actually smart enough to realize that <code>@has_add.add nat nat.has_add</code> and <code>@has_add.add value nat.has_add</code> are the same thing, but when it tries to apply one of these typeclass theorems it is forced to unfold <code>value</code> in order to make the second thing typecheck, and then it all works</p>



<a name="197524388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524388">(May 14 2020 at 08:39)</a>:</h4>
<p>Like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">semiring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_zero</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_one</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_add</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_mul</span> <span class="n">α</span><span class="bp">.</span>

<span class="kn">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">semiring</span> <span class="bp">ℕ</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">add</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">+</span><span class="o">),</span>
  <span class="n">mul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">}</span>

<span class="kn">section</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>

<span class="kn">lemma</span> <span class="n">zero_add</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">α</span><span class="o">)</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">add_zero</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">zero_mul</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">α</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">mul_zero</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">one_mul</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">α</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">mul_one</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">end</span>
</code></pre></div>



<a name="197524466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524466">(May 14 2020 at 08:39)</a>:</h4>
<p>Mark them all <code>@[ematch]</code>, otherwise yes</p>



<a name="197524555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524555">(May 14 2020 at 08:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">attribute</span> <span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="n">zero_add</span> <span class="n">add_zero</span> <span class="n">mul_one</span> <span class="n">zero_mul</span> <span class="n">mul_zero</span>
  <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_left</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_add_right</span> <span class="n">min_eq_right</span> <span class="n">min_eq_left</span>
  <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel_left</span>

<span class="kn">lemma</span> <span class="n">aval_asimp_const</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">state</span><span class="o">)</span> <span class="o">:</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a</span> <span class="n">s</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
  <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">get_lemmas</span> <span class="bp">&gt;&gt;=</span> <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">trace</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">aexp</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">91</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span>
<span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">a</span> <span class="o">:</span> <span class="n">aexp</span><span class="o">,</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">state</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a</span> <span class="n">s</span>
</code></pre></div>



<a name="197524606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524606">(May 14 2020 at 08:40)</a>:</h4>
<p>you get no output?</p>



<a name="197524682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524682">(May 14 2020 at 08:41)</a>:</h4>
<p>You should go back to the original test, that was just diagnostics</p>



<a name="197524757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524757">(May 14 2020 at 08:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">a_3</span> <span class="o">:</span> <span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span>
<span class="n">facts</span><span class="o">:</span>
<span class="o">{</span><span class="n">asimp_const</span> <span class="n">a_a</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a_2</span><span class="o">,</span>
 <span class="n">asimp_const</span> <span class="n">a_a_1</span> <span class="bp">=</span> <span class="n">val</span> <span class="n">a</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span>
 <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">}</span>
<span class="n">equalities</span><span class="o">:</span>
<span class="o">{{</span><span class="n">val</span> <span class="n">a</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span> <span class="bp">-</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">),</span> <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span> <span class="bp">-</span> <span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)),</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))},</span>
 <span class="o">{</span><span class="n">has_add</span><span class="bp">.</span><span class="n">add</span> <span class="o">(</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span><span class="o">),</span> <span class="n">has_add</span><span class="bp">.</span><span class="n">add</span> <span class="n">a_2</span><span class="o">},</span>
 <span class="o">{</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a</span><span class="o">)</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="n">a_a_1</span><span class="o">),</span>
  <span class="n">asimp_const</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">val</span> <span class="n">a_2</span><span class="o">)</span> <span class="o">(</span><span class="n">val</span> <span class="n">a</span><span class="o">)},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">val</span> <span class="o">(</span><span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">))</span> <span class="n">s</span><span class="o">,</span> <span class="n">a_2</span> <span class="bp">+</span> <span class="n">a</span><span class="o">},</span>
 <span class="o">{</span><span class="n">aval</span> <span class="n">a_a</span> <span class="n">s</span> <span class="bp">+</span> <span class="n">aval</span> <span class="n">a_a_1</span> <span class="n">s</span><span class="o">,</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span><span class="o">}}</span>
<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">plus</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>

<span class="err">⊢</span> <span class="n">aval</span> <span class="o">(</span><span class="n">asimp_const</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">aval</span> <span class="o">(</span><span class="n">times</span> <span class="n">a_a</span> <span class="n">a_a_1</span><span class="o">)</span> <span class="n">s</span>
</code></pre></div>



<a name="197524847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524847">(May 14 2020 at 08:43)</a>:</h4>
<p>nooo</p>



<a name="197524888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524888">(May 14 2020 at 08:44)</a>:</h4>
<p>WTH <code>aval a_a s + aval a_a_1 s</code> literally appears in two equality classes</p>



<a name="197524930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197524930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197524930">(May 14 2020 at 08:44)</a>:</h4>
<p>it must be the two versions of it</p>



<a name="197525110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525110">(May 14 2020 at 08:46)</a>:</h4>
<p>Okay, my curiosity is satisfied. Let's just replace <code>value</code> with <code>nat</code> for the PR and maybe file an issue about this for later</p>



<a name="197525162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525162">(May 14 2020 at 08:46)</a>:</h4>
<p>Are you ready for the next test?</p>



<a name="197525181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525181">(May 14 2020 at 08:46)</a>:</h4>
<p>heh, I hope it's the same story 8 times</p>



<a name="197525236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525236">(May 14 2020 at 08:47)</a>:</h4>
<p><code>cc_ac5.lean</code> - is this one not fixed with ac instances for + and * ?</p>



<a name="197525317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525317">(May 14 2020 at 08:48)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">niverse</span> <span class="kn">variables</span> <span class="n">u</span>

<span class="n">class</span> <span class="n">ring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_mul</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_add</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_assoc</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">))</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">ring</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="kn">instance</span> <span class="n">aa</span> <span class="o">:</span> <span class="n">is_associative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">ring</span><span class="bp">.</span><span class="n">add_assoc</span><span class="bp">⟩</span>
<span class="kn">instance</span> <span class="n">ac</span> <span class="o">:</span> <span class="n">is_commutative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">ring</span><span class="bp">.</span><span class="n">add_comm</span><span class="bp">⟩</span>
<span class="kn">constant</span> <span class="n">ma</span> <span class="o">:</span> <span class="n">is_associative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">lc</span> <span class="o">:</span> <span class="n">is_left_cancel</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">rc</span> <span class="o">:</span> <span class="n">is_right_cancel</span> <span class="n">α</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">ld</span> <span class="o">:</span> <span class="n">is_left_distrib</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>
<span class="kn">constant</span> <span class="n">rd</span> <span class="o">:</span> <span class="n">is_right_distrib</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="bp">+</span><span class="o">)</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x1</span> <span class="n">x2</span> <span class="n">x3</span> <span class="n">x4</span> <span class="n">x5</span> <span class="n">x6</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">x1</span><span class="bp">*</span><span class="n">x4</span> <span class="bp">=</span> <span class="n">x1</span> <span class="bp">→</span> <span class="n">x3</span><span class="bp">*</span><span class="n">x6</span> <span class="bp">=</span> <span class="n">x5</span><span class="bp">*</span><span class="n">x5</span> <span class="bp">→</span> <span class="n">x5</span> <span class="bp">=</span> <span class="n">x4</span> <span class="bp">→</span> <span class="n">x6</span> <span class="bp">=</span> <span class="n">x2</span> <span class="bp">→</span> <span class="n">x1</span> <span class="bp">=</span> <span class="n">x1</span><span class="bp">*</span><span class="o">(</span><span class="n">x6</span><span class="bp">*</span><span class="n">x3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cc</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">y1</span> <span class="n">y2</span> <span class="n">x2</span> <span class="n">x3</span> <span class="n">x4</span> <span class="n">x5</span> <span class="n">x6</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="o">)</span><span class="bp">*</span><span class="n">x4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x3</span><span class="bp">*</span><span class="n">x6</span> <span class="bp">=</span> <span class="n">x5</span><span class="bp">*</span><span class="n">x5</span> <span class="bp">→</span> <span class="n">x5</span> <span class="bp">=</span> <span class="n">x4</span> <span class="bp">→</span> <span class="n">x6</span> <span class="bp">=</span> <span class="n">x2</span> <span class="bp">→</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="n">x6</span><span class="bp">*</span><span class="n">x3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cc</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">y1</span> <span class="n">y2</span> <span class="n">y3</span> <span class="n">x2</span> <span class="n">x3</span> <span class="n">x4</span> <span class="n">x5</span> <span class="n">x6</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="o">)</span><span class="bp">*</span><span class="n">x4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y3</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x3</span><span class="bp">*</span><span class="n">x6</span> <span class="bp">=</span> <span class="n">x5</span><span class="bp">*</span><span class="n">x5</span> <span class="bp">→</span> <span class="n">x5</span> <span class="bp">=</span> <span class="n">x4</span> <span class="bp">→</span> <span class="n">x6</span> <span class="bp">=</span> <span class="n">x2</span> <span class="bp">→</span> <span class="n">y2</span> <span class="bp">=</span> <span class="n">y3</span> <span class="bp">→</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">+</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y1</span> <span class="bp">+</span> <span class="n">y3</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="n">x6</span><span class="bp">*</span><span class="n">x3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cc</span>
</code></pre></div>


<p>is what I have so far</p>



<a name="197525343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525343">(May 14 2020 at 08:49)</a>:</h4>
<p><code>cc</code> fails on all three tests.</p>



<a name="197525628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525628">(May 14 2020 at 08:52)</a>:</h4>
<p>it's a commutative ring</p>



<a name="197525716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525716">(May 14 2020 at 08:53)</a>:</h4>
<p>Nope it's not. The <code>[ring \a]</code> was from the original test.</p>



<a name="197525736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525736">(May 14 2020 at 08:53)</a>:</h4>
<p>Also, adding commutativity of <code>*</code> doesn't make <code>cc</code> happy.</p>



<a name="197525749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525749">(May 14 2020 at 08:53)</a>:</h4>
<p>not in my copy</p>



<a name="197525760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525760">(May 14 2020 at 08:54)</a>:</h4>
<p>Oh, weird.</p>



<a name="197525957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197525957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197525957">(May 14 2020 at 08:56)</a>:</h4>
<p>If you use </p>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="n">ma</span> <span class="o">:</span> <span class="n">is_associative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">sorry</span><span class="bp">⟩</span>
<span class="kn">instance</span> <span class="n">mc</span> <span class="o">:</span> <span class="n">is_commutative</span> <span class="n">α</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">sorry</span><span class="bp">⟩</span>
</code></pre></div>


<p>instead of <code>constant ma : is_associative ...</code>  it works</p>



<a name="197526013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526013">(May 14 2020 at 08:56)</a>:</h4>
<p>I think lean likes to be able to unfold instances to constructors</p>



<a name="197526026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526026">(May 14 2020 at 08:56)</a>:</h4>
<p>Aha</p>



<a name="197526029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526029">(May 14 2020 at 08:56)</a>:</h4>
<p>even if there isn't anything past that</p>



<a name="197526050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526050">(May 14 2020 at 08:56)</a>:</h4>
<p>you could use an axiom in place of the sorry</p>



<a name="197526191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526191">(May 14 2020 at 08:58)</a>:</h4>
<p>Ok, thanks. That worked. 2 down, 8 to go.</p>



<a name="197526209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526209">(May 14 2020 at 08:58)</a>:</h4>
<p><code>leanruntest_cpdt.lean</code></p>



<a name="197526239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526239">(May 14 2020 at 08:59)</a>:</h4>
<p>oh boy, <code>rsimp</code></p>



<a name="197526295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526295">(May 14 2020 at 08:59)</a>:</h4>
<p>this one uses smt, so it might be the same bug</p>



<a name="197526315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526315">(May 14 2020 at 09:00)</a>:</h4>
<p>it's also practically the same problem</p>



<a name="197526399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526399">(May 14 2020 at 09:00)</a>:</h4>
<p>what error do you get?</p>



<a name="197526418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526418">(May 14 2020 at 09:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="c">/-</span><span class="cm"> &quot;Proving in the Large&quot; chapter of CPDT -/</span>

<span class="kn">inductive</span> <span class="n">exp</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">Const</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">exp</span>
<span class="bp">|</span> <span class="n">Plus</span> <span class="o">(</span><span class="n">e1</span> <span class="n">e2</span> <span class="o">:</span> <span class="n">exp</span><span class="o">)</span> <span class="o">:</span> <span class="n">exp</span>
<span class="bp">|</span> <span class="n">Mult</span> <span class="o">(</span><span class="n">e1</span> <span class="n">e2</span> <span class="o">:</span> <span class="n">exp</span><span class="o">)</span> <span class="o">:</span> <span class="n">exp</span>

<span class="kn">open</span> <span class="n">exp</span>

<span class="n">def</span> <span class="n">eeval</span> <span class="o">:</span> <span class="n">exp</span> <span class="bp">→</span> <span class="n">nat</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>    <span class="o">:=</span> <span class="n">n</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="o">:=</span> <span class="n">eeval</span> <span class="n">e1</span> <span class="bp">+</span> <span class="n">eeval</span> <span class="n">e2</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Mult</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="o">:=</span> <span class="n">eeval</span> <span class="n">e1</span> <span class="bp">*</span> <span class="n">eeval</span> <span class="n">e2</span>

<span class="n">def</span> <span class="n">times</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">exp</span> <span class="bp">→</span> <span class="n">exp</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>    <span class="o">:=</span> <span class="n">Const</span> <span class="o">(</span><span class="n">k</span> <span class="bp">*</span> <span class="n">n</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Plus</span> <span class="o">(</span><span class="n">times</span> <span class="n">e1</span><span class="o">)</span> <span class="o">(</span><span class="n">times</span> <span class="n">e2</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Mult</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Mult</span> <span class="o">(</span><span class="n">times</span> <span class="n">e1</span><span class="o">)</span> <span class="n">e2</span>

<span class="n">def</span> <span class="n">reassoc</span> <span class="o">:</span> <span class="n">exp</span> <span class="bp">→</span> <span class="n">exp</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>    <span class="o">:=</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">e1&#39;</span> <span class="o">:=</span> <span class="n">reassoc</span> <span class="n">e1</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">e2&#39;</span> <span class="o">:=</span> <span class="n">reassoc</span> <span class="n">e2</span> <span class="k">in</span>
  <span class="k">match</span> <span class="n">e2&#39;</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e21</span> <span class="n">e22</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Plus</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1&#39;</span> <span class="n">e21</span><span class="o">)</span> <span class="n">e22</span>
  <span class="bp">|</span> <span class="bp">_</span>              <span class="o">:=</span> <span class="n">Plus</span> <span class="n">e1&#39;</span> <span class="n">e2&#39;</span>
  <span class="kn">end</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">Mult</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">e1&#39;</span> <span class="o">:=</span> <span class="n">reassoc</span> <span class="n">e1</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">e2&#39;</span> <span class="o">:=</span> <span class="n">reassoc</span> <span class="n">e2</span> <span class="k">in</span>
  <span class="k">match</span> <span class="n">e2&#39;</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="o">(</span><span class="n">Mult</span> <span class="n">e21</span> <span class="n">e22</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Mult</span> <span class="o">(</span><span class="n">Mult</span> <span class="n">e1&#39;</span> <span class="n">e21</span><span class="o">)</span> <span class="n">e22</span>
  <span class="bp">|</span> <span class="bp">_</span>              <span class="o">:=</span> <span class="n">Mult</span> <span class="n">e1&#39;</span> <span class="n">e2&#39;</span>
  <span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul_left_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="n">m</span> <span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">n</span> <span class="bp">*</span> <span class="o">(</span><span class="n">m</span> <span class="bp">*</span> <span class="n">k</span><span class="o">)</span> <span class="bp">=</span> <span class="n">m</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">*</span> <span class="n">k</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">nat</span><span class="bp">.</span><span class="n">left_distrib</span> <span class="n">nat</span><span class="bp">.</span><span class="n">right_distrib</span> <span class="n">times</span> <span class="n">reassoc</span> <span class="n">eeval</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul_comm</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul_assoc</span>

<span class="kn">theorem</span> <span class="n">eeval_times</span> <span class="o">(</span><span class="n">k</span> <span class="n">e</span><span class="o">)</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">times</span> <span class="n">k</span> <span class="n">e</span><span class="o">)</span> <span class="bp">=</span> <span class="n">k</span> <span class="bp">*</span> <span class="n">eeval</span> <span class="n">e</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">induction</span> <span class="n">e</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">reassoc_correct</span> <span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">induction</span> <span class="n">e</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span><span class="bp">;</span> <span class="n">cases</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e2</span><span class="o">)</span><span class="bp">;</span> <span class="n">rsimp</span>
</code></pre></div>


<p>The first one is happy.</p>



<a name="197526439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526439">(May 14 2020 at 09:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">e_e1</span> <span class="n">e_e2</span> <span class="o">:</span> <span class="n">exp</span><span class="o">,</span>
<span class="n">e_ih_e1</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span><span class="o">,</span>
<span class="n">e1</span> <span class="n">e2</span> <span class="o">:</span> <span class="n">exp</span><span class="o">,</span>
<span class="n">e_ih_e2</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e2</span>
<span class="err">⊢</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="o">(</span><span class="n">Plus</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="n">e1</span><span class="o">)</span> <span class="n">e2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span> <span class="bp">+</span> <span class="n">eeval</span> <span class="n">e_e2</span>
</code></pre></div>



<a name="197526461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526461">(May 14 2020 at 09:01)</a>:</h4>
<p>you left off <code>mul_left_comm</code></p>



<a name="197526516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526516">(May 14 2020 at 09:02)</a>:</h4>
<p>It's tagged simp just above</p>



<a name="197526517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197526517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197526517">(May 14 2020 at 09:02)</a>:</h4>
<p>oh wait nvm</p>



<a name="197527590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197527590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197527590">(May 14 2020 at 09:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">ematch_attr_to_defs</span>
<span class="c1">------------------------</span>
<span class="kn">universe</span> <span class="kn">variables</span> <span class="n">u</span>
<span class="kn">variable</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="n">def</span> <span class="n">app</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>     <span class="n">l</span> <span class="o">:=</span> <span class="n">l</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">h</span><span class="bp">::</span><span class="n">t</span><span class="o">)</span> <span class="n">l</span> <span class="o">:=</span> <span class="n">h</span> <span class="bp">::</span> <span class="n">app</span> <span class="n">t</span> <span class="n">l</span>

<span class="c">/-</span><span class="cm"> Mark the app equational lemmas as ematching rules -/</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="n">app</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">app_nil_right</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">app</span> <span class="n">l</span> <span class="o">[]</span> <span class="bp">=</span> <span class="n">l</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
  <span class="n">induction</span> <span class="n">l</span><span class="o">,</span>
  <span class="n">ematch</span><span class="o">,</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">app_assoc</span> <span class="o">(</span><span class="n">l₁</span> <span class="n">l₂</span> <span class="n">l₃</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">app</span> <span class="o">(</span><span class="n">app</span> <span class="n">l₁</span> <span class="n">l₂</span><span class="o">)</span> <span class="n">l₃</span> <span class="bp">=</span> <span class="n">app</span> <span class="n">l₁</span> <span class="o">(</span><span class="n">app</span> <span class="n">l₂</span> <span class="n">l₃</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
  <span class="n">induction</span> <span class="n">l₁</span><span class="o">,</span>
  <span class="n">ematch</span><span class="o">,</span>
  <span class="n">ematch</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">len</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">nat</span>
<span class="bp">|</span> <span class="o">[]</span>       <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">len</span> <span class="n">l</span> <span class="bp">+</span> <span class="mi">1</span>

<span class="n">attribute</span> <span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="n">len</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_zero</span> <span class="n">nat</span><span class="bp">.</span><span class="n">zero_add</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">len_app</span> <span class="o">(</span><span class="n">l₁</span> <span class="n">l₂</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">len</span> <span class="o">(</span><span class="n">app</span> <span class="n">l₁</span> <span class="n">l₂</span><span class="o">)</span> <span class="bp">=</span> <span class="n">len</span> <span class="n">l₁</span> <span class="bp">+</span> <span class="n">len</span> <span class="n">l₂</span> <span class="o">:=</span>
<span class="k">begin</span> <span class="o">[</span><span class="n">smt</span><span class="o">]</span>
  <span class="n">induction</span> <span class="n">l₁</span><span class="o">,</span>
  <span class="o">{</span><span class="n">ematch</span><span class="o">,</span> <span class="n">ematch</span><span class="o">},</span>
  <span class="o">{</span><span class="n">ematch</span><span class="o">,</span> <span class="n">ematch</span><span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>


<p>This one is also confusing me.</p>



<a name="197527733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197527733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197527733">(May 14 2020 at 09:16)</a>:</h4>
<p>I think we should just file the ematch based tests away</p>



<a name="197527834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197527834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197527834">(May 14 2020 at 09:17)</a>:</h4>
<p>I remember there was some bug in ematch that we found 2 years ago and couldn't do anything about, something to do with multiple typeclasses causing problems for category theory, and we basically banned ematch based proofs from mathlib then</p>



<a name="197527949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197527949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197527949">(May 14 2020 at 09:19)</a>:</h4>
<p>I managed to fix another test in the mean time</p>



<a name="197527958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197527958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197527958">(May 14 2020 at 09:19)</a>:</h4>
<p>The list is now</p>
<div class="codehilite"><pre><span></span><code>        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">767</span> <span class="bp">-</span> <span class="n">leanruntest_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1127</span> <span class="bp">-</span> <span class="n">leanruntest_simp_lemma_issue</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1247</span> <span class="bp">-</span> <span class="n">leanruntest_using_smt2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>



<a name="197528265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197528265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197528265">(May 14 2020 at 09:22)</a>:</h4>
<p>How about this</p>
<div class="codehilite"><pre><span></span><code><span class="kn">universe</span> <span class="kn">variables</span> <span class="n">u</span>

<span class="n">class</span> <span class="n">comm_semiring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_zero</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_add</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_one</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_mul</span> <span class="n">α</span><span class="bp">.</span>

<span class="kn">lemma</span> <span class="n">zero_add</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">α</span><span class="o">)</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">add_zero</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">ex</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="n">zero_add</span> <span class="n">a</span>

<span class="c1">-- local attribute [-simp] zero_add add_zero</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">ex</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">simp</span> <span class="c1">-- !!! FAILS :shock:</span>

<span class="c1">-- local attribute [-ematch] zero_add add_zero</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">ematch</span><span class="o">]</span> <span class="n">ex</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">using_smt</span> <span class="err">$</span> <span class="n">smt_tactic</span><span class="bp">.</span><span class="n">eblast</span> <span class="c1">-- fails :not_surprised:</span>
</code></pre></div>



<a name="197528284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197528284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197528284">(May 14 2020 at 09:23)</a>:</h4>
<p>Ooh, nvm... <code>nat</code> is not a comm_semiring</p>



<a name="197528349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197528349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197528349">(May 14 2020 at 09:23)</a>:</h4>
<p>That one's fixed.</p>



<a name="197528669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197528669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197528669">(May 14 2020 at 09:27)</a>:</h4>
<div class="codehilite"><pre><span></span><code>        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">767</span> <span class="bp">-</span> <span class="n">leanruntest_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1247</span> <span class="bp">-</span> <span class="n">leanruntest_using_smt2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>



<a name="197529158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197529158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197529158">(May 14 2020 at 09:31)</a>:</h4>
<p>is cpdt fixed with a fake ring instance?</p>



<a name="197529305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197529305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197529305">(May 14 2020 at 09:32)</a>:</h4>
<p>from the names it looks like everything that remains is ematch related, so let's just comment out these tests</p>



<a name="197529584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197529584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197529584">(May 14 2020 at 09:35)</a>:</h4>
<p>Is <code>ematch2.lean</code> not fixed with a fake instance?</p>



<a name="197529756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197529756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197529756">(May 14 2020 at 09:37)</a>:</h4>
<p>The last <code>blast</code> in <code>ematch2</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="n">p</span> <span class="n">m</span> <span class="n">n</span> <span class="n">q</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">xs</span> <span class="o">:</span> <span class="n">tuple</span> <span class="n">α</span> <span class="n">m</span><span class="o">,</span>
<span class="n">ys</span> <span class="o">:</span> <span class="n">tuple</span> <span class="n">α</span> <span class="n">n</span><span class="o">,</span>
<span class="n">zs</span> <span class="o">:</span> <span class="n">tuple</span> <span class="n">α</span> <span class="n">p</span><span class="o">,</span>
<span class="n">ws</span> <span class="o">:</span> <span class="n">tuple</span> <span class="n">α</span> <span class="n">q</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">m</span><span class="o">,</span>
<span class="n">a_1</span> <span class="o">:</span> <span class="n">zs</span> <span class="bp">==</span> <span class="n">xs</span> <span class="bp">++</span> <span class="n">ys</span>
<span class="err">⊢</span> <span class="n">zs</span> <span class="bp">++</span> <span class="n">ws</span> <span class="bp">==</span> <span class="n">xs</span> <span class="bp">++</span> <span class="o">(</span><span class="n">ys</span> <span class="bp">++</span> <span class="n">ws</span><span class="o">)</span>
</code></pre></div>



<a name="197530003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530003">(May 14 2020 at 09:40)</a>:</h4>
<p>I think it needs <code>add_assoc</code> on nat</p>



<a name="197530070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530070">(May 14 2020 at 09:41)</a>:</h4>
<p>try <code>attribute [ematch] nat.add_assoc</code></p>



<a name="197530218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530218">(May 14 2020 at 09:42)</a>:</h4>
<p>oh crap, I just realized the implications of the <code>@[no_rsimp]</code> attribute</p>



<a name="197530381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530381">(May 14 2020 at 09:44)</a>:</h4>
<p>From the end of cpdt:</p>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">semiring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_mul</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_add</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_one</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_zero</span> <span class="n">α</span><span class="bp">.</span>

<span class="kn">instance</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">nat</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">add</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">+</span><span class="o">),</span> <span class="n">mul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="o">}</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>

<span class="kn">lemma</span> <span class="n">left_distrib</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">right_distrib</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">mul_comm</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">mul_assoc</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">lemma</span> <span class="n">mul_left_comm</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">left_distrib</span> <span class="n">right_distrib</span> <span class="n">times</span> <span class="n">reassoc</span> <span class="n">eeval</span> <span class="n">mul_comm</span> <span class="n">mul_assoc</span> <span class="n">mul_left_comm</span>

<span class="kn">theorem</span> <span class="n">eeval_times</span> <span class="o">(</span><span class="n">k</span> <span class="n">e</span><span class="o">)</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">times</span> <span class="n">k</span> <span class="n">e</span><span class="o">)</span> <span class="bp">=</span> <span class="n">k</span> <span class="bp">*</span> <span class="n">eeval</span> <span class="n">e</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">induction</span> <span class="n">e</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">reassoc_correct</span> <span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">induction</span> <span class="n">e</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span><span class="bp">;</span> <span class="n">cases</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e2</span><span class="o">)</span><span class="bp">;</span> <span class="n">rsimp</span> <span class="c1">-- still fails</span>
</code></pre></div>



<a name="197530435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530435">(May 14 2020 at 09:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/moving.20algebra.20out.20of.20core/near/197530070">said</a>:</p>
<blockquote>
<p>try <code>attribute [ematch] nat.add_assoc</code></p>
</blockquote>
<p>This didn't help.</p>



<a name="197530681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530681">(May 14 2020 at 09:47)</a>:</h4>
<p>What do you get in cpdt with <code>set_option trace.smt true</code>?</p>



<a name="197530733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197530733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197530733">(May 14 2020 at 09:47)</a>:</h4>
<p>I think the second block is the first one that fails</p>



<a name="197531296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197531296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197531296">(May 14 2020 at 09:53)</a>:</h4>
<p>test <code>ematch2</code> is now fixed. <code>smt_ematch2</code> is still a problem.<br>
Let me look at <code>cpdt</code> again.</p>



<a name="197531401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197531401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197531401">(May 14 2020 at 09:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code> <span class="n">Freeze</span> <span class="n">display</span>
<span class="n">Tactic</span> <span class="n">State</span>
<span class="mi">1</span> <span class="n">goal</span>
<span class="n">e</span> <span class="o">:</span> <span class="n">exp</span>
<span class="err">⊢</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e</span>
<span class="n">cpdt</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span> <span class="n">error</span>
<span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">unsolved</span> <span class="n">goals</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">e_e1</span> <span class="n">e_e2</span> <span class="o">:</span> <span class="n">exp</span><span class="o">,</span>
<span class="n">e_ih_e1</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span><span class="o">,</span>
<span class="n">e1</span> <span class="n">e2</span> <span class="o">:</span> <span class="n">exp</span><span class="o">,</span>
<span class="n">e_ih_e2</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e2</span>
<span class="err">⊢</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="o">(</span><span class="n">Plus</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="n">e1</span><span class="o">)</span> <span class="n">e2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span> <span class="bp">+</span> <span class="n">eeval</span> <span class="n">e_e2</span>
<span class="n">cpdt</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_e1</span> <span class="o">:</span> <span class="n">exp</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_e2</span> <span class="o">:</span> <span class="n">exp</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_ih_e1</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">eeval</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e2</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_ih_e2</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e2</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bnot</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bnot</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">bodd</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">bodd</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="err">↥</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">false</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="err">↥</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">true</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">int</span><span class="bp">.</span><span class="n">sign</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">int</span><span class="bp">.</span><span class="n">sign</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pred</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">div2</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">div2</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">bodd</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">bit</span> <span class="n">ff</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">div2</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="err">↑</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">true</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↑</span><span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="err">↑</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">false</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↑</span><span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">int</span><span class="bp">.</span><span class="n">sign</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_self</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_self</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bnot_bnot</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bnot</span> <span class="o">(</span><span class="n">bnot</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bnot_bnot</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bnot</span> <span class="o">(</span><span class="n">bnot</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">eeval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">eeval</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">n</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">tt_band</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">tt_band</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">ff_bxor</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">ff_bxor</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">ff_bor</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">ff_bor</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_self</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_self</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">tt_bxor</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">tt_bxor</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">reassoc</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">reassoc</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">Plus</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bnot_eq_true_eq_eq_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bnot</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">=</span> <span class="o">(</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bnot_eq_ff_eq_eq_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">bnot</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">=</span> <span class="o">(</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">ff</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">tt</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">ff</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bxor_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">tt</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">tt</span> <span class="bp">∧</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">tt</span> <span class="bp">∧</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">ff</span> <span class="bp">∨</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_coe_iff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="err">↥</span><span class="o">(</span><span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">ff</span> <span class="bp">∨</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_eq_true_eq_eq_tt_and_eq_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">=</span> <span class="o">(</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">∧</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">band_eq_false_eq_eq_ff_or_eq_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">=</span> <span class="o">(</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">∨</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_eq_true_eq_eq_tt_or_eq_tt</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">=</span> <span class="o">(</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">∨</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">bor_eq_false_eq_eq_ff_and_eq_ff</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">=</span> <span class="o">(</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">∧</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bnot</span> <span class="o">(</span><span class="n">bnot</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bnot</span> <span class="o">(</span><span class="n">bnot</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">eeval</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">n</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">reassoc</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">Plus</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bnot</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">=</span> <span class="o">(</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">,</span> <span class="n">bnot</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">bnot</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">=</span> <span class="o">(</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">,</span> <span class="n">bnot</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">ff</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span><span class="o">),</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">ff</span> <span class="err">↥</span><span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">tt</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span><span class="o">),</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">tt</span> <span class="err">↥</span><span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">ff</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span><span class="o">),</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">ff</span> <span class="err">↥</span><span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">tt</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="o">(</span><span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span><span class="o">),</span> <span class="n">xor</span> <span class="err">↥</span><span class="n">tt</span> <span class="err">↥</span><span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">tt</span> <span class="bp">∧</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">tt</span> <span class="bp">∧</span> <span class="err">↥</span><span class="n">ff</span><span class="o">,</span> <span class="err">↥</span><span class="o">(</span><span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span><span class="o">)}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">tt</span> <span class="bp">∧</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">tt</span> <span class="bp">∧</span> <span class="err">↥</span><span class="n">tt</span><span class="o">,</span> <span class="err">↥</span><span class="o">(</span><span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span><span class="o">)}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">ff</span> <span class="bp">∨</span> <span class="err">↥</span><span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">ff</span> <span class="bp">∨</span> <span class="err">↥</span><span class="n">ff</span><span class="o">,</span> <span class="err">↥</span><span class="o">(</span><span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span><span class="o">)}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="err">↥</span><span class="o">(</span><span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span><span class="o">)</span> <span class="bp">↔</span> <span class="err">↥</span><span class="n">ff</span> <span class="bp">∨</span> <span class="err">↥</span><span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">ff</span> <span class="bp">∨</span> <span class="err">↥</span><span class="n">tt</span><span class="o">,</span> <span class="err">↥</span><span class="o">(</span><span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span><span class="o">)}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">=</span> <span class="o">(</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">∧</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">∧</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">,</span> <span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">=</span> <span class="o">(</span><span class="n">false</span> <span class="bp">∨</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">false</span> <span class="bp">∨</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">,</span> <span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span> <span class="bp">=</span> <span class="o">(</span><span class="n">false</span> <span class="bp">∨</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">false</span> <span class="bp">∨</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">,</span> <span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">=</span> <span class="o">(</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">∧</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span> <span class="bp">∧</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">,</span> <span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span> <span class="o">[</span><span class="n">eeval</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span><span class="o">],</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">2</span>
<span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">))</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">+</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="kn">instance</span><span class="o">,</span> <span class="n">generation</span><span class="o">:</span> <span class="mi">2</span><span class="o">,</span> <span class="n">after</span> <span class="n">preprocessing</span>
<span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">))</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">+</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">Const</span> <span class="n">n</span><span class="o">))</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span> <span class="bp">+</span> <span class="n">eeval</span> <span class="n">e_e2</span><span class="o">}</span>
<span class="n">cpdt</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">58</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span> <span class="n">information</span> <span class="n">trace</span> <span class="n">output</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_e1</span> <span class="o">:</span> <span class="n">exp</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_e2</span> <span class="o">:</span> <span class="n">exp</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_ih_e1</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">reassoc</span> <span class="n">e_e1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e1</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e1</span> <span class="o">:</span> <span class="n">exp</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e2</span> <span class="o">:</span> <span class="n">exp</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e2</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">intro</span><span class="o">]</span> <span class="n">e_ih_e2</span> <span class="o">:</span> <span class="n">eeval</span> <span class="o">(</span><span class="n">Plus</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">eeval</span> <span class="n">e_e2</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bnot</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bnot</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">ff</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">tt</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">ff</span> <span class="bp">||</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">ff</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">ff</span> <span class="bp">||</span> <span class="n">ff</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">tt</span> <span class="bp">&amp;&amp;</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">bxor</span> <span class="n">tt</span> <span class="n">tt</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">bodd</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">tt</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="n">nat</span><span class="bp">.</span><span class="n">bodd</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">ff</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="err">↥</span><span class="n">ff</span> <span class="bp">=</span> <span class="n">false</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">facts</span><span class="o">:</span> <span class="o">{</span><span class="err">↥</span><span class="n">ff</span><span class="o">}</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">ematch</span><span class="o">]</span> <span class="n">new</span> <span class="n">ground</span> <span class="n">fact</span><span class="o">:</span> <span class="err">↥</span><span class="n">tt</span> <span class="bp">=</span> <span class="n">true</span>
<span class="o">[</span><span class="n">smt</span><span class="bp">.</span><span class="n">fact</span><span class="o">]</span> <span class="n">new</span> <span class="n">f</span>
</code></pre></div>



<a name="197531615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197531615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197531615">(May 14 2020 at 09:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> How do you feel about commenting out the remaining tests?</p>



<a name="197531861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197531861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197531861">(May 14 2020 at 09:59)</a>:</h4>
<p>We are talking about</p>
<div class="codehilite"><pre><span></span><code>99% tests passed, 5 tests failed out of 1359

Total Test time (real) = 169.26 sec

The following tests FAILED:
        688 - leanruntest_cpdt.lean (Failed)
        768 - leanruntest_ematch_attr_to_defs.lean (Failed)
        1155 - leanruntest_smt_ematch2.lean (Failed)
        1156 - leanruntest_smt_ematch3.lean (Failed)
        1247 - leanruntest_using_smt2.lean (Failed)
</code></pre></div>



<a name="197532970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197532970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197532970">(May 14 2020 at 10:10)</a>:</h4>
<p>Yeah, ematching tests -&gt; remove</p>



<a name="197532983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197532983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197532983">(May 14 2020 at 10:10)</a>:</h4>
<p>cpdt -&gt; remove</p>



<a name="197533014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197533014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197533014">(May 14 2020 at 10:11)</a>:</h4>
<p>using_smt2 -&gt; is everything broken?  That would be bad.  If it's just two examples or so -&gt; remove the examples.</p>



<a name="197535476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197535476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197535476">(May 14 2020 at 10:37)</a>:</h4>
<p>Ok, I'll do that</p>



<a name="197536047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536047">(May 14 2020 at 10:44)</a>:</h4>
<p>Done and pushed.<br>
But locally it still says</p>
<div class="codehilite"><pre><span></span><code><span class="n">The</span> <span class="n">following</span> <span class="n">tests</span> <span class="n">FAILED</span><span class="o">:</span>
        <span class="mi">688</span> <span class="bp">-</span> <span class="n">leanruntest_cpdt</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">768</span> <span class="bp">-</span> <span class="n">leanruntest_ematch_attr_to_defs</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1155</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch2</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
        <span class="mi">1156</span> <span class="bp">-</span> <span class="n">leanruntest_smt_ematch3</span><span class="bp">.</span><span class="n">lean</span> <span class="o">(</span><span class="n">Failed</span><span class="o">)</span>
</code></pre></div>


<p>even though I removed those tests from <code>tests/lean/run/*</code></p>



<a name="197536200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536200">(May 14 2020 at 10:46)</a>:</h4>
<p>Locally? You need to re-run <code>cmake</code>.</p>



<a name="197536327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536327">(May 14 2020 at 10:48)</a>:</h4>
<p>Aha</p>



<a name="197536387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536387">(May 14 2020 at 10:48)</a>:</h4>
<p>I've pushed... this PR is now touching 106 files <span aria-label="shock" class="emoji emoji-1f628" role="img" title="shock">:shock:</span></p>



<a name="197536561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536561">(May 14 2020 at 10:50)</a>:</h4>
<p>To come back to your question from the other thread: should we make a release before we merge this PR?</p>



<a name="197536799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536799">(May 14 2020 at 10:53)</a>:</h4>
<p>I think it makes sense. I certainly don't feel brave enough to fix mathlib after the 6 different PR that we now have in core...</p>



<a name="197536819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536819">(May 14 2020 at 10:53)</a>:</h4>
<p>I prefer to take small steps. But I don't have a good overview.</p>



<a name="197536840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197536840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197536840">(May 14 2020 at 10:53)</a>:</h4>
<p>This has very much been a cargo cult PR from my side</p>



<a name="197537162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197537162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197537162">(May 14 2020 at 10:57)</a>:</h4>
<p>There's still one failing test.  I'll then get 3.12 out of the door today, and we can think about 3.13 tomorrow.</p>



<a name="197537334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197537334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197537334">(May 14 2020 at 10:59)</a>:</h4>
<p>Yes, I just noticed the failing test. It should be fixed now.</p>



<a name="197539011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/moving%20algebra%20out%20of%20core/near/197539011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/moving.20algebra.20out.20of.20core.html#197539011">(May 14 2020 at 11:21)</a>:</h4>
<p>Hooray! Locally it builds without errors and all the (remaining) tests pass!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>