---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/What.20is.20.60leanproject.20mk-cache.20--force.60.20for.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/What.20is.20.60leanproject.20mk-cache.20--force.60.20for.html">What is `leanproject mk-cache --force` for</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="250270614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/What%20is%20%60leanproject%20mk-cache%20--force%60%20for/near/250270614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/What.20is.20.60leanproject.20mk-cache.20--force.60.20for.html#250270614">(Aug 22 2021 at 11:59)</a>:</h4>
<p>I'm struggling to see why this command would ever be a good idea; it essentially builds a cache labelled as being for commit <code>A</code> that actually contains lean and olean files for some changes which were never assigned a sha. Some options that I think would be better:</p>
<ul>
<li>Just remove it, require users to run <code>git commit</code></li>
<li>Have it run <code>git stash -k</code> first to actual create a real commit <code>B</code>, and then store the cache under that name</li>
</ul>
<p>The reason I ask is because I can't work out what the correct behavior of <code>leanproject get-cache --rev HEAD^</code> (when <strong>not</strong> in mathlib) should be; right now it essentially resets the entire working tree to whatever state it was in when <code>mk-cache</code> was run, which may or may not correspond to the contents off the git commit <code>HEAD^</code>.</p>



<a name="251559705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/What%20is%20%60leanproject%20mk-cache%20--force%60%20for/near/251559705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/What.20is.20.60leanproject.20mk-cache.20--force.60.20for.html#251559705">(Sep 01 2021 at 13:40)</a>:</h4>
<p>I implemented the <code>git stash</code> version at <a href="https://github.com/leanprover-community/mathlib-tools/issues/115">leanprover-community/mathlib-tools#115</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>