---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html">something `nlinarith` can't do</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="209451124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209451124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209451124">(Sep 08 2020 at 22:17)</a>:</h4>
<p>Here is something <code>nlinarith</code> can't do -- should it be able to do it?  Would it be easy to add?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>

<span class="c1">-- works</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">nlinarith</span>

<span class="c1">-- fails</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">nlinarith</span>
</code></pre></div>



<a name="209451866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209451866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209451866">(Sep 08 2020 at 22:26)</a>:</h4>
<p>Also, today I learned: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span>
</code></pre></div>


<p>is not true by <code>rfl</code>?  (Instead there's a lemma.)</p>



<a name="209452844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209452844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209452844">(Sep 08 2020 at 22:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do/near/209451124">said</a>:</p>
<blockquote>
<p>Here is something <code>nlinarith</code> can't do -- should it be able to do it?  Would it be easy to add?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>

<span class="c1">-- works</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">nlinarith</span>

<span class="c1">-- fails</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">nlinarith</span>
</code></pre></div>


</blockquote>
<p>Something a little strange about this example: I had thought that that adding intermediate hypotheses solved by <code>ring</code> would not work, because <code>nlinarith</code> subsumes<code>ring</code>.  But in fact this works:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">ring</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">nlinarith</span>
<span class="kn">end</span>
</code></pre></div>



<a name="209453014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209453014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209453014">(Sep 08 2020 at 22:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="209453034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209453034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209453034">(Sep 08 2020 at 22:42)</a>:</h4>
<p>Makes sense, since <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">x^n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> is defined by recursion on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>.</p>



<a name="209507372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209507372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209507372">(Sep 09 2020 at 13:06)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/4082">#4082</a></p>



<a name="209507404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209507404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209507404">(Sep 09 2020 at 13:07)</a>:</h4>
<p>Feel free to tag me in <code>linarith</code>/<code>nlinarith</code> questions btw, I almost missed this.</p>



<a name="209507944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209507944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209507944">(Sep 09 2020 at 13:11)</a>:</h4>
<p>Thank you, this is great!</p>



<a name="209531171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209531171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209531171">(Sep 09 2020 at 15:58)</a>:</h4>
<p>Remarkably, this will be merged before the <a href="https://leanprover-community.github.io/lean-web-editor/#code=import%20data.real.basic%0A%0A%2F--%20A%20statement%20%60P%20n%60%20is%20true%20for%20all%20%60n%60%20sufficiently%20large%2C%20if%20there%20exists%20a%20natural%20number%20%60M%60%2C%0Asuch%20that%20for%20%60n%20%E2%89%A5%20M%60%2C%20the%20statement%20%60P%20n%60%20is%20true.%20-%2F%0Adef%20for_sufficiently_large%20%28P%20%3A%20%E2%84%95%20%E2%86%92%20Prop%29%20%3A%20Prop%20%3A%3D%0A%E2%88%83%20%28M%20%3A%20%E2%84%95%29%2C%20%E2%88%80%20n%20%E2%89%A5%20M%2C%20P%20n%0A%0A%2F--%20The%20statement%20%60%28n%3A%E2%84%9D%29%20%5E%202%20%E2%89%A5%2012%20*%20n%20%2B%204%20%2B%20n%E2%81%BB%C2%B9%60%20is%20true%20for%20all%20%60n%60%20sufficiently%20large.%20-%2F%0Aexample%20%3A%20for_sufficiently_large%20%28%CE%BB%20n%2C%20%28n%3A%E2%84%9D%29%20%5E%202%20%E2%89%A5%2012%20*%20n%20%2B%204%20%2B%20n%E2%81%BB%C2%B9%29%20%3A%3D%0Abegin%0A%20%20use%2013%2C%0A%20%20intros%20n%20hn%2C%0A%0A%2F-%20Here%20and%20several%20times%20throughout%20the%20proof%2C%20we%20%22cast%22%20%28this%20is%20a%20computer-science%20term%29%20a%20natural%0Anumber%20%28like%20%60n%60%20or%20%6013%60%20or%20%601%60%29%20to%20a%20real%20number%2C%20by%20writing%20%60%28n%3A%E2%84%9D%29%60%20or%20similar.%20This%20lets%20us%20do%0Aoperations%20that%20wouldn't%20be%20possible%20while%20staying%20in%20the%20natural%20numbers%2C%20such%20as%20taking%20%60n%E2%81%BB%C2%B9%60.%0A%0AFor%20technical%20reasons%2C%20it's%20better%20to%20cast%20the%20first%20term%20in%20every%20equation%20you%20meet%2C%20rather%20than%0Awaiting%20to%20cast%20until%20the%20operation%20where%20it's%20needed.%20%20-%2F%0A%20%20have%20hn'%20%3A%20%28n%3A%E2%84%9D%29%20%E2%89%A5%2013%2C%0A%20%20%7B%20norm_cast%2C%0A%20%20%20%20exact%20hn%20%7D%2C%0A%0A%20%20have%20h_13%20%3A%20%2813%3A%E2%84%9D%29%20%3E%200%2C%0A%20%20%7B%20norm_num%20%7D%2C%0A%20%20have%20%3A%20%2813%3A%E2%84%9D%29%E2%81%BB%C2%B9%20%E2%89%A5%20n%E2%81%BB%C2%B9%2C%0A%20%20%7B%20--%20the%20following%20line%20found%20by%20the%20%60suggest%60%20tactic%3A%0A%20%20%20%20refine%20%28inv_le_inv%20_%20h_13%29.mpr%20hn'%2C%0A%20%20%20%20linarith%20%7D%2C%0A%20%20have%20%3A%20%281%3A%E2%84%9D%29%20%E2%89%A5%2013%E2%81%BB%C2%B9%2C%0A%20%20%7B%20cancel_denoms%20%7D%2C%0A%20%20calc%20%28n%3A%E2%84%9D%29%20%5E%202%20%3D%20n%20*%20n%20%3A%20by%20ring%0A%20%20...%20%E2%89%A5%2013%20*%20n%20%3A%20by%20nlinarith%20--%20actually%20this%20line%20and%20the%20next%20line%20are%20optional%2C%20%60nlinarith%60%20can%20do%20it%20all%20at%20once%0A%20%20...%20%E2%89%A5%2012%20*%20n%20%2B%2013%20%3A%20by%20nlinarith%0A%20%20...%20%E2%89%A5%2012%20*%20n%20%2B%204%20%2B%20n%E2%81%BB%C2%B9%20%3A%20by%20nlinarith%0Aend">lecture I was preparing</a> when I discovered this gap.</p>



<a name="209532171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209532171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209532171">(Sep 09 2020 at 16:06)</a>:</h4>
<p>(although it seems the web editor updates mathlib only once a day :-) )</p>



<a name="209532189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209532189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209532189">(Sep 09 2020 at 16:06)</a>:</h4>
<p>I just triggered a web editor update which should be ready in 2 hours or so, in case you or your students want to use the new <code>nlinarith</code> there. (Sadly, the web editor build can't use <code>leanproject</code> yet.)</p>



<a name="209532253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209532253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209532253">(Sep 09 2020 at 16:07)</a>:</h4>
<p>Sorry <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span>, I was not complaining, just marvelling!</p>



<a name="209532489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209532489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209532489">(Sep 09 2020 at 16:08)</a>:</h4>
<p>No worries, I didn't take it that way! I'm glad folks are making use of the web editor, despite all its warts.</p>



<a name="209532771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/209532771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#209532771">(Sep 09 2020 at 16:10)</a>:</h4>
<p>It's my first time using it in this way (to share a snippet with a newbie audience), but it seems perfect for the purpose.</p>



<a name="211537350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211537350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211537350">(Sep 28 2020 at 19:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> Here's something <code>linarith</code> can't do; could it be made to do it?</p>
<p>I'm continuing the thread from a couple of weeks ago because it seems similar -- it's something that <code>ring</code> can do, so it feels like it would be safe to tell <code>linarith</code> about it.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>

<span class="c1">--fails</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">/</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">c</span> <span class="bp">/</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="o">(</span><span class="n">b</span> <span class="bp">-</span> <span class="n">c</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">linarith</span>

<span class="c1">--works</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">/</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">c</span> <span class="bp">/</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="o">(</span><span class="n">b</span> <span class="bp">-</span> <span class="n">c</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ring</span> <span class="n">at</span> <span class="bp">⊢</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">linarith</span>
<span class="kd">end</span>
</code></pre></div>

<p>Adapted from an open PR of <span class="user-mention" data-user-id="203577">@Malo Jaffré</span> (<a href="https://github.com/leanprover-community/mathlib/issues/4307">#4307</a>).</p>



<a name="211537554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211537554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211537554">(Sep 28 2020 at 19:21)</a>:</h4>
<p>This example if very officially out of scope for <code>linarith</code> (non-constant denominator).</p>



<a name="211537862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211537862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211537862">(Sep 28 2020 at 19:24)</a>:</h4>
<p><code>linarith</code> does a normalization of hypotheses which is very similar to <code>ring</code>, but not quite the same.  IANATW (I am not a tactic writer), but I don't see why the normalization of hypotheses can't be exactly the same as that done by <code>ring</code>.</p>



<a name="211537968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211537968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211537968">(Sep 28 2020 at 19:25)</a>:</h4>
<p>Here's what the <code>ring</code> converts the problem to (and it works):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">-</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">linarith</span>
</code></pre></div>



<a name="211538779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211538779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211538779">(Sep 28 2020 at 19:31)</a>:</h4>
<p>also, it seems to work in Coq :)</p>
<div class="codehilite" data-code-language="Coq"><pre><span></span><code><span class="kn">Require</span> <span class="kn">Import</span> <span class="n">Psatz</span> <span class="n">Rbase</span><span class="o">.</span>
<span class="kn">Open</span> <span class="kn">Scope</span> <span class="n">R_scope</span><span class="o">.</span>

<span class="kn">Lemma</span> <span class="n">test</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">/</span> <span class="n">a</span> <span class="o">-</span> <span class="n">c</span> <span class="o">/</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">0</span> <span class="o">&lt;</span> <span class="o">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="o">)</span> <span class="o">/</span> <span class="n">a</span><span class="o">.</span>
<span class="kn">Proof</span><span class="o">.</span>
  <span class="n">lra</span><span class="o">.</span>
<span class="kn">Qed</span><span class="o">.</span>
</code></pre></div>



<a name="211539671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211539671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211539671">(Sep 28 2020 at 19:39)</a>:</h4>
<p>Mmm. It's possible, I'm not sure if it's a tiny change to the linarith parser or a medium change.</p>



<a name="211611090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211611090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211611090">(Sep 29 2020 at 12:02)</a>:</h4>
<p>This needs a medium change to the parsing step. As much as I hate that <code>lra</code> can do something <code>linarith</code> can't, it'll have to wait, unless this is blocking something big.</p>



<a name="211611389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211611389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211611389">(Sep 29 2020 at 12:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do/near/211537862">said</a>:</p>
<blockquote>
<p><code>linarith</code> does a normalization of hypotheses which is very similar to <code>ring</code>, but not quite the same.  IANATW (I am not a tactic writer), but I don't see why the normalization of hypotheses can't be exactly the same as that done by <code>ring</code>.</p>
</blockquote>
<p><code>linarith</code> doesn't use <code>ring</code> as a normalizer because it's expensive to do verified preprocessing. The normalization doesn't have to be proof producing since the rest of <code>linarith</code> produces and checks a certificate. So the parsing stage ("figure out the linear structure of this expression") is much lighter weight.</p>



<a name="211611518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211611518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211611518">(Sep 29 2020 at 12:07)</a>:</h4>
<p>But the data structure it parses into is (unsurprisingly) badly suited for division.</p>



<a name="211623430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211623430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211623430">(Sep 29 2020 at 13:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do/near/211611389">said</a>:</p>
<blockquote>
<p><code>linarith</code> doesn't use <code>ring</code> as a normalizer because it's expensive to do verified preprocessing. The normalization doesn't have to be proof producing since the rest of <code>linarith</code> produces and checks a certificate. So the parsing stage ("figure out the linear structure of this expression") is much lighter weight.</p>
</blockquote>
<p>Thanks, very interesting!</p>



<a name="211623492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/something%20%60nlinarith%60%20can%27t%20do/near/211623492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do.html#211623492">(Sep 29 2020 at 13:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/something.20.60nlinarith.60.20can't.20do/near/211611090">said</a>:</p>
<blockquote>
<p>As much as I hate that <code>lra</code> can do something <code>linarith</code> can't, it'll have to wait, unless this is blocking something big.</p>
</blockquote>
<p>One can use the workaround <code>ring at ...., linarith</code> forever, so it can certainly wait :)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>