---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html">leanproject get-cache slow?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="283844619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283844619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283844619">(May 25 2022 at 07:02)</a>:</h4>
<p>As of a day or two ago, whenever I switch branches and run <code>leanproject get-cache</code>, the step of unzipping the archive has become super slow. It seems quite reproducible, and I'm stumped why it could be happening. It now takes &gt;2 minutes to unzip the archive, and it's making switching branches very painful. Is anyone else seeing this, perchance?</p>



<a name="283851174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283851174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283851174">(May 25 2022 at 08:21)</a>:</h4>
<p>Is unzipping older archives noticeably faster? Is it possible the regression is in an update to your unzipping tool?</p>



<a name="283852212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283852212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283852212">(May 25 2022 at 08:32)</a>:</h4>
<p>Hmm, yes, it seems to still happen on older zips. Sadness. Thanks for the diagnostic suggestion, nevertheless.</p>



<a name="283852488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283852488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283852488">(May 25 2022 at 08:35)</a>:</h4>
<p>I've found the speed to be quite painful on my windows system, so have switched to using gitpod exclusively where it takes only about 5s</p>



<a name="283852745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283852745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283852745">(May 25 2022 at 08:37)</a>:</h4>
<p>Oh, I now remember that the unzipping tool is just python</p>



<a name="283852857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283852857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283852857">(May 25 2022 at 08:38)</a>:</h4>
<p>I can reproduce the slow unzipping with <code>xz</code> on the command line, so I'm pretty confused.</p>



<a name="283853149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283853149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283853149">(May 25 2022 at 08:41)</a>:</h4>
<p>Maybe you have an IO problem of some kind</p>



<a name="283853194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283853194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283853194">(May 25 2022 at 08:41)</a>:</h4>
<p>Do you have a different hard disk you can put it on and compare with?</p>



<a name="283855906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/283855906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#283855906">(May 25 2022 at 09:07)</a>:</h4>
<p>What is clear is that nothing changed on our side recently.</p>



<a name="295467501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295467501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295467501">(Aug 26 2022 at 16:46)</a>:</h4>
<p>I am trying to run <code>leanproject get-c</code>, but it hangs after the following output:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">10902535</span><span class="n">d1</span>
  <span class="n">locally...</span>
  <span class="n">remotely...</span>
</code></pre></div>
<p>Any reason why it seems to be searching forever for the cache?</p>



<a name="295468039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295468039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295468039">(Aug 26 2022 at 16:48)</a>:</h4>
<p>Is it that a cache isn't created when there's a linter error?</p>



<a name="295468186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295468186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295468186">(Aug 26 2022 at 16:49)</a>:</h4>
<p>"Works" here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">c</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">10902535</span><span class="n">d12</span>
  <span class="n">locally...</span>
  <span class="n">remotely...</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">available</span> <span class="n">for</span> <span class="n">revision</span> <span class="mi">10902535</span><span class="n">d12</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">15</span><span class="n">c8fddadfb</span>
  <span class="n">locally...</span>
  <span class="n">remotely...</span>
  <span class="n">Found</span> <span class="n">remote</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">5118011</span><span class="n">fec0</span>
  <span class="n">locally...</span>
  <span class="n">remotely...</span>
  <span class="n">Found</span> <span class="n">remote</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">available</span> <span class="n">for</span> <span class="mi">10902535</span><span class="n">d12.</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">multiple</span> <span class="n">viable</span> <span class="n">caches</span> <span class="k">from</span> <span class="n">parent</span> <span class="n">commits</span><span class="o">:</span>
 <span class="bp">*</span> <span class="mi">15</span><span class="n">c8fddadfb</span>
 <span class="bp">*</span> <span class="mi">5118011</span><span class="n">fec0</span>
<span class="n">To</span> <span class="n">see</span> <span class="n">the</span> <span class="n">commits</span> <span class="k">in</span> <span class="n">question</span><span class="o">,</span> <span class="n">run</span><span class="o">:</span>
  <span class="n">git</span> <span class="n">log</span> <span class="c1">--graph 10902535d12 15c8fddadfb^! 5118011fec0^!</span>
<span class="n">Run</span> <span class="bp">`</span><span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="c1">--rev` on one of the available commits above.</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">cached</span> <span class="n">oleans</span>
</code></pre></div>



<a name="295468560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295468560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295468560">(Aug 26 2022 at 16:51)</a>:</h4>
<p>Unfortunately, even running <code>leanproject get-c --rev origin/master</code> for me results in it hanging</p>



<a name="295470710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295470710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295470710">(Aug 26 2022 at 17:02)</a>:</h4>
<p>Does <a href="https://oleanstorage.azureedge.net/mathlib/15c8fddadfb214a58fc40e60b42606bf17f23b87.tar.xz">https://oleanstorage.azureedge.net/mathlib/15c8fddadfb214a58fc40e60b42606bf17f23b87.tar.xz</a> work? What if you add <code>13.107.246.34 oleanstorage.azureedge.net</code>to <code>/etc/hosts</code>?</p>



<a name="295471387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295471387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295471387">(Aug 26 2022 at 17:06)</a>:</h4>
<p>I can download the link you gave, but I don't know where to put it. Adding that line to <code>/etc/hosts</code> doesn't change the output of leanproject get-c</p>



<a name="295471543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295471543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295471543">(Aug 26 2022 at 17:07)</a>:</h4>
<p>(I'm on Mac M1 if that's relevant)</p>



<a name="295472118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295472118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295472118">(Aug 26 2022 at 17:10)</a>:</h4>
<p>If you want manually apply the cache, you can go to the mathlib project root (the directory that contains <code>archive</code>, <code>test</code> and <code>src</code> subdirs, among others) and extract it with <code>tar xvf /your/download/dir/15c8fddadfb214a58fc40e60b42606bf17f23b87.tar.xz</code>.</p>



<a name="295472321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295472321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295472321">(Aug 26 2022 at 17:11)</a>:</h4>
<p>The reason I suggested the <code>/etc/hosts</code> change was because I sometimes see IPv6 causing hangs on some providers</p>



<a name="295473848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanproject%20get-cache%20slow%3F/near/295473848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/leanproject.20get-cache.20slow.3F.html#295473848">(Aug 26 2022 at 17:20)</a>:</h4>
<p>This works, thanks Mauricio for unblocking me. Still, it's a bit concerning that leanproject stopped working for some reason.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>