---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/linter.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html">linter</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="180209336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180209336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#180209336">(Nov 08 2019 at 07:56)</a>:</h4>
<p>I am just compiling the latest mathlib. I got an error</p>
<div class="codehilite"><pre><span></span><span class="err">\</span><span class="n">mathlib</span><span class="err">\</span><span class="n">scripts</span><span class="err">\</span><span class="n">mk_nolint</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">allKK</span><span class="err"></span><span class="o">[</span><span class="mi">2</span><span class="n">K</span>
<span class="n">could</span> <span class="n">not</span> <span class="n">resolve</span> <span class="kn">import</span><span class="o">:</span> <span class="n">all</span>
</pre></div>



<a name="180209494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180209494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#180209494">(Nov 08 2019 at 08:00)</a>:</h4>
<p>Never mind, I should just <code>make src</code>.</p>



<a name="180213362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180213362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#180213362">(Nov 08 2019 at 09:14)</a>:</h4>
<p>Edit - never mind, I misread this, sorry.</p>



<a name="180213388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/180213388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#180213388">(Nov 08 2019 at 09:14)</a>:</h4>
<p>(deleted)</p>



<a name="182788778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182788778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#182788778">(Dec 06 2019 at 18:25)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/1786" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1786">#1786</a> has just been merged, and it contains the following line:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">fintype</span><span class="bp">.</span><span class="n">compact_space</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">Œ±</span><span class="o">]</span> <span class="o">:</span> <span class="n">compact_space</span> <span class="n">Œ±</span>
</pre></div>


<p>I thought that the linter was supposed to ask for a reduced priority on this kind of instance. Has it been deactivated?</p>



<a name="182793450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182793450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#182793450">(Dec 06 2019 at 19:15)</a>:</h4>
<p>I think the instance checker is not yet one of the active linters:<br>
<a href="https://github.com/leanprover-community/mathlib/blob/827e78b1638868734de786baac70b5d3f1d5118e/scripts/mk_nolint.lean#L28" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/827e78b1638868734de786baac70b5d3f1d5118e/scripts/mk_nolint.lean#L28">https://github.com/leanprover-community/mathlib/blob/827e78b1638868734de786baac70b5d3f1d5118e/scripts/mk_nolint.lean#L28</a><br>
<a href="https://github.com/leanprover-community/mathlib/blob/740168bf22c86e2d83b98e069b85ac7360dbba8c/scripts/mk_all.sh#L42" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/740168bf22c86e2d83b98e069b85ac7360dbba8c/scripts/mk_all.sh#L42">https://github.com/leanprover-community/mathlib/blob/740168bf22c86e2d83b98e069b85ac7360dbba8c/scripts/mk_all.sh#L42</a></p>



<a name="182793496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182793496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#182793496">(Dec 06 2019 at 19:15)</a>:</h4>
<p>(not sure which of these lists is the relevant one, or whether it is necessary that those two lists are the same at all time)</p>



<a name="182794781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182794781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#182794781">(Dec 06 2019 at 19:28)</a>:</h4>
<p>The second is the relevant one, and it's most important that the second is a subset of the first. It should be safe to add the priority check back to CI now. With Floris' PRs, I guess almost all of mathlib is passing now. So there should be very few changes to <code>nolints.txt</code>, or none if we update the remaining failures.</p>



<a name="182796917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182796917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#182796917">(Dec 06 2019 at 19:48)</a>:</h4>
<p>I vote for enabling it, as this is really a useful check.</p>



<a name="182807502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/182807502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#182807502">(Dec 06 2019 at 21:36)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/1787" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1787">#1787</a> passed. Luckily the <code>fintype.compact_space</code> instance was the only bad one that snuck in.</p>



<a name="184261727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184261727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#184261727">(Dec 26 2019 at 13:28)</a>:</h4>
<p>I recently learned that it can be dangerous to have a class with more explicit parameters than one which it is extending: <a href="#narrow/stream/113488-general/topic/typeclass.20problems/near/184192445" title="#narrow/stream/113488-general/topic/typeclass.20problems/near/184192445">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass.20problems/near/184192445</a></p>



<a name="184261744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184261744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#184261744">(Dec 26 2019 at 13:29)</a>:</h4>
<p>I'm not quite sure exactly what the rule would be, but I wonder if this is the sort of thing we could have the linter warn about?</p>



<a name="184909272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184909272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#184909272">(Jan 06 2020 at 14:18)</a>:</h4>
<p>Yes, this is definitely something we can have the linter warn about. I think the rule is<br>
"There cannot be a local constant in one of the (type-class) hypotheses that does not occur in the conclusion (and cannot be inferred from the type of the local constants in the conclusion)."<br>
I'm not sure if the parenthetical is necessary.</p>
<p>There are instances which violate this rule, <code>coe_trans</code> comes to mind:</p>
<div class="codehilite"><pre><span></span><span class="n">coe_trans</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u‚ÇÅ</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u‚ÇÇ</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u‚ÇÉ</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="n">b</span> <span class="n">c</span><span class="o">],</span> <span class="n">has_coe_t</span> <span class="n">a</span> <span class="n">c</span>
</pre></div>


<p>However, instances like those do raise issues:<br>
<a href="#narrow/stream/113488-general/topic/remove.20all.20instances.20with.20variable.20domain" title="#narrow/stream/113488-general/topic/remove.20all.20instances.20with.20variable.20domain">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/remove.20all.20instances.20with.20variable.20domain</a></p>



<a name="184962951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/184962951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#184962951">(Jan 06 2020 at 22:18)</a>:</h4>
<p>outparams are also excepted from this rule</p>



<a name="191422772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191422772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191422772">(Mar 22 2020 at 23:54)</a>:</h4>
<p>I have a small laptop and failing eyesight (meaning that when I can't find my specs I have to turn font size up), and I really like the rule which says that lines in mathlib are supposed to be at most 100 characters long. Not every line in mathlib has this property though. I would be very happy if this became a hard and fast rule. Can we lint for it, or is this considered to just be some sort of guideline and most people don't actually care about it?</p>



<a name="191428126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191428126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191428126">(Mar 23 2020 at 02:37)</a>:</h4>
<p>I have a PR with a slightly longer line that I can't (or at least don't want to) break. It is a markdown link to a section of a Wikipedia page.</p>



<a name="191428189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191428189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191428189">(Mar 23 2020 at 02:38)</a>:</h4>
<p>Currently 2258 lines in <code>*.lean</code> files have &gt;100 characters.</p>



<a name="191428198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191428198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191428198">(Mar 23 2020 at 02:39)</a>:</h4>
<p>And another ~600 have =100 characters. So people try to follow this rule.</p>



<a name="191441049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191441049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191441049">(Mar 23 2020 at 08:00)</a>:</h4>
<p>One problem with such a linter is that it's not so easy to write a <code>nolint</code> attribute for it. (I think.)</p>



<a name="191453037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191453037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191453037">(Mar 23 2020 at 10:17)</a>:</h4>
<p>This kind of thing doesn't fit in the current linter framework. The linter has no access to the source code.</p>



<a name="191453069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191453069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191453069">(Mar 23 2020 at 10:17)</a>:</h4>
<p>If someone wants to implement a syntactic linter, I won't complain, but it's basically a separate tool from the existing linters.</p>



<a name="191666235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191666235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191666235">(Mar 24 2020 at 20:17)</a>:</h4>
<p>I was running <code>#lint</code> on a new file, and noticed that it did <em>not</em> complain about the missing copyright header and missing module docstring. Is that because those are more "syntactic" issues? Or could the linter do that as well?</p>



<a name="191666357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191666357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191666357">(Mar 24 2020 at 20:18)</a>:</h4>
<p>I think the missing module docstring should be lintable.  But the copyright header is out of scope.</p>



<a name="191666408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191666408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191666408">(Mar 24 2020 at 20:18)</a>:</h4>
<p>But even the module docstring linter doesn't fit into the current framework at all.</p>



<a name="191667304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191667304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191667304">(Mar 24 2020 at 20:25)</a>:</h4>
<p>I've been working on a small change to the tactic parser so that we can specify linters for specific tactics. It looks something like:</p>
<div class="codehilite"><pre><span></span><span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">lint</span><span class="bp">.</span><span class="n">tactic</span> <span class="n">true</span>

<span class="kn">namespace</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">linter</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">simp</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">cur_pos</span><span class="o">)</span> <span class="bp">...</span> <span class="o">:=</span> <span class="n">do</span>
<span class="n">simp</span> <span class="bp">...</span><span class="o">,</span>
<span class="n">gs</span> <span class="bp">&lt;-</span> <span class="n">get_goals</span><span class="o">,</span>
<span class="n">unless</span> <span class="o">(</span><span class="n">gs</span><span class="bp">.</span><span class="n">empty</span><span class="o">)</span> <span class="err">$</span> <span class="n">advice</span> <span class="n">p</span> <span class="s2">&quot;non-terminal use of `simp`&quot;</span>

<span class="kn">end</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">linter</span>

<span class="kn">lemma</span> <span class="n">my_proof</span> <span class="o">:</span> <span class="n">something</span> <span class="o">:=</span>
<span class="k">begin</span>
   <span class="n">simp</span><span class="o">,</span> <span class="c1">-- prints advice here</span>
   <span class="c1">-- more stuff</span>
<span class="kn">end</span>
</pre></div>



<a name="191667516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191667516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191667516">(Mar 24 2020 at 20:27)</a>:</h4>
<p>does that sound useful?</p>



<a name="191667638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191667638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191667638">(Mar 24 2020 at 20:28)</a>:</h4>
<p>This particular advice could be bolted in the core library but if we want to define linter in mathlib (or other libraries) for tactics defined in core, that would seems useful</p>



<a name="191667784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191667784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191667784">(Mar 24 2020 at 20:29)</a>:</h4>
<p>Not directly related to the linter, but my students often use non-terminal <code>simp</code>s and it would be nice if such a thing generated some kind of warning. I believe that <code>simp, ring</code> is used in mathlib though.</p>



<a name="191678313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678313">(Mar 24 2020 at 21:58)</a>:</h4>
<p>Yeah, unfortunately a nonterminal simp lint is going to generate a lot of false positives</p>



<a name="191678369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678369">(Mar 24 2020 at 21:59)</a>:</h4>
<p>Yeah, this is not pitch for this specific rule so much as a way of building such rules</p>



<a name="191678415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678415">(Mar 24 2020 at 21:59)</a>:</h4>
<p>However, if we can make constructions like this, does this mean we can get access to the tactic scripts now? I know that there were other lints that needed that</p>



<a name="191678520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678520">(Mar 24 2020 at 22:00)</a>:</h4>
<p>Yes, I think so. I'm looking into using that right now</p>



<a name="191678728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678728">(Mar 24 2020 at 22:02)</a>:</h4>
<p>it would be great if we could store these into olean files for later analysis</p>



<a name="191678879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678879">(Mar 24 2020 at 22:04)</a>:</h4>
<p>I'm trying to remember what the use cases were... I think the imported files lint has false positives if a file is imported for its tactics</p>



<a name="191678957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191678957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191678957">(Mar 24 2020 at 22:05)</a>:</h4>
<p>Yeah, I remember. I'm not touching the olean file right now but I see where the tactic is parsed. It seems to be discarded quickly</p>



<a name="191679085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191679085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191679085">(Mar 24 2020 at 22:07)</a>:</h4>
<p>maybe create an auxiliary def with the tactic that was used? Could be a bit noisy, but there aren't very many other ways to store data</p>



<a name="191679240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191679240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191679240">(Mar 24 2020 at 22:09)</a>:</h4>
<p>maybe it only produces the def if some <code>set_option</code> is set</p>



<a name="191688026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191688026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191688026">(Mar 24 2020 at 23:58)</a>:</h4>
<p>I like that idea</p>



<a name="191688075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/191688075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#191688075">(Mar 24 2020 at 23:59)</a>:</h4>
<p>The switch and the extra definion</p>



<a name="217275661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217275661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217275661">(Nov 19 2020 at 14:25)</a>:</h4>
<p>Currently it takes 64 minutes to lint mathlib on PRs even if you only change one file. Can we make this faster perhaps by caching?</p>



<a name="217276669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217276669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217276669">(Nov 19 2020 at 14:32)</a>:</h4>
<p>I think that especially for the simp linter, this is hard. And I expect that's also one of the slower linters.</p>



<a name="217289165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217289165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217289165">(Nov 19 2020 at 15:56)</a>:</h4>
<p>Can we run the linters in parallel with each other (in separate processes or even jobs) rather than sequentially?</p>



<a name="217289956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217289956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217289956">(Nov 19 2020 at 16:01)</a>:</h4>
<p>I tried to parallelize the linters (i.e. running one task per linter):<br>
<a href="https://github.com/leanprover-community/mathlib/compare/parlint">https://github.com/leanprover-community/mathlib/compare/parlint</a></p>



<a name="217290010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217290010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217290010">(Nov 19 2020 at 16:01)</a>:</h4>
<p>This doesn't help much because (at least at the time) the simp linter takes 95% of the runtime.</p>



<a name="217290098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217290098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217290098">(Nov 19 2020 at 16:02)</a>:</h4>
<p>You can't run each declaration in a task either, because that's expensive (see comment in PR ^^).</p>



<a name="217290188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217290188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217290188">(Nov 19 2020 at 16:02)</a>:</h4>
<p>I think the best approach would be to split the declaration list into chunks and then run each chunk in a task.</p>



<a name="217292032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217292032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217292032">(Nov 19 2020 at 16:13)</a>:</h4>
<p>I tried this (naively) at some points and it led to segfaults. Never investigated beyond that though, it's quite possible I was doing something wrong.</p>



<a name="217301113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217301113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217301113">(Nov 19 2020 at 17:15)</a>:</h4>
<blockquote>
<p>Note: in Lean 3, VM functions executed in tasks need to copy their whole closure and return values twice.</p>
</blockquote>
<p>Additional note: Lean segfaults when copying lists that are more than few hundred elements long.</p>
<p>The branch I've linked to ^^ solves this by using <code>buffer</code> instead.</p>



<a name="217303347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217303347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217303347">(Nov 19 2020 at 17:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/linter/near/217301113">said</a>:</p>
<blockquote>
<blockquote>
<p>Note: in Lean 3, VM functions executed in tasks need to copy their whole closure and return values twice.</p>
</blockquote>
<p>Additional note: Lean segfaults when copying lists that are more than few hundred elements long.</p>
</blockquote>
<p>Solved in Lean 4, it now prints a proper stack overflow error message</p>



<a name="217303365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linter/near/217303365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/linter.html#217303365">(Nov 19 2020 at 17:30)</a>:</h4>
<p>Oh, it also doesn't copy closures to begin with...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>