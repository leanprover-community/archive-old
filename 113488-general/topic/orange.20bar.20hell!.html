---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/orange.20bar.20hell!.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html">orange bar hell!</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="262929724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262929724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262929724">(Nov 28 2021 at 13:47)</a>:</h4>
<p>why on earth does this take an eternity to typecheck <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">inductive</span> <span class="n">word_size_t</span>
<span class="bp">|</span> <span class="n">char</span>
<span class="bp">|</span> <span class="n">i32</span>
<span class="bp">|</span> <span class="n">i64</span>

<span class="kd">def</span> <span class="n">get_left_bound</span> <span class="o">:</span> <span class="n">word_size_t</span> <span class="bp">→</span> <span class="n">ℤ</span>
<span class="bp">|</span> <span class="n">word_size_t.char</span> <span class="o">:=</span> <span class="bp">-</span><span class="mi">128</span>
<span class="bp">|</span> <span class="n">word_size_t.i32</span> <span class="o">:=</span> <span class="bp">-</span><span class="mi">2147483648</span>
<span class="bp">|</span> <span class="n">word_size_t.i64</span> <span class="o">:=</span> <span class="bp">-</span><span class="mi">9223372036854775808</span>

<span class="kd">def</span> <span class="n">get_right_bound</span> <span class="o">:</span> <span class="n">word_size_t</span> <span class="bp">→</span> <span class="n">ℤ</span>
<span class="bp">|</span> <span class="n">word_size_t.char</span> <span class="o">:=</span> <span class="mi">128</span>
<span class="bp">|</span> <span class="n">word_size_t.i32</span> <span class="o">:=</span> <span class="mi">2147483648</span>
<span class="bp">|</span> <span class="n">word_size_t.i64</span> <span class="o">:=</span> <span class="mi">9223372036854775808</span>

<span class="kd">@[derive decidable_pred]</span> <span class="kd">def</span> <span class="n">within_bounds</span> <span class="o">(</span><span class="n">word_size</span> <span class="o">:</span> <span class="n">word_size_t</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">get_left_bound</span> <span class="n">word_size</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="n">get_right_bound</span> <span class="n">word_size</span>

<span class="kd">lemma</span> <span class="n">x_le_sum</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">lb</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">l</span> <span class="bp">→</span> <span class="n">lb</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="n">l.length</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">*</span> <span class="n">lb</span> <span class="bp">≤</span> <span class="n">l.sum</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">l</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">add_mul</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">l_ih</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">h'</span> <span class="n">x</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">this</span> <span class="o">(</span><span class="n">list.mem_cons_of_mem</span> <span class="n">l_hd</span> <span class="n">y</span><span class="o">),</span>
    <span class="n">assumption</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">int.add_le_add</span> <span class="n">this</span> <span class="o">(</span><span class="n">h'</span> <span class="n">l_hd</span> <span class="o">(</span><span class="n">list.mem_cons_self</span> <span class="n">l_hd</span> <span class="n">l_tl</span><span class="o">)),</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">conv</span> <span class="kd">begin</span>
    <span class="n">to_rhs</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">assumption</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">sum_le_x</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">ub</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">l</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">ub</span><span class="o">)</span> <span class="o">:</span> <span class="n">l.sum</span> <span class="bp">≤</span> <span class="o">(</span><span class="bp">↑</span><span class="n">l.length</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">*</span> <span class="n">ub</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">l</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">add_mul</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">l_ih</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">h'</span> <span class="n">x</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">this</span> <span class="o">(</span><span class="n">list.mem_cons_of_mem</span> <span class="n">l_hd</span> <span class="n">y</span><span class="o">),</span>
    <span class="n">assumption</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">int.add_le_add</span> <span class="n">this</span> <span class="o">(</span><span class="n">h'</span> <span class="n">l_hd</span> <span class="o">(</span><span class="n">list.mem_cons_self</span> <span class="n">l_hd</span> <span class="n">l_tl</span><span class="o">)),</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">conv</span> <span class="kd">begin</span>
    <span class="n">to_lhs</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">assumption</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">split2</span> <span class="o">(</span><span class="n">input</span> <span class="o">:</span> <span class="n">list</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">output</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">),</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">input</span> <span class="bp">→</span> <span class="bp">-</span><span class="mi">20</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">≤</span> <span class="mi">20</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">input.length</span> <span class="bp">≤</span> <span class="mi">30</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">),</span>
    <span class="n">x</span> <span class="bp">∈</span> <span class="o">[</span><span class="bp">↑</span><span class="o">(</span><span class="n">input.length</span><span class="o">),</span> <span class="bp">↑</span><span class="o">(</span><span class="n">input.length</span><span class="o">),</span> <span class="n">input.sum</span><span class="o">]</span> <span class="bp">++</span> <span class="n">input</span> <span class="bp">→</span>
    <span class="n">within_bounds</span> <span class="n">word_size_t.i32</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">list.mem_append.mp</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">this</span> <span class="n">h</span> <span class="n">h'</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">h'</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">get_right_bound</span><span class="o">,</span> <span class="n">get_left_bound</span><span class="o">,</span> <span class="n">within_bounds</span><span class="o">],</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">clear_except</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_zero_le</span> <span class="n">input.length</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">2147483648</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_nat_le.mpr</span> <span class="n">h'</span><span class="o">,</span>
    <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="mi">30</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2147483648</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">gt_of_gt_of_ge</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">cases</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">h'</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">get_right_bound</span><span class="o">,</span> <span class="n">get_left_bound</span><span class="o">,</span> <span class="n">within_bounds</span><span class="o">],</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">clear_except</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_zero_le</span> <span class="n">input.length</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">2147483648</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_nat_le.mpr</span> <span class="n">h'</span><span class="o">,</span>
    <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="mi">30</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2147483648</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">gt_of_gt_of_ge</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">cases</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">h</span> <span class="n">h'</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">get_right_bound</span><span class="o">,</span> <span class="n">get_left_bound</span><span class="o">,</span> <span class="n">within_bounds</span><span class="o">],</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">a1</span> <span class="o">:=</span> <span class="n">x_le_sum</span> <span class="n">input</span> <span class="o">(</span><span class="bp">-</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">a2</span> <span class="o">:</span> <span class="bp">-</span><span class="mi">600</span> <span class="bp">≤</span> <span class="o">(</span><span class="bp">↑</span><span class="n">input.length</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">-</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">clear_except</span> <span class="n">h'</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="o">(</span><span class="n">mul_le_mul_left_of_neg</span> <span class="o">(</span><span class="k">show</span> <span class="o">(</span><span class="bp">-</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">),</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">clear_except</span><span class="o">,</span> <span class="n">norm_num</span><span class="o">,</span> <span class="o">}))</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">(</span><span class="n">int.coe_nat_le.mpr</span> <span class="n">h'</span><span class="o">),</span>
    <span class="n">rw</span> <span class="o">(</span><span class="k">show</span> <span class="o">(</span><span class="bp">-</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="mi">30</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">600</span><span class="o">,</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">this</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">a3</span> <span class="o">:</span> <span class="bp">-</span><span class="mi">600</span> <span class="bp">≤</span> <span class="n">input.sum</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">clear_except</span> <span class="n">a1</span> <span class="n">a2</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a2</span> <span class="n">a1</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">a3</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">2147483648</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">≤</span> <span class="bp">-</span><span class="mi">600</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a'</span> <span class="n">a3</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="k">have</span> <span class="n">a1</span> <span class="o">:=</span> <span class="n">sum_le_x</span> <span class="n">input</span> <span class="mi">20</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span><span class="bp">.</span><span class="n">right</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">a2</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="n">input.length</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">600</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">clear_except</span> <span class="n">h'</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mul_le_mul</span> <span class="n">ℤ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">↑</span><span class="n">input.length</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="mi">30</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="kd">begin</span>
      <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_nat_le.mpr</span> <span class="n">h'</span><span class="o">,</span>
      <span class="n">assumption</span><span class="o">,</span>
    <span class="kd">end</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">),</span>
    <span class="n">norm_num</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">assumption</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">input.sum</span> <span class="bp">≤</span> <span class="mi">600</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">clear_except</span> <span class="n">a1</span> <span class="n">a2</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a1</span> <span class="n">a2</span><span class="o">,</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="mi">600</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2147483648</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">clear_except</span><span class="o">,</span> <span class="n">norm_num</span><span class="o">,</span> <span class="o">},</span>
    <span class="n">exact</span> <span class="n">gt_of_gt_of_ge</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">exfalso</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">list.not_mem_nil</span> <span class="n">x</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">assumption</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">h</span> <span class="n">this</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">h</span> <span class="n">x</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">get_right_bound</span><span class="o">,</span> <span class="n">get_left_bound</span><span class="o">,</span> <span class="n">within_bounds</span><span class="o">],</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">this.left</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">2147483648</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">≤</span> <span class="bp">-</span><span class="mi">20</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">clear_except</span><span class="o">,</span> <span class="n">norm_num</span><span class="o">,</span> <span class="o">},</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">this.right</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="mi">20</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2147483648</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">clear_except</span><span class="o">,</span> <span class="n">norm_num</span><span class="o">,</span> <span class="o">},</span>
  <span class="n">exact</span> <span class="n">gt_of_gt_of_ge</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="262929785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262929785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262929785">(Nov 28 2021 at 13:48)</a>:</h4>
<p>what might be causing this issue? this time i didn't use linarith... and i'm pretty sure that i'm not using slow tactics... so why on earth is this proof so slow lol</p>



<a name="262929861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262929861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262929861">(Nov 28 2021 at 13:50)</a>:</h4>
<p>Do you know exactly where the bottleneck is?</p>



<a name="262929871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262929871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262929871">(Nov 28 2021 at 13:50)</a>:</h4>
<p>You can add <code>set_option profiler true</code> and then use <code>sorry; { blah }</code> to comment out parts of the proof and see where the slow point is</p>



<a name="262930835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262930835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262930835">(Nov 28 2021 at 14:09)</a>:</h4>
<p>oh... this is so bizarre... i commented out most of the proof and it still takes forever to typecheck...</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">split2</span> <span class="o">(</span><span class="n">input</span> <span class="o">:</span> <span class="n">list</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">output</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">),</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">input</span> <span class="bp">→</span> <span class="bp">-</span><span class="mi">20</span> <span class="bp">≤</span> <span class="n">x</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">≤</span> <span class="mi">20</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">input.length</span> <span class="bp">≤</span> <span class="mi">30</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">),</span>
    <span class="n">x</span> <span class="bp">∈</span> <span class="o">[</span><span class="bp">↑</span><span class="o">(</span><span class="n">input.length</span><span class="o">),</span> <span class="bp">↑</span><span class="o">(</span><span class="n">input.length</span><span class="o">),</span> <span class="n">input.sum</span><span class="o">]</span> <span class="bp">++</span> <span class="n">input</span> <span class="bp">→</span>
    <span class="n">within_bounds</span> <span class="n">word_size_t.i32</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">list.mem_append.mp</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">this</span> <span class="n">h</span> <span class="n">h'</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">clear_except</span> <span class="n">h'</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">get_right_bound</span><span class="o">,</span> <span class="n">get_left_bound</span><span class="o">,</span> <span class="n">within_bounds</span><span class="o">],</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">clear_except</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_zero_le</span> <span class="n">input.length</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="bp">-</span><span class="mi">2147483648</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">le_trans</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">int.coe_nat_le.mpr</span> <span class="n">h'</span><span class="o">,</span>
    <span class="n">clear_except</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">norm_num</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">a'</span> <span class="o">:</span> <span class="o">(</span><span class="mi">30</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2147483648</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">gt_of_gt_of_ge</span> <span class="n">a'</span> <span class="n">this</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="gr">sorry</span><span class="o">,</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="c1">-- cases this,</span>
  <span class="c1">-- rw this,</span>
  <span class="c1">-- clear_except h',</span>
  <span class="c1">-- simp only [get_right_bound, get_left_bound, within_bounds],</span>
  <span class="c1">-- split,</span>
  <span class="c1">-- {</span>
  <span class="c1">--   clear_except,</span>
  <span class="c1">--   have := int.coe_zero_le input.length,</span>
  <span class="c1">--   have a' : (-2147483648 : ℤ) ≤ 0 := by norm_num,</span>
  <span class="c1">--   exact le_trans a' this,</span>
  <span class="c1">-- },</span>
  <span class="c1">-- {</span>
  <span class="c1">--   have := int.coe_nat_le.mpr h',</span>
  <span class="c1">--   clear_except this,</span>
  <span class="c1">--   norm_num at this,</span>
  <span class="c1">--   have a' : (30 : ℤ) &lt; 2147483648 := by norm_num,</span>
  <span class="c1">--   exact gt_of_gt_of_ge a' this,</span>
  <span class="c1">-- },</span>
  <span class="c1">-- cases this,</span>
  <span class="c1">-- rw this,</span>
  <span class="c1">-- clear_except h h',</span>
  <span class="c1">-- simp only [get_right_bound, get_left_bound, within_bounds],</span>
  <span class="c1">-- split,</span>
  <span class="c1">-- have a1 := x_le_sum input (-20 : ℤ) begin</span>
  <span class="c1">--   intros x y,</span>
  <span class="c1">--   exact (h x y).left,</span>
  <span class="c1">-- end,</span>
  <span class="c1">-- have a2 : -600 ≤ (↑input.length) * (-20 : ℤ) := begin</span>
  <span class="c1">--   clear_except h',</span>
  <span class="c1">--   have := (mul_le_mul_left_of_neg (show (-20 : ℤ) &lt; (0 : ℤ), by { clear_except, norm_num, })).mpr (int.coe_nat_le.mpr h'),</span>
  <span class="c1">--   rw (show (-20 : ℤ) * (↑30 : ℤ) = -600, by norm_num) at this,</span>
  <span class="c1">--   rw mul_comm at this,</span>
  <span class="c1">--   exact this,</span>
  <span class="c1">-- end,</span>
  <span class="c1">-- have a3 : -600 ≤ input.sum := begin</span>
  <span class="c1">--   clear_except a1 a2,</span>
  <span class="c1">--   exact le_trans a2 a1,</span>
  <span class="c1">-- end,</span>
  <span class="c1">-- clear_except a3,</span>
  <span class="c1">-- {</span>
  <span class="c1">--   have a' : (-2147483648 : ℤ) ≤ -600 := by norm_num,</span>
  <span class="c1">--   exact le_trans a' a3,</span>
  <span class="c1">-- },</span>
  <span class="c1">-- have a1 := sum_le_x input 20 begin</span>
  <span class="c1">--   intros x y,</span>
  <span class="c1">--   exact (h x y).right,</span>
  <span class="c1">-- end,</span>
  <span class="c1">-- have a2 : (↑input.length) * (20 : ℤ) ≤ 600 := begin</span>
  <span class="c1">--   clear_except h',</span>
  <span class="c1">--   have := @mul_le_mul ℤ _ (↑input.length : ℤ) (20 : ℤ) (30 : ℤ) (20 : ℤ) begin</span>
  <span class="c1">--     have := int.coe_nat_le.mpr h',</span>
  <span class="c1">--     assumption,</span>
  <span class="c1">--   end (by norm_num) (by norm_num) (by norm_num),</span>
  <span class="c1">--   norm_num at this,</span>
  <span class="c1">--   assumption,</span>
  <span class="c1">-- end,</span>
  <span class="c1">-- have : input.sum ≤ 600 := begin</span>
  <span class="c1">--   clear_except a1 a2,</span>
  <span class="c1">--   exact le_trans a1 a2,</span>
  <span class="c1">-- end,</span>
  <span class="c1">-- clear_except this,</span>
  <span class="c1">-- {</span>
  <span class="c1">--   have a' : (600 : ℤ) &lt; 2147483648 := by { clear_except, norm_num, },</span>
  <span class="c1">--   exact gt_of_gt_of_ge a' this,</span>
  <span class="c1">-- },</span>
  <span class="c1">-- clear_except this,</span>
  <span class="c1">-- exfalso,</span>
  <span class="c1">-- have := list.not_mem_nil x this,</span>
  <span class="c1">-- assumption,</span>
  <span class="c1">-- clear_except h this,</span>
  <span class="c1">-- have := h x this,</span>
  <span class="c1">-- clear_except this,</span>
  <span class="c1">-- simp only [get_right_bound, get_left_bound, within_bounds],</span>
  <span class="c1">-- split,</span>
  <span class="c1">-- have := this.left,</span>
  <span class="c1">-- clear_except this,</span>
  <span class="c1">-- {</span>
  <span class="c1">--   have a' : (-2147483648 : ℤ) ≤ -20 := by { clear_except, norm_num, },</span>
  <span class="c1">--   exact le_trans a' this,</span>
  <span class="c1">-- },</span>
  <span class="c1">-- have := this.right,</span>
  <span class="c1">-- clear_except this,</span>
  <span class="c1">-- have a' : (20 : ℤ) &lt; 2147483648 := by { clear_except, norm_num, },</span>
  <span class="c1">-- exact gt_of_gt_of_ge a' this,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="262930898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262930898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262930898">(Nov 28 2021 at 14:10)</a>:</h4>
<p>How fast are the <code>norm_num</code>s?</p>



<a name="262930907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262930907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262930907">(Nov 28 2021 at 14:10)</a>:</h4>
<p>Try extracting those haves to their own lemmas</p>



<a name="262931217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262931217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262931217">(Nov 28 2021 at 14:16)</a>:</h4>
<p>the norm nums are very fast apparently, most norm nums take less than 5ms to complete...</p>



<a name="262931223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262931223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262931223">(Nov 28 2021 at 14:16)</a>:</h4>
<p>The moment you accidentally trigger something which attempts to unfold 2147483648 you're dead, I guess.</p>



<a name="262931415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262931415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262931415">(Nov 28 2021 at 14:20)</a>:</h4>
<p>I think you are correct. because lean has finished elaborating the proof <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="262931479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262931479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262931479">(Nov 28 2021 at 14:22)</a>:</h4>
<p>next time I'll probably find a roundabout way to represent large constants because lean has a hard time dealing with them <span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>



<a name="262931666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/orange%20bar%20hell%21/near/262931666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/orange.20bar.20hell!.html#262931666">(Nov 28 2021 at 14:27)</a>:</h4>
<p>Lean 3 does...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>