---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html">preparing for lean-3.13.0</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197798649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798649">(May 16 2020 at 14:41)</a>:</h4>
<p>If you look at <a href="https://github.com/leanprover-community/lean/commits/master">https://github.com/leanprover-community/lean/commits/master</a>, which of yesterdays commits is most likely to cause breakage in <code>category_theory/whiskering</code>?</p>



<a name="197798716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798716">(May 16 2020 at 14:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">rewrite</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">did</span> <span class="n">not</span> <span class="n">find</span> <span class="kn">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pattern</span> <span class="k">in</span> <span class="n">the</span> <span class="n">target</span> <span class="n">expression</span>
  <span class="n">X</span><span class="bp">.</span><span class="n">map</span> <span class="err">?</span><span class="n">m_3</span> <span class="err">≫</span> <span class="n">f</span><span class="bp">.</span><span class="n">app</span> <span class="err">?</span><span class="n">m_2</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₁</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">category</span> <span class="n">C</span><span class="o">,</span>
<span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₂</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">category</span> <span class="n">D</span><span class="o">,</span>
<span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u₃</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_3</span> <span class="o">:</span> <span class="n">category</span> <span class="n">E</span><span class="o">,</span>
<span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">C</span> <span class="err">⥤</span> <span class="n">D</span><span class="o">,</span>
<span class="n">τ</span> <span class="o">:</span> <span class="n">F</span> <span class="err">⟶</span> <span class="n">G</span><span class="o">,</span>
<span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">D</span> <span class="err">⥤</span> <span class="n">E</span><span class="o">,</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Y</span><span class="o">,</span>
<span class="n">x</span> <span class="o">:</span> <span class="n">C</span>
<span class="err">⊢</span> <span class="o">(</span><span class="n">whisker_left</span> <span class="n">F</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">app</span> <span class="n">x</span> <span class="err">≫</span> <span class="n">Y</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">τ</span><span class="bp">.</span><span class="n">app</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">X</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">τ</span><span class="bp">.</span><span class="n">app</span> <span class="n">x</span><span class="o">)</span> <span class="err">≫</span> <span class="o">(</span><span class="n">whisker_left</span> <span class="n">G</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">app</span> <span class="n">x</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">simps</span><span class="o">]</span> <span class="n">def</span> <span class="n">whiskering_left</span> <span class="o">:</span> <span class="o">(</span><span class="n">C</span> <span class="err">⥤</span> <span class="n">D</span><span class="o">)</span> <span class="err">⥤</span> <span class="o">((</span><span class="n">D</span> <span class="err">⥤</span> <span class="n">E</span><span class="o">)</span> <span class="err">⥤</span> <span class="o">(</span><span class="n">C</span> <span class="err">⥤</span> <span class="n">E</span><span class="o">))</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">G</span><span class="o">,</span> <span class="n">F</span> <span class="err">⋙</span> <span class="n">G</span><span class="o">,</span>
    <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">G</span> <span class="n">H</span> <span class="n">α</span><span class="o">,</span> <span class="n">whisker_left</span> <span class="n">F</span> <span class="n">α</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span> <span class="n">G</span> <span class="n">τ</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">H</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">H</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">τ</span><span class="bp">.</span><span class="n">app</span> <span class="n">c</span><span class="o">),</span>
      <span class="n">naturality&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">f</span><span class="o">,</span> <span class="k">begin</span> <span class="n">dsimp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span><span class="n">H</span><span class="bp">.</span><span class="n">map_comp</span><span class="o">,</span> <span class="err">←</span><span class="n">H</span><span class="bp">.</span><span class="n">map_comp</span><span class="o">,</span> <span class="err">←</span><span class="n">τ</span><span class="bp">.</span><span class="n">naturality</span><span class="o">]</span> <span class="kn">end</span> <span class="o">},</span>
    <span class="n">naturality&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">f</span><span class="o">,</span> <span class="k">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">dsimp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">f</span><span class="bp">.</span><span class="n">naturality</span><span class="o">]</span> <span class="kn">end</span> <span class="o">}</span> <span class="o">}</span>
<span class="c1">-- error under the final `rw`</span>
</code></pre></div>



<a name="197798795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798795">(May 16 2020 at 14:44)</a>:</h4>
<p>Probably the congr_lemma/simp_lemma stuff, but partly because I don't know what those are</p>



<a name="197798797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798797">(May 16 2020 at 14:44)</a>:</h4>
<p>I can replace the <code>rw</code> with <code>erw</code>, and after that <code>refl</code> closes the goal. But I'd rather understand what went wrong...</p>



<a name="197798814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798814">(May 16 2020 at 14:45)</a>:</h4>
<p>My guess would be that the goal after <code>dsimp</code> changed somehow</p>



<a name="197798835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798835">(May 16 2020 at 14:45)</a>:</h4>
<p>Probably, yes</p>



<a name="197798843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798843">(May 16 2020 at 14:45)</a>:</h4>
<p>Can you check what the goal looks like in current mathlib?</p>



<a name="197798904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798904">(May 16 2020 at 14:46)</a>:</h4>
<p>Not easily at the moment</p>



<a name="197798913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798913">(May 16 2020 at 14:46)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="err">⊢</span> <span class="n">f</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="n">x</span><span class="o">)</span> <span class="err">≫</span> <span class="n">Y</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">τ</span><span class="bp">.</span><span class="n">app</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">X</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">τ</span><span class="bp">.</span><span class="n">app</span> <span class="n">x</span><span class="o">)</span> <span class="err">≫</span> <span class="n">f</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">G</span><span class="bp">.</span><span class="n">obj</span> <span class="n">x</span><span class="o">)</span>
</code></pre></div>


<p>(I found a second copy of mathlib on my disk.)</p>



<a name="197798915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798915">(May 16 2020 at 14:46)</a>:</h4>
<p>I strongly suggest keeping a build of the last working version available when doing upgrades for things like this</p>



<a name="197798916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798916">(May 16 2020 at 14:46)</a>:</h4>
<p>So yes, <code>dsimp</code> changed.</p>



<a name="197798949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197798949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197798949">(May 16 2020 at 14:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Is this expected behaviour? Is <code>dsimp</code> supposed to behave differently?</p>



<a name="197799068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197799068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197799068">(May 16 2020 at 14:50)</a>:</h4>
<p>I'll type this out so you can just paste it:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span> <span class="n">true</span>
</code></pre></div>



<a name="197799075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197799075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197799075">(May 16 2020 at 14:50)</a>:</h4>
<p>It could also be that the lemma that's supposed to be used changed in some way</p>



<a name="197799946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197799946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197799946">(May 16 2020 at 15:08)</a>:</h4>
<p><a href="#narrow/stream/144837-PR-reviews/topic/lean.23229/near/197722657">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/lean.23229/near/197722657</a></p>



<a name="197807368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197807368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197807368">(May 16 2020 at 18:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> thanks for the pointer. I'll see how much I can fix.</p>



<a name="197807380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197807380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197807380">(May 16 2020 at 18:03)</a>:</h4>
<p>That's the only change I needed for mathlib to compile after the <code>simp_cache</code> PR.</p>



<a name="197807426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197807426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197807426">(May 16 2020 at 18:04)</a>:</h4>
<p>I'm surprised that I didn't have any trouble with this "breaking change" in simp for the entire dependency tree of <code>number_theory/quadratic_reciprocity</code>. (Ok, I had to add <code>mul_assoc</code> to a <code>simp only</code> exactly once.)</p>



<a name="197807447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197807447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197807447">(May 16 2020 at 18:04)</a>:</h4>
<p>Aah, you're saying I should apply that patch, and hopefully be done with it?</p>



<a name="197807473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197807473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197807473">(May 16 2020 at 18:05)</a>:</h4>
<p>Yes!</p>



<a name="197807949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197807949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197807949">(May 16 2020 at 18:18)</a>:</h4>
<p>I've applied the patch. Trying to compile now.</p>



<a name="197808009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197808009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197808009">(May 16 2020 at 18:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> If this all compiles, would you consider releasing 3.13?</p>



<a name="197808194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197808194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197808194">(May 16 2020 at 18:23)</a>:</h4>
<p>It's the <em>weekend</em>.  But you can release 3.13 yourself if you want.  Just submit a PR like <a href="https://github.com/leanprover-community/lean/issues/235">lean#235</a>, let bors merge it, and then tag the merged commit with <code>v3.13.0</code>.</p>



<a name="197808405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197808405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197808405">(May 16 2020 at 18:28)</a>:</h4>
<p>If you're fine with me releasing it, then I'll try to do that.</p>



<a name="197808897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197808897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197808897">(May 16 2020 at 18:43)</a>:</h4>
<p>Hooray! This branch compiles <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="197809535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197809535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197809535">(May 16 2020 at 18:59)</a>:</h4>
<p>What's left is sorting out the copyright stuff.</p>



<a name="197809536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197809536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197809536">(May 16 2020 at 18:59)</a>:</h4>
<p>I'll leave that to others</p>



<a name="197810011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197810011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197810011">(May 16 2020 at 19:09)</a>:</h4>
<p>I emailed Leo but didn't hear back yet</p>



<a name="197810588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197810588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197810588">(May 16 2020 at 19:20)</a>:</h4>
<p>I put <a href="https://github.com/leanprover-community/lean/issues/243">lean#243</a> on the queue and I'll tag it when the build finishes.</p>



<a name="197811258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197811258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197811258">(May 16 2020 at 19:38)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> Thanks!</p>



<a name="197817352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817352">(May 16 2020 at 22:02)</a>:</h4>
<p>Linting failed, not too surprisingly. I'm guessing we should just add a bunch of stuff to nolints.txt and fix it later?</p>
<p>Also, <a href="https://github.com/leanprover-community/mathlib/runs/681449690#step:16:10">some tests failed</a>.</p>



<a name="197817609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817609">(May 16 2020 at 22:10)</a>:</h4>
<p><code>int.int.sub_self</code>?</p>



<a name="197817625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817625">(May 16 2020 at 22:10)</a>:</h4>
<p>also <code>int.int.eq_zero_or_eq_zero_of_mul_eq_zero</code></p>



<a name="197817632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817632">(May 16 2020 at 22:10)</a>:</h4>
<p>why are we setting a bunch of lemmas as protected in mathlib rather than in core?</p>



<a name="197817798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817798">(May 16 2020 at 22:14)</a>:</h4>
<p>There is obviously going to be a second "cleanup phase" to remove <code>init_</code> from mathlib, but I guess the intent is to delay that until after the initial version bump PR</p>



<a name="197817810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817810">(May 16 2020 at 22:15)</a>:</h4>
<p>and probably lint cleanups should be delayed until then</p>



<a name="197817820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817820">(May 16 2020 at 22:15)</a>:</h4>
<p>Where's <code>int.int.sub_self</code>? The linter didn't seem to catch that one: <a href="https://github.com/leanprover-community/mathlib/runs/681449690#step:14:121">https://github.com/leanprover-community/mathlib/runs/681449690#step:14:121</a></p>



<a name="197817861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817861">(May 16 2020 at 22:16)</a>:</h4>
<p>It's mentioned by name in the <code>mk_protected</code> call</p>



<a name="197817864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817864">(May 16 2020 at 22:16)</a>:</h4>
<p>it's in core</p>



<a name="197817943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197817943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197817943">(May 16 2020 at 22:19)</a>:</h4>
<p>Ah, yeah. Looks like they're both in <a href="https://github.com/leanprover-community/lean/blob/194cc8e2416b5969cfdab4006bb9e20cb75e5adc/library/init/data/int/order.lean#L941"><code>int.dat.int.order</code></a>.</p>



<a name="197818069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818069">(May 16 2020 at 22:22)</a>:</h4>
<p>Should I release 3.13.1 with those fixed?</p>



<a name="197818221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818221">(May 16 2020 at 22:27)</a>:</h4>
<p>PR: <a href="https://github.com/leanprover-community/lean/issues/245">lean#245</a></p>



<a name="197818224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818224">(May 16 2020 at 22:27)</a>:</h4>
<p>what about the protected definitions?</p>



<a name="197818270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818270">(May 16 2020 at 22:28)</a>:</h4>
<p>I could add that too if you think it's a good idea.</p>



<a name="197818279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818279">(May 16 2020 at 22:29)</a>:</h4>
<p>I do</p>



<a name="197818281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818281">(May 16 2020 at 22:29)</a>:</h4>
<p>Johan has conveniently already made a list</p>



<a name="197818286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818286">(May 16 2020 at 22:29)</a>:</h4>
<p>OK, I'll add it to this PR after dinner.</p>



<a name="197818331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197818331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197818331">(May 16 2020 at 22:30)</a>:</h4>
<p>(I should have <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a>'d it when he was asking about <code>mk_protected</code>)</p>



<a name="197822334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197822334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197822334">(May 17 2020 at 00:30)</a>:</h4>
<p>I wonder why <a href="https://github.com/leanprover-community/mathlib/pull/2697/commits/85ce04a7eb7705c98500d267d0baa3fc229e02ec#diff-0d60b2b0cf0a3c5c56123cb7124a73e3R3">these int lemmas are in a list called "nat_lemmas"</a>...</p>



<a name="197822847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197822847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197822847">(May 17 2020 at 00:48)</a>:</h4>
<p>Ah, I figured it out. <code>int.mul_pos</code> is already protected in core and <code>int.mul_le_mul</code> is in the second list, so those are supposed to be <code>nat.</code>.</p>



<a name="197823442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197823442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197823442">(May 17 2020 at 01:09)</a>:</h4>
<p>What's the purpose of <code>int.mul_sub</code> and <code>int.sub_mul</code>? Can I delete them?</p>



<a name="197823445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197823445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197823445">(May 17 2020 at 01:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="197823496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197823496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197823496">(May 17 2020 at 01:11)</a>:</h4>
<p>they are aliases</p>



<a name="197823510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197823510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197823510">(May 17 2020 at 01:11)</a>:</h4>
<p>I think <code>int.mul_sub_left_distrib</code> should just be renamed to <code>int.mul_sub</code></p>



<a name="197823549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197823549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197823549">(May 17 2020 at 01:12)</a>:</h4>
<p>we don't need aliases for specialized lemmas that will be superceded later</p>



<a name="197823570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197823570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197823570">(May 17 2020 at 01:13)</a>:</h4>
<p>OK, I'll just rename them. It's weird that they were made <code>def</code>s.</p>



<a name="197824205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197824205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197824205">(May 17 2020 at 01:32)</a>:</h4>
<p>Lean is already <em>being</em> bumped to 3.13.0 on Nix unstable :'D, <a href="https://github.com/NixOS/nixpkgs/pull/88002/files">https://github.com/NixOS/nixpkgs/pull/88002/files</a></p>



<a name="197824625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197824625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197824625">(May 17 2020 at 01:46)</a>:</h4>
<p>I just added a comment there.</p>



<a name="197825797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197825797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197825797">(May 17 2020 at 02:20)</a>:</h4>
<p>they are <code>def</code>s because you can skip the type if you do that</p>



<a name="197825826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197825826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197825826">(May 17 2020 at 02:20)</a>:</h4>
<p>mathlib has <code>alias</code> for this sort of thing</p>



<a name="197825885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197825885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197825885">(May 17 2020 at 02:22)</a>:</h4>
<p>Oh, OK. Makes sense. </p>
<p><a href="https://github.com/leanprover-community/lean/issues/245">lean#245</a> looks ready, by the way. Should I merge it and release 3.13.1, or do you think I should wait for Gabriel (even though it's the weekend)?</p>



<a name="197827348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197827348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197827348">(May 17 2020 at 03:06)</a>:</h4>
<p>I think it should be okay to move forward with it. I'm working on the mathlib 3.13 cleanup and this will make things easier</p>



<a name="197827358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197827358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197827358">(May 17 2020 at 03:06)</a>:</h4>
<p>Great, I'll move forward then.</p>



<a name="197829402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197829402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197829402">(May 17 2020 at 04:15)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> 3.13.1 has been released and the binaries are ready.</p>



<a name="197831546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197831546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197831546">(May 17 2020 at 05:22)</a>:</h4>
<p>Thanks! Sorry for the double namespace issue.</p>



<a name="197831644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197831644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197831644">(May 17 2020 at 05:26)</a>:</h4>
<p>No problem! I'm preparing a nolints.txt locally and I'll push again when that's done.</p>



<a name="197832329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832329">(May 17 2020 at 05:47)</a>:</h4>
<p>I'm getting a simp loop:</p>
<div class="codehilite"><pre><span></span><code><span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_fn_coe_base</span><span class="o">]:</span> <span class="err">⇑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑↑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_add_monoid_hom</span><span class="o">]:</span> <span class="err">⇑↑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_fn_coe_base</span><span class="o">]:</span> <span class="err">⇑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑↑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_add_monoid_hom</span><span class="o">]:</span> <span class="err">⇑↑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_fn_coe_base</span><span class="o">]:</span> <span class="err">⇑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑↑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_add_monoid_hom</span><span class="o">]:</span> <span class="err">⇑↑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_fn_coe_base</span><span class="o">]:</span> <span class="err">⇑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑↑</span><span class="n">hnp</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify</span><span class="bp">.</span><span class="n">rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">coe_add_monoid_hom</span><span class="o">]:</span> <span class="err">⇑↑</span><span class="n">hnp</span> <span class="bp">==&gt;</span> <span class="err">⇑</span><span class="n">hnp</span>
</code></pre></div>


<p>is this my fault, or was this present before 3.13?</p>



<a name="197832381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832381">(May 17 2020 at 05:49)</a>:</h4>
<p>MWE:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ring</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+*</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">⇑</span><span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+</span> <span class="n">β</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span>
</code></pre></div>



<a name="197832427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832427">(May 17 2020 at 05:50)</a>:</h4>
<p>Why does it pick the wrong instance for coercion of <code>ring_hom</code> to function?</p>



<a name="197832433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832433">(May 17 2020 at 05:51)</a>:</h4>
<p>Somehow it prefers the transitive instance to the explicit <code>has_coe_to_fun</code>.</p>



<a name="197832434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832434">(May 17 2020 at 05:51)</a>:</h4>
<p>I'm rearranging theorems, so that might be my fault</p>



<a name="197832438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832438">(May 17 2020 at 05:51)</a>:</h4>
<p>are you getting the transitive instance?</p>



<a name="197832480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832480">(May 17 2020 at 05:52)</a>:</h4>
<p>Works for me in mathlib from 5 days ago</p>



<a name="197832484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832484">(May 17 2020 at 05:52)</a>:</h4>
<p>In current <code>master</code>: no</p>



<a name="197832515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832515">(May 17 2020 at 05:53)</a>:</h4>
<p>where is the has_coe_to_fun instance?</p>



<a name="197832522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832522">(May 17 2020 at 05:53)</a>:</h4>
<p>In <code>algebra.ring</code></p>



<a name="197832571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832571">(May 17 2020 at 05:54)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/master/src/algebra/ring.lean#L351">here</a></p>



<a name="197832597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832597">(May 17 2020 at 05:55)</a>:</h4>
<p>Your MWE works for me in the 3.13 branch</p>



<a name="197832598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832598">(May 17 2020 at 05:55)</a>:</h4>
<p>Hm, that is still there in the right order with other things</p>



<a name="197832642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832642">(May 17 2020 at 05:56)</a>:</h4>
<p>well, it's broken on my current open-heart-surgery version of the file</p>



<a name="197832781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832781">(May 17 2020 at 06:01)</a>:</h4>
<p>Here's a MWE that should work on the latest version of <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">hom</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">is_unit</span>
<span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">norm_cast</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">split_ifs</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">units</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>
<span class="kn">variable</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="kn">set_option</span> <span class="n">default_priority</span> <span class="mi">100</span> <span class="c1">-- see Note [default priority]</span>
<span class="kn">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">true</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ancestor</span> <span class="n">has_mul</span> <span class="n">has_add</span><span class="o">]</span>
<span class="n">class</span> <span class="n">distrib</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_mul</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_add</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">left_distrib</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">c</span><span class="o">))</span>
<span class="o">(</span><span class="n">right_distrib</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">))</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ancestor</span> <span class="n">has_mul</span> <span class="n">has_zero</span><span class="o">]</span>
<span class="n">class</span> <span class="n">mul_zero_class</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_mul</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">zero_mul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_zero</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ancestor</span> <span class="n">add_comm_monoid</span> <span class="n">monoid</span> <span class="n">distrib</span> <span class="n">mul_zero_class</span><span class="o">]</span>
<span class="n">class</span> <span class="n">semiring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">,</span> <span class="n">monoid</span> <span class="n">α</span><span class="o">,</span> <span class="n">distrib</span> <span class="n">α</span><span class="o">,</span> <span class="n">mul_zero_class</span> <span class="n">α</span>

<span class="kn">structure</span> <span class="n">ring_hom</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">β</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">monoid_hom</span> <span class="n">α</span> <span class="n">β</span><span class="o">,</span> <span class="n">add_monoid_hom</span> <span class="n">α</span> <span class="n">β</span>

<span class="kn">infixr</span> <span class="bp">`</span> <span class="bp">→+*</span> <span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="o">:=</span> <span class="n">ring_hom</span>

<span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">rα</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">rβ</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">β</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→+*</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨_</span><span class="o">,</span> <span class="n">ring_hom</span><span class="bp">.</span><span class="n">to_fun</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">rα</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">rβ</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">β</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→+*</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→+</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">ring_hom</span><span class="bp">.</span><span class="n">to_add_monoid_hom</span><span class="bp">⟩</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">coe_add_monoid_hom</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">rα</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">rβ</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+*</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">⇑</span><span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+</span> <span class="n">β</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+*</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">⇑</span><span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→+</span> <span class="n">β</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span>
</code></pre></div>



<a name="197832928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832928">(May 17 2020 at 06:05)</a>:</h4>
<p>Note that <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a> build fails somewhere in <code>_init</code>.</p>



<a name="197832978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197832978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197832978">(May 17 2020 at 06:06)</a>:</h4>
<p>I think that <code>has_coe_to_fun</code> instance in <code>master</code> has default priority, not 100.</p>



<a name="197833010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833010">(May 17 2020 at 06:07)</a>:</h4>
<p>BTW, it would be nice if Lean generated the <code>ancestor</code> information for <code>old_structure_cmd</code> classes.</p>



<a name="197833101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833101">(May 17 2020 at 06:10)</a>:</h4>
<p>I know <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a> is not done yet, but the files that are imported here should be working</p>



<a name="197833265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833265">(May 17 2020 at 06:16)</a>:</h4>
<blockquote>
<p>I think that <code>has_coe_to_fun</code> instance in master has default priority, not 100.</p>
</blockquote>
<p><span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="197833479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833479">(May 17 2020 at 06:23)</a>:</h4>
<p>brilliant, that did it</p>



<a name="197833528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833528">(May 17 2020 at 06:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0/near/197833010">said</a>:</p>
<blockquote>
<p>BTW, it would be nice if Lean generated the <code>ancestor</code> information for <code>old_structure_cmd</code> classes.</p>
</blockquote>
<p>Indeed, it wasn't until I did the refactor that I even realized we are doing all this duplicate work</p>



<a name="197833538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833538">(May 17 2020 at 06:24)</a>:</h4>
<p>it's very confusing having important attributes declared in completely different files from the declaration</p>



<a name="197833552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833552">(May 17 2020 at 06:25)</a>:</h4>
<p>Currently <code>@[ancestor]</code> attributes are used, e.g., by <code>to_additive</code> to map functions like <code>group.to_monoid</code>.</p>



<a name="197833818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833818">(May 17 2020 at 06:34)</a>:</h4>
<p>What's the point of <a href="https://github.com/leanprover-community/mathlib/blob/master/test/doc_commands.lean#L6">this part of <code>test/doc_commands.lean</code></a>:</p>
<div class="codehilite"><pre><span></span><code><span class="c">/-</span><span class="cm">- ok -/</span>
<span class="n">add_decl_doc</span> <span class="n">division_ring</span>

<span class="bp">#</span><span class="kn">eval</span> <span class="n">do</span>
<span class="n">ds</span> <span class="err">←</span> <span class="n">doc_string</span> <span class="bp">``</span><span class="n">division_ring</span><span class="o">,</span>
<span class="n">guard</span> <span class="err">$</span> <span class="n">ds</span> <span class="bp">=</span> <span class="s2">&quot;ok&quot;</span>
</code></pre></div>


<p>The test is failing because <code>division_ring</code> is no longer automatically imported. </p>
<p>Should I search for another random undocumented declaration from core to use or can I just delete this? The next part of the file adds a random <code>def foo</code> with no docstring and tests that, so I think we're not losing anything, unless the behavior is somehow really different for imported declarations.</p>



<a name="197833871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833871">(May 17 2020 at 06:36)</a>:</h4>
<p>I think that the test should not rely on a declaration being undocumented.</p>



<a name="197833873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833873">(May 17 2020 at 06:36)</a>:</h4>
<p>I mean, we should try to avoid assumptions like this.</p>



<a name="197833883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833883">(May 17 2020 at 06:37)</a>:</h4>
<p>Recently I had to fix a test in core because it assumed that no file in core has a module docstring.</p>



<a name="197833885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833885">(May 17 2020 at 06:37)</a>:</h4>
<p>(and I added one module docstring)</p>



<a name="197833950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197833950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197833950">(May 17 2020 at 06:38)</a>:</h4>
<p>OK, I agree. I'll just delete that part of the test.</p>



<a name="197834058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834058">(May 17 2020 at 06:42)</a>:</h4>
<p>Another test question, this time for <a href="https://github.com/leanprover-community/mathlib/blob/master/test/monotonicity.lean#L19"><code>test/monotonicity.lean</code></a>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">monotonicity</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">norm_num</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_ring</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">list</span><span class="bp">.</span><span class="n">defs</span>

<span class="kn">open</span> <span class="n">list</span> <span class="n">tactic</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">example</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">3</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">4</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">))</span>
  <span class="o">(</span><span class="n">h&#39;</span> <span class="o">:</span> <span class="mi">5</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">6</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">))</span>
<span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">3</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">6</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">5</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">ac_mono</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">monotonic context not found</span>
<span class="cm">state:</span>
<span class="cm">h : 3 ≤ 4,</span>
<span class="cm">h&#39; : 5 ≤ 6</span>
<span class="cm">⊢ (1 + 3 + 2).sub 6 ≤ (4 + 2 + 1).sub 5</span>
<span class="cm">-/</span>
</code></pre></div>


<p>I think the fix is probably to add some more lemmas to <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/monotonicity/basic.lean#L159">the end of <code>tactic.monotonicity.basic</code></a>. Does anyone know off the top of their heads what I should add there?</p>



<a name="197834066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834066">(May 17 2020 at 06:43)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> ?</p>



<a name="197834178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834178">(May 17 2020 at 06:46)</a>:</h4>
<p>I wonder why it shows <code>-</code> as <code>a.sub b</code>. Is it possible that <code>mono</code> fails to understand that <code>int.sub</code> is the same as <code>add_group.sub</code>?</p>



<a name="197834187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834187">(May 17 2020 at 06:46)</a>:</h4>
<p>If yes, then it needs versions of <code>sub</code> lemmas for <code>int</code>.</p>



<a name="197834267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834267">(May 17 2020 at 06:49)</a>:</h4>
<p>Adding <code>attribute [mono] int.sub_le_sub</code> didn't help, unfortunately.</p>



<a name="197834597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834597">(May 17 2020 at 06:59)</a>:</h4>
<p>Ah, you were on the right track. I added <code>int.sub</code> <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/monotonicity/interactive.lean#L552">here</a> and it fixed it. I wonder if that's enough.</p>



<a name="197834779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834779">(May 17 2020 at 07:04)</a>:</h4>
<p>Specifically: should I also add <code>nat.sub</code>?</p>



<a name="197834909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197834909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197834909">(May 17 2020 at 07:08)</a>:</h4>
<p>I think that the answer is no because <code>int.sub</code> is <code>a + -b</code> while <code>nat.sub</code> is an inductive definition.</p>



<a name="197835024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835024">(May 17 2020 at 07:12)</a>:</h4>
<p>Ah, right. Looks like this example with nat subtraction doesn't work in my 3.11.0 playground, so I won't try to make it work with 3.13.1:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">3</span> <span class="bp">+</span> <span class="mi">6</span> <span class="bp">≤</span> <span class="mi">4</span> <span class="bp">+</span> <span class="mi">5</span><span class="o">)</span>
<span class="o">:</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">3</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">-</span> <span class="mi">6</span> <span class="bp">≤</span> <span class="mi">4</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">5</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ac_mono</span><span class="o">,</span>
<span class="kn">end</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">monotonic context not found</span>
<span class="cm">state:</span>
<span class="cm">h : 3 + 6 ≤ 4 + 5</span>
<span class="cm">⊢ nat.sub (1 + 3 + 2) 6 ≤ nat.sub (4 + 2) 1 + 5</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="197835101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835101">(May 17 2020 at 07:15)</a>:</h4>
<p>I think that unfold directive should first make sure it's unfolding to <code>a + -b</code></p>



<a name="197835109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835109">(May 17 2020 at 07:15)</a>:</h4>
<p>that is, it should not <code>unfold has_sub.sub</code> but rather <code>simp only [sub_eq_add_neg]</code></p>



<a name="197835295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835295">(May 17 2020 at 07:20)</a>:</h4>
<p>When I replace that <code>dunfold ...</code> with <code>simp only [sub_eq_add_neg]</code>, the first example I posted (with ints) fails with</p>
<div class="codehilite"><pre><span></span><code>tactic failed, there are no goals to be solved
state:
no goals
</code></pre></div>



<a name="197835305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835305">(May 17 2020 at 07:21)</a>:</h4>
<p>It also doesn't help with the nat subtraction example.</p>



<a name="197835421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835421">(May 17 2020 at 07:24)</a>:</h4>
<p>Anyways, I'm done with <a href="https://github.com/leanprover-community/mathlib/issues/2697">#2697</a> for now. I think it should have a green check mark... <span aria-label="fingers crossed" class="emoji emoji-1f91e" role="img" title="fingers crossed">:fingers_crossed:</span></p>



<a name="197835441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835441">(May 17 2020 at 07:25)</a>:</h4>
<p>In the first case I think that <code>simp only</code> performs some computations even if you don't ask it for this.</p>



<a name="197835480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197835480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197835480">(May 17 2020 at 07:26)</a>:</h4>
<p>So this <code>simp only [sub_eq_add_neg]</code> solves the goal.</p>



<a name="197842599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197842599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197842599">(May 17 2020 at 10:42)</a>:</h4>
<p><code>simp</code> will try <code>refl</code> and <code>trivial</code> afterwards, this might be the case here.</p>



<a name="197854388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197854388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197854388">(May 17 2020 at 15:29)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/2697">#2697</a> indeed builds, should we try and merge it?</p>



<a name="197855019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197855019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197855019">(May 17 2020 at 15:44)</a>:</h4>
<p>How does it interact with <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>? I mean, isn't <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a> suppose to supercede <a href="https://github.com/leanprover-community/mathlib/issues/2697">#2697</a>?</p>



<a name="197855033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197855033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197855033">(May 17 2020 at 15:45)</a>:</h4>
<p>And will merging <a href="https://github.com/leanprover-community/mathlib/issues/2697">#2697</a> break <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>?</p>



<a name="197855112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197855112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197855112">(May 17 2020 at 15:46)</a>:</h4>
<p>In fact, all the commits of <a href="https://github.com/leanprover-community/mathlib/issues/2697">#2697</a> are already integrated into <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>, so there shouldn't be any problem. I say go ahead!</p>



<a name="197855180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197855180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197855180">(May 17 2020 at 15:48)</a>:</h4>
<p>OK, let's go then.</p>



<a name="197866838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197866838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197866838">(May 17 2020 at 20:13)</a>:</h4>
<p>Oh, I just realized that one of the areas I was most looking forward to refactoring as a result of the move, the stuff on order structures, was not included as part of the big move. Have we looked at giving the same treatment to the <code>preorder</code>, <code>partial_order</code>, <code>linear_order</code> classes in core?</p>



<a name="197867043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867043">(May 17 2020 at 20:18)</a>:</h4>
<p>It was decided to postpone this to the next big refactor, to keep things vaguely under control.</p>



<a name="197867048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867048">(May 17 2020 at 20:18)</a>:</h4>
<p>Presumably it's much easier than removing algebra because we don't have to worry about <code>norm_num</code>, right?</p>



<a name="197867054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867054">(May 17 2020 at 20:19)</a>:</h4>
<p>But you're very welcome to take the next step, at least assume we sorted out this copyright line question</p>



<a name="197867122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867122">(May 17 2020 at 20:20)</a>:</h4>
<p>I haven't done much with the copyright line in <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>, I'm just merging the author lists</p>



<a name="197867432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867432">(May 17 2020 at 20:29)</a>:</h4>
<p>I didn't hear back from Leo</p>



<a name="197867443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867443">(May 17 2020 at 20:29)</a>:</h4>
<p>The license says that what we're doing is ok though, as far as I can see</p>



<a name="197867511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867511">(May 17 2020 at 20:30)</a>:</h4>
<p>There is no license issue, this is a politeness issue</p>



<a name="197867651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867651">(May 17 2020 at 20:35)</a>:</h4>
<p>what is the politeness issue? The author lists are being preserved</p>



<a name="197867656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197867656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197867656">(May 17 2020 at 20:35)</a>:</h4>
<p>plus lean 3 is still there on <code>leanprover/lean</code> where it has always been</p>



<a name="197870190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197870190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197870190">(May 17 2020 at 21:38)</a>:</h4>
<p>Did the module doc change in 3.13.0 (<a href="https://github.com/leanprover-community/lean/issues/241">lean#241</a>) cause module docs to stop showing up in the mathlib docs? Compare <a href="https://leanprover-community.github.io/mathlib_docs/algebra/group_with_zero.html">https://leanprover-community.github.io/mathlib_docs/algebra/group_with_zero.html</a> and <a href="https://github.com/leanprover-community/mathlib/blob/f23c361/src/algebra/group_with_zero.lean">https://github.com/leanprover-community/mathlib/blob/f23c361/src/algebra/group_with_zero.lean</a></p>



<a name="197870227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197870227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197870227">(May 17 2020 at 21:40)</a>:</h4>
<p>Are there no tests in core for the module doc retrieval functions?</p>



<a name="197872320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197872320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197872320">(May 17 2020 at 22:30)</a>:</h4>
<p>For reference, <a href="https://github.com/leanprover-community/mathlib_docs/commit/a0df3535d8110d6fe22e0d72634454cdf2318b4c#diff-388727afe2b8490b8049889aa610663dR228">here's the diff</a> where module docs were removed (the commit corresponding to <a href="https://github.com/leanprover-community/mathlib/issues/2697">#2697</a>).</p>
<p>There are two tests that mention <code>module_doc_strings</code> <a href="https://github.com/leanprover-community/lean/blob/master/tests/lean/doc_strings.lean">1</a> <a href="https://github.com/leanprover-community/lean/blob/master/tests/lean/run/doc_string3.lean">2</a> and they both passed. Is there something else to check?</p>



<a name="197872466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197872466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197872466">(May 17 2020 at 22:34)</a>:</h4>
<p>Neither of those test that docs from earlier modules stick around. They're both assuming that no earlier imports have module docs (which makes them fragile tests).</p>



<a name="197872929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197872929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197872929">(May 17 2020 at 22:46)</a>:</h4>
<p>Oh, I was looking at the wrong function. <code>module_doc_strings</code> only looks in the current file. </p>
<p>Yes, <code>olean_doc_strings</code> isn't tested and seems to behave strangely now. </p>
<p>Compare:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">open</span> <span class="n">tactic</span>

<span class="n">run_cmd</span> <span class="n">olean_doc_strings</span> <span class="bp">&gt;&gt;=</span> <span class="n">trace</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">empty.lean:4:0: information trace output</span>
<span class="cm">[((some /Users/chb/.elan/toolchains/leanprover-community-lean-3.13.1/lib/lean/library/init/meta/case_tag.lean),</span>
<span class="cm">  [(⟨8, 0⟩, # General operations on functions),</span>
<span class="cm">   (⟨9, 0⟩,</span>
<span class="cm">    # Case tags</span>

<span class="cm">Case tags are an internal mechanism used by certain tactics to communicate with</span>
<span class="cm">each other. They are generated by the tactics `cases`, `induction` and</span>
<span class="cm">`with_cases` (&#39;cases-like tactics&#39;), which generate goals corresponding to the</span>
<span class="cm">&#39;cases&#39; of an inductive hypothesis. Each of these goals carries a case tag. They</span>
<span class="cm">are consumed by the `case` tactic, which focuses on one of these cases. Their</span>
<span class="cm">purpose is twofold:</span>

<span class="cm">1. Give intuitive names to case goals. For example, when performing induction on</span>
<span class="cm">   a natural number, two cases are generated: one tagged with `nat.zero` and</span>
<span class="cm">   one tagged with `nat.succ`. Users can then focus on e.g. the second goal with</span>
<span class="cm">   `case succ {...}`.</span>
<span class="cm">2. Communicate which new hypotheses were introduced by the cases-like tactic</span>
<span class="cm">   that generated the goal. For example, when performing induction on a</span>
<span class="cm">   `list α`, the `cons` case introduces two hypotheses corresponding to the two</span>
<span class="cm">   arguments of the `cons` constructor. `case` allows users to name these with</span>
<span class="cm">   `case cons : x xs {...}`. To perform this renaming, `case` needs to know</span>
<span class="cm">   which hypotheses to rename; this information is contained in the case tag for</span>
<span class="cm">   the `cons` goal.</span>

<span class="cm">## Module contents</span>

<span class="cm">This module defines</span>

<span class="cm">1. what a case tag is (see `case_tag`);</span>
<span class="cm">2. how to render a `case_tag` as a list of names (see `render`);</span>
<span class="cm">3. how to parse  a `case_tag` from a list of names (see `parse`);</span>
<span class="cm">4. how to match a `case_tag` with a sequence of names given by the user</span>
<span class="cm">   (see `match_tag`).)]),</span>
<span class="cm"> (none, [])]</span>

<span class="cm">-/</span>
</code></pre></div>


<p>If I add <code>import doc</code> where <code>doc.lean</code> contains just <code>/-! hi -/</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">doc</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="n">run_cmd</span> <span class="n">olean_doc_strings</span> <span class="bp">&gt;&gt;=</span> <span class="n">trace</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">empty.lean:4:0: information trace output</span>
<span class="cm">[((some /Users/chb/Documents/lean/my_project_2/src/doc.lean),</span>
<span class="cm">  [(⟨8, 0⟩, # General operations on functions),</span>
<span class="cm">   (⟨9, 0⟩,</span>
<span class="cm">    # Case tags</span>

<span class="cm">Case tags are an internal mechanism used by certain tactics to communicate with</span>
<span class="cm">each other. They are generated by the tactics `cases`, `induction` and</span>
<span class="cm">`with_cases` (&#39;cases-like tactics&#39;), which generate goals corresponding to the</span>
<span class="cm">&#39;cases&#39; of an inductive hypothesis. Each of these goals carries a case tag. They</span>
<span class="cm">are consumed by the `case` tactic, which focuses on one of these cases. Their</span>
<span class="cm">purpose is twofold:</span>

<span class="cm">1. Give intuitive names to case goals. For example, when performing induction on</span>
<span class="cm">   a natural number, two cases are generated: one tagged with `nat.zero` and</span>
<span class="cm">   one tagged with `nat.succ`. Users can then focus on e.g. the second goal with</span>
<span class="cm">   `case succ {...}`.</span>
<span class="cm">2. Communicate which new hypotheses were introduced by the cases-like tactic</span>
<span class="cm">   that generated the goal. For example, when performing induction on a</span>
<span class="cm">   `list α`, the `cons` case introduces two hypotheses corresponding to the two</span>
<span class="cm">   arguments of the `cons` constructor. `case` allows users to name these with</span>
<span class="cm">   `case cons : x xs {...}`. To perform this renaming, `case` needs to know</span>
<span class="cm">   which hypotheses to rename; this information is contained in the case tag for</span>
<span class="cm">   the `cons` goal.</span>

<span class="cm">## Module contents</span>

<span class="cm">This module defines</span>

<span class="cm">1. what a case tag is (see `case_tag`);</span>
<span class="cm">2. how to render a `case_tag` as a list of names (see `render`);</span>
<span class="cm">3. how to parse  a `case_tag` from a list of names (see `parse`);</span>
<span class="cm">4. how to match a `case_tag` with a sequence of names given by the user</span>
<span class="cm">   (see `match_tag`).),</span>
<span class="cm">   (⟨1, 0⟩, hey!)]),</span>
<span class="cm"> (none, [])]</span>

<span class="cm">-/</span>
</code></pre></div>



<a name="197873309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197873309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197873309">(May 17 2020 at 22:54)</a>:</h4>
<p><code>olean_doc_strings</code> was formerly tested, but <a href="https://github.com/leanprover-community/lean/commit/7a1c469847e41f4f7db98da1df522935081a321e#diff-7c31b477dab65b1070571727ca6b0dfe">the test was removed</a> in <a href="https://github.com/leanprover-community/lean/issues/216">lean#216</a>. </p>
<p>Oh, this is the test that <span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span> mentioned <a href="#narrow/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0/near/197833883">earlier</a>. Not sure what the best solution would have been.</p>



<a name="197873777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197873777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197873777">(May 17 2020 at 23:01)</a>:</h4>
<p>I guess a good test would be to read the output of <code>olean_doc_strings</code> and then check each of the files / locations that appear to see if the doc strings actually exist there. This is beyond my capabilities though.</p>
<p>The issue as I understand it from my example above is that the module doc strings aren't being associated to the correct files. I'm not sure where to start with fixing <code>olean_doc_strings</code>.</p>



<a name="197876171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197876171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197876171">(May 18 2020 at 00:00)</a>:</h4>
<p>How do I silence the <code>simp_nf</code> linter warning in <a href="https://github.com/leanprover-community/mathlib/runs/683541688">https://github.com/leanprover-community/mathlib/runs/683541688</a> ? The message doesn't give any hints as to which lemma is bad</p>



<a name="197876871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197876871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197876871">(May 18 2020 at 00:12)</a>:</h4>
<p>This idiom is broken in 3.13:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_ring</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">w</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_mul_iff_one_le_left</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">w</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">le_mul_iff_one_le_left</span> <span class="n">h</span>
<span class="n">term</span>
  <span class="n">h</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="mi">0</span> <span class="bp">&lt;</span> <span class="err">?</span><span class="n">m_3</span>
</code></pre></div>


<p>Which is too bad, because I use this <em>a lot</em>. If you use <code>iff.mpr</code> instead of <code>(...).mpr</code> or <code>(...).2</code> then it works</p>



<a name="197876925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197876925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197876925">(May 18 2020 at 00:13)</a>:</h4>
<p>If you provide the type as in <code>@le_mul_iff_one_le_left nat _ _ _ h</code> then it works</p>



<a name="197876970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197876970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197876970">(May 18 2020 at 00:14)</a>:</h4>
<p>the fact that the theorem is stated with <code>&gt;</code> is a red herring, it does the same thing with <code>&lt;</code></p>



<a name="197877005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877005">(May 18 2020 at 00:15)</a>:</h4>
<p>I manually fixed a couple of instances of this in <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>, but the one above is apparently also causing <code>library_search</code> to fail to find this proof, which breaks one of the tests</p>



<a name="197877193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877193">(May 18 2020 at 00:20)</a>:</h4>
<p>Do you know which commit broke this?</p>



<a name="197877206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877206">(May 18 2020 at 00:20)</a>:</h4>
<p>I imagine it was the speed up release (3.12?)</p>



<a name="197877217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877217">(May 18 2020 at 00:21)</a>:</h4>
<p>I can make a test that works without any imports if you like</p>



<a name="197877277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877277">(May 18 2020 at 00:23)</a>:</h4>
<p><code>test/lint.lean</code> is also failing, and I don't understand the test enough to fix it. Something to do with detecting typeclass inference loops</p>



<a name="197877352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877352">(May 18 2020 at 00:24)</a>:</h4>
<p>Hmm, your example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_ring</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">w</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≥</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_mul_iff_one_le_left</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">w</span>
</code></pre></div>


<p>works with current mathlib master for me.</p>



<a name="197877428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877428">(May 18 2020 at 00:27)</a>:</h4>
<p>Ah... nat isn't imported</p>



<a name="197877440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877440">(May 18 2020 at 00:27)</a>:</h4>
<p>I'm pretty sure this is coming up in a real situation, but the library search test is broken for a more stupid reason</p>



<a name="197877627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877627">(May 18 2020 at 00:32)</a>:</h4>
<p>Ok, try this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_field</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="n">iff</span><span class="bp">.</span><span class="n">mp</span> <span class="o">(</span><span class="n">mul_self_inj_of_nonneg</span> <span class="bp">_</span> <span class="o">(</span><span class="n">mul_nonneg</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="bp">_</span> <span class="c1">-- ok</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mul_self_inj_of_nonneg</span> <span class="bp">_</span> <span class="o">(</span><span class="n">mul_nonneg</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">_</span> <span class="c1">-- not ok</span>
</code></pre></div>



<a name="197877785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197877785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197877785">(May 18 2020 at 00:37)</a>:</h4>
<p>Hmm, I'm getting errors at all of the underscores in both:</p>
<div class="codehilite"><pre><span></span><code><span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">c</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">a</span> <span class="bp">≥</span> <span class="mi">0</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span><span class="mi">47</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">0</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span><span class="mi">51</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">c</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">a</span> <span class="bp">≥</span> <span class="mi">0</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">b</span> <span class="bp">≥</span> <span class="mi">0</span>
<span class="n">empty</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">46</span><span class="o">:</span> <span class="n">error</span>
<span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span>
<span class="err">⊢</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>



<a name="197878022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878022">(May 18 2020 at 00:44)</a>:</h4>
<p>hm, maybe it's another instance priority mixup</p>



<a name="197878069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878069">(May 18 2020 at 00:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0/near/197876171">said</a>:</p>
<blockquote>
<p>How do I silence the <code>simp_nf</code> linter warning in <a href="https://github.com/leanprover-community/mathlib/runs/683541688">https://github.com/leanprover-community/mathlib/runs/683541688</a> ? The message doesn't give any hints as to which lemma is bad</p>
</blockquote>
<p>I'm not really sure, but do we need to have the <code>division_field</code> versions of these lemmas if they are provable using their <code>group_with_zero</code> counterparts?</p>



<a name="197878109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878109">(May 18 2020 at 00:46)</a>:</h4>
<p>Does <code>have := (mul_self_inj_of_nonneg _ (mul_nonneg _ _)),</code> work for you?</p>



<a name="197878121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878121">(May 18 2020 at 00:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_field</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="k">have</span> <span class="o">:=</span> <span class="o">(</span><span class="n">mul_self_inj_of_nonneg</span> <span class="bp">_</span> <span class="o">(</span><span class="n">mul_nonneg</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)),</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">empty.lean:7:0: error</span>
<span class="cm">tactic failed, there are unsolved goals</span>
<span class="cm">state:</span>
<span class="cm">9 goals</span>
<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α,</span>
<span class="cm">this : ?m_3 * ?m_3 = ?m_4 * ?m_5 * (?m_4 * ?m_5) ↔ ?m_3 = ?m_4 * ?m_5</span>
<span class="cm">⊢ c = a * b</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ Type ?</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ linear_ordered_field ?m_1</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_1</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_1</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_1</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ 0 ≤ ?m_3</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_3 ≥ 0</span>

<span class="cm">α : Type ?,</span>
<span class="cm">_inst_1 : linear_ordered_field α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_3 ≥ 0</span>
<span class="cm">-/</span>
<span class="kn">end</span>
</code></pre></div>



<a name="197878123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878123">(May 18 2020 at 00:47)</a>:</h4>
<p>We should just delete the <code>division_ring</code> versions of the lemmas, but I was hoping to leave that until the next PR</p>



<a name="197878164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878164">(May 18 2020 at 00:48)</a>:</h4>
<p>You could just remove the <code>@[simp]</code> from them then.</p>



<a name="197878174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878174">(May 18 2020 at 00:48)</a>:</h4>
<p>I get</p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="bp">@</span><span class="n">mul_self_inj_of_nonneg</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span> <span class="err">?</span><span class="n">m_4</span> <span class="err">?</span><span class="n">m_5</span> <span class="err">?</span><span class="n">m_6</span> <span class="o">(</span><span class="bp">@</span><span class="n">mul_nonneg</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_7</span><span class="o">}</span> <span class="err">?</span><span class="n">m_8</span> <span class="err">?</span><span class="n">m_9</span> <span class="err">?</span><span class="n">m_10</span> <span class="err">?</span><span class="n">m_11</span> <span class="err">?</span><span class="n">m_12</span> <span class="err">?</span><span class="n">m_13</span><span class="o">)</span>
<span class="n">term</span>
  <span class="bp">@</span><span class="n">mul_nonneg</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span> <span class="err">?</span><span class="n">m_4</span> <span class="err">?</span><span class="n">m_5</span> <span class="err">?</span><span class="n">m_6</span> <span class="err">?</span><span class="n">m_7</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">ge</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">ordered_cancel_add_comm_monoid</span><span class="bp">.</span><span class="n">to_partial_order</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_cancel_add_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span><span class="o">))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_mul</span><span class="bp">.</span><span class="n">mul</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class</span><span class="bp">.</span><span class="n">to_has_mul</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">semiring</span><span class="bp">.</span><span class="n">to_mul_zero_class</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span><span class="o">)))</span>
       <span class="err">?</span><span class="n">m_4</span>
       <span class="err">?</span><span class="n">m_5</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero</span><span class="bp">.</span><span class="n">zero</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class</span><span class="bp">.</span><span class="n">to_has_zero</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">semiring</span><span class="bp">.</span><span class="n">to_mul_zero_class</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span><span class="o">))))</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">ordered_add_comm_group</span><span class="bp">.</span><span class="n">to_partial_order</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ordered_ring</span><span class="bp">.</span><span class="n">to_ordered_add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_ring</span><span class="bp">.</span><span class="n">to_ordered_ring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field</span><span class="bp">.</span><span class="n">to_linear_ordered_ring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span><span class="o">))))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero</span><span class="bp">.</span><span class="n">zero</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">no_zero_divisors</span><span class="bp">.</span><span class="n">to_has_zero</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">integral_domain</span><span class="bp">.</span><span class="n">to_no_zero_divisors</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">field</span><span class="bp">.</span><span class="n">to_integral_domain</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field</span><span class="bp">.</span><span class="n">to_field</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span><span class="o">)))))</span>
    <span class="err">?</span><span class="n">m_4</span>
</code></pre></div>



<a name="197878241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878241">(May 18 2020 at 00:50)</a>:</h4>
<p>Prepare for <code>pp.all</code> spam:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_field</span>

<span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">all</span> <span class="n">true</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="k">have</span> <span class="o">:=</span> <span class="o">(</span><span class="n">mul_self_inj_of_nonneg</span> <span class="bp">_</span> <span class="o">(</span><span class="n">mul_nonneg</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)),</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">empty.lean:8:0: error</span>
<span class="cm">tactic failed, there are unsolved goals</span>
<span class="cm">state:</span>
<span class="cm">9 goals</span>
<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α,</span>
<span class="cm">this :</span>
<span class="cm">  iff</span>
<span class="cm">    (@eq.{?l_2+1} ?m_3</span>
<span class="cm">       (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">          (@no_zero_divisors.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">             (@domain.to_no_zero_divisors.{?l_2} ?m_3</span>
<span class="cm">                (@division_ring.to_domain.{?l_2} ?m_3</span>
<span class="cm">                   (@field.to_division_ring.{?l_2} ?m_3 (@linear_ordered_field.to_field.{?l_2} ?m_3 ?m_4)))))</span>
<span class="cm">          ?m_5</span>
<span class="cm">          ?m_5)</span>
<span class="cm">       (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">          (@no_zero_divisors.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">             (@domain.to_no_zero_divisors.{?l_2} ?m_3</span>
<span class="cm">                (@division_ring.to_domain.{?l_2} ?m_3</span>
<span class="cm">                   (@field.to_division_ring.{?l_2} ?m_3 (@linear_ordered_field.to_field.{?l_2} ?m_3 ?m_4)))))</span>
<span class="cm">          (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">             (@mul_zero_class.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">                (@semiring.to_mul_zero_class.{?l_2} ?m_3</span>
<span class="cm">                   (@ordered_semiring.to_semiring.{?l_2} ?m_3</span>
<span class="cm">                      (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                         (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                            (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4))))))</span>
<span class="cm">             ?m_6</span>
<span class="cm">             ?m_7)</span>
<span class="cm">          (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">             (@mul_zero_class.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">                (@semiring.to_mul_zero_class.{?l_2} ?m_3</span>
<span class="cm">                   (@ordered_semiring.to_semiring.{?l_2} ?m_3</span>
<span class="cm">                      (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                         (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                            (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4))))))</span>
<span class="cm">             ?m_6</span>
<span class="cm">             ?m_7)))</span>
<span class="cm">    (@eq.{?l_2+1} ?m_3 ?m_5</span>
<span class="cm">       (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">          (@mul_zero_class.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">             (@semiring.to_mul_zero_class.{?l_2} ?m_3</span>
<span class="cm">                (@ordered_semiring.to_semiring.{?l_2} ?m_3</span>
<span class="cm">                   (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                      (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                         (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4))))))</span>
<span class="cm">          ?m_6</span>
<span class="cm">          ?m_7))</span>
<span class="cm">⊢ @eq.{?l_1+1} α c</span>
<span class="cm">    (@has_mul.mul.{?l_1} α</span>
<span class="cm">       (@no_zero_divisors.to_has_mul.{?l_1} α</span>
<span class="cm">          (@domain.to_no_zero_divisors.{?l_1} α</span>
<span class="cm">             (@division_ring.to_domain.{?l_1} α</span>
<span class="cm">                (@field.to_division_ring.{?l_1} α (@linear_ordered_field.to_field.{?l_1} α _inst_1)))))</span>
<span class="cm">       a</span>
<span class="cm">       b)</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ Type ?l_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ linear_ordered_field.{?l_2} ?m_3</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ @has_le.le.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_cancel_add_comm_monoid.to_ordered_add_comm_monoid.{?l_2} ?m_3</span>
<span class="cm">                (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3</span>
<span class="cm">                   (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                      (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                         (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4))))))))</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@no_zero_divisors.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@domain.to_no_zero_divisors.{?l_2} ?m_3</span>
<span class="cm">             (@division_ring.to_domain.{?l_2} ?m_3</span>
<span class="cm">                (@field.to_division_ring.{?l_2} ?m_3 (@linear_ordered_field.to_field.{?l_2} ?m_3 ?m_4))))))</span>
<span class="cm">    ?m_5</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ @ge.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3</span>
<span class="cm">                (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                   (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                      (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4)))))))</span>
<span class="cm">    ?m_5</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_semiring.{?l_2} ?m_3</span>
<span class="cm">                (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                   (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                      (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4)))))))</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ @ge.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3</span>
<span class="cm">                (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                   (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                      (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4)))))))</span>
<span class="cm">    ?m_5</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_semiring.{?l_2} ?m_3</span>
<span class="cm">                (@ordered_ring.to_ordered_semiring.{?l_2} ?m_3</span>
<span class="cm">                   (@linear_ordered_ring.to_ordered_ring.{?l_2} ?m_3</span>
<span class="cm">                      (@linear_ordered_field.to_linear_ordered_ring.{?l_2} ?m_3 ?m_4)))))))</span>
<span class="cm">-/</span>
<span class="kn">end</span>
</code></pre></div>



<a name="197878536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197878536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197878536">(May 18 2020 at 00:55)</a>:</h4>
<p>hm, could you send me one more test:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">all</span> <span class="n">true</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">mul_nonneg</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">mul_self_inj_of_nonneg</span> <span class="bp">_</span> <span class="o">(</span><span class="k">by</span> <span class="o">{}),</span>
<span class="kn">end</span>
<span class="c1">-- solve1 tactic failed, focused goal has not been solved</span>
<span class="c1">-- state:</span>
<span class="c1">-- α : Type ?l_1,</span>
<span class="c1">-- _inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="c1">-- a b c : α,</span>
<span class="c1">-- this :</span>
<span class="c1">--   @ge.{?l_2} ?m_3</span>
<span class="c1">--     (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="c1">--        (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="c1">--           (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="c1">--              (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3 ?m_4))))</span>
<span class="c1">--     (@has_mul.mul.{?l_2} ?m_3</span>
<span class="c1">--        (@mul_zero_class.to_has_mul.{?l_2} ?m_3</span>
<span class="c1">--           (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4)))</span>
<span class="c1">--        ?m_5</span>
<span class="c1">--        ?m_6)</span>
<span class="c1">--     (@has_zero.zero.{?l_2} ?m_3</span>
<span class="c1">--        (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="c1">--           (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4))))</span>
<span class="c1">-- ⊢ @has_le.le.{?l_7} ?m_8</span>
<span class="c1">--     (@preorder.to_has_le.{?l_7} ?m_8</span>
<span class="c1">--        (@partial_order.to_preorder.{?l_7} ?m_8</span>
<span class="c1">--           (@ordered_add_comm_group.to_partial_order.{?l_7} ?m_8</span>
<span class="c1">--              (@ordered_ring.to_ordered_add_comm_group.{?l_7} ?m_8</span>
<span class="c1">--                 (@linear_ordered_ring.to_ordered_ring.{?l_7} ?m_8</span>
<span class="c1">--                    (@linear_ordered_field.to_linear_ordered_ring.{?l_7} ?m_8 ?m_9))))))</span>
<span class="c1">--     (@has_zero.zero.{?l_7} ?m_8</span>
<span class="c1">--        (@no_zero_divisors.to_has_zero.{?l_7} ?m_8</span>
<span class="c1">--           (@integral_domain.to_no_zero_divisors.{?l_7} ?m_8</span>
<span class="c1">--              (@field.to_integral_domain.{?l_7} ?m_8 (@linear_ordered_field.to_field.{?l_7} ?m_8 ?m_9)))))</span>
<span class="c1">--     ?m_10</span>
</code></pre></div>



<a name="197879012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197879012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197879012">(May 18 2020 at 01:03)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ordered_field</span>

<span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">all</span> <span class="n">true</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">mul_nonneg</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">mul_self_inj_of_nonneg</span> <span class="bp">_</span> <span class="o">(</span><span class="k">by</span> <span class="o">{}),</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">empty.lean:7:40: error</span>
<span class="cm">solve1 tactic failed, focused goal has not been solved</span>
<span class="cm">state:</span>
<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α,</span>
<span class="cm">this :</span>
<span class="cm">  @ge.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">    (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4)))</span>
<span class="cm">       ?m_5</span>
<span class="cm">       ?m_6)</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">⊢ @has_le.le.{?l_7} ?m_8</span>
<span class="cm">    (@preorder.to_has_le.{?l_7} ?m_8</span>
<span class="cm">       (@partial_order.to_preorder.{?l_7} ?m_8</span>
<span class="cm">          (@ordered_add_comm_monoid.to_partial_order.{?l_7} ?m_8</span>
<span class="cm">             (@ordered_cancel_add_comm_monoid.to_ordered_add_comm_monoid.{?l_7} ?m_8</span>
<span class="cm">                (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_7} ?m_8</span>
<span class="cm">                   (@ordered_ring.to_ordered_semiring.{?l_7} ?m_8</span>
<span class="cm">                      (@linear_ordered_ring.to_ordered_ring.{?l_7} ?m_8</span>
<span class="cm">                         (@linear_ordered_field.to_linear_ordered_ring.{?l_7} ?m_8 ?m_9))))))))</span>
<span class="cm">    (@has_zero.zero.{?l_7} ?m_8</span>
<span class="cm">       (@no_zero_divisors.to_has_zero.{?l_7} ?m_8</span>
<span class="cm">          (@domain.to_no_zero_divisors.{?l_7} ?m_8</span>
<span class="cm">             (@division_ring.to_domain.{?l_7} ?m_8</span>
<span class="cm">                (@field.to_division_ring.{?l_7} ?m_8 (@linear_ordered_field.to_field.{?l_7} ?m_8 ?m_9))))))</span>
<span class="cm">    ?m_10</span>
<span class="cm">state:</span>
<span class="cm">7 goals</span>
<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α,</span>
<span class="cm">this :</span>
<span class="cm">  @ge.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">    (@has_mul.mul.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_mul.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4)))</span>
<span class="cm">       ?m_5</span>
<span class="cm">       ?m_6)</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">⊢ @eq.{?l_1+1} α c</span>
<span class="cm">    (@has_mul.mul.{?l_1} α</span>
<span class="cm">       (@no_zero_divisors.to_has_mul.{?l_1} α</span>
<span class="cm">          (@domain.to_no_zero_divisors.{?l_1} α</span>
<span class="cm">             (@division_ring.to_domain.{?l_1} α</span>
<span class="cm">                (@field.to_division_ring.{?l_1} α (@linear_ordered_field.to_field.{?l_1} α _inst_1)))))</span>
<span class="cm">       a</span>
<span class="cm">       b)</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ Type ?l_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ordered_semiring.{?l_2} ?m_3</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ ?m_2</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ @ge.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">    ?m_5</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4))))</span>

<span class="cm">α : Type ?l_1,</span>
<span class="cm">_inst_1 : linear_ordered_field.{?l_1} α,</span>
<span class="cm">a b c : α</span>
<span class="cm">⊢ @ge.{?l_2} ?m_3</span>
<span class="cm">    (@preorder.to_has_le.{?l_2} ?m_3</span>
<span class="cm">       (@partial_order.to_preorder.{?l_2} ?m_3</span>
<span class="cm">          (@ordered_cancel_add_comm_monoid.to_partial_order.{?l_2} ?m_3</span>
<span class="cm">             (@ordered_semiring.to_ordered_cancel_add_comm_monoid.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">    ?m_5</span>
<span class="cm">    (@has_zero.zero.{?l_2} ?m_3</span>
<span class="cm">       (@mul_zero_class.to_has_zero.{?l_2} ?m_3</span>
<span class="cm">          (@semiring.to_mul_zero_class.{?l_2} ?m_3 (@ordered_semiring.to_semiring.{?l_2} ?m_3 ?m_4))))</span>
<span class="cm">-/</span>
<span class="kn">end</span>
</code></pre></div>



<a name="197879429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197879429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197879429">(May 18 2020 at 01:11)</a>:</h4>
<p>Hm, it appears that the typeclass solutions have indeed changed, but it's not clear to me how this unification problem is supposed to succeed in the first place</p>



<a name="197880033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880033">(May 18 2020 at 01:24)</a>:</h4>
<p>I get it now. Here is the unification problem on master:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span> <span class="n">α</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span> <span class="n">α</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">ordered_cancel_add_comm_monoid</span><span class="bp">.</span><span class="n">to_partial_order</span> <span class="n">α</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_cancel_add_comm_monoid</span> <span class="n">α</span> <span class="o">(</span><span class="n">id</span> <span class="bp">_</span><span class="o">)))))</span> <span class="bp">=</span>
  <span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span> <span class="n">α</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span> <span class="n">α</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">ordered_add_comm_monoid</span><span class="bp">.</span><span class="n">to_partial_order</span> <span class="n">α</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ordered_cancel_add_comm_monoid</span><span class="bp">.</span><span class="n">to_ordered_add_comm_monoid</span> <span class="n">α</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_cancel_add_comm_monoid</span> <span class="n">α</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">ordered_ring</span><span class="bp">.</span><span class="n">to_ordered_semiring</span> <span class="n">α</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_ring</span><span class="bp">.</span><span class="n">to_ordered_ring</span> <span class="n">α</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field</span><span class="bp">.</span><span class="n">to_linear_ordered_ring</span> <span class="n">α</span> <span class="o">(</span><span class="n">id</span> <span class="bp">_</span><span class="o">)))))))))</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- works</span>
</code></pre></div>


<p>and here is the new version</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span> <span class="n">α</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span> <span class="n">α</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">ordered_cancel_add_comm_monoid</span><span class="bp">.</span><span class="n">to_partial_order</span> <span class="n">α</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_cancel_add_comm_monoid</span> <span class="n">α</span> <span class="o">(</span><span class="n">id</span> <span class="bp">_</span><span class="o">)))))</span> <span class="bp">=</span>
  <span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span> <span class="n">α</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span> <span class="n">α</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">ordered_add_comm_group</span><span class="bp">.</span><span class="n">to_partial_order</span> <span class="n">α</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ordered_ring</span><span class="bp">.</span><span class="n">to_ordered_add_comm_group</span> <span class="n">α</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_ring</span><span class="bp">.</span><span class="n">to_ordered_ring</span> <span class="n">α</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field</span><span class="bp">.</span><span class="n">to_linear_ordered_ring</span> <span class="n">α</span> <span class="o">(</span><span class="n">id</span> <span class="bp">_</span><span class="o">)))))))</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>


<p>The original one works because <code>ordered_semiring</code> is in the chain of instances from <code>linear_ordered_field</code> to <code>has_le</code>. In the new path it goes via <code>ordered_ring -&gt; ordered_add_comm_group -&gt; ...</code> and skips <code>ordered_semiring</code>. It's a bit disturbing that elaboration depends on which of many defeq paths is found by typeclass inference, and while I think it would be possible to recover the original path I think there are other examples that would break on master and don't break with the new ordering</p>



<a name="197880110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880110">(May 18 2020 at 01:26)</a>:</h4>
<p>Will things get better in Lean 4?</p>



<a name="197880131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880131">(May 18 2020 at 01:27)</a>:</h4>
<p>this seems like a pretty messy elaboration order problem, so I wouldn't be surprised if the answer is no</p>



<a name="197880180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880180">(May 18 2020 at 01:28)</a>:</h4>
<p>The fact that everything in sight is an <code>old_structure_cmd</code> is also a contributing factor, I think</p>



<a name="197880197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880197">(May 18 2020 at 01:28)</a>:</h4>
<p>If these structures were neatly nested you would be guaranteed to have one fit in the other</p>



<a name="197880216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880216">(May 18 2020 at 01:30)</a>:</h4>
<p>but on the other hand that doesn't reflect the reality of the situation - algebraic classes do not form a tree, there are diamonds and so instances that work by deconstructing the input into pieces and rebuilding a new structure are necessary</p>



<a name="197880270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197880270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197880270">(May 18 2020 at 01:30)</a>:</h4>
<p>I removed the test because <a href="https://github.com/leanprover-community/lean/pull/216#issuecomment-625093651">it tested that no files in core have module docstrings</a>. Possibly a better approach would be to create another file, <code>import</code> it, and filter docstrings from this file only.</p>



<a name="197890772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197890772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197890772">(May 18 2020 at 05:31)</a>:</h4>
<p>So... 3.13 created a big mess? But is everything cleaned up now?</p>



<a name="197890819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197890819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197890819">(May 18 2020 at 05:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do classify the problematic behaviour as a regression?</p>



<a name="197891284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197891284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197891284">(May 18 2020 at 05:45)</a>:</h4>
<p>I think it's revealing a dependence on the order of instances. The new order isn't better or worse, but it is different and that breaks some existing proofs</p>



<a name="197891337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197891337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197891337">(May 18 2020 at 05:46)</a>:</h4>
<p>I think <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a> is ready now</p>



<a name="197893372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893372">(May 18 2020 at 06:26)</a>:</h4>
<p>I removed some unneeded <code>[to_additive]</code> attributes.</p>



<a name="197893420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893420">(May 18 2020 at 06:27)</a>:</h4>
<p><code>to_additive</code> automatically maps structure fields and projections. It needs <code>ancestor</code> attrs to deal with <code>old_structure_cmd</code> projections.</p>



<a name="197893445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893445">(May 18 2020 at 06:27)</a>:</h4>
<p>And it doesn't need to map <code>has_mul.mk</code> to <code>has_add.mk</code> because it maps prefixes, not full names.</p>



<a name="197893590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893590">(May 18 2020 at 06:29)</a>:</h4>
<p>That's great. I don't recall when <code>ancestor</code> was added and exactly what its scope is.</p>



<a name="197893653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893653">(May 18 2020 at 06:30)</a>:</h4>
<p>I think lean now has hooks for adding <code>structure</code>s, so perhaps it might even be possible to create <code>add_group</code> itself using <code>to_additive</code></p>



<a name="197893655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893655">(May 18 2020 at 06:30)</a>:</h4>
<p>When I was rewriting <code>to_additive</code>, <code>ancestor</code> was already here.</p>



<a name="197893666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893666">(May 18 2020 at 06:31)</a>:</h4>
<p>You mean adding <code>structure</code>s with all <code>mk</code>/<code>rec</code>/whatever?</p>



<a name="197893684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893684">(May 18 2020 at 06:31)</a>:</h4>
<p>I mean creating the <code>structure</code> input data, letting lean do the hard work of creating projections and all that</p>



<a name="197893748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197893748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197893748">(May 18 2020 at 06:32)</a>:</h4>
<p>I could be mistaken though. I know we added it for <code>inductive</code> but I forget if a hook for <code>structure</code> was also added</p>



<a name="197900187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197900187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197900187">(May 18 2020 at 07:45)</a>:</h4>
<p>I think <code>ancestor</code> was introduced for the purpose of <code>subtype_instance</code></p>



<a name="197903863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197903863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197903863">(May 18 2020 at 08:26)</a>:</h4>
<p>Skimming over this thread:</p>
<ul>
<li>The doc string bug is still open, right?  I'll get to it now.</li>
<li>There was a simp_nf linter bug, a type class inference bug, and something else?  If these are still issues, please file bugs / <a href="https://github.com/leanprover-community/mathlib/wiki/Minimum-Working-Example-&#40;MWE&#41;">#mwe</a> here.</li>
</ul>



<a name="197904017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197904017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197904017">(May 18 2020 at 08:27)</a>:</h4>
<p>I think the only bug is the doc string bug. The other things mentioned are just issues that came up with merging algebra together in <a href="https://github.com/leanprover-community/mathlib/issues/2707">#2707</a>.</p>



<a name="197904414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197904414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197904414">(May 18 2020 at 08:31)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> One more quesion: how do I copy an attribute like <code>no_rsimp</code> or <code>ematch</code>? <code>tactic.copy_attribute</code> doesn't work.</p>



<a name="197904843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197904843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197904843">(May 18 2020 at 08:35)</a>:</h4>
<p>I think you need to use <code>user_attribute</code> for this.  Look at <code>mk_hinst_lemma_attr_set</code> how the ematch attribute is defined.</p>



<a name="197905543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197905543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197905543">(May 18 2020 at 08:44)</a>:</h4>
<p>I also found an issue with typeclass inference, unrelated to the move to 3.13 though. Issue filed at <a href="https://github.com/leanprover-community/lean/issues/244">https://github.com/leanprover-community/lean/issues/244</a></p>



<a name="197905767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197905767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197905767">(May 18 2020 at 08:47)</a>:</h4>
<p>Discussion at <a href="#narrow/stream/116395-maths/topic/Normed.20spaces/near/197786186">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Normed.20spaces/near/197786186</a></p>



<a name="197910230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197910230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197910230">(May 18 2020 at 09:32)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/249">lean#249</a>, are there any other high priority fixes we should include in 3.13.2?</p>



<a name="197911151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197911151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197911151">(May 18 2020 at 09:42)</a>:</h4>
<p>I'm not aware of any</p>



<a name="197911669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197911669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197911669">(May 18 2020 at 09:48)</a>:</h4>
<p>Neither am I.</p>



<a name="197943144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197943144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197943144">(May 18 2020 at 14:34)</a>:</h4>
<p>Thanks for the quick fix, Gabriel!</p>



<a name="197943322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197943322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197943322">(May 18 2020 at 14:35)</a>:</h4>
<p>The docs should hopefully be fixed in 15-20 minutes.</p>
<p><strong>Edit</strong>: The module doc strings are back! <a href="https://leanprover-community.github.io/mathlib_docs/algebra/group_with_zero.html">https://leanprover-community.github.io/mathlib_docs/algebra/group_with_zero.html</a></p>



<a name="197945840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/197945840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#197945840">(May 18 2020 at 14:53)</a>:</h4>
<p>Leo said:</p>
<blockquote>
<p>Yes, the Apache license used in Lean allows anybody to copy files from Lean to other projects if they keep the copyright notice. I am not unhappy or happy with the idea of moving Lean3 files to mathlib.</p>
</blockquote>



<a name="198572787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/198572787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#198572787">(May 24 2020 at 08:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0/near/197866838">said</a>:</p>
<blockquote>
<p>Oh, I just realized that one of the areas I was most looking forward to refactoring as a result of the move, the stuff on order structures, was not included as part of the big move. Have we looked at giving the same treatment to the <code>preorder</code>, <code>partial_order</code>, <code>linear_order</code> classes in core?</p>
</blockquote>
<p>Is this just a matter of removing <code>init.algebra.order</code>? Should <code>init.algebra.classes</code> be cleaned up somehow too?</p>



<a name="198573966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/198573966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#198573966">(May 24 2020 at 08:58)</a>:</h4>
<p>If nothing in core breaks, yes</p>



<a name="198573976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/preparing%20for%20lean-3.13.0/near/198573976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/preparing.20for.20lean-3.2E13.2E0.html#198573976">(May 24 2020 at 08:59)</a>:</h4>
<p>It is likely though that some order theorems will be used over nat and int, and these need specialized versions or alternate proofs</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>