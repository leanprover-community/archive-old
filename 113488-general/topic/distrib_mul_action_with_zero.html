---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/distrib_mul_action_with_zero.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html">distrib_mul_action_with_zero</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="252577501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252577501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252577501">(Sep 09 2021 at 06:32)</a>:</h4>
<p>Is there any reason we don't have <code>distrib_mul_action_with_zero</code>? <code>module</code> isn't quite the intersection of <code>distrib_mul_action</code> and <code>mul_action_with_zero</code> as it also assumes <code>add_smul : ∀ (r s : R) (x : M), (r + s) • x = r • x + s • x</code>.</p>



<a name="252577538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252577538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252577538">(Sep 09 2021 at 06:32)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="310045">@Eric Wieser</span></p>



<a name="252578452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252578452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252578452">(Sep 09 2021 at 06:44)</a>:</h4>
<p>Probably due to lack of particular need?</p>



<a name="252580381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252580381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252580381">(Sep 09 2021 at 07:06)</a>:</h4>
<p>It comes up quite a lot with what I'm doing now. These are abstract lemmas, so it's not like I have a concrete example satisfying <code>distrib_mul_action_with_zero</code>. Should we define it then?</p>



<a name="252645406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252645406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252645406">(Sep 09 2021 at 15:28)</a>:</h4>
<p>I'm not opposed to adding it. I think I actually have an example of such an action in <a href="https://github.com/leanprover-community/mathlib/pull/8945/files#diff-923fd2b8078cd05fe5d03aee47329529e737233260a69f86464faf2602c94ccbR1001">https://github.com/leanprover-community/mathlib/pull/8945/files#diff-923fd2b8078cd05fe5d03aee47329529e737233260a69f86464faf2602c94ccbR1001</a></p>



<a name="252645477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252645477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252645477">(Sep 09 2021 at 15:28)</a>:</h4>
<p>(<a href="https://leanprover-community.github.io/mathlib_docs/find/submodule.pointwise_distrib_mul_action">docs#submodule.pointwise_distrib_mul_action</a>  and <a href="https://leanprover-community.github.io/mathlib_docs/find/submodule.pointwise_mul_action_with_zero">docs#submodule.pointwise_mul_action_with_zero</a> for when the PR lands)</p>



<a name="252646444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252646444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252646444">(Sep 09 2021 at 15:35)</a>:</h4>
<p>Ahah! Do you want to do it, as you seem to have done that all your life, or should I take the opportunity to learn about writing scalar actions and get gently pestered?</p>



<a name="252646616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252646616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252646616">(Sep 09 2021 at 15:36)</a>:</h4>
<p>Please go ahead!</p>



<a name="252646653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252646653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252646653">(Sep 09 2021 at 15:36)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/mul_action_with_zero">docs#mul_action_with_zero</a> was <span class="user-mention" data-user-id="321459">@Damiano Testa</span>'s doing anyway, I thought</p>



<a name="252670290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252670290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252670290">(Sep 09 2021 at 18:13)</a>:</h4>
<p>What's happening here?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.smul_with_zero</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">M</span><span class="o">]</span>

<span class="sd">/--  An action of a monoid with zero `R` on a Type `M`, also with `0`, extends `distrib_mul_action`</span>
<span class="sd">and is compatible with `0` (both in `R` and in `M`), with `1 ∈ R`, and with associativity of</span>
<span class="sd">multiplication on the monoid `M`. -/</span>
<span class="kd">class</span> <span class="n">distrib_mul_action_with_zero</span> <span class="kd">extends</span> <span class="n">distrib_mul_action</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="c1">-- this field is copied from `smul_with_zero`, as `extends` behaves poorly</span>
<span class="o">(</span><span class="n">zero_smul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="sd">/-- Converts a `mul` typeclass into the corresponding `smul` one. See also `semiring.to_module` -/</span>
<span class="kd">instance</span> <span class="n">monoid_with_zero.to_distrib_mul_action_with_zero</span> <span class="o">:</span> <span class="n">distrib_mul_action_with_zero</span> <span class="n">R</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">..</span><span class="n">mul_zero_class.to_smul_with_zero</span> <span class="n">R</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">monoid.to_distrib_mul_mul_action</span> <span class="n">R</span> <span class="o">}</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at field 'zero_smul'</span>
<span class="cm">  smul_with_zero.zero_smul</span>
<span class="cm">has type</span>
<span class="cm">  ∀ (m : R),</span>
<span class="cm">    @eq R</span>
<span class="cm">      (@has_scalar.smul R R</span>
<span class="cm">         (@smul_with_zero.to_has_scalar R R</span>
<span class="cm">            (@mul_zero_class.to_has_zero R</span>
<span class="cm">               (@mul_zero_one_class.to_mul_zero_class R (@monoid_with_zero.to_mul_zero_one_class R _inst_1)))</span>
<span class="cm">            (@mul_zero_class.to_has_zero R</span>
<span class="cm">               (@mul_zero_one_class.to_mul_zero_class R (@monoid_with_zero.to_mul_zero_one_class R _inst_1)))</span>
<span class="cm">            (@mul_zero_class.to_smul_with_zero R</span>
<span class="cm">               (@mul_zero_one_class.to_mul_zero_class R (@monoid_with_zero.to_mul_zero_one_class R _inst_1))))</span>
<span class="cm">         0</span>
<span class="cm">         m)</span>
<span class="cm">      0</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  ∀ (m : R),</span>
<span class="cm">    @eq R</span>
<span class="cm">      (@has_scalar.smul R R</span>
<span class="cm">         (@mul_action.to_has_scalar R R (@monoid_with_zero.to_monoid R _inst_1)</span>
<span class="cm">            (@distrib_mul_action.to_mul_action R R (@monoid_with_zero.to_monoid R _inst_1) ⁇</span>
<span class="cm">               (@distrib_mul_action_with_zero.to_distrib_mul_action R R _inst_1 ⁇</span>
<span class="cm">                  (@monoid_with_zero.to_distrib_mul_action_with_zero R _inst_1))))</span>
<span class="cm">         0</span>
<span class="cm">         m)</span>
<span class="cm">      0</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="252674107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252674107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252674107">(Sep 09 2021 at 18:36)</a>:</h4>
<p>Well for one that's highlighted as the wrong language</p>



<a name="252675048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252675048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252675048">(Sep 09 2021 at 18:42)</a>:</h4>
<p>Arf, Discord reflex here</p>



<a name="252675528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252675528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252675528">(Sep 09 2021 at 18:46)</a>:</h4>
<p>What is <code>monoid.to_distrib_mul_mul_action</code>?</p>



<a name="252675704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252675704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252675704">(Sep 09 2021 at 18:47)</a>:</h4>
<p>Sorry, that doesn't exist <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span></p>



<a name="252675785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252675785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252675785">(Sep 09 2021 at 18:48)</a>:</h4>
<p>But that wasn't the problem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">function.injective.distrib_mul_action_with_zero</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">zero_hom</span> <span class="n">M'</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">function.injective</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">smul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="n">b</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">f</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">distrib_mul_action_with_zero</span> <span class="n">R</span> <span class="n">M'</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">..</span><span class="n">hf.distrib_mul_action</span> <span class="n">f</span> <span class="n">smul</span><span class="o">,</span> <span class="bp">..</span><span class="n">hf.smul_with_zero</span> <span class="n">f</span> <span class="n">smul</span> <span class="o">}</span>
</code></pre></div>
<p><del>Same error...</del> Different error, actually!</p>



<a name="252676641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252676641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252676641">(Sep 09 2021 at 18:54)</a>:</h4>
<p>I think I just don't know what I'm doing.</p>



<a name="252676670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252676670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252676670">(Sep 09 2021 at 18:55)</a>:</h4>
<p>I'll study the typeclasses more thoroughly...</p>



<a name="252683533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683533">(Sep 09 2021 at 19:45)</a>:</h4>
<p>That's an entirely different code snippet!</p>



<a name="252683565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683565">(Sep 09 2021 at 19:45)</a>:</h4>
<p>but <a href="https://leanprover-community.github.io/mathlib_docs/find/function.injective.distrib_mul_action">docs#function.injective.distrib_mul_action</a> require an <code>add_monoid_hom</code> doesn't it?</p>



<a name="252683639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683639">(Sep 09 2021 at 19:46)</a>:</h4>
<p>And you're passing it a <code>zero_hom</code> (edit: until you just fixed it)</p>



<a name="252683689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683689">(Sep 09 2021 at 19:46)</a>:</h4>
<p>Psch <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="252683702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683702">(Sep 09 2021 at 19:46)</a>:</h4>
<p>What's the error message?</p>



<a name="252683762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683762">(Sep 09 2021 at 19:47)</a>:</h4>
<p>Now that's ok. I left the confusing error messages land.</p>



<a name="252683869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683869">(Sep 09 2021 at 19:48)</a>:</h4>
<p>Right now it's</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="n">M'</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_4</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">,</span>
<span class="n">_inst_5</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">M'</span><span class="o">,</span>
<span class="n">_inst_6</span> <span class="o">:</span> <span class="n">has_scalar</span> <span class="n">R</span> <span class="n">M'</span>
<span class="bp">⊢</span> <span class="n">add_zero_class</span> <span class="n">M'</span>
</code></pre></div>



<a name="252683969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252683969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252683969">(Sep 09 2021 at 19:48)</a>:</h4>
<p>which I can just solve by upgrading <code>has_zero M'</code> to <code>add_monoid M'</code></p>



<a name="252693021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252693021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252693021">(Sep 09 2021 at 20:48)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span>,  with the same definition as above, this loops (or at least repeats the same search over and over again) on typeclass inference:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">M</span><span class="o">][</span><span class="n">distrib_mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>
<p>Have I born a monster?</p>



<a name="252693110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252693110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252693110">(Sep 09 2021 at 20:49)</a>:</h4>
<p>It ends up repeating</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">32</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_225</span> <span class="o">:</span> <span class="bp">@</span><span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="n">M</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="n">M</span> <span class="n">_inst_2</span><span class="o">))</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">monoid_with_zero.to_mul_action_with_zero</span> <span class="bp">?</span><span class="n">x_226</span> <span class="bp">?</span><span class="n">x_227</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">32</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_225</span> <span class="o">:</span> <span class="bp">@</span><span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero</span> <span class="n">M</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class</span> <span class="n">M</span> <span class="n">_inst_2</span><span class="o">))</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">distrib_mul_action_with_zero.to_mul_action_with_zero</span> <span class="bp">?</span><span class="n">x_228</span> <span class="bp">?</span><span class="n">x_229</span> <span class="bp">?</span><span class="n">x_230</span> <span class="bp">?</span><span class="n">x_231</span> <span class="bp">?</span><span class="n">x_232</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">cached</span> <span class="kd">instance</span> <span class="n">for</span> <span class="n">add_monoid</span> <span class="n">M</span>
<span class="n">_inst_2</span>
</code></pre></div>



<a name="252693787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252693787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252693787">(Sep 09 2021 at 20:53)</a>:</h4>
<p>Actually, even <code>#check distrib_mul_action_with_zero.to_mul_action_with_zero R M</code> fails to terminate <span aria-label="fear" class="emoji emoji-1f628" role="img" title="fear">:fear:</span></p>



<a name="252693885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252693885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252693885">(Sep 09 2021 at 20:54)</a>:</h4>
<p>Mwe?</p>



<a name="252693905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252693905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252693905">(Sep 09 2021 at 20:54)</a>:</h4>
<p>Same as above</p>



<a name="252694054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694054">(Sep 09 2021 at 20:55)</a>:</h4>
<p>I thought all your snippets above gave errors</p>



<a name="252694055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694055">(Sep 09 2021 at 20:55)</a>:</h4>
<p>Can you put the whole lot inone code block?</p>



<a name="252694060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694060">(Sep 09 2021 at 20:55)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.smul_with_zero</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid_with_zero</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">class</span> <span class="n">distrib_mul_action_with_zero</span> <span class="kd">extends</span> <span class="n">distrib_mul_action</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">zero_smul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">,</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">variables</span> <span class="o">[</span><span class="n">distrib_mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="kd">@[priority 100]</span> <span class="c1">-- see Note [lower instance priority]</span>
<span class="kd">instance</span> <span class="n">distrib_mul_action_with_zero.to_mul_action_with_zero</span> <span class="o">[</span><span class="n">m</span> <span class="o">:</span> <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">{</span><span class="bp">..</span><span class="n">m</span><span class="o">}</span>

<span class="k">#check</span> <span class="n">distrib_mul_action_with_zero.to_mul_action_with_zero</span> <span class="n">R</span> <span class="n">M</span>
</code></pre></div>



<a name="252694211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694211">(Sep 09 2021 at 20:56)</a>:</h4>
<p>What the heck is <code>[m :</code> for there?</p>



<a name="252694300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694300">(Sep 09 2021 at 20:57)</a>:</h4>
<p>It has the same type as the instance you're trying to produce!</p>



<a name="252694379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694379">(Sep 09 2021 at 20:57)</a>:</h4>
<p>Oh, yeah. Words. Speaking. Hard. <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="252694490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694490">(Sep 09 2021 at 20:58)</a>:</h4>
<p>I knew I was being dumb!</p>



<a name="252694520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694520">(Sep 09 2021 at 20:58)</a>:</h4>
<p>I just didn't know how.</p>



<a name="252694721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694721">(Sep 09 2021 at 20:59)</a>:</h4>
<p>Thanks a lot <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="252694734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694734">(Sep 09 2021 at 20:59)</a>:</h4>
<p>Often talking to other people is a good way to get to the bottom of situations like that! Before chatrooms I used to write long emails to people every time I'd proved 0=1 and during my explanation I'd realise my mistake. What's that technique called? Something to do with ducks or something?</p>



<a name="252694911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252694911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252694911">(Sep 09 2021 at 21:00)</a>:</h4>
<p><a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">https://en.wikipedia.org/wiki/Rubber_duck_debugging</a></p>



<a name="252702678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252702678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252702678">(Sep 09 2021 at 21:59)</a>:</h4>
<p>Ahah! I actually managed to make all the proofs work.</p>



<a name="252704284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252704284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252704284">(Sep 09 2021 at 22:14)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/9123">#9123</a></p>



<a name="252704350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252704350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252704350">(Sep 09 2021 at 22:15)</a>:</h4>
<p>I didn't relax any <code>module</code> to <code>distrib_mul_action_with_zero</code> yet. Should that be part of this PR?</p>



<a name="252706767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252706767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252706767">(Sep 09 2021 at 22:39)</a>:</h4>
<p>I think you should probably at least add instances for everything that already has a <a href="https://leanprover-community.github.io/mathlib_docs/find/mul_action_with_zero">docs#mul_action_with_zero</a> instance and can be generalized</p>



<a name="252707116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707116">(Sep 09 2021 at 22:43)</a>:</h4>
<p>Namely, <code>pi</code>, <code>prod</code>, and <code>order_dual</code>.</p>



<a name="252707153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707153">(Sep 09 2021 at 22:43)</a>:</h4>
<p>Also, there seems to be a duplicate! <a href="https://leanprover-community.github.io/mathlib_docs/find/opposite.monoid_with_zero.to_opposite_mul_action_with_zero">docs#opposite.monoid_with_zero.to_opposite_mul_action_with_zero</a>  vs <a href="https://leanprover-community.github.io/mathlib_docs/find/monoid_with_zero.to_opposite_mul_action_with_zero">docs#monoid_with_zero.to_opposite_mul_action_with_zero</a></p>



<a name="252707238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707238">(Sep 09 2021 at 22:44)</a>:</h4>
<p>Oooh, good find!</p>



<a name="252707287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707287">(Sep 09 2021 at 22:45)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/opposite.semiring.to_opposite_module">docs#opposite.semiring.to_opposite_module</a> is also a duplicate of <a href="https://leanprover-community.github.io/mathlib_docs/find/semiring.to_opposite_module">docs#semiring.to_opposite_module</a></p>



<a name="252707316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707316">(Sep 09 2021 at 22:45)</a>:</h4>
<p>Which ones should I remove?</p>



<a name="252707321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707321">(Sep 09 2021 at 22:45)</a>:</h4>
<p>It looks like some sinister accidental namespacing has prevented their names clashing</p>



<a name="252707331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252707331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252707331">(Sep 09 2021 at 22:45)</a>:</h4>
<p>The <code>opposite.</code> prefix shouldn't be there</p>



<a name="252709224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252709224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252709224">(Sep 09 2021 at 23:03)</a>:</h4>
<p>And <code>mul_zero_class.to_opposite_smul_with_zero</code> vs <code>opposite.mul_zero_class.to_opposite_smul_with_zero</code></p>



<a name="252749844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252749844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252749844">(Sep 10 2021 at 08:21)</a>:</h4>
<p>I don't understand this build fail: <a href="https://github.com/leanprover-community/mathlib/runs/3561609511">https://github.com/leanprover-community/mathlib/runs/3561609511</a><br>
but maybe the <code>pi</code>/<code>prod</code>/<code>order_dual</code> instances will solve it?</p>



<a name="252750707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252750707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252750707">(Sep 10 2021 at 08:29)</a>:</h4>
<p>My hunch: The build failure is that the <code>has_scalar</code> in that <code>is_scalar_tower</code> is not syntactically equal to the one it used to be (aka the one we have an instance for), and the lean3 typeclass search gets stuck on dependent arguments like that sometimes.</p>



<a name="252751069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252751069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252751069">(Sep 10 2021 at 08:32)</a>:</h4>
<p>Arf, what can I do?</p>



<a name="252751122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252751122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252751122">(Sep 10 2021 at 08:33)</a>:</h4>
<p>Well, your PR has some typos that may or may not help</p>



<a name="252751147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252751147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252751147">(Sep 10 2021 at 08:33)</a>:</h4>
<p>I'd try finding the instance manually with a <code>haveI</code>, and see if lean thinks their types are equal</p>



<a name="252751588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252751588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252751588">(Sep 10 2021 at 08:36)</a>:</h4>
<p>I could squash all the typos had I a functioning infoview, but I'm in hell so I'm coding blindly.</p>



<a name="252752083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252752083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252752083">(Sep 10 2021 at 08:40)</a>:</h4>
<p>Why are you in hell?</p>



<a name="252752170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252752170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252752170">(Sep 10 2021 at 08:40)</a>:</h4>
<p>I have no idea <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="252752197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252752197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252752197">(Sep 10 2021 at 08:41)</a>:</h4>
<p>I think the best approach to get out of it is:</p>
<ul>
<li>Close all tabs in vs-code</li>
<li>Close vs-code</li>
<li>Use <code>get-cache --rev</code> on the last known revision</li>
<li>Reopen vs-code</li>
</ul>



<a name="252753706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252753706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252753706">(Sep 10 2021 at 08:54)</a>:</h4>
<p>Didn't do anything but I'm out of hell!</p>



<a name="252776478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252776478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252776478">(Sep 10 2021 at 12:12)</a>:</h4>
<p>All the <code>order_dual</code> instances in <code>algebra.ordered_smul</code> but the last one could be generalized. That's why I had a relaxable <code>semiring</code> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="252812723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252812723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252812723">(Sep 10 2021 at 16:27)</a>:</h4>
<p>How did you do that slide by the way? <a href="https://eric-wieser.github.io/fmm-2021/#/elementary-multiplication-stronger/4">https://eric-wieser.github.io/fmm-2021/#/elementary-multiplication-stronger/4</a><br>
I'm very interested in visualising hierarchies like that. I think we should have such pictures somewhere in the docs.</p>



<a name="252813578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252813578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252813578">(Sep 10 2021 at 16:32)</a>:</h4>
<p>I wrote it out by hand as a graphviz file then compiled it to svg.</p>



<a name="252813680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252813680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252813680">(Sep 10 2021 at 16:33)</a>:</h4>
<p><a href="https://eric-wieser.github.io/fmm-2021/figures/has_mul.dot">https://eric-wieser.github.io/fmm-2021/figures/has_mul.dot</a></p>



<a name="252813831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252813831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252813831">(Sep 10 2021 at 16:34)</a>:</h4>
<p>(If you hit view source on the presentation, every <code>.dot.svg</code> file has a corresponding <code>.dot</code> uploaded)</p>



<a name="252814116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252814116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252814116">(Sep 10 2021 at 16:36)</a>:</h4>
<p>Oh, by hand.</p>



<a name="252815253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252815253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252815253">(Sep 10 2021 at 16:45)</a>:</h4>
<p>I seem to have gotten a random timeout: <a href="https://github.com/leanprover-community/mathlib/pull/9123/checks?check_run_id=3567080085">https://github.com/leanprover-community/mathlib/pull/9123/checks?check_run_id=3567080085</a><br>
I can't reproduce it locally.</p>



<a name="252816196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252816196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252816196">(Sep 10 2021 at 16:52)</a>:</h4>
<p>The culprit is <a href="https://leanprover-community.github.io/mathlib_docs/ring_theory/ideal/basic.html#ideal.module_pi"><code>ideal.module_pi</code></a>. Is there any speedup available?</p>



<a name="252822529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252822529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252822529">(Sep 10 2021 at 17:39)</a>:</h4>
<p>I've got timeouts there before</p>



<a name="252822593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252822593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252822593">(Sep 10 2021 at 17:39)</a>:</h4>
<p>Can you spin out a PR to delete all the duplicate instances so that we can at least merge that while you fight the timeouts?</p>



<a name="252823814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252823814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252823814">(Sep 10 2021 at 17:48)</a>:</h4>
<p>Sure</p>



<a name="252836096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252836096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252836096">(Sep 10 2021 at 19:19)</a>:</h4>
<p>Uh. I reran the jobs and I got a different error. <a href="https://github.com/leanprover-community/mathlib/pull/9123/checks?check_run_id=3569471500">https://github.com/leanprover-community/mathlib/pull/9123/checks?check_run_id=3569471500</a></p>



<a name="252847947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252847947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252847947">(Sep 10 2021 at 20:45)</a>:</h4>
<p>New scalar hierarchy <a href="/user_uploads/3121/MIEckqOgJUru9pUITP0glmDw/image.png">scalar_hierarchy.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/MIEckqOgJUru9pUITP0glmDw/image.png" title="scalar_hierarchy.png"><img src="/user_uploads/3121/MIEckqOgJUru9pUITP0glmDw/image.png"></a></div>



<a name="252847981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252847981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252847981">(Sep 10 2021 at 20:45)</a>:</h4>
<p>Yes, I had fun with Paint</p>



<a name="252861428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252861428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252861428">(Sep 10 2021 at 22:55)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/mul_distrib_mul_action">docs#mul_distrib_mul_action</a> is also new</p>



<a name="252893182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252893182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252893182">(Sep 11 2021 at 08:25)</a>:</h4>
<p>Where does it fit? Between <code>mul_semiring_action</code> and <code>distrib_mul_action</code>?</p>



<a name="252896770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252896770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252896770">(Sep 11 2021 at 09:33)</a>:</h4>
<p>Updated updated scalar hierarchy <a href="/user_uploads/3121/1i66Y2oBlVBKHJ9pZ4wOhXMu/Scalar-hierarchy.png">Scalar-hierarchy.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/1i66Y2oBlVBKHJ9pZ4wOhXMu/Scalar-hierarchy.png" title="Scalar-hierarchy.png"><img src="/user_uploads/3121/1i66Y2oBlVBKHJ9pZ4wOhXMu/Scalar-hierarchy.png"></a></div>



<a name="252898888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252898888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252898888">(Sep 11 2021 at 10:13)</a>:</h4>
<p>Oh sorry, it's adjacent to distrb_mul_action not a superset of it</p>



<a name="252898946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252898946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252898946">(Sep 11 2021 at 10:14)</a>:</h4>
<p>Ah, and <code>mul_semiring_action</code> goes to both of them?</p>



<a name="252898995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252898995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252898995">(Sep 11 2021 at 10:15)</a>:</h4>
<p>Yes!</p>



<a name="252924635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252924635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252924635">(Sep 11 2021 at 17:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252816196">said</a>:</p>
<blockquote>
<p>The culprit is <a href="https://leanprover-community.github.io/mathlib_docs/ring_theory/ideal/basic.html#ideal.module_pi"><code>ideal.module_pi</code></a>. Is there any speedup available?</p>
</blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/issues/9148">#9148</a></p>



<a name="252924736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/252924736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#252924736">(Sep 11 2021 at 17:48)</a>:</h4>
<p>Wow thanks!</p>



<a name="253003930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/253003930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#253003930">(Sep 12 2021 at 18:38)</a>:</h4>
<p>Sorry to bother you again, but I'm getting yet another error I don't understand. <a href="https://github.com/leanprover-community/mathlib/runs/3579349443">https://github.com/leanprover-community/mathlib/runs/3579349443</a><br>
The instructions are very detailed, but I don't really get it. How do I "run <code>scripts/mk_all.sh</code>"? <code>sh mk_all.sh</code> doesn't seem to produce anything.</p>
<p>Here's the message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c">/-</span><span class="cm"> The `fails_quickly` linter reports: -/</span>
<span class="c">/-</span><span class="cm"> TYPE CLASS SEARCHES TIMED OUT.</span>
<span class="cm">The following instances are part of a loop, or an excessively long search.</span>
<span class="cm">It is common that the loop occurs in a different class than the one flagged below,</span>
<span class="cm">but usually an instance that is part of the loop is also flagged.</span>
<span class="cm">To debug:</span>
<span class="cm">(1) run `scripts/mk_all.sh` and create a file with `import all` and</span>
<span class="cm">`set_option trace.class_instances true`</span>
<span class="cm">(2) Recreate the state shown in the error message. You can do this easily by copying the type of</span>
<span class="cm">the instance (the output of `#check @my_instance`), turning this into an example and removing the</span>
<span class="cm">last argument in square brackets. Prove the example using `by apply_instance`.</span>
<span class="cm">For example, if `additive.topological_add_group` raises an error, run</span>
</code></pre></div>
<p>example {G : Type*} [topological_space G] [group G] : topological_add_group (additive G) :=<br>
by apply_instance</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="n">What</span> <span class="n">error</span> <span class="k">do</span> <span class="n">you</span> <span class="n">get</span><span class="bp">?</span>
<span class="o">(</span><span class="mi">3</span><span class="n">a</span><span class="o">)</span> <span class="n">If</span> <span class="n">the</span> <span class="n">error</span> <span class="n">is</span> <span class="s2">"tactic.mk_instance failed to generate instance"</span><span class="o">,</span>
<span class="n">there</span> <span class="n">might</span> <span class="n">be</span> <span class="n">nothing</span> <span class="n">wrong.</span> <span class="n">But</span> <span class="n">it</span> <span class="n">might</span> <span class="n">take</span> <span class="n">unreasonably</span> <span class="n">long</span> <span class="n">for</span> <span class="n">the</span> <span class="n">type</span><span class="bp">-</span><span class="kd">class</span> <span class="n">inference</span> <span class="n">to</span>
<span class="n">fail.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">trace</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">type</span><span class="bp">-</span><span class="kd">class</span> <span class="n">inference</span> <span class="n">takes</span> <span class="n">any</span> <span class="n">unnecessary</span> <span class="n">long</span> <span class="n">unexpected</span> <span class="n">turns.</span>
<span class="n">If</span> <span class="n">not</span><span class="o">,</span> <span class="n">feel</span> <span class="n">free</span> <span class="n">to</span> <span class="n">increase</span> <span class="n">the</span> <span class="n">value</span> <span class="k">in</span> <span class="n">the</span> <span class="kd">definition</span> <span class="n">of</span> <span class="n">the</span> <span class="n">linter</span> <span class="bp">`</span><span class="n">fails_quickly</span><span class="bp">`.</span>
<span class="o">(</span><span class="mi">3</span><span class="n">b</span><span class="o">)</span> <span class="n">If</span> <span class="n">the</span> <span class="n">error</span> <span class="n">is</span> <span class="s2">"maximum class-instance resolution depth has been reached"</span> <span class="n">there</span> <span class="n">is</span> <span class="n">almost</span>
<span class="n">certainly</span> <span class="n">a</span> <span class="n">loop</span> <span class="k">in</span> <span class="n">the</span> <span class="n">type</span><span class="bp">-</span><span class="kd">class</span> <span class="n">inference.</span> <span class="n">Find</span> <span class="n">which</span> <span class="kd">instance</span> <span class="n">causes</span> <span class="n">the</span> <span class="n">type</span><span class="bp">-</span><span class="kd">class</span> <span class="n">inference</span> <span class="n">to</span>
<span class="n">go</span> <span class="n">astray</span><span class="o">,</span> <span class="n">and</span> <span class="n">fix</span> <span class="n">that</span> <span class="kd">instance</span><span class="bp">.</span> <span class="bp">-/</span>
<span class="c1">-- algebra/module/pi.lean</span>
<span class="k">#check</span> <span class="bp">@</span><span class="n">pi.has_scalar'</span> <span class="c">/-</span><span class="cm"> type-class inference timed out</span>
<span class="cm">State:</span>
<span class="cm">I : Type u,</span>
<span class="cm">f : I → Type v,</span>
<span class="cm">g : I → Type u_1</span>
<span class="cm">⊢ has_scalar (Π (i : I), f i) (Π (i : I), g i) -/</span>
</code></pre></div>



<a name="253009471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/253009471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#253009471">(Sep 12 2021 at 20:19)</a>:</h4>
<p>Running <code>./scripts/mk_all.sh</code> creates a file <code>src/all.lean</code> iirc</p>



<a name="253009500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/distrib_mul_action_with_zero/near/253009500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/distrib_mul_action_with_zero.html#253009500">(Sep 12 2021 at 20:19)</a>:</h4>
<p>Then you should be able to import the whole of mathlib using import all</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>