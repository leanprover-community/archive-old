---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/update.20mathlib.20in.20project.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html">update mathlib in project</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="268293481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268293481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268293481">(Jan 17 2022 at 16:49)</a>:</h4>
<p>I have a project using mathlib, but it is not up-to-date. How do I update it?</p>



<a name="268293637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268293637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268293637">(Jan 17 2022 at 16:51)</a>:</h4>
<p>You can use <code>leanproject up</code> to update the version of mathlib you're using to the latest version, and download the new mathlib binaries. Then you can build it with <code>leanproject build</code>, but you manually have to fix all the errors that now occur.</p>



<a name="268293837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268293837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268293837">(Jan 17 2022 at 16:52)</a>:</h4>
<p>OK. Thanks.</p>



<a name="268296253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268296253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268296253">(Jan 17 2022 at 17:16)</a>:</h4>
<p>Hmm... the version that it updated to seems to be about 10 days older than master. Is this normal?</p>



<a name="268296331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268296331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268296331">(Jan 17 2022 at 17:17)</a>:</h4>
<p>Did you fetch master before?</p>



<a name="268296389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268296389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268296389">(Jan 17 2022 at 17:18)</a>:</h4>
<p>Actually, I'm not sure that's related <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="268297073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268297073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268297073">(Jan 17 2022 at 17:26)</a>:</h4>
<p>This is the first time I am updating.</p>



<a name="268297314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268297314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268297314">(Jan 17 2022 at 17:29)</a>:</h4>
<p>No, I meant fetch the branch <code>master</code>, because I suspect that's where leanproject gets its new mathlib version from.</p>



<a name="268297521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268297521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268297521">(Jan 17 2022 at 17:31)</a>:</h4>
<p>This is what it did:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">f684721dbec28322690f799b214b545b298d22ba</span>
<span class="bp">&gt;</span> <span class="n">git</span> <span class="n">checkout</span> <span class="c1">--detach f684721dbec28322690f799b214b545b298d22ba    # in directory _target/deps/mathlib</span>
<span class="n">HEAD</span> <span class="n">is</span> <span class="n">now</span> <span class="n">at</span> <span class="n">f684721db</span> <span class="n">chore</span><span class="o">(</span><span class="n">data</span><span class="bp">/</span><span class="n">nat</span><span class="bp">/</span><span class="n">prime</span><span class="o">):</span> <span class="bp">`</span><span class="n">fact</span> <span class="o">(</span><span class="mi">2</span><span class="bp">.</span><span class="n">prime</span><span class="o">)</span><span class="bp">`</span> <span class="o">(</span><span class="bp">#</span><span class="mi">10441</span><span class="o">)</span>
</code></pre></div>



<a name="268297624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268297624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268297624">(Jan 17 2022 at 17:32)</a>:</h4>
<p>How does it decide which commit to upgrade to?</p>



<a name="268302388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268302388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268302388">(Jan 17 2022 at 18:26)</a>:</h4>
<p>I think the first line of output printed after running <code>leanproject up</code> is wrong/misleading.<br>
At least, I used <code>leanproject up</code> today, the first line of output was </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="mi">48</span><span class="n">fd9f2589e1bac31896a82d5989df892902179f</span>
</code></pre></div>
<p>But then it fetched the remote version and later in the output it said</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="mi">391</span><span class="n">bd215c6b4807ea216e337a3b2737455605db0</span>
</code></pre></div>
<p>It ended up in the latter commit <code>391bd215</code>.<br>
So you might have the newest version of mathlib after all. You could check using <code>cd _target/deps/mathlib/ &amp;&amp; git branch</code></p>



<a name="268312321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268312321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268312321">(Jan 17 2022 at 20:23)</a>:</h4>
<p>Nope:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">bernd</span><span class="bp">@</span><span class="n">Bernds</span><span class="bp">-</span><span class="n">MBP</span><span class="o">:</span><span class="bp">~/</span><span class="n">Repositories</span><span class="bp">/</span><span class="n">convergence</span><span class="bp">/</span><span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">$</span> <span class="n">git</span> <span class="n">branch</span>
<span class="bp">*</span> <span class="o">(</span><span class="n">HEAD</span> <span class="n">detached</span> <span class="n">at</span> <span class="n">dd1242d2a</span><span class="o">)</span>
  <span class="n">master</span>
</code></pre></div>



<a name="268312596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268312596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268312596">(Jan 17 2022 at 20:26)</a>:</h4>
<p>Hmm... since it's using <code>git</code>, I might as well just switch it to master.</p>



<a name="268324958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268324958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268324958">(Jan 17 2022 at 23:27)</a>:</h4>
<p>Leanproject will also handle getting the oleans. You'll have to make sure to do that too</p>



<a name="268466407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268466407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268466407">(Jan 18 2022 at 22:39)</a>:</h4>
<p>I managed to get it upgraded. Here's what I did:</p>
<ul>
<li>Copied <a href="https://github.com/leanprover-community/tutorials/blob/master/leanpkg.toml">https://github.com/leanprover-community/tutorials/blob/master/leanpkg.toml</a> into my project.</li>
<li>Ran <code>leanpkg upgrade</code>.</li>
<li>Went to the <code>_target/deps/mathlib</code> and ran <code>GIT_HISTORY_DEPTH=1 sh scripts/fetch_olean_cache.sh</code>.</li>
</ul>



<a name="268467845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268467845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268467845">(Jan 18 2022 at 22:54)</a>:</h4>
<p>leanproject is the tool we use to automate these steps, I wouldn't really recommend doing this by hand unless you really have a reason to.<br>
Have you seen <a href="https://leanprover-community.github.io/leanproject.html">https://leanprover-community.github.io/leanproject.html</a> ?</p>



<a name="268468031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268468031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268468031">(Jan 18 2022 at 22:56)</a>:</h4>
<p>You certainly need a toml file for lean to know what your project and its dependencies are, but <code>leanpkg</code> and the last step should be replaced by using <code>leanproject</code></p>



<a name="268469341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268469341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268469341">(Jan 18 2022 at 23:06)</a>:</h4>
<p>I did have leanproject before, but that python dependency caused me issues.</p>



<a name="268471336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268471336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268471336">(Jan 18 2022 at 23:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="416322">Bernd Losert</span> <a href="#narrow/stream/113488-general/topic/update.20mathlib.20in.20project/near/268469341">said</a>:</p>
<blockquote>
<p>I did have leanproject before, but that python dependency caused me issues.</p>
</blockquote>
<p>What kind of issues? I've ran into Python issues myself before</p>



<a name="268526718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268526718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268526718">(Jan 19 2022 at 11:41)</a>:</h4>
<p>I remember there were problems with the python version, since this machine has at least one python version installed allready. I did not want to deal with it and I realized <code>leanpkg</code> was enough to do what I needed, so I never bothered to fix it.</p>



<a name="268529066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268529066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268529066">(Jan 19 2022 at 12:04)</a>:</h4>
<p>Alright, just what I suspected.<br>
You can try installing miniconda, which is a Python environment manager.</p>
<p>Btw, installing miniconda could be recommended in the tutorial page if the user already has Python 2 installed and it is the default Python for system calls. What do you guys think?</p>



<a name="268529220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268529220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268529220">(Jan 19 2022 at 12:06)</a>:</h4>
<p><span class="user-mention" data-user-id="416322">@Bernd Losert</span> what does <code>$ python --version</code> say?</p>



<a name="268530903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268530903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268530903">(Jan 19 2022 at 12:25)</a>:</h4>
<p>It says <code>Python 2.7.18</code>.</p>



<a name="268534141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268534141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268534141">(Jan 19 2022 at 12:54)</a>:</h4>
<p>You're on macOS it seems? Just <code>brew install mathlibtools</code> should be all you need</p>



<a name="268535040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268535040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268535040">(Jan 19 2022 at 13:01)</a>:</h4>
<p>it's so annoying that apple still has python2 things :/</p>



<a name="268540064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update%20mathlib%20in%20project/near/268540064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update.20mathlib.20in.20project.html#268540064">(Jan 19 2022 at 13:41)</a>:</h4>
<p>Exposing system python on all OSes was a mistake. When Lean gets super popular and OSes start using it to ship verified portions of themselves make sure we don't let them put it on <code>PATH</code> :P</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>