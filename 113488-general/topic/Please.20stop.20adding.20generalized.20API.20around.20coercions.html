---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html">Please stop adding generalized API around coercions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="310898388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310898388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310898388">(Nov 18 2022 at 18:48)</a>:</h4>
<p>I've only just noticed <a href="https://github.com/leanprover-community/mathlib/pull/17048">#17048</a>, which adds a lot of generalized infrastructure around the <code>coe</code> function.  Problem is, we no longer have a <code>coe</code> function in Lean 4.  So porting this is far from straightforward.</p>



<a name="310899277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310899277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310899277">(Nov 18 2022 at 18:52)</a>:</h4>
<p>It is not completely clear to me what the goal of <a href="https://github.com/leanprover-community/mathlib/pull/17048">#17048</a> is (or what concrete problems it solves).  So I'm not really sure what the best solution is here.</p>



<a name="310899417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310899417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310899417">(Nov 18 2022 at 18:53)</a>:</h4>
<p>Either way, please hold off on adding lemmas about <code>coe</code> for now!</p>



<a name="310899441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310899441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310899441">(Nov 18 2022 at 18:53)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="238446">@Anne Baanen</span></p>



<a name="310926565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310926565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310926565">(Nov 18 2022 at 21:42)</a>:</h4>
<p>Sorry if this has been answered before. Is there somewhere an explanation of the changes to <code>coe</code> and casting in Lean4? I can’t find anything in <a href="https://leanprover.github.io/lean4/doc/lean3changes.html">https://leanprover.github.io/lean4/doc/lean3changes.html</a></p>



<a name="310933634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310933634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310933634">(Nov 18 2022 at 22:28)</a>:</h4>
<p>A coercion is now syntactically equal to what it unravels to.</p>



<a name="310952052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310952052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310952052">(Nov 19 2022 at 01:19)</a>:</h4>
<p>So basically, no more up arrows?</p>



<a name="310952885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310952885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310952885">(Nov 19 2022 at 01:30)</a>:</h4>
<p>well no, the up arrows are still there in both input and output, they just don't represent applications of the <code>coe</code> function anymore</p>



<a name="310953678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310953678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310953678">(Nov 19 2022 at 01:41)</a>:</h4>
<p>Are <code>has_coe</code> instances now defined with a regular function definition marked with the attribute <code>@[coe]</code>?</p>



<a name="310955513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310955513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310955513">(Nov 19 2022 at 02:10)</a>:</h4>
<p>No coercion instances are still defined with <code>instance : Coe A B where coe := myCast</code>.  You need to say <code>@[coe] def myCast := ...</code> so that you get 1) the uparrow delaborator, and 2) norm_cast support.</p>



<a name="310955537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/310955537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#310955537">(Nov 19 2022 at 02:11)</a>:</h4>
<p>The reason <code>@[coe]</code> doesn't automatically create the instance is because you need to choose between Coe/CoeTail/CoeHead/etc.</p>



<a name="311047736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311047736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311047736">(Nov 19 2022 at 17:18)</a>:</h4>
<p>It's not my favorite idea, but do we need to consider reverting <a href="https://github.com/leanprover-community/mathlib/pull/17048">#17048</a>? <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span></p>



<a name="311050364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311050364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311050364">(Nov 19 2022 at 17:41)</a>:</h4>
<p>There will be plenty of problems with coe whether or not we revert this recent PR, and we're going to have to learn how to deal with them anyway, so I don't immediately see an argument for reverting it. The same argument could be made for eg Damiano's recent addition of a new tactic in lean 3; that also will be hard to port because all tactics need energy to port. The problem is not really <a href="https://github.com/leanprover-community/mathlib/pull/17048">#17048</a>, the problem is that mathlib3 is still growing faster than mathlib4 so right now every day  the job of porting mathlib gets harder. Gabriel's observation is just that some days the amount by which it gets harder is larger than other days.</p>



<a name="311054239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311054239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311054239">(Nov 19 2022 at 18:20)</a>:</h4>
<p>Kevin, that is very far from my interpretation of Gabriel's comment (although I could be wrong!). To me, it seems that Gabriel is saying: because <code>coe</code> (the function) doesn't exist in Lean 4, there is going to be massive headache porting anything related to Anne's new coe hom classes, and in fact, there likely won't be <em>any</em> analogue of these in Lean 4. </p>
<p>From that point of view, it seems to make sense to me that we could simplify porting by undoing this change now (especially before the revert commit would rot horribly, if it hasn't already), instead of manually untangling this every time we encounter a coe hom class situation.</p>



<a name="311054667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311054667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311054667">(Nov 19 2022 at 18:25)</a>:</h4>
<p>I mean, I understand that coercions in general are a lot different and will cause some overhead (I did just port <code>data.{nat, int}.cast.defs</code> so I got some familiarity with it), but direct uses of <code>coe</code> the function (as opposed to some application of a specific coercion) are much stickier.</p>



<a name="311054751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311054751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311054751">(Nov 19 2022 at 18:26)</a>:</h4>
<p>Kevin, I think you’re being a bit too pessimistic about the port process. I think the relative growing speeds of mathlib3 and mathlib4 will naturally reverse as it gets more and more painful to make PRs to mathlib3 because of the synchronization requirements. Basically my hope is that at some point it will require more energy to do the work twice than to just port what’s missing and do everything in Lean4.</p>



<a name="311055091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311055091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311055091">(Nov 19 2022 at 18:29)</a>:</h4>
<p>Of course we will never have enough people helping with the ports, but I’m not super bothered by mathlib3 still moving faster</p>



<a name="311067062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311067062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311067062">(Nov 19 2022 at 20:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> We know how to port tactics, it's merely laborious. And if we don't want to or manage to port them, we can always prove things manually as a plan B.</p>



<a name="311067289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311067289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311067289">(Nov 19 2022 at 20:52)</a>:</h4>
<p>With library design changes like this, figuring out how to make it work in Lean 4 is roughly as much work as it took Anne to figure out the Lean 3 design.  And we can't fall back to doing things manually in a couple of places because the PR in question touches dozen of type classes, changes simp lemmas etc.  (The only fall back would be to revert.)</p>



<a name="311067435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311067435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311067435">(Nov 19 2022 at 20:54)</a>:</h4>
<p>Ideally we wouldn't have spent effort on that PR in the first place, and instead looked into a better Lean 4 solution.</p>



<a name="311067760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311067760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311067760">(Nov 19 2022 at 20:58)</a>:</h4>
<p>It already took plenty of time to figure out how to do Nat.cast/numerals in Lean 4.  I'm not excited about adding roadblocks to mathlib3 right at the point where people are motivated and start to port files.  And Nat.cast is right on the critical path of almost everything.</p>



<a name="311068769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311068769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311068769">(Nov 19 2022 at 21:11)</a>:</h4>
<p>Maybe we should have marked data.nat.cast etc. as "frozen" months ago.</p>



<a name="311069043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311069043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311069043">(Nov 19 2022 at 21:15)</a>:</h4>
<p>I'm not sure if we need to revert the PR, but we'll certainly need to rewrite the new type classes.</p>



<a name="311069200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311069200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311069200">(Nov 19 2022 at 21:17)</a>:</h4>
<p>(That's why I pinged <span class="user-mention" data-user-id="238446">@Anne Baanen</span> to hear more about the motivation behind the PR so that we can port this right.)</p>



<a name="311070345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311070345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311070345">(Nov 19 2022 at 21:31)</a>:</h4>
<p>I think the underlying motivation for Anne's change was to eliminate and generalize <code>algebra_map</code> in favor of coe (unifying it with nat.cast); down the line this could get rid of <code>matrix.scalar</code> and <code>polynomial.C</code> if we wanted too. Of course, the whole idea hinges on making <code>coe</code> the simp-normal form, which doesn't work if Lean4 unfolds it back to its implementation. Maybe Anne had a better picture of how things might work in Lean 4 though.</p>



<a name="311070423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311070423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311070423">(Nov 19 2022 at 21:32)</a>:</h4>
<p>My hunch is that eventually in Lean4 we'll actually want to go back to the unbundled morphism design if the new simplifier permits it; and then we won't need the coe typeclasses at all, which are really just special cases of it.</p>



<a name="311070433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311070433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311070433">(Nov 19 2022 at 21:33)</a>:</h4>
<p>But that's not remotely explorable until the port is over</p>



<a name="311071637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311071637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311071637">(Nov 19 2022 at 21:51)</a>:</h4>
<p>I think we should consider reverting this one. It's a shame to discard Anne's work, but I think we all know Anne's work is great, and Anne knows we know that, and this is just a unfortunate situation arising in the porting process.</p>



<a name="311071783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311071783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311071783">(Nov 19 2022 at 21:53)</a>:</h4>
<p>Relatedly, I wonder if we should just adopt a "no new tactics PRs" for mathlib 3. (Of course bugfixes and backports would be welcome.)</p>



<a name="311074352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311074352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311074352">(Nov 19 2022 at 22:27)</a>:</h4>
<p>I think positivity and norm_num extensions are probably ok as porting one should be much like porting the rest, but brand new tactics probably not so much.</p>



<a name="311077059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311077059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311077059">(Nov 19 2022 at 23:00)</a>:</h4>
<p>New tactics are fine. We are definitely porting tactics faster than they are written, especially nontrivial ones</p>



<a name="311077256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311077256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311077256">(Nov 19 2022 at 23:02)</a>:</h4>
<p>The <a href="https://github.com/leanprover-community/mathlib4/issues/430">tactic list</a> has seen some substantial reduction, I'm hopeful we will have most of the tactics done by the end of the year</p>



<a name="311077294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311077294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311077294">(Nov 19 2022 at 23:03)</a>:</h4>
<p>besides, I don't see any reason to say no to making lean 4 better</p>



<a name="311079279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311079279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311079279">(Nov 19 2022 at 23:31)</a>:</h4>
<p>I think in the case of <a href="https://github.com/leanprover-community/mathlib/pull/17048">#17048</a>, the Lean 4 solution is to declare coercions from bundled operators. Then there will syntactically be a <code>whatever_hom.to_fun</code> available.</p>



<a name="311079354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311079354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311079354">(Nov 19 2022 at 23:32)</a>:</h4>
<p>And then if an instance <code>something_hom_class (whatever_hom ...) ...</code> exists, Anne's general lemmas apply.</p>



<a name="311080798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311080798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311080798">(Nov 19 2022 at 23:56)</a>:</h4>
<p>My thought with "no new tactics" was more along the lines of telling people who want to write new tactics to just write them in Lean 4 to begin with...</p>



<a name="311088211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311088211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311088211">(Nov 20 2022 at 01:55)</a>:</h4>
<p>Yaël, I couldn't quite put that together in my head. Can you elaborate a bit, maybe with a simple example?</p>



<a name="311251165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311251165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311251165">(Nov 21 2022 at 10:12)</a>:</h4>
<p>First of all, feel free to revert <a href="https://github.com/leanprover-community/mathlib/pull/17048">#17048</a> while we figure out how to deal with the porting situation. Nothing major should depend on this yet.</p>



<a name="311256421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311256421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311256421">(Nov 21 2022 at 10:45)</a>:</h4>
<p>Subclassing <code>has_lift_t</code> in this way immediately allows us to solve the concrete problem that we have a huge multitude of lemmas like <a href="https://leanprover-community.github.io/mathlib_docs/find/nnrat.coe_sum">docs#nnrat.coe_sum</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/nnreal.coe_sum">docs#nnreal.coe_sum</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/submodule.coe_sum">docs#submodule.coe_sum</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/add_submonoid.coe_finset_sum">docs#add_submonoid.coe_finset_sum</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.cast_sum">docs#nat.cast_sum</a>. These all have the same mathematical content but are redundantly stated and proved on an ad-hoc basis, so they are unavailable half of the time that you need them, so there is no <a href="https://leanprover-community.github.io/mathlib_docs/find/subring.coe_sum">docs#subring.coe_sum</a>.</p>
<p>At the same time, we've figured out thanks to the <a href="https://leanprover-community.github.io/mathlib_docs/find/algebra">docs#algebra</a> class that the right way to treat many inclusions of rings and fields in a uniform way is to assume the existence of a canonical homomorphism (algebra_map in this case). There are quite a few places in group theory where the same strategy should apply.</p>
<p>Finally, there are types with such a canonical homomorphism that is defeq to both <code>coe</code> and <code>algebra_map</code> (if it exists) but spelled differently: <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.C">docs#polynomial.C</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/adjoin_root.of">docs#adjoin_root.of</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/subring.subtype">docs#subring.subtype</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.cast_ring_hom">docs#nat.cast_ring_hom</a>. etc. Apart from yet again more duplication and inconsistencies in all these implementations, it's terribly annoying to have <code>coe</code> in the goal and a simp lemma involving <code>polynomial.C</code> or vice versa. Arguably <code>algebra_map</code> itself also counts as a weird spelling of this canonical homomorphism.</p>
<p>As I said, subclassing <code>has_lift_t</code> in this way immediately allows us to solve the first problem, which means <code>coe</code> is now a viable candidate to serve as the canonical map that we need for the other two points. On the other hand, those more abstract goals can also be achieved without <code>coe</code>.</p>



<a name="311261011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311261011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311261011">(Nov 21 2022 at 11:15)</a>:</h4>
<p>About unbundled morphisms: these will be much more useful in Lean 4 but still come with limitations. Toy example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib</span>

<span class="kd">class</span> <span class="n">IsZeroHom</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">[</span><span class="n">Zero</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">Zero</span> <span class="n">B</span><span class="o">]</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">map_zero</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="kn">open</span> <span class="n">IsZeroHom</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">AddGroupWithOne</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">IsZeroHom</span> <span class="o">(</span><span class="n">Int.cast</span> <span class="o">:</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">map_zero</span> <span class="o">:=</span> <span class="n">Int.cast_zero</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">Zero</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">IsZeroHom</span> <span class="o">(</span><span class="n">id</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">A</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">map_zero</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">Zero</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">Zero</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">Zero</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span>
    <span class="o">[</span><span class="n">IsZeroHom</span> <span class="n">f</span><span class="o">]</span> <span class="o">[</span><span class="n">IsZeroHom</span> <span class="n">g</span><span class="o">]</span> <span class="o">:</span> <span class="n">IsZeroHom</span> <span class="o">(</span><span class="n">f</span> <span class="bp">∘</span> <span class="n">g</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">map_zero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">Function.comp_apply</span><span class="o">,</span> <span class="n">map_zero</span><span class="o">]</span>

<span class="bp">#</span><span class="n">synth</span> <span class="n">IsZeroHom</span> <span class="o">(</span><span class="n">id</span> <span class="o">:</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℤ</span><span class="o">)</span> <span class="c1">-- succeeds</span>

<span class="kd">set_option</span> <span class="n">trace.Meta.Tactic.simp</span> <span class="n">true</span> <span class="k">in</span>
<span class="kd">example</span> <span class="o">[</span><span class="n">AddGroupWithOne</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">IsZeroHom.map_zero</span><span class="o">]</span> <span class="c1">-- succeeds, but tries to unify `?f 0` with every subterm</span>
<span class="kd">example</span> <span class="o">[</span><span class="n">AddGroupWithOne</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
  <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">IsZeroHom.map_zero</span><span class="o">]</span> <span class="c1">-- failed, pattern is a metavariable</span>
</code></pre></div>
<p>Since <code>Function.id</code> and <code>Function.comp</code> are no longer reducible, there is no more looping on trying to synthesise <code>IsZeroHom (id ∘ id ∘ id ∘ id ∘ ...)</code> and the simplifier now accepts lemmas with a metavariable as head (<code>rw</code> still doesn't though).</p>
<p>However, we still have two objections to unbundled maps that remain unchanged from Lean 3:</p>
<ul>
<li>Since <code>?f 0</code> could unify potentially with any subterm of the goal, the simplifier has to scan through everything, which I expect will have the same performance impacts as it did in Lean 3. (At least it doesn't seem to find a <code>IsZeroHom</code> instance on each subterm.)</li>
<li>The collection of morphisms is still an interesting object in its own right, so we still want to have some level of bundled maps to e.g. put a group structure on the automorphisms of a vector space.</li>
</ul>



<a name="311263726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311263726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311263726">(Nov 21 2022 at 11:32)</a>:</h4>
<p>Honestly, I don't know what the right plan is at the moment: it would be easy enough to redo the classes in a way that doesn't mention <code>coe</code>. Due to various other projects I have to finish at the moment, I don't particularly feel motivated to do so, especially without some reassurance that there are no further secret breakages in Lean 4.</p>



<a name="311266318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311266318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311266318">(Nov 21 2022 at 11:48)</a>:</h4>
<p>I don't want to go off on a whole rant but each of my encounters with the Lean 4 port has been frustrating, despite all the advantages I know Lean 4 is supposed to bring. :(</p>



<a name="311438631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311438631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311438631">(Nov 21 2022 at 18:09)</a>:</h4>
<p>I totally agree that porting files is frustrating, precisely because we don't notice all the stuff which works and only have to bang our head against the wall dealing with the stuff which doesn't work :-)</p>



<a name="311443394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311443394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311443394">(Nov 21 2022 at 18:35)</a>:</h4>
<p>I'm sorry this is frustrating you.  I should have raised this issue earlier before you had invested so much time into it, but the PR flew completely under my radar.</p>



<a name="311443626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311443626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311443626">(Nov 21 2022 at 18:36)</a>:</h4>
<blockquote>
<p>it's terribly annoying to have coe in the goal and a simp lemma involving polynomial.C or vice versa.</p>
</blockquote>
<p>This is exactly what moving to Lean 4 would have fixed automatically: the elaborator now produces polynomial.C so there's no annoying mismatch.</p>



<a name="311449768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311449768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311449768">(Nov 21 2022 at 19:13)</a>:</h4>
<p>What it doesn't solve is having to repeat <code>coe_add</code>/<code>coe_sum</code> lemmas for types where the canonical map can't always be bundled</p>



<a name="311450502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311450502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311450502">(Nov 21 2022 at 19:16)</a>:</h4>
<p>I would guess those are relatively rare, right? What situations do you have in mind where this map can't be bundled?</p>



<a name="311451228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311451228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311451228">(Nov 21 2022 at 19:21)</a>:</h4>
<p>... whenever different bundlings hold in different generalities, which is a ubiquitous situation</p>



<a name="311451844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311451844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311451844">(Nov 21 2022 at 19:25)</a>:</h4>
<p>The one that  comes to mind immediately is <a href="https://leanprover-community.github.io/mathlib_docs/find/matrix.scalar">docs#matrix.scalar</a>, but <code>nat.cast</code> is another good example since <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.cast_mul">docs#nat.cast_mul</a> doesn't hold as often as <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.cast_add">docs#nat.cast_add</a>.</p>



<a name="311452079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311452079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311452079">(Nov 21 2022 at 19:27)</a>:</h4>
<p>But certainly we shouldn't attempt to solve this problem mid-port</p>



<a name="311492515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311492515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311492515">(Nov 21 2022 at 23:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311443626">said</a>:</p>
<blockquote>
<blockquote>
<p>it's terribly annoying to have coe in the goal and a simp lemma involving polynomial.C or vice versa.</p>
</blockquote>
<p>This is exactly what moving to Lean 4 would have fixed automatically: the elaborator now produces polynomial.C so there's no annoying mismatch.</p>
</blockquote>
<p>I mean but I think the issue is that now we need to have <code>simp</code> lemmas for all these normal forms of the coercions as opposed to just having a "coercion" simp lemma, which removes a hell of a lot of boilerplate</p>



<a name="311492606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311492606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311492606">(Nov 21 2022 at 23:24)</a>:</h4>
<p>plus I don't think humans want to see goals with stuff like <code>adjoin_root.of (nat.cast k) * r</code>, because to them that is just <code>k * r</code></p>



<a name="311494089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311494089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311494089">(Nov 21 2022 at 23:38)</a>:</h4>
<p>Note that <code>↑</code> still appears in the tactic state, but that doesn't address the boilerplate issue.</p>



<a name="311494724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311494724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311494724">(Nov 21 2022 at 23:45)</a>:</h4>
<p>Yeah, having a single <code>coe</code> function had the appeal that we could write lemmas about it.</p>



<a name="311495036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495036">(Nov 21 2022 at 23:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197836">Jireh Loreaux</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311494089">said</a>:</p>
<blockquote>
<p>Note that <code>↑</code> still appears in the tactic state, but that doesn't address the boilerplate issue.</p>
</blockquote>
<p>sometimes not; I've not seen it work a single time with <code>equiv.toFun</code>, for example</p>



<a name="311495109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495109">(Nov 21 2022 at 23:49)</a>:</h4>
<p>did the function get tagged as <code>@[coe]</code>?</p>



<a name="311495186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495186">(Nov 21 2022 at 23:50)</a>:</h4>
<p>Yaël, can we just write lemmas involving the <code>coe</code> attribute though? (I have no idea, just flailing in the dark)</p>



<a name="311495299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495299">(Nov 21 2022 at 23:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311495109">said</a>:</p>
<blockquote>
<p>did the function get tagged as <code>@[coe]</code>?</p>
</blockquote>
<p><a href="/user_uploads/3121/c2l6rpIgv4dKWcCPKWUUfbsX/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/c2l6rpIgv4dKWcCPKWUUfbsX/image.png" title="image.png"><img src="/user_uploads/3121/c2l6rpIgv4dKWcCPKWUUfbsX/image.png"></a></div><p>I don't think so, this seems the only close-to-related thing in equiv's files. should we have a line <code>attribute [coe] Equiv.toFun</code>?</p>



<a name="311495369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495369">(Nov 21 2022 at 23:52)</a>:</h4>
<p>yes</p>



<a name="311495390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495390">(Nov 21 2022 at 23:52)</a>:</h4>
<p>we'll have a linter for this at some point</p>



<a name="311495416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495416">(Nov 21 2022 at 23:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197836">Jireh Loreaux</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311495186">said</a>:</p>
<blockquote>
<p>Yaël, can we just write lemmas involving the <code>coe</code> attribute though? (I have no idea, just flailing in the dark)</p>
</blockquote>
<p>It doesn't even make sense to state that some function is tagged with <code>coe</code> though, right?</p>



<a name="311495421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495421">(Nov 21 2022 at 23:52)</a>:</h4>
<p>I wonder if this is what was causing the issues with <code>EmbeddingLike</code> and also <code>map_one</code></p>



<a name="311495455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495455">(Nov 21 2022 at 23:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311495416">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="197836">Jireh Loreaux</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311495186">said</a>:</p>
<blockquote>
<p>Yaël, can we just write lemmas involving the <code>coe</code> attribute though? (I have no idea, just flailing in the dark)</p>
</blockquote>
<p>It doesn't even make sense to state that some function is tagged with <code>coe</code> though, right?</p>
</blockquote>
<p>it does</p>



<a name="311495486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495486">(Nov 21 2022 at 23:53)</a>:</h4>
<p>How can I state that a function is tagged with <code>coe</code>?</p>



<a name="311495549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495549">(Nov 21 2022 at 23:54)</a>:</h4>
<p>I mean, you can have a metaprogram look for the attribute</p>



<a name="311495559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495559">(Nov 21 2022 at 23:54)</a>:</h4>
<p>I'm not sure what you are after here</p>



<a name="311495582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311495582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311495582">(Nov 21 2022 at 23:54)</a>:</h4>
<p>why does the fact that a function is a coe have anything to do with the lemmas that are provable for it?</p>



<a name="311508319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311508319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311508319">(Nov 22 2022 at 02:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/311495369">said</a>:</p>
<blockquote>
<p>yes</p>
</blockquote>
<p><a href="/user_uploads/3121/rcmhByBx397kD97imfYbrKWX/image.png">image.png</a>  </p>
<div class="message_inline_image"><a href="/user_uploads/3121/rcmhByBx397kD97imfYbrKWX/image.png" title="image.png"><img src="/user_uploads/3121/rcmhByBx397kD97imfYbrKWX/image.png"></a></div><p>this cannot be right</p>



<a name="311508434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311508434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311508434">(Nov 22 2022 at 02:32)</a>:</h4>
<p>that appears to be a bug in the coe delaborator</p>



<a name="311508536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311508536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311508536">(Nov 22 2022 at 02:34)</a>:</h4>
<p>it's actually a somewhat challenging issue because the <code>@[coe]</code> attribute doesn't know whether <code>toFun : Equiv A B -&gt; A -&gt; B</code> is supposed to be a coe from <code>A</code> to <code>B</code> or <code>Equiv A B</code> to <code>A -&gt; B</code></p>



<a name="311508545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311508545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311508545">(Nov 22 2022 at 02:34)</a>:</h4>
<p>cc: <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span></p>



<a name="311508579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311508579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311508579">(Nov 22 2022 at 02:35)</a>:</h4>
<p>I think it is safe to say that we should look at the first explicit argument of the function as the source and the rest as the destination</p>



<a name="311513285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311513285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311513285">(Nov 22 2022 at 03:50)</a>:</h4>
<p>Yeah, the attribute doesn't support function corrections yet.</p>



<a name="311513313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311513313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311513313">(Nov 22 2022 at 03:51)</a>:</h4>
<p>E.g. the FunLike.coe function is registered manually.</p>



<a name="311513380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311513380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311513380">(Nov 22 2022 at 03:52)</a>:</h4>
<p>The explicit argument heuristic sounds good to me.  This covers everything we've got. And in the worst case you can always fall back to registering it manually.</p>



<a name="311608966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311608966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311608966">(Nov 22 2022 at 14:48)</a>:</h4>
<p>I would personally like coercions to functions (and sorts?) to not appear in the tactic state at all. In all non-artificial situations there is only one way to treat an object as a function (or a sort), and from the context 99% of the time it is clear that you are treating an object as a function, since you're e.g. applying it to an argument. (An exception is a lemma like <code>f = g ↔ ⇑f = ⇑g</code>.)</p>



<a name="311642412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311642412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311642412">(Nov 22 2022 at 15:17)</a>:</h4>
<p>But if they do not appear in the tactic state, they are not inspectable, so you can't jump to where the coercion is defined, etc</p>



<a name="311645076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311645076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311645076">(Nov 22 2022 at 15:28)</a>:</h4>
<p>Maybe I'm wishful thinking, but for me the  ideal behavior would be that clicking on the term with the hidden coercion does show the coercion application in the pop-up (if you want to get to the non-coercion application you click the corresponding argument of the coercion to open a second pop-up).</p>



<a name="311648917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311648917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311648917">(Nov 22 2022 at 15:45)</a>:</h4>
<p>That can be (and already is?) a <code>pp</code> option. Of course typing <code>set_option ...</code> in every file you inspect is not a solution, so it would be nice to make <code>pp</code> options persistently configurable from the VScode extension.</p>



<a name="311651365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311651365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311651365">(Nov 22 2022 at 15:56)</a>:</h4>
<p>I think there is an option for removing all coercion arrows. But the normal coercion arrows (not to functions or sorts) are useful (since they often convey information not contained in the rest of the expression), and I want to keep those.</p>



<a name="311651509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311651509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311651509">(Nov 22 2022 at 15:57)</a>:</h4>
<p>I agree that user-configurable default pp options in the extension would be useful.</p>



<a name="311651656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/311651656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#311651656">(Nov 22 2022 at 15:58)</a>:</h4>
<p>Then we should make suboptions for each type of coercion.</p>



<a name="312110373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312110373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312110373">(Nov 25 2022 at 03:19)</a>:</h4>
<p>I see that the discussion moved from "what can be used by <code>simp</code> etc" to "what a user sees in the tactic state". Do I understand correctly that we can write lemmas about <code>FunLike</code> coercions because Lean only unfolds it up to <code>FunLike.coe</code>, not to <code>Equiv.toFun</code> etc? So, we're emulating Lean 3 here.</p>



<a name="312110439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312110439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312110439">(Nov 25 2022 at 03:20)</a>:</h4>
<p>About the original issue: can we teach Lean 4 <code>simp</code> that a lemma about <code>coe</code> applies to any function tagged with <code>@[coe]</code>?</p>



<a name="312110540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312110540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312110540">(Nov 25 2022 at 03:22)</a>:</h4>
<p>This would make all those general <code>coe_add</code>/<code>coe_sum</code> lemmas useful again.</p>



<a name="312606880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312606880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Meow <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312606880">(Nov 28 2022 at 11:31)</a>:</h4>
<p>What is the best way to unfold local definitions?</p>



<a name="312606955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312606955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Meow <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312606955">(Nov 28 2022 at 11:32)</a>:</h4>
<p>I usually use simp only [] now.</p>



<a name="312633741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312633741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312633741">(Nov 28 2022 at 13:59)</a>:</h4>
<p>Yeah, I hate this stuff.</p>



<a name="312657986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Please%20stop%20adding%20generalized%20API%20around%20coercions/near/312657986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions.html#312657986">(Nov 28 2022 at 15:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/Please.20stop.20adding.20generalized.20API.20around.20coercions/near/312110439">said</a>:</p>
<blockquote>
<p>About the original issue: can we teach Lean 4 <code>simp</code> that a lemma about <code>coe</code> applies to any function tagged with <code>@[coe]</code>?</p>
</blockquote>
<p>An idea I got while away from the computer, so untested: would it be possible to use unification hints for this purpose? Not sure how they work in Lean 4, let alone in combination with tactics, but it would be nice to be able to say that <code>@Nat.cast _ _ n =?= @coe _ _ _ n</code> should unify, and have <code>simp</code>/<code>rw</code>/etc. respect that</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>