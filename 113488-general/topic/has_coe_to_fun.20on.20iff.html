---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/has_coe_to_fun.20on.20iff.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html">has_coe_to_fun on iff</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="225458828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225458828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225458828">(Feb 07 2021 at 11:14)</a>:</h4>
<p>What would the opinion be on adding:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">{</span><span class="n">P</span> <span class="n">Q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">P</span> <span class="bp">↔</span> <span class="n">Q</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">iff.mp</span><span class="o">⟩</span>
</code></pre></div>
<p>The argument would be twofold:</p>
<ul>
<li>It's consistent with how <code>equiv</code> decays to a function in the forward direction</li>
<li>It would enable dot notation for things like <code>and.comm</code>:</li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">P</span> <span class="n">Q</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">P</span> <span class="bp">∧</span> <span class="n">Q</span><span class="o">)</span>
<span class="k">#check</span> <span class="n">h.comm</span>
</code></pre></div>



<a name="225458874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225458874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225458874">(Feb 07 2021 at 11:15)</a>:</h4>
<p>(deleted)</p>



<a name="225458926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225458926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225458926">(Feb 07 2021 at 11:16)</a>:</h4>
<p>/poll Is this a good idea?</p>



<a name="225461881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225461881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225461881">(Feb 07 2021 at 12:27)</a>:</h4>
<p>For teaching that would be a <em>disaster</em>.</p>



<a name="225462303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225462303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225462303">(Feb 07 2021 at 12:38)</a>:</h4>
<p>How so? The model only changes from "an <code>iff</code> is a pair of a forward and backward implication" to "an <code>iff</code> is a forward implication with an associated backward implication". That difference doesn't seem particularly troublesome.</p>



<a name="225466441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225466441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225466441">(Feb 07 2021 at 14:32)</a>:</h4>
<p>You can use <code>and.symm</code> instead of <code>and.comm</code> if you want the version that works with dot notation</p>



<a name="225466463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225466463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225466463">(Feb 07 2021 at 14:33)</a>:</h4>
<p>Also, has_coe_to_fun doesn't enable the use of dot notation like this</p>



<a name="225466604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225466604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225466604">(Feb 07 2021 at 14:36)</a>:</h4>
<p>It does enable dot notation, the <code>#check</code> above works iff you also include the instance I start this thread with</p>



<a name="225466633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225466633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225466633">(Feb 07 2021 at 14:37)</a>:</h4>
<p><code>and.symm</code> is just an example, there are many other cases where the lack of this coercion makes us pick between a weak statement with dot notation, a strong statement without, or having to come up with two names for the same thing</p>



<a name="225469610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225469610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225469610">(Feb 07 2021 at 15:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/has_coe_to_fun.20on.20iff/near/225462303">said</a>:</p>
<blockquote>
<p>How so? The model only changes from "an <code>iff</code> is a pair of a forward and backward implication" to "an <code>iff</code> is a forward implication with an associated backward implication". That difference doesn't seem particularly troublesome.</p>
</blockquote>
<p>Students already have a lot of difficulties with the distinction between implication and equivalences. Anything that blurs this distinction would be awful.</p>



<a name="225469963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225469963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225469963">(Feb 07 2021 at 15:48)</a>:</h4>
<p>For what it's worth, I still sometimes find the use of <code>equiv</code>s as functions difficult to parse since the names are not what I intuitively expect. However, the inconsistency between <code>equiv</code> and <code>iff</code> here is a bit strange.</p>
<p><del>Lean 3 doesn't give us any way to disable instances once they've been declared, right? What about Lean 4?</del></p>



<a name="225470979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225470979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225470979">(Feb 07 2021 at 16:10)</a>:</h4>
<p>Sure it does, <code>local attribute [-instance]</code></p>



<a name="225471047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/225471047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#225471047">(Feb 07 2021 at 16:12)</a>:</h4>
<p>Except in this case we need to go in the other direction. Have a <code>def</code> and let Eric use <code>local attribute [instance]</code> when he wants to use it.</p>



<a name="283890281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283890281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283890281">(May 25 2022 at 14:30)</a>:</h4>
<p>I also have thought that the inconsistency between <code>equiv</code> and <code>iff</code> was odd. I wouldn't want mathlib to change the way it states theorems if this were a feature (so we would keep both <code>and.symm</code> and <code>and.comm</code>), but it would be nice being able to write <code>foo a h</code> rather than <code>(foo a).mp h</code>.</p>
<p>Maybe as a compromise, since for teaching you wouldn't want students to unwittingly use iffs in place of implications, we introduce a <code>mathlib</code> locale with fancy features such as this one.</p>



<a name="283908994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283908994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Violeta Hernández <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283908994">(May 25 2022 at 16:43)</a>:</h4>
<p>I like the idea because it means I don't have to write .1 everywhere</p>



<a name="283909249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283909249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283909249">(May 25 2022 at 16:45)</a>:</h4>
<p>This sounds like a terrible idea because <code>has_coe_to_fun</code> is quite fragile and our current use already breaks often enough. Further, iffs are usually quite polymorphic, so Lean will have an even harder time unifying.</p>



<a name="283909518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283909518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283909518">(May 25 2022 at 16:47)</a>:</h4>
<p>In this case, <code>has_coe_to_fun</code> shouldn't be fragile at all afaict.</p>



<a name="283909576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283909576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283909576">(May 25 2022 at 16:47)</a>:</h4>
<p>It should work just as well as writing <code>.1</code> manually.</p>



<a name="283910322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283910322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283910322">(May 25 2022 at 16:52)</a>:</h4>
<p>Yeah, that's my understanding -- when you syntactically have <code>x y</code> and <code>x</code> isn't obviously a function, then Lean will use a <code>has_coe_to_fun</code> instance for <code>x</code>.</p>



<a name="283919701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/has_coe_to_fun%20on%20iff/near/283919701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/has_coe_to_fun.20on.20iff.html#283919701">(May 25 2022 at 18:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/has_coe_to_fun.20on.20iff/near/283909249">said</a>:</p>
<blockquote>
<p>This sounds like a terrible idea because <code>has_coe_to_fun</code> is quite fragile and our current use already breaks often enough. Further, iffs are usually quite polymorphic, so Lean will have an even harder time unifying.</p>
</blockquote>
<p>If you're describing what I think you are (the various breakage to dot notation in bundled homs every time someone adds a new typeclass in the hierarchy), that's not relevant here because:</p>
<ul>
<li>Almost no one is going to state or a theorem with <code>iff.mp</code> in the statement, whether it's spelt with <code>coe_fn</code> or otherwise</li>
<li><code>iff</code> has no typeclass arguments which can end up unified incorrectly</li>
</ul>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>