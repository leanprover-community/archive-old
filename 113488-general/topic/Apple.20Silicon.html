---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Apple.20Silicon.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html">Apple Silicon</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="213646021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213646021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213646021">(Oct 17 2020 at 10:46)</a>:</h4>
<p>This might still be premature since it is another month or so until Apple will release its new Apple Silicon MacBooks using an ARM processor instead of an Intel processor.  (I think the new OS is named Big Sur.)  My question is simple:  <strong>Will Lean 3 or 4 run on Apple Silicon Macs?</strong>  From what I've read, the answer for other software seems to be complicated.  (See <a href="https://github.com/Homebrew/brew/issues/7857">here for the status of the most common homebrew formulas</a>.)  First, there is running natively vs. running in Rosetta which is something like an emulator for intel (x86_64) apps.  Honestly, I'm mostly trowing out tech jargon without knowing what it means, especially what it means for Lean.  It's even hard to know if VS Code (or Emacs) will be ready at launch time (but I think from Googling, they will be).</p>



<a name="213646111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213646111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213646111">(Oct 17 2020 at 10:49)</a>:</h4>
<p>I've had lean running in a chrooted Ubuntu environment on a 2017 Android phone and it wouldn't surprise me if that had an ARM chip in, but I'm certainly no expert here</p>



<a name="213646452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213646452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213646452">(Oct 17 2020 at 10:58)</a>:</h4>
<p>I don't see any reason why not. Lean is written in C++ and there are C++ compilers for all the major ISAs and many ISAs no one cares about</p>



<a name="213646481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213646481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213646481">(Oct 17 2020 at 10:59)</a>:</h4>
<p>If the OS layer changes that might require more work, but switching from one supported ISA to another doesn't seem like a big problem</p>



<a name="213751843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213751843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213751843">(Oct 19 2020 at 07:40)</a>:</h4>
<p>Lean 3 runs just fine on aarch64. I'm not invested in the Apple ecosystem so I don't know if "Apple silicon" is different.</p>



<a name="213774267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213774267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213774267">(Oct 19 2020 at 11:58)</a>:</h4>
<p>Ok.  I think what I'm hearing is that if I (or someone else here) gets an Apple Silicon mac (rumored to be coming out in Nov 17), then if I compile from sources it should likely compile and run natively.  And if not, it should be a relatively simple thing to support.  </p>
<p>As for the elan binaries (which I assume are platform specific and for mac are currently for x86_64), they might work (maybe under Rosetta?) but we will have to see and compare the performance.  If they don't work or there is a performance difference, then we can look into <a href="https://developer.apple.com/documentation/xcode/building_a_universal_macos_binary">building a universal mac binary</a> which supports both.</p>



<a name="213774748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213774748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213774748">(Oct 19 2020 at 12:02)</a>:</h4>
<p>I'm actually more worried about apple's signing conditions post-catalina. I don't think we have any signing setup, so I would assume that people have to go through some Gatekeeper (what a name!) workaround to be able to run lean today</p>



<a name="213774856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213774856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213774856">(Oct 19 2020 at 12:03)</a>:</h4>
<p>I don't really see a reason to ship fat binaries, they are basically two programs stapled together. The user only needs one of them</p>



<a name="213816179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213816179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213816179">(Oct 19 2020 at 17:07)</a>:</h4>
<p>you should be able to use software installed via homebrew without mucking around with signing, and homebrew plans on supporting apple silicon, so i would expect that to all work <a href="https://discourse.brew.sh/t/homebrew-and-apple-silicon/8837/2">https://discourse.brew.sh/t/homebrew-and-apple-silicon/8837/2</a></p>



<a name="213816536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/213816536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#213816536">(Oct 19 2020 at 17:10)</a>:</h4>
<p>But Lean shouldn’t be installed via home brew, right?  A new version comes out like event month.  If elan is installed (and signed) via homebrew, will the elan installed lean binaries work?</p>



<a name="215443625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/215443625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#215443625">(Nov 03 2020 at 11:57)</a>:</h4>
<p>Just a note that the new line of macs will probably be announced next week and likely the Big Sur macOS with the code signing requirement Mario mentioned above will also be released soon.  I'm mentioning because I'm considering buying a new mac (although I might wait for some reviews and discussion of what software works).  Also, if anyone upgrades to Big Sur, it is not clear that Lean will work, because it's not signed.  Is that what I'm understanding from the above discussion?</p>



<a name="215444201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/215444201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#215444201">(Nov 03 2020 at 12:03)</a>:</h4>
<p>My understanding is that the new Macs will still run unsigned executables compiled for Intel processors, but won't run unsigned software compiled for Apple Silicon processors. (See the first addendum <a href="https://lapcatsoftware.com/articles/unsigned.html">here</a>)</p>



<a name="216593003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216593003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216593003">(Nov 13 2020 at 10:32)</a>:</h4>
<p>To anyone interested in the concept Big Sur: <a href="https://sneak.berlin/20201112/your-computer-isnt-yours/">https://sneak.berlin/20201112/your-computer-isnt-yours/</a></p>



<a name="216596584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216596584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216596584">(Nov 13 2020 at 11:09)</a>:</h4>
<p>This is all very consistent with everything Apple has ever done. I don't see how one can have used MacOS in the past and pretend to care about this blogpost.</p>



<a name="216596682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216596682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216596682">(Nov 13 2020 at 11:10)</a>:</h4>
<p>Well, apparently the author himself combines both options: "Now, it’s been possible up until today to block this sort of stuff on your Mac using a program called Little Snitch (really, the only thing keeping me using macOS at this point)."</p>



<a name="216596726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216596726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216596726">(Nov 13 2020 at 11:11)</a>:</h4>
<p>Yes, this is why I'm puzzled.</p>



<a name="216596807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216596807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216596807">(Nov 13 2020 at 11:12)</a>:</h4>
<p>But the psychology of MacOS users has always been mysterious to me. I even know someone who is a genuine anti-capitalist activist and uses a Mac.</p>



<a name="216596850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216596850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216596850">(Nov 13 2020 at 11:12)</a>:</h4>
<p>I agree that it is very puzzling.</p>



<a name="216598395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216598395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216598395">(Nov 13 2020 at 11:32)</a>:</h4>
<p>Yes, it's very strange... Filippo and Patrick, I am sure you too have colleagues that absolutely refuse to install stopcovid on their phone but are very happy about their mac... (my point is not to discuss pro and cons of stopcovid, just that these two different attitudes are very strange to me)</p>



<a name="216598438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216598438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216598438">(Nov 13 2020 at 11:33)</a>:</h4>
<p>Indeed! Never thought about it.</p>



<a name="216613574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216613574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216613574">(Nov 13 2020 at 13:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/216596807">said</a>:</p>
<blockquote>
<p>But the psychology of MacOS users has always been mysterious to me.</p>
</blockquote>
<p>We're lazy people with an eye for design.</p>



<a name="216630147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216630147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216630147">(Nov 13 2020 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/216593003">said</a>:</p>
<blockquote>
<p>To anyone interested in the concept Big Sur: <a href="https://sneak.berlin/20201112/your-computer-isnt-yours/">https://sneak.berlin/20201112/your-computer-isnt-yours/</a></p>
</blockquote>
<p>Can lean run on a raspberry pi?</p>



<a name="216630432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216630432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216630432">(Nov 13 2020 at 15:54)</a>:</h4>
<p>Yes, but will it be fast enough?</p>



<a name="216630493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216630493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216630493">(Nov 13 2020 at 15:55)</a>:</h4>
<p>Maybe the new raspberry pi 4? (I don't have one, just wondering)</p>



<a name="216630554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216630554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216630554">(Nov 13 2020 at 15:55)</a>:</h4>
<p>I mean, the raspberry pi 4 is supposed to be just as fast as the old thinkpad X220 I have somewhere in my desk drawer</p>



<a name="216631169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216631169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216631169">(Nov 13 2020 at 15:59)</a>:</h4>
<p>I guess you won't even be able to install linux on the macs with the apple arm chips, right?</p>



<a name="216631322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216631322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216631322">(Nov 13 2020 at 16:00)</a>:</h4>
<p>Man, that article is depressing. I thought apple was supposed to be the "pro privacy" company. What happened?!</p>



<a name="216632842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216632842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Arthur <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216632842">(Nov 13 2020 at 16:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/216630147">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/216593003">said</a>:</p>
<blockquote>
<p>To anyone interested in the concept Big Sur: <a href="https://sneak.berlin/20201112/your-computer-isnt-yours/">https://sneak.berlin/20201112/your-computer-isnt-yours/</a></p>
</blockquote>
<p>Can lean run on a raspberry pi?</p>
</blockquote>
<p>Slowly, I tried this the other day. It's possible, but in comparison to my i7 laptop.</p>



<a name="216632978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216632978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216632978">(Nov 13 2020 at 16:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/216631322">said</a>:</p>
<blockquote>
<p>Man, that article is depressing. I thought apple was supposed to be the "pro privacy" company. What happened?!</p>
</blockquote>
<p>What? I've never seen anything from Apple that was pro-privacy</p>



<a name="216633296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216633296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216633296">(Nov 13 2020 at 16:11)</a>:</h4>
<p>Well, at least ios is supposed to be more "private" than android, no?</p>



<a name="216633362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216633362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216633362">(Nov 13 2020 at 16:11)</a>:</h4>
<p>Apple is supposedly anonymizing all the tracking data they collect on you, unlike google</p>



<a name="216633719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216633719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216633719">(Nov 13 2020 at 16:14)</a>:</h4>
<p>But <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> , I agree, being more privacy conscious than google isn't saying too much.</p>



<a name="216633876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216633876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216633876">(Nov 13 2020 at 16:15)</a>:</h4>
<p>lol that's a funny way to spin "privacy"</p>



<a name="216640110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216640110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216640110">(Nov 13 2020 at 16:57)</a>:</h4>
<p>Let's not forget that Google's most important business model is tracking user data, so promoting "privacy" is a good way for Apple to deny resources to their competition.</p>



<a name="216687510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216687510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216687510">(Nov 13 2020 at 23:21)</a>:</h4>
<p><a href="https://news.ycombinator.com/item?id=25086845">https://news.ycombinator.com/item?id=25086845</a></p>



<a name="216691158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216691158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216691158">(Nov 14 2020 at 00:00)</a>:</h4>
<p>Incredible. I hear system76 is making pretty good laptops nowadays, I might roll the dice when my macbook dies.</p>



<a name="216691755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216691755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216691755">(Nov 14 2020 at 00:10)</a>:</h4>
<p>I have a not too fancy ThinkPad, running linux with perfect compatibility</p>



<a name="216691790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216691790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216691790">(Nov 14 2020 at 00:11)</a>:</h4>
<p>But I also hear good things about system76</p>



<a name="216692128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216692128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216692128">(Nov 14 2020 at 00:17)</a>:</h4>
<p>i recommend the huawei matebook x pro, works great with ubuntu with a standard dual boot install process, no custom anything required</p>



<a name="216692598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216692598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216692598">(Nov 14 2020 at 00:25)</a>:</h4>
<p>Is that the laptop with the pop-up webcam in the keyboard?</p>



<a name="216692771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/216692771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#216692771">(Nov 14 2020 at 00:28)</a>:</h4>
<p>I have this laptop too and yes</p>



<a name="217343464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217343464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217343464">(Nov 19 2020 at 23:10)</a>:</h4>
<p>Well, I'm now on ARM macOS. Do I win the lucky first prize to attempt to compile lean on ARM</p>



<a name="217343765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217343765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217343765">(Nov 19 2020 at 23:14)</a>:</h4>
<p>you win the prize once you paste a screen shot of either the error message you received, or a success message, into chat</p>



<a name="217343952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217343952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217343952">(Nov 19 2020 at 23:17)</a>:</h4>
<p>Hopefully the latter. (First need to install a bunch of deps.)</p>



<a name="217346960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217346960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217346960">(Nov 19 2020 at 23:56)</a>:</h4>
<p>Actually, I'd love if you try both with manually compiling natively AND using the usual <a href="https://leanprover-community.github.io/install/macos.html">MacOS install instructions</a> via Rosetta 2 (elan+vscode+leanproject).  My understanding is that you have to use either all Rosetta or all native apps in a tool chain so they play well together.  It seems to me that if you did the Rosetta 2 install then everything would play together (python, git, vs code, and lean/elan) and lean would be sufficiently fast. Now, I don't have such a Mac, so you can tell me if I am wrong on that understanding and it is possible to mix and match.</p>



<a name="217346974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217346974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217346974">(Nov 19 2020 at 23:56)</a>:</h4>
<p>If you do the native install, is vs code (or emacs) ready for native apple silicon yet?  Also if you get both a native and Rosetta install, I'd love to see the differences in times it takes to compile Mathlib.</p>



<a name="217346978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217346978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217346978">(Nov 19 2020 at 23:56)</a>:</h4>
<p>Of course, feel free to ignore all my requests, but we should think about how to handle the mac os instructions for users who are not as tech savvy as you.</p>



<a name="217347393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217347393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217347393">(Nov 20 2020 at 00:01)</a>:</h4>
<p>Also you probably know this already, but here is <a href="https://www.notion.so/Run-x86-Apps-including-homebrew-in-the-Terminal-on-Apple-Silicon-8350b43d97de4ce690f283277e958602">one way to install and run x86 apps in Rosetta 2</a>.</p>



<a name="217348388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217348388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217348388">(Nov 20 2020 at 00:16)</a>:</h4>
<p>Also, this is <a href="https://www.reddit.com/r/datascience/comments/jw5go3/hour_one_arm_mac_thoughts/">probably the most insightful post</a> I've found yet on data science tools (conda, tensorflow, etc) for Apple Silicon Macs.  Unfortunately, the follow up article with the installation instructions got deleted.  Hopefully he reposts it.  I think the main point is that most everything works fine or more than fine under Rosetta 2 and many some things are ready for native while many things are quickly becoming ready.  Obviously, this isn't about Lean, but might be useful to you.</p>



<a name="217349426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217349426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217349426">(Nov 20 2020 at 00:33)</a>:</h4>
<p>Thanks. I went (first) for the route of pain, as I tend to, so I've set up only a native-compiling homebrew to start. Which... lean works with! After <code>brew install coreutils gmp</code> and <code>cmake -DCMAKE_PREFIX_PATH=/opt/homebrew/ ../../src</code> in a lean repo checkout, I've got a working <code>shell/lean</code> which I just confirmed is at least functional enough to begin compiling my toy project, will give an all green when <code>leanpkg test</code> passes on it after it finishes compiling mathlib, since I haven't yet set up Python enough to run leanproject. But yeah seems promising so far.</p>



<a name="217349646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217349646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217349646">(Nov 20 2020 at 00:37)</a>:</h4>
<p>(OK yeah <code>leanpkg test</code> passes)</p>



<a name="217349712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217349712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217349712">(Nov 20 2020 at 00:38)</a>:</h4>
<p>That was quite a speedy mathlib compilation too though I just jumped 8 years forward to the future I guess, I was previously compiling on a 2012 MacBook Air.</p>



<a name="217351517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217351517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217351517">(Nov 20 2020 at 01:11)</a>:</h4>
<p>It's going to turn out that really the M1 chip was optimized for M(athlib)</p>



<a name="217394234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217394234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217394234">(Nov 20 2020 at 12:27)</a>:</h4>
<p><span class="user-mention" data-user-id="321696">@Julian Berman</span> Thank you for posting these updates.  I’m sure it will help whomever comes along next.  As for vs code, are you going to run the current x86 version or the native insider build?  If the current x86 version (through Rosetta 2), does it interact with a native Lean server without issue?</p>



<a name="217394903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217394903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217394903">(Nov 20 2020 at 12:34)</a>:</h4>
<p>Or did you compile Lean as a universal app?  If so, would it then run fine under both native and x86 vs code?  There are a lot of things I’m still trying to understand here.</p>



<a name="217407859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217407859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217407859">(Nov 20 2020 at 14:33)</a>:</h4>
<p>Of course! Happy to keep poking at things and sharing some results. I'll give vscode a shot after some coffee.</p>



<a name="217407918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217407918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217407918">(Nov 20 2020 at 14:34)</a>:</h4>
<p>I did not compile a universal app, just a pure ARM one.</p>



<a name="217408271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217408271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217408271">(Nov 20 2020 at 14:37)</a>:</h4>
<p>(I also have to finish attempting to compile PyPy today, which will likely be a 5-6 hour endeavor considering I don't have an ARM thing to bootstrap it with, so I may be splitting my attention/resources with that but yeah obviously happy to try Lean things that'd be helpful to report on :)</p>



<a name="217412541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217412541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217412541">(Nov 20 2020 at 15:09)</a>:</h4>
<p>OK yup vscode is working too (communicating with my arm64 lean)</p>



<a name="217412738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/217412738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#217412738">(Nov 20 2020 at 15:11)</a>:</h4>
<p>(Using a vscode gotten via <code>brew cask install visual-studio-code</code>, which looks like it's just the stable version from the vscode site)</p>



<a name="218752672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/218752672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#218752672">(Dec 03 2020 at 20:51)</a>:</h4>
<p>how is M1 performance looking?</p>



<a name="218756173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/218756173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#218756173">(Dec 03 2020 at 21:20)</a>:</h4>
<p>I haven't tested anything scientific. I'm happy to if you have anything you think is worthwhile.</p>



<a name="218756209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/218756209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#218756209">(Dec 03 2020 at 21:21)</a>:</h4>
<p>I guess I could say compile lean for rosetta and benchmark how long it takes to build mathlib on each</p>



<a name="218756241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/218756241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#218756241">(Dec 03 2020 at 21:21)</a>:</h4>
<p>Anecdotally I'd say I'm still quite happy overall.</p>



<a name="219305416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/219305416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sorawee Porncharoenwase <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#219305416">(Dec 09 2020 at 07:48)</a>:</h4>
<p>I just got it working too! Thanks <span class="user-mention" data-user-id="321696">@Julian Berman</span> for the "<code>cmake -DCMAKE_PREFIX_PATH=/opt/homebrew/ ../../src</code>" instruction. I would never have figured that out on my own.</p>



<a name="219334972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/219334972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#219334972">(Dec 09 2020 at 13:26)</a>:</h4>
<p>Nice! Glad to hear</p>



<a name="219359834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/219359834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Brandon Brown <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#219359834">(Dec 09 2020 at 16:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238605">Kevin Lacker</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/218752672">said</a>:</p>
<blockquote>
<p>how is M1 performance looking?</p>
</blockquote>
<p>I just got my Macbook Air M1 and I haven't yet attempted to use Lean on it yet but in general I'm very happy with it. All the intel-based apps work very smoothly through the Rosetta translation layer and noticeably faster than my previous intel Macbook Air.</p>



<a name="223703909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/223703909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sorawee Porncharoenwase <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#223703909">(Jan 22 2021 at 21:36)</a>:</h4>
<p>FWIW, I attempted to upgrade Lean today, and somehow I now get an error <code>ld: library not found for -lc++</code>. Apparently I have to execute <code>export LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib"</code> before calling <code>cmake</code>.</p>



<a name="227374645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/227374645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#227374645">(Feb 23 2021 at 02:39)</a>:</h4>
<p>If someone wants to help add an <code>arm64</code> section to our <a href="https://github.com/leanprover-community/lean/blob/master/.github/workflows/on-push.yml">compile and release scripts</a>, that'd be greatly appreciated!</p>



<a name="227376812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/227376812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#227376812">(Feb 23 2021 at 03:11)</a>:</h4>
<p>There's no M1 support in GitHub actions yet</p>



<a name="227376820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/227376820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#227376820">(Feb 23 2021 at 03:11)</a>:</h4>
<p>Which is <a href="https://github.com/actions/virtual-environments/issues/2187">https://github.com/actions/virtual-environments/issues/2187</a></p>



<a name="227376871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/227376871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#227376871">(Feb 23 2021 at 03:12)</a>:</h4>
<p>Unless you mean Linux ARM64</p>



<a name="227377029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/227377029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#227377029">(Feb 23 2021 at 03:14)</a>:</h4>
<p>Ah, OK. It's not possible to cross-compile for M1 Macs either then?</p>



<a name="227377073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/227377073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#227377073">(Feb 23 2021 at 03:15)</a>:</h4>
<p>I guess we wouldn't be able to test the binary in CI, so maybe we should just wait.</p>



<a name="257691675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257691675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257691675">(Oct 15 2021 at 12:46)</a>:</h4>
<p>Apple is going to come out with the M1X MacBook Pros on Monday (or so it is widely believed).  After that, almost all new Macs will be on the M-series/Apple Silicon/arm processors.  I think as of right now, the <a href="https://leanprover-community.github.io/install/macos.html#m1-macs--apple-silicon">current Apple Silicon instructions</a> are basically "install from source and good luck" <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>.  I understand this has to do with technical issues with GitHub actions mentioned above (which I don't claim to understand).  There is now a very detailed set of instructions in <a class="stream-topic" data-stream-id="113489" href="/#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain">#new members &gt; M1 Macs: Installing the Lean 3 toolchain</a>.  I wonder what incremental progress can be made here to make this easier for M1 and M1X users. I imaging a few lean users like me plan to buy an M1X MacBook Pro in the coming month.  For example, if those instructions in <a class="stream-topic" data-stream-id="113489" href="/#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain">#new members &gt; M1 Macs: Installing the Lean 3 toolchain</a> are solid, then we could put them on the website, no?</p>



<a name="257693064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257693064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257693064">(Oct 15 2021 at 12:57)</a>:</h4>
<p>I think the proper solution would be to add ARM releases.  Lean builds just fine on ARM, but github actions doesn't have free ARM build bots.</p>



<a name="257693145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257693145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257693145">(Oct 15 2021 at 12:58)</a>:</h4>
<p>This would also be useful to our subcommunity of Raspberry Pi users.</p>



<a name="257693658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257693658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257693658">(Oct 15 2021 at 13:01)</a>:</h4>
<p>I've never quite understood this.  Would an arm release (that say works on a Raspberry Pi) also work on an M1 mac?</p>



<a name="257693933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257693933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257693933">(Oct 15 2021 at 13:03)</a>:</h4>
<p>There's Linux on ARM and then there's MacOS on ARM, the binaries are just as compatible as Linux/MacOS binaries are on AMD64.  <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>  So no, they are not interchangeable.  But it's the same kind of problem.  And a problem that I think we should solve.</p>



<a name="257694067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257694067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257694067">(Oct 15 2021 at 13:04)</a>:</h4>
<p>Does anybody know what the commercially available options are for build VMs on ARM?  I know Amazon has Linux VMs.  Can we rent a Mac build VM somewhere?</p>



<a name="257695735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257695735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257695735">(Oct 15 2021 at 13:16)</a>:</h4>
<p>In the meantime, I just ran through install instructions on M1 with Big Sur with elan v1.1.3-pre and can confirm I get the lean, leanpkg, and leanchecker installed.</p>



<a name="257696199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257696199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257696199">(Oct 15 2021 at 13:20)</a>:</h4>
<p>Another silly question:  As for renting a "Mac build VM", do you need to rent an Apple Silicon mac in the cloud (e.g. a physical mac mini), or are there VMs for MacOS which run on (non-mac) ARM machines.  (I for some reason thought it was the former, although I think I saw it is theoretically possible to build an Apple Silicon binary from an intel mac if it is running the newest MacOS.)</p>



<a name="257697571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257697571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257697571">(Oct 15 2021 at 13:30)</a>:</h4>
<p>MacStadium has them: <a href="https://www.macstadium.com/mac-mini">https://www.macstadium.com/mac-mini</a> -- but IIRC from having this discussion a few months ago with a different project, you can rent them, but the $$ might be pretty silly relative to buying one and putting it somewhere unless it's super mission critical that it be up 24/7, which for a buildbot just for releases may not be the case.</p>



<a name="257697751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257697751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257697751">(Oct 15 2021 at 13:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="115715">Jason Rute</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/257696199">said</a>:</p>
<blockquote>
<p>Another silly question:  As for renting a "Mac build VM", do you need to rent an Apple Silicon mac in the cloud (e.g. a physical mac mini), or are there VMs for MacOS which run on (non-mac) ARM machines.  (I for some reason thought it was the former, although I think I saw it is theoretically possible to build an Apple Silicon binary from an intel mac if it is running the newest MacOS.)</p>
</blockquote>
<p>there aren't for non-mac, I think (but haven't looked recently) it's still against the Apple TOS to run macOS on non-mac hardware, so this tends to make commercial people scared.</p>



<a name="257697775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257697775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257697775">(Oct 15 2021 at 13:32)</a>:</h4>
<p>I think AWS has <a href="https://aws.amazon.com/ec2/instance-types/mac/">macos vms</a></p>



<a name="257697819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257697819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257697819">(Oct 15 2021 at 13:32)</a>:</h4>
<p>They're intel macs AFAIK: <a href="https://aws.amazon.com/ec2/instance-types/">https://aws.amazon.com/ec2/instance-types/</a></p>



<a name="257697837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257697837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257697837">(Oct 15 2021 at 13:32)</a>:</h4>
<p>Ah shoot</p>



<a name="257697944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257697944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257697944">(Oct 15 2021 at 13:33)</a>:</h4>
<p>You can currently buy a refurbished 8GB Mac mini from Apple for $750.  It might even be cheaper next week.</p>



<a name="257698060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698060">(Oct 15 2021 at 13:34)</a>:</h4>
<p>Cheaper than that I think, the baseline one is $649 new</p>



<a name="257698085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698085">(Oct 15 2021 at 13:34)</a>:</h4>
<p>Oh no that's the education store, the regular one for me says $699 -- <a href="https://www.apple.com/shop/buy-mac/mac-mini/apple-m1-chip-with-8-core-cpu-and-8-core-gpu-256gb">https://www.apple.com/shop/buy-mac/mac-mini/apple-m1-chip-with-8-core-cpu-and-8-core-gpu-256gb</a> -- which yeah if someone buys and runs in their basement obviously can be connected to GHA</p>



<a name="257698118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698118">(Oct 15 2021 at 13:35)</a>:</h4>
<p>I think you can find someone who can purchase through that here</p>



<a name="257698319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698319">(Oct 15 2021 at 13:36)</a>:</h4>
<p>Yeah, I'm sure most of us hah</p>



<a name="257698402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matthew Ballard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698402">(Oct 15 2021 at 13:37)</a>:</h4>
<p>I also wonder if any institution has M1 hardware for general computing use?</p>



<a name="257698876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698876">(Oct 15 2021 at 13:40)</a>:</h4>
<p>That might be a decent idea. Also it looks like MacStadium has an open source section: <a href="https://www.macstadium.com/opensource/members">https://www.macstadium.com/opensource/members</a></p>



<a name="257698898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698898">(Oct 15 2021 at 13:40)</a>:</h4>
<p>Which seems to include Haskell GHC and some other academic-y things</p>



<a name="257698966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257698966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257698966">(Oct 15 2021 at 13:41)</a>:</h4>
<p>Seems like it'd be worth a shot to ask them for access for free under that for Lean.</p>



<a name="257704979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257704979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257704979">(Oct 15 2021 at 14:18)</a>:</h4>
<p>$130/month?!?  That's quite steep, and buying it outright is cheaper after only a year or so.  The Amazon VMs are $15/mo for comparison.</p>



<a name="257705437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257705437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257705437">(Oct 15 2021 at 14:21)</a>:</h4>
<p>I think we could easily rent an ARM Linux VM from Amazon and hook it up as a runner for the lean/lean4 repos.  <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I believe you experimented with cross-compilation at some point.  Did that work out, or should we get native build machines?</p>



<a name="257705664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257705664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257705664">(Oct 15 2021 at 14:22)</a>:</h4>
<p>I have no idea what the best approach for the mac builds is.</p>



<a name="257706464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257706464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257706464">(Oct 15 2021 at 14:27)</a>:</h4>
<p>I will give it another try after landing the self-contained Zig/LLVM build, which is basically the same problem. I might take some dependencies from ARM Nixpkgs.</p>



<a name="257706556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257706556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257706556">(Oct 15 2021 at 14:28)</a>:</h4>
<p>Do you want me to look into contacting the open source part there? I'm happy to do so and CC one of you.</p>



<a name="257706850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/257706850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#257706850">(Oct 15 2021 at 14:29)</a>:</h4>
<p>I'll defer to Sebastian if cross-compilation is possible instead, but if it isn't then please go ahead.</p>



<a name="258031549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258031549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258031549">(Oct 18 2021 at 13:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> What is your preferred way to support arm releases in elan?  Elan currently appends only <code>-linux.tar.gz</code>, but not any architecture information.  Should this be <code>-linux-aarch64.tar.gz</code> for arm and <code>-linux.tar.gz</code> for amd64?</p>



<a name="258031717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258031717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258031717">(Oct 18 2021 at 13:50)</a>:</h4>
<p>I think that makes the most sense, yes</p>



<a name="258339130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258339130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258339130">(Oct 20 2021 at 09:41)</a>:</h4>
<p>Lean 3.34 now comes with Linux/aarch64 builds (cross-compiled on github actions).  These work out of the box with elan (which also has a Linux/aarch64 release now).</p>



<a name="258339323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258339323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258339323">(Oct 20 2021 at 09:43)</a>:</h4>
<p>The situation with Darwin/aarch64 is a bit more hairy because we can't cross compile them so we need an actual aarch64 machine.  Of course, the github actions runner doesn't work on aarch64 macs yet: <a href="https://github.com/actions/runner/issues/805">https://github.com/actions/runner/issues/805</a>  But the issues describes some workarounds that we could use if we had such a machine.</p>



<a name="258339551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258339551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258339551">(Oct 20 2021 at 09:45)</a>:</h4>
<p>I've tried the "cross compile on github actions" approach for Lean 4 as well.  The tests pass, but it takes 90 minutes to build:  <a href="https://github.com/gebner/lean4/runs/3941840303?check_suite_focus=true">https://github.com/gebner/lean4/runs/3941840303?check_suite_focus=true</a><br>
(It's so slow because it's running the stage0 compiler is compiled for aaarch64 and running via CPU emulation.  Otherwise the compiled Lean executable wouldn't recognize unicode syntax like ≤...)</p>



<a name="258339676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258339676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258339676">(Oct 20 2021 at 09:46)</a>:</h4>
<p>So for Lean 4 we either need to set up a self-hosted runner for Linux/aarch64 (no technical issues) or get the zig cross-compilation PR working (and hope that it is faster).</p>



<a name="258346176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258346176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258346176">(Oct 20 2021 at 10:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/258339551">said</a>:</p>
<blockquote>
<p>Otherwise the compiled Lean executable wouldn't recognize unicode syntax like ≤...</p>
</blockquote>
<p>Wait, why is that?</p>



<a name="258346217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258346217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258346217">(Oct 20 2021 at 10:43)</a>:</h4>
<p>Are the .oleans different after all?</p>



<a name="258346455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258346455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258346455">(Oct 20 2021 at 10:45)</a>:</h4>
<p>I have no idea.  You can look at the build here: <a href="https://github.com/gebner/lean4/actions/runs/1359921109">https://github.com/gebner/lean4/actions/runs/1359921109</a></p>



<a name="258347206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258347206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258347206">(Oct 20 2021 at 10:52)</a>:</h4>
<p>They do differ in a handful of bytes, very interesting</p>



<a name="258347226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258347226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258347226">(Oct 20 2021 at 10:52)</a>:</h4>
<p>Now how am I supposed to debug that <span aria-label="laughter tears" class="emoji emoji-1f602" role="img" title="laughter tears">:laughter_tears:</span></p>



<a name="258347465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258347465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258347465">(Oct 20 2021 at 10:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>  Could you try running the working binary with the other olean files just to make sure?</p>



<a name="258348159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258348159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258348159">(Oct 20 2021 at 11:00)</a>:</h4>
<p>All tests pass so it should work (except for tests involving leanc, which isn't set up for cross compilation).  I've just tested it on an aarch64 vm, and the 3941840303 build compiles a working lake binary.</p>



<a name="258356386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258356386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258356386">(Oct 20 2021 at 12:17)</a>:</h4>
<p>Oh sorry, I misunderstood you.  I've now copied the oleans from the bad build the good build, and got this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">build</span><span class="bp">@</span><span class="n">ip</span><span class="bp">-</span><span class="mi">172</span><span class="bp">-</span><span class="mi">30</span><span class="bp">-</span><span class="mi">0</span><span class="bp">-</span><span class="mi">147</span><span class="o">:</span><span class="bp">~/</span><span class="n">lake</span><span class="bp">$</span> <span class="bp">./</span><span class="n">build.sh</span>
<span class="n">lean</span>  <span class="bp">-</span><span class="n">o</span> <span class="s2">"build/lib/Lake/Async.olean"</span> <span class="c1">--c="build/ir/Lake/Async.c.tmp" Lake/Async.lean</span>
<span class="n">Lake</span><span class="bp">/</span><span class="n">Async.lean</span><span class="o">:</span><span class="mi">116</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">elaboration</span> <span class="n">function</span> <span class="n">for</span> <span class="bp">'«</span><span class="n">term_</span><span class="bp">≤</span><span class="n">_</span><span class="bp">»'</span> <span class="n">has</span> <span class="n">not</span> <span class="n">been</span> <span class="n">implemented</span>
</code></pre></div>



<a name="258368743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258368743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258368743">(Oct 20 2021 at 13:40)</a>:</h4>
<p>Thanks, that narrows it down at the very least</p>



<a name="258406928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258406928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258406928">(Oct 20 2021 at 17:17)</a>:</h4>
<p>I think I have solved (part of) the puzzle.</p>



<a name="258407037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258407037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258407037">(Oct 20 2021 at 17:18)</a>:</h4>
<p>The <code>String.hash</code> function gives different results on aarch64 and amd64.</p>



<a name="258407113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258407113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258407113">(Oct 20 2021 at 17:18)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="s2">"α"</span><span class="bp">.</span><span class="n">hash</span>
<span class="c1">-- 1281896824 on amd64</span>
<span class="c1">-- 3220031286 on aarch64</span>
</code></pre></div>



<a name="258407246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258407246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258407246">(Oct 20 2021 at 17:19)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<p>α contains characters whose byte value is greater than 128. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> </p>
</div></div>



<a name="258407426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258407426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258407426">(Oct 20 2021 at 17:20)</a>:</h4>
<p>This was pretty obvious once I wrote an olean parser:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code> diff -u (~/oleanparser/build/bin/oleanparser good/lib/lean/Init/Classical.olean | psub) (~/oleanparser/build/bin/oleanparser bad/lib/lean/Init/Classical.olean | psub)
<span class="gd">--- /tmp/.psub.UC8YpPL3fz       2021-10-20 19:12:41.126207464 +0200</span>
<span class="gi">+++ /tmp/.psub.NKZ5f7HRrb       2021-10-20 19:12:41.148207390 +0200</span>
<span class="gu">@@ -554,7 +554,7 @@</span>
 let x554 := Obj.constructor 1 #[x553, "proof_1"] [97, 226, 97, 203, 47, 251, 113, 117]
 let x555 := Obj.constructor 1 #[0, "u_1"] [237, 16, 194, 56, 135, 176, 85, 203]
 let x556 := Obj.constructor 1 #[x555, 0] []
<span class="gd">-let x557 := Obj.constructor 1 #[0, "α"] [59, 122, 173, 22, 213, 44, 93, 185]</span>
<span class="gi">+let x557 := Obj.constructor 1 #[0, "α"] [191, 78, 70, 42, 51, 137, 215, 74]</span>
 let x558 := Obj.constructor 4 #[x555] [157, 7, 234, 105, 2, 0, 0, 0]
 let x559 := Obj.constructor 3 #[x558] [25, 15, 82, 84, 8, 0, 0, 0]
 let x560 := Obj.constructor 1 #[0, "p"] [185, 187, 25, 190, 51, 234, 3, 115]
<span class="gu">@@ -1476,7 +1476,7 @@</span>
 let x1476 := Obj.constructor 5 #[x43, x1381] [36, 111, 226, 248, 0, 2, 0, 0]
 let x1477 := Obj.constructor 5 #[x1476, x924] [19, 101, 95, 177, 0, 3, 10, 0]
 let x1478 := Obj.constructor 5 #[x1477, x802] [110, 161, 111, 244, 0, 4, 10, 0]
<span class="gd">-let x1479 := Obj.constructor 1 #[0, "h₀"] [249, 94, 105, 59, 215, 135, 180, 130]</span>
<span class="gi">+let x1479 := Obj.constructor 1 #[0, "h₀"] [149, 227, 157, 165, 5, 11, 91, 222]</span>
 let x1480 := Obj.constructor 5 #[x1443, x32] [163, 255, 221, 250, 0, 1, 12, 0]
 let x1481 := Obj.constructor 6 #[x18, x567, x1480] [48, 151, 219, 119, 0, 2, 11, 0]
 let x1482 := Obj.constructor 5 #[x1403, x1481] [45, 65, 72, 178, 0, 3, 11, 0]
<span class="gu">@@ -3420,7 +3420,7 @@</span>
 let x3420 := Obj.constructor 0 #[x3419, 0, x484] []
 let x3421 := Obj.constructor 0 #[x3420, x333, 0] [0, 0, 0, 0, 0, 0, 0, 0]
 let x3422 := Obj.constructor 1 #[x3421] []
<span class="gd">-let x3423 := Obj.constructor 1 #[0, "β"] [57, 91, 110, 179, 207, 81, 176, 247]</span>
<span class="gi">+let x3423 := Obj.constructor 1 #[0, "β"] [17, 104, 126, 98, 217, 137, 147, 75]</span>
 let x3424 := Obj.constructor 2 #[x565, 876] [83, 146, 246, 209, 131, 147, 125, 157]
 let x3425 := Obj.constructor 7 #[x3424, x32, x675] [255, 14, 17, 220, 8, 1, 1, 0]
 let x3426 := Obj.constructor 1 #[0, "r"] [151, 224, 143, 155, 147, 185, 82, 85]
</code></pre></div>



<a name="258424453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258424453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258424453">(Oct 20 2021 at 19:01)</a>:</h4>
<p>Apparently this was the only issue with stage0 as a cross-compiler.  Is it ok if I make PR? <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span></p>



<a name="258424671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258424671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258424671">(Oct 20 2021 at 19:02)</a>:</h4>
<p>OMG, please do</p>



<a name="258424688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258424688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258424688">(Oct 20 2021 at 19:02)</a>:</h4>
<p>The parser sounds amazing</p>



<a name="258682726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258682726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258682726">(Oct 22 2021 at 09:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Apple.20Silicon/near/258031549">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> What is your preferred way to support arm releases in elan?  Elan currently appends only <code>-linux.tar.gz</code>, but not any architecture information.  Should this be <code>-linux-aarch64.tar.gz</code> for arm and <code>-linux.tar.gz</code> for amd64?</p>
</blockquote>
<p>For the future, we could avoid these issues by enforcing an elan self update before attempting to download a toolchain.</p>



<a name="258689307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258689307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258689307">(Oct 22 2021 at 10:01)</a>:</h4>
<p>This won't work if you install elan via homebrew or nix.</p>



<a name="258689635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258689635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258689635">(Oct 22 2021 at 10:04)</a>:</h4>
<p>Maybe it can output a warning whenever there is a new (major) release available?</p>



<a name="258689656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Apple%20Silicon/near/258689656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Apple.20Silicon.html#258689656">(Oct 22 2021 at 10:04)</a>:</h4>
<p>Then people know that they should update their package</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>