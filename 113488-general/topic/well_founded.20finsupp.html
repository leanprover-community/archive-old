---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/well_founded.20finsupp.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html">well_founded finsupp</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="170701513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701513">(Jul 12 2019 at 07:37)</a>:</h4>
<p>Can someone explain to me how to prove that</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">preorder</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">le</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">s</span><span class="o">,</span> <span class="n">f</span> <span class="n">s</span> <span class="bp">≤</span> <span class="n">g</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">le_refl</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">s</span><span class="o">,</span> <span class="n">le_refl</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">le_trans</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="n">Hfg</span> <span class="n">Hgh</span> <span class="n">s</span><span class="o">,</span> <span class="n">le_trans</span> <span class="o">(</span><span class="n">Hfg</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">Hgh</span> <span class="n">s</span><span class="o">)</span> <span class="o">}</span>
</pre></div>


<p>(see <a href="https://github.com/leanprover-community/mathlib/pull/1216/files#diff-af9f424915b54a36301c2cba4d92a12cR1447" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/1216/files#diff-af9f424915b54a36301c2cba4d92a12cR1447">https://github.com/leanprover-community/mathlib/pull/1216/files#diff-af9f424915b54a36301c2cba4d92a12cR1447</a>)<br>
is well founded in the case <code>α := ℕ</code></p>



<a name="170701561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701561">(Jul 12 2019 at 07:38)</a>:</h4>
<p><code>measure_wf</code></p>



<a name="170701580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701580">(Jul 12 2019 at 07:39)</a>:</h4>
<p>But you have to show that <code>lt = λ f g, ∀ s, f s &lt; g s</code></p>



<a name="170701586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701586">(Jul 12 2019 at 07:39)</a>:</h4>
<p>And that isn't your definition, but maybe it should be.</p>



<a name="170701742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701742">(Jul 12 2019 at 07:42)</a>:</h4>
<p>but it isn't</p>



<a name="170701760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701760">(Jul 12 2019 at 07:42)</a>:</h4>
<p>No, that's not the definition I want</p>



<a name="170701859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701859">(Jul 12 2019 at 07:44)</a>:</h4>
<p>Ah, it's actually much harder than I thought.</p>



<a name="170701885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701885">(Jul 12 2019 at 07:45)</a>:</h4>
<p>show that the downset is finite</p>



<a name="170701897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701897">(Jul 12 2019 at 07:45)</a>:</h4>
<p>Right, you did that.</p>



<a name="170701908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701908">(Jul 12 2019 at 07:45)</a>:</h4>
<p>How do I turn that into a proof of <code>wf</code>?</p>



<a name="170701967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701967">(Jul 12 2019 at 07:46)</a>:</h4>
<p>I don't know</p>



<a name="170701973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701973">(Jul 12 2019 at 07:46)</a>:</h4>
<p>but that seems like an important lemma</p>



<a name="170701994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170701994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170701994">(Jul 12 2019 at 07:47)</a>:</h4>
<p>I only ask you to prove important lemmas <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="170702124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170702124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170702124">(Jul 12 2019 at 07:49)</a>:</h4>
<p>This is provable right.</p>
<div class="codehilite"><pre><span></span><span class="n">f</span> <span class="bp">&lt;</span> <span class="n">g</span> <span class="bp">→</span> <span class="n">f</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">g</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
</pre></div>



<a name="170702211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170702211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170702211">(Jul 12 2019 at 07:51)</a>:</h4>
<p>I think it is</p>



<a name="170702969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170702969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170702969">(Jul 12 2019 at 08:05)</a>:</h4>
<p>I now have an order embedding into multiset. How do I pullback the wellfoundedness?</p>



<a name="170703001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703001">(Jul 12 2019 at 08:05)</a>:</h4>
<p>subrel of wf is wf; inv_image of wf is wf</p>



<a name="170703004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703004">(Jul 12 2019 at 08:05)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">to_multiset_strict_mono</span> <span class="o">:</span> <span class="n">strict_mono</span> <span class="o">(</span><span class="bp">@</span><span class="n">to_multiset</span> <span class="n">σ</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">m</span> <span class="n">n</span> <span class="n">h</span><span class="o">,</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="n">lt_iff_le_and_ne</span> <span class="n">at</span> <span class="n">h</span> <span class="err">⊢</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span> <span class="k">with</span> <span class="n">h₁</span> <span class="n">h₂</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">le_iff_count</span><span class="o">,</span> <span class="n">intro</span> <span class="n">s</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">count_to_multiset</span><span class="o">,</span> <span class="n">count_to_multiset</span><span class="o">],</span> <span class="n">exact</span> <span class="n">h₁</span> <span class="n">s</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">H</span><span class="o">,</span> <span class="n">apply</span> <span class="n">h₂</span><span class="o">,</span> <span class="n">replace</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">to_finsupp</span> <span class="n">H</span><span class="o">,</span> <span class="n">simpa</span> <span class="kn">using</span> <span class="n">H</span> <span class="o">}</span>
<span class="kn">end</span>
</pre></div>



<a name="170703067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703067">(Jul 12 2019 at 08:06)</a>:</h4>
<p><code>inv_image.wf</code></p>



<a name="170703812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703812">(Jul 12 2019 at 08:21)</a>:</h4>
<p>Aah, but the well founded relation on multiset is not the subset relation, is it?</p>



<a name="170703923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703923">(Jul 12 2019 at 08:22)</a>:</h4>
<p>It's strict subset.</p>



<a name="170703946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703946">(Jul 12 2019 at 08:23)</a>:</h4>
<p>Both ssubset and <code>lt</code> are well founded.</p>



<a name="170703954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703954">(Jul 12 2019 at 08:23)</a>:</h4>
<p>Is there a proof that <code>lt</code> is well founded?</p>



<a name="170703958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703958">(Jul 12 2019 at 08:23)</a>:</h4>
<p>Because that is the one I want to pull back</p>



<a name="170703965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170703965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170703965">(Jul 12 2019 at 08:23)</a>:</h4>
<p>But typeclass inference finds the other one</p>



<a name="170704014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170704014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170704014">(Jul 12 2019 at 08:24)</a>:</h4>
<p>There's probably a proof it implies card &lt; card</p>



<a name="170705862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170705862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170705862">(Jul 12 2019 at 08:55)</a>:</h4>
<p>I love the way that we mathematicians still don't properly understand induction.</p>



<a name="170713091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170713091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170713091">(Jul 12 2019 at 11:03)</a>:</h4>
<p>Does someone see something that is obviously wrong with</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">inv_of_unit</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">mv_power_series</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">units</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">coeff</span> <span class="mi">0</span> <span class="n">φ</span> <span class="bp">=</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">mv_power_series</span> <span class="n">σ</span> <span class="n">α</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="err">↑</span><span class="n">u</span><span class="bp">⁻¹</span> <span class="k">else</span>
  <span class="bp">-</span> <span class="err">↑</span><span class="n">u</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="n">n</span><span class="bp">.</span><span class="n">diagonal</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)),</span>
    <span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">inv_of_unit</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">coeff</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span> <span class="n">φ</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">using_well_founded</span> <span class="o">{</span> <span class="n">rel_tac</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">`</span><span class="o">[</span><span class="n">exact</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">lt_wf</span> <span class="n">σ</span><span class="bp">⟩</span><span class="o">]</span> <span class="o">}</span>
</pre></div>


<p>I get 6 deterministic timeouts, and no other useful error messages...</p>



<a name="170713167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170713167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170713167">(Jul 12 2019 at 11:04)</a>:</h4>
<p>For the record:</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">to_multiset_strict_mono</span> <span class="o">:</span> <span class="n">strict_mono</span> <span class="o">(</span><span class="bp">@</span><span class="n">to_multiset</span> <span class="n">σ</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">m</span> <span class="n">n</span> <span class="n">h</span><span class="o">,</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="n">lt_iff_le_and_ne</span> <span class="n">at</span> <span class="n">h</span> <span class="err">⊢</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span> <span class="k">with</span> <span class="n">h₁</span> <span class="n">h₂</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">le_iff_count</span><span class="o">,</span> <span class="n">intro</span> <span class="n">s</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">count_to_multiset</span><span class="o">,</span> <span class="n">count_to_multiset</span><span class="o">],</span> <span class="n">exact</span> <span class="n">h₁</span> <span class="n">s</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">H</span><span class="o">,</span> <span class="n">apply</span> <span class="n">h₂</span><span class="o">,</span> <span class="n">replace</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">to_finsupp</span> <span class="n">H</span><span class="o">,</span> <span class="n">simpa</span> <span class="kn">using</span> <span class="n">H</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">sum_lt_of_lt</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">m</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">card_to_multiset</span><span class="o">,</span> <span class="err">←</span> <span class="n">card_to_multiset</span><span class="o">],</span>
  <span class="n">apply</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card_lt_of_lt</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">to_multiset_strict_mono</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span>
<span class="kn">end</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">σ</span><span class="o">)</span>

<span class="n">def</span> <span class="n">lt_wf</span> <span class="o">:</span> <span class="n">well_founded</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_lt</span><span class="bp">.</span><span class="n">lt</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">subrelation</span><span class="bp">.</span><span class="n">wf</span> <span class="o">(</span><span class="n">sum_lt_of_lt</span><span class="o">)</span> <span class="err">$</span> <span class="n">inv_image</span><span class="bp">.</span><span class="n">wf</span> <span class="bp">_</span> <span class="n">nat</span><span class="bp">.</span><span class="n">lt_wf</span>
</pre></div>



<a name="170713255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170713255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170713255">(Jul 12 2019 at 11:06)</a>:</h4>
<p>Full code is available at <a href="https://github.com/leanprover-community/mathlib/blob/power-series/src/data/power_series.lean#L666-L670" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/power-series/src/data/power_series.lean#L666-L670">https://github.com/leanprover-community/mathlib/blob/power-series/src/data/power_series.lean#L666-L670</a></p>



<a name="170713950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170713950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170713950">(Jul 12 2019 at 11:22)</a>:</h4>
<blockquote>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">inv_of_unit</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">mv_power_series</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">units</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">coeff</span> <span class="mi">0</span> <span class="n">φ</span> <span class="bp">=</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">mv_power_series</span> <span class="n">σ</span> <span class="n">α</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="err">↑</span><span class="n">u</span><span class="bp">⁻¹</span> <span class="k">else</span>
  <span class="bp">-</span> <span class="err">↑</span><span class="n">u</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="n">n</span><span class="bp">.</span><span class="n">diagonal</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)),</span>
    <span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">inv_of_unit</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">coeff</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span> <span class="n">φ</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">using_well_founded</span> <span class="o">{</span> <span class="n">rel_tac</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">`</span><span class="o">[</span><span class="n">exact</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">lt_wf</span> <span class="n">σ</span><span class="bp">⟩</span><span class="o">]</span> <span class="o">}</span>
</pre></div>


</blockquote>
<p>In this code I call <code>inv_of_unit x.1</code>. Do I recall correctly that I should not put the "default" arguments in recursive calls? That is, I should not replace this with <code>inv_of_unit φ u h x.1</code>. Or should I?<br>
I get timeouts with both of these, so Lean doesn't tell me which one is correct.</p>



<a name="170715263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170715263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170715263">(Jul 12 2019 at 11:49)</a>:</h4>
<p>You should only put the stuff right of the colon into a recursive call.</p>



<a name="170715729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170715729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170715729">(Jul 12 2019 at 11:58)</a>:</h4>
<p>Right, so I did it correctly.</p>



<a name="170715742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170715742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170715742">(Jul 12 2019 at 11:58)</a>:</h4>
<p>Any idea why Lean is unhappy?</p>



<a name="170716001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716001">(Jul 12 2019 at 12:02)</a>:</h4>
<p>Because there are no arguments right of the colon?</p>



<a name="170716026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716026">(Jul 12 2019 at 12:03)</a>:</h4>
<p><code>mv_power_series σ α := (σ →₀ ℕ) → α</code></p>



<a name="170716027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716027">(Jul 12 2019 at 12:03)</a>:</h4>
<p>Is that good enough?</p>



<a name="170716092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716092">(Jul 12 2019 at 12:04)</a>:</h4>
<p>If I replace the summand <code>if h : x.1 &lt; n then inv_of_unit x.1 * coeff x.2 φ else 0</code> with <code>0</code> then Lean is perfectly happy.</p>



<a name="170716103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716103">(Jul 12 2019 at 12:04)</a>:</h4>
<p>There's no closed curly bracket on the last line?</p>



<a name="170716130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716130">(Jul 12 2019 at 12:05)</a>:</h4>
<p>There is in my local copy <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="170716134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716134">(Jul 12 2019 at 12:05)</a>:</h4>
<p>So that's also not the issue</p>



<a name="170716138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716138">(Jul 12 2019 at 12:05)</a>:</h4>
<p>MWE</p>



<a name="170716610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716610">(Jul 12 2019 at 12:14)</a>:</h4>
<p>Is it some decidability thing?</p>



<a name="170716657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716657">(Jul 12 2019 at 12:15)</a>:</h4>
<p>Voila: <a href="https://gist.github.com/jcommelin/a521437d3886968db4a54154da503f3e" target="_blank" title="https://gist.github.com/jcommelin/a521437d3886968db4a54154da503f3e">https://gist.github.com/jcommelin/a521437d3886968db4a54154da503f3e</a></p>



<a name="170716669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716669">(Jul 12 2019 at 12:15)</a>:</h4>
<p>The MWE is a bit long... I included the ring structure on power series.</p>



<a name="170716716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716716">(Jul 12 2019 at 12:16)</a>:</h4>
<p>The problem is all the way at the bottom. The rest of the file is mostly uninteresting.</p>



<a name="170716753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716753">(Jul 12 2019 at 12:17)</a>:</h4>
<p>I have <code>[decidable_eq σ]</code>... so that shouldn't be the issue, I think.</p>



<a name="170716842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716842">(Jul 12 2019 at 12:18)</a>:</h4>
<p>Hmmm.... but <code>#check (by apply_instance : decidable_rel (@has_lt.lt (σ →₀ ℕ) _))</code> times out.</p>



<a name="170716846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716846">(Jul 12 2019 at 12:18)</a>:</h4>
<p>Is that bad?</p>



<a name="170716852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716852">(Jul 12 2019 at 12:19)</a>:</h4>
<p>Does the <code>wf</code> relation have to be decidable?</p>



<a name="170716931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716931">(Jul 12 2019 at 12:20)</a>:</h4>
<p>Defining that instance using <code>sorry</code> the <code>inv_of_unit</code> suddenly no longer times out, but gives an error message:</p>
<div class="codehilite"><pre><span></span>failed to prove recursive application is decreasing, well founded relation
  @has_well_founded.r (σ →₀ ℕ)
    (@has_well_founded.mk (σ →₀ ℕ)
       (@has_lt.lt (σ →₀ ℕ)
          (@preorder.to_has_lt (σ →₀ ℕ)
             (@finsupp.preorder σ ℕ (λ (a b : σ), _inst_1 a b)
                (@partial_order.to_preorder ℕ
                   (@ordered_comm_monoid.to_partial_order ℕ
                      (@ordered_cancel_comm_monoid.to_ordered_comm_monoid ℕ
                         (@ordered_semiring.to_ordered_cancel_comm_monoid ℕ nat.ordered_semiring))))
                nat.has_zero)))
       _)
</pre></div>



<a name="170716972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170716972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170716972">(Jul 12 2019 at 12:21)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">0</span><span class="o">]</span> <span class="n">classical</span><span class="bp">.</span><span class="n">dec</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">inv_of_unit</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">mv_power_series</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">units</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">coeff</span> <span class="mi">0</span> <span class="n">φ</span> <span class="bp">=</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="n">mv_power_series</span> <span class="n">σ</span> <span class="n">α</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="err">↑</span><span class="n">u</span><span class="bp">⁻¹</span> <span class="k">else</span>
<span class="bp">-</span> <span class="err">↑</span><span class="n">u</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="n">n</span><span class="bp">.</span><span class="n">diagonal</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)),</span>
   <span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">inv_of_unit</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">coeff</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span> <span class="n">φ</span> <span class="k">else</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">using_well_founded</span> <span class="o">{</span> <span class="n">rel_tac</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">`</span><span class="o">[</span><span class="n">exact</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">lt_wf</span> <span class="n">σ</span><span class="bp">⟩</span><span class="o">],</span>
  <span class="n">dec_tac</span> <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">assumption</span> <span class="o">}</span>
</pre></div>



<a name="170717026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717026">(Jul 12 2019 at 12:22)</a>:</h4>
<p>You need decidable lt on finsupp because of the <code>if</code></p>



<a name="170717179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717179">(Jul 12 2019 at 12:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> Thanks a lot!</p>



<a name="170717249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717249">(Jul 12 2019 at 12:26)</a>:</h4>
<p>Any hints on how I could prove that <code>&lt;</code> is decidable?</p>



<a name="170717255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717255">(Jul 12 2019 at 12:26)</a>:</h4>
<p>What's the definition?</p>



<a name="170717268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717268">(Jul 12 2019 at 12:26)</a>:</h4>
<p>It might be <code>unfold lt; apply_instance</code></p>



<a name="170717539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717539">(Jul 12 2019 at 12:30)</a>:</h4>
<p>The definition of <code>le</code> is <code>\for s, f s ≤ g s</code>.</p>



<a name="170717565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717565">(Jul 12 2019 at 12:31)</a>:</h4>
<p>So <code>&lt;</code> is <code>\exists s, f + single s 1 ≤ g</code>.</p>



<a name="170717570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717570">(Jul 12 2019 at 12:31)</a>:</h4>
<p>Show it's equivalent to forall s in the support.</p>



<a name="170717584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717584">(Jul 12 2019 at 12:31)</a>:</h4>
<p>Exactly</p>



<a name="170717733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170717733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170717733">(Jul 12 2019 at 12:34)</a>:</h4>
<p>Ok, this seems to work, but I don't know why <span aria-label="oops" class="emoji emoji-1f643" role="img" title="oops">:oops:</span> </p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">decidable_lt</span> <span class="o">:</span> <span class="n">decidable_rel</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_lt</span><span class="bp">.</span><span class="n">lt</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">m</span> <span class="n">n</span><span class="o">,</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">_</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">lt_iff_le_and_ne</span><span class="o">,</span> <span class="n">refine</span> <span class="bp">@</span><span class="n">and</span><span class="bp">.</span><span class="n">decidable</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">le_iff</span><span class="o">,</span> <span class="n">apply_instance</span>
<span class="kn">end</span>
</pre></div>



<a name="170952546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952546">(Jul 16 2019 at 04:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Should we also have <code>nat.diagonal</code>?</p>



<a name="170952551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952551">(Jul 16 2019 at 04:05)</a>:</h4>
<p>Isomorphic to the special case <code>finsupp unit nat</code>...</p>



<a name="170952555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952555">(Jul 16 2019 at 04:05)</a>:</h4>
<p>Or is it better to use <code>range n</code> and subtraction?</p>



<a name="170952616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952616">(Jul 16 2019 at 04:06)</a>:</h4>
<p>Compare <code>coeff_mul</code> for <code>polynomial</code>: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/data/polynomial.lean#L169-L170" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/src/data/polynomial.lean#L169-L170">https://github.com/leanprover-community/mathlib/blob/master/src/data/polynomial.lean#L169-L170</a></p>



<a name="170952617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952617">(Jul 16 2019 at 04:06)</a>:</h4>
<p>sure. I guess it's not hard to prove that <code>(list.range (n+1)).map (\lam i, (i, n - i))</code>has the requisite property</p>



<a name="170952650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952650">(Jul 16 2019 at 04:07)</a>:</h4>
<p>Also... shouldn't these things be called <code>antidiagonal</code>?</p>



<a name="170952655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952655">(Jul 16 2019 at 04:07)</a>:</h4>
<p>I've been thinking about that</p>



<a name="170952708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952708">(Jul 16 2019 at 04:08)</a>:</h4>
<p><code>simplex</code> might also work in the finsupp generalization</p>



<a name="170952813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952813">(Jul 16 2019 at 04:11)</a>:</h4>
<p>Hmm, I would say <code>finsupp.simplex (a : \a)</code> is the set of <code>finsupp X \a</code> that sum up to <code>a</code>.</p>



<a name="170952820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170952820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170952820">(Jul 16 2019 at 04:11)</a>:</h4>
<p>Or something like that.</p>



<a name="170953757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170953757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170953757">(Jul 16 2019 at 04:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Would you approve of a PR that changes all <code>diagonal</code>s to <code>antidiagonal</code>s?</p>



<a name="170953767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170953767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170953767">(Jul 16 2019 at 04:36)</a>:</h4>
<p>sure</p>



<a name="170959800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170959800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170959800">(Jul 16 2019 at 07:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Should something like <code>nat.antidiagonal</code> go into <code>data/nat/basic</code>? Or is it not basic enough?</p>



<a name="170959840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/well_founded%20finsupp/near/170959840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/well_founded.20finsupp.html#170959840">(Jul 16 2019 at 07:01)</a>:</h4>
<p>It should go in <code>data.list.basic</code>, <code>data.multiset.basic</code>, or <code>data.finset.basic</code> depending on which version you are talking about</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>