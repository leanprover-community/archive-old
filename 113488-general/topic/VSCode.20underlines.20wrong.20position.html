---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html">VSCode underlines wrong position</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="210980056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210980056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210980056">(Sep 23 2020 at 09:46)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n1</span> <span class="n">n2</span> <span class="n">n3</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="k">#check</span> <span class="kd">by</span> <span class="k">have</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">n1</span> <span class="bp">*</span> <span class="n">n2</span><span class="o">)</span> <span class="n">n3</span> <span class="bp">=</span> <span class="n">function.uncurry</span> <span class="n">f</span> <span class="o">(</span><span class="n">n1</span> <span class="bp">*</span> <span class="n">n2</span><span class="o">)</span>
</code></pre></div>



<a name="210980176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210980176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210980176">(Sep 23 2020 at 09:47)</a>:</h4>
<div class="message_inline_image"><a href="/user_uploads/3121/IYfJ06lRXefg_p_w7p6aC9tS/2020-09-23-3.png"><img src="/user_uploads/3121/IYfJ06lRXefg_p_w7p6aC9tS/2020-09-23-3.png"></a></div>



<a name="210980265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210980265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210980265">(Sep 23 2020 at 09:48)</a>:</h4>
<p>VSCode highlights the first <code>(n1 * n2)</code> as the error, when it is in fact the second <code>(n1 * n2)</code> that causes the type mismatch</p>



<a name="210988662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210988662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210988662">(Sep 23 2020 at 11:29)</a>:</h4>
<p>+1 for <code>#check by have</code></p>



<a name="210989370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989370">(Sep 23 2020 at 11:37)</a>:</h4>
<p>I'm not sure it's a bug. Type inference/checking in languages like ML, Haskell, and Lean is done by collecting and solving some constraints. It doesn't work left-to-right, and it often fails to identify the root cause.</p>



<a name="210989552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989552">(Sep 23 2020 at 11:39)</a>:</h4>
<p>it's a bug because if you do this instead:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n1</span> <span class="n">n2</span> <span class="n">n3</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="k">#check</span> <span class="n">f</span> <span class="o">(</span><span class="n">n1</span> <span class="bp">*</span> <span class="n">n2</span><span class="o">)</span> <span class="n">n3</span> <span class="bp">=</span> <span class="n">function.uncurry</span> <span class="n">f</span> <span class="o">(</span><span class="n">n1</span> <span class="bp">*</span> <span class="n">n2</span><span class="o">)</span>
</code></pre></div>



<a name="210989561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989561">(Sep 23 2020 at 11:39)</a>:</h4>
<p>then the error is on the second <code>n1 * n2</code> as it should</p>



<a name="210989663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989663">(Sep 23 2020 at 11:40)</a>:</h4>
<p>Maybe it's a bug, but your argument doesn't convince me. ;)</p>



<a name="210989689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989689">(Sep 23 2020 at 11:40)</a>:</h4>
<p>well why can it identify the root cause in term mode but not in tactic mode?</p>



<a name="210989732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989732">(Sep 23 2020 at 11:41)</a>:</h4>
<p>I don't know the procedure, but for all I know it could be nondeterministic and report random results.</p>



<a name="210989890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989890">(Sep 23 2020 at 11:42)</a>:</h4>
<p>(The E prover, for example, compares pointers and is therefore nondetermistic.)</p>



<a name="210989908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989908">(Sep 23 2020 at 11:43)</a>:</h4>
<p>Maybe different elaboration strategies are being used for some reason?</p>



<a name="210989946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/210989946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#210989946">(Sep 23 2020 at 11:43)</a>:</h4>
<p>I believe I've seen proofs of the form <code>:= &lt;term&gt;</code> which fail, and then succeed with <code>:= by exact &lt;term&gt;</code></p>



<a name="211010635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211010635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211010635">(Sep 23 2020 at 14:24)</a>:</h4>
<p>I get a different error (failed to synthesize type class instance for <code>has_mul (α × α)</code>), but the error reporting is similarly odd. In particular, it reports the first term only when you use the same expression in both places, e.g. if you use <code>n1 * n3</code> on the left then it reports on the right as you would expect. My guess is that it is hash consing the expressions and associating the error location to that, meaning that when we report the error we've forgotten which <code>n1 * n2</code> was responsible for the error</p>



<a name="211011246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211011246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211011246">(Sep 23 2020 at 14:29)</a>:</h4>
<p>So then it should be really easy to confuse lean in this way and we probably would have spotted it years ago?</p>



<a name="211012008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211012008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211012008">(Sep 23 2020 at 14:34)</a>:</h4>
<p>Indeed. It  could be interacting with another feature though, like the <code>have</code> tactic or some other aspect here making it more niche</p>



<a name="211015514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211015514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211015514">(Sep 23 2020 at 14:59)</a>:</h4>
<p>Hash consing is disabled by default IIRC.</p>



<a name="211015905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211015905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211015905">(Sep 23 2020 at 15:02)</a>:</h4>
<p>Is this at all related to <code>rw</code> thinking that it should rewrite every occurrence of whatever expression it decides to rewrite (e.g., <code>x * y</code>)?</p>



<a name="211018038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211018038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211018038">(Sep 23 2020 at 15:16)</a>:</h4>
<p>No idea what Lean 3 is doing there, but Lean 4 says <a href="/user_uploads/3121/aRWAEvVBdIfozTRc-dTYTMgR/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/aRWAEvVBdIfozTRc-dTYTMgR/image.png" title="image.png"><img src="/user_uploads/3121/aRWAEvVBdIfozTRc-dTYTMgR/image.png"></a></div>



<a name="211018170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211018170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211018170">(Sep 23 2020 at 15:17)</a>:</h4>
<p>I see <code>CoeT</code> is dependent now :P</p>



<a name="211018617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211018617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211018617">(Sep 23 2020 at 15:20)</a>:</h4>
<p>The only non-hacky way to have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">decPropToBool</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">[</span><span class="n">Decidable</span> <span class="n">p</span><span class="o">]</span> <span class="o">:</span> <span class="n">CoeDep</span> <span class="kt">Prop</span> <span class="n">p</span> <span class="n">Bool</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">coe</span> <span class="o">:=</span> <span class="n">decide</span> <span class="n">p</span> <span class="o">}</span>
</code></pre></div>



<a name="211019316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211019316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211019316">(Sep 23 2020 at 15:26)</a>:</h4>
<p><span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="211028655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211028655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211028655">(Sep 23 2020 at 16:33)</a>:</h4>
<p>What's the story behind the change to <code>CamelCase</code>? Is the scope of the change just type classes, or does it extend to lemmas and defs too?</p>



<a name="211031155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VSCode%20underlines%20wrong%20position/near/211031155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VSCode.20underlines.20wrong.20position.html#211031155">(Sep 23 2020 at 16:54)</a>:</h4>
<p>they thought that lean didn't look enough like java</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>