---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html">CI for liquid tensor experiment</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="241739788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/241739788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#241739788">(Jun 07 2021 at 07:41)</a>:</h4>
<p>Hey all, a post about the liquid tensor experiment in #general. I'm looking for some help with CI thingies. We have CI that builds the project, but I would like to have two other things:</p>
<ol>
<li>Setup CI to check that thm95 stays sorry-free <a href="https://github.com/leanprover-community/lean-liquid/issues/37">lean-liquid#37</a></li>
<li>Setup olean caches <a href="https://github.com/leanprover-community/lean-liquid/issues/38">lean-liquid#38</a></li>
</ol>
<p>Regarding (1). I think Mario at some point posted some meta code that checks which axioms are used by some decl. We would want to use something like that.<br>
If you want to help out with one of these, that would be great!</p>



<a name="241831612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/241831612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#241831612">(Jun 07 2021 at 19:56)</a>:</h4>
<p>We clearly also need to enable the <code>unused_arguments</code> linter.</p>



<a name="243665087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/243665087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#243665087">(Jun 23 2021 at 15:03)</a>:</h4>
<p>I'm still looking for some help here. Especially (1) would be great to get working. Because if we start working on the second part of the project, we'll want to add <code>sorry</code> again, and it's great if we can easily certify that this doesn't affect the first milestone.</p>



<a name="243998896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/243998896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#243998896">(Jun 26 2021 at 06:49)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> I'm happy to help with this. Some questions:</p>
<ol>
<li>Is it okay to use the same Azure account for olean storage that mathlib uses? If so, can a maintainer (who is the right person to ping?) please create a <code>lean-liquid</code> container and add the SAS URL as the <code>AZURE_SAS_TOKEN</code> secret to the lean-liquid repository.</li>
<li>The Azure clean up script may need modification. Again, who is the right person to ping?</li>
<li>I need to record the olean cache location in the repository somewhere so that <code>leanproject</code> will know where to look for oleans. I was thinking the URL could go in a <code>.mathlibtools</code> or <code>.leanproject</code> config file in the root of the repository, but open to wherever you or others think would be preferable.</li>
<li>Do you just want the <code>unused_arguments</code> linter or do you want all the linters?</li>
</ol>



<a name="244005487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005487">(Jun 26 2021 at 09:35)</a>:</h4>
<p>The CI part of this is now (mostly) done, subject to changes based on the questions above and anything that comes up in additional testing or review. I also still need to update leanproject.</p>
<p>This is what the build will look like if the proof of Theorem 9.5 depends on something with a sorry: <a href="https://github.com/bentoner/lean-liquid/runs/2920399967?check_suite_focus=true">https://github.com/bentoner/lean-liquid/runs/2920399967?check_suite_focus=true</a></p>
<p>I was thinking that the new CI could run alongside the existing CI for a while, until we're confident that it's robust. If you're okay with temporarily storing oleans in a separate Azure account I made today, I could prepare a pull request for review soon. Switching to the official Azure account later would be easy: you would just need to replace the <code>AZURE_SAS_TOKEN</code> secret, and update the URL in <code>.mathlibtools</code> (or wherever you decide to put it per question 3 above).</p>



<a name="244005633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005633">(Jun 26 2021 at 09:38)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> Thank you so much for helping out!</p>
<p>For (1) and (2), I hope that <span class="user-mention" data-user-id="110596">@Rob Lewis</span> or <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> can help with the Azure token.<br>
For (3), <span class="user-mention" data-user-id="110031">@Patrick Massot</span> what do you think is the best strategy?</p>
<p>For (4), I think <code>unused_arguments</code> would be good to start with. There are lots of missing docstrings, but once we have those, we can add another linter, and gradually move to enabling all linters.</p>



<a name="244005679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005679">(Jun 26 2021 at 09:40)</a>:</h4>
<p>Which oleans are we talking about?</p>



<a name="244005720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005720">(Jun 26 2021 at 09:40)</a>:</h4>
<p>LTE oleans</p>



<a name="244005741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005741">(Jun 26 2021 at 09:41)</a>:</h4>
<p>So you would want <code>leanproject get-cache</code> to also look for remote oleans?</p>



<a name="244005790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005790">(Jun 26 2021 at 09:42)</a>:</h4>
<p>I think LTE is large enough to justify it, and in the next half a year, it might double in size.</p>



<a name="244005925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005925">(Jun 26 2021 at 09:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> oleans for the lean-liquid project. I want to enable leanproject to download cached oleans for projects other than mathlib, without hard coding the URL in the leanproject repository as is done for mathlib.</p>



<a name="244005979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005979">(Jun 26 2021 at 09:46)</a>:</h4>
<p>For the record only a default value of the url is hardcoded in leanproject, you can set it by running <code>leanproject set-url</code> (which simply writes the url in some configuration file)</p>



<a name="244005994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244005994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244005994">(Jun 26 2021 at 09:47)</a>:</h4>
<p>Modifying leanproject to fetch non-mathlib oleans remotely is trivial, I can do that very soon</p>



<a name="244006055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006055">(Jun 26 2021 at 09:48)</a>:</h4>
<p>Ideally <code>leanproject get-cache</code> would fetch caches for the project and all dependencies (whenever they are configured to have remote cache stores)</p>



<a name="244006162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006162">(Jun 26 2021 at 09:51)</a>:</h4>
<p>And what about the proposed setup of Sebastian? I mean the idea that you wouldn't have to download all the oleans every time because it would manage them better. Is it relevant?</p>



<a name="244006288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006288">(Jun 26 2021 at 09:54)</a>:</h4>
<p>Yael, I don't know what you are referring to</p>



<a name="244006445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006445">(Jun 26 2021 at 09:58)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> that's for Lean 4, right?</p>



<a name="244006464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006464">(Jun 26 2021 at 09:59)</a>:</h4>
<p>Sebastian talked about it in the context on Lean 4, but can't we have it for Lean 3? Or does it use something that changed?</p>



<a name="244006567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006567">(Jun 26 2021 at 10:01)</a>:</h4>
<p>I think that requires changes to <code>lean</code>, and setting up a whole nix build system. It doesn't seem to be completely settled down for lean 4 either. So even though it is probably better in the long run, I think it still takes work to get there.</p>



<a name="244006576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006576">(Jun 26 2021 at 10:01)</a>:</h4>
<p>The <code>leanproject</code> approach will probably take Patrick &lt; 30 minutes to implement.</p>



<a name="244006969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244006969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244006969">(Jun 26 2021 at 10:10)</a>:</h4>
<p>Yeah okay!</p>



<a name="244007259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244007259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244007259">(Jun 26 2021 at 10:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="392126">Ben Toner</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244005487">said</a>:</p>
<blockquote>
<p>The CI part of this is now (mostly) done, subject to changes based on the questions above and anything that comes up in additional testing or review. I also still need to update leanproject.</p>
<p>This is what the build will look like if the proof of Theorem 9.5 depends on something with a sorry: <a href="https://github.com/bentoner/lean-liquid/runs/2920399967?check_suite_focus=true">https://github.com/bentoner/lean-liquid/runs/2920399967?check_suite_focus=true</a></p>
<p>I was thinking that the new CI could run alongside the existing CI for a while, until we're confident that it's robust.</p>
</blockquote>
<p>Thanks again for doing this! I would be happy to integrate it into current CI.</p>



<a name="244007274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244007274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244007274">(Jun 26 2021 at 10:19)</a>:</h4>
<p>Would you mind creating a PR for that?</p>



<a name="244007341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244007341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244007341">(Jun 26 2021 at 10:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="392126">Ben Toner</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244005487">said</a>:</p>
<blockquote>
<p>If you're okay with temporarily storing oleans in a separate Azure account I made today, I could prepare a pull request for review soon. Switching to the official Azure account later would be easy: you would just need to replace the <code>AZURE_SAS_TOKEN</code> secret, and update the URL in <code>.mathlibtools</code> (or wherever you decide to put it per question 3 above).</p>
</blockquote>
<p>This still requires modifications to <code>leanproject</code>, right? Or am I misunderstanding something? If it does, I suggest we wait till Patrick updates <code>leanproject</code>.</p>



<a name="244007946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244007946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244007946">(Jun 26 2021 at 10:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244007341">said</a>:</p>
<blockquote>
<p>This still requires modifications to <code>leanproject</code>, right? Or am I misunderstanding something? If it does, I suggest we wait till Patrick updates <code>leanproject</code>.</p>
</blockquote>
<p>We need modifications to <code>leanproject</code> for users to download the oleans, but the CI can start generating and consuming oleans itself before that happens, provided you're okay with using a temporary account.</p>
<p>I'll make a pull request.</p>



<a name="244008489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244008489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244008489">(Jun 26 2021 at 10:40)</a>:</h4>
<p>The cleanest way to go would be to allow something like the following leanpkg.toml:</p>
<div class="codehilite" data-code-language="TOML"><pre><span></span><code><span class="k">[package]</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">"lean-liquid"</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">"0.1"</span>
<span class="n">lean_version</span> <span class="o">=</span> <span class="s">"leanprover-community/lean:3.30.0"</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">"src"</span>
<span class="n">olean_url</span> <span class="o">=</span> <span class="s">"https://foo.com/liquid_oleans/"</span>

<span class="k">[dependencies]</span>
<span class="n">mathlib</span> <span class="o">=</span> <span class="p">{</span><span class="n">git</span> <span class="o">=</span> <span class="s">"https://github.com/leanprover-community/mathlib"</span><span class="p">,</span> <span class="n">rev</span> <span class="o">=</span> <span class="s">"ee4fe7432b1f88e857e4b568f01a6435276a1b96"</span><span class="p">,</span> <span class="n">olean_url</span> <span class="o">=</span> <span class="s">"https://bar.com/fancy_mathlib_oleans/"</span><span class="p">}</span>
<span class="n">lean-gptf</span> <span class="o">=</span> <span class="p">{</span><span class="n">git</span> <span class="o">=</span> <span class="s">"https://github.com/jesse-michael-han/lean-gptf"</span><span class="p">,</span> <span class="n">rev</span> <span class="o">=</span> <span class="s">"3e20785d65604744e9e2dc9d710a695a7355fd2c"</span><span class="p">}</span>
</code></pre></div>
<p>adding optional <code>olean_url</code> field both in the package section and in each dependency. The bad side of this is that <em>current</em> <code>leanproject</code> will wipe up this information, at least while upgrading mathlib. So anyone interested in using a project that uses this new feature would need to upgrade <code>leanproject</code>. That seems ok to me, but I'd like confirmation before coding.</p>



<a name="244008599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244008599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244008599">(Jun 26 2021 at 10:43)</a>:</h4>
<p>Sounds good to me.</p>



<a name="244008674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244008674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244008674">(Jun 26 2021 at 10:45)</a>:</h4>
<p>I don't know how much arbitrary code an olean can run, but maybe a warning to check "do you trust such and such" would be nice for security</p>



<a name="244008680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244008680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244008680">(Jun 26 2021 at 10:45)</a>:</h4>
<p>Just the first time you install a project maybe</p>



<a name="244009065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009065">(Jun 26 2021 at 10:55)</a>:</h4>
<p>Eric, each time you open a Lean file in VSCode you need to trust it. The Lean extension starts running it immediately and can wipe out your hard drive on line one.</p>



<a name="244009507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009507">(Jun 26 2021 at 11:04)</a>:</h4>
<p>New versions of VSCode seem to ask first now though right?</p>



<a name="244009515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009515">(Jun 26 2021 at 11:05)</a>:</h4>
<p>Mine always asks if I trust the Lean file's author</p>



<a name="244009537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009537">(Jun 26 2021 at 11:05)</a>:</h4>
<p>Yeah that's a new VSCode thing though, separate from Lean</p>



<a name="244009657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009657">(Jun 26 2021 at 11:08)</a>:</h4>
<p>Returning to the actual topic of this discussion, the situation is more complicated than what I described. Actually <code>leanpkg</code> will also interfere. It probably means it's time to finally get rid of any dependency of <code>leanproject</code> on <code>leanpkg</code>. But it means more work so don't hold you breath.</p>



<a name="244009746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009746">(Jun 26 2021 at 11:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Would it be possible to have a short shell-script specifically for LTE that does</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">set</span> <span class="n">the</span> <span class="n">leanproject</span> <span class="n">remote</span> <span class="n">cache</span> <span class="n">location</span> <span class="n">to</span> <span class="n">the</span> <span class="n">LTE</span> <span class="n">store</span>
<span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span>
<span class="n">set</span> <span class="n">the</span> <span class="n">leanproject</span> <span class="n">remote</span> <span class="n">cache</span> <span class="n">back</span> <span class="n">to</span> <span class="n">the</span> <span class="n">mathlib</span> <span class="n">default</span>
</code></pre></div>



<a name="244009748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009748">(Jun 26 2021 at 11:11)</a>:</h4>
<p>I think that would be good enough for LTE.</p>



<a name="244009821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244009821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244009821">(Jun 26 2021 at 11:13)</a>:</h4>
<p>That won't work, remote olean are fetched only for mathlib</p>



<a name="244010581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244010581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244010581">(Jun 26 2021 at 11:32)</a>:</h4>
<p>I've made a pull request for a part that could be broken off, the script to check that Theorem 9.5 remains sorry free <a href="https://github.com/leanprover-community/lean-liquid/pull/44">https://github.com/leanprover-community/lean-liquid/pull/44</a> .</p>
<p>I've updated the CI code to look for the <code>olean_url</code> field in <code>package.toml</code> per <span class="user-mention" data-user-id="110031">@Patrick Massot</span>'s proposal, but need to test further before making the (bigger) pull request for that.</p>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> I'm happy to help with changes to <code>leanpkg</code> and <code>leanproject</code> if you would like.</p>



<a name="244011235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244011235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244011235">(Jun 26 2021 at 11:50)</a>:</h4>
<p>Ben, if you have time to work on removing every call to <code>leanpkg</code> from <code>leanproject</code> that would be great! The game is to search for <code>'leanpkg'</code> in <a href="https://github.com/leanprover-community/mathlib-tools/blob/master/mathlibtools/lib.py">lib.py</a>, figure out what we are asking it to do, maybe reading the <a href="https://github.com/leanprover-community/lean/tree/master/leanpkg/leanpkg">leanpkg source code</a>, and redo it in python. Globally that would make the whole thing a lot more predictable.</p>



<a name="244011512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244011512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244011512">(Jun 26 2021 at 11:59)</a>:</h4>
<p>Okay cool, I'll take a look at <code>leanproject</code> tomorrow.</p>
<p>I made a pull request for the CI changes here: <a href="https://github.com/leanprover-community/lean-liquid/pull/45">https://github.com/leanprover-community/lean-liquid/pull/45</a> . Do note that I'm on Australian time, so it might be better to not merge today as I won't be around much longer if there's any breakage.</p>



<a name="244011945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244011945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244011945">(Jun 26 2021 at 12:08)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> Thanks a lot!</p>



<a name="244014690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244014690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244014690">(Jun 26 2021 at 13:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244005633">said</a>:</p>
<blockquote>
<p>For (1) and (2), I hope that <span class="user-mention silent" data-user-id="110596">Rob Lewis</span> or <span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> can help with the Azure token.</p>
</blockquote>
<p>(I don't have access to the Azure token; I think Rob has to do this.)</p>



<a name="244051380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244051380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244051380">(Jun 27 2021 at 05:50)</a>:</h4>
<p>Status: have linting working. Need to clean up and finish testing then will add to pull request. Haven't looked at <code>leanproject</code> yet.</p>



<a name="244067978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244067978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244067978">(Jun 27 2021 at 13:49)</a>:</h4>
<p>Pull request for Theorem 9.5 sorry-free check: <a href="https://github.com/leanprover-community/lean-liquid/pull/44">https://github.com/leanprover-community/lean-liquid/pull/44</a></p>
<p>Main pull request: <a href="https://github.com/leanprover-community/lean-liquid/pull/45">https://github.com/leanprover-community/lean-liquid/pull/45</a></p>
<ul>
<li>Can be merged before Azure secret is set and everything except Azure upload should still work</li>
<li>Incorporates previous pull request</li>
</ul>
<p>Pull request for associated changes to <code>leanpkg</code>: <a href="https://github.com/leanprover-community/lean/pull/586">https://github.com/leanprover-community/lean/pull/586</a></p>
<ul>
<li>The CI changes can land before this does -- like the required <code>leanproject</code> changes, this is needed to make it easy for users to fetch the LTE oleans but doesn't block the CI changes.</li>
</ul>
<p>I had a quick look at <code>leanproject</code> but I didn't do anything yet -- happy to take care of this but it'll need to be a project for say next weekend.</p>



<a name="244068574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244068574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244068574">(Jun 27 2021 at 14:04)</a>:</h4>
<p>Thank you very much!</p>



<a name="244070408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244070408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244070408">(Jun 27 2021 at 14:56)</a>:</h4>
<p>My suggestion was not to modify <code>leanpkg</code>, it was to stop using it in <code>leanproject</code>. If you want to modify <code>leanpkg</code>, it would be much nicer to teach it to ignore every unexpected key, simply copying it over.</p>



<a name="244070421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244070421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244070421">(Jun 27 2021 at 14:57)</a>:</h4>
<p>Let me ping <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> to make sure he sees this before looking at this PR.</p>



<a name="244071622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244071622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244071622">(Jun 27 2021 at 15:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Apologies that I mischaracterised what you suggested. I will change leanproject to stop using leanpkg but it also seemed important to make leanpkg not delete the new key in case some users use leanpkg directly instead of leanproject. (I originally suggested putting the URL in a new <code>.leanproject</code> file to avoid needing to make changes to leanpkg.)</p>
<p>I agree it would be nicer to teach leanpkg to ignore every unexpected key, but on the flip side there is a benefit to having a schema, so I thought that I’d start with the more minimal change. Happy to proceed either way though.</p>
<p>Maybe we get the best of both worlds if we add a <code>[leanproject]</code> section and make leanpkg preserve everything in that.</p>



<a name="244072767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244072767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244072767">(Jun 27 2021 at 15:57)</a>:</h4>
<p>With regard to the leanpkg pull request, I also realise that I’ve failed to allow for the optional <code>olean_url</code> field in each dependency. I’ll hold off fixing this though until there is consensus about how to proceed.</p>



<a name="244082435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244082435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244082435">(Jun 27 2021 at 20:05)</a>:</h4>
<p>I only wanted to avoid a proliferation of configuration files. It's already confusing to have three commands (<code>lean</code>, <code>leanpkg</code> and <code>leanproject</code>). But I don't deeply care.</p>



<a name="244163979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244163979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244163979">(Jun 28 2021 at 15:41)</a>:</h4>
<p>Okay great, it worked!</p>



<a name="244164474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244164474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244164474">(Jun 28 2021 at 15:45)</a>:</h4>
<p>One gotcha with the current state to be aware of: each time you or the bot updates mathlib, <code>leanproject</code>/<code>leanpkg</code> will delete the <code>olean_url</code> field in <code>leanpkg.toml</code> (until I/we fix it). After you have an official olean URL, we should record it on this line <a href="https://github.com/leanprover-community/lean-liquid/blob/20a63c58546989e62bae1c87ea71f984746ff3a0/scripts/fetch_olean_cache.sh#L9">https://github.com/leanprover-community/lean-liquid/blob/20a63c58546989e62bae1c87ea71f984746ff3a0/scripts/fetch_olean_cache.sh#L9</a> -- then it won't matter that the field in <code>leanpkg.toml</code> gets deleted.</p>



<a name="244165916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244165916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244165916">(Jun 28 2021 at 15:54)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> do you think we can get <code>nolints.txt</code> working for this repository?</p>



<a name="244165946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244165946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244165946">(Jun 28 2021 at 15:54)</a>:</h4>
<p>so that we can gradually fix all the linting errors?</p>



<a name="244166365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244166365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244166365">(Jun 28 2021 at 15:57)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>  Is the idea that that would let you turn on all the linters or is it that you need to permanently suppress certain linting errors that you can't do with <code>nolint</code> attributes?</p>



<a name="244167741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244167741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244167741">(Jun 28 2021 at 16:05)</a>:</h4>
<p>Well, there's still about 50 (or so) unused arguments that need to be fixed. So either we disable the linter till we've fixed all of them, or we have a week full of <span aria-label="cross mark" class="emoji emoji-274c" role="img" title="cross mark">:cross_mark:</span>'s, or we try to do some <code>nolints.txt</code> thingy.</p>



<a name="244167772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244167772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244167772">(Jun 28 2021 at 16:05)</a>:</h4>
<p>And indeed, with the <code>nolints</code> thing, we could even enable a bunch of other linters as well.</p>



<a name="244168202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244168202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244168202">(Jun 28 2021 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>  I can do a <code>nolints.txt</code> thing but it's not trivial (at least at my current level of lean ability). Would it work instead to just make the linting always be green in CI? That would be a one-line change.</p>



<a name="244168261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244168261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244168261">(Jun 28 2021 at 16:09)</a>:</h4>
<p>Let's do that for now.</p>



<a name="244168344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244168344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244168344">(Jun 28 2021 at 16:10)</a>:</h4>
<p>Then someone else can chime in and create the <code>nolints.txt</code> at a later point.</p>



<a name="244170120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244170120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244170120">(Jun 28 2021 at 16:24)</a>:</h4>
<p>I can do the <code>nolints.txt</code> change, just not on a weekday. The thing that makes it nontrivial (for me, at least) is that I think some linters might need to run on the combination of lean-liquid and mathlib(?) and the respective <code>nolints.txt</code> files need to be merged.</p>



<a name="244171123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244171123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244171123">(Jun 28 2021 at 16:32)</a>:</h4>
<p>Hmm, good point. I guess this is things like the simp normal form linter?</p>



<a name="244171166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244171166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244171166">(Jun 28 2021 at 16:32)</a>:</h4>
<p>Actually, I think I would rather not run linters that need to run on all of mathlib as well.</p>



<a name="244171190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244171190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244171190">(Jun 28 2021 at 16:33)</a>:</h4>
<p>Anyway, this isn't very urgent.</p>



<a name="244171204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244171204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244171204">(Jun 28 2021 at 16:33)</a>:</h4>
<p>So take your time</p>



<a name="244238851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244238851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244238851">(Jun 29 2021 at 06:40)</a>:</h4>
<p>Hmm, the auto-update bot already removed the <code>olean_url</code> field from the <code>.toml</code>....</p>



<a name="244240961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244240961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244240961">(Jun 29 2021 at 07:08)</a>:</h4>
<p>That's okay - just leave it deleted next time. It's there so users can download the oleans, but they won't be able to do that until <code>leanproject</code> is updated, and <code>leanproject</code> will keep deleting this field anyway until it's updated. Moreover the CI can get the oleans without that field being present (see <a href="https://github.com/leanprover-community/lean-liquid/commit/664ddddbd178bc8ce7960103fa728899dedc9691">https://github.com/leanprover-community/lean-liquid/commit/664ddddbd178bc8ce7960103fa728899dedc9691</a> ).</p>



<a name="244321277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321277">(Jun 29 2021 at 17:56)</a>:</h4>
<p>Sorry for taking so long to look at the Azure side of this. I have a minor concern: the Azure cleanup script periodically deletes caches unless they come from mathlib master or the head commit of a mathlib branch</p>



<a name="244321374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321374">(Jun 29 2021 at 17:57)</a>:</h4>
<p>I could whitelist the LTE too, but maybe it would be better to put them in a subdirectory of the Azure blob</p>



<a name="244321381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321381">(Jun 29 2021 at 17:57)</a>:</h4>
<p>If it can save LTE cache that is less than 3 days old, that would be good enough, I think.</p>



<a name="244321522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321522">(Jun 29 2021 at 17:58)</a>:</h4>
<p>Do you want only master caches saved, or branches too?</p>



<a name="244321690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321690">(Jun 29 2021 at 17:59)</a>:</h4>
<p>If it works with whatever leanpkg changes might be planned, using a <code>lean-liquid</code> subdirectory seems cleaner</p>



<a name="244321742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321742">(Jun 29 2021 at 17:59)</a>:</h4>
<p>Then there's a uniform pattern for any leanprover-community projects that we want to add caches to</p>



<a name="244321823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244321823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244321823">(Jun 29 2021 at 18:00)</a>:</h4>
<p>And the cleanup script can detect which repo the caches come from by the directory name</p>



<a name="244322122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244322122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244322122">(Jun 29 2021 at 18:02)</a>:</h4>
<p><code>master</code> is sufficient</p>



<a name="244322213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244322213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244322213">(Jun 29 2021 at 18:02)</a>:</h4>
<p>It's just, if you wake up in the morning and the auto-mathlib-bumper or some other person has bumped mathlib, it would be really nice to have oleans within 5s instead of 20 minutes.</p>



<a name="244322238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244322238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244322238">(Jun 29 2021 at 18:02)</a>:</h4>
<p>That's probably going to be the main use case.</p>



<a name="244323054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244323054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244323054">(Jun 29 2021 at 18:07)</a>:</h4>
<p>The script at <a href="https://github.com/leanprover-community/lean-liquid/blob/master/.github/workflows/build.yml">https://github.com/leanprover-community/lean-liquid/blob/master/.github/workflows/build.yml</a> is going to upload oleans for every branch</p>



<a name="244323418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244323418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244323418">(Jun 29 2021 at 18:10)</a>:</h4>
<p>The cleanup script only has access to the commit hash. So there's no way for it to tell where a cache comes from without looking for its hash in all the possible sources</p>



<a name="244323655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244323655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244323655">(Jun 29 2021 at 18:11)</a>:</h4>
<p>Putting these caches in a <code>lean-liquid</code> subdirectory will make it easier to clean them up according to whatever rules we want</p>



<a name="244323709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244323709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244323709">(Jun 29 2021 at 18:12)</a>:</h4>
<p>But also if you don't want to store branch caches at all we shouldn't upload them in the first place</p>



<a name="244324894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244324894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244324894">(Jun 29 2021 at 18:20)</a>:</h4>
<p>I don't care too much about branches. Frankly they aren't used too much.</p>



<a name="244324914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244324914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244324914">(Jun 29 2021 at 18:20)</a>:</h4>
<p>So I guess there is no harm in uploading caches for branches as well.</p>



<a name="244324940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244324940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244324940">(Jun 29 2021 at 18:20)</a>:</h4>
<p>If that makes things easier for you (-;</p>



<a name="244373509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244373509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244373509">(Jun 30 2021 at 03:23)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110596">@Rob Lewis</span> Thanks for doing this. Using a subdirectory is a good idea.</p>
<p>For projects other than <code>mathlib</code> it seems less necessary to keep old versions around, so instead of a script, you could use lifecycle rules to auto-delete everything after X days. (On the other hand, for projects like <code>lean-gptf</code> that are intended to be used as dependencies, the current clean-up script's logic is more correct, but this is still something of a theoretical issue as <code>lean-gptf</code> is fast to build.)</p>



<a name="244380837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244380837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244380837">(Jun 30 2021 at 06:05)</a>:</h4>
<p>Another question: can we configure LTE so that it cancels a build if a new commit has been pushed to the same branch?</p>



<a name="244380899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244380899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244380899">(Jun 30 2021 at 06:06)</a>:</h4>
<p>Because LTE might end up eating precious CI time otherwise. (I just understood that it shares CI time with all other repos in the leanprover-community organization.)</p>



<a name="244380921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244380921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244380921">(Jun 30 2021 at 06:06)</a>:</h4>
<p>We might even consider only running CI for master. People can test build their branches locally when needed.</p>



<a name="244381044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244381044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244381044">(Jun 30 2021 at 06:09)</a>:</h4>
<p>If I'm reading this right, it looks like runs are canceled on branches other than <code>master</code>: <a href="https://github.com/leanprover-community/lean-liquid/blob/master/.github/workflows/build.yml#L21">https://github.com/leanprover-community/lean-liquid/blob/master/.github/workflows/build.yml#L21</a></p>



<a name="244381160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244381160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244381160">(Jun 30 2021 at 06:10)</a>:</h4>
<p>Ok, so by removing L25, we get the same behaviour on master. I think that's worth doing. A push to master on LTE happens quite often.</p>



<a name="244381263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244381263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244381263">(Jun 30 2021 at 06:12)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> !</p>



<a name="244382126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382126">(Jun 30 2021 at 06:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244381160">said</a>:</p>
<blockquote>
<p>Ok, so by removing L25, we get the same behaviour on master. I think that's worth doing. A push to master on LTE happens quite often.</p>
</blockquote>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>  Okay, sorry, I guessed wrong on that choice. I figured that you would want a build for each push to master so we know which push to blame for e.g. linting regressions, so I disabled cancelling there. Note that build times will go down from 25 min to ~2.5 min once the olean cache is in place.</p>



<a name="244382151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382151">(Jun 30 2021 at 06:27)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> no worries!</p>



<a name="244382218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382218">(Jun 30 2021 at 06:29)</a>:</h4>
<p>I don't care too much about the occasional regression. We'll probably find out soon enough.</p>



<a name="244382233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382233">(Jun 30 2021 at 06:29)</a>:</h4>
<p>I agree that maybe we can re-enable it when the olean cache is working.</p>



<a name="244382245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382245">(Jun 30 2021 at 06:29)</a>:</h4>
<p>But for now, I want to make sure that mathlib PRs get the CI time that they deserve (-;</p>



<a name="244382721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382721">(Jun 30 2021 at 06:37)</a>:</h4>
<p>I wasn't properly accounting for this constraint. I'll make a pull request to disable the "old" CI then so we're not building everything twice. I was thinking you could run them both in parallel, but maybe you'd prefer to turn off the "old" one, if I make it easy to revert to it if the new one breaks for some reason.</p>



<a name="244382785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382785">(Jun 30 2021 at 06:38)</a>:</h4>
<p>I just commented out L25. Wouldn't that be enough?</p>



<a name="244382813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382813">(Jun 30 2021 at 06:39)</a>:</h4>
<p>"old" CI as in the CI that was in place before last weekend</p>



<a name="244382823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244382823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244382823">(Jun 30 2021 at 06:39)</a>:</h4>
<p>aah, yes, that is a good idea</p>



<a name="244453022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244453022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244453022">(Jun 30 2021 at 16:44)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> <a href="https://github.com/leanprover-community/azure-scripts/issues/9">azure-scripts#9</a> and <a href="https://github.com/leanprover-community/lean-liquid/issues/48">lean-liquid#48</a> together should do most of this. Archives will get uploaded only from master to a lean-liquid subdirectory, and cleaned when they're 3 days old. The cleanup conditions are easy to change.</p>



<a name="244453059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244453059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244453059">(Jun 30 2021 at 16:44)</a>:</h4>
<p>I haven't added the Azure token to lean-liquid yet. Worth having more eyes look over the scripts before they accidentally make a mess.</p>



<a name="244453099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244453099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244453099">(Jun 30 2021 at 16:45)</a>:</h4>
<p>I also don't know it/what changes are required for retrieving the caches, since the url now has a <code>lean-liquid</code> in it.</p>



<a name="244453655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244453655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244453655">(Jun 30 2021 at 16:49)</a>:</h4>
<p>Will the <code>HEAD</code> commit of <code>lean-liquid</code> <code>master</code> get deleted if there are no commits within 3 days?</p>



<a name="244457466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244457466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244457466">(Jun 30 2021 at 17:13)</a>:</h4>
<p>Not anymore!</p>



<a name="244457590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244457590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244457590">(Jun 30 2021 at 17:14)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110596">@Rob Lewis</span>, thanks, that's great! I didn't realize the script was public or I would have done something for you to review. I'll fix retrieving the cache in <code>lean-liquid</code>.</p>
<p>I know my timing is off, but can I suggest a period longer than 3 days, e.g., 30 days and saving branch HEADs too? I think the storage cost would remain under a dollar per month -- looks like you fixed this in a different way though while I was typing this...</p>



<a name="244457907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244457907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244457907">(Jun 30 2021 at 17:15)</a>:</h4>
<p>I based that choice off of this:<br>
<span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244321381">said</a>:</p>
<blockquote>
<p>If it can save LTE cache that is less than 3 days old, that would be good enough, I think.</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244322122">said</a>:</p>
<blockquote>
<p><code>master</code> is sufficient</p>
</blockquote>
<p>So right now it always has the latest master commit, and any others less than 3 days old.</p>



<a name="244457972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244457972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244457972">(Jun 30 2021 at 17:16)</a>:</h4>
<p>The storage costs for this will be negligible compared to mathlib</p>



<a name="244458033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244458033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244458033">(Jun 30 2021 at 17:16)</a>:</h4>
<p>And it's effectively free anyway</p>



<a name="244458086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244458086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244458086">(Jun 30 2021 at 17:16)</a>:</h4>
<p>The only reason not to store more is aesthetic, if Johan says it'll never be used there's no point keeping it around.</p>



<a name="244463763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244463763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244463763">(Jun 30 2021 at 17:58)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> Thanks again for making all this happen.</p>
<p>I updated the URL for retrieving the cache - not entirely sure that the new one's correct but the existing one was already wrong, so I can't have made things worse.</p>



<a name="244464778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244464778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244464778">(Jun 30 2021 at 18:06)</a>:</h4>
<p>That URL looks right</p>



<a name="244465131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244465131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244465131">(Jun 30 2021 at 18:08)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> if you're happy with these changes, let's merge the two relevant PRs and I'll add the token as a secret</p>



<a name="244465290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244465290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244465290">(Jun 30 2021 at 18:09)</a>:</h4>
<p>What's the story with retrieving these caches? Is it only for CI? Or is there a leanproject hook already?</p>



<a name="244465450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244465450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244465450">(Jun 30 2021 at 18:10)</a>:</h4>
<p>I guess you could <code>leanproject set-url</code> to the <code>lean-liquid</code> subdirectory on Azure and then <code>leanproject get-cache</code> would work, right?</p>



<a name="244465515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244465515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244465515">(Jun 30 2021 at 18:11)</a>:</h4>
<p>Or <code>--from-url</code> or whatever</p>



<a name="244465575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244465575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244465575">(Jun 30 2021 at 18:12)</a>:</h4>
<p>I think Ben and/or Patrick are planning to update/extend <code>leanproject</code> so that this will be easy</p>



<a name="244465648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244465648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244465648">(Jun 30 2021 at 18:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> Please go ahead and merge the PRs! Thanks a lot for helping out</p>



<a name="244470644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244470644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244470644">(Jun 30 2021 at 18:49)</a>:</h4>
<p>So here's a 26 second build: <a href="https://github.com/leanprover-community/lean-liquid/runs/2955504763">https://github.com/leanprover-community/lean-liquid/runs/2955504763</a></p>



<a name="244470677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244470677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244470677">(Jun 30 2021 at 18:49)</a>:</h4>
<p>I couldn't get it to work with <code>leanproject --from-url</code> or <code>leanproject set-url</code></p>



<a name="244470781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244470781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244470781">(Jun 30 2021 at 18:50)</a>:</h4>
<p>Not sure what the trouble is</p>



<a name="244471610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244471610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244471610">(Jun 30 2021 at 18:56)</a>:</h4>
<p>For the time being, something like this should replicate it.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wget https://oleanstorage.azureedge.net/mathlib/lean-liquid/<span class="s2">"</span><span class="k">$(</span>git rev-parse HEAD<span class="k">)</span><span class="s2">"</span>.tar.xz <span class="o">&amp;&amp;</span> tar -xf <span class="s2">"</span><span class="k">$(</span>git rev-parse HEAD<span class="k">)</span><span class="s2">"</span>.tar.xz
</code></pre></div>



<a name="244518380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244518380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244518380">(Jul 01 2021 at 04:53)</a>:</h4>
<p>I just tried that <code>wget ...</code> but I got a 404 not found error</p>



<a name="244526526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244526526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244526526">(Jul 01 2021 at 07:06)</a>:</h4>
<p>It's because the <code>upgrade_lean</code> workflow was the last thing commit to master and it doesn't store oleans... will fix within a couple of days.</p>



<a name="244528619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244528619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244528619">(Jul 01 2021 at 07:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> the <code>leanproject</code> commands you're trying are not supposed to be working yet.</p>
<p>Here's what remains, according to my understanding:</p>
<ol>
<li>Enable <code>nolints.txt</code> for <code>lean-liquid</code>. We only want to lint <code>lean-liquid</code> code. Turn on more linters. Enable the <code>nolints.txt</code> unnecessary-line-removing workflow.</li>
<li>Make it so oleans are generated after the <code>upgrade-lean</code> workflow runs.</li>
<li>Update <code>leanproject</code>.<br>
a. Make it so <code>leanproject</code> doesn't depend on <code>leanpkg</code>.<br>
b. Make it so <code>leanproject</code> can do everything <code>leanpkg</code> does.<br>
c. Update <code>leanproject</code> to <code>get-cache</code> from the URL stored in <code>leanpkg.toml</code></li>
</ol>
<p>We decided not to update <code>leanpkg</code>.</p>
<p>My plan is to do 1 and 2 this weekend; the <code>leanproject</code> changes I'm also happy to do, hopefully this weekend, but no guarantees, and also allow time for some back-and-forth with the <code>leanproject</code> maintainers, as necessary.</p>



<a name="244575724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244575724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244575724">(Jul 01 2021 at 14:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="392126">Ben Toner</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244526526">said</a>:</p>
<blockquote>
<p>It's because the <code>upgrade_lean</code> workflow was the last thing commit to master and it doesn't store oleans... will fix within a couple of days.</p>
</blockquote>
<p>You mean the latest commit at the time came from CI and Github doesn't run actions on commits made by other actions?</p>



<a name="244575779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244575779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244575779">(Jul 01 2021 at 14:33)</a>:</h4>
<p>I think that's what happened anyway</p>



<a name="244575844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244575844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244575844">(Jul 01 2021 at 14:33)</a>:</h4>
<p>A general question about lean CI: mathlib uses <code>lean</code> directly in the action, but <a href="https://github.com/leanprover-contrib/lean-build-action">https://github.com/leanprover-contrib/lean-build-action</a> uses a docker container. Is there a reason that the latter uses a container?</p>



<a name="244576301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244576301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244576301">(Jul 01 2021 at 14:36)</a>:</h4>
<p>Probably because I was new to writing actions at that point and was just copying something else that did things like that, I don't really remember</p>



<a name="244576386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244576386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244576386">(Jul 01 2021 at 14:36)</a>:</h4>
<p>I ask only because I was looking at moving the problem matcher to that repo, but it looks quite different to the one used by mathlib and presumably the stuff being done to lean-liquid</p>



<a name="244576897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244576897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244576897">(Jul 01 2021 at 14:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244575724">said</a>:</p>
<blockquote>
<p>You mean the latest commit at the time came from CI and Github doesn't run actions on commits made by other actions?</p>
</blockquote>
<p>I think it's that currently the "continuous integration" workflow that uploads to Azure triggers on push events, and the "upgrade lean" workflow doesn't generate a push event. Will be easy to fix... I was just wanting to think about the best way to do it a bit first.</p>



<a name="244576921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244576921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244576921">(Jul 01 2021 at 14:40)</a>:</h4>
<p>The build action is supposed to be just a drop in thing, mathlib and lean-liquid do more complicated stuff so I guess it makes sense they call lean manually. Also mathlib's CI way predates the build action</p>



<a name="244576946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244576946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244576946">(Jul 01 2021 at 14:40)</a>:</h4>
<p>But I'm also very sure that the build action isn't optimal</p>



<a name="244867184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244867184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244867184">(Jul 04 2021 at 16:38)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110596">@Rob Lewis</span>, can you please help me with another thing? Not urgent.</p>
<p>The reason the "bump mathlib" action doesn't trigger the CI build is as described by you here: <a href="https://github.com/leanprover-contrib/lean-upgrade-action/blame/master/README.md#L76">https://github.com/leanprover-contrib/lean-upgrade-action/blame/master/README.md#L76</a>.</p>
<p>The best way to fix this is to use a personal access token. Can you please create one, say from the <code>leanprover-community-bot</code> account or some other suitable account?</p>
<p>Steps (not so much for you but to document):</p>
<ol>
<li>Go to <a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a> and generate a new token with the <code>public_repo</code> scope.</li>
<li>Add token as the <code>PA_TOKEN</code> secret in the <code>lean-liquid</code> repo.</li>
<li>The account also needs permission to push to <code>lean-liquid</code> master.</li>
</ol>
<p>After that is in place one of us can add this to master: <a href="https://github.com/leanprover-community/lean-liquid/commit/c8608fc9e40c2d487be54657e7280d6fd31c351f">https://github.com/leanprover-community/lean-liquid/commit/c8608fc9e40c2d487be54657e7280d6fd31c351f</a> . (I also need the token for the <code>nolints.txt</code> workflow.) Thanks!</p>



<a name="244868401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244868401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244868401">(Jul 04 2021 at 17:09)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> I think I've set things up the way you asked. Let me know if you need anything else!</p>



<a name="244897519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244897519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244897519">(Jul 05 2021 at 06:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment/near/244471610">said</a>:</p>
<blockquote>
<p>For the time being, something like this should replicate it.</p>
<p><div class="codehilite" data-code-language="Bash"><pre><span></span><code>wget https://oleanstorage.azureedge.net/mathlib/lean-liquid/<span class="s2">"</span><span class="k">$(</span>git rev-parse HEAD<span class="k">)</span><span class="s2">"</span>.tar.xz <span class="o">&amp;&amp;</span> tar -xf <span class="s2">"</span><span class="k">$(</span>git rev-parse HEAD<span class="k">)</span><span class="s2">"</span>.tar.xz
</code></pre></div><br>
</p>
</blockquote>
<p>I just tried this <code>wget</code> line again, and it works great! Only thing I needed to compile was the gptf dependency.</p>



<a name="244897530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/244897530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#244897530">(Jul 05 2021 at 06:06)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> <span class="user-mention" data-user-id="110596">@Rob Lewis</span> Thank you so much for making this possible!</p>



<a name="245026576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/245026576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#245026576">(Jul 06 2021 at 11:45)</a>:</h4>
<p>Linting:</p>
<ul>
<li>More linters are now enabled. You can change which linters are enabled by editing <a href="https://github.com/leanprover-community/lean-liquid/blob/5a4512db1e8538c48d5636ede98cc15188aa5af7/scripts/lint_project.lean#L94">this</a> list.</li>
<li>There is now a <code>nolints.txt</code> file. It is kept updated each night.</li>
<li>Commits that cause new linting errors will now cause the build to fail. You can change this behaviour <a href="https://github.com/leanprover-community/lean-liquid/blob/5a4512db1e8538c48d5636ede98cc15188aa5af7/.github/workflows/build.yml#L126">here</a>.</li>
<li>If a commit results in a new linting error, as an alternative to fixing it you can manually trigger the <a href="https://github.com/leanprover-community/lean-liquid/actions/workflows/nolints.yml">workflow</a> that updates <code>nolints.txt</code>.</li>
</ul>
<p>The <code>olean</code> cache:</p>
<ul>
<li>I've added a script <code>scripts/get-cache.sh</code> which does what it is intended that <code>leanproject get-cache</code> will do, in order to make the <code>leanproject</code> work less pressing:</li>
</ul>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code> ./scripts/get-cache.sh
Looking for local mathlib oleans
Found local mathlib oleans
Trying to download project cache
Found oleans at https://oleanstorage.azureedge.net/mathlib/lean-liquid/
Extracted oleans into src and deleted archive
</code></pre></div>



<a name="253743877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/253743877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#253743877">(Sep 17 2021 at 13:44)</a>:</h4>
<p>Note that with recent changes to <code>mathlibtools/master</code> there's now a clear spot to fill in for other olean cache servers:</p>
<p><a href="https://github.com/leanprover-community/mathlib-tools/blob/111e0dc7b0be85d418326cb002b0c0c473803cd3/mathlibtools/lib.py#L627-L633">https://github.com/leanprover-community/mathlib-tools/blob/111e0dc7b0be85d418326cb002b0c0c473803cd3/mathlibtools/lib.py#L627-L633</a></p>
<p>I think there's probably also some cleanup to do regarding whether <code>self.cache</code> refers to the mathlib cache url (when mathlib is a dependency) or the cache url of the active lean project.</p>
<p>Regarding <code>leanpkg</code>; can we just create a separate <code>leanpkg-cache.toml</code> file that contains the cache URLs, then we don't have to worry about the current toml being overwritten?</p>



<a name="257179481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257179481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257179481">(Oct 12 2021 at 10:17)</a>:</h4>
<p>I admit I didn't read the whole conversation, so the answer can very well be already here: is there a way to fetch the olean for the LTE using <code>leanproject</code> or something else? On my machine it doesn't seem to do it automatically.</p>



<a name="257179690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257179690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257179690">(Oct 12 2021 at 10:19)</a>:</h4>
<p><code>./scripts/get-cache.sh</code> in the LTE directory will get you some caches.</p>



<a name="257179785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257179785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257179785">(Oct 12 2021 at 10:20)</a>:</h4>
<p>I think this uses <code>leanproject</code> under the hood, and at some point <code>leanproject</code> will do everything.</p>



<a name="257180001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257180001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257180001">(Oct 12 2021 at 10:22)</a>:</h4>
<p>It doesn't use leanproject under the hood</p>



<a name="257180095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257180095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257180095">(Oct 12 2021 at 10:23)</a>:</h4>
<p>(which means it doesn't backtrack to find older caches)</p>



<a name="257180859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257180859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257180859">(Oct 12 2021 at 10:29)</a>:</h4>
<p>Aah, it only uses <code>leanproject</code> to get caches for mathlib, and does something custom for LTE</p>



<a name="257180990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257180990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257180990">(Oct 12 2021 at 10:30)</a>:</h4>
<p>there is also <code>./scripts/fetch_olean_cache.sh</code> which is a longer script.</p>



<a name="257181022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257181022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257181022">(Oct 12 2021 at 10:31)</a>:</h4>
<p>It would be good if this functionality gets integrated into LP at some point</p>



<a name="257181560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257181560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257181560">(Oct 12 2021 at 10:36)</a>:</h4>
<p>We can maybe add this script to the readme file in LTE?</p>



<a name="257181576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257181576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257181576">(Oct 12 2021 at 10:36)</a>:</h4>
<p>Sure, go ahead!</p>



<a name="257181604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI%20for%20liquid%20tensor%20experiment/near/257181604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/CI.20for.20liquid.20tensor.20experiment.html#257181604">(Oct 12 2021 at 10:36)</a>:</h4>
<p>Lunch first of all <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>