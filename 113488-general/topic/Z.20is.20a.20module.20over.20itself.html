---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html">Z is a module over itself</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="207182363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182363">(Aug 17 2020 at 18:51)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">synthesized</span> <span class="n">type</span> <span class="n">class</span> <span class="kn">instance</span> <span class="n">is</span> <span class="n">not</span> <span class="n">definitionally</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">expression</span> <span class="n">inferred</span> <span class="k">by</span> <span class="n">typing</span> <span class="n">rules</span><span class="o">,</span> <span class="n">synthesized</span>
  <span class="n">add_comm_group</span><span class="bp">.</span><span class="n">int_module</span>
<span class="n">inferred</span>
  <span class="n">semiring</span><span class="bp">.</span><span class="n">to_semimodule</span>
</code></pre></div>



<a name="207182460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182460">(Aug 17 2020 at 18:51)</a>:</h4>
<p>The mere fact that this diamond occurs is a proof that <code>module int int</code> is a subsingleton...</p>



<a name="207182589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182589">(Aug 17 2020 at 18:52)</a>:</h4>
<p>sigh</p>
<p>pencil-and-paper maths has an unfair advantage</p>



<a name="207182700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182700">(Aug 17 2020 at 18:53)</a>:</h4>
<p>Fun story: this was the first Lean error I ever encountered. I was close to quitting on day 1.</p>



<a name="207182776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182776">(Aug 17 2020 at 18:53)</a>:</h4>
<p>I'm really glad you didn't quit!</p>



<a name="207182911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182911">(Aug 17 2020 at 18:55)</a>:</h4>
<p>Perhaps you can use <code>convert</code> creatively to have it apply the subsingleton instance we have for <code>module Z</code>?</p>



<a name="207182955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207182955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207182955">(Aug 17 2020 at 18:55)</a>:</h4>
<p>Hmm... but that doesn't scale</p>



<a name="207183238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207183238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207183238">(Aug 17 2020 at 18:57)</a>:</h4>
<p><span class="user-mention" data-user-id="300245">@Filippo A. E. Nuccio</span> In case you want an example of multiple instances of a class leading to headaches: voila <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="207183303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207183303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207183303">(Aug 17 2020 at 18:57)</a>:</h4>
<p>And the silly thing is: the two instances are provably equal, but not equal by definition. So lean complains.</p>



<a name="207186650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207186650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207186650">(Aug 17 2020 at 19:26)</a>:</h4>
<p>Can one fix <code>gsmul</code> to have definitional equality here?</p>



<a name="207187328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207187328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207187328">(Aug 17 2020 at 19:33)</a>:</h4>
<p>but that won't solve other subsingleton problems right</p>



<a name="207187704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207187704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207187704">(Aug 17 2020 at 19:36)</a>:</h4>
<p>In a perfect library all such problems should be eliminated, one by one. Yes, this is hard work!</p>



<a name="207187969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207187969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207187969">(Aug 17 2020 at 19:40)</a>:</h4>
<p>(Fixing <code>gsmul</code> seems complicated, it might be easier to fix integer multiplication but this would break absolutely everything <span aria-label="anguished" class="emoji emoji-1f627" role="img" title="anguished">:anguished:</span> )</p>



<a name="207189373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207189373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207189373">(Aug 17 2020 at 19:52)</a>:</h4>
<p>in a perfect library we wouldn't rely on definitional equality</p>



<a name="207189506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207189506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207189506">(Aug 17 2020 at 19:54)</a>:</h4>
<p>First, we should fix it for <code>nat</code>, by the way:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory</span><span class="bp">.</span><span class="n">finite</span>

<span class="kn">lemma</span> <span class="n">zou</span> <span class="o">:</span> <span class="n">semimodule</span> <span class="n">nat</span> <span class="n">nat</span> <span class="o">:=</span> <span class="n">add_comm_monoid</span><span class="bp">.</span><span class="n">nat_semimodule</span>
<span class="kn">lemma</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">semimodule</span> <span class="n">nat</span> <span class="n">nat</span> <span class="o">:=</span> <span class="n">semiring</span><span class="bp">.</span><span class="n">to_semimodule</span>

<span class="kn">lemma</span> <span class="n">glou</span> <span class="o">:</span> <span class="n">zou</span> <span class="bp">=</span> <span class="n">foo</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="207190149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207190149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207190149">(Aug 17 2020 at 20:00)</a>:</h4>
<p>is it even possible to fix it? <code>semiring.to_semimodule</code> turns <code>semiring R</code> into <code>semimodule R R</code>, which must use multiplication; <code>add_comm_monoid.nat_semimodule</code> turns <code>add_comm_monoid M</code> into <code>semimodule ℕ M</code>, and there can be no multiplication</p>



<a name="207190383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207190383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207190383">(Aug 17 2020 at 20:02)</a>:</h4>
<p>If you give exactly the same definition for multiplication on the integers (using the additive structure on the second variable) and for the integer action on any <code>add_comm_group</code>, I don't see why they couldn't be defeq.</p>



<a name="207190619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207190619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207190619">(Aug 17 2020 at 20:04)</a>:</h4>
<p>aha, you want us to change multiplication</p>



<a name="207190763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207190763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207190763">(Aug 17 2020 at 20:05)</a>:</h4>
<p>It's not me, it's Johan <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="207203704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207203704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207203704">(Aug 17 2020 at 22:22)</a>:</h4>
<p>For <code>nat</code>, it just means that <code>nat.mul</code> (used for <code>semiring.to_semimodule</code>) should be defined in the same was as an additive version of <code>monoid.pow</code> (used for <code>nsmul</code>, used for <code>add_comm_monoid.nat_semimodule</code>). I think you can change either of them to get a definitional equality.</p>



<a name="207203905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207203905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207203905">(Aug 17 2020 at 22:24)</a>:</h4>
<p>aah so the fix is easy! Just change the definition of nat.mul and fix the errors!</p>



<a name="207204424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207204424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207204424">(Aug 17 2020 at 22:30)</a>:</h4>
<p>Oh wait, two definitions defined in the same way using the equation compiler are not recognized as definitionally equal by Lean.</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">my_mul1</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="n">a</span> <span class="mi">0</span>     <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="n">a</span> <span class="o">(</span><span class="n">b</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">my_mul1</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="n">a</span>

<span class="n">def</span> <span class="n">my_mul2</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="n">a</span> <span class="mi">0</span>     <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="n">a</span> <span class="o">(</span><span class="n">b</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">my_mul2</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="n">a</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="n">m</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">my_mul1</span> <span class="n">n</span> <span class="n">m</span> <span class="bp">=</span> <span class="n">my_mul2</span> <span class="n">n</span> <span class="n">m</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- error</span>
</code></pre></div>


<p>So if we want this, we might need to not use the equation compiler for these definitions?</p>



<a name="207204511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207204511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207204511">(Aug 17 2020 at 22:32)</a>:</h4>
<p>Or we can define <code>nat.mul</code> as <code>nsmul</code> if we refactor the library so much that <code>nsmul</code> is defined before <code>nat.mul</code>...</p>



<a name="207220604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207220604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207220604">(Aug 18 2020 at 03:39)</a>:</h4>
<p>I wish that instead we could tell Lean to not bother about diamonds if it can find an instance of <code>subsingleton (target_class)</code></p>



<a name="207220612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Z%20is%20a%20module%20over%20itself/near/207220612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Z.20is.20a.20module.20over.20itself.html#207220612">(Aug 18 2020 at 03:39)</a>:</h4>
<p>But I guess that requires a full-blown <code>transport</code> framework?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>