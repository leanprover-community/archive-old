---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html">Lean takes all computer memory</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="266842287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266842287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266842287">(Jan 04 2022 at 17:59)</a>:</h4>
<p>I'm in the midst of a small PR <a href="https://github.com/leanprover-community/mathlib/pull/11233">#11233</a>, with a few modifications, but Lean is completely stuck, takes all the computer memory… What did I do wrong ?</p>



<a name="266842530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266842530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266842530">(Jan 04 2022 at 18:00)</a>:</h4>
<p>A ton of moving error messages such as <br>
<code>invalid import: data.option.defs 
excessive memory consumption detected at 'expression traversal' (potential solution: increase memory consumption threshold)</code></p>



<a name="266842653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266842653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266842653">(Jan 04 2022 at 18:01)</a>:</h4>
<p>Your cache is messed up. Try getting a new one using <code>leanproject get-cache</code> and restarting the LEan server.</p>



<a name="266843131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266843131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266843131">(Jan 04 2022 at 18:05)</a>:</h4>
<p>Here is what happens :</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="mi">19</span><span class="o">:</span><span class="mi">03</span><span class="o">)</span> <span class="n">pro</span><span class="bp">-</span><span class="n">acl</span> <span class="bp">&gt;</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="n">eb0a06df7</span>
  <span class="n">locally...</span>
  <span class="n">remotely...</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">available</span> <span class="n">for</span> <span class="n">revision</span> <span class="n">eb0a06df7</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">584</span><span class="n">c7bb0f</span>
  <span class="n">locally...</span>
  <span class="n">Found</span> <span class="kn">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">available</span> <span class="n">for</span> <span class="n">eb0a06df7.</span> <span class="n">A</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">found</span> <span class="n">for</span> <span class="n">the</span> <span class="n">ancestor</span> <span class="mi">584</span><span class="n">c7bb0f.</span>
<span class="n">To</span> <span class="n">see</span> <span class="n">the</span> <span class="n">intermediate</span> <span class="n">commits</span><span class="o">,</span> <span class="n">run</span><span class="o">:</span>
  <span class="n">git</span> <span class="n">log</span> <span class="c1">--graph eb0a06df7 584c7bb0f^!</span>
<span class="n">Run</span> <span class="bp">`</span><span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="c1">--rev` on one of the available commits above.</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">cached</span> <span class="n">oleans</span>
</code></pre></div>
<p><span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>
<p>If I give  <code>leanproject</code> the tag of the earlier revision, what will happen of my tiny modifications ?</p>



<a name="266843289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266843289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266843289">(Jan 04 2022 at 18:07)</a>:</h4>
<p>Supposedly nothing, but if you are on an old version of <code>leanproject</code> it might accidentally throw them away</p>



<a name="266843345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266843345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266843345">(Jan 04 2022 at 18:07)</a>:</h4>
<p>By that I mean it only fetches the cache. It doesn't do any git stuff.</p>



<a name="266843538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266843538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266843538">(Jan 04 2022 at 18:09)</a>:</h4>
<p><span class="user-mention" data-user-id="130609">@Antoine Chambert-Loir</span> When in doubt, make sure that you save all your open files, and commit them.</p>



<a name="266843704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266843704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266843704">(Jan 04 2022 at 18:10)</a>:</h4>
<p><span class="user-mention" data-user-id="130609">@Antoine Chambert-Loir</span> You can try getting the cache from <code>master</code> and then merging <code>master</code> into your branch:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ git checkout master
$ git pull origin master
$ leanproject get-cache
$ git checkout sign_from_cycle_type<span class="err">'</span>
$ git merge master
</code></pre></div>



<a name="266844475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266844475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266844475">(Jan 04 2022 at 18:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130609">Antoine Chambert-Loir</span> <a href="#narrow/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory/near/266843131">said</a>:</p>
<blockquote>
<p>Here is what happens :</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="mi">19</span><span class="o">:</span><span class="mi">03</span><span class="o">)</span> <span class="n">pro</span><span class="bp">-</span><span class="n">acl</span> <span class="bp">&gt;</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="n">eb0a06df7</span>
  <span class="n">locally...</span>
  <span class="n">remotely...</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">available</span> <span class="n">for</span> <span class="n">revision</span> <span class="n">eb0a06df7</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">584</span><span class="n">c7bb0f</span>
  <span class="n">locally...</span>
  <span class="n">Found</span> <span class="kn">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">No</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">available</span> <span class="n">for</span> <span class="n">eb0a06df7.</span> <span class="n">A</span> <span class="n">cache</span> <span class="n">was</span> <span class="n">found</span> <span class="n">for</span> <span class="n">the</span> <span class="n">ancestor</span> <span class="mi">584</span><span class="n">c7bb0f.</span>
<span class="n">To</span> <span class="n">see</span> <span class="n">the</span> <span class="n">intermediate</span> <span class="n">commits</span><span class="o">,</span> <span class="n">run</span><span class="o">:</span>
  <span class="n">git</span> <span class="n">log</span> <span class="c1">--graph eb0a06df7 584c7bb0f^!</span>
<span class="n">Run</span> <span class="bp">`</span><span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span> <span class="c1">--rev` on one of the available commits above.</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">cached</span> <span class="n">oleans</span>
</code></pre></div>
<p><span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span></p>
<p>If I give  <code>leanproject</code> the tag of the earlier revision, what will happen of my tiny modifications ?</p>
</blockquote>
<p>I'd try <code>leanproject get-cache --fallback=download-all</code> and see if that helps. It should be completely safe by now</p>



<a name="266862980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266862980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266862980">(Jan 04 2022 at 21:03)</a>:</h4>
<p>Tiny changes may require many files be recompiled, so could be the cause of the problem. If that's the case, getting cache for an ancester version won't help. I suggest running  <code>leanproject build</code>, or you may commit, push, wait for modified mathlib to be built/compiled on the cloud, <code>leanproject get-cache</code> when they are ready, then restart the server.</p>



<a name="266864029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266864029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266864029">(Jan 04 2022 at 21:12)</a>:</h4>
<p>This is certainly what happens, because I can't manage to have it work.<br>
I tried a <code>leanproject build</code> but it was not finished 2 hours later… <br>
Let's commit and push and check tomorrow!</p>



<a name="266864170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266864170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266864170">(Jan 04 2022 at 21:13)</a>:</h4>
<p><span class="user-mention" data-user-id="130609">@Antoine Chambert-Loir</span> if you want to compile only the files necessary for a single lean file called <code>foo.lean</code>, you can use <code>lean --make foo.lean</code>. If you instead use <code>leanproject build</code>, it will try to build the whole library.</p>



<a name="266864291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266864291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266864291">(Jan 04 2022 at 21:14)</a>:</h4>
<p>So, if you're editing some file <code>a.lean</code> that is imported by many other files, and you next want to work on <code>b.lean</code> which imports <code>a.lean</code>, if you use <code>lean --make b.lean</code>, then only the bare minimum will be compiled..</p>



<a name="266970102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266970102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266970102">(Jan 05 2022 at 18:14)</a>:</h4>
<p>It seems that I run into similar problems in my PR <a href="https://github.com/leanprover-community/mathlib/pull/11181">https://github.com/leanprover-community/mathlib/pull/11181</a>.</p>



<a name="266970168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/266970168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#266970168">(Jan 05 2022 at 18:15)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/11181#issuecomment-1005956398">https://github.com/leanprover-community/mathlib/pull/11181#issuecomment-1005956398</a></p>



<a name="267068941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/267068941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#267068941">(Jan 06 2022 at 14:51)</a>:</h4>
<p>Issue solved by letting GitHub build the project and getting olean from GitHub. VS code doesn't seem useable for building large Lean libraries.</p>



<a name="267069093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/267069093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#267069093">(Jan 06 2022 at 14:52)</a>:</h4>
<p>if you want to build locally, you should use <code>leanproject build</code></p>



<a name="267072718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20takes%20all%20computer%20memory/near/267072718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20takes.20all.20computer.20memory.html#267072718">(Jan 06 2022 at 15:24)</a>:</h4>
<p>I've done that twice. My computer ran overnight and finished it in late morning.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>