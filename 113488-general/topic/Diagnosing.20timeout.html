---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Diagnosing.20timeout.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html">Diagnosing timeout</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="195833392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833392">(Apr 30 2020 at 12:46)</a>:</h4>
<p>I'm getting a confusing deterministic timeout - with the last line of my proof there's a timeout but without it there isn't, and if I reorder the proof to have a different last line, still the last line gives a timeout. I haven't used anything like simp or tidy, and I'm pretty sure there shouldn't be any difficult typeclass searches either. What sort of thing could I do to figure out why it's timing out? (I can't really post an MWE since it's on top of thousands of lines of topos code but the proof is:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
    <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">congr</span><span class="o">,</span>
    <span class="n">symmetry</span><span class="o">,</span>
    <span class="n">refine</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>



<a name="195833617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833617">(Apr 30 2020 at 12:49)</a>:</h4>
<p>I'm not sure if it makes a difference but the proof of <code>dense_prod_map_id</code> is currently sorry</p>



<a name="195833653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833653">(Apr 30 2020 at 12:49)</a>:</h4>
<p>and without the final line of the proof, it's very quick to show me the tactic state</p>



<a name="195833884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833884">(Apr 30 2020 at 12:51)</a>:</h4>
<p>are there other fields of <code>sheaf</code> you haven't provided?</p>



<a name="195833898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833898">(Apr 30 2020 at 12:51)</a>:</h4>
<p>Nope</p>



<a name="195834909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195834909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195834909">(Apr 30 2020 at 13:01)</a>:</h4>
<p>You can try turning on various trace flags, and see whether anything looks obviously out of control. Otherwise, I am afraid it's not easy to tell what's going on</p>



<a name="195835003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835003">(Apr 30 2020 at 13:01)</a>:</h4>
<p>One possibility is that you actually have a type error and Lean is going on an unfolding spree to see if it can be reduced away</p>



<a name="195835097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835097">(Apr 30 2020 at 13:02)</a>:</h4>
<p>Are there any trace flags I should try first? <code>trace.class_instances</code> didn't seem out of control</p>



<a name="195835237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835237">(Apr 30 2020 at 13:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195835003" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195835003">said</a>:</p>
<blockquote>
<p>One possibility is that you actually have a type error and Lean is going on an unfolding spree to see if it can be reduced away</p>
</blockquote>
<p>This makes sense, but if I reorder the proof (eg changing the <code>have z</code> to a <code>suffices</code>) there's no type error for the alternative last line</p>



<a name="195835283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835283">(Apr 30 2020 at 13:04)</a>:</h4>
<p>For clarity, by reordered proof I mean:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">suffices</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">congr</span><span class="o">,</span>
        <span class="n">symmetry</span><span class="o">,</span>
        <span class="n">refine</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
    <span class="o">}</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>



<a name="195835390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835390">(Apr 30 2020 at 13:04)</a>:</h4>
<p>In both cases commenting out the last line (in the latter case, just the <code>ha</code>) tells me quickly that the goal isn't solved and there's no other errors</p>



<a name="195835402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835402">(Apr 30 2020 at 13:04)</a>:</h4>
<p>maybe <code>set_option trace.type_context.is_def_eq true</code></p>



<a name="195835923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835923">(Apr 30 2020 at 13:09)</a>:</h4>
<p>Doesn't seem to be crazy, one of the rw gives a pretty long trace but most of it says success</p>



<a name="195836978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195836978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195836978">(Apr 30 2020 at 13:18)</a>:</h4>
<p>Post a MWE anyway. Seriously. Of the form "download this branch of this repo, and look at this line in this file". When people did this in the past I just thought they were taking the mickey. But now with leanproject it's much easier.</p>



<a name="195837143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195837143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195837143">(Apr 30 2020 at 13:20)</a>:</h4>
<p>Well, something must be happening where Lean starts taking time.</p>



<a name="195837169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195837169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195837169">(Apr 30 2020 at 13:20)</a>:</h4>
<p>In the past I have occasionally resorted to running Lean in a debugger, then stopping it at a random point and looking at the trace</p>



<a name="195837876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195837876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195837876">(Apr 30 2020 at 13:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195836978" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195836978">said</a>:</p>
<blockquote>
<p>Post a MWE anyway. Seriously. Of the form "download this branch of repo, and look at this line in this file". When people did this in the past I just thought they were taking the mickey. But now with leanproject it's much easier.</p>
</blockquote>
<p>The final line in <a href="https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean" title="https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean">https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean</a> - download the sheaf branch of the repo. (It's not particularly minimal)</p>



<a name="195860476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195860476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195860476">(Apr 30 2020 at 15:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195837169" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195837169">said</a>:</p>
<blockquote>
<p>In the past I have occasionally resorted to running Lean in a debugger, then stopping it at a random point and looking at the trace</p>
</blockquote>
<p>How could I do this?</p>



<a name="195866461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195866461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195866461">(Apr 30 2020 at 16:39)</a>:</h4>
<p>If I add another line (eg simp) before the <code>end</code>, it says the tactic state is <code>goals accomplished</code> and the simp fails with match failed, no goals; and this happens quickly</p>



<a name="195869576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195869576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195869576">(Apr 30 2020 at 16:57)</a>:</h4>
<p>My guess is that you should try to fill in the sorry of <code>dense_prod_map_id</code>: it is not a Prop, so what you put in there is important.</p>
<p>By the way, all these classes (<code>dense</code>, <code>closed</code>) are not Props because <code>is_iso</code> is not Prop either. Does it really create problems to turn <code>is_iso</code> into a Prop, just requiring the existence of an inverse -- and having a convenience function <code>is_iso.inverse</code> that would pull the inverse out of choice?</p>



<a name="195869737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195869737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195869737">(Apr 30 2020 at 16:58)</a>:</h4>
<p>This is the big "category_theory uses data, not Props" question...</p>



<a name="195869849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195869849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195869849">(Apr 30 2020 at 16:59)</a>:</h4>
<p>The same thing with <code>has_limits</code> etc...</p>



<a name="195870021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195870021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195870021">(Apr 30 2020 at 17:00)</a>:</h4>
<p>Yeah I think it has to be all or nothing - we've got to have everything as a Prop or everything as data otherwise things won't play well with each other</p>



<a name="195870328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195870328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195870328">(Apr 30 2020 at 17:02)</a>:</h4>
<p>If the data is not unique, then I understand you need to keep the data and record the way it is constructed. But when the data is unique like the inverse, I don't see the point.</p>



<a name="195870702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195870702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195870702">(Apr 30 2020 at 17:05)</a>:</h4>
<p>In some cases, the data might only be unique up to (unique) isomorphism, but also in category theory (and topos theory) we often try to avoid using choice, so just the existence of a unique object isn't enough</p>



<a name="195870863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195870863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195870863">(Apr 30 2020 at 17:06)</a>:</h4>
<p>It's also reasonably common to take "has limits" in category theory to mean "we are given a particular choice of limit for every diagram", which matches lean's current definition</p>



<a name="195870981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195870981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195870981">(Apr 30 2020 at 17:07)</a>:</h4>
<p><a href="/user_uploads/3121/0Z1rlCc5VdNPOiDKBmBv2RPo/image.png" title="image.png">eg just after Lemma A1.2.1 in the Elephant</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/0Z1rlCc5VdNPOiDKBmBv2RPo/image.png" title="eg just after Lemma A1.2.1 in the Elephant"><img src="/user_uploads/3121/0Z1rlCc5VdNPOiDKBmBv2RPo/image.png"></a></div>



<a name="195871331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871331">(Apr 30 2020 at 17:09)</a>:</h4>
<p>Only very picky people and theorem provers would consider "having limits" to mean a choice of limits.</p>



<a name="195871532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871532">(Apr 30 2020 at 17:11)</a>:</h4>
<p>I won't tell PTJ you called him picky :P</p>



<a name="195871547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871547">(Apr 30 2020 at 17:11)</a>:</h4>
<p>I'm pretty sure this is the convention in MM as well</p>



<a name="195871637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871637">(Apr 30 2020 at 17:12)</a>:</h4>
<p>metamath?</p>



<a name="195871653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871653">(Apr 30 2020 at 17:12)</a>:</h4>
<p>Maclane-Moerdijk</p>



<a name="195871693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871693">(Apr 30 2020 at 17:12)</a>:</h4>
<p>I think this is mainly in the eye of the beholder</p>



<a name="195871885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871885">(Apr 30 2020 at 17:14)</a>:</h4>
<p>Just like, "obviously", most category theory texts mean <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">U</mi></mrow><annotation encoding="application/x-tex">\mathcal{U}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.09931em;">U</span></span></span></span></span>-small category for some universe <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">U</mi></mrow><annotation encoding="application/x-tex">\mathcal{U}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.09931em;">U</span></span></span></span></span> even if they never mention universes</p>



<a name="195871917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871917">(Apr 30 2020 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195871693" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195871693">said</a>:</p>
<blockquote>
<p>I think this is mainly in the eye of the beholder</p>
</blockquote>
<p>Maybe, but it is explicitly discussed and mentioned in the Elephant</p>



<a name="195871956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195871956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195871956">(Apr 30 2020 at 17:15)</a>:</h4>
<p>My guess is these picky people have to rely on the fact that there is nobody even pickier who wants to dismantle their position</p>



<a name="195876596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195876596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195876596">(Apr 30 2020 at 17:51)</a>:</h4>
<p>So I tried some preliminary investigations:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">...</span>
    <span class="n">congr</span><span class="o">,</span>
    <span class="n">symmetry</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">ZZZ</span> <span class="o">:=</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">cchat</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">unhat</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">at</span> <span class="n">ZZZ</span><span class="o">,</span>
    <span class="n">dsimp</span><span class="o">,</span>
    <span class="n">dsimp</span> <span class="n">at</span> <span class="n">ZZZ</span><span class="o">,</span>
    <span class="n">dunfold</span> <span class="n">exp_transpose</span><span class="o">,</span>
    <span class="n">sorry</span>
  <span class="kn">end</span>
</code></pre></div>



<a name="195876726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195876726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195876726">(Apr 30 2020 at 17:52)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">ZZZ</span> <span class="o">:</span> <span class="err">⇑</span><span class="o">(</span><span class="n">is_left_adjoint</span><span class="bp">.</span><span class="n">adj</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="n">B</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">equiv</span><span class="bp">.</span><span class="n">symm</span> <span class="o">(</span><span class="n">is_left_adjoint</span><span class="bp">.</span><span class="n">adj</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="n">B</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">))</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span>
<span class="err">⊢</span> <span class="err">⇑</span><span class="o">(</span><span class="n">is_left_adjoint</span><span class="bp">.</span><span class="n">adj</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="n">B</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="err">⇑</span><span class="o">(</span><span class="n">equiv</span><span class="bp">.</span><span class="n">symm</span> <span class="o">(</span><span class="n">is_left_adjoint</span><span class="bp">.</span><span class="n">adj</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="n">B</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">))</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span>
</code></pre></div>



<a name="195876757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195876757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195876757">(Apr 30 2020 at 17:53)</a>:</h4>
<p>and <code>exact ZZZ</code> or <code>convert ZZZ</code> causes the timeout</p>



<a name="195876813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195876813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195876813">(Apr 30 2020 at 17:53)</a>:</h4>
<p>So of course when you <code>set_option pp.all true</code> you find that the terms are different.</p>



<a name="195876931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195876931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195876931">(Apr 30 2020 at 17:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195835283" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195835283">said</a>:</p>
<blockquote>
<p>For clarity, by reordered proof I mean:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">suffices</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">congr</span><span class="o">,</span>
        <span class="n">symmetry</span><span class="o">,</span>
        <span class="n">refine</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
    <span class="o">}</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>


</blockquote>
<p>Yeah I get a timeout as well with exact ZZZ, but with the re-ordered version of the code that version doesn't give a type error</p>



<a name="195876945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195876945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195876945">(Apr 30 2020 at 17:54)</a>:</h4>
<p>and that doesn't explain why it's fine if you put a simp afterwards</p>



<a name="195877025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195877025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195877025">(Apr 30 2020 at 17:55)</a>:</h4>
<p>My current hypothesis is that Sebastian's right, and the problem happens when lean is trying to make the bytecode, so I'm currently filling in the sorry</p>



<a name="195877247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195877247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195877247">(Apr 30 2020 at 17:56)</a>:</h4>
<p><a href="https://gist.github.com/kbuzzard/7eb4998162960f7c0e1f975c8d199a71" title="https://gist.github.com/kbuzzard/7eb4998162960f7c0e1f975c8d199a71">ZZZ</a> vs <a href="https://gist.github.com/kbuzzard/81c432ac5a5282a4baf3ce789e358519" title="https://gist.github.com/kbuzzard/81c432ac5a5282a4baf3ce789e358519">goal</a>; <a href="https://gist.github.com/kbuzzard/8cd788951b49a3ff536c3dce71e085e0" title="https://gist.github.com/kbuzzard/8cd788951b49a3ff536c3dce71e085e0">diff</a></p>



<a name="195877334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195877334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195877334">(Apr 30 2020 at 17:57)</a>:</h4>
<p>Looking at the first diff, that's defeq by how I defined <code>exp</code></p>



<a name="195878290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195878290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195878290">(Apr 30 2020 at 18:04)</a>:</h4>
<p>There are no sorrys in ZZZ or the goal though</p>



<a name="195878382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195878382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195878382">(Apr 30 2020 at 18:05)</a>:</h4>
<p>Hmm</p>



<a name="195878861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195878861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195878861">(Apr 30 2020 at 18:09)</a>:</h4>
<p>Oh this is interesting</p>



<a name="195879038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879038">(Apr 30 2020 at 18:10)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">suffices</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">congr</span><span class="o">,</span>
        <span class="n">symmetry</span><span class="o">,</span>
        <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
      <span class="n">sorry</span><span class="o">,</span>
    <span class="o">},</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>



<a name="195879090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879090">(Apr 30 2020 at 18:10)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Tactic</span> <span class="n">State</span>
<span class="n">goals</span> <span class="n">accomplished</span>
<span class="n">sheaf</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="mi">184</span><span class="o">:</span><span class="mi">6</span><span class="o">:</span> <span class="n">error</span>
<span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">goals</span> <span class="n">to</span> <span class="n">be</span> <span class="n">solved</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">no</span> <span class="n">goals</span>
</code></pre></div>



<a name="195879130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879130">(Apr 30 2020 at 18:10)</a>:</h4>
<p>the error is on the sorry, complaining that I'm apologising when I'm all done.</p>



<a name="195879171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879171">(Apr 30 2020 at 18:11)</a>:</h4>
<p>Right - this is the same as the simp thing I saw earlier</p>



<a name="195879176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879176">(Apr 30 2020 at 18:11)</a>:</h4>
<p>Really weird!</p>



<a name="195879180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879180">(Apr 30 2020 at 18:11)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">suffices</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">congr</span><span class="o">,</span>
        <span class="n">symmetry</span><span class="o">,</span>
        <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
    <span class="o">},</span>
    <span class="n">sorry</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>


<p>same error</p>



<a name="195879226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879226">(Apr 30 2020 at 18:11)</a>:</h4>
<p>I've seen Lean in sort of this state before -- there are hidden goals. There's a tactic which makes them come out</p>



<a name="195879347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879347">(Apr 30 2020 at 18:12)</a>:</h4>
<p>But I don't think there are hidden goals! In all the code I've written I haven't used any <code>. obviously</code> or anything</p>



<a name="195879486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879486">(Apr 30 2020 at 18:13)</a>:</h4>
<p>Sometimes a tactic just leaves some hidden goals behind by accident</p>



<a name="195879497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195879497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195879497">(Apr 30 2020 at 18:13)</a>:</h4>
<p>True</p>



<a name="195880019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880019">(Apr 30 2020 at 18:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195877025" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195877025">said</a>:</p>
<blockquote>
<p>My current hypothesis is that Sebastian's right, and the problem happens when lean is trying to make the bytecode, so I'm currently filling in the sorry</p>
</blockquote>
<p>You probably mean Sébastien here. I don't know why Zulip doesn't use accents here, but the ASCII version is already enough to disambiguate between Sebastian working on Lean4 and Sebastien working on calculus and analytic functions</p>



<a name="195880055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880055">(Apr 30 2020 at 18:17)</a>:</h4>
<p>I can't remember the name of the tactic which makes the hidden goals appear :-(</p>



<a name="195880115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880115">(Apr 30 2020 at 18:18)</a>:</h4>
<p><code>recover</code>?</p>



<a name="195880263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880263">(Apr 30 2020 at 18:19)</a>:</h4>
<p>Yeah that's the one. OK I am going back to blaming the sorried data. The problem isn't the <code>exact</code>, it's when Lean is putting everything together afterwards.</p>



<a name="195880299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880299">(Apr 30 2020 at 18:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195880019" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195880019">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195877025" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195877025">said</a>:</p>
<blockquote>
<p>My current hypothesis is that Sebastian's right, and the problem happens when lean is trying to make the bytecode, so I'm currently filling in the sorry</p>
</blockquote>
<p>You probably mean Sébastien here. I don't know why Zulip doesn't use accents here, but the ASCII version is already enough to disambiguate between Sebastian working on Lean4 and Sebastien working on calculus and analytic functions</p>
</blockquote>
<p>Oops, yeah, thanks!</p>



<a name="195880443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880443">(Apr 30 2020 at 18:20)</a>:</h4>
<p>Or as I call them, Sebasti∀n and Sebasti∃n.</p>



<a name="195880444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880444">(Apr 30 2020 at 18:20)</a>:</h4>
<p>Maybe it should be renamed <code>#recover</code>; it's not intended for leaving in proof scripts because it's pretty expensive and usually indicates a bug in another tactic</p>



<a name="195880741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880741">(Apr 30 2020 at 18:22)</a>:</h4>
<p>Another Mario has appeared on the chat, so maybe I need to start going by Mário</p>



<a name="195880831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880831">(Apr 30 2020 at 18:23)</a>:</h4>
<p>We lost track of how many Kevin we have a long time ago.</p>



<a name="195880853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880853">(Apr 30 2020 at 18:23)</a>:</h4>
<p>Hopefully I'll be safe for a while</p>



<a name="195880883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195880883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195880883">(Apr 30 2020 at 18:23)</a>:</h4>
<p>Or maybe I should hope for the opposite</p>



<a name="195889897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195889897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195889897">(Apr 30 2020 at 19:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195860476" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195860476">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195837169" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195837169">said</a>:</p>
<blockquote>
<p>In the past I have occasionally resorted to running Lean in a debugger, then stopping it at a random point and looking at the trace</p>
</blockquote>
<p>How could I do this?</p>
</blockquote>
<p>Depends on your platform I suppose, but I just run lean inside gdb</p>



<a name="195889902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195889902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195889902">(Apr 30 2020 at 19:32)</a>:</h4>
<p>from the command line</p>



<a name="195893897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195893897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195893897">(Apr 30 2020 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195880263" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195880263">said</a>:</p>
<blockquote>
<p>Yeah that's the one. OK I am going back to blaming the sorried data. The problem isn't the <code>exact</code>, it's when Lean is putting everything together afterwards.</p>
</blockquote>
<p>This isn't it... I filled in the sorry</p>



<a name="195894018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195894018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195894018">(Apr 30 2020 at 20:04)</a>:</h4>
<p>For those experimenting, I've pushed the updated version - same file</p>



<a name="195991945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195991945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195991945">(May 01 2020 at 18:17)</a>:</h4>
<p>Further confusing this, I've got two other defs which construct a <code>sheaf</code> and they don't have the same problem...</p>



<a name="195994444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195994444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195994444">(May 01 2020 at 18:41)</a>:</h4>
<p>This is worth more investigation. I've had quite a busy day today and I've got another one tomorrow but I hope to find the time to look at this again, it's not like anything I've seen before which is why I find it interesting. Can you make a branch with the error so it doesn't get lost?</p>



<a name="196002780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196002780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196002780">(May 01 2020 at 19:56)</a>:</h4>
<p>Will do!</p>



<a name="196002800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196002800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196002800">(May 01 2020 at 19:57)</a>:</h4>
<p><a href="/user_uploads/3121/FUoycAJfx3fzKgMdUGrjZTu3/Screencast-2020-05-01-203515.mp4" title="Screencast-2020-05-01-203515.mp4">Screencast-2020-05-01-203515.mp4</a></p>



<a name="196002805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196002805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196002805">(May 01 2020 at 19:57)</a>:</h4>
<p>If anyone knows of any workarounds that might work I'd find that useful as well</p>



<a name="196002878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196002878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196002878">(May 01 2020 at 19:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="110032">@Reid Barton</span>  what is going on here?</p>



<a name="196002988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196002988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196002988">(May 01 2020 at 19:58)</a>:</h4>
<p>Sometimes it takes forever to time out, sometimes it's quick, but it never works</p>



<a name="196003814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196003814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196003814">(May 01 2020 at 20:06)</a>:</h4>
<p>Restarting Lean just makes it think forever and then time out with the  error</p>
<div class="codehilite"><pre><span></span><code>excessive memory consumption detected at &#39;expression equality test&#39; (potential solution: increase memory consumption threshold)
</code></pre></div>



<a name="196025676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196025676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196025676">(May 02 2020 at 01:12)</a>:</h4>
<p>I am guessing the term is bad in some way, and the kernel has decided to unfold everything as a result</p>



<a name="196025757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196025757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196025757">(May 02 2020 at 01:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195879130" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195879130">said</a>:</p>
<blockquote>
<p>the error is on the sorry, complaining that I'm apologising when I'm all done.</p>
</blockquote>
<p>How does that explain this?</p>



<a name="196025804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196025804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196025804">(May 02 2020 at 01:14)</a>:</h4>
<p>Writing <code>sorry</code> when there are no goals is an error, right?</p>



<a name="196025808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196025808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196025808">(May 02 2020 at 01:14)</a>:</h4>
<p>I didn't follow what Kevin was seeing in his video.</p>



<a name="196025829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196025829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196025829">(May 02 2020 at 01:15)</a>:</h4>
<p>In particular, it looks like the tactic block is succeeding but then the resulting term is somehow defective.</p>



<a name="196026020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196026020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196026020">(May 02 2020 at 01:20)</a>:</h4>
<p>I suggested <code>set_option trace.type_context.is_def_eq true</code> before but I think it really should have been the one with <code>detail</code>.</p>



<a name="196026023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196026023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196026023">(May 02 2020 at 01:20)</a>:</h4>
<p>Try turning that on and running lean on your file from the command line</p>



<a name="196026044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196026044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196026044">(May 02 2020 at 01:21)</a>:</h4>
<p>I used these flags today and I think <code>is_def_eq</code> only displays the unification problems, not the trace of trying to solve them.</p>



<a name="196051962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196051962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196051962">(May 02 2020 at 13:35)</a>:</h4>
<p>I didn't realise the <code>def</code> was underlined blue! That's the one with the long trace - and it fits with the idea that there's an issue creating the term</p>



<a name="196052002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052002">(May 02 2020 at 13:36)</a>:</h4>
<p>I can't figure out what the issue is though</p>



<a name="196052012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052012">(May 02 2020 at 13:36)</a>:</h4>
<p>Here's the trace: <a href="https://gist.github.com/b-mehta/88525a9eb2c41c23e414d9bb30c650fb" title="https://gist.github.com/b-mehta/88525a9eb2c41c23e414d9bb30c650fb">https://gist.github.com/b-mehta/88525a9eb2c41c23e414d9bb30c650fb</a></p>



<a name="196052027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052027">(May 02 2020 at 13:37)</a>:</h4>
<p>The question is whether, when you run Lean from the command line, you get trace output continuously or whether it just stops at some point.</p>



<a name="196052035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052035">(May 02 2020 at 13:37)</a>:</h4>
<p>If it just stops, clearly it is doing something and the game is to figure out what trace option will make it print more stuff.</p>



<a name="196052096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052096">(May 02 2020 at 13:39)</a>:</h4>
<p>In vscode it stops and says deterministic timeout, I'm running on command line now</p>



<a name="196052417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052417">(May 02 2020 at 13:47)</a>:</h4>
<p>Ah! It runs for a while and then stops</p>



<a name="196052482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052482">(May 02 2020 at 13:49)</a>:</h4>
<p>and my memory  gets filled up</p>



<a name="196052955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196052955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196052955">(May 02 2020 at 13:58)</a>:</h4>
<p>Is there a list of what each trace option does?</p>



<a name="196053542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053542">(May 02 2020 at 14:12)</a>:</h4>
<p>Well, there's the autocomplete menu...</p>



<a name="196053548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053548">(May 02 2020 at 14:12)</a>:</h4>
<p>I would just run it in a debugger at this point</p>



<a name="196053563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053563">(May 02 2020 at 14:13)</a>:</h4>
<p>The autocomplete menu doesn't give information about what the difference between each trace option is though</p>



<a name="196053569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053569">(May 02 2020 at 14:13)</a>:</h4>
<p>oh, I guess only some things are documented then</p>



<a name="196053571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053571">(May 02 2020 at 14:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196053548" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196053548">said</a>:</p>
<blockquote>
<p>I would just run it in a debugger at this point</p>
</blockquote>
<p>How do I go about doing this? I'm not familiar with gdb</p>



<a name="196053650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053650">(May 02 2020 at 14:14)</a>:</h4>
<p>Probably something like <code>gdb --args lean myfile.lean</code>, then type <code>r</code> and ctrl-C when it starts thinking for a long time</p>



<a name="196053665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053665">(May 02 2020 at 14:15)</a>:</h4>
<p>then <code>bt</code> to see the stack trace</p>



<a name="196053757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053757">(May 02 2020 at 14:17)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="err">$</span> <span class="n">gdb</span> <span class="c1">--args lean ./src/sheaf.lean</span>
<span class="n">GNU</span> <span class="n">gdb</span> <span class="o">(</span><span class="n">GDB</span><span class="o">)</span> <span class="mi">8</span><span class="bp">.</span><span class="mi">3</span>
<span class="n">Copyright</span> <span class="o">(</span><span class="n">C</span><span class="o">)</span> <span class="mi">2019</span> <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span><span class="o">,</span> <span class="n">Inc</span><span class="bp">.</span>
<span class="n">License</span> <span class="n">GPLv3</span><span class="bp">+</span><span class="o">:</span> <span class="n">GNU</span> <span class="n">GPL</span> <span class="n">version</span> <span class="mi">3</span> <span class="n">or</span> <span class="n">later</span> <span class="bp">&lt;</span><span class="n">http</span><span class="o">:</span><span class="bp">//</span><span class="n">gnu</span><span class="bp">.</span><span class="n">org</span><span class="bp">/</span><span class="n">licenses</span><span class="bp">/</span><span class="n">gpl</span><span class="bp">.</span><span class="n">html</span><span class="bp">&gt;</span>
<span class="n">This</span> <span class="n">is</span> <span class="n">free</span> <span class="n">software</span><span class="o">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="n">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="bp">.</span>
<span class="n">There</span> <span class="n">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="o">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="k">by</span> <span class="n">law</span><span class="bp">.</span>
<span class="kt">Type</span> <span class="s2">&quot;show copying&quot;</span> <span class="n">and</span> <span class="s2">&quot;show warranty&quot;</span> <span class="n">for</span> <span class="n">details</span><span class="bp">.</span>
<span class="n">This</span> <span class="n">GDB</span> <span class="n">was</span> <span class="n">configured</span> <span class="n">as</span> <span class="s2">&quot;x86_64-apple-darwin17.7.0&quot;</span><span class="bp">.</span>
<span class="kt">Type</span> <span class="s2">&quot;show configuration&quot;</span> <span class="n">for</span> <span class="n">configuration</span> <span class="n">details</span><span class="bp">.</span>
<span class="n">For</span> <span class="n">bug</span> <span class="n">reporting</span> <span class="n">instructions</span><span class="o">,</span> <span class="n">please</span> <span class="n">see</span><span class="o">:</span>
<span class="bp">&lt;</span><span class="n">http</span><span class="o">:</span><span class="bp">//</span><span class="n">www</span><span class="bp">.</span><span class="n">gnu</span><span class="bp">.</span><span class="n">org</span><span class="bp">/</span><span class="n">software</span><span class="bp">/</span><span class="n">gdb</span><span class="bp">/</span><span class="n">bugs</span><span class="bp">/&gt;.</span>
<span class="n">Find</span> <span class="n">the</span> <span class="n">GDB</span> <span class="n">manual</span> <span class="n">and</span> <span class="n">other</span> <span class="n">documentation</span> <span class="n">resources</span> <span class="n">online</span> <span class="n">at</span><span class="o">:</span>
    <span class="bp">&lt;</span><span class="n">http</span><span class="o">:</span><span class="bp">//</span><span class="n">www</span><span class="bp">.</span><span class="n">gnu</span><span class="bp">.</span><span class="n">org</span><span class="bp">/</span><span class="n">software</span><span class="bp">/</span><span class="n">gdb</span><span class="bp">/</span><span class="n">documentation</span><span class="bp">/&gt;.</span>

<span class="n">For</span> <span class="kn">help</span><span class="o">,</span> <span class="n">type</span> <span class="s2">&quot;help&quot;</span><span class="bp">.</span>
<span class="kt">Type</span> <span class="s2">&quot;apropos word&quot;</span> <span class="n">to</span> <span class="n">search</span> <span class="n">for</span> <span class="n">commands</span> <span class="n">related</span> <span class="n">to</span> <span class="s2">&quot;word&quot;</span><span class="bp">...</span>
<span class="n">Reading</span> <span class="n">symbols</span> <span class="k">from</span> <span class="n">lean</span><span class="bp">...</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liballoc-089d48ff1bba5f70.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libbacktrace_sys-b0895307a49d7b98.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcompiler_builtins-35232c4af1148867.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcore-f948d62f596dcd3d.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libpanic_unwind-cb02f3c2aa14313b.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/librustc_demangle-136c67c44acb8989.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libstd-d4fbe66ddea5f3ce.rlib&quot;</span>

<span class="n">warning</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="kn">open</span> <span class="n">OSO</span> <span class="n">archive</span> <span class="n">file</span> <span class="s2">&quot;/Users/travis/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libunwind-5751ec7e6e80fbea.rlib&quot;</span>
<span class="o">(</span><span class="n">No</span> <span class="n">debugging</span> <span class="n">symbols</span> <span class="n">found</span> <span class="k">in</span> <span class="n">lean</span><span class="o">)</span>
<span class="o">(</span><span class="n">gdb</span><span class="o">)</span>
</code></pre></div>



<a name="196053899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053899">(May 02 2020 at 14:21)</a>:</h4>
<p>that's probably okay, type <code>r</code> anyways</p>



<a name="196053911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053911">(May 02 2020 at 14:21)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="o">(</span><span class="n">gdb</span><span class="o">)</span> <span class="n">r</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">bmehta</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lean</span> <span class="bp">./</span><span class="n">src</span><span class="bp">/</span><span class="n">sheaf</span><span class="bp">.</span><span class="n">lean</span>
<span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">Mach</span> <span class="n">task</span> <span class="n">port</span> <span class="n">for</span> <span class="n">process</span><span class="bp">-</span><span class="n">id</span> <span class="mi">31753</span><span class="o">:</span> <span class="o">(</span><span class="n">os</span><span class="bp">/</span><span class="n">kern</span><span class="o">)</span> <span class="n">failure</span> <span class="o">(</span><span class="mi">0</span><span class="n">x5</span><span class="o">)</span><span class="bp">.</span>
 <span class="o">(</span><span class="n">please</span> <span class="kn">check</span> <span class="n">gdb</span> <span class="n">is</span> <span class="n">codesigned</span> <span class="bp">-</span> <span class="n">see</span> <span class="n">taskgated</span><span class="o">(</span><span class="mi">8</span><span class="o">))</span>
</code></pre></div>



<a name="196053920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053920">(May 02 2020 at 14:21)</a>:</h4>
<p>oh maybe your OS is broken</p>



<a name="196053921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053921">(May 02 2020 at 14:21)</a>:</h4>
<p>Rough luck</p>



<a name="196053961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053961">(May 02 2020 at 14:22)</a>:</h4>
<p>uh oh</p>



<a name="196053978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196053978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196053978">(May 02 2020 at 14:22)</a>:</h4>
<p>I mean, this error is probably by design</p>



<a name="196054148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196054148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196054148">(May 02 2020 at 14:26)</a>:</h4>
<p>but it seems to be preventing you from what you want to do</p>



<a name="196054540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196054540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196054540">(May 02 2020 at 14:36)</a>:</h4>
<p>Is there some way you can make Lean's life easier by breaking up the definition?</p>



<a name="196054901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196054901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196054901">(May 02 2020 at 14:47)</a>:</h4>
<p>You can (and need to) codesign gdb on osx, there should be instructions online.</p>



<a name="196056895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196056895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196056895">(May 02 2020 at 15:32)</a>:</h4>
<p>I tried to get <code>gdb</code> running on macOS and had no luck. You can use <code>lldb</code> though. The steps are very similar to what Reid suggested with <code>gdb</code>.</p>



<a name="196057023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196057023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196057023">(May 02 2020 at 15:35)</a>:</h4>
<p>The <code>lldb</code> experience is a bit inferior right now since you can't use <a href="https://github.com/leanprover-community/lean/blob/ec1613aef1eee72e601f192b16740629c6d49690/bin/lean-gdb.py" title="https://github.com/leanprover-community/lean/blob/ec1613aef1eee72e601f192b16740629c6d49690/bin/lean-gdb.py">this pretty-printing script</a>.</p>



<a name="196057258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196057258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196057258">(May 02 2020 at 15:41)</a>:</h4>
<p>Ah thanks Bryan, I should have remembered that lldb is OSX for gdb.</p>



<a name="196057390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196057390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196057390">(May 02 2020 at 15:44)</a>:</h4>
<p>What didn't work for you <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> ? The codesigning  or something else? I just followed <a href="https://gist.github.com/hlissner/898b7dfc0a3b63824a70e15cd0180154" title="https://gist.github.com/hlissner/898b7dfc0a3b63824a70e15cd0180154">https://gist.github.com/hlissner/898b7dfc0a3b63824a70e15cd0180154</a> and it worked (I had to sudo killall taskgated in step 9) but other than that my gdb no longer complains.</p>



<a name="196057605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196057605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196057605">(May 02 2020 at 15:50)</a>:</h4>
<p>I'm using 10.14 so when I went through this in July, I tried the 10.12 and later instructions that are linked at the top of that gist. I don't remember what failed exactly, but it seems like there are various modifications people suggest in the comments which I might try <del>now</del> eventually.</p>



<a name="196057683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196057683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196057683">(May 02 2020 at 15:52)</a>:</h4>
<p>Ah, 10.13 here.</p>



<a name="196058185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058185">(May 02 2020 at 16:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="err">$</span> <span class="n">lldb</span> <span class="c1">-- lean ./src/sheaf.lean</span>
<span class="o">(</span><span class="n">lldb</span><span class="o">)</span> <span class="n">target</span> <span class="n">create</span> <span class="s2">&quot;lean&quot;</span>
<span class="n">Current</span> <span class="n">executable</span> <span class="n">set</span> <span class="n">to</span> <span class="err">&#39;</span><span class="n">lean&#39;</span> <span class="o">(</span><span class="n">x86_64</span><span class="o">)</span><span class="bp">.</span>
<span class="o">(</span><span class="n">lldb</span><span class="o">)</span> <span class="n">settings</span> <span class="n">set</span> <span class="c1">-- target.run-args  &quot;./src/sheaf.lean&quot;</span>
<span class="o">(</span><span class="n">lldb</span><span class="o">)</span> <span class="n">r</span>
<span class="n">Process</span> <span class="mi">36768</span> <span class="n">launched</span><span class="o">:</span> <span class="err">&#39;</span><span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">bmehta</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lean&#39;</span> <span class="o">(</span><span class="n">x86_64</span><span class="o">)</span>
<span class="n">Process</span> <span class="mi">36768</span> <span class="n">stopped</span>
<span class="bp">*</span> <span class="n">thread</span> <span class="bp">#</span><span class="mi">2</span><span class="o">,</span> <span class="n">stop</span> <span class="n">reason</span> <span class="bp">=</span> <span class="n">exec</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">0</span><span class="o">:</span> <span class="mi">0</span><span class="n">x0000000100c5f19c</span> <span class="n">dyld</span><span class="bp">`_</span><span class="n">dyld_start</span>
</code></pre></div>


<p>Presumably I'm misunderstanding how to do something here...</p>



<a name="196058296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058296">(May 02 2020 at 16:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195994444" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195994444">said</a>:</p>
<blockquote>
<p>This is worth more investigation. I've had quite a busy day today and I've got another one tomorrow but I hope to find the time to look at this again, it's not like anything I've seen before which is why I find it interesting. Can you make a branch with the error so it doesn't get lost?</p>
</blockquote>
<p>I'll move my work to a different branch, and keep that branch fixed. That is, the error is (and will remain) <a href="https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean#L261" title="https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean#L261">https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean#L261</a></p>



<a name="196058362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058362">(May 02 2020 at 16:06)</a>:</h4>
<p><span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> enter <code>r</code> again after that. For whatever reason <code>lldb</code> immediately pauses the program when it starts.</p>



<a name="196058465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058465">(May 02 2020 at 16:08)</a>:</h4>
<p>or <code>c</code> maybe?</p>



<a name="196058552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058552">(May 02 2020 at 16:10)</a>:</h4>
<p>AFAIR, debugging through <code>elan</code> is a bad idea</p>



<a name="196058564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058564">(May 02 2020 at 16:10)</a>:</h4>
<p>Try <code>elan run lldb -- lean ...</code> instead</p>



<a name="196058575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058575">(May 02 2020 at 16:11)</a>:</h4>
<p>Oh hmm, that makes sense but I also seem to recall it just working for me. But maybe I invoked the lean binary directly, not sure.</p>



<a name="196058637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058637">(May 02 2020 at 16:12)</a>:</h4>
<p>It might work, but for one, you can't start "lean" (actually elan) using <code>s</code> and then set a breakpoint on a Lean function, since you're still in the wrong process.</p>



<a name="196058661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058661">(May 02 2020 at 16:12)</a>:</h4>
<p>Or set a breakpoint before <code>s</code> or <code>r</code>, in fact</p>



<a name="196058741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058741">(May 02 2020 at 16:14)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="err">$</span> <span class="n">elan</span> <span class="n">run</span> <span class="n">lldb</span> <span class="c1">-- lean src/sheaf.lean</span>
<span class="n">error</span><span class="o">:</span> <span class="n">toolchain</span> <span class="err">&#39;</span><span class="n">lldb&#39;</span> <span class="n">is</span> <span class="n">not</span> <span class="n">installed</span>
</code></pre></div>



<a name="196058840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058840">(May 02 2020 at 16:17)</a>:</h4>
<p><code>elan</code> requires you to enter the name of the toolchain you want to use e.g. <code>stable</code> or <code>nightly</code> or <code>leanprover-community-lean-3.9.0</code> before the command. I think you may be better off giving the path to the Lean binary though. You can find that out using <code>elan which lean</code>.</p>



<a name="196058847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058847">(May 02 2020 at 16:17)</a>:</h4>
<p>Does elan <code>exec</code> lean?</p>



<a name="196058927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058927">(May 02 2020 at 16:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196058362" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196058362">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> enter <code>r</code> again after that. For whatever reason <code>lldb</code> immediately pauses the program when it starts.</p>
</blockquote>
<p>This worked for me! Not entirely sure what to do with this though</p>



<a name="196058937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058937">(May 02 2020 at 16:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196053650" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196053650">said</a>:</p>
<blockquote>
<p>Probably something like <code>gdb --args lean myfile.lean</code>, then type <code>r</code> and ctrl-C when it starts thinking for a long time</p>
</blockquote>
<p>Here's the output from this:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">sheaf&#39;</span> <span class="err">?</span><span class="n">m_1</span> <span class="err">?</span><span class="n">m_5</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">sheaf&#39;</span> <span class="n">C</span> <span class="n">j</span>
<span class="o">[</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="n">sheaf&#39;</span> <span class="bp">=</span><span class="err">?</span><span class="bp">=</span> <span class="n">sheaf&#39;</span>
<span class="n">r</span>
<span class="n">Process</span> <span class="mi">64955</span> <span class="n">stopped</span>
<span class="bp">*</span> <span class="n">thread</span> <span class="bp">#</span><span class="mi">1</span><span class="o">,</span> <span class="n">queue</span> <span class="bp">=</span> <span class="err">&#39;</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">main</span><span class="bp">-</span><span class="n">thread&#39;</span><span class="o">,</span> <span class="n">stop</span> <span class="n">reason</span> <span class="bp">=</span> <span class="n">signal</span> <span class="n">SIGSTOP</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">0</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00007fff6c473a16</span> <span class="n">libsystem_kernel</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`__</span><span class="n">psynch_cvwait</span> <span class="bp">+</span> <span class="mi">10</span>
<span class="n">libsystem_kernel</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`__</span><span class="n">psynch_cvwait</span><span class="o">:</span>
<span class="bp">-&gt;</span>  <span class="mi">0</span><span class="n">x7fff6c473a16</span> <span class="bp">&lt;+</span><span class="mi">10</span><span class="bp">&gt;</span><span class="o">:</span> <span class="n">jae</span>    <span class="mi">0</span><span class="n">x7fff6c473a20</span>            <span class="bp">;</span> <span class="bp">&lt;+</span><span class="mi">20</span><span class="bp">&gt;</span>
    <span class="mi">0</span><span class="n">x7fff6c473a18</span> <span class="bp">&lt;+</span><span class="mi">12</span><span class="bp">&gt;</span><span class="o">:</span> <span class="n">movq</span>   <span class="err">%</span><span class="n">rax</span><span class="o">,</span> <span class="err">%</span><span class="n">rdi</span>
    <span class="mi">0</span><span class="n">x7fff6c473a1b</span> <span class="bp">&lt;+</span><span class="mi">15</span><span class="bp">&gt;</span><span class="o">:</span> <span class="n">jmp</span>    <span class="mi">0</span><span class="n">x7fff6c46aae9</span>            <span class="bp">;</span> <span class="n">cerror_nocancel</span>
    <span class="mi">0</span><span class="n">x7fff6c473a20</span> <span class="bp">&lt;+</span><span class="mi">20</span><span class="bp">&gt;</span><span class="o">:</span> <span class="n">retq</span>
<span class="n">Target</span> <span class="mi">0</span><span class="o">:</span> <span class="o">(</span><span class="n">lean</span><span class="o">)</span> <span class="n">stopped</span><span class="bp">.</span>
<span class="o">(</span><span class="n">lldb</span><span class="o">)</span> <span class="n">bt</span>
<span class="bp">*</span> <span class="n">thread</span> <span class="bp">#</span><span class="mi">1</span><span class="o">,</span> <span class="n">queue</span> <span class="bp">=</span> <span class="err">&#39;</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">main</span><span class="bp">-</span><span class="n">thread&#39;</span><span class="o">,</span> <span class="n">stop</span> <span class="n">reason</span> <span class="bp">=</span> <span class="n">signal</span> <span class="n">SIGSTOP</span>
  <span class="bp">*</span> <span class="n">frame</span> <span class="bp">#</span><span class="mi">0</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00007fff6c473a16</span> <span class="n">libsystem_kernel</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`__</span><span class="n">psynch_cvwait</span> <span class="bp">+</span> <span class="mi">10</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">1</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00007fff6c63c589</span> <span class="n">libsystem_pthread</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`_</span><span class="n">pthread_cond_wait</span> <span class="bp">+</span> <span class="mi">732</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">2</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00007fff6a277cb0</span> <span class="n">libc</span><span class="bp">++.</span><span class="mi">1</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`</span><span class="n">std</span><span class="bp">::__</span><span class="mi">1</span><span class="bp">::</span><span class="n">condition_variable</span><span class="bp">::</span><span class="n">wait</span><span class="o">(</span><span class="n">std</span><span class="bp">::__</span><span class="mi">1</span><span class="bp">::</span><span class="n">unique_lock</span><span class="bp">&lt;</span><span class="n">std</span><span class="bp">::__</span><span class="mi">1</span><span class="bp">::</span><span class="n">mutex</span><span class="bp">&gt;&amp;</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">18</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">3</span><span class="o">:</span> <span class="mi">0</span><span class="n">x0000000100230dab</span> <span class="n">lean</span><span class="bp">`</span><span class="n">lean</span><span class="bp">::</span><span class="n">mt_task_queue</span><span class="bp">::</span><span class="n">wait_for_finish</span><span class="o">(</span><span class="n">std</span><span class="bp">::__</span><span class="mi">1</span><span class="bp">::</span><span class="n">shared_ptr</span><span class="bp">&lt;</span><span class="n">lean</span><span class="bp">::</span><span class="n">gtask_cell</span><span class="bp">&gt;</span> <span class="n">const</span><span class="bp">&amp;</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">523</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">4</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00000001000055ca</span> <span class="n">lean</span><span class="bp">`</span><span class="n">main</span> <span class="bp">+</span> <span class="mi">9914</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">5</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00007fff6c323015</span> <span class="n">libdyld</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`</span><span class="n">start</span> <span class="bp">+</span> <span class="mi">1</span>
    <span class="n">frame</span> <span class="bp">#</span><span class="mi">6</span><span class="o">:</span> <span class="mi">0</span><span class="n">x00007fff6c323015</span> <span class="n">libdyld</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">`</span><span class="n">start</span> <span class="bp">+</span> <span class="mi">1</span>
<span class="o">(</span><span class="n">lldb</span><span class="o">)</span>
</code></pre></div>



<a name="196058983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196058983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196058983">(May 02 2020 at 16:20)</a>:</h4>
<p>(deleted)</p>



<a name="196059035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196059035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196059035">(May 02 2020 at 16:22)</a>:</h4>
<p>Ah, <code>elan run</code> doesn't actually change the path, that's disappointing. We're planning to use it for Lean 4 development, so I hoped I could invoke gdb that way. <code>gdb/lldb $(elan which lean)</code> should work, however.</p>



<a name="196059160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196059160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196059160">(May 02 2020 at 16:24)</a>:</h4>
<p>Apologies for the presumably stupid questions, this sort of thing is very much outside my wheelhouse</p>



<a name="196059240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196059240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196059240">(May 02 2020 at 16:26)</a>:</h4>
<p>Seems like lldb is showing you the wrong thread. This just worked for me on linux...</p>



<a name="196060511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060511">(May 02 2020 at 16:59)</a>:</h4>
<p>Okay, I managed to build your project and get a stack trace, and it's 400 levels deep in is_def_eq stuff</p>



<a name="196060554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060554">(May 02 2020 at 17:00)</a>:</h4>
<p>It's possible I didn't wait long enough before interrupting it though</p>



<a name="196060705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060705">(May 02 2020 at 17:02)</a>:</h4>
<p>I kept the <code>type_context.is_def_eq_detail</code>, and interrupted when it stopped printing lines</p>



<a name="196060714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060714">(May 02 2020 at 17:03)</a>:</h4>
<p>there were ~3612 lines</p>



<a name="196060720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060720">(May 02 2020 at 17:03)</a>:</h4>
<p>Specifically there's a lot of <code>lean::type_checker::is_def_eq_core(lean::expr const&amp;, lean::expr const&amp;)</code> involved</p>



<a name="196060738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060738">(May 02 2020 at 17:03)</a>:</h4>
<p>It's all inside <code>lean::abstract_nested_proofs_fn::visit(lean::expr const&amp;)</code></p>



<a name="196060783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060783">(May 02 2020 at 17:04)</a>:</h4>
<p>Is this the kernel or the elaborator?</p>



<a name="196060808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196060808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196060808">(May 02 2020 at 17:05)</a>:</h4>
<p>I have no idea</p>



<a name="196061551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196061551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196061551">(May 02 2020 at 17:23)</a>:</h4>
<p>Looks like it is the kernel</p>



<a name="196086334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196086334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196086334">(May 03 2020 at 05:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196058296" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/196058296">said</a>:<br>
I'll move my work to a different branch, and keep that branch fixed. That is, the error is (and will remain) <a href="https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean#L261" title="https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean#L261">https://github.com/b-mehta/topos/blob/sheaf/src/sheaf.lean#L261</a></p>
<p>By the way, this is what tags are for, rather than branches - branches are inherently mutable and tags are inherently immutable</p>



<a name="196102364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196102364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196102364">(May 03 2020 at 12:59)</a>:</h4>
<p>TIL, thanks</p>



<a name="196127035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196127035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196127035">(May 03 2020 at 22:48)</a>:</h4>
<p>I've got the proof to work! I'm not entirely sure what fixed it, but here's my current guess: <code>sheaf</code> is defined like this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">sheaf&#39;</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span>
<span class="o">(</span><span class="n">unique_extend</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">B</span> <span class="n">B&#39;</span><span class="o">}</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">B&#39;</span> <span class="err">⟶</span> <span class="n">B</span><span class="o">)</span> <span class="n">f&#39;</span> <span class="o">[</span><span class="n">closure</span><span class="bp">.</span><span class="n">dense</span> <span class="n">j</span> <span class="n">m</span><span class="o">],</span> <span class="n">unique</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">B</span> <span class="err">⟶</span> <span class="n">A</span> <span class="bp">//</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f&#39;</span><span class="o">})</span>

<span class="n">def</span> <span class="n">forget_sheaf</span> <span class="o">:</span> <span class="n">sheaf&#39;</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span> <span class="n">j</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">sheaf&#39;</span><span class="bp">.</span><span class="n">A</span>

<span class="n">def</span> <span class="n">sheaf</span> <span class="o">:=</span> <span class="n">induced_category</span> <span class="n">C</span> <span class="o">(</span><span class="n">forget_sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">sheaf_category</span><span class="bp">.</span><span class="n">category</span> <span class="o">:</span> <span class="n">category</span> <span class="o">(</span><span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:=</span> <span class="n">induced_category</span><span class="bp">.</span><span class="n">category</span> <span class="bp">_</span>
<span class="n">def</span> <span class="n">forget</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="err">⥤</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">induced_functor</span> <span class="bp">_</span>
</code></pre></div>


<p>The change I made was to have a named constructor and deconstructors for <code>sheaf</code>, and then make <code>sheaf</code> irreducible</p>



<a name="196128052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196128052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196128052">(May 03 2020 at 23:17)</a>:</h4>
<p>Weird/interesting</p>



<a name="196128097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196128097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196128097">(May 03 2020 at 23:18)</a>:</h4>
<p>We could just make <code>induced_category</code> itself do that, I suppose</p>



<a name="196128098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196128098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196128098">(May 03 2020 at 23:18)</a>:</h4>
<p>but I don't see why it would have mattered</p>



<a name="196129923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/196129923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#196129923">(May 04 2020 at 00:10)</a>:</h4>
<p>I can't say for sure that that was the cause but I think it was this. I also have a suspicion that there was some weirdness going on with my (local) cartesian closed instances but I couldn't confirm it...</p>



<a name="224824551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224824551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224824551">(Feb 02 2021 at 03:30)</a>:</h4>
<p>I'm getting essentially the same problem as in the original post here, but in a very different context. Specifically, the end of the proof seems to work fine, but I get a deterministic timeout on the lemma statement and nowhere else. Putting a sorry before the <code>end</code> says no goals, and there's no timeout. <code>recover</code> gives nothing helpful. The statement isn't building any data - it's a proof of <code>function.surjective</code>, and it's a <code>lemma</code>.  Further, importing this file gives a timeout at the import line, and anything transitively imported through it doesn't appear (that is, A is imported by B which is imported by C, and B has this weird proof; imports from A aren't recognised in C), but again adding a sorry before the end of the proof makes the transitive imports work again.</p>



<a name="224824556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224824556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224824556">(Feb 02 2021 at 03:31)</a>:</h4>
<p>I haven't been able to minimise, but you can replicate this with <a href="https://github.com/leanprover-community/mathlib/blob/really-flat/src/category_theory/limits/filtered_colimit_commutes_finite_limit2.lean">https://github.com/leanprover-community/mathlib/blob/really-flat/src/category_theory/limits/filtered_colimit_commutes_finite_limit2.lean</a></p>



<a name="224824583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224824583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224824583">(Feb 02 2021 at 03:31)</a>:</h4>
<p>and you can get the import weirdness by looking in <a href="https://github.com/leanprover-community/mathlib/blob/really-flat/src/category_theory/limits/flat.lean">https://github.com/leanprover-community/mathlib/blob/really-flat/src/category_theory/limits/flat.lean</a> on that same branch</p>



<a name="224824773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224824773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224824773">(Feb 02 2021 at 03:33)</a>:</h4>
<p>Wait, the import strangeness isn't happening for me now...</p>



<a name="224824865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224824865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224824865">(Feb 02 2021 at 03:34)</a>:</h4>
<p>oh it's happening again, I think there were old oleans</p>



<a name="224824910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224824910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224824910">(Feb 02 2021 at 03:35)</a>:</h4>
<p>but building the file using <code>lean --make</code> doesn't give a timeout</p>



<a name="224873025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224873025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224873025">(Feb 02 2021 at 13:50)</a>:</h4>
<p>I don't have any problems with the <code>really-flat</code> branch -- i.e. I can't reproduce. I checked it out, got oleans from azure, built <code>category_theory.limits.filtered_colimit_commutes_finite_limit2</code> on the command line, opened it in VS Code and I see no errors either in the command line build or on VS Code. Maybe nuke all olean files, get them from azure and then build?</p>



<a name="224873232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224873232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224873232">(Feb 02 2021 at 13:52)</a>:</h4>
<p>Similarly I have no problems with <code>category_theory.limits.flat</code>, no warnings or errors in VS Code. This is commit <code>61a478271e967097e3d82819b2f6f7e8c04f2932</code>. Hopefully happiness is just around the corner for you :-)</p>



<a name="224873523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/224873523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#224873523">(Feb 02 2021 at 13:54)</a>:</h4>
<p>Huh, I guess what's happening is that azure builds them from command line where the timeout doesn't happen, and if you download the oleans it all works fine</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>