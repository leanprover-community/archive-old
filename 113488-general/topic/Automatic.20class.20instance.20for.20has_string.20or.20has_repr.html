---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html">Automatic class instance for has_string or has_repr</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="199326180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199326180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199326180">(May 31 2020 at 23:43)</a>:</h4>
<p>Is there a way to automatically generate the instances <code>has_string</code> or <code>has_repr</code> for inductive and structure types (assuming the types they use for the arguments also have <code>has_string</code> and <code>has_repr</code>)?  I know Rust for example has an autogenerated <code>debug</code> type class thing that lets you make a representation for standard classes (forgetting the proper Rust terminology).  Does Lean have something similar?</p>



<a name="199326353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199326353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199326353">(May 31 2020 at 23:47)</a>:</h4>
<p>Rust: <a href="https://doc.rust-lang.org/std/fmt/trait.Debug.html">https://doc.rust-lang.org/std/fmt/trait.Debug.html</a><br>
Python: Can do it with the<code>@dataclass(repr=True)</code> decorator: <a href="https://docs.python.org/3/library/dataclasses.html">https://docs.python.org/3/library/dataclasses.html</a><br>
Lean: ???</p>



<a name="199326408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199326408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199326408">(May 31 2020 at 23:49)</a>:</h4>
<p>Haskell can do this by <code>deriving Show</code>, maybe we could adapt the method that uses</p>



<a name="199326477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199326477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199326477">(May 31 2020 at 23:51)</a>:</h4>
<p>Lean has derive handlers, but I don't know how to find one for:<br>
<code>@[derive [has_repr]]</code></p>



<a name="199327188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199327188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199327188">(Jun 01 2020 at 00:13)</a>:</h4>
<p>I realize I don't even know where <code>@[derive [monad]]</code> comes from.  I tried searching in both <code>lean</code> and <code>mathlib</code> and I came up short.  Is there a list of all the current derive handlers (and how to import them)?</p>



<a name="199327429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199327429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199327429">(Jun 01 2020 at 00:20)</a>:</h4>
<p>I'm not really sure how they work, but it looks like "derive handlers" are set up in <a href="https://github.com/leanprover-community/lean/blob/ad780aa74474edb344f3a5605db1ed73310ad7a9/library/init/meta/derive.lean">core</a>. Searching for the <code>derive_handler</code> attribute might help.</p>
<p>It would be good to add some docs on this.</p>



<a name="199327456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199327456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199327456">(Jun 01 2020 at 00:21)</a>:</h4>
<p>I don't think there is any structural way to derive <code>monad</code>--I think we have a default handler that just copies the instance from the right-hand-side of the definition</p>



<a name="199327898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199327898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199327898">(Jun 01 2020 at 00:36)</a>:</h4>
<p>Ok, so one doesn't need a derive handler if the right-hand-side already has the desired instance? That explains <code>monad</code>.  I think we have very few right now.  Maybe one day I'll get around to writing one for <code>has_repr</code>.  (I might cheat first and make one in python that just spits out the instance code I want.)</p>



<a name="199329732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199329732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199329732">(Jun 01 2020 at 01:33)</a>:</h4>
<p>No, you do need a derive handler, but there is a blanket derive handler for proof by unfolding</p>



<a name="199329780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199329780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199329780">(Jun 01 2020 at 01:34)</a>:</h4>
<p>Examples of "real" derive handlers include <code>inhabited</code>, <code>decidable_eq</code> and <code>has_reflect</code></p>



<a name="199331749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199331749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199331749">(Jun 01 2020 at 02:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Are to saying there is a way to get has_repr (or similar functionality) without a derive handler?  If so, how?</p>



<a name="199331755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199331755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199331755">(Jun 01 2020 at 02:33)</a>:</h4>
<p>I'm saying you have to write your own derive handler, which is just a tactic that does this construction</p>



<a name="199331767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199331767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199331767">(Jun 01 2020 at 02:33)</a>:</h4>
<p>you can register your own derive handlers</p>



<a name="199331774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Automatic%20class%20instance%20for%20has_string%20or%20has_repr/near/199331774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Automatic.20class.20instance.20for.20has_string.20or.20has_repr.html#199331774">(Jun 01 2020 at 02:33)</a>:</h4>
<p>Sorry, I read the “No, you do” as “No you do not”.  :facepalm:</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>