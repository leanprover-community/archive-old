---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Queue.20histograms.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html">Queue histograms</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="290109413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290109413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290109413">(Jul 19 2022 at 14:46)</a>:</h4>
<p>Can we generate histograms about how long PRs are ope?. And/or how long PRs have to wait for a review after being labeled <code>awaiting-review</code>? Because those are metrics we care about. The length of <a href="https://bit.ly/3AZk1Qk">#queue</a> is just a proxy. Any GitHub API experts around who know how to do this?</p>



<a name="290123958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290123958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290123958">(Jul 19 2022 at 16:18)</a>:</h4>
<p>Working on it</p>



<a name="290125623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290125623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290125623">(Jul 19 2022 at 16:30)</a>:</h4>
<p><a href="/user_uploads/3121/XZ4GDPoknEddF-BQYY9QVq5l/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/XZ4GDPoknEddF-BQYY9QVq5l/image.png" title="image.png"><img src="/user_uploads/3121/XZ4GDPoknEddF-BQYY9QVq5l/image.png"></a></div>



<a name="290125684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290125684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290125684">(Jul 19 2022 at 16:30)</a>:</h4>
<p>I don't know about how to track label-change events, so I don't know how to answer your second question</p>



<a name="290125724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290125724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290125724">(Jul 19 2022 at 16:31)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">gh</span> <span class="n">pr</span> <span class="n">list</span> <span class="c1">--state all --limit 5000 --json number,createdAt,closedAt,labels &gt; prs.json</span>
<span class="n">python</span> <span class="n">pres.py</span> <span class="n">prs.json</span> <span class="n">prs.csv</span>
</code></pre></div>



<a name="290125742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290125742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290125742">(Jul 19 2022 at 16:31)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">csv</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="n">entries</span> <span class="bp">=</span> <span class="o">[]</span>
<span class="n">labels</span> <span class="bp">=</span> <span class="n">set</span><span class="o">()</span>
<span class="n">for</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">json.load</span><span class="o">(</span><span class="kn">open</span><span class="o">(</span><span class="n">sys.argv</span><span class="o">[</span><span class="mi">1</span><span class="o">])):</span>
  <span class="n">entry</span><span class="o">[</span><span class="s2">"labels"</span><span class="o">]</span> <span class="bp">=</span> <span class="o">[</span><span class="n">label</span><span class="o">[</span><span class="s2">"name"</span><span class="o">]</span> <span class="n">for</span> <span class="n">label</span> <span class="k">in</span> <span class="n">entry</span><span class="o">[</span><span class="s2">"labels"</span><span class="o">]]</span>
  <span class="n">labels.update</span><span class="o">(</span><span class="n">entry</span><span class="o">[</span><span class="s2">"labels"</span><span class="o">])</span>
  <span class="n">entries.append</span><span class="o">(</span><span class="n">entry</span><span class="o">)</span>
<span class="n">for</span> <span class="n">entry</span> <span class="k">in</span> <span class="n">entries</span><span class="o">:</span>
  <span class="n">for</span> <span class="n">label</span> <span class="k">in</span> <span class="n">labels</span><span class="o">:</span>
    <span class="n">entry</span><span class="o">[</span><span class="n">label</span><span class="o">]</span> <span class="bp">=</span> <span class="n">label</span> <span class="k">in</span> <span class="n">entry</span><span class="o">[</span><span class="s2">"labels"</span><span class="o">]</span>
  <span class="n">del</span> <span class="n">entry</span><span class="o">[</span><span class="s2">"labels"</span><span class="o">]</span>

<span class="n">writer</span> <span class="bp">=</span> <span class="n">csv.DictWriter</span><span class="o">(</span><span class="kn">open</span><span class="o">(</span><span class="n">sys.argv</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span> <span class="s2">"w"</span><span class="o">),</span> <span class="n">fieldnames</span><span class="bp">=</span><span class="o">[</span><span class="s2">"number"</span><span class="o">,</span> <span class="s2">"closedAt"</span><span class="o">,</span> <span class="s2">"createdAt"</span><span class="o">]</span> <span class="bp">+</span> <span class="n">sorted</span><span class="o">(</span><span class="n">labels</span><span class="o">))</span>

<span class="n">writer.writeheader</span><span class="o">()</span>
<span class="n">writer.writerows</span><span class="o">(</span><span class="n">entries</span><span class="o">)</span>
</code></pre></div>



<a name="290125770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290125770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290125770">(Jul 19 2022 at 16:31)</a>:</h4>
<p>Excuse the sloppy python code, just trying to crank something out fast</p>



<a name="290125950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290125950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290125950">(Jul 19 2022 at 16:32)</a>:</h4>
<p>This plot indicates that our PR creation flux has been pretty constant over the past 5K PRs<br>
<a href="/user_uploads/3121/2xVdRNmuomHX1X8iuGBwKBUq/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/2xVdRNmuomHX1X8iuGBwKBUq/image.png" title="image.png"><img src="/user_uploads/3121/2xVdRNmuomHX1X8iuGBwKBUq/image.png"></a></div>



<a name="290126015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290126015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290126015">(Jul 19 2022 at 16:33)</a>:</h4>
<p><a href="/user_uploads/3121/R1Npr1pm-FA7L6ktL2pu0TAo/prs.csv">prs.csv</a> <a href="/user_uploads/3121/un14GmGt_60WusERqKx5MgcJ/prs.json">prs.json</a></p>



<a name="290130311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130311">(Jul 19 2022 at 17:02)</a>:</h4>
<p>Here's the code to get the label changes -- but I have now hit my GH API limit, and am barred from making more requests for idk how long:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">csv</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="k">from</span> <span class="n">requests.adapters</span> <span class="kn">import</span> <span class="n">HTTPAdapter</span><span class="o">,</span> <span class="n">Retry</span>


<span class="n">events</span> <span class="bp">=</span> <span class="o">[]</span>

<span class="n">writer</span> <span class="bp">=</span> <span class="n">csv.DictWriter</span><span class="o">(</span><span class="kn">open</span><span class="o">(</span><span class="n">sys.argv</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span> <span class="s2">"w"</span><span class="o">),</span>
  <span class="n">fieldnames</span><span class="bp">=</span><span class="o">[</span><span class="s2">"action"</span><span class="o">,</span> <span class="s2">"created_at"</span><span class="o">,</span> <span class="s2">"number"</span><span class="o">,</span> <span class="s2">"label"</span><span class="o">])</span>
<span class="n">writer.writeheader</span><span class="o">()</span>

<span class="n">session</span> <span class="bp">=</span> <span class="n">requests.Session</span><span class="o">()</span>
<span class="n">retries</span> <span class="bp">=</span> <span class="n">Retry</span><span class="o">(</span><span class="n">total</span><span class="bp">=</span><span class="mi">5</span><span class="o">,</span> <span class="n">backoff_factor</span><span class="bp">=</span><span class="mi">1</span><span class="o">,</span> <span class="n">status_forcelist</span><span class="bp">=</span><span class="o">[</span><span class="mi">500</span><span class="o">,</span> <span class="mi">403</span><span class="o">])</span>
<span class="n">session.mount</span><span class="o">(</span><span class="s2">"https://"</span><span class="o">,</span> <span class="n">HTTPAdapter</span><span class="o">(</span><span class="n">max_retries</span><span class="bp">=</span><span class="n">retries</span><span class="o">))</span>

<span class="n">per_page</span> <span class="bp">=</span> <span class="mi">100</span>
<span class="n">pages</span> <span class="bp">=</span> <span class="mi">100</span> <span class="bp">//</span> <span class="n">per_page</span>
<span class="n">for</span> <span class="n">page</span> <span class="k">in</span> <span class="n">range</span><span class="o">(</span><span class="n">pages</span><span class="o">):</span>
  <span class="n">resp</span> <span class="bp">=</span> <span class="n">session.get</span><span class="o">(</span>
    <span class="s2">"https://api.github.com/repos/leanprover-community/mathlib/issues/events"</span><span class="o">,</span>
    <span class="n">headers</span><span class="bp">=</span><span class="o">{</span><span class="s2">"Accept"</span><span class="o">:</span> <span class="s2">"application/vnd.github+json"</span><span class="o">},</span>
    <span class="n">params</span><span class="bp">=</span><span class="o">{</span><span class="s2">"per_page"</span><span class="o">:</span> <span class="n">per_page</span><span class="o">,</span> <span class="s2">"page"</span><span class="o">:</span> <span class="n">page</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span>  <span class="bp">#</span> <span class="n">github</span> <span class="n">starts</span> <span class="n">at</span> <span class="mi">1</span>
  <span class="o">)</span>
  <span class="n">print</span><span class="o">(</span><span class="n">resp</span><span class="o">)</span>
  <span class="n">for</span> <span class="n">event</span> <span class="k">in</span> <span class="n">resp.json</span><span class="o">():</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">[</span><span class="s2">"event"</span><span class="o">]</span> <span class="n">not</span> <span class="k">in</span> <span class="o">[</span><span class="s2">"unlabeled"</span><span class="o">,</span> <span class="s2">"labeled"</span><span class="o">]:</span>
      <span class="n">continue</span>
    <span class="n">mini_event</span> <span class="bp">=</span> <span class="o">{}</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"action"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"event"</span><span class="o">]</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"created_at"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"created_at"</span><span class="o">]</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"number"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"issue"</span><span class="o">][</span><span class="s2">"number"</span><span class="o">]</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"label"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"label"</span><span class="o">][</span><span class="s2">"name"</span><span class="o">]</span>
    <span class="n">events.append</span><span class="o">(</span><span class="n">mini_event</span><span class="o">)</span>
    <span class="n">writer.writerow</span><span class="o">(</span><span class="n">mini_event</span><span class="o">)</span>
</code></pre></div>



<a name="290130339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130339">(Jul 19 2022 at 17:02)</a>:</h4>
<p>That's based on <a href="https://docs.github.com/en/rest/issues/events">https://docs.github.com/en/rest/issues/events</a></p>



<a name="290130410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130410">(Jul 19 2022 at 17:02)</a>:</h4>
<p><span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> Thanks! What is the <code>y</code>-axis in that diagram 2 posts up?</p>



<a name="290130452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130452">(Jul 19 2022 at 17:03)</a>:</h4>
<p>the tiny bar chart?</p>



<a name="290130481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130481">(Jul 19 2022 at 17:03)</a>:</h4>
<p>Just the count of PRs for each bin</p>



<a name="290130632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130632">(Jul 19 2022 at 17:04)</a>:</h4>
<p>Aha. So it doesn't yet tell us how long PRs are open on average.</p>



<a name="290130671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130671">(Jul 19 2022 at 17:04)</a>:</h4>
<p>That was the other bar chart</p>



<a name="290130691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130691">(Jul 19 2022 at 17:04)</a>:</h4>
<p><a href="/user_uploads/3121/fOb9O8ODNyBkBZ7OwWtzl9d-/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/fOb9O8ODNyBkBZ7OwWtzl9d-/image.png" title="image.png"><img src="/user_uploads/3121/fOb9O8ODNyBkBZ7OwWtzl9d-/image.png"></a></div>



<a name="290130768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130768">(Jul 19 2022 at 17:05)</a>:</h4>
<p>Ooh, I see. And that is "number of days" along the y-axis?</p>



<a name="290130919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130919">(Jul 19 2022 at 17:06)</a>:</h4>
<p>The y axis is binning -- there is a hypothesis that the <code>closedAt - createdAt</code> delta has changed over time</p>



<a name="290130958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130958">(Jul 19 2022 at 17:06)</a>:</h4>
<p>The y axis is, for each bin, the median of that delta over that bin</p>



<a name="290130977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290130977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290130977">(Jul 19 2022 at 17:07)</a>:</h4>
<p>Separating out PRs labeled with <code>easy</code> (at time of close)</p>



<a name="290131633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290131633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290131633">(Jul 19 2022 at 17:11)</a>:</h4>
<p>Here it is more clearly:<br>
<a href="/user_uploads/3121/Ih37eTo1JWsf5MVKijyE7EVP/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/Ih37eTo1JWsf5MVKijyE7EVP/image.png" title="image.png"><img src="/user_uploads/3121/Ih37eTo1JWsf5MVKijyE7EVP/image.png"></a></div>



<a name="290131652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290131652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290131652">(Jul 19 2022 at 17:11)</a>:</h4>
<p>I've hidden the outliers on the top</p>



<a name="290132522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290132522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290132522">(Jul 19 2022 at 17:18)</a>:</h4>
<p>So what does <code>median</code> mean exactly? Does it mean that in February the median was 81 days for a PR to be merged?</p>



<a name="290132907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290132907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290132907">(Jul 19 2022 at 17:21)</a>:</h4>
<p>Sorry, the most recent plot was in hours</p>



<a name="290133051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290133051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290133051">(Jul 19 2022 at 17:22)</a>:</h4>
<p>That in february, the median time for a PR to go from created to closed was 81 hrs if it is not labeled as <code>easy</code>, and 6 hrs if <code>easy</code></p>



<a name="290133118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290133118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290133118">(Jul 19 2022 at 17:23)</a>:</h4>
<p>I haven't differentiated "closed due to bors merge" and "closed due to user closing it without merge". My expectation is that the latter are way fewer than former. But that is why I am using median and not mean</p>



<a name="290133155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290133155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290133155">(Jul 19 2022 at 17:23)</a>:</h4>
<p>Because I assume the latter are not distributed in the way the former are</p>



<a name="290134222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290134222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290134222">(Jul 19 2022 at 17:32)</a>:</h4>
<p>I guess you didn't auth with github in your example? That probably leads to the rate limit being hit sooner</p>



<a name="290134400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290134400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290134400">(Jul 19 2022 at 17:33)</a>:</h4>
<p>I was hitting 200 for a while, then 500 (set up retry), but then started to hit 403. I guess I am not passing the token that is in my shell, you're right</p>



<a name="290134911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290134911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290134911">(Jul 19 2022 at 17:37)</a>:</h4>
<p>Aah, 81 hrs makes a lot more sense.</p>



<a name="290135089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290135089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290135089">(Jul 19 2022 at 17:39)</a>:</h4>
<p>I think this is a very useful chart! Thanks for building it!</p>



<a name="290141043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290141043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290141043">(Jul 19 2022 at 18:27)</a>:</h4>
<p>Thanks to Eric's comment, I got the labelling events out. An example of a viz:<br>
<a href="/user_uploads/3121/c-p8mHEqrGX6IKe_-AWA9bn3/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/c-p8mHEqrGX6IKe_-AWA9bn3/image.png" title="image.png"><img src="/user_uploads/3121/c-p8mHEqrGX6IKe_-AWA9bn3/image.png"></a></div>



<a name="290141057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290141057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290141057">(Jul 19 2022 at 18:28)</a>:</h4>
<p><a href="/user_uploads/3121/-IoxDneud6JhrUUpS2ju13aF/labels.csv">labels.csv</a></p>



<a name="290141111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290141111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290141111">(Jul 19 2022 at 18:28)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">csv</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="k">from</span> <span class="n">requests.adapters</span> <span class="kn">import</span> <span class="n">HTTPAdapter</span><span class="o">,</span> <span class="n">Retry</span>

<span class="n">writer</span> <span class="bp">=</span> <span class="n">csv.DictWriter</span><span class="o">(</span><span class="kn">open</span><span class="o">(</span><span class="n">sys.argv</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span> <span class="s2">"w"</span><span class="o">),</span>
  <span class="n">fieldnames</span><span class="bp">=</span><span class="o">[</span><span class="s2">"action"</span><span class="o">,</span> <span class="s2">"created_at"</span><span class="o">,</span> <span class="s2">"number"</span><span class="o">,</span> <span class="s2">"label"</span><span class="o">])</span>
<span class="n">writer.writeheader</span><span class="o">()</span>

<span class="n">session</span> <span class="bp">=</span> <span class="n">requests.Session</span><span class="o">()</span>
<span class="n">retries</span> <span class="bp">=</span> <span class="n">Retry</span><span class="o">(</span><span class="n">total</span><span class="bp">=</span><span class="mi">5</span><span class="o">,</span> <span class="n">backoff_factor</span><span class="bp">=</span><span class="mi">1</span><span class="o">,</span> <span class="n">status_forcelist</span><span class="bp">=</span><span class="o">[</span><span class="mi">500</span><span class="o">])</span>
<span class="n">session.mount</span><span class="o">(</span><span class="s2">"https://"</span><span class="o">,</span> <span class="n">HTTPAdapter</span><span class="o">(</span><span class="n">max_retries</span><span class="bp">=</span><span class="n">retries</span><span class="o">))</span>

<span class="n">per_page</span> <span class="bp">=</span> <span class="mi">100</span>
<span class="n">page</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="n">in_range</span> <span class="bp">=</span> <span class="n">True</span>
<span class="n">while</span> <span class="n">in_range</span><span class="o">:</span>
  <span class="n">page</span> <span class="bp">+=</span> <span class="mi">1</span>
  <span class="n">resp</span> <span class="bp">=</span> <span class="n">session.get</span><span class="o">(</span>
    <span class="s2">"https://api.github.com/repos/leanprover-community/mathlib/issues/events"</span><span class="o">,</span>
    <span class="n">headers</span><span class="bp">=</span><span class="o">{</span><span class="s2">"Accept"</span><span class="o">:</span> <span class="s2">"application/vnd.github+json"</span><span class="o">,</span> <span class="s2">"Authorization"</span><span class="o">:</span> <span class="n">f</span><span class="s2">"token {token}"</span><span class="o">},</span>
    <span class="n">params</span><span class="bp">=</span><span class="o">{</span><span class="s2">"per_page"</span><span class="o">:</span> <span class="n">per_page</span><span class="o">,</span> <span class="s2">"page"</span><span class="o">:</span> <span class="n">page</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span>  <span class="bp">#</span> <span class="n">github</span> <span class="n">starts</span> <span class="n">at</span> <span class="mi">1</span>
  <span class="o">)</span>
  <span class="n">for</span> <span class="n">event</span> <span class="k">in</span> <span class="n">resp.json</span><span class="o">():</span>
    <span class="n">print</span><span class="o">(</span><span class="n">resp</span><span class="o">)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">[</span><span class="s2">"event"</span><span class="o">]</span> <span class="n">not</span> <span class="k">in</span> <span class="o">[</span><span class="s2">"unlabeled"</span><span class="o">,</span> <span class="s2">"labeled"</span><span class="o">]:</span>
      <span class="n">continue</span>
    <span class="n">mini_event</span> <span class="bp">=</span> <span class="o">{}</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"action"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"event"</span><span class="o">]</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"created_at"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"created_at"</span><span class="o">]</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"number"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"issue"</span><span class="o">][</span><span class="s2">"number"</span><span class="o">]</span>
    <span class="n">mini_event</span><span class="o">[</span><span class="s2">"label"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">event</span><span class="o">[</span><span class="s2">"label"</span><span class="o">][</span><span class="s2">"name"</span><span class="o">]</span>
    <span class="n">writer.writerow</span><span class="o">(</span><span class="n">mini_event</span><span class="o">)</span>
    <span class="k">if</span> <span class="n">datetime.fromisoformat</span><span class="o">(</span><span class="n">mini_event</span><span class="o">[</span><span class="s2">"created_at"</span><span class="o">][:</span><span class="bp">-</span><span class="mi">1</span><span class="o">])</span> <span class="bp">&lt;</span> <span class="n">datetime</span><span class="o">(</span><span class="mi">2022</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">):</span>
      <span class="n">in_range</span> <span class="bp">=</span> <span class="n">False</span>
</code></pre></div>



<a name="290143213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290143213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290143213">(Jul 19 2022 at 18:44)</a>:</h4>
<p>Johan, are you sure you want the "when's the earliest <code>awaiting-review</code>"? It's like minutes between PR creating to labeling as <code>awaiting-review</code></p>



<a name="290143640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290143640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290143640">(Jul 19 2022 at 18:48)</a>:</h4>
<p>As viz'd here, separate bins per month and whether <code>(earliest-awaiting-review-label - PR-creation) &lt; 5</code> <a href="/user_uploads/3121/xrSUBh85qITO47hUWQ7isv26/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/xrSUBh85qITO47hUWQ7isv26/image.png" title="image.png"><img src="/user_uploads/3121/xrSUBh85qITO47hUWQ7isv26/image.png"></a></div>



<a name="290146292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290146292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290146292">(Jul 19 2022 at 19:07)</a>:</h4>
<p>If you haven't done it already, something that would be nice to see is time between <code>awaiting-review</code> and any change in status (label change or closure). Individual PRs might have multiple of these intervals.</p>



<a name="290146402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290146402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290146402">(Jul 19 2022 at 19:08)</a>:</h4>
<p>Earliest <code>awaiting-review</code> or the latest?</p>



<a name="290146505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290146505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290146505">(Jul 19 2022 at 19:09)</a>:</h4>
<p>for every <code>awaiting-review</code>, what's the time to the first change in status?</p>



<a name="290147707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290147707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290147707">(Jul 19 2022 at 19:18)</a>:</h4>
<p>Unfortunately, that's all the time I had today for these analyses. Given the csvs I attached earlier, I hope that they're enough to answer</p>



<a name="290150006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290150006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290150006">(Jul 19 2022 at 19:36)</a>:</h4>
<p>Thanks! That's already very useful!</p>



<a name="290164456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290164456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290164456">(Jul 19 2022 at 21:37)</a>:</h4>
<p>Here's an attempt at visualizing lengths of review cycles, which is an interval of time when 'awaiting-review' is present, starting after the last 'awaiting-author', 'blocked-by-other-PR', 'awaiting-CI', 'CI', 'merge-conflict', 'help wanted', or 'WIP' was removed, ending when either 'awaiting-review' is removed or 'ready-to-merge' or 'ready-for-bors' are added.</p>
<p>To get a sense of distributions, for each month in Yakov's data (<code>labels.csv</code>) I have the review cycles in sorted order, and the y-axis is in days. (So the x-axis is just the index of a given review cycle in sorted order.) A review cycle is recorded in the month it ends.</p>
<p><a href="/user_uploads/3121/v87ltegtChGRqM6f7bQcf-6m/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/v87ltegtChGRqM6f7bQcf-6m/image.png" title="image.png"><img src="/user_uploads/3121/v87ltegtChGRqM6f7bQcf-6m/image.png"></a></div>



<a name="290164540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290164540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290164540">(Jul 19 2022 at 21:38)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>code</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">prs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"labels.csv"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">entry</span><span class="p">))</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'number'</span><span class="p">],</span> <span class="p">{</span><span class="s1">'actions'</span> <span class="p">:</span> <span class="p">[]})</span>
        <span class="n">pr</span><span class="p">[</span><span class="s1">'actions'</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'action'</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">'label'</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>

<span class="k">def</span> <span class="nf">yield_reviews</span><span class="p">(</span><span class="n">pr</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">pr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">'labeled'</span> <span class="ow">and</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">'awaiting-review'</span><span class="p">:</span>
            <span class="c1"># begin review</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">'unlabeled'</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'awaiting-author'</span><span class="p">,</span> <span class="s1">'blocked-by-other-PR'</span><span class="p">,</span> <span class="s1">'awaiting-CI'</span><span class="p">,</span> <span class="s1">'CI'</span><span class="p">,</span> <span class="s1">'merge-conflict'</span><span class="p">,</span> <span class="s1">'help wanted'</span><span class="p">,</span> <span class="s1">'WIP'</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># in review, but this is actual start of review cycle</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s1">'unlabeled'</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'awaiting-review'</span><span class="p">,))</span> \
             <span class="ow">or</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s1">'labeled'</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'ready-to-merge'</span><span class="p">,</span> <span class="s1">'ready-for-bors'</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># in review, end of review cycle</span>
                <span class="k">yield</span> <span class="n">time</span><span class="p">,</span> <span class="n">time</span> <span class="o">-</span> <span class="n">start</span>
                <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s1">'unlabeled'</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'ready-to-merge'</span><span class="p">,</span> <span class="s1">'ready-for-bors'</span><span class="p">))</span> \
             <span class="ow">or</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="s1">'labeled'</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'awaiting-author'</span><span class="p">,</span> <span class="s1">'blocked-by-other-PR'</span><span class="p">,</span> <span class="s1">'awaiting-CI'</span><span class="p">,</span> <span class="s1">'CI'</span><span class="p">,</span> <span class="s1">'merge-conflict'</span><span class="p">,</span> <span class="s1">'help wanted'</span><span class="p">,</span> <span class="s1">'WIP'</span><span class="p">)):</span>
            <span class="c1"># no change to state</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">'RFC'</span><span class="p">,</span><span class="s1">'meta'</span><span class="p">,</span><span class="s1">'modifies-tactic-syntax'</span><span class="p">,</span><span class="s1">'delegated'</span><span class="p">,</span><span class="s1">'easy'</span><span class="p">,</span><span class="s1">'please-adopt'</span><span class="p">,</span><span class="s1">'feature-request'</span><span class="p">,</span><span class="s1">'docs'</span><span class="p">,</span><span class="s1">'needs-documentation'</span><span class="p">,</span><span class="s1">'good-first-project'</span><span class="p">,</span><span class="s1">'review-in-progress'</span><span class="p">,</span><span class="s1">'maybe-later'</span><span class="p">,</span><span class="s1">'not-ready-to-merge'</span><span class="p">,</span><span class="s1">'duplicate'</span><span class="p">,</span><span class="s1">'lintfix'</span><span class="p">,</span><span class="s1">'linter'</span><span class="p">,</span><span class="s1">'bug'</span><span class="p">,</span><span class="s1">'undergrad'</span><span class="p">,</span><span class="s1">'medium'</span><span class="p">,</span><span class="s1">'new-import'</span><span class="p">,</span><span class="s1">'imo'</span><span class="p">,</span><span class="s1">'enhancement'</span><span class="p">,</span><span class="s1">'mathport'</span><span class="p">):</span>
            <span class="c1"># ignored labels</span>
            <span class="c1"># note: we ignore 'delegated' since it's usually still part of the review</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># note that if we get here, then this is still an open PR</span>
        <span class="k">pass</span>

<span class="n">review_times</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">pr</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">yield_reviews</span><span class="p">(</span><span class="n">pr</span><span class="p">[</span><span class="s1">'actions'</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
            <span class="n">review_times</span><span class="o">.</span><span class="n">setdefault</span><span class="p">((</span><span class="n">start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="o">/</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="k">for</span> <span class="n">times</span> <span class="ow">in</span> <span class="n">review_times</span><span class="o">.</span><span class="n">values</span><span class="p">():</span> <span class="n">times</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"review_times.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">review_times</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">w</span><span class="o">.</span><span class="n">writerow</span><span class="p">((</span><span class="s2">"date"</span><span class="p">,)</span> <span class="o">+</span> <span class="n">date</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">review_times</span><span class="p">[</span><span class="n">date</span><span class="p">]):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">writerow</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">t</span><span class="p">))</span>
        <span class="n">w</span><span class="o">.</span><span class="n">writerow</span><span class="p">(())</span>
</code></pre></div>
<p>The graphics were done with LibreOffice Calc</p>
</div></div>



<a name="290165055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290165055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290165055">(Jul 19 2022 at 21:43)</a>:</h4>
<p>Can you replot with the same y axis on each graph, and maybe a log y scale?</p>



<a name="290165432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290165432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290165432">(Jul 19 2022 at 21:46)</a>:</h4>
<p>I just used LibreOffice Calc -- I tried to figure out how to do any of that with it, but didn't find it with some clicking around.</p>
<p>Here's the CSV in a silly format: <a href="/user_uploads/3121/iubePPOtLgaDl5xza1hpriZ3/review_times.csv">review_times.csv</a></p>
<p>Each month starts with "date, 2022, 2" (for example), then there are idx/days pairs, and then a blank line.</p>



<a name="290165922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290165922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290165922">(Jul 19 2022 at 21:50)</a>:</h4>
<p>Here's a less silly format if you want to do some processing of your own. It has year/month/day of the end of a review cycle and its duration in days. <a href="/user_uploads/3121/nR9FYQ7f7KLhnnPi1rRO60MD/review_times_full.csv">review_times_full.csv</a></p>



<a name="290195697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290195697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290195697">(Jul 20 2022 at 05:34)</a>:</h4>
<p><span class="user-mention" data-user-id="306601">@Kyle Miller</span> Thanks! That clearly shows that review times have been increasing!<br>
I guess the y-axis is still in hours? And has some outliers chopped off?</p>



<a name="290195781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290195781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290195781">(Jul 20 2022 at 05:36)</a>:</h4>
<p>The ratio of PR submitters to number of distinct PR reviewers (and/or reviews per reviewer) is also possibly something interesting to look at over time. Lots of larger projects I think run into cases where the rate of growth of the former outpaces the latter either because submitting is more fun than reviewing or because it takes active encouragement to get people to think they're good enough to review stuff.</p>



<a name="290195810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290195810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290195810">(Jul 20 2022 at 05:37)</a>:</h4>
<p>Nice idea. If we can autogenerate a bunch of such plots, I think that would be really useful.</p>



<a name="290196641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290196641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290196641">(Jul 20 2022 at 05:57)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> The y-axes are in days, and no outliers have been removed. What I'm seeing is that reviewing times have gotten longer, but there has simultaneously been fewer review cycles overall. These are only a few months though so it's hard to say what's going on.</p>



<a name="290196996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290196996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290196996">(Jul 20 2022 at 06:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113488-general/topic/Queue.20histograms/near/290196641">said</a>:</p>
<blockquote>
<p>there has simultaneously been fewer review cycles overall</p>
</blockquote>
<p>That's an interesting point! Could that be correlated with there being a lot more PRs that are 20 - 50 lines long? Or even &lt; 20 lines, adding just 1 lemma?</p>



<a name="290213021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Queue%20histograms/near/290213021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Queue.20histograms.html#290213021">(Jul 20 2022 at 09:43)</a>:</h4>
<p>I suspected it was more of a cultural thing. Given that there are more PRs, you cannot spend as much time reviewing each.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>