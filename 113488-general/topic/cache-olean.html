---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/cache-olean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html">cache-olean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="163469844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/163469844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#163469844">(Apr 16 2019 at 13:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> <code>cache-olean</code> doesn't seem to be working for me. I am on branch <code>lean-3.4.2</code>, I fetched and merged the latest version, and did this:</p>
<div class="codehilite"><pre><span></span>avigad@avigad-ThinkPad-T460:~/projects/mathlib$ cache-olean --fetch
No github section found in &#39;git config&#39;
Querying GitHub...
Downloading nightly...
... successfully extracted olean archive.
avigad@avigad-ThinkPad-T460:~/projects/mathlib$ lean --make
</pre></div>


<p>It is recompiling the whole library. That shouldn't happen, should it? Can you tell if I am doing something wrong?</p>



<a name="163478705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/163478705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#163478705">(Apr 16 2019 at 15:17)</a>:</h4>
<p>That certainly shouldn't happen</p>



<a name="163478786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/163478786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#163478786">(Apr 16 2019 at 15:18)</a>:</h4>
<p>what if you do <code>cache-olean --fetch</code> and <code>leanpkg build</code> instead?</p>



<a name="165144336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165144336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165144336">(May 08 2019 at 08:30)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> I just want to give you a very big Thank You <span aria-label="trademark" class="emoji emoji-2122" role="img" title="trademark">:trademark:</span>. Using <code>update-mathlib</code> and <code>cache-olean</code> has made development so much smoother. It is so much easier to switch branches, and add quick contributions. Kudos!</p>



<a name="165177803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165177803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165177803">(May 08 2019 at 16:24)</a>:</h4>
<p>I'm really glad it helps :)</p>



<a name="165177915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165177915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165177915">(May 08 2019 at 16:26)</a>:</h4>
<p>What is <code>cache-olean</code>? How do I find out how to use it?</p>



<a name="165178027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165178027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165178027">(May 08 2019 at 16:27)</a>:</h4>
<p>It looks like it's documented here: <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/howto-contribute.md#caching-compilation" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/howto-contribute.md#caching-compilation">https://github.com/leanprover-community/mathlib/blob/master/docs/howto-contribute.md#caching-compilation</a></p>



<a name="165179945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165179945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165179945">(May 08 2019 at 16:52)</a>:</h4>
<p>I get this error</p>
<div class="codehilite"><pre><span></span>dyn894-237:mathlib chrishughes$ cache-olean --fetch
Info: No github section found in &#39;git config&#39;, we will use GitHub with no authentication
Querying GitHub...
Error: no nightly archive found
no cache found
</pre></div>



<a name="165180084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180084">(May 08 2019 at 16:54)</a>:</h4>
<p>Did you cache a build?</p>



<a name="165180103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180103">(May 08 2019 at 16:54)</a>:</h4>
<p>How do I do that?</p>



<a name="165180111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180111">(May 08 2019 at 16:55)</a>:</h4>
<p>I was on the <code>master</code> branch</p>



<a name="165180181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180181">(May 08 2019 at 16:55)</a>:</h4>
<p>If you want to use the nightly, switch to the head of <code>lean-3.4.2</code></p>



<a name="165180314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180314">(May 08 2019 at 16:57)</a>:</h4>
<p>And it works for my community branches right? How do I do that?</p>



<a name="165180351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180351">(May 08 2019 at 16:57)</a>:</h4>
<p><code>lean-3.4.2</code> works by the way. Thanks.</p>



<a name="165180614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180614">(May 08 2019 at 17:00)</a>:</h4>
<p>For your branches, you build it first, then you call <code>cache-olean</code> and it will cache your build. When you switch to another branch and then come back, git will restore your binaries and you can pick up where you left off</p>



<a name="165180620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180620">(May 08 2019 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> When we switch over to the archives on Scott's server you will have "nightlies" for every commit of every branch. Scott is polling github every minute, and then he just needs to compile. If I understand the setup correctly...</p>



<a name="165180627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165180627">(May 08 2019 at 17:00)</a>:</h4>
<p>It is still not connected to Scott's server</p>



<a name="165202745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165202745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165202745">(May 08 2019 at 21:27)</a>:</h4>
<p>I tried using <code>cache-olean</code>, and it works for me. However, I'm on a Windows computer and configured git with <code>autocrlf = true</code>, so that my line endings are CRLF locally (that was what I was advised when I started using git). Running <code>cache-olean</code> changes all my line-endings to LF, and after doing <code>git checkout -- .</code> I think that Lean will try to rebuild the whole library from scratch.</p>
<p>Should I just burn down my whole git repository to the ground and reclone it using <code>autocrlf = false</code> or is there a simpler workaround? (I don't think that any of the programs I use care whether the line endings are CRLF or LF.)</p>



<a name="165204526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165204526">(May 08 2019 at 21:50)</a>:</h4>
<p>I remember seeing a commit that does what you describe but I can't seem to find it. I think <span class="user-mention" data-user-id="110087">@Scott Morrison</span> helped with this.</p>



<a name="165204732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165204732">(May 08 2019 at 21:53)</a>:</h4>
<p>Does <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>'s fix to lean 3.4.2 <a href="https://github.com/leanprover/lean/commit/92826917a252a6092cffaf5fc5f1acb1f8cef379" target="_blank" title="https://github.com/leanprover/lean/commit/92826917a252a6092cffaf5fc5f1acb1f8cef379">here</a> apply to this problem or not?</p>



<a name="165204847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165204847">(May 08 2019 at 21:55)</a>:</h4>
<p>It looks like it would. <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> can you confirm that it actually causes you to recompile?</p>



<a name="165204980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165204980">(May 08 2019 at 21:57)</a>:</h4>
<p>It did. The following finishes in a couple of seconds:</p>
<div class="codehilite"><pre><span></span>git checkout blessed/lean-3.4.2
cache-olean --fetch
leanpkg build
</pre></div>


<p>The following ran for a couple of minutes until I killed it:</p>
<div class="codehilite"><pre><span></span>git checkout blessed/lean-3.4.2
cache-olean --fetch
git status
git checkout -- .
leanpkg build
</pre></div>



<a name="165205211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165205211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165205211">(May 08 2019 at 22:00)</a>:</h4>
<p>I did change my <code>autocrlf</code> setting to false, and that works well.</p>



<a name="165903108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165903108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165903108">(May 17 2019 at 14:09)</a>:</h4>
<p>I'm finally getting around to setting up <code>cache-olean</code>. After moving scripts to their own repo, the install directions need to be updated, but that's easy enough. More worrying, I got this trace checking out a branch. Any idea what's up here?</p>
<div class="codehilite"><pre><span></span>Trying to fetch cached olean
Querying remote Mathlib cache...
Error: revision not found
Info: No github section found in &#39;git config&#39;, we will use GitHub with no authentication
Querying GitHub...
Downloading nightly...
Traceback (most recent call last):
  File &quot;/home/rob/.mathlib/bin/cache-olean&quot;, line 145, in &lt;module&gt;
    fetch_mathlib(asset)
  File &quot;/home/rob/.mathlib/bin/cache-olean&quot;, line 104, in fetch_mathlib
    f.write(req.data)
TypeError: __exit__() takes 1 positional argument but 4 were given
</pre></div>



<a name="165903722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165903722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165903722">(May 17 2019 at 14:16)</a>:</h4>
<p>As for updating the docs. Perhaps <code>setup_dev_scripts.sh</code> should be moved back to mathlib, and should check mathlib-scripts on Github for the scripts it needs to download?</p>



<a name="165919243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165919243">(May 17 2019 at 17:25)</a>:</h4>
<p>It's curious. The line info in this error is not consistent with the version in <code>mathlib-tools</code>. Are you sure you have a recent version?</p>



<a name="165919430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165919430">(May 17 2019 at 17:27)</a>:</h4>
<p>I'm not at the office anymore so I can't check until Monday, but I think so... I had a fresh checkout of <code>mathlib-tools</code> for moving your PR over from mathlib.</p>



<a name="165919503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165919503">(May 17 2019 at 17:28)</a>:</h4>
<p>Maybe not though. I'll check next week.</p>



<a name="165919519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165919519">(May 17 2019 at 17:28)</a>:</h4>
<p>Ok, please keep me posted.</p>



<a name="165927504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165927504">(May 17 2019 at 19:02)</a>:</h4>
<p>Lately, whenever I run <code>cache-olean --fetch</code> I get an error that no nightly archive is found. This happens when I am on the master branch of mathlib-community (and also if I'm a couple commits behind master - is there a delay in the availability of binaries?).</p>
<div class="codehilite"><pre><span></span>Floris@MSI MINGW64 /d/projects/mathlib (master)
$ cache-olean --fetch
Info: No github section found in &#39;git config&#39;, we will use GitHub with no authentication
Querying GitHub...
Error: no nightly archive found
no cache found
</pre></div>



<a name="165927779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165927779">(May 17 2019 at 19:05)</a>:</h4>
<p>Oh wait, I forgot you had to be on the <code>lean-3.4.2</code> branch. Is this what <a href="https://github.com/leanprover-community/mathlib-tools/pull/2" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/2">https://github.com/leanprover-community/mathlib-tools/pull/2</a> is implementing?</p>



<a name="165927871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165927871">(May 17 2019 at 19:06)</a>:</h4>
<blockquote>
<p>I forgot you had to be on the lean-3.4.2 branch</p>
</blockquote>
<p>That's right</p>



<a name="165927927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#165927927">(May 17 2019 at 19:07)</a>:</h4>
<blockquote>
<p>Is this what <a href="https://github.com/leanprover-community/mathlib-tools/pull/2" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/2">https://github.com/leanprover-community/mathlib-tools/pull/2</a> is implementing?</p>
</blockquote>
<p>That's a project that Scott and I are working on so that you can get a binary for every commit. It's not there yet.</p>



<a name="166483007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/166483007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#166483007">(May 24 2019 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> <span class="user-mention" data-user-id="110087">@Scott Morrison</span> Any progress here?</p>



<a name="182737290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182737290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182737290">(Dec 06 2019 at 07:55)</a>:</h4>
<p>mathlib is moving ever so slightly faster. I'm finding that if one works on a bunch of related PRs, then it's really nice to be able to work on <code>master</code> instead of yesterdays <code>lean-3.4.2</code>. Are there any options on the horizon of publishing binaries for every commit of the last 3 days (say) and only storing 1 set of binaries per day for older versions of master?</p>



<a name="182781215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182781215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182781215">(Dec 06 2019 at 17:04)</a>:</h4>
<p>I have not looked into it. I think that's possible but you need every build of master to do a deployment. You can look in the travis file and in <code>scripts/deploy-nightly.sh</code>. <code>scripts/deploy-nightly.sh</code> should be changed a bit so that it does not push to <code>lean-3.4.2</code> when deploying the build. As for deleting old releases, I'm not sure how to do that. We can try with a cron job on travis.</p>



<a name="182781261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182781261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182781261">(Dec 06 2019 at 17:04)</a>:</h4>
<p>Another approach would be to look into Github actions. It might be easier to configure</p>



<a name="182784754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182784754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182784754">(Dec 06 2019 at 17:39)</a>:</h4>
<p>Are there more people who think it would be useful to increase the frequency of binary releases? If it's just me, I don't think we should spend energy on this change.</p>



<a name="182784832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182784832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182784832">(Dec 06 2019 at 17:40)</a>:</h4>
<p>So, thumbs up on this message, if you would like to have binary releases for every commit on master for the last 3 days. And thumbs down if you don't want/need that.</p>



<a name="182785166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182785166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182785166">(Dec 06 2019 at 17:44)</a>:</h4>
<p>I even wish PRs buils would be available so that I have at least access to tactic state when reviewing complicated PRs.</p>



<a name="182786340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182786340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182786340">(Dec 06 2019 at 17:57)</a>:</h4>
<p>Github actions supports <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts#uploading-build-and-test-artifacts" target="_blank" title="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts#uploading-build-and-test-artifacts">attaching downloadable "artifacts"</a> to every build (on every branch), so all this is possible. Probably that can be integrated into the cache-olean script in a clever way too.</p>



<a name="182786941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182786941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182786941">(Dec 06 2019 at 18:03)</a>:</h4>
<p>Are there statistics on the average number of commits to the github repo per day? (So not master, but all branches.)</p>



<a name="182791675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182791675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182791675">(Dec 06 2019 at 18:55)</a>:</h4>
<p>have a look at <a href="https://github.com/leanprover-community/mathlib/graphs/commit-activity" target="_blank" title="https://github.com/leanprover-community/mathlib/graphs/commit-activity">https://github.com/leanprover-community/mathlib/graphs/commit-activity</a></p>



<a name="182792363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182792363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182792363">(Dec 06 2019 at 19:02)</a>:</h4>
<p>But that is commits to master, I guess</p>



<a name="182793874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182793874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182793874">(Dec 06 2019 at 19:19)</a>:</h4>
<p>Right, then I don't know how to do better</p>



<a name="182794035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182794035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182794035">(Dec 06 2019 at 19:20)</a>:</h4>
<p>I would be happier with builds on PR commits (as Patrick mentions) than more frequent master builds.</p>
<ul>
<li>master builds will be useful, but one question is when will they be available: the moment the commit happens or a couple hours later? In the latter case there is little improvement over the current situation.</li>
<li>PR builds (<strong>also</strong> of failing builds, if possible - in this case all the <code>.olean</code> files that were succesfully produced) will be very useful: to build on top of the PR before it has been merged, to review in VSCode, and for failing builds: to fix build failures more easily.</li>
</ul>



<a name="182794419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182794419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182794419">(Dec 06 2019 at 19:24)</a>:</h4>
<p>I think instead of going in the direction of picking the right commits to cache the build of, I think getting sccache to support Lean might do a better job. What it does is every time you try to compile one file it checks if this exact file (with its exact contents and the exact content of its dependencies) has been compiled by any other user in the past.</p>



<a name="182798425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182798425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182798425">(Dec 06 2019 at 20:02)</a>:</h4>
<blockquote>
<p>Github actions supports <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts#uploading-build-and-test-artifacts" target="_blank" title="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts#uploading-build-and-test-artifacts">attaching downloadable "artifacts"</a> to every build (on every branch), so all this is possible. Probably that can be integrated into the cache-olean script in a clever way too.</p>
</blockquote>
<p>I wonder how long they're stored, how predictable the URLs are, and if there's a cap on the artifact size. If those all have reasonable answers, I think this is a great reason to switch.</p>



<a name="182798458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182798458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182798458">(Dec 06 2019 at 20:03)</a>:</h4>
<p>Also I've been getting annoyed with the random Travis failures because a PR happened to be merged during the build.</p>



<a name="182798513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182798513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182798513">(Dec 06 2019 at 20:03)</a>:</h4>
<p>I don't know the first thing about sccache, that sounds reasonable too.</p>



<a name="182798624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182798624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182798624">(Dec 06 2019 at 20:04)</a>:</h4>
<p>But there are independent reasons to switch to GitHub Actions for CI, so if it will let us cache oleans for all PRs without much effort, let's go for it.</p>



<a name="182799280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/182799280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/cache-olean.html#182799280">(Dec 06 2019 at 20:14)</a>:</h4>
<blockquote>
<p>I wonder how long they're stored, how predictable the URLs are, and if there's a cap on the artifact size.</p>
</blockquote>
<p>According to the page it looks like they're stored for 90 days, which is probably OK for PR's and non-cron master commits. For really old PRs, we would probably want to do a merge commit with master anyways, and that would trigger a new build.</p>
<p>Not sure about the URLs, but I did see this:</p>
<blockquote>
<p>GitHub does not currently offer a REST API to retrieve uploaded artifacts.</p>
</blockquote>
<p>So, this might be tricky.</p>
<p>I couldn't find any info about size caps, so my guess is that we'd be fine.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>