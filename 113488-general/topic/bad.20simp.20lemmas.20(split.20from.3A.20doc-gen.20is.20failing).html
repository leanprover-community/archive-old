---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html">bad simp lemmas (split from: doc-gen is failing)</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="227604327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227604327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227604327">(Feb 24 2021 at 14:17)</a>:</h4>
<p>Oh wow, there's even a non-terminal simp there...</p>



<a name="227604555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227604555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227604555">(Feb 24 2021 at 14:18)</a>:</h4>
<p>An extremely slow nonterminal simp</p>



<a name="227604837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227604837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227604837">(Feb 24 2021 at 14:20)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/6401">#6401</a></p>



<a name="227604876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227604876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227604876">(Feb 24 2021 at 14:21)</a>:</h4>
<p>Ah, you beat me by 10 sec</p>



<a name="227604877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227604877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227604877">(Feb 24 2021 at 14:21)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/tree/speedup-cau-seq-filter">https://github.com/leanprover-community/mathlib/tree/speedup-cau-seq-filter</a></p>



<a name="227604984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227604984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227604984">(Feb 24 2021 at 14:21)</a>:</h4>
<p>Curious that we came up with different <code>simp only</code>s</p>



<a name="227605112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227605112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227605112">(Feb 24 2021 at 14:22)</a>:</h4>
<p>At first <code>squeeze_simp</code> timed out for me, so I tried <code>simp?</code>.  But that didn't give me all lemmas, so I had to do <code>squeeze_simp</code> afterwards and merge the two.</p>



<a name="227605219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227605219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227605219">(Feb 24 2021 at 14:23)</a>:</h4>
<p>Great minds think alike! I did the same, but after <code>simp?</code> wasn't enough I just guessed that <code>ge_iff_le</code> was missing</p>



<a name="227606229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227606229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227606229">(Feb 24 2021 at 14:29)</a>:</h4>
<p>As far as I can tell from the trace messages, there's more conditional simp lemmas here than I'd like.</p>
<ul>
<li><code>forall_prop_of_true</code> seems to trigger at every implication</li>
<li>even better, <code>forall_prop_of_false</code> triggers a second time...</li>
<li><code>exists_prop_of_true</code> is not as bad, but still triggers way too often</li>
<li><code>function.injective.eq_iff</code> triggers at every function</li>
<li>wtf is <code>imp_iff_right</code> a simp lemma?!?!?!?</li>
</ul>



<a name="227606445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227606445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227606445">(Feb 24 2021 at 14:31)</a>:</h4>
<p>It doesn't help that conditional simplification does not seem to be cached.  (Maybe that's because we're simplifying under binders here and get a different local constant every time, I didn't check.)</p>



<a name="227606860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227606860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227606860">(Feb 24 2021 at 14:33)</a>:</h4>
<blockquote>
<p>wtf is <code>imp_iff_right</code> a simp lemma?!?!?!?</p>
</blockquote>
<p>This will never fire, right? If it fires successfully then <code>simp</code> proves <code>a</code>, which means <code>a</code> simplifies to <code>true</code>, which means <code>a → b</code> has already simplified to <code>b</code>?</p>



<a name="227607087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227607087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227607087">(Feb 24 2021 at 14:34)</a>:</h4>
<p>Well, it will always fire but never rewrite, which is even worse.</p>



<a name="227607163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227607163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227607163">(Feb 24 2021 at 14:35)</a>:</h4>
<p>Right, that's what I meant... ugh</p>



<a name="227607850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227607850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227607850">(Feb 24 2021 at 14:39)</a>:</h4>
<p>I love what has happened to this topic</p>



<a name="227608020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227608020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227608020">(Feb 24 2021 at 14:40)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/6402">#6402</a></p>



<a name="227608711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227608711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227608711">(Feb 24 2021 at 14:45)</a>:</h4>
<p>BTW, if I disable all of the lemmas that I've listed, then simp only takes 740ms instead of 6600ms.</p>



<a name="227609499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227609499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227609499">(Feb 24 2021 at 14:50)</a>:</h4>
<p>I have no clue what the first three are doing. Removing the last two seems like an obvious good move...</p>



<a name="227609577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227609577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227609577">(Feb 24 2021 at 14:51)</a>:</h4>
<p>There was a little breakage from <code>function.injective.eq_iff</code> early on, not sure how much more is coming.</p>



<a name="227610568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227610568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227610568">(Feb 24 2021 at 14:58)</a>:</h4>
<p>The <code>*_prop_of_*</code> lemmas are a hack because we can't define multiple congruence lemmas for a function symbol (and probably none for forall).  They only help with uber-dependently typed goals such as <code>∀ x : none.is_some, get x = a</code>.  In general you don't want to rewrite the domain of a pi, because then you get an ugly term in the codomain.  But for propositions, this doesn't matter.<br>
These lemmas should be removed from the simp set.  I don't think that would break much, because we avoid dependent types anyhow.  And if it does, it's better to fix this in the simplifier (on the c++ side).</p>



<a name="227614293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227614293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227614293">(Feb 24 2021 at 15:20)</a>:</h4>
<p>There's a little more breakage so far from the <code>*_prop_of_*</code> but not too much. And I'm guessing it's all at the bottom. I'll make a second PR once I get a little farther locally</p>



<a name="227614798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227614798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227614798">(Feb 24 2021 at 15:23)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/6404">#6404</a></p>



<a name="227625536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/bad%20simp%20lemmas%20%28split%20from%3A%20doc-gen%20is%20failing%29/near/227625536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/bad.20simp.20lemmas.20(split.20from.3A.20doc-gen.20is.20failing).html#227625536">(Feb 24 2021 at 16:18)</a>:</h4>
<p>I do remember seeing a lot of <code>*_prop_of_*</code> in the output of <code>squeeze_simp</code> so I do think it is something we rely on quite a bit.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>