---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html">Looking for a mac/windows debugging expert</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197546713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197546713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197546713">(May 14 2020 at 12:45)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/234">lean#234</a> is a potentially huge improvement to simp performance.  (Constructing the simp set takes 25% of mathlib build time on Scott's benchmarks.)<br>
However, building the core library segfaults on, well, everything except linux.  I would really appreciate it if somebody with a mac/windows could make a debugging build, run lean with a debugger, and post a backtrace of the segfault.  I have no idea where to look for problems.</p>



<a name="197548039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197548039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197548039">(May 14 2020 at 12:56)</a>:</h4>
<p>What about dropping support for Windows and MacOS? It would simplify a lot of things.</p>



<a name="197552485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197552485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197552485">(May 14 2020 at 13:22)</a>:</h4>
<p>I'll make an attempt on Windows. It's a good excuse to get these things set up on the Windows side of my new laptop.</p>



<a name="197554843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197554843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197554843">(May 14 2020 at 13:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197548039">said</a>:</p>
<blockquote>
<p>What about dropping support for Windows and MacOS? It would simplify a lot of things.</p>
</blockquote>
<p>If we had a web-based editor (which would have to interact with an external linux server) good enough to replace VSCode then one could drop support without dropping a large fraction of the userbase.<br>
(This isn't so crazy --- lots of data scientists do their machine learning work in the cloud via jupyter / google colab)</p>



<a name="197555076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197555076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197555076">(May 14 2020 at 13:40)</a>:</h4>
<p>Are the WIndows build directions still up to date? Following the directions in the repo exactly, I get</p>
<div class="codehilite"><pre><span></span><code>CMake Error at CMakeLists.txt:5 (project):
  The CMAKE_CXX_COMPILER:

    cl

  is not a full path and was not found in the PATH.
</code></pre></div>


<p>at the cmake stage. Adding <code>-G Ninja</code> seems to work (which I remember from a while back, it's been ages since I've built Lean)</p>



<a name="197555438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197555438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197555438">(May 14 2020 at 13:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="252300">Jalex Stark</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197554843">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197548039">said</a>:</p>
<blockquote>
<p>What about dropping support for Windows and MacOS? It would simplify a lot of things.</p>
</blockquote>
<p>If we had a web-based editor (which would have to interact with an external linux server) good enough to replace VSCode then one could drop support without dropping a large fraction of the userbase.<br>
(This isn't so crazy --- lots of data scientists do their machine learning work in the cloud via jupyter / google colab)</p>
</blockquote>
<p>It's not that <em>perfect</em> to use Jupyter Notebooks for everything, but I guess CoCalc is the direct we somewhat want</p>



<a name="197555842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197555842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197555842">(May 14 2020 at 13:44)</a>:</h4>
<p>Yeah, I agree that CoCalc is a lot of the way there. I guess there are already students whose only Lean environment is a CoCalc one, but I would guess that's not true of any of the regulars on this server</p>



<a name="197556008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197556008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197556008">(May 14 2020 at 13:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> This looks like it wants to compile lean using visual studio (â‰  vscode).  You should be running <code>cmake</code> and <code>make</code> inside the msys2 shell.</p>



<a name="197556307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197556307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197556307">(May 14 2020 at 13:47)</a>:</h4>
<p>As in, not the "msys2 MinGW 64-bit" shell?</p>



<a name="197556462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197556462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197556462">(May 14 2020 at 13:48)</a>:</h4>
<p>No, that's the right one.  Do you have gcc installed?  How are you calling <code>cmake</code>?</p>



<a name="197556571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197556571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197556571">(May 14 2020 at 13:49)</a>:</h4>
<p>Straight from the directions at <a href="https://github.com/leanprover-community/lean/blob/master/doc/make/msys2.md">https://github.com/leanprover-community/lean/blob/master/doc/make/msys2.md</a>, then the generic ones.</p>



<a name="197556727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197556727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197556727">(May 14 2020 at 13:50)</a>:</h4>
<p><code>gcc version 8.3.0 (Rev2, Built by MSYS2 project)</code></p>



<a name="197556862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197556862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197556862">(May 14 2020 at 13:51)</a>:</h4>
<p>Can you paste the output of <code>cmake</code> here please?</p>



<a name="197557214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557214">(May 14 2020 at 13:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code>robyl@DESKTOP-NIOLIBD MINGW64 /d/lean/lean/build/release
$ cmake ../../src
-- Building <span class="k">for</span>: NMake Makefiles
-- The CXX compiler identification is unknown
-- The C compiler identification is unknown
CMake Error at CMakeLists.txt:5 <span class="o">(</span>project<span class="o">)</span>:
  The CMAKE_CXX_COMPILER:

    cl

  is not a full path and was not found in the PATH.

  To use the NMake generator with Visual C++, cmake must be run from a shell
  that can use the compiler cl from the <span class="nb">command</span> line.  This environment is
  unable to invoke the cl compiler.  To fix this problem, run cmake from the
  Visual Studio Command Prompt <span class="o">(</span>vcvarsall.bat<span class="o">)</span>.

  Tell CMake where to find the compiler by setting either the environment
  variable <span class="s2">&quot;CXX&quot;</span> or the CMake cache entry CMAKE_CXX_COMPILER to the full path
  to the compiler, or to the compiler name <span class="k">if</span> it is in the PATH.


CMake Error at CMakeLists.txt:5 <span class="o">(</span>project<span class="o">)</span>:
  The CMAKE_C_COMPILER:

    cl

  is not a full path and was not found in the PATH.

  To use the NMake generator with Visual C++, cmake must be run from a shell
  that can use the compiler cl from the <span class="nb">command</span> line.  This environment is
  unable to invoke the cl compiler.  To fix this problem, run cmake from the
  Visual Studio Command Prompt <span class="o">(</span>vcvarsall.bat<span class="o">)</span>.

  Tell CMake where to find the compiler by setting either the environment
  variable <span class="s2">&quot;CC&quot;</span> or the CMake cache entry CMAKE_C_COMPILER to the full path to
  the compiler, or to the compiler name <span class="k">if</span> it is in the PATH.


-- Configuring incomplete, errors occurred!
See also <span class="s2">&quot;D:/lean/lean/build/release/CMakeFiles/CMakeOutput.log&quot;</span>.
See also <span class="s2">&quot;D:/lean/lean/build/release/CMakeFiles/CMakeError.log&quot;</span>.
</code></pre></div>



<a name="197557286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557286">(May 14 2020 at 13:54)</a>:</h4>
<p>The ninja build is still going, very slowly. I guess because it's a debug build?</p>



<a name="197557324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557324">(May 14 2020 at 13:55)</a>:</h4>
<p><code>cmake -G Makefile</code></p>



<a name="197557373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557373">(May 14 2020 at 13:55)</a>:</h4>
<p>Or <code>ninja</code>, that should work as well.</p>



<a name="197557427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557427">(May 14 2020 at 13:55)</a>:</h4>
<p>It should take about 15 minutes or so.</p>



<a name="197557532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557532">(May 14 2020 at 13:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="252300">Jalex Stark</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197554843">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197548039">said</a>:</p>
<blockquote>
<p>What about dropping support for Windows and MacOS? It would simplify a lot of things.</p>
</blockquote>
<p>If we had a web-based editor (which would have to interact with an external linux server) good enough to replace VSCode then one could drop support without dropping a large fraction of the userbase.<br>
(This isn't so crazy --- lots of data scientists do their machine learning work in the cloud via jupyter / google colab)</p>
</blockquote>
<p>This message wasn't meant to be answered... Of course I don't seriously mean we should drop Windows support. Students will always be students, you need to let them grow before assuming they use Linux.</p>



<a name="197557534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557534">(May 14 2020 at 13:56)</a>:</h4>
<p>Aha. Add that at <a href="https://github.com/leanprover-community/lean/blob/master/doc/make/index.md">https://github.com/leanprover-community/lean/blob/master/doc/make/index.md</a> ? :)</p>



<a name="197557546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557546">(May 14 2020 at 13:56)</a>:</h4>
<p>Apparently the default for <code>cmake</code> is to use the visual studio compiler and nmake.  I guess the documentation doesn't mention that because we recommended to use <code>ninja</code> instead.</p>



<a name="197557613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557613">(May 14 2020 at 13:56)</a>:</h4>
<p>15 min seems about right, it's just about at the library build.</p>



<a name="197557869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557869">(May 14 2020 at 13:58)</a>:</h4>
<p>Okay, here's your first traceback. </p>
<div class="codehilite"><pre><span></span><code>FAILED: CMakeFiles/leanpkg
cmd.exe /C <span class="s2">&quot;cd /D D:\lean\lean\leanpkg &amp;&amp; D:\lean\lean\src\..\bin\lean --make&quot;</span>
LEAN ASSERTION VIOLATION
File: D:/lean/lean/src/kernel/expr.h
Line: <span class="m">62</span>
Task: D:<span class="se">\l</span>ean<span class="se">\l</span>ean<span class="se">\l</span>ibrary<span class="se">\i</span>nit<span class="se">\l</span>ogic.lean:
get_rc<span class="o">()</span> &gt; <span class="m">0</span>
<span class="o">(</span>C<span class="o">)</span>ontinue, <span class="o">(</span>A<span class="o">)</span>bort/exit, <span class="o">(</span>S<span class="o">)</span>top/trap, Invoke <span class="o">(</span>G<span class="o">)</span>DB
ninja: build stopped: subcommand failed.
</code></pre></div>



<a name="197557910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557910">(May 14 2020 at 13:59)</a>:</h4>
<p>I guess you want GDB output?</p>



<a name="197557935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197557935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197557935">(May 14 2020 at 13:59)</a>:</h4>
<p>Yes.</p>



<a name="197558657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197558657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197558657">(May 14 2020 at 14:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197548039">said</a>:</p>
<blockquote>
<p>What about dropping support for Windows and MacOS? It would simplify a lot of things.</p>
</blockquote>
<p>I may be missing some key context here but would this mean that I could no longer run new versions of (the community fork of) Lean on MacOS? This would make me very sad.</p>



<a name="197558818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197558818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197558818">(May 14 2020 at 14:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert/near/197546713">said</a>:</p>
<blockquote>
<p><a href="https://github.com/leanprover-community/lean/issues/234">lean#234</a> is a potentially huge improvement to simp performance.  (Constructing the simp set takes 25% of mathlib build time on Scott's benchmarks.)<br>
However, building the core library segfaults on, well, everything except linux.  I would really appreciate it if somebody with a mac/windows could make a debugging build, run lean with a debugger, and post a backtrace of the segfault.  I have no idea where to look for problems.</p>
</blockquote>
<p>I might just be able to help with this but time is always very tight for me so I regret that I cannot commit. If at all possible, I will make an attempt at the weekend.</p>



<a name="197559023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197559023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197559023">(May 14 2020 at 14:08)</a>:</h4>
<p><span class="user-mention" data-user-id="240862">@Oliver Nash</span>, it was not at all a serious suggestion. Patrick likes to make provocative statements. :-)</p>



<a name="197559214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197559214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197559214">(May 14 2020 at 14:08)</a>:</h4>
<p>PHEW!</p>



<a name="197559310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197559310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197559310">(May 14 2020 at 14:08)</a>:</h4>
<p>Thanks :-)</p>



<a name="197561784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197561784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197561784">(May 14 2020 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> , <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> , I get the same lean assertion violation on macos.</p>



<a name="197561805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197561805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197561805">(May 14 2020 at 14:18)</a>:</h4>
<p>I'm not sure what command to run with <code>gdb</code>.</p>



<a name="197561897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197561897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197561897">(May 14 2020 at 14:19)</a>:</h4>
<p><code>gdb --args ~/lean/bin/lean --make</code> in the <code>library</code> directory.  Then type <code>r</code> to start running.  And then type <code>bt</code> after it crashed.</p>



<a name="197562430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197562430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197562430">(May 14 2020 at 14:22)</a>:</h4>
<p>I'm assuming you mean <code>gdb --args ../bin/lean --make</code> in the <code>library</code> directory.</p>



<a name="197562783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197562783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197562783">(May 14 2020 at 14:26)</a>:</h4>
<p>Yes.</p>



<a name="197563115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563115">(May 14 2020 at 14:29)</a>:</h4>
<p>I'm having issues with gdb on WIndows, this is where I'm at so far.</p>
<div class="codehilite"><pre><span></span><code>robyl@DESKTOP-NIOLIBD MINGW64 /d/lean/lean/library
$ gdb --args ../bin/lean --make
GNU gdb <span class="o">(</span>GDB<span class="o">)</span> <span class="m">8</span>.2.1
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2018</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type <span class="s2">&quot;show copying&quot;</span> and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
This GDB was configured as <span class="s2">&quot;x86_64-pc-msys&quot;</span>.
Type <span class="s2">&quot;show configuration&quot;</span> <span class="k">for</span> configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, <span class="nb">type</span> <span class="s2">&quot;help&quot;</span>.
Type <span class="s2">&quot;apropos word&quot;</span> to search <span class="k">for</span> commands related to <span class="s2">&quot;word&quot;</span>...
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;&lt;string&gt;&quot;</span>, line <span class="m">3</span>, in &lt;module&gt;
ModuleNotFoundError: No module named <span class="s1">&#39;libstdcxx&#39;</span>
/etc/gdbinit:6: Error in sourced <span class="nb">command</span> file:
Error <span class="k">while</span> executing Python code.
Reading symbols from ../bin/lean...done.
<span class="o">(</span>gdb<span class="o">)</span> r
Starting program: /d/lean/lean/bin/lean --make
<span class="o">[</span>New Thread <span class="m">8416</span>.0x2b80<span class="o">]</span>
<span class="o">[</span>New Thread <span class="m">8416</span>.0xa8c<span class="o">]</span>
<span class="o">[</span>New Thread <span class="m">8416</span>.0x5ec<span class="o">]</span>
<span class="o">[</span>New Thread <span class="m">8416</span>.0x32d4<span class="o">]</span>
<span class="o">[</span>Thread <span class="m">8416</span>.0x32d4 exited with code <span class="m">0</span><span class="o">]</span>
<span class="o">[</span>Thread <span class="m">8416</span>.0xa8c exited with code <span class="m">0</span><span class="o">]</span>
<span class="o">[</span>Thread <span class="m">8416</span>.0x5ec exited with code <span class="m">0</span><span class="o">]</span>
<span class="o">[</span>Inferior <span class="m">1</span> <span class="o">(</span>process <span class="m">8416</span><span class="o">)</span> exited normally<span class="o">]</span>
<span class="o">(</span>gdb<span class="o">)</span> bt
No stack.
<span class="o">(</span>gdb<span class="o">)</span>
</code></pre></div>



<a name="197563129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563129">(May 14 2020 at 14:29)</a>:</h4>
<p>Trying to figure out what's up with the error...</p>



<a name="197563259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563259">(May 14 2020 at 14:30)</a>:</h4>
<p>Ok, this time lean didn't crash.  Can you remove all olean files and then try the same <code>gdb</code> invocation again please?</p>



<a name="197563375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563375">(May 14 2020 at 14:31)</a>:</h4>
<p>After working out how to <code>codesign</code> <code>gdb</code>, I'm back...</p>



<a name="197563418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563418">(May 14 2020 at 14:32)</a>:</h4>
<p>Now I get:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span><span class="n">gdb</span><span class="o">)</span> <span class="n">r</span>
<span class="n">Starting</span> <span class="n">program</span><span class="o">:</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">scott</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">lean</span> <span class="c1">--make</span>
<span class="o">[</span><span class="n">New</span> <span class="n">Thread</span> <span class="mi">0</span><span class="n">x1703</span> <span class="n">of</span> <span class="n">process</span> <span class="mi">64332</span><span class="o">]</span>
<span class="o">[</span><span class="n">New</span> <span class="n">Thread</span> <span class="mi">0</span><span class="n">x1a03</span> <span class="n">of</span> <span class="n">process</span> <span class="mi">64332</span><span class="o">]</span>
<span class="n">warning</span><span class="o">:</span> <span class="bp">`/</span><span class="n">BuildRoot</span><span class="bp">/</span><span class="n">Library</span><span class="bp">/</span><span class="n">Caches</span><span class="bp">/</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">xbs</span><span class="bp">/</span><span class="n">Binaries</span><span class="bp">/</span><span class="n">Libc_darwin</span><span class="bp">/</span><span class="n">install</span><span class="bp">/</span><span class="n">TempContent</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">/</span><span class="n">Libc</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">libsystem_darwin</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">-</span><span class="n">normal</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">/</span><span class="n">darwin_vers</span><span class="bp">.</span><span class="n">o&#39;</span><span class="o">:</span> <span class="n">can&#39;t</span> <span class="kn">open</span> <span class="n">to</span> <span class="n">read</span> <span class="n">symbols</span><span class="o">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span><span class="bp">.</span>
<span class="n">warning</span><span class="o">:</span> <span class="bp">`/</span><span class="n">BuildRoot</span><span class="bp">/</span><span class="n">Library</span><span class="bp">/</span><span class="n">Caches</span><span class="bp">/</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">xbs</span><span class="bp">/</span><span class="n">Binaries</span><span class="bp">/</span><span class="n">Libc_darwin</span><span class="bp">/</span><span class="n">install</span><span class="bp">/</span><span class="n">TempContent</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">/</span><span class="n">Libc</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">libsystem_darwin</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">-</span><span class="n">normal</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">/</span><span class="n">dirstat</span><span class="bp">.</span><span class="n">o&#39;</span><span class="o">:</span> <span class="n">can&#39;t</span> <span class="kn">open</span> <span class="n">to</span> <span class="n">read</span> <span class="n">symbols</span><span class="o">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span><span class="bp">.</span>
<span class="n">warning</span><span class="o">:</span> <span class="bp">`/</span><span class="n">BuildRoot</span><span class="bp">/</span><span class="n">Library</span><span class="bp">/</span><span class="n">Caches</span><span class="bp">/</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">xbs</span><span class="bp">/</span><span class="n">Binaries</span><span class="bp">/</span><span class="n">Libc_darwin</span><span class="bp">/</span><span class="n">install</span><span class="bp">/</span><span class="n">TempContent</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">/</span><span class="n">Libc</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">libsystem_darwin</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">-</span><span class="n">normal</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">/</span><span class="n">dirstat_collection</span><span class="bp">.</span><span class="n">o&#39;</span><span class="o">:</span> <span class="n">can&#39;t</span> <span class="kn">open</span> <span class="n">to</span> <span class="n">read</span> <span class="n">symbols</span><span class="o">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span><span class="bp">.</span>
<span class="n">warning</span><span class="o">:</span> <span class="bp">`/</span><span class="n">BuildRoot</span><span class="bp">/</span><span class="n">Library</span><span class="bp">/</span><span class="n">Caches</span><span class="bp">/</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">xbs</span><span class="bp">/</span><span class="n">Binaries</span><span class="bp">/</span><span class="n">Libc_darwin</span><span class="bp">/</span><span class="n">install</span><span class="bp">/</span><span class="n">TempContent</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">/</span><span class="n">Libc</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">libsystem_darwin</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">-</span><span class="n">normal</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">/</span><span class="n">init</span><span class="bp">.</span><span class="n">o&#39;</span><span class="o">:</span> <span class="n">can&#39;t</span> <span class="kn">open</span> <span class="n">to</span> <span class="n">read</span> <span class="n">symbols</span><span class="o">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span><span class="bp">.</span>
<span class="n">warning</span><span class="o">:</span> <span class="bp">`/</span><span class="n">BuildRoot</span><span class="bp">/</span><span class="n">Library</span><span class="bp">/</span><span class="n">Caches</span><span class="bp">/</span><span class="n">com</span><span class="bp">.</span><span class="n">apple</span><span class="bp">.</span><span class="n">xbs</span><span class="bp">/</span><span class="n">Binaries</span><span class="bp">/</span><span class="n">Libc_darwin</span><span class="bp">/</span><span class="n">install</span><span class="bp">/</span><span class="n">TempContent</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">/</span><span class="n">Libc</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">libsystem_darwin</span><span class="bp">.</span><span class="n">dylib</span><span class="bp">.</span><span class="n">build</span><span class="bp">/</span><span class="n">Objects</span><span class="bp">-</span><span class="n">normal</span><span class="bp">/</span><span class="n">x86_64</span><span class="bp">/</span><span class="n">variant</span><span class="bp">.</span><span class="n">o&#39;</span><span class="o">:</span> <span class="n">can&#39;t</span> <span class="kn">open</span> <span class="n">to</span> <span class="n">read</span> <span class="n">symbols</span><span class="o">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span><span class="bp">.</span>
<span class="n">LEAN</span> <span class="n">ASSERTION</span> <span class="n">VIOLATION</span>
<span class="n">File</span><span class="o">:</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">scott</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">kernel</span><span class="bp">/</span><span class="n">expr</span><span class="bp">.</span><span class="n">h</span>
<span class="n">Line</span><span class="o">:</span> <span class="mi">62</span>
<span class="n">Task</span><span class="o">:</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">scott</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">logic</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span>
<span class="n">get_rc</span><span class="o">()</span> <span class="bp">&gt;</span> <span class="mi">0</span>
<span class="o">(</span><span class="n">C</span><span class="o">)</span><span class="n">ontinue</span><span class="o">,</span> <span class="o">(</span><span class="n">A</span><span class="o">)</span><span class="n">bort</span><span class="bp">/</span><span class="kn">exit</span><span class="o">,</span> <span class="o">(</span><span class="n">S</span><span class="o">)</span><span class="n">top</span><span class="bp">/</span><span class="n">trap</span>
</code></pre></div>



<a name="197563498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563498">(May 14 2020 at 14:32)</a>:</h4>
<p>I assume I should type <code>S</code> to stop, before I run <code>bt</code>?</p>



<a name="197563553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563553">(May 14 2020 at 14:32)</a>:</h4>
<p>Doing that reports:</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span><span class="n">gdb</span><span class="o">)</span> <span class="n">bt</span>
<span class="bp">#</span><span class="mi">0</span>  <span class="mi">0</span><span class="n">x00007fff6588fb66</span> <span class="k">in</span> <span class="err">??</span> <span class="o">()</span> <span class="k">from</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">system</span><span class="bp">/</span><span class="n">libsystem_kernel</span><span class="bp">.</span><span class="n">dylib</span>
<span class="bp">#</span><span class="mi">1</span>  <span class="mi">0</span><span class="n">x00007fff65a5a080</span> <span class="k">in</span> <span class="n">pthread_kill</span> <span class="o">()</span> <span class="k">from</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">system</span><span class="bp">/</span><span class="n">libsystem_pthread</span><span class="bp">.</span><span class="n">dylib</span>
<span class="bp">#</span><span class="mi">2</span>  <span class="mi">0</span><span class="n">x00007fff657eb1ae</span> <span class="k">in</span> <span class="n">abort</span> <span class="o">()</span> <span class="k">from</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">system</span><span class="bp">/</span><span class="n">libsystem_c</span><span class="bp">.</span><span class="n">dylib</span>
<span class="bp">#</span><span class="mi">3</span>  <span class="mi">0</span><span class="n">x00007fff9da5c520</span> <span class="k">in</span> <span class="err">??</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">4</span>  <span class="mi">0</span><span class="n">x00007fffffffffdf</span> <span class="k">in</span> <span class="err">??</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">5</span>  <span class="mi">0</span><span class="n">xffffffffefbf6120</span> <span class="k">in</span> <span class="err">??</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">6</span>  <span class="mi">0</span><span class="n">x0000000101d81aa8</span> <span class="k">in</span> <span class="err">??</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">7</span>  <span class="mi">0</span><span class="n">x00007ffeefbf6120</span> <span class="k">in</span> <span class="err">??</span> <span class="o">()</span>
<span class="bp">#</span><span class="mi">8</span>  <span class="mi">0</span><span class="n">x000000010008d499</span> <span class="k">in</span> <span class="n">lean</span><span class="bp">::</span><span class="n">debuggable_exit</span> <span class="o">()</span> <span class="n">at</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">scott</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">util</span><span class="bp">/</span><span class="n">debug</span><span class="bp">.</span><span class="n">cpp</span><span class="o">:</span><span class="mi">80</span>
<span class="n">Backtrace</span> <span class="n">stopped</span><span class="o">:</span> <span class="n">frame</span> <span class="n">did</span> <span class="n">not</span> <span class="n">save</span> <span class="n">the</span> <span class="n">PC</span>
</code></pre></div>



<a name="197563686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563686">(May 14 2020 at 14:33)</a>:</h4>
<p>This looks like a release build.  Could you try this again with a debug build (<code>-DCMAKE_BUILD_TYPE=Debug</code>)?</p>



<a name="197563769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563769">(May 14 2020 at 14:34)</a>:</h4>
<p>oops!</p>



<a name="197563949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197563949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197563949">(May 14 2020 at 14:35)</a>:</h4>
<p>Hmm, no, here's what I ran:</p>
<div class="codehilite"><pre><span></span><code><span class="n">mkdir</span> <span class="bp">-</span><span class="n">p</span> <span class="n">build</span><span class="bp">/</span><span class="n">debug</span>
<span class="n">cd</span> <span class="n">build</span><span class="bp">/</span><span class="n">debug</span>
<span class="n">cmake</span> <span class="bp">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="bp">=</span><span class="n">DEBUG</span> <span class="bp">-</span><span class="n">G</span> <span class="n">Ninja</span> <span class="bp">../../</span><span class="n">src</span>
<span class="n">ninja</span>
</code></pre></div>



<a name="197564220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197564220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197564220">(May 14 2020 at 14:37)</a>:</h4>
<p>Hmm, this should actually work.</p>



<a name="197564385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197564385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197564385">(May 14 2020 at 14:38)</a>:</h4>
<p>Let's see what happens here. I took a tea break in the hopes it would be done when I got back, but nope!</p>



<a name="197565234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197565234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197565234">(May 14 2020 at 14:44)</a>:</h4>
<p>I ran <code>git clean -xfd</code> and rebuilt, with exactly the same output...</p>



<a name="197565841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197565841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197565841">(May 14 2020 at 14:48)</a>:</h4>
<p>I'm not really sure what is going on on macos.  I don't think you're doing anything wrong per se.</p>



<a name="197566105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197566105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197566105">(May 14 2020 at 14:50)</a>:</h4>
<p>Is there an expected time until error? Been going ~20 min so far.</p>



<a name="197566297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197566297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197566297">(May 14 2020 at 14:52)</a>:</h4>
<p>The error should appear almost immediately when compiling the standard library.  The assertion violation happens in <code>init/logic.lean</code>.</p>



<a name="197566542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197566542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197566542">(May 14 2020 at 14:54)</a>:</h4>
<p>Then I guess I'm killing this gdb run...</p>



<a name="197566602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197566602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197566602">(May 14 2020 at 14:54)</a>:</h4>
<p>It seems to have built an olean for every file in core.</p>



<a name="197567670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197567670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197567670">(May 14 2020 at 15:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> You might have better luck with <code>lldb</code>. Or not.</p>



<a name="197567977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197567977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197567977">(May 14 2020 at 15:02)</a>:</h4>
<p>I better sleep. I'll try tomorrow.</p>



<a name="197568069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197568069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197568069">(May 14 2020 at 15:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> If you're still here, can you try to finish compiling <code>library</code>.  And then in a separate call, compile the <code>leanpkg</code> directory?</p>



<a name="197568155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197568155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197568155">(May 14 2020 at 15:03)</a>:</h4>
<p>In or outside of gdb?</p>



<a name="197568281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197568281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197568281">(May 14 2020 at 15:04)</a>:</h4>
<p>I killed the last session and cleared the oleans. Trying again to see how long it took. Almost have them all back.</p>



<a name="197568379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197568379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197568379">(May 14 2020 at 15:04)</a>:</h4>
<p>Inside gdb, just in case something interesting happens.</p>



<a name="197569161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197569161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197569161">(May 14 2020 at 15:09)</a>:</h4>
<p>Okay, so I've had no errors in gdb, a olean file exists for every lean in core. Still two lean threads running at full throttle. gdb output isn't changing.</p>



<a name="197569194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197569194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197569194">(May 14 2020 at 15:09)</a>:</h4>
<p>Kill gdb and start again?</p>



<a name="197569221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197569221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197569221">(May 14 2020 at 15:09)</a>:</h4>
<p>(Keeping the current oleans?)</p>



<a name="197569631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197569631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197569631">(May 14 2020 at 15:12)</a>:</h4>
<p>Let's first wait until it's finished.</p>



<a name="197569764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197569764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197569764">(May 14 2020 at 15:12)</a>:</h4>
<p>Is it possibly nondeterministic and, if so, maybe it can also fail on linux?</p>



<a name="197571123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197571123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197571123">(May 14 2020 at 15:21)</a>:</h4>
<p>Well, I'm down to one thread at full throttle now.</p>



<a name="197576248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197576248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197576248">(May 14 2020 at 15:55)</a>:</h4>
<p>Okay, it built the library and leanpkg with no errors.</p>



<a name="197576324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197576324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197576324">(May 14 2020 at 15:55)</a>:</h4>
<p>That's unfortunate.</p>



<a name="197576978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197576978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197576978">(May 14 2020 at 16:00)</a>:</h4>
<p>looks like 3.11.0 is built okay on Mac. a few more builds will get to the breaking change.</p>



<a name="197577060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197577060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197577060">(May 14 2020 at 16:00)</a>:</h4>
<p>Also 3.12 is fine.  The crash is due to the PR: <a href="https://github.com/leanprover-community/lean/issues/234">lean#234</a></p>



<a name="197577272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197577272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197577272">(May 14 2020 at 16:02)</a>:</h4>
<p>yeah, that PR is based on <code>v3.11.0</code></p>



<a name="197577500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197577500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197577500">(May 14 2020 at 16:03)</a>:</h4>
<p>Generally speaking, setting up an ASan+UBSan build has saved me many times developing Lean 4 and debugging its runtime. I can't promise it will help in this case, of course.</p>



<a name="197577658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197577658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197577658">(May 14 2020 at 16:04)</a>:</h4>
<p>the stack trace points to some ref counting issue</p>



<a name="197577744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197577744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197577744">(May 14 2020 at 16:05)</a>:</h4>
<p>so maybe msan would help</p>



<a name="197578527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197578527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197578527">(May 14 2020 at 16:10)</a>:</h4>
<p>use-after-frees are detected by asan, not msan</p>



<a name="197578606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197578606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197578606">(May 14 2020 at 16:10)</a>:</h4>
<p>yeah, you're right.</p>



<a name="197578714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197578714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197578714">(May 14 2020 at 16:11)</a>:</h4>
<p>Ok, building with <code>-fsanitize=address -fsanitize=undefined</code> now.</p>



<a name="197578984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197578984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197578984">(May 14 2020 at 16:13)</a>:</h4>
<p>(I hope that concatenates instead of overrides the sanitizers. Lean 4 CI is using <code>-fsanitize=address,undefined</code>)</p>



<a name="197579036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197579036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197579036">(May 14 2020 at 16:13)</a>:</h4>
<p>after bisecting, i think the very first commit in that PR is the cause <a href="https://github.com/leanprover-community/lean/pull/234/commits/26ae0a7fec042d80820b14b54eaa8b199888d3ba">https://github.com/leanprover-community/lean/pull/234/commits/26ae0a7fec042d80820b14b54eaa8b199888d3ba</a></p>



<a name="197579359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197579359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197579359">(May 14 2020 at 16:15)</a>:</h4>
<p>I've already run it with <code>-fsanitize=address</code> and it just found pages worth of leaks, but no real problems.  It's ok if only UB is sanitized now.</p>



<a name="197580997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197580997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197580997">(May 14 2020 at 16:26)</a>:</h4>
<p>Oh, wow.  This begins well:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">gebner</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">frontends</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">cmd_table</span><span class="bp">.</span><span class="n">h</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="o">:</span> <span class="n">load</span> <span class="n">of</span> <span class="n">value</span> <span class="mi">30</span><span class="o">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="n">for</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">bool&#39;</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">gebner</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">kernel</span><span class="bp">/</span><span class="kn">inductive</span><span class="bp">/</span><span class="kn">inductive</span><span class="bp">.</span><span class="n">cpp</span><span class="o">:</span><span class="mi">99</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="o">:</span> <span class="n">load</span> <span class="n">of</span> <span class="n">value</span> <span class="mi">236</span><span class="o">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="n">for</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">bool&#39;</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">gebner</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">kernel</span><span class="bp">/</span><span class="kn">inductive</span><span class="bp">/</span><span class="kn">inductive</span><span class="bp">.</span><span class="n">cpp</span><span class="o">:</span><span class="mi">99</span><span class="o">:</span><span class="mi">12</span><span class="o">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="o">:</span> <span class="n">load</span> <span class="n">of</span> <span class="n">value</span> <span class="mi">15</span><span class="o">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="n">for</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">bool&#39;</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">gebner</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">user_recursors</span><span class="bp">.</span><span class="n">h</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="o">:</span> <span class="n">load</span> <span class="n">of</span> <span class="n">value</span> <span class="mi">88</span><span class="o">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="n">for</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">bool&#39;</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">gebner</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">user_recursors</span><span class="bp">.</span><span class="n">h</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="o">:</span> <span class="n">load</span> <span class="n">of</span> <span class="n">value</span> <span class="mi">18</span><span class="o">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="n">for</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">bool&#39;</span>
<span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">gebner</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">projection</span><span class="bp">.</span><span class="n">h</span><span class="o">:</span><span class="mi">22</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span> <span class="n">runtime</span> <span class="n">error</span><span class="o">:</span> <span class="n">load</span> <span class="n">of</span> <span class="n">value</span> <span class="mi">179</span><span class="o">,</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">value</span> <span class="n">for</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">bool&#39;</span>
</code></pre></div>



<a name="197584734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197584734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197584734">(May 14 2020 at 16:53)</a>:</h4>
<p><a href="https://pastebin.com/DB9eLMpG">https://pastebin.com/DB9eLMpG</a></p>



<a name="197590929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197590929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197590929">(May 14 2020 at 17:37)</a>:</h4>
<p><span class="user-mention" data-user-id="284601">@Nam</span> Thanks to your backtrace I was able to fix the issue.</p>



<a name="197591740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197591740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197591740">(May 14 2020 at 17:44)</a>:</h4>
<p>you're welcome.</p>



<a name="197592209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Looking%20for%20a%20mac/windows%20debugging%20expert/near/197592209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Looking.20for.20a.20mac.2Fwindows.20debugging.20expert.html#197592209">(May 14 2020 at 17:47)</a>:</h4>
<p>This is what I believe happened.  (But all I know about the error is a backtrace, so this might be wrong.)  The segfault happened in the deserialization code, which looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">simp_lemma</span> <span class="n">sl</span><span class="p">;</span>
<span class="n">deser</span> <span class="o">&gt;&gt;</span> <span class="n">sl</span><span class="p">;</span>
</code></pre></div>


<p>Inside the <code>&gt;&gt;</code>, <code>sl</code> is assigned.  At this point the destructor for <code>sl</code> is called, and then the segfault happens according to the backtrace.  Note that we call the default constructor for <code>simp_lemma</code> here:</p>
<div class="codehilite"><pre><span></span><code><span class="n">simp_lemma</span><span class="o">::</span><span class="n">simp_lemma</span><span class="p">()</span><span class="o">:</span><span class="n">simp_lemma</span><span class="p">(</span><span class="n">g_dummy</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div>


<p>And this dummy was an "exotic" simp lemma.  Usually the <code>m_kind</code> field indicates which subclass of <code>simp_lemma_cell</code> we have, e.g. <code>Simp</code> means <code>regular_simp_lemma_cell</code>.  But the dummy lemma was of type <code>simp_lemma_cell</code> even though it had kind <code>Simp</code>.<br>
Unfortunately that's all I've got.  I can't explain how this leads to a double-free of an expression.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>