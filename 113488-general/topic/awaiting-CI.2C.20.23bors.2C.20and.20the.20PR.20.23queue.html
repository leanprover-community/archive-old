---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html">awaiting-CI, #bors, and the PR #queue</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="255707294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255707294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255707294">(Oct 01 2021 at 08:19)</a>:</h4>
<p>(wanna rename to "awaiting-CI, <a href="https://app.bors.tech/repositories/24316">#bors</a>, and the PR <a href="https://bit.ly/3zVLgqR">#queue</a>"? <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span>)</p>



<a name="255707568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255707568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255707568">(Oct 01 2021 at 08:21)</a>:</h4>
<p>For the status failure, is there any way to discriminate between between a CI failure and a bors failure? It happened to one of my PRs a while back to be put off the queue after a failed batch which means it subsequently got forgotten as it wasn't showing up on the queue.</p>



<a name="255708606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255708606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255708606">(Oct 01 2021 at 08:30)</a>:</h4>
<p>This is indeed frustrating. But I'm not aware of fine-grained control over these failures. It would be good if GH allowed us to do <code>cases</code> on the failure status.</p>



<a name="255710394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255710394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255710394">(Oct 01 2021 at 08:45)</a>:</h4>
<p>You can also vote up my <a href="https://github.com/bors-ng/bors-ng/issues/1227">issue</a> on the bors repository. :-)</p>



<a name="255710783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255710783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255710783">(Oct 01 2021 at 08:48)</a>:</h4>
<p>Until that bors issue is fixed, could we have a tiny github action that overwrites these <span aria-label="cross mark" class="emoji emoji-274c" role="img" title="cross mark">:cross_mark:</span> generated by bors?</p>



<a name="255754196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255754196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255754196">(Oct 01 2021 at 14:37)</a>:</h4>
<p>I'm thinking of adding some steps to the CI to keep "awaiting-CI" updated as well as adding a label "oleans-up-to-date" (naming suggestions welcome) which indicates whether there are up-to-date oleans available via <code>leanproject</code>. Here's what I have in mind:</p>
<ul>
<li>when a new CI job starts, remove "oleans-up-to-date"</li>
<li>when "Build mathlib" succeeds, add a label "oleans-up-to-date"</li>
<li>when all jobs have finished, remove "awaiting-CI" (here we could also have leanprover-community-bot add "bors r+" to a PR with "ready-for-bors" or another label; the downside is that anyone with push access could add that label and trigger a merge.)</li>
</ul>



<a name="255757804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255757804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255757804">(Oct 01 2021 at 15:01)</a>:</h4>
<p>what about "has-oleans"?</p>



<a name="255791053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255791053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255791053">(Oct 01 2021 at 18:53)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/9491">#9491</a></p>



<a name="255792964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255792964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255792964">(Oct 01 2021 at 19:07)</a>:</h4>
<p>Whoops, this is trickier than I thought it would be. The issue is that our CI runs on every pushed <strong>commit</strong>, whereas labels are associated to a <strong>PR</strong> and there isn't a 1 to 1 association between commits and PRs. Would it make sense to perform the above-listed actions on all PRs whose branches contain the pushed commit or are there some cases where that's undesirable?</p>



<a name="255793787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255793787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255793787">(Oct 01 2021 at 19:14)</a>:</h4>
<p>The has-oleans one should only apply if the commit is the tip of the branch, no?</p>



<a name="255794431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255794431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255794431">(Oct 01 2021 at 19:19)</a>:</h4>
<p>Yes, that's right. We have a job which auto-cancels workflows running on out-of-date commits which I think should catch that, although I should think a little bit more about whether there are any weird race conditions.</p>



<a name="255800372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255800372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255800372">(Oct 01 2021 at 20:06)</a>:</h4>
<p>OK, I'm stuck on the following. Right now, as long as <code>leanpkg build</code> has started,  the job will upload oleans even if the build fails. The proposed behavior would be that "has-oleans" gets applied as well, which I think is reasonable. </p>
<p>Now consider the following sequence of events:</p>
<ol>
<li>Commit 1 is pushed to a branch, triggering build 1</li>
<li>Commit 2 gets pushed to the same branch, triggering build 2 </li>
<li>Build 2 cancels build 1.</li>
</ol>
<p>Because it takes time for build 1 to get canceled and for it to finish uploading oleans, etc., the following is difficult to avoid:</p>
<ol start="4">
<li>Build 2 removes "has-oleans" from the PR</li>
<li>Build 1 uploads oleans and then applies "has-oleans" to the PR</li>
</ol>
<p>Now the PR "has-oleans", but not up-to-date ones (at least until build 2 uploads its oleans).</p>



<a name="255817606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255817606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255817606">(Oct 01 2021 at 22:40)</a>:</h4>
<p>Is has-oleans actually that useful?</p>



<a name="255818167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255818167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255818167">(Oct 01 2021 at 22:46)</a>:</h4>
<p>Stale oleans in a leaf file are often just as good as fresh ones</p>



<a name="255819436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255819436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255819436">(Oct 01 2021 at 23:01)</a>:</h4>
<p>I think with the recent changes to <code>leanproject get-cache</code> it's no longer so essential to mark <code>has-oleans</code>. (Or, if we do want to mark it, no longer essential that we get it perfectly right!)</p>



<a name="255822223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/awaiting-CI%2C%20%23bors%2C%20and%20the%20PR%20%23queue/near/255822223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/awaiting-CI.2C.20.23bors.2C.20and.20the.20PR.20.23queue.html#255822223">(Oct 01 2021 at 23:30)</a>:</h4>
<p>OK, I'll drop <code>has-oleans</code> for now and see if I can get something just to remove <code>awaiting-CI</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>