---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html">timeout (universe or diamond? not sure)</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="272718519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272718519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272718519">(Feb 21 2022 at 17:50)</a>:</h4>
<p>Here's something <span class="user-mention" data-user-id="464700">@David Ang</span> pointed out on the Discord. <code>units_mod.fintype</code> and <code>units_mod.fintype'</code> are identical modulo an extra <code>id</code>. They both compile fine and give defeq answers. However if I generalise the <code>units.fg</code> instance to allow <code>K : Type u</code> then the first instance still compiles but the second one starts timing out. I feel like I've been getting quite good at these issues recently but here I'm lost; I'm not sure whether I should be looking for a diamond, or whether this is a universe issue.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">number_theory.number_field</span>
<span class="n">open_locale</span> <span class="n">number_field</span>

<span class="kd">universe</span> <span class="n">u</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_group</span> <span class="n">G</span><span class="o">]</span>
<span class="kn">local</span> <span class="kd">notation</span> <span class="n">n</span><span class="bp">`⬝`</span><span class="n">G</span> <span class="o">:=</span> <span class="o">(</span><span class="n">zpow_group_hom</span> <span class="n">n</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">→*</span> <span class="n">G</span><span class="o">)</span><span class="bp">.</span><span class="n">range</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">quotient_group.fintype_of_fg</span> <span class="o">[</span><span class="n">group.fg</span> <span class="n">G</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="n">G</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">classical.choice</span> <span class="gr">sorry</span> <span class="c1">-- avoiding sorrying data</span>

<span class="c1">-- change {K : Type} to {K : Type u} and units_mod.fintype' times out</span>
<span class="kd">instance</span> <span class="n">units.fg</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">group.fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">K</span><span class="o">)</span><span class="bp">ˣ</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">id</span> <span class="n">_</span> <span class="bp">@</span><span class="n">units.fg</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">n</span>

<span class="c1">-- the same but without an id</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype'</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">units.fg</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">n</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">units_mod.fintype</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">units_mod.fintype'</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="272718765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272718765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272718765">(Feb 21 2022 at 17:53)</a>:</h4>
<p>by the way the <code>id</code> there is doing a weird thing, it's applying directly to <code>@units.fg</code>, not <code>@units.fg L _ _</code></p>



<a name="272718865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272718865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272718865">(Feb 21 2022 at 17:54)</a>:</h4>
<p>and since <code>id</code>  is not reducible you should expect it to change the results of all the typeclass searches in those <code>_</code></p>



<a name="272718876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272718876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272718876">(Feb 21 2022 at 17:54)</a>:</h4>
<p>although that doesn't really solve the question</p>



<a name="272718944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272718944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272718944">(Feb 21 2022 at 17:55)</a>:</h4>
<p>oh yeah, thanks; putting in the brackets doesn't change anything though.</p>



<a name="272719515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272719515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272719515">(Feb 21 2022 at 18:01)</a>:</h4>
<p>With <code>trace.class_instances true</code> the traces for <code>units_mod.fintype</code> and <code>units_mod.fintype'</code> are identical (over 5800 lines of it).</p>



<a name="272719595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272719595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272719595">(Feb 21 2022 at 18:02)</a>:</h4>
<p>My guess is something in defeq checking</p>



<a name="272720352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720352">(Feb 21 2022 at 18:10)</a>:</h4>
<p>Hm, there is a type mismatch:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gd">--- src/expected.txt    2022-02-21 13:06:48.514253485 -0500</span><span class="w"></span>
<span class="gi">+++ src/produced.txt    2022-02-21 13:06:58.170170784 -0500</span><span class="w"></span>
<span class="gu">@@ -1,140 +1,93 @@</span><span class="w"></span>
<span class="w"> </span>@group.fg.{0}<span class="w"></span>
<span class="w"> </span>    (@units.{0}<span class="w"></span>
<span class="w"> </span>       (@coe_sort.{1 2} ...)<span class="w"></span>
<span class="w"> </span>       (@ring.to_monoid.{0}...))<span class="w"></span>
<span class="gd">-    (@comm_group.to_group.{0}</span><span class="w"></span>
<span class="gd">-       (@units.{0}</span><span class="w"></span>
<span class="gd">-          (@coe_sort.{1 2}</span><span class="w"></span>
<span class="gi">+    (@units.group.{0}</span><span class="w"></span>
<span class="gi">+       (@coe_sort.{1 2}</span><span class="w"></span>
<span class="gi">+          (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gi">+             (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gi">+                (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gi">+                   (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gi">+             (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))</span><span class="w"></span>
<span class="gi">+          Type</span><span class="w"></span>
<span class="gi">+          (@set_like.has_coe_to_sort.{0 0}</span><span class="w"></span>
<span class="w"> </span>             (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)<span class="w"></span>
<span class="w"> </span>                (@ring.to_semiring.{0} L<span class="w"></span>
<span class="w"> </span>                   (@comm_ring.to_ring.{0} L<span class="w"></span>
<span class="w"> </span>                      (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))<span class="w"></span>
<span class="w"> </span>                (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))<span class="w"></span>
<span class="gd">-             Type</span><span class="w"></span>
<span class="gd">-             (@set_like.has_coe_to_sort.{0 0}</span><span class="w"></span>
<span class="gd">-                (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                   (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                      (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                   (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                L</span><span class="w"></span>
<span class="gd">-                (@subalgebra.set_like.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                   (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                      (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                   (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))))</span><span class="w"></span>
<span class="gd">-             (@number_field.ring_of_integers.{0} L _inst_2))</span><span class="w"></span>
<span class="gd">-          (@ring.to_monoid.{0}</span><span class="w"></span>
<span class="gd">-             (@coe_sort.{1 2}</span><span class="w"></span>
<span class="gd">-                (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                   (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                      (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                   (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                Type</span><span class="w"></span>
<span class="gd">-                (@set_like.has_coe_to_sort.{0 0}</span><span class="w"></span>
<span class="gd">-                   (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                      (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                            (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                      (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                   L</span><span class="w"></span>
<span class="gd">-                   (@subalgebra.set_like.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                      (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                            (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                      (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))))</span><span class="w"></span>
<span class="gd">-                (@number_field.ring_of_integers.{0} L _inst_2))</span><span class="w"></span>
<span class="gd">-             (@subalgebra.to_ring.{0 0} int L int.comm_ring</span><span class="w"></span>
<span class="gd">-                (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))</span><span class="w"></span>
<span class="gd">-                (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))</span><span class="w"></span>
<span class="gd">-                (@number_field.ring_of_integers.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-       (@units.comm_group.{0}</span><span class="w"></span>
<span class="gi">+             L</span><span class="w"></span>
<span class="gi">+             (@subalgebra.set_like.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gi">+                (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gi">+                   (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gi">+                      (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gi">+                (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))))</span><span class="w"></span>
<span class="gi">+          (@number_field.ring_of_integers.{0} L _inst_2))</span><span class="w"></span>
<span class="gi">+       (@ring.to_monoid.{0}</span><span class="w"></span>
<span class="w"> </span>          (@coe_sort.{1 2} ...)<span class="w"></span>
<span class="gd">-          (@comm_ring.to_comm_monoid.{0}</span><span class="w"></span>
<span class="gd">-             (@coe_sort.{1 2}</span><span class="w"></span>
<span class="gd">-                (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                   (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                      (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                   (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                Type</span><span class="w"></span>
<span class="gd">-                (@set_like.has_coe_to_sort.{0 0}</span><span class="w"></span>
<span class="gd">-                   (@subalgebra.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                      (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                            (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                      (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                   L</span><span class="w"></span>
<span class="gd">-                   (@subalgebra.set_like.{0 0} int L (@comm_ring.to_comm_semiring.{0} int int.comm_ring)</span><span class="w"></span>
<span class="gd">-                      (@ring.to_semiring.{0} L</span><span class="w"></span>
<span class="gd">-                         (@comm_ring.to_ring.{0} L</span><span class="w"></span>
<span class="gd">-                            (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))))</span><span class="w"></span>
<span class="gd">-                      (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))))</span><span class="w"></span>
<span class="gd">-                (@number_field.ring_of_integers.{0} L _inst_2))</span><span class="w"></span>
<span class="gd">-             (@subalgebra.to_comm_ring.{0 0} int L int.comm_ring</span><span class="w"></span>
<span class="gd">-                (@euclidean_domain.to_comm_ring.{0} L (@field.to_euclidean_domain.{0} L _inst_2))</span><span class="w"></span>
<span class="gd">-                (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))</span><span class="w"></span>
<span class="gd">-                (@number_field.ring_of_integers.{0} L _inst_2)))))</span><span class="w"></span>
<span class="gi">+          (@subalgebra.to_ring.{0 0} int L int.comm_ring</span><span class="w"></span>
<span class="gi">+             (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2))</span><span class="w"></span>
<span class="gi">+             (@algebra_int.{0} L (@division_ring.to_ring.{0} L (@field.to_division_ring.{0} L _inst_2)))</span><span class="w"></span>
<span class="gi">+             (@number_field.ring_of_integers.{0} L _inst_2))))</span><span class="w"></span>
</code></pre></div>



<a name="272720427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720427">(Feb 21 2022 at 18:11)</a>:</h4>
<p>so somewhere in that monstrosity is an expensive defeq test</p>



<a name="272720717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720717">(Feb 21 2022 at 18:15)</a>:</h4>
<p>I found something like this and extracted two terms and checked they were equal with <code>rfl</code> and it was really quick</p>



<a name="272720731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720731">(Feb 21 2022 at 18:15)</a>:</h4>
<p>For context, I'm comparing the goal to the <code>have</code> in this example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- to ensure that units.fg is not getting unfolded</span>
<span class="kd">constant</span> <span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">units.fg</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">group.fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">K</span><span class="o">)</span><span class="bp">ˣ</span>

<span class="c1">-- the same but without an id</span>
<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="n">id</span> <span class="n">_</span><span class="o">)</span> <span class="n">n</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">units.fg</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">exact</span> <span class="bp">@</span><span class="n">units.fg</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="272720775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720775">(Feb 21 2022 at 18:15)</a>:</h4>
<p>if you use <code>exact this</code> it is quick, and if you use <code>@units.fg.{0} L _ _</code> it is also quick</p>



<a name="272720844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720844">(Feb 21 2022 at 18:16)</a>:</h4>
<p>so I think it has something to do with solving that equation while <code>units.fg.{?u}</code> still has a metavariable</p>



<a name="272720862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720862">(Feb 21 2022 at 18:16)</a>:</h4>
<p>even though applying it to <code>L</code> will solve the metavariable</p>



<a name="272720928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272720928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272720928">(Feb 21 2022 at 18:17)</a>:</h4>
<p>Aah yes, the two humungous terms of type <code>comm_group (↥(𝓞 L))ˣ</code> which I had were when we were in Type 0.</p>



<a name="272724553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272724553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272724553">(Feb 21 2022 at 19:00)</a>:</h4>
<p>If I tell Lean the universe level of <code>units.fg</code> it works. This really surprises me; I guess I don't know how Lean is solving universe variables (in the sense that this proves that it's not looking at L and saying "aah yes, let's use u=0"). Note we're <code>id</code>-free here.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">number_theory.number_field</span>
<span class="n">open_locale</span> <span class="n">number_field</span>

<span class="kd">universe</span> <span class="n">u</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_group</span> <span class="n">G</span><span class="o">]</span>
<span class="kn">local</span> <span class="kd">notation</span> <span class="n">n</span><span class="bp">`⬝`</span><span class="n">G</span> <span class="o">:=</span> <span class="o">(</span><span class="n">zpow_group_hom</span> <span class="n">n</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">→*</span> <span class="n">G</span><span class="o">)</span><span class="bp">.</span><span class="n">range</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">quotient_group.fintype_of_fg</span> <span class="o">[</span><span class="n">group.fg</span> <span class="n">G</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="n">G</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">classical.choice</span> <span class="gr">sorry</span> <span class="c1">-- avoiding sorrying data</span>

<span class="kd">instance</span> <span class="n">units.fg</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">group.fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">K</span><span class="o">)</span><span class="bp">ˣ</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">L</span><span class="o">]</span>

<span class="c1">-- works!</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype'</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">units.fg.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="n">_inst_2</span> <span class="n">_inst_3</span><span class="o">)</span> <span class="n">n</span>

<span class="c1">-- Now remove `.{0}` in `units.fg` and it fails</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">units.fg</span> <span class="n">L</span> <span class="n">_inst_2</span> <span class="n">_inst_3</span><span class="o">)</span> <span class="n">n</span>
</code></pre></div>



<a name="272725499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/timeout%20%28universe%20or%20diamond%3F%20not%20sure%29/near/272725499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/timeout.20(universe.20or.20diamond.3F.20not.20sure).html#272725499">(Feb 21 2022 at 19:09)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- make field explicit in units.fg</span>
<span class="kd">instance</span> <span class="n">units.fg</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">group.fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">K</span><span class="o">)</span><span class="bp">ˣ</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">L</span><span class="o">]</span>

<span class="c1">-- works very quickly</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype''</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">units.fg.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">n</span>

<span class="c1">-- works but takes quite a long time</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype'</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="n">units.fg.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span><span class="o">)</span> <span class="n">n</span>

<span class="c1">-- times out without universe hint</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">units.fg</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">n</span>

<span class="c1">-- times out without universe hint</span>
<span class="kd">noncomputable</span> <span class="kd">instance</span> <span class="n">units_mod.fintype</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fintype</span> <span class="bp">$</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="bp">⧸</span> <span class="o">(</span><span class="n">n</span><span class="bp">⬝</span><span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">quotient_group.fintype_of_fg.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="bp">𝓞</span> <span class="n">L</span><span class="o">)</span><span class="bp">ˣ</span> <span class="n">_</span> <span class="o">(</span><span class="n">units.fg</span> <span class="n">L</span><span class="o">)</span> <span class="n">n</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>