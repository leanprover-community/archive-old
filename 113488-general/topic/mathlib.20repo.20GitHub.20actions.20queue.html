---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html">mathlib repo GitHub actions queue</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="233516109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/233516109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#233516109">(Apr 07 2021 at 16:00)</a>:</h4>
<p>With our recent growth <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> we're starting to run into <a href="https://docs.github.com/en/actions/reference/usage-limits-billing-and-administration#usage-limits">limits on the number of concurrent GitHub actions workflows</a>. In light of this, I've started canceling workflows on "outdated" commits in some branches. Note that even after these cancellations we still have <a href="https://github.com/leanprover-community/mathlib/actions?query=is%3Aqueued">a bunch of queued workflows</a>. </p>
<p>I don't know that we need to do too much right now to address this, but maybe something to keep in mind.</p>



<a name="233516938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/233516938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#233516938">(Apr 07 2021 at 16:04)</a>:</h4>
<p>Is there any way to tell GHA that we don't want them to run just yet (per PR)? For example, on my WIP PR there's absolutely zero need a workflow right now, but it'd still be taking up a slot.</p>



<a name="233517599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/233517599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#233517599">(Apr 07 2021 at 16:09)</a>:</h4>
<p>Maybe there's a way to set it up so the CI runs on the latest commit only when the <code>awaiting-review</code> tag is added?</p>



<a name="233519756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/233519756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#233519756">(Apr 07 2021 at 16:22)</a>:</h4>
<p>It might be possible to adjust the scripts somehow, but it might be easiest now just to manually cancel redundant or unnecessary workflows (only if you want, this is totally optional!). If you click on the yellow circle next to a commit and then on "Details" next to any of the items that start with "continuous integration / ...", you will get to a page that will let you cancel the main (longest-running) workflow for that commit.</p>



<a name="235521141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235521141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235521141">(Apr 21 2021 at 14:38)</a>:</h4>
<p>I've canceled a few jobs again on outdated commits just now, from the branches <code>mul_vec_smul_assoc</code> and <code>structure_sheaf_basic_opens_iso</code>. </p>
<p><strong>edit</strong> and <code>fin_succ_succ_above_succ</code></p>



<a name="235573071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235573071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235573071">(Apr 21 2021 at 20:06)</a>:</h4>
<p>Hmm, this is somewhat concerning: <a href="https://github.com/leanprover-community/mathlib/actions/runs/770883207">this bors batch</a> just timed out and failed, not (just) because the CI time was too long, but I think also because some of its jobs were queued for a while before they started. The total time allowed is 6 hours and currently CI runs for around 4.5, so if the queue is stuck for a while this becomes more of a possibility.</p>
<p>I don't know of a way to tell GitHub actions to run certain jobs with a higher priority.</p>



<a name="235574082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235574082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235574082">(Apr 21 2021 at 20:13)</a>:</h4>
<p>I guess that technically we could make a <code>staging1</code> and <code>staging2</code>. Where the regular build gets a PR batch from <code>staging1</code> into <code>staging2</code> and then passing <code>leanchecker</code> you move from <code>staging2</code> to <code>master</code>.</p>



<a name="235574344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235574344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235574344">(Apr 21 2021 at 20:15)</a>:</h4>
<p>Can you elaborate? I'm not sure I understand the idea.</p>



<a name="235575888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235575888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235575888">(Apr 21 2021 at 20:28)</a>:</h4>
<p>Ugh, the current <code>staging</code> job has been queued for half an hour, so it might also end up timing out as well.</p>



<a name="235577420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235577420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235577420">(Apr 21 2021 at 20:40)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> I was thinking, if we type <code>bors merge</code>, then <code>bors</code> puts the PR  on a queue that will end up being merged into a staging branch (maybe <code>premaster</code>?). For this, it only needs to run half of CI.<br>
And then regularly, we run <code>leanchecker</code> on <code>premaster</code>, and merge it into <code>master</code>.</p>



<a name="235577431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235577431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235577431">(Apr 21 2021 at 20:41)</a>:</h4>
<p>That would split CI into two pieces.</p>



<a name="235577483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235577483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235577483">(Apr 21 2021 at 20:41)</a>:</h4>
<p>We would still check that <code>master</code> passes <code>leanchecker</code>. But maybe <code>leanchecker</code> doesn't need to be run on every PR and/or bors staging queue</p>



<a name="235579159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235579159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235579159">(Apr 21 2021 at 20:54)</a>:</h4>
<p>Hmm, I think this could help a bit, but I'm not sure how we would manage <code>premaster</code> vs <code>master</code>. Also, I think running <code>leanchecker</code> on all PRs is something that has been valuable for us. I haven't been following all the details, but haven't there been some <code>leanchecker</code> failures recently that were caught in PRs?</p>



<a name="235582418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235582418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235582418">(Apr 21 2021 at 21:10)</a>:</h4>
<p><code>leanchecker</code> is extremely slow since the nsmul and gsmul refactoring, for no good reason we can see, so disabling it until we understand what is going on might be reasonable.</p>



<a name="235582984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235582984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235582984">(Apr 21 2021 at 21:12)</a>:</h4>
<p>Would it help if we decided that everyone should have his branches on his own mathlib fork (with CI active on the fork)? This would only work out if oleans could also be uploaded for the forks, but it would split the workload a lot (and it could even scale if there are more contributors). CI on mathlib would then be only for bors PRs to master.</p>



<a name="235583689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235583689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235583689">(Apr 21 2021 at 21:15)</a>:</h4>
<p>Does bors rebuild the same commit after a timeout, or split the batch?</p>



<a name="235583804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235583804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235583804">(Apr 21 2021 at 21:16)</a>:</h4>
<p>Because if the former, our olean cache should at least save us from a second timeout</p>



<a name="235583876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235583876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235583876">(Apr 21 2021 at 21:16)</a>:</h4>
<p>It split the batch.</p>



<a name="235622990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235622990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235622990">(Apr 22 2021 at 05:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235582418">said</a>:</p>
<blockquote>
<p><code>leanchecker</code> is extremely slow since the nsmul and gsmul refactoring, for no good reason we can see, so disabling it until we understand what is going on might be reasonable.</p>
</blockquote>
<p>This comment is somewhat worrying to me. If leanchecker doesn't like the refactor, then maybe the refactor was a bad idea and/or forgot to mark something with the right reducibility setting and so on. I would rather back out the refactor than stop checking proofs with an external verifier</p>



<a name="235624381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235624381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235624381">(Apr 22 2021 at 06:04)</a>:</h4>
<p>Also concerning: <a href="https://github.com/leanprover-community/mathlib/runs/2405804842?check_suite_focus=true">the "Build mathlib" job in the current staging batch</a> took almost 4h17m (the previous longest build I saw was around 3h47m). Since it takes around an hour to run tests + lint, we don't have much more time available before we hit bors's 6 hour limit.</p>



<a name="235624598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235624598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235624598">(Apr 22 2021 at 06:07)</a>:</h4>
<p>Will the -T50000 challenge help here?</p>



<a name="235624611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235624611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235624611">(Apr 22 2021 at 06:07)</a>:</h4>
<p>or is the time budget going elsewhere</p>



<a name="235624631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235624631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235624631">(Apr 22 2021 at 06:08)</a>:</h4>
<p>I'm not sure. Maybe looking at what pops up in the <a class="stream" data-stream-id="113538" href="/#narrow/stream/113538-CI">#CI</a> thread will help.</p>



<a name="235625149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235625149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235625149">(Apr 22 2021 at 06:15)</a>:</h4>
<p>I'm staring at a stupid int module diamond in the liquid project and I know full well that the gsmul refactor was the right thing to do</p>



<a name="235625176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235625176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235625176">(Apr 22 2021 at 06:15)</a>:</h4>
<p>All I did was took the dual of a finite free Z-module.</p>



<a name="235625635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235625635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235625635">(Apr 22 2021 at 06:21)</a>:</h4>
<p>I'm looking again at the nsmul PR and I don't see anything that has specifically been indicated as taking a while. Part of the issue with diagnosing this is that the information we have is incredibly unfocused: we know that overall mathlib build time is rising but not which part of mathlib is contributing to the rise</p>



<a name="235625749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235625749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235625749">(Apr 22 2021 at 06:23)</a>:</h4>
<p>Obviously if you ask me leanchecker taking an hour is a ridiculous figure indicating that something has gone horribly wrong, it's doing the analogue of what metamath does in seconds</p>



<a name="235625762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235625762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235625762">(Apr 22 2021 at 06:23)</a>:</h4>
<p>anything more than 10 minutes seems crazy</p>



<a name="235626367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235626367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235626367">(Apr 22 2021 at 06:31)</a>:</h4>
<p>Does it help if we generate logs of what exactly <code>leanchecker</code> is spending it's time on? (Gabriel showed us how to do that.)<br>
I can generate such logs for several commits (say 10, or so) from the last month.</p>



<a name="235628374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235628374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235628374">(Apr 22 2021 at 06:58)</a>:</h4>
<p>Can this problem be solved by throwing money at it, by the way? (ie at GitHub or whoever is doing the thing that takes 4.5 hours)</p>



<a name="235629639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235629639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235629639">(Apr 22 2021 at 07:04)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span>, do you still have your(?) visualisations of the time cost of various parts of mathlib?</p>



<a name="235630089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235630089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235630089">(Apr 22 2021 at 07:07)</a>:</h4>
<p>This already takes longer than I expected</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">time</span> lean --recursive --export<span class="o">=</span>mathlib.txt src/

real    3m40.672s
user    3m32.014s
sys     0m7.948s
</code></pre></div>



<a name="235631646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235631646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235631646">(Apr 22 2021 at 07:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235629639">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span>, do you still have your(?) visualisations of the time cost of various parts of mathlib?</p>
</blockquote>
<p>I have <a href="https://observablehq.com/d/9fa916656de340a8">this notebook</a> which gets its data from <a href="https://tqft.net/lean/mathlib/?C=M;O=D">https://tqft.net/lean/mathlib/?C=M;O=D</a> (some of the logs there are broken, it seems).</p>



<a name="235631783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235631783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235631783">(Apr 22 2021 at 07:23)</a>:</h4>
<p>Ah, I see, once I stopped my build robot we lost that.</p>



<a name="235631843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235631843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235631843">(Apr 22 2021 at 07:23)</a>:</h4>
<p>I could probably adapt it to parse the HTML from the #CI build bot, but it might be easier just to have that bot spit out a JSON file with the timings.</p>



<a name="235633699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235633699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235633699">(Apr 22 2021 at 07:41)</a>:</h4>
<p>I'm now running <code>leanchecker +leanprover-community/lean:3.29.0 -v mathlib.txt 2&gt;&amp;1 | ts -i -m %.s</code> on latest master.</p>



<a name="235634596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235634596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235634596">(Apr 22 2021 at 07:50)</a>:</h4>
<p>Is <code>leanchecker</code> something that can be easily parallelized?</p>



<a name="235636727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235636727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235636727">(Apr 22 2021 at 08:08)</a>:</h4>
<p>It can be, but we shouldn't assume external typecheckers are threaded</p>



<a name="235637504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637504">(Apr 22 2021 at 08:15)</a>:</h4>
<p>Sure, we shouldn't. But it still helps if in the current situation we can divide the time by 16 or 32 just by parallelizing.</p>



<a name="235637525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637525">(Apr 22 2021 at 08:15)</a>:</h4>
<p>leanchecker timings for the commits just before <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a> and just after could be enough to see where the increase is located.</p>



<a name="235637601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637601">(Apr 22 2021 at 08:16)</a>:</h4>
<p>And it seems to me that in principal this is something that can be parallelized in extrema</p>



<a name="235637609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637609">(Apr 22 2021 at 08:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235637525">said</a>:</p>
<blockquote>
<p>leanchecker timings for the commits just before <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a> and just after could be enough to see where the increase is located.</p>
</blockquote>
<p>I'll do those next.</p>



<a name="235637631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637631">(Apr 22 2021 at 08:16)</a>:</h4>
<p>Thanks!</p>



<a name="235637639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637639">(Apr 22 2021 at 08:16)</a>:</h4>
<p>It's still running the one on current master.</p>



<a name="235637672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235637672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235637672">(Apr 22 2021 at 08:17)</a>:</h4>
<p>But I guess I'll just make 2 more copies of mathlib. Since it's using only a single thread anyway <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="235644894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235644894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235644894">(Apr 22 2021 at 09:21)</a>:</h4>
<p><del>Running 3 processes of <code>leanchecker</code> next to each other just ate up 32GB of memory</del> <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="235644915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235644915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235644915">(Apr 22 2021 at 09:21)</a>:</h4>
<p>Is that to be expected? Or does this hint at a memory leak?</p>



<a name="235646256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235646256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235646256">(Apr 22 2021 at 09:31)</a>:</h4>
<p>Sorry, I take that back. It was 3 copies of single-threaded <code>lean --recursive --export=mathlib.txt src/</code></p>



<a name="235646297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235646297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235646297">(Apr 22 2021 at 09:31)</a>:</h4>
<p>Still, I'm surprised that would take up so much RAM</p>



<a name="235650583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235650583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235650583">(Apr 22 2021 at 10:05)</a>:</h4>
<p>How many lines of output does <code>leanchecker</code> have, roughly?</p>



<a name="235650723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235650723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235650723">(Apr 22 2021 at 10:06)</a>:</h4>
<p>I'm creating roughly 30.000 lines of output in roughly 6 minutes, at the moment.</p>



<a name="235650761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235650761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235650761">(Apr 22 2021 at 10:06)</a>:</h4>
<p>Line 26000 stands out:</p>
<blockquote>
<p>6.202454    26000 nat.inv_pos_of_nat</p>
</blockquote>



<a name="235650811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235650811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235650811">(Apr 22 2021 at 10:07)</a>:</h4>
<p>(My terminal is printing every 1000th line, and everything is being written to a file.)</p>



<a name="235650844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235650844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235650844">(Apr 22 2021 at 10:07)</a>:</h4>
<p>But apparently <code>nat.inv_pos_of_nat</code> is taking 6.2 leanchecker seconds.</p>



<a name="235650944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235650944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235650944">(Apr 22 2021 at 10:08)</a>:</h4>
<p>The typical line is</p>
<blockquote>
<p>0.000029    27000 quotient_group.quotient.div_inv_monoid._proof_3</p>
</blockquote>



<a name="235653558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235653558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235653558">(Apr 22 2021 at 10:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235631843">said</a>:</p>
<blockquote>
<p>I could probably adapt it to parse the HTML from the #CI build bot, but it might be easier just to have that bot spit out a JSON file with the timings.</p>
</blockquote>
<p>What do you need? Exporting file-level timings should be no problem since I have them in the database anyway.</p>



<a name="235654632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235654632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235654632">(Apr 22 2021 at 10:42)</a>:</h4>
<p>File-level timings for each commit in JSON format would be easiest for me to work with. <a href="https://tqft.net/lean/mathlib/6f7c53944fc28ee54bddd4f5049a0ae269b4c23e.json">Here's an example</a> of what Scott was generating before (the 3 numbers are real, user and sys times from <a href="#narrow/stream/113538-CI/topic/build.20time.20bot/near/199713332">this script</a>).</p>



<a name="235655044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235655044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235655044">(Apr 22 2021 at 10:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235650844">said</a>:</p>
<blockquote>
<p>But apparently <code>nat.inv_pos_of_nat</code> is taking 6.2 leanchecker seconds.</p>
</blockquote>
<p>You are really talking about <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.inv_pos_of_nat">docs#nat.inv_pos_of_nat</a>? That takes 22.1ms to elaborate on my computer? Looks crazy!</p>



<a name="235655065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235655065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235655065">(Apr 22 2021 at 10:46)</a>:</h4>
<p>No I can see why</p>



<a name="235655467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235655467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235655467">(Apr 22 2021 at 10:50)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">inv_pos_of_nat</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="o">((</span><span class="n">n</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="n">inv_pos.2</span> <span class="bp">$</span> <span class="n">add_pos_of_nonneg_of_pos</span> <span class="n">n.cast_nonneg</span> <span class="n">zero_lt_one</span>
</code></pre></div>
<p>The issue is in <code>n.cast_nonneg</code>, which proves </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">nat.cast_nonneg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">ordered_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="n">n</span>
</code></pre></div>
<p>when the current context is about a <code>linear_ordered_field</code>. This involves proving that the two <code>nat.cast</code> expressions are the same, which requires unfolding <code>nat.cast</code> until it uses projections, as well as unfolding all of the typeclass constructors in this stack:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="o">(</span><span class="bp">@</span><span class="n">coe.</span><span class="o">{</span><span class="mi">1</span> <span class="n">u_1</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="n">α</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">coe_to_lift.</span><span class="o">{</span><span class="mi">1</span> <span class="n">u_1</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">nat</span> <span class="n">α</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">nat.cast_coe.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class.to_has_zero.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_one_class.to_mul_zero_class.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_one_class.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                      <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                         <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                            <span class="o">(</span><span class="bp">@</span><span class="n">ordered_ring.to_ring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                               <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_ring.to_ordered_ring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
                                  <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_comm_ring.to_linear_ordered_ring.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span>
</code></pre></div>
<p>That is, the kernel is going to have to look at <code>linear_ordered_comm_ring.mk</code> with its 40 fields, and <code>linear_ordered_ring.mk</code> with its 39 fields and so on</p>



<a name="235655542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235655542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235655542">(Apr 22 2021 at 10:51)</a>:</h4>
<p>So you're saying it's bad because of old style structures?</p>



<a name="235655562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235655562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235655562">(Apr 22 2021 at 10:51)</a>:</h4>
<p>leo was always making a big deal about "packing and unpacking" and I think this is it</p>



<a name="235656326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656326">(Apr 22 2021 at 10:59)</a>:</h4>
<p>I wonder if we shouldn't make our algebraic spine flatter. I mean, have:</p>
<ul>
<li><code>monoid</code> extending <code>has_mul</code> and <code>has_one</code></li>
<li><code>add_monoid</code> extending <code>has_add</code> and <code>has_zero</code></li>
<li><code>semiring</code> extending <code>monoid</code> and <code>add_monoid</code></li>
<li><code>ring</code> extending <code>semiring</code></li>
<li><code>field</code> extending <code>ring</code><br>
and all the other ones built on these ones. The fact that a semiring is a monoid with zero would be registered with an instance, not direct inheritance. In this way, when you need to access the basic fields the path is much shorter than what we have currently. (And also, no need for old style structures since there are no common fields in the spine I described).</li>
</ul>



<a name="235656479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656479">(Apr 22 2021 at 11:00)</a>:</h4>
<p>Well part of the issue is that typeclass inference is finding these inconveniently long paths, even when short paths exist</p>



<a name="235656485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656485">(Apr 22 2021 at 11:00)</a>:</h4>
<p>(with <code>group</code> extending <code>monoid</code> and <code>add_group</code> extending <code>add_monoid</code>, and instances from <code>ring</code> to <code>add_group</code>)</p>



<a name="235656524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656524">(Apr 22 2021 at 11:01)</a>:</h4>
<p>old structures are optimized by having lots of "shortcut" instances, but shortcut instances don't work with lean 3 typeclass inference</p>



<a name="235656635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656635">(Apr 22 2021 at 11:02)</a>:</h4>
<p>(I expect this wouldn't help too much for the reasons Mario describes, but if we do it, we would also need to insert <code>add_sub_monoid</code> and <code>div_inv_monoid</code> at the appropriate places.)</p>



<a name="235656642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656642">(Apr 22 2021 at 11:02)</a>:</h4>
<p>If typeclass inference was able to perform path contraction on the paths it finds that would help a lot</p>



<a name="235656775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656775">(Apr 22 2021 at 11:03)</a>:</h4>
<p>for example, we have a way to register "whenever you find a path <code>A.to_B (B.to_C x)</code> use <code>A.to_C x</code> instead"</p>



<a name="235656839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235656839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235656839">(Apr 22 2021 at 11:04)</a>:</h4>
<p>even if <code>A.to_C</code> is not part of normal typeclass inference</p>



<a name="235657318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235657318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235657318">(Apr 22 2021 at 11:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235650583">said</a>:</p>
<blockquote>
<p>How many lines of output does <code>leanchecker</code> have, roughly?</p>
</blockquote>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>wc -l mathlib_f2984d51615166e96632e8efdfe7875575ad76ec.time
<span class="m">142221</span> mathlib_f2984d51615166e96632e8efdfe7875575ad76ec.time
</code></pre></div>



<a name="235657344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235657344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235657344">(Apr 22 2021 at 11:09)</a>:</h4>
<p><a href="https://gist.github.com/jcommelin/d1f5e95708ce61abb827216fb6463afc">https://gist.github.com/jcommelin/d1f5e95708ce61abb827216fb6463afc</a> &lt;- todays mathlib master</p>



<a name="235657354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235657354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235657354">(Apr 22 2021 at 11:09)</a>:</h4>
<p>Another reason why this particular example is bad is that <code>nat.cast</code> is not a projection, and so it is triggering a different heuristic. Normally when you have something like <code>A.proj (B.to_A (D.to_B x)) = A.proj (C.to_A (D.to_C x))</code> it will do:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">A.proj</span> <span class="o">(</span><span class="n">B.to_A</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">))</span> <span class="bp">=?=</span> <span class="n">A.proj</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">B.proj</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=?=</span> <span class="n">A.proj</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">D.proj</span> <span class="n">x</span> <span class="bp">=?=</span> <span class="n">A.proj</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">D.proj</span> <span class="n">x</span> <span class="bp">=?=</span> <span class="n">C.proj</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span>
<span class="n">D.proj</span> <span class="n">x</span> <span class="bp">=?=</span> <span class="n">D.proj</span> <span class="n">x</span>
</code></pre></div>
<p>However, when it is a defined function instead of a projection, it does this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">A.f</span> <span class="o">(</span><span class="n">B.to_A</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">))</span> <span class="bp">=?=</span> <span class="n">A.f</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">B.to_A</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=?=</span> <span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span>
<span class="n">A.mk</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj1</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj2</span> <span class="bp">...</span> <span class="bp">=?=</span> <span class="n">A.mk</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj1</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj2</span> <span class="bp">...</span>
</code></pre></div>
<p>and those proofs can get huge</p>



<a name="235657494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235657494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235657494">(Apr 22 2021 at 11:10)</a>:</h4>
<p>I'm now starting the run on the <code>pre_7084</code> commit.</p>



<a name="235657547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235657547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235657547">(Apr 22 2021 at 11:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235656326">said</a>:</p>
<blockquote>
<p>The fact that a semiring is a monoid with zero would be registered with an instance, not direct inheritance.</p>
</blockquote>
<p>Is there any difference? For <code>old_structure_cmd</code>, isn't <code>extend</code> just a shorthand for "write this instance for me"?</p>



<a name="235658645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235658645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235658645">(Apr 22 2021 at 11:21)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cat mathlib_f2984d51615166e96632e8efdfe7875575ad76ec.time <span class="p">|</span> grep <span class="s2">"^[^0]"</span> <span class="p">|</span> wc -l
<span class="m">851</span>
</code></pre></div>
<p>There's 851 declarations that take more than 1s on my machine (today's master).</p>



<a name="235659563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659563">(Apr 22 2021 at 11:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235656635">said</a>:</p>
<blockquote>
<p>(I expect this wouldn't help too much for the reasons Mario describes, but if we do it, we would also need to insert <code>add_sub_monoid</code> and <code>div_inv_monoid</code> at the appropriate places.)</p>
</blockquote>
<p>My point is exactly to <em>not</em> insert these at the appropriate places. Then, when Lean has to check that two fields of <code>semiring</code>s are the same (in the bad situation that it doesn't use good heuristics and really wants to unfold everything), then the shortest the path the better.</p>
<p>Of course, one would have instances from <code>semiring</code> to <code>div_inv_monoid</code>, to be able to use theorems on <code>div_inv_monoid</code>s when one has a ring, but it wouldn't be baked into the definition of semirings, to have shorter paths.</p>



<a name="235659692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659692">(Apr 22 2021 at 11:30)</a>:</h4>
<p>Isn't "path shortness" determined by instance priority / ordering?</p>



<a name="235659719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659719">(Apr 22 2021 at 11:30)</a>:</h4>
<p>I don't think it distinguishes between "<code>extends</code> vs <code>instance</code>"</p>



<a name="235659732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659732">(Apr 22 2021 at 11:31)</a>:</h4>
<p>Other than the fact that the <code>extends</code> instances come first</p>



<a name="235659775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659775">(Apr 22 2021 at 11:31)</a>:</h4>
<p>(which I think means they actually have _lower_ priority in the case of a tie?)</p>



<a name="235659912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659912">(Apr 22 2021 at 11:32)</a>:</h4>
<p>I think we might find a way out of this by setting priorities very carefully</p>



<a name="235659957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235659957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235659957">(Apr 22 2021 at 11:33)</a>:</h4>
<p>for example, the more levels of the hierarchy are jumped, the higher the priority</p>



<a name="235660279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235660279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235660279">(Apr 22 2021 at 11:35)</a>:</h4>
<p>We still have the problem of shortcut instances though if we throw in all the composites. It is clear to me that having all pairwise composites is unambiguously the right solution to how to express the terms here so that they are both visually smaller and also less work for lean, but typeclass inference is really stupid about exploring exponentially many paths in the presence of a transitively closed graph of coercions</p>



<a name="235660505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235660505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235660505">(Apr 22 2021 at 11:37)</a>:</h4>
<p>(We can also be smarter about it and get away with n log n composites and still gain most of the benefits, for example with a simple spine like sebastien <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235656326">suggested</a>. But total number of definitions in the environment has never been something we have attempted to optimize for, and I don't think there have been performance issues as a result, so I don't see any reason not to just compute the whole graph.)</p>



<a name="235661247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235661247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235661247">(Apr 22 2021 at 11:44)</a>:</h4>
<p>I made <code>R</code> compute some stats for the run on today's master:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.</span>
<span class="go">  0.00001   0.00002   0.00002   0.02096   0.00002 122.06022</span>
</code></pre></div>



<a name="235661353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235661353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235661353">(Apr 22 2021 at 11:44)</a>:</h4>
<p>sd: 0.510882</p>



<a name="235661614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235661614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235661614">(Apr 22 2021 at 11:46)</a>:</h4>
<p>Another piece of information that should be relatively easy to harvest is the number of proof steps in the theorem, i.e. lines in the export format. By dividing time by lines we can get a better sense for those theorems that have heavy refls in them</p>



<a name="235661757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235661757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235661757">(Apr 22 2021 at 11:47)</a>:</h4>
<p>What are the keys on the data you have Johan? Are they by theorem name?</p>



<a name="235662565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235662565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235662565">(Apr 22 2021 at 11:54)</a>:</h4>
<p>Can you tell us more about the Max? 2 minutes to check one declaration?</p>



<a name="235662627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235662627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235662627">(Apr 22 2021 at 11:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> I'm working on it. It's the first time I'm using <code>R</code> in 10 years...</p>



<a name="235662674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235662674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235662674">(Apr 22 2021 at 11:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235657344">said</a>:</p>
<blockquote>
<p><a href="https://gist.github.com/jcommelin/d1f5e95708ce61abb827216fb6463afc">https://gist.github.com/jcommelin/d1f5e95708ce61abb827216fb6463afc</a> &lt;- todays mathlib master</p>
</blockquote>
<p>Here is the data</p>



<a name="235662700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235662700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235662700">(Apr 22 2021 at 11:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="235662871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235662871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235662871">(Apr 22 2021 at 11:57)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">122</span><span class="bp">.</span><span class="mi">060217</span>    <span class="mi">76322</span> <span class="n">finset.sdiff_eq_self_iff_disjoint</span>
</code></pre></div>



<a name="235663022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235663022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235663022">(Apr 22 2021 at 11:58)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">sdiff_eq_self_iff_disjoint</span> <span class="o">{</span><span class="n">s</span> <span class="n">t</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">\</span> <span class="n">t</span> <span class="bp">=</span> <span class="n">s</span> <span class="bp">↔</span> <span class="n">disjoint</span> <span class="n">s</span> <span class="n">t</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">sdiff_eq_self</span><span class="o">,</span> <span class="n">subset_empty</span><span class="o">,</span> <span class="n">disjoint_iff_inter_eq_empty</span><span class="o">]</span>
</code></pre></div>
<p>not what I would have expected</p>



<a name="235663666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235663666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235663666">(Apr 22 2021 at 12:02)</a>:</h4>
<p>Great, we have a system which takes two minutes to verify something which doesn't need a proof :-)</p>



<a name="235663802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235663802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235663802">(Apr 22 2021 at 12:03)</a>:</h4>
<p>Are we sure the data isn't skewed somehow? This one looks pretty suspicious</p>



<a name="235663913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235663913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235663913">(Apr 22 2021 at 12:04)</a>:</h4>
<p>like maybe it is attributing work done on the previous theorem, or the thread got paged out at the wrong moment</p>



<a name="235664264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664264">(Apr 22 2021 at 12:06)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">76309</span> <span class="n">uniform_continuous₂.uniform_continuous</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000017</span>    <span class="mi">76310</span> <span class="n">Hausdorffification.of</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76311</span> <span class="n">finset.subset.antisymm_iff</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000016</span>    <span class="mi">76312</span> <span class="n">finset.inter_subset_inter</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76313</span> <span class="n">finset.sdiff_inter_self</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76314</span> <span class="n">finset.superset.trans</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000016</span>    <span class="mi">76315</span> <span class="n">sdiff_inf_self_left</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000015</span>    <span class="mi">76316</span> <span class="n">finset.sdiff_inter_self_left</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">76317</span> <span class="n">superset.equations._eqn_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76318</span> <span class="n">sdiff_le_sdiff</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000015</span>    <span class="mi">76319</span> <span class="n">finset.sdiff_subset_sdiff</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000019</span>    <span class="mi">76320</span> <span class="n">finset.sdiff_empty</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76321</span> <span class="n">finset.sdiff_eq_self</span>
<span class="mi">122</span><span class="bp">.</span><span class="mi">060217</span>    <span class="mi">76322</span> <span class="n">finset.sdiff_eq_self_iff_disjoint</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000099</span>    <span class="mi">76323</span> <span class="n">compact_space_Icc.equations._eqn_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000021</span>    <span class="mi">76324</span> <span class="n">equiv.prod_congr_left._proof_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76325</span> <span class="n">equiv.prod_congr_left._proof_2</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000015</span>    <span class="mi">76326</span> <span class="n">equiv.prod_congr_left</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000015</span>    <span class="mi">76327</span> <span class="n">fintype.exists_univ_list</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000020</span>    <span class="mi">76328</span> <span class="n">equiv.perm.prod_extend_right._proof_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76329</span> <span class="n">equiv.perm.prod_extend_right._proof_2</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">76330</span> <span class="n">equiv.perm.prod_extend_right</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000016</span>    <span class="mi">76331</span> <span class="n">equiv.perm.prod_extend_right_apply_ne</span>
</code></pre></div>
<p>I can see that it's not working on just one area, it has <code>finset.basic</code> and <code>equiv.basic</code> in there mixed with <code>compact_space_Icc</code> from <code>topology.algebra.ordered</code></p>



<a name="235664349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664349">(Apr 22 2021 at 12:07)</a>:</h4>
<p>So maybe it is actually multithreaded and the 122 seconds were spent on <code>compact_space_Icc</code> or something else</p>



<a name="235664490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664490">(Apr 22 2021 at 12:08)</a>:</h4>
<p>Or the GC hit</p>



<a name="235664517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664517">(Apr 22 2021 at 12:08)</a>:</h4>
<p>This is C++, is there a GC?</p>



<a name="235664573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664573">(Apr 22 2021 at 12:08)</a>:</h4>
<p>I think exprs are reference counted in lean</p>



<a name="235664596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664596">(Apr 22 2021 at 12:08)</a>:</h4>
<p>It really doesn't look to be multithreaded. But there could be other things happening.</p>



<a name="235664659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664659">(Apr 22 2021 at 12:09)</a>:</h4>
<p>If it's not multithreaded then why the weird order? Is the export file like that?</p>



<a name="235664715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664715">(Apr 22 2021 at 12:09)</a>:</h4>
<p>Ooh, yes, it might be the export file. But I find that file unreadable.</p>



<a name="235664859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664859">(Apr 22 2021 at 12:10)</a>:</h4>
<p>sigh. proof export isn't supposed to be this inscrutable</p>



<a name="235664933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235664933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235664933">(Apr 22 2021 at 12:11)</a>:</h4>
<p>Here is a gist with 50 lines of context around <code>sdiff_eq_self_iff_disjoint</code>:<br>
<a href="https://gist.github.com/5e86ede6ccf08595ef70978385678f00">https://gist.github.com/5e86ede6ccf08595ef70978385678f00</a></p>



<a name="235665474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235665474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235665474">(Apr 22 2021 at 12:15)</a>:</h4>
<p>The bunch of decls that took more than 10s on my machine:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="m">21235</span>   <span class="m">34</span>.55023                                       bounded_continuous_function.mk_of_compact
<span class="m">32831</span>   <span class="m">19</span>.57642                                                     AddCommGroup.large_category
<span class="m">45873</span>   <span class="m">58</span>.12832                                                     X_in_terms_of_W._main._pack
<span class="m">46114</span>   <span class="m">12</span>.56731     category_theory.monoidal.Mon_functor_category_equivalence.functor._proof_41
<span class="m">47135</span>   <span class="m">21</span>.54670                                     euclidean_domain.gcd._main.equations._eqn_1
<span class="m">47328</span>   <span class="m">14</span>.08090                                                      iterated_deriv_within_univ
<span class="m">47517</span>   <span class="m">13</span>.20958                                                  continuous_linear_map.coe_fst<span class="err">'</span>
<span class="m">48630</span>   <span class="m">11</span>.19849                                                             nat.primes.coe_pnat
<span class="m">49481</span>   <span class="m">21</span>.34276                                                          mvpfunctor.inhabited_M
<span class="m">49883</span>   <span class="m">10</span>.11784                                                      cfilter.to_filter._proof_3
<span class="m">50917</span>   <span class="m">10</span>.36216                                     mul_action.injective_of_quotient_stabilizer
<span class="m">51014</span>   <span class="m">15</span>.61487                                   intermediate_field.findim_fixed_field_eq_card
<span class="m">55342</span>   <span class="m">19</span>.34196                                                     path.trans.equations._eqn_1
<span class="m">56753</span>   <span class="m">17</span>.47420                                                      AddCommMon.add_comm_monoid
<span class="m">56968</span>   <span class="m">12</span>.00058                         category_theory.triangulated.triangle_rotation_unit_iso
<span class="m">60132</span>   <span class="m">22</span>.02939     AddCommGroup.category_theory.forget₂.category_theory.creates_limit._proof_2
<span class="m">64847</span>   <span class="m">29</span>.19659                                  <span class="k">function</span>.injective.ordered_comm_ring._proof_24
<span class="m">67914</span>   <span class="m">14</span>.51483                        category_theory.with_terminal.is_iso_of_from_star._aux_2
<span class="m">72856</span>   <span class="m">21</span>.21235                                                                     rat.abs_def
<span class="m">76322</span>  <span class="m">122</span>.06022                                               finset.sdiff_eq_self_iff_disjoint
<span class="m">99483</span>   <span class="m">16</span>.29542                      category_theory.monad.forget_creates_colimits.new_cocone_ι
<span class="m">105394</span>  <span class="m">14</span>.19519                                         order_dual.semilattice_inf_bot._proof_3
<span class="m">106988</span>  <span class="m">36</span>.30792 Module.category_theory.monoidal_category.tensor_unit.comm_ring.equations._eqn_1
<span class="m">108881</span>  <span class="m">11</span>.93040                         category_theory.limits.prod.diag_map_fst_snd_comp_assoc
<span class="m">111950</span>  <span class="m">11</span>.38775   category_theory.limits.has_binary_biproduct.has_colimit_pair.equations._eqn_1
<span class="m">114456</span>  <span class="m">55</span>.18284                                            pos_num.ldiff._main.equations._eqn_3
<span class="m">121654</span>  <span class="m">10</span>.49787                               with_zero.canonically_ordered_add_monoid._proof_9
<span class="m">142182</span>  <span class="m">16</span>.71473            category_theory.functor.left_adjoint_of_equivalence.equations._eqn_1
</code></pre></div>



<a name="235665557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235665557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235665557">(Apr 22 2021 at 12:16)</a>:</h4>
<p>I think the file really is that disorganized</p>



<a name="235665707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235665707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235665707">(Apr 22 2021 at 12:17)</a>:</h4>
<p>The <code>122s</code> is probably a hiccup. Although the server load is currently negligible. But maybe 37 people decide to look up my personal homepage at that exact time...</p>



<a name="235665847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235665847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235665847">(Apr 22 2021 at 12:18)</a>:</h4>
<p>I see two <code>#DEF</code>s in the file around your snippet, one to <code>&lt;something&gt;.of</code> and one to <code>something.antisymm_iff</code>. If I had to guess based on the other file I would say <code>Hausdorffification.of</code> and <code>finset.subset.antisymm_iff</code></p>



<a name="235665870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235665870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235665870">(Apr 22 2021 at 12:18)</a>:</h4>
<p>The data from just before <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a>: <a href="https://gist.github.com/8a34e58f355df8c79349630e4f4dbe8b">https://gist.github.com/8a34e58f355df8c79349630e4f4dbe8b</a></p>



<a name="235665924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235665924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235665924">(Apr 22 2021 at 12:19)</a>:</h4>
<p>which means that two completely unrelated files are just mashed together here, meaning that the single threaded leanchecker is jumping around like a multithreaded checker would</p>



<a name="235666139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666139">(Apr 22 2021 at 12:20)</a>:</h4>
<p>Aha:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="m">19933</span>   <span class="m">33</span>.04352   bounded_continuous_function.metric_space._proof_4
<span class="m">44039</span>   <span class="m">57</span>.23696 measure_theory.simple_func.semilattice_inf._proof_5
<span class="m">65492</span>   <span class="m">13</span>.15512                              nat.of_digits_one_cons
<span class="m">73812</span>  <span class="m">121</span>.33800                    equiv.perm.sign_prod_congr_right
<span class="m">103809</span>  <span class="m">14</span>.16039                            int.lor.equations._eqn_4
<span class="m">111199</span>  <span class="m">53</span>.86009                              is_local_extr_on.inter
<span class="m">138539</span>  <span class="m">15</span>.00112          times_cont_diff_within_at.equations._eqn_1
</code></pre></div>



<a name="235666166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666166">(Apr 22 2021 at 12:20)</a>:</h4>
<p>That looks suspicious. Again a <code>&gt;120s</code> but totally different decl.</p>



<a name="235666189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666189">(Apr 22 2021 at 12:21)</a>:</h4>
<p>So I guess we need to run the export single-threadedly?</p>



<a name="235666234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666234">(Apr 22 2021 at 12:21)</a>:</h4>
<p>However, it also means that the critical heavy refl proof step could be associated to any proof currently in progress, not necessarily the next <code>#DEF</code></p>



<a name="235666273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666273">(Apr 22 2021 at 12:21)</a>:</h4>
<p>That would be one way to fix it</p>



<a name="235666385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666385">(Apr 22 2021 at 12:22)</a>:</h4>
<p>Should I try: <code>lean -j1 --recursive --export=mathlib.txt src/</code>?</p>



<a name="235666613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666613">(Apr 22 2021 at 12:23)</a>:</h4>
<p>Ideally there would be a way to construct this file in a multithreaded way without having five files getting mashed up. But all the IDs are sequential?</p>



<a name="235666813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666813">(Apr 22 2021 at 12:24)</a>:</h4>
<p>It starts like this:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="m">1</span> <span class="c1">#NS 0 u</span>
<span class="m">2</span> <span class="c1">#NS 0 eq</span>
<span class="m">3</span> <span class="c1">#NS 0 α</span>
<span class="m">1</span> <span class="c1">#UP 1</span>
<span class="m">0</span> <span class="c1">#ES 1</span>
<span class="m">4</span> <span class="c1">#NS 0 a</span>
<span class="m">1</span> <span class="c1">#EV 0</span>
<span class="m">5</span> <span class="c1">#NS 0 ᾰ</span>
<span class="m">2</span> <span class="c1">#EV 1</span>
<span class="m">3</span> <span class="c1">#ES 0</span>
<span class="m">4</span> <span class="c1">#EP #BD 5 2 3</span>
<span class="m">5</span> <span class="c1">#EP #BD 4 1 4</span>
<span class="m">6</span> <span class="c1">#EP #BI 3 0 5</span>
<span class="m">6</span> <span class="c1">#NS 2 refl</span>
<span class="m">7</span> <span class="c1">#EC 2 1</span>
<span class="m">8</span> <span class="c1">#EA 7 2</span>
<span class="m">9</span> <span class="c1">#EA 8 1</span>
<span class="m">10</span> <span class="c1">#EA 9 1</span>
<span class="m">11</span> <span class="c1">#EP #BD 4 1 10</span>
<span class="m">12</span> <span class="c1">#EP #BI 3 0 11</span>
<span class="c1">#IND 2 2 6 1 6 12 1</span>
<span class="c1">#QUOT</span>
<span class="m">7</span> <span class="c1">#NS 0 comm_group_with_zero</span>
<span class="m">8</span> <span class="c1">#NS 7 coe_norm_unit</span>
<span class="m">9</span> <span class="c1">#NS 0 decidable_eq</span>
<span class="m">10</span> <span class="c1">#NS 0 decidable_rel</span>
<span class="m">11</span> <span class="c1">#NS 0 not</span>
<span class="m">12</span> <span class="c1">#NS 0 false</span>
<span class="c1">#IND 0 12 3 0</span>
<span class="m">13</span> <span class="c1">#EP #BD 4 3 3</span>
<span class="m">14</span> <span class="c1">#EC 12</span>
<span class="m">15</span> <span class="c1">#EP #BD 5 1 14</span>
<span class="m">16</span> <span class="c1">#EL #BD 4 3 15</span>
<span class="c1">#DEF 11 13 16</span>
<span class="m">13</span> <span class="c1">#NS 0 decidable</span>
<span class="m">14</span> <span class="c1">#NS 0 p</span>
<span class="m">2</span> <span class="c1">#US 0</span>
<span class="m">17</span> <span class="c1">#ES 2</span>
<span class="m">18</span> <span class="c1">#EP #BD 14 3 17</span>
<span class="m">15</span> <span class="c1">#NS 13 is_false</span>
</code></pre></div>



<a name="235666848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666848">(Apr 22 2021 at 12:25)</a>:</h4>
<p>seems reasonable</p>



<a name="235666871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666871">(Apr 22 2021 at 12:25)</a>:</h4>
<p>If you say so</p>



<a name="235666911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235666911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235666911">(Apr 22 2021 at 12:25)</a>:</h4>
<p>it's building <code>eq</code></p>



<a name="235667002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235667002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235667002">(Apr 22 2021 at 12:25)</a>:</h4>
<p>this is init.core</p>



<a name="235667090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235667090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235667090">(Apr 22 2021 at 12:26)</a>:</h4>
<p>I'm now running it with <code>-j1</code>. Let's see if the result will differ significantly.</p>



<a name="235667166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235667166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235667166">(Apr 22 2021 at 12:26)</a>:</h4>
<p>we probably won't see any multithreading effects this early in the file</p>



<a name="235667617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235667617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235667617">(Apr 22 2021 at 12:29)</a>:</h4>
<p>Snap... why am I seeing two processes with <code>-j1</code> in <code>top</code>??</p>



<a name="235667753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235667753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235667753">(Apr 22 2021 at 12:30)</a>:</h4>
<p>One must be a child of the other. They are using exactly the same amount of CPU and RAM. I don't understand linux</p>



<a name="235668165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235668165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235668165">(Apr 22 2021 at 12:32)</a>:</h4>
<p>Use <code>htop</code> :) (and then <code>F5 (Tree)</code>)</p>



<a name="235668214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235668214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235668214">(Apr 22 2021 at 12:33)</a>:</h4>
<p>Then it puts 45 processes with 0.0% CPU at the top of hte list...</p>



<a name="235668362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235668362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235668362">(Apr 22 2021 at 12:34)</a>:</h4>
<p>Aha, I found it, and indeed one is a child of the other.</p>



<a name="235669032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235669032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235669032">(Apr 22 2021 at 12:38)</a>:</h4>
<p>Wooah check out htop! It's like top but upgraded to the 1990s!</p>



<a name="235669821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235669821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235669821">(Apr 22 2021 at 12:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235657354">said</a>:</p>
<blockquote>
<p>Another reason why this particular example is bad is that <code>nat.cast</code> is not a projection, and so it is triggering a different heuristic. Normally when you have something like <code>A.proj (B.to_A (D.to_B x)) = A.proj (C.to_A (D.to_C x))</code> it will do:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">A.proj</span> <span class="o">(</span><span class="n">B.to_A</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">))</span> <span class="bp">=?=</span> <span class="n">A.proj</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">B.proj</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=?=</span> <span class="n">A.proj</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">D.proj</span> <span class="n">x</span> <span class="bp">=?=</span> <span class="n">A.proj</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">D.proj</span> <span class="n">x</span> <span class="bp">=?=</span> <span class="n">C.proj</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span>
<span class="n">D.proj</span> <span class="n">x</span> <span class="bp">=?=</span> <span class="n">D.proj</span> <span class="n">x</span>
</code></pre></div>
<p>However, when it is a defined function instead of a projection, it does this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">A.f</span> <span class="o">(</span><span class="n">B.to_A</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">))</span> <span class="bp">=?=</span> <span class="n">A.f</span> <span class="o">(</span><span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">))</span>
<span class="n">B.to_A</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=?=</span> <span class="n">C.to_A</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span>
<span class="n">A.mk</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj1</span> <span class="o">(</span><span class="n">D.to_B</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj2</span> <span class="bp">...</span> <span class="bp">=?=</span> <span class="n">A.mk</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj1</span> <span class="o">(</span><span class="n">D.to_C</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="n">proj2</span> <span class="bp">...</span>
</code></pre></div>
<p>and those proofs can get huge</p>
</blockquote>
<p>Still, how come main Lean has no problem checking this in milliseconds, while it takes seconds to leanchecker? Are they using different heuristics to check rfl?</p>



<a name="235670371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235670371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235670371">(Apr 22 2021 at 12:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235657547">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235656326">said</a>:</p>
<blockquote>
<p>The fact that a semiring is a monoid with zero would be registered with an instance, not direct inheritance.</p>
</blockquote>
<p>Is there any difference? For <code>old_structure_cmd</code>, isn't <code>extend</code> just a shorthand for "write this instance for me"?</p>
</blockquote>
<p>I don't really understand the inner workings. But what I can say for sure is that, when optimizing for the nsmul and gsmul refactors, I have seen a bunch of proofs where the <code>1</code> in a comm_ring was written as composing all the direct inheritance path through ring, semiring, monoid_with_zero, monoid, has_one. I guess just removing <code>monoid_with_zero</code> from this path would give some gain. I'll try to do some experiments in this direction.</p>



<a name="235670707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235670707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235670707">(Apr 22 2021 at 12:51)</a>:</h4>
<blockquote>
<p>Still, how come main Lean has no problem checking this in milliseconds, while it takes seconds to leanchecker? Are they using different heuristics to check rfl?</p>
</blockquote>
<p>I think so. The elaborator and kernel use separate reducibility hints: <code>@[irreducible]</code> and <code>@[reducible]</code> act on the elaborator, while the kernel uses definition height and <code>opaque</code> and <code>abbrev</code></p>



<a name="235670929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235670929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235670929">(Apr 22 2021 at 12:53)</a>:</h4>
<p>There isn't much front end support for changing the kernel reducibility settings to something other than the default, so it may well be the case that lean knows a bunch of heuristics that we've taught it and the kernel is floundering without those hints</p>



<a name="235672267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235672267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235672267">(Apr 22 2021 at 13:01)</a>:</h4>
<p>export with <code>-j1</code> is running for &gt; 35 minutes now... <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>



<a name="235673731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235673731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235673731">(Apr 22 2021 at 13:10)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>diff mathlib.txt mathlib.txt.bu <span class="p">|</span> wc -l
<span class="m">1638141</span>
</code></pre></div>



<a name="235673916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235673916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235673916">(Apr 22 2021 at 13:11)</a>:</h4>
<p>how many lines are they?</p>



<a name="235674022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674022">(Apr 22 2021 at 13:12)</a>:</h4>
<p>I imagine the diff is going to be "almost everything" because of the intermingling</p>



<a name="235674098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674098">(Apr 22 2021 at 13:13)</a>:</h4>
<p>They are about ~ 20.000.000 lines</p>



<a name="235674123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674123">(Apr 22 2021 at 13:13)</a>:</h4>
<p>both?</p>



<a name="235674147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674147">(Apr 22 2021 at 13:13)</a>:</h4>
<p>1sec</p>



<a name="235674200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674200">(Apr 22 2021 at 13:13)</a>:</h4>
<p>I would guess that they end up at exactly the same number of lines, unless lean nondeterminism is worse than I thought</p>



<a name="235674279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674279">(Apr 22 2021 at 13:14)</a>:</h4>
<div class="codehilite" data-code-language="wc"><pre><span></span><code>  20268388 ../mathlib_post_7084/mathlib.txt     -- -j1
  20268430 ../mathlib_post_7084/mathlib.txt.bu  -- regular
</code></pre></div>



<a name="235674302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674302">(Apr 22 2021 at 13:14)</a>:</h4>
<p>heh</p>



<a name="235674424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674424">(Apr 22 2021 at 13:15)</a>:</h4>
<p>Actually this unsequenced output would cause problems with determinism if we ever wanted to cache those files</p>



<a name="235674516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674516">(Apr 22 2021 at 13:15)</a>:</h4>
<p>because I would bet that even running "regular" twice in a row will result in completely different files</p>



<a name="235674528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674528">(Apr 22 2021 at 13:15)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">0</span><span class="bp">.</span><span class="mi">391000</span>     <span class="mi">3605</span> <span class="n">rat.num_denom_cases_on._main</span>
</code></pre></div>
<p>Is this surprising?</p>



<a name="235674606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674606">(Apr 22 2021 at 13:16)</a>:</h4>
<p>That's an autogenerated theorem?</p>



<a name="235674621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674621">(Apr 22 2021 at 13:16)</a>:</h4>
<p>I should probably check that <code>-j1</code> is deterministic. But first I'm running <code>leanchecker</code></p>



<a name="235674652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674652">(Apr 22 2021 at 13:16)</a>:</h4>
<p>well I guess it contains some user stuff, let me check</p>



<a name="235674716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674716">(Apr 22 2021 at 13:16)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[elab_as_eliminator]</span> <span class="kd">def</span> <span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">num_denom_cases_on</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span>
   <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="n">d</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">d</span> <span class="bp">→</span> <span class="o">(</span><span class="n">int.nat_abs</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">coprime</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">)),</span> <span class="n">C</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">h</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">num_denom'</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h</span> <span class="n">c</span>
</code></pre></div>



<a name="235674746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674746">(Apr 22 2021 at 13:17)</a>:</h4>
<p>why is it always the 1 line definitions</p>



<a name="235674873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674873">(Apr 22 2021 at 13:18)</a>:</h4>
<p>no this one should be fast</p>



<a name="235674921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674921">(Apr 22 2021 at 13:18)</a>:</h4>
<p>there are no hard unification problems here</p>



<a name="235674976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235674976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235674976">(Apr 22 2021 at 13:18)</a>:</h4>
<p>So maybe there is still something that creates noise?</p>



<a name="235675029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235675029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235675029">(Apr 22 2021 at 13:19)</a>:</h4>
<p>what's around it in the list</p>



<a name="235675275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235675275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235675275">(Apr 22 2021 at 13:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235670707">said</a>:</p>
<blockquote>
<blockquote>
<p>Still, how come main Lean has no problem checking this in milliseconds, while it takes seconds to leanchecker? Are they using different heuristics to check rfl?</p>
</blockquote>
<p>I think so. The elaborator and kernel use separate reducibility hints: <code>@[irreducible]</code> and <code>@[reducible]</code> act on the elaborator, while the kernel uses definition height and <code>opaque</code> and <code>abbrev</code></p>
</blockquote>
<p>I thought that the kernel was always checking the proof of a lemma once it was done, even in interactive mode, so this would mean the elaborator is feeding to the kernel a proof that is easy enough to check. Do you mean that, in main Lean, it checks some decorated proof with additional hints that are not stored in the olean and therefore not available to leanchecker? Or just that leanchecker does not use these hints? (Or am I wrong to believe that the kernel checks every proof even in interactive mode?)</p>



<a name="235675606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235675606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235675606">(Apr 22 2021 at 13:22)</a>:</h4>
<blockquote>
<p>I thought that the kernel was always checking the proof of a lemma once it was done, even in interactive mode, so this would mean the elaborator is feeding to the kernel a proof that is easy enough to check.</p>
</blockquote>
<p>Yes, it is done, but proofs are not provided for defeq tasks, so a proof using a heavy refl is hard for the elaborator and hard for the kernel, and even after it is diced and pickled and given to the external checker it's still hard</p>



<a name="235675754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235675754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235675754">(Apr 22 2021 at 13:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235675029">said</a>:</p>
<blockquote>
<p>what's around it in the list</p>
</blockquote>
<p>I can only see this when it's done. The current script saves everything to a file, but prints all intermediate rows that contain <code>000</code>.</p>



<a name="235675833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235675833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235675833">(Apr 22 2021 at 13:23)</a>:</h4>
<blockquote>
<p>Do you mean that, in main Lean, it checks some decorated proof with additional hints that are not stored in the olean and therefore not available to leanchecker? Or just that leanchecker does not use these hints? </p>
</blockquote>
<p>Reducibility hints (like <code>@[irreducible]</code>) are definitely in the olean (pretty much everything has to be in the olean because this is the only way data from one lean file gets to another), but they may not be in the export file</p>



<a name="235676061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676061">(Apr 22 2021 at 13:24)</a>:</h4>
<p>Looking at <a href="https://github.com/leanprover-community/lean/blob/master/doc/export_format.md">https://github.com/leanprover-community/lean/blob/master/doc/export_format.md</a> I don't see anything that suggests that it is possible to apply any attributes to anything</p>



<a name="235676342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676342">(Apr 22 2021 at 13:26)</a>:</h4>
<p>this export format is super bare-bones, it needs some love</p>



<a name="235676669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676669">(Apr 22 2021 at 13:28)</a>:</h4>
<p>Here is something I don't understand. Random part of the intermediate output:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="m">0</span>.000018    <span class="m">34000</span> set.Iic.lattice._proof_6
<span class="m">0</span>.000014    <span class="m">35000</span> associates.bounded_lattice._proof_5
<span class="m">0</span>.000018    <span class="m">36000</span> computability.encoding
<span class="m">0</span>.000016    <span class="m">37000</span> padic_norm_e.add_eq_max_of_ne<span class="err">'</span>
<span class="m">0</span>.000015    <span class="m">38000</span> CommGroup.comm_group.to_group.category_theory.bundled_hom.parent_projection
<span class="m">0</span>.000014    <span class="m">39000</span> equiv.d_array_equiv_fin._match_1
<span class="m">0</span>.000018    <span class="m">40000</span> tactic.abel.normalize_mode
<span class="m">0</span>.000015    <span class="m">41000</span> fintype.fintype_prod_right
</code></pre></div>



<a name="235676762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676762">(Apr 22 2021 at 13:28)</a>:</h4>
<p>This suggests that it should zip through 1000 decls in about <code>0.015</code> seconds. But in practice it takes much longer.</p>



<a name="235676766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676766">(Apr 22 2021 at 13:28)</a>:</h4>
<p>that still looks pretty random</p>



<a name="235676863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676863">(Apr 22 2021 at 13:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> There's 999 unprinted decls between every 2 rows.</p>



<a name="235676948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235676948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235676948">(Apr 22 2021 at 13:30)</a>:</h4>
<p>There is some deviation in the samples, right? You go through fast definitions a lot faster than slow definitions, so if you pick a random definition it's probably fast</p>



<a name="235677083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235677083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235677083">(Apr 22 2021 at 13:30)</a>:</h4>
<p>I see. So my sample size is just way too small.</p>



<a name="235677180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235677180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235677180">(Apr 22 2021 at 13:31)</a>:</h4>
<p>well it's more like there is a consistent bias with this sampling method, since you aren't sampling by time</p>



<a name="235677464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235677464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235677464">(Apr 22 2021 at 13:32)</a>:</h4>
<p>I'm picking the 145 rows whose row number ends in "000". The chance that one of those is slow is apparently quite low.</p>



<a name="235677666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235677666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235677666">(Apr 22 2021 at 13:33)</a>:</h4>
<p>if you were to print the definition that lean is working on once a second, you would get much more slow definitions</p>



<a name="235677873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235677873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235677873">(Apr 22 2021 at 13:34)</a>:</h4>
<p>Aha, so I should pipe <code>tee</code> to <code>watch</code> instead of to <code>grep "000 "</code></p>



<a name="235679550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235679550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235679550">(Apr 22 2021 at 13:45)</a>:</h4>
<p>Bingo, a slow proof with index 0 mod 1000:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">2</span><span class="bp">.</span><span class="mi">419336</span>    <span class="mi">80000</span> <span class="n">preorder_hom.complete_lattice._proof_8</span>
</code></pre></div>



<a name="235680848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235680848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235680848">(Apr 22 2021 at 13:52)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/preorder_hom.complete_lattice/src">src#preorder_hom.complete_lattice</a></p>



<a name="235680991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235680991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235680991">(Apr 22 2021 at 13:53)</a>:</h4>
<p>Now which one is <code>_proof_8</code>?</p>



<a name="235681029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235681029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235681029">(Apr 22 2021 at 13:53)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">preorder_hom.complete_lattice._proof_8</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">complete_lattice</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→ₘ</span> <span class="n">β</span><span class="o">),</span>
  <span class="n">a</span> <span class="bp">⊓</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">complete_lattice</span> <span class="n">β</span><span class="o">],</span> <span class="n">lattice.inf_le_left</span>
</code></pre></div>



<a name="235681137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235681137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235681137">(Apr 22 2021 at 13:54)</a>:</h4>
<p>I guess this is coming from <code>.. (_ : lattice (α →ₘ β))</code></p>



<a name="235681184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235681184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235681184">(Apr 22 2021 at 13:54)</a>:</h4>
<p>Ouch, I just noticed in <code>htop</code> that <code>leanchecker</code> is still hopping between different threads. Even though there is only one thread active at a given time. Not sure if that is an issue.</p>



<a name="235681340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235681340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235681340">(Apr 22 2021 at 13:55)</a>:</h4>
<p>you mean different cores? I think the OS will normally do that</p>



<a name="235683106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235683106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235683106">(Apr 22 2021 at 14:03)</a>:</h4>
<p><code>leanchecker</code> finished on <code>post_7084</code> in about 50 minutes. <a href="https://gist.github.com/c54d4dda4b22db228c3e91ce5d9ae804">https://gist.github.com/c54d4dda4b22db228c3e91ce5d9ae804</a></p>



<a name="235683358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235683358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235683358">(Apr 22 2021 at 14:04)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>&gt; summary<span class="o">(</span>x<span class="o">[</span>,1<span class="o">])</span><span class="p">;</span>
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
  <span class="m">0</span>.00001   <span class="m">0</span>.00002   <span class="m">0</span>.00002   <span class="m">0</span>.02079   <span class="m">0</span>.00002 <span class="m">121</span>.66725
&gt; sd<span class="o">(</span>x<span class="o">[</span>,1<span class="o">])</span><span class="p">;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">0</span>.5177284
</code></pre></div>



<a name="235683405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235683405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235683405">(Apr 22 2021 at 14:05)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="m">20611</span>   <span class="m">34</span>.59937                             bounded_continuous_function.metric_space._proof_8
<span class="m">32460</span>   <span class="m">14</span>.75494                                    SemiRing.has_forget_to_AddCommMon._proof_1
<span class="m">32550</span>   <span class="m">15</span>.53428           Ring.category_theory.forget₂.category_theory.creates_limit._proof_3
<span class="m">45565</span>   <span class="m">57</span>.96984                                    Module.forget₂_AddCommGroup_is_equivalence
<span class="m">45868</span>   <span class="m">10</span>.62882 category_theory.monoidal.Mon_functor_category_equivalence.inverse_map_hom_app
<span class="m">46825</span>   <span class="m">21</span>.59894                                      additive.add_left_cancel_monoid._proof_4
<span class="m">47124</span>   <span class="m">13</span>.88599                                               times_cont_diff_bump.support_eq
<span class="m">47211</span>   <span class="m">14</span>.46456                             local_homeomorph.mdifferentiable.mfderiv._proof_3
<span class="m">48034</span>   <span class="m">11</span>.88654                                                          polynomial.roots_one
<span class="m">48975</span>   <span class="m">20</span>.88203      CommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7
<span class="m">49289</span>   <span class="m">10</span>.00095                                            rbtree.fold._main.equations._eqn_1
<span class="m">50327</span>   <span class="m">11</span>.78787                                                     polynomial.smul_eval_smul
<span class="m">50424</span>   <span class="m">14</span>.23475                                    intermediate_field.to_subalgebra_injective
<span class="m">54832</span>   <span class="m">18</span>.30227                                                             hash_map.cases_on
<span class="m">56143</span>   <span class="m">18</span>.56595                                                     subring.to_submonoid_mono
<span class="m">56455</span>   <span class="m">17</span>.70191                                                        quotient_group.coe_inv
<span class="m">59635</span>   <span class="m">23</span>.99585                                                           AddGroup.limit_cone
<span class="m">63901</span>   <span class="m">11</span>.02492                                                       order.ideal.top_carrier
<span class="m">64361</span>   <span class="m">22</span>.64404                          <span class="k">function</span>.injective.linear_ordered_comm_ring._proof_5
<span class="m">67257</span>   <span class="m">16</span>.05250                          inner_product_space.of_core.to_normed_space._proof_1
<span class="m">72118</span>   <span class="m">20</span>.85422                                        category_theory.limits.is_colimit.of_π
<span class="m">75663</span>  <span class="m">121</span>.66725                                                           sdiff_inf_self_left
<span class="m">98402</span>   <span class="m">20</span>.69904                                                        power_series.coeff_map
<span class="m">104327</span>  <span class="m">14</span>.18050                                       order_dual.semilattice_inf_bot._proof_4
<span class="m">105831</span>  <span class="m">48</span>.03556                                       hyperreal.infinite_pos_mul_infinite_neg
<span class="m">107723</span>  <span class="m">12</span>.05554                                                pi_tensor_product.lift.unique<span class="s1">'</span>
<span class="s1">110800  11.50262                      add_equiv.add_equiv_of_unique_of_unique.equations._eqn_1</span>
<span class="s1">113312  54.91094              formal_multilinear_series.comp_partial_sum_target_tendsto_at_top</span>
<span class="s1">120427  10.48020       has_finite_inter.finite_inter_closure_has_finite_inter.equations._eqn_1</span>
<span class="s1">140717  16.62972                                            ordnode.find_max'</span>.equations._eqn_1
</code></pre></div>



<a name="235683494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235683494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235683494">(Apr 22 2021 at 14:05)</a>:</h4>
<p>What's the best thing to try next?</p>



<a name="235683531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235683531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235683531">(Apr 22 2021 at 14:05)</a>:</h4>
<p>Shall I run the <code>-j1</code> export again? To see if it is deterministic?</p>



<a name="235685126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235685126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235685126">(Apr 22 2021 at 14:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">sdiff_inf_self_left</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">\</span> <span class="o">(</span><span class="n">y</span> <span class="bp">⊓</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">\</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">inf_comm</span><span class="o">,</span> <span class="n">sdiff_inf_self_right</span><span class="o">]</span>
</code></pre></div>
<p>what is it with one line functions, that's the fifth one line bad guy</p>



<a name="235685248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235685248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235685248">(Apr 22 2021 at 14:14)</a>:</h4>
<p>What's the vicinity of <code>sdiff_inf_self_left</code>? That should tell us if it is respecting file divisions</p>



<a name="235685388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235685388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235685388">(Apr 22 2021 at 14:15)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">75656</span> <span class="n">is_associative.drec_on</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000017</span>    <span class="mi">75657</span> <span class="n">uniform_continuous₂.uniform_continuous</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000017</span>    <span class="mi">75658</span> <span class="n">Hausdorffification.of</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000016</span>    <span class="mi">75659</span> <span class="n">finset.subset.antisymm_iff</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000017</span>    <span class="mi">75660</span> <span class="n">finset.inter_subset_inter</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000017</span>    <span class="mi">75661</span> <span class="n">finset.sdiff_inter_self</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000016</span>    <span class="mi">75662</span> <span class="n">finset.superset.trans</span>
<span class="mi">121</span><span class="bp">.</span><span class="mi">667253</span>    <span class="mi">75663</span> <span class="n">sdiff_inf_self_left</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000101</span>    <span class="mi">75664</span> <span class="n">finset.sdiff_inter_self_left</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000024</span>    <span class="mi">75665</span> <span class="n">superset.equations._eqn_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000015</span>    <span class="mi">75666</span> <span class="n">sdiff_le_sdiff</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">75667</span> <span class="n">finset.sdiff_subset_sdiff</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">75668</span> <span class="n">finset.sdiff_empty</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">75669</span> <span class="n">finset.sdiff_eq_self</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">75670</span> <span class="n">finset.sdiff_eq_self_iff_disjoint</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">75671</span> <span class="n">compact_space_Icc.equations._eqn_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000014</span>    <span class="mi">75672</span> <span class="n">equiv.prod_congr_left._proof_1</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000020</span>    <span class="mi">75673</span> <span class="n">equiv.prod_congr_left._proof_2</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000018</span>    <span class="mi">75674</span> <span class="n">equiv.prod_congr_left</span>
<span class="mi">0</span><span class="bp">.</span><span class="mi">000016</span>    <span class="mi">75675</span> <span class="n">fintype.exists_univ_list</span>
</code></pre></div>
<p>Oh hey I remember this place</p>



<a name="235685533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235685533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235685533">(Apr 22 2021 at 14:16)</a>:</h4>
<p>You can see <code>sdiff_eq_self_iff_disjoint</code>, the previous bad guy, is only 6 definitions later</p>



<a name="235685612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235685612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235685612">(Apr 22 2021 at 14:17)</a>:</h4>
<p>so clearly the culprit is somewhere around here and these one liners are taking the blame</p>



<a name="235685651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235685651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235685651">(Apr 22 2021 at 14:17)</a>:</h4>
<p>but the files are still mixed up :(</p>



<a name="235686635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235686635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235686635">(Apr 22 2021 at 14:22)</a>:</h4>
<p>So in one run <code>finset.sdiff_eq_self_iff_disjoint</code> took 2 minutes, and in another run it was <code>sdiff_inf_self_left</code>?</p>



<a name="235686799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235686799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235686799">(Apr 22 2021 at 14:23)</a>:</h4>
<p>Now we need <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> to come along and say something like "this is because there is an <code>@</code> character at position 66 on line 132 in an unrelated Lean file" or something.</p>



<a name="235687163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235687163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235687163">(Apr 22 2021 at 14:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235686635">said</a>:</p>
<blockquote>
<p>So in one run <code>finset.sdiff_eq_self_iff_disjoint</code> took 2 minutes, and in another run it was <code>sdiff_inf_self_left</code>?</p>
</blockquote>
<p>That might have been because of multithreading in the previous runs.</p>



<a name="235687190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235687190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235687190">(Apr 22 2021 at 14:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235685651">said</a>:</p>
<blockquote>
<p>but the files are still mixed up :(</p>
</blockquote>
<p>I have no idea how to fix this.</p>



<a name="235690754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235690754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235690754">(Apr 22 2021 at 14:46)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>diff mathlib.txt mathlib.txt.1 <span class="p">|</span> wc -l
<span class="m">0</span>
</code></pre></div>



<a name="235690781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235690781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235690781">(Apr 22 2021 at 14:46)</a>:</h4>
<p>So it seems like with <code>-j1</code> the results are deterministic.</p>



<a name="235690895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235690895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235690895">(Apr 22 2021 at 14:47)</a>:</h4>
<p>Now I'm regenerating the <code>pre_7084</code> using <code>-j1</code>.</p>



<a name="235693242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235693242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235693242">(Apr 22 2021 at 15:00)</a>:</h4>
<p>So there is a difference between running the export without <code>-j</code> or with <code>-j</code>. But the parameter to <code>-j</code> doesn't matter. <span aria-label="oops" class="emoji emoji-1f643" role="img" title="oops">:oops:</span> <br>
Because I ran the export script on <code>pre_7084</code> with <code>-j14</code> before. And now I ran it with <code>-j1</code>. But the diff is 0 on the two outputs.</p>



<a name="235693637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235693637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235693637">(Apr 22 2021 at 15:02)</a>:</h4>
<p>In particular, here are the stats for <code>pre_7084</code>:<br>
<a href="https://gist.github.com/779d29ce1724ce82ed8588caf5a0490d">https://gist.github.com/779d29ce1724ce82ed8588caf5a0490d</a></p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>&gt; summary<span class="o">(</span>x<span class="o">[</span>,1<span class="o">])</span><span class="p">;</span>
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
  <span class="m">0</span>.00001   <span class="m">0</span>.00002   <span class="m">0</span>.00002   <span class="m">0</span>.01072   <span class="m">0</span>.00002 <span class="m">121</span>.33800
&gt; sd<span class="o">(</span>x<span class="o">[</span>,1<span class="o">])</span><span class="p">;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">0</span>.4194959
&gt;
&gt; y &lt;- subset<span class="o">(</span>x, t &gt; <span class="m">10</span>.0<span class="o">)</span><span class="p">;</span>
&gt; print<span class="o">(</span>nrow<span class="o">(</span>y<span class="o">))</span><span class="p">;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">7</span>
&gt; print<span class="o">(</span>y<span class="o">[</span>,c<span class="o">(</span><span class="s2">"t"</span>, <span class="s2">"d"</span><span class="o">)])</span><span class="p">;</span>
               t                                                   d
<span class="m">19933</span>   <span class="m">33</span>.04352   bounded_continuous_function.metric_space._proof_4
<span class="m">44039</span>   <span class="m">57</span>.23696 measure_theory.simple_func.semilattice_inf._proof_5
<span class="m">65492</span>   <span class="m">13</span>.15512                              nat.of_digits_one_cons
<span class="m">73812</span>  <span class="m">121</span>.33800                    equiv.perm.sign_prod_congr_right
<span class="m">103809</span>  <span class="m">14</span>.16039                            int.lor.equations._eqn_4
<span class="m">111199</span>  <span class="m">53</span>.86009                              is_local_extr_on.inter
<span class="m">138539</span>  <span class="m">15</span>.00112          times_cont_diff_within_at.equations._eqn_1
</code></pre></div>



<a name="235693926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235693926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235693926">(Apr 22 2021 at 15:02)</a>:</h4>
<p>And as a reminder, the summary stats for <code>post_7084</code>:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>&gt; summary<span class="o">(</span>x<span class="o">[</span>,1<span class="o">])</span><span class="p">;</span>
     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.
  <span class="m">0</span>.00001   <span class="m">0</span>.00002   <span class="m">0</span>.00002   <span class="m">0</span>.02079   <span class="m">0</span>.00002 <span class="m">121</span>.66725
&gt; sd<span class="o">(</span>x<span class="o">[</span>,1<span class="o">])</span><span class="p">;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">0</span>.5177284
</code></pre></div>



<a name="235694080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235694080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235694080">(Apr 22 2021 at 15:03)</a>:</h4>
<p>What's weird: the <code>121s</code> is on a totally different decl.</p>



<a name="235694199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235694199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235694199">(Apr 22 2021 at 15:03)</a>:</h4>
<p>The mean time almost doubled, but the box-plot doesn't change.</p>



<a name="235694460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235694460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235694460">(Apr 22 2021 at 15:04)</a>:</h4>
<p>So the fast 75% remains the same. But the slow 25% just got way slower, basically.</p>



<a name="235695059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235695059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235695059">(Apr 22 2021 at 15:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235694080">said</a>:</p>
<blockquote>
<p>What's weird: the <code>121s</code> is on a totally different decl.</p>
</blockquote>
<p>I'm not sure what to do with this. It seems that I'm not generating reliable data.</p>



<a name="235695601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235695601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235695601">(Apr 22 2021 at 15:09)</a>:</h4>
<p>Standard deviation bumped from <code>0.41</code> to <code>0.51</code>.</p>



<a name="235695679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235695679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235695679">(Apr 22 2021 at 15:09)</a>:</h4>
<p>Can you plot some histograms?</p>



<a name="235695837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235695837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235695837">(Apr 22 2021 at 15:10)</a>:</h4>
<p>I'm really bad a working with such datasets. No idea how to do that.</p>



<a name="235695922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235695922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235695922">(Apr 22 2021 at 15:11)</a>:</h4>
<p>Here's the data<br>
pre: <a href="https://gist.github.com/779d29ce1724ce82ed8588caf5a0490d">https://gist.github.com/779d29ce1724ce82ed8588caf5a0490d</a><br>
post: <a href="https://gist.github.com/c54d4dda4b22db228c3e91ce5d9ae804">https://gist.github.com/c54d4dda4b22db228c3e91ce5d9ae804</a></p>



<a name="235697369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235697369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rémy Degenne <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235697369">(Apr 22 2021 at 15:19)</a>:</h4>
<p>It's not only the 120s getting allocated to different lemmas. The 30s ones change as well. For example, in the "pre" gist, bounded_continuous_function.metric_space._proof_4 is 33s and the other _proof_i are fast; in the "post" gist, bounded_continuous_function.metric_space._proof_8 is 34s and the other are fast.</p>



<a name="235698671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235698671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235698671">(Apr 22 2021 at 15:29)</a>:</h4>
<p>No idea how to fix that.</p>



<a name="235698675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235698675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rémy Degenne <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235698675">(Apr 22 2021 at 15:29)</a>:</h4>
<p>and I looked at a few declarations with 0.1xxx seconds in one gist: the 15 or so examples I looked at are fast in the other file, and I don't see a slower declaration around the same line. This works both ways (slow in pre is fast in post, and reversely).</p>



<a name="235700105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235700105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235700105">(Apr 22 2021 at 15:38)</a>:</h4>
<p>Since I'm seeing a lot of <code>sdiff</code> above, it makes me wonder if I screwed something up badly in <a href="https://github.com/leanprover-community/mathlib/issues/6775">#6775</a>, which added an intermediate "generalized Boolean algebra" class.</p>



<a name="235700971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235700971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235700971">(Apr 22 2021 at 15:44)</a>:</h4>
<p><a href="user_uploads/3121/pci--ANT3MfKYAo50A1VWNiC/histograms.png">histograms.png</a></p>
<div class="message_inline_image"><a href="user_uploads/3121/pci--ANT3MfKYAo50A1VWNiC/histograms.png" title="histograms.png"><img src="user_uploads/3121/pci--ANT3MfKYAo50A1VWNiC/histograms.png"></a></div>



<a name="235701548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235701548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235701548">(Apr 22 2021 at 15:48)</a>:</h4>
<p>Here's a histogram of pre (yellow) and post (blue). The vast majority are in the first plot, which has all the 0.0001 second definitions. Those are cut out in the second plot, where the bulk are around 0.5-4 seconds, and the shift in the mean is visible. Excluding those and switching to a log scale is the third plot, and there are a lot more blue ones falling in this class as well</p>



<a name="235702166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235702166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235702166">(Apr 22 2021 at 15:52)</a>:</h4>
<p>Dammit, you beat me to it</p>



<a name="235702661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235702661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235702661">(Apr 22 2021 at 15:56)</a>:</h4>
<p>This doesn't cover the order in the file though. Maybe it's possible to find a pattern by looking at how the peaks shift around</p>



<a name="235702734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235702734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235702734">(Apr 22 2021 at 15:56)</a>:</h4>
<p>but really, lean needs to be fixed so that it isn't producing such a crappy data set</p>



<a name="235703028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235703028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235703028">(Apr 22 2021 at 15:59)</a>:</h4>
<p>A similar graph with everything on a log plot<br>
<a href="/user_uploads/3121/ypGgFppV6fDzfx2ApwYLzEfS/histograms.png">histograms.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/ypGgFppV6fDzfx2ApwYLzEfS/histograms.png" title="histograms.png"><img src="/user_uploads/3121/ypGgFppV6fDzfx2ApwYLzEfS/histograms.png"></a></div>



<a name="235703787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235703787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rémy Degenne <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235703787">(Apr 22 2021 at 16:04)</a>:</h4>
<p>Funny how there is a clearly separated mode for slow declarations. It looks like the plot one would expect if there was only one main cause for slowness, and the declaration is slow iff it involves that cause.</p>



<a name="235704419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235704419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235704419">(Apr 22 2021 at 16:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235702734">said</a>:</p>
<blockquote>
<p>but really, lean needs to be fixed so that it isn't producing such a crappy data set</p>
</blockquote>
<p>hmmz... do we have any idea where to start looking for such a fix? To me that sounds like needle in a 230k line C++ haystack.</p>



<a name="235704429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235704429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235704429">(Apr 22 2021 at 16:08)</a>:</h4>
<p>Here's one showing how the sequential time breaks down:<br>
<a href="/user_uploads/3121/acCnRZsE0weyelEeZxAuhkcb/duration.png">duration.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/acCnRZsE0weyelEeZxAuhkcb/duration.png" title="duration.png"><img src="/user_uploads/3121/acCnRZsE0weyelEeZxAuhkcb/duration.png"></a></div><p>No obvious pattern suggesting the system is running some task messing with our timing</p>



<a name="235704733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235704733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235704733">(Apr 22 2021 at 16:10)</a>:</h4>
<p>Just for completeness: export files were generated using <code>lean -j1 --recursive --export=mathlib.txt src/</code><br>
These were then fed to <code>leanchecker</code> using</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>leanchecker +leanprover-community/lean:3.29.0 -v mathlib.txt <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="se">\</span>
  <span class="p">|</span> nl -w8 -s<span class="s1">' '</span> <span class="se">\</span>
  <span class="p">|</span> ts -i -m %.s <span class="se">\</span>
  <span class="p">|</span> tee mathlib.time <span class="se">\</span>
  <span class="p">|</span> grep <span class="s2">"000 "</span>
</code></pre></div>



<a name="235706060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235706060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235706060">(Apr 22 2021 at 16:19)</a>:</h4>
<p>It's possible to export just up to a given file, right?</p>



<a name="235706102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235706102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235706102">(Apr 22 2021 at 16:19)</a>:</h4>
<p>Perhaps we should try exporting a file that contains a 60s / 120s lemma, and see if it persists</p>



<a name="235706238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235706238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235706238">(Apr 22 2021 at 16:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="350992">Rémy Degenne</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235703787">said</a>:</p>
<blockquote>
<p>Funny how there is a clearly separated mode for slow declarations. It looks like the plot one would expect if there was only one main cause for slowness, and the declaration is slow iff it involves that cause.</p>
</blockquote>
<p>My bet is that this cause is unpacking an algebraic structure</p>



<a name="235706447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235706447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235706447">(Apr 22 2021 at 16:21)</a>:</h4>
<p>well every export file will contain init.core and a whole bunch of prelude files no matter what</p>



<a name="235706546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235706546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235706546">(Apr 22 2021 at 16:22)</a>:</h4>
<p>unless you find a way to make an interesting lemma from scratch using <code>prelude</code></p>



<a name="235728520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235728520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235728520">(Apr 22 2021 at 18:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> do you have any clue what's going with <code>leanchecker</code> here?</p>



<a name="235735508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235735508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235735508">(Apr 22 2021 at 19:35)</a>:</h4>
<p>Is it useful/doable to do this?</p>
<p>Take all instances, the dependency graph between them, assign each of them a number so that an instance of number n only depends on instances on number &lt; n (the maximal definition depth should do it, unless we also want this number to be unique to serve as an identifier), compute the transitive closure of this graph, save it in a file. Then, every time Lean need to come up with an instance <code>I</code> given that it has instances <code>I_1, ..., I_n</code> at its disposal, it fetches the number of each of <code>I, I_1, ..., I_n</code>(say <code>d, d_1, ..., d_n</code>and for each <code>I_i</code> checks whether one of the instances whose number  is <code>n</code> is actually the one we want. If we decide upon unique identifiers (in which case we could simply take it to be the order in which the compiler processes the instances), then the check is even simpler, you just have to look up one value.</p>
<p>Thus, Lean avoids getting in a rabbit hole by following the route of a too weak instance. But maybe Lean sometimes automatically generates high instances from lower ones? In that case, my idea doesn't quite work, unless we also ask first for Lean to come up with all instances it can, and slide down the dependencies from them.</p>



<a name="235740573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235740573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235740573">(Apr 22 2021 at 20:11)</a>:</h4>
<p>What I know is that the algorithm for typeclass search is <em>completely</em> overhauled in Lean 4, and it's now performing much better and solves a lot of issues that were present in Lean 3.</p>



<a name="235740680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235740680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235740680">(Apr 22 2021 at 20:12)</a>:</h4>
<p>I don't think it makes much sense to do a complete overhaul of the Lean 3 algorithm. It's better to see if we can just speed up <code>leanchecker</code> somehow, and focus the rest of our energy on mathport.</p>



<a name="235741296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235741296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235741296">(Apr 22 2021 at 20:18)</a>:</h4>
<p>My preference would be to disable leanchecker for now because of its shortcomings, but I understand Mario is strongly against this. This means we shouldn't merge <a href="https://github.com/leanprover-community/mathlib/issues/7255">#7255</a>, though, because it again adds 30 minutes to the leanchecker time, and then most bors builds wouldn't finish.</p>



<a name="235741436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235741436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235741436">(Apr 22 2021 at 20:19)</a>:</h4>
<p>It'd be OK if the mathlib build times were &lt;4h as they were before, but it seems that they also increased by about half an hour recently.</p>



<a name="235741655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235741655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235741655">(Apr 22 2021 at 20:21)</a>:</h4>
<p>When PRs only touch leaves of the hierarchy, everything is fine, but we have a lot of PRs touching basic files (at least one in each batch, say), so most of the time things are rebuilt from scratch.</p>



<a name="235742983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235742983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235742983">(Apr 22 2021 at 20:31)</a>:</h4>
<p>Can we switch to one of the lean-checker alternatives?</p>



<a name="235742997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235742997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235742997">(Apr 22 2021 at 20:31)</a>:</h4>
<p>Are they faster?</p>



<a name="235747837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235747837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235747837">(Apr 22 2021 at 21:04)</a>:</h4>
<p>Does Leanchecker consume the olean files? Could we feed it these as they are generated and so parallelise it with the build?</p>



<a name="235749163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235749163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235749163">(Apr 22 2021 at 21:11)</a>:</h4>
<p>No, <code>leanchecker</code> works off a text file which is generated by <code>lean --export</code>.</p>



<a name="235758778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235758778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235758778">(Apr 22 2021 at 22:34)</a>:</h4>
<p><code>Hausdorffification.of</code> certainly sounds suspicious to me. :-) Anything if <code>ification</code> in the name is surely doing some <code>rfl</code>.</p>



<a name="235792710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235792710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235792710">(Apr 23 2021 at 06:23)</a>:</h4>
<p>I think there are several things that we should think about:</p>
<ol>
<li>Can we make lean + leanchecker generate accurate timing data? There is good reason to believe that the timing data that I generated yesterday is crappy.</li>
<li>Are there ways in which we can speed up lean and/or leanchecker without changing mathlib's .lean files?</li>
<li>Are there ways in which we can speed up by rewriting some proofs in mathlib?</li>
<li>Are there faster alternatives to leanchecker?</li>
<li>How bad would it be to disable leanchecker until we have fixed (1)-(3)?</li>
</ol>



<a name="235796767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235796767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235796767">(Apr 23 2021 at 07:06)</a>:</h4>
<p>Re: 4) I've been trying to run <a href="https://github.com/gebner/trepplein"><code>trepplein</code></a>, running <code>./target/universal/stage/bin/trepplein -s ../mathlib/mathlib.txt </code>, so far to no avail. It starts up, rapidly consumes 8gb of ram, and then sits there silently producing no output.  (My amateur diagnosis is that mathlib is too big for it... :-)</p>
<p>Unfortunately <code>trepplein</code> doesn't seem to have a mode in which is just prints the names of the declarations as it processes them: you can either print the whole type signature (way too verbose!) or nothing.</p>



<a name="235798355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235798355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235798355">(Apr 23 2021 at 07:19)</a>:</h4>
<p>I'm running <code>[tc](https://github.com/dselsam/tc)</code> now.</p>



<a name="235798590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235798590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235798590">(Apr 23 2021 at 07:21)</a>:</h4>
<p>What about disabling <code>leanchecker</code> on the PRs, but running it once a day and letting it create an issue if it sees a problem? Like the action we have every day on LFTCM2020 trying to merge mathlib master.</p>



<a name="235798922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235798922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235798922">(Apr 23 2021 at 07:25)</a>:</h4>
<p>I think that is similar to my <code>premaster</code> proposal. And I think it could be a good intermediate solution.</p>



<a name="235801947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235801947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235801947">(Apr 23 2021 at 07:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235741655">said</a>:</p>
<blockquote>
<p>When PRs only touch leaves of the hierarchy, everything is fine, but we have a lot of PRs touching basic files (at least one in each batch, say), so most of the time things are rebuilt from scratch.</p>
</blockquote>
<p>Can we thus act smart and make Bors pack together the PRs that touch basic files?</p>



<a name="235802182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235802182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235802182">(Apr 23 2021 at 07:59)</a>:</h4>
<p>That doesn't seem very easy. We would have to manually assign priorities based on how "basic" we think PRs are. And if you <code>bors merge</code> a PR with high priority, it will cancel the running batch if it has lower priority.</p>



<a name="235802282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235802282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235802282">(Apr 23 2021 at 08:00)</a>:</h4>
<p>Priorities are the only way to influence how bors puts things in different batches, as far as I can see.</p>



<a name="235805498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235805498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235805498">(Apr 23 2021 at 08:30)</a>:</h4>
<p>Actually, <code>trepplein</code> is awesome:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">time</span> <span class="bp">./</span><span class="n">target</span><span class="bp">/</span><span class="n">universal</span><span class="bp">/</span><span class="n">stage</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">trepplein</span> <span class="bp">-</span><span class="n">s</span> <span class="bp">../</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">mathlib.txt</span>
<span class="c1">-- successfully checked 145490 declarations</span>

<span class="n">real</span>    <span class="mi">13</span><span class="n">m0.611s</span>
<span class="n">user</span>    <span class="mi">14</span><span class="n">m10.181s</span>
<span class="n">sys</span> <span class="mi">0</span><span class="n">m10.675s</span>
</code></pre></div>



<a name="235805648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235805648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235805648">(Apr 23 2021 at 08:31)</a>:</h4>
<p>On the other hand <code>tc</code> seems to be really struggling with the material in <code>ring_quot</code>...</p>



<a name="235805653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235805653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235805653">(Apr 23 2021 at 08:31)</a>:</h4>
<p>Is there some hidden option to make it output some timing data?</p>



<a name="235805769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235805769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235805769">(Apr 23 2021 at 08:32)</a>:</h4>
<p>I don't think so. It's written in scala, which I used to speak, so I guess I can try to insert this. Gabriel will be more efficient. :-)</p>



<a name="235806212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235806212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235806212">(Apr 23 2021 at 08:36)</a>:</h4>
<p>If we do switch to <code>trepplein</code> would it be worth digging up an old issue that <code>leanchecker</code> caught and demonstrating that <code>trepplein</code> would also flag it?</p>



<a name="235809829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235809829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235809829">(Apr 23 2021 at 09:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235802282">said</a>:</p>
<blockquote>
<p>Priorities are the only way to influence how bors puts things in different batches, as far as I can see.</p>
</blockquote>
<p>Hmm... That sounds like we could open a feature request.</p>



<a name="235811035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235811035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235811035">(Apr 23 2021 at 09:19)</a>:</h4>
<p>If you give the feature request a high priority it might end up in a batch that they start working on early <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="235817005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235817005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235817005">(Apr 23 2021 at 10:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235805648">said</a>:</p>
<blockquote>
<p>On the other hand <code>tc</code> seems to be really struggling with the material in <code>ring_quot</code>...</p>
</blockquote>
<p>Is this before or after <a href="https://github.com/leanprover-community/mathlib/issues/7120">#7120</a> has been merged?</p>



<a name="235819435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235819435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235819435">(Apr 23 2021 at 10:39)</a>:</h4>
<p>Interesting, <code>tc</code> eventually got past that, but now fails:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">DEF</span><span class="o">(</span><span class="mi">27959</span><span class="o">):</span> <span class="bp">.</span><span class="n">category_theory.sieve.generate</span>
<span class="n">IND</span><span class="o">(</span><span class="mi">654</span><span class="o">):</span> <span class="bp">.</span><span class="n">category_theory.presieve.singleton</span><span class="o">[</span><span class="bp">.</span><span class="n">v</span><span class="o">,</span><span class="bp">.</span><span class="n">u</span><span class="o">]</span>
<span class="n">IDeclError</span> <span class="o">(</span><span class="n">TypeCheckError</span> <span class="o">(</span><span class="n">TypeExpected</span> <span class="o">(</span><span class="k">Pi</span><span class="o">:</span> <span class="o">(</span><span class="n">Local</span> <span class="bp">&lt;.#</span><span class="n">_system.5</span><span class="bp">&gt;</span><span class="o">)</span> <span class="bp">-&gt;</span> <span class="o">(</span><span class="n">App</span><span class="o">:</span> <span class="bp">'.</span><span class="n">set'</span> <span class="bp">@</span> <span class="o">[(</span><span class="n">App</span><span class="o">:</span> <span class="bp">'.</span><span class="n">quiver.hom'</span> <span class="bp">@</span> <span class="o">[(</span><span class="n">Local</span> <span class="bp">&lt;.#</span><span class="n">_system.5</span><span class="bp">&gt;</span><span class="o">),(</span><span class="n">App</span><span class="o">:</span> <span class="bp">'.</span><span class="n">category_theory.category_struct.to_quiver'</span> <span class="bp">@</span> <span class="o">[(</span><span class="n">Local</span> <span class="bp">&lt;.#</span><span class="n">_system.5</span><span class="bp">&gt;</span><span class="o">),(</span><span class="n">App</span><span class="o">:</span> <span class="bp">'.</span><span class="n">category_theory.category.to_category_struct'</span> <span class="bp">@</span> <span class="o">[(</span><span class="n">Local</span> <span class="bp">&lt;.#</span><span class="n">_system.5</span><span class="bp">&gt;</span><span class="o">),(</span><span class="n">Local</span> <span class="bp">&lt;.#</span><span class="n">_system.6</span><span class="bp">&gt;</span><span class="o">)])]),</span><span class="bp">#</span><span class="mi">0</span><span class="o">,(</span><span class="n">Local</span> <span class="bp">&lt;.#</span><span class="n">_system.7</span><span class="bp">&gt;</span><span class="o">)])])))</span> <span class="s2">"ensureSort"</span><span class="o">)</span>
</code></pre></div>



<a name="235837772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235837772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235837772">(Apr 23 2021 at 13:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="240862">Oliver Nash</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/235806212">said</a>:</p>
<blockquote>
<p>If we do switch to <code>trepplein</code> would it be worth digging up an old issue that <code>leanchecker</code> caught and demonstrating that <code>trepplein</code> would also flag it?</p>
</blockquote>
<p>Does anyone know where we can quickly find such issues?</p>



<a name="235837877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235837877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235837877">(Apr 23 2021 at 13:14)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues?q=is%3Aissue+leanchecker">https://github.com/leanprover-community/mathlib/issues?q=is%3Aissue+leanchecker</a> is empty</p>



<a name="235840663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235840663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235840663">(Apr 23 2021 at 13:33)</a>:</h4>
<p>Was it <a href="#narrow/stream/113488-general/topic/leanchecker.20timeout">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/leanchecker.20timeout</a></p>



<a name="235840842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235840842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235840842">(Apr 23 2021 at 13:34)</a>:</h4>
<p>or <a href="#narrow/stream/144837-PR-reviews/topic/.236375/near/228434456">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/.236375/near/228434456</a></p>



<a name="235840855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235840855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235840855">(Apr 23 2021 at 13:34)</a>:</h4>
<p>or <a href="#narrow/stream/144837-PR-reviews/topic/.236572.20crashes.20leanchecker">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/.236572.20crashes.20leanchecker</a></p>



<a name="235840993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235840993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235840993">(Apr 23 2021 at 13:35)</a>:</h4>
<p>From the topmost post in that last one:</p>
<blockquote>
<p>commit c8892e44 is the offending one.</p>
</blockquote>



<a name="235841154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841154">(Apr 23 2021 at 13:36)</a>:</h4>
<p>That gives a pointer to a commit that we can try <code>trepplein</code> on. But we'll first need to see if that commit still exists somewhere.</p>



<a name="235841301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841301">(Apr 23 2021 at 13:37)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/6572/commits/c8892e44fe95f8fe8b7892aa83b6ce0466fba8f5">https://github.com/leanprover-community/mathlib/pull/6572/commits/c8892e44fe95f8fe8b7892aa83b6ce0466fba8f5</a><br>
github still seems to have it</p>



<a name="235841336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841336">(Apr 23 2021 at 13:37)</a>:</h4>
<p>That last one wasn't actually a bug in leanchecker at all though, it was a bug in the exported output</p>



<a name="235841352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841352">(Apr 23 2021 at 13:37)</a>:</h4>
<p>ooh <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="235841355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841355">(Apr 23 2021 at 13:37)</a>:</h4>
<p>So should be caught by any checker</p>



<a name="235841458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841458">(Apr 23 2021 at 13:38)</a>:</h4>
<p>aah, so it's actually a good test case</p>



<a name="235841468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841468">(Apr 23 2021 at 13:38)</a>:</h4>
<p>In fact, the commit isn't enough to reproduce it - you need the corrupt olean files that were uploaded by that build</p>



<a name="235841508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841508">(Apr 23 2021 at 13:38)</a>:</h4>
<p>Right, so we need to use an old version of lean</p>



<a name="235841531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235841531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235841531">(Apr 23 2021 at 13:38)</a>:</h4>
<p>Hopefully <code>elan</code> can find it for us.</p>



<a name="235843233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235843233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235843233">(Apr 23 2021 at 13:49)</a>:</h4>
<p>If I'm not mistaken, I think the issue where Lean would accept bad oleans due to a hash collision should now be fixed since we now run <code>lean --make src/</code> twice in succession in CI.</p>



<a name="235843541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235843541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235843541">(Apr 23 2021 at 13:51)</a>:</h4>
<p>Well, not fixed, but sufficiently worked around!</p>



<a name="235843940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235843940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235843940">(Apr 23 2021 at 13:54)</a>:</h4>
<p>How so?</p>



<a name="235844123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235844123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235844123">(Apr 23 2021 at 13:55)</a>:</h4>
<p>I guess we could double check by amending that commit with an updated CI script</p>



<a name="235985017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235985017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235985017">(Apr 24 2021 at 16:55)</a>:</h4>
<p>It seems like <a href="https://github.com/leanprover-community/mathlib/runs/2427448873">https://github.com/leanprover-community/mathlib/runs/2427448873</a> is taking over an hour to install elan - I don't claim to understand how the CI works but this seems wrong to me :| Is there something I can do about this?</p>



<a name="235985482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235985482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235985482">(Apr 24 2021 at 17:02)</a>:</h4>
<p>This is probably just a display bug, see <a href="#narrow/stream/113488-general/topic/CI.20hanging.20on.20trying.20to.20find.20oleans.20cache">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/CI.20hanging.20on.20trying.20to.20find.20oleans.20cache</a></p>



<a name="235985483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235985483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235985483">(Apr 24 2021 at 17:02)</a>:</h4>
<p>I think that build is actually working on the "leanpkg build" step and a callback to update the view we're seeing has just been lost somewhere in the ether.</p>



<a name="235996204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235996204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235996204">(Apr 24 2021 at 19:01)</a>:</h4>
<p>Hi I'm Ben! I'm new so not sure this is helpful, but I modified leanchecker so that it outputs timing data. Code <a href="https://github.com/leanprover-community/lean/pull/567">here</a>.<br>
It's the same command as it was previously was to run it: <code>leanchecker -v export.out &gt; leanchecker.txt 2&gt;&amp;1</code> <br>
In another terminal, you can run <code>watch -n 10 sort --general-numeric-sort --reverse leanchecker.txt</code> to get a live view of what's slow.<br>
Output (for mathlib at f15887a18). <a href="user_uploads/3121/Ptn7ZvJ7-8q9gKqfhvhUp9gr/leanchecker_sorted.txt">leanchecker_sorted.txt</a> <a href="user_uploads/3121/aIHU9I6qC2gS8ELwbpgtBcUr/leanchecker.txt">leanchecker.txt</a></p>
<p>Top 20: </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">96</span><span class="bp">.</span><span class="mi">884151</span> <span class="n">s</span><span class="o">:</span> <span class="n">lie_module.derived_series_le_lower_central_series</span>
<span class="mi">40</span><span class="bp">.</span><span class="mi">613059</span> <span class="n">s</span><span class="o">:</span> <span class="n">has_fpower_series_at.comp</span>
<span class="mi">38</span><span class="bp">.</span><span class="mi">592329</span> <span class="n">s</span><span class="o">:</span> <span class="n">cauchy_seq_finset_of_geometric_bound</span>
<span class="mi">13</span><span class="bp">.</span><span class="mi">360009</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux.equations._eqn_1</span>
<span class="mi">12</span><span class="bp">.</span><span class="mi">736091</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux</span>
<span class="mi">11</span><span class="bp">.</span><span class="mi">605639</span> <span class="n">s</span><span class="o">:</span> <span class="n">mv_power_series.X_pow_dvd_iff</span>
<span class="mi">10</span><span class="bp">.</span><span class="mi">258607</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">9</span><span class="bp">.</span><span class="mi">939601</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean.equations._eqn_1</span>
<span class="mi">9</span><span class="bp">.</span><span class="mi">142622</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">893232</span> <span class="n">s</span><span class="o">:</span> <span class="n">smooth_bump_covering.exists_immersion_findim</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">811549</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommMon.category_theory.forget₂.category_theory.creates_limit._proof_6</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">442576</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommMon.category_theory.forget₂.category_theory.creates_limit._proof_6</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">258426</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">064644</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_8</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">992482</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_9</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">919239</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_10</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">351864</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommRing.category_theory.forget₂.category_theory.creates_limit._proof_3</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">115897</span> <span class="n">s</span><span class="o">:</span> <span class="n">Top.presheaf.app_bijective_of_stalk_functor_map_bijective</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">065005</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.forget₂_AddCommMon_preserves_limits_aux.equations._eqn_1</span>
<span class="mi">5</span><span class="bp">.</span><span class="mi">467336</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.forget₂_AddCommMon_preserves_limits_aux</span>
</code></pre></div>



<a name="235996769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235996769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235996769">(Apr 24 2021 at 19:07)</a>:</h4>
<p><span aria-label="scream" class="emoji emoji-1f631" role="img" title="scream">:scream:</span> that’s my lemma at the top. I’ll take a look when I’m at my laptop later this evening. Thanks <span class="user-mention" data-user-id="392126">@Ben Toner</span></p>



<a name="235997446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235997446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235997446">(Apr 24 2021 at 19:16)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> That's great! Would you mind running this on the following two commits:</p>
<ul>
<li><code>3ec54df501359e925d42f84aaf703e853fe6ba1c</code> (just before <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a>)</li>
<li><code>63801552184f2a519c95a45561300547837915cc</code> (just after <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a>)</li>
</ul>



<a name="235997481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235997481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235997481">(Apr 24 2021 at 19:17)</a>:</h4>
<p>Also, this seems like a very useful feature for <code>leanchecker</code>, so probably Gabriel wouldn't mind seeing this PRd to the community repo.</p>



<a name="235997906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235997906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235997906">(Apr 24 2021 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Sure - it's running now. Pull request is <a href="https://github.com/leanprover-community/lean/pull/567">here</a>.</p>



<a name="235998424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235998424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235998424">(Apr 24 2021 at 19:30)</a>:</h4>
<p>I'm looking forward to seeing the histograms generated with the new data!</p>



<a name="235998793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235998793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235998793">(Apr 24 2021 at 19:34)</a>:</h4>
<p>Do you want to be to make separate histograms for definitions, inductive definitions and axioms?</p>



<a name="235999107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235999107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235999107">(Apr 24 2021 at 19:38)</a>:</h4>
<p>Well, right now we want to understand why the total thing got so much slower by PR <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a></p>



<a name="235999135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235999135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235999135">(Apr 24 2021 at 19:39)</a>:</h4>
<p>So we want to get a feeling for which declarations got slower between those two commits.</p>



<a name="235999144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/235999144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#235999144">(Apr 24 2021 at 19:39)</a>:</h4>
<p>Being able to split by type of decl could in principle be useful, but for me it doesn't seem an urgent feature.</p>



<a name="236000302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236000302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236000302">(Apr 24 2021 at 19:55)</a>:</h4>
<ul>
<li><code>3ec54df501359e925d42f84aaf703e853fe6ba1c</code> (just before <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a>)<br>
<a href="/user_uploads/3121/beFEUieJ4WUu1pUd0zL5BS6X/leanchecker_3ec54df5_sorted.txt">leanchecker_3ec54df5_sorted.txt</a> <a href="/user_uploads/3121/ocYZScTfZ9J8-t0Wu8M0RsR9/leanchecker_3ec54df5.txt">leanchecker_3ec54df5.txt</a><br>
Top 20:</li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">91</span><span class="bp">.</span><span class="mi">168317</span> <span class="n">s</span><span class="o">:</span> <span class="n">lie_module.derived_series_le_lower_central_series</span>
<span class="mi">41</span><span class="bp">.</span><span class="mi">849018</span> <span class="n">s</span><span class="o">:</span> <span class="n">has_fpower_series_at.comp</span>
<span class="mi">38</span><span class="bp">.</span><span class="mi">994233</span> <span class="n">s</span><span class="o">:</span> <span class="n">cauchy_seq_finset_of_geometric_bound</span>
<span class="mi">10</span><span class="bp">.</span><span class="mi">968149</span> <span class="n">s</span><span class="o">:</span> <span class="n">mv_power_series.X_pow_dvd_iff</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">603513</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_5</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">602266</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_4</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">484212</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_6</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">963744</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux.equations._eqn_1</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">878469</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux</span>
<span class="mi">3</span><span class="bp">.</span><span class="mi">275507</span> <span class="n">s</span><span class="o">:</span> <span class="n">category_theory.monoidal.Mon_functor_category_equivalence._proof_1</span>
<span class="mi">3</span><span class="bp">.</span><span class="mi">260439</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_1</span>
<span class="mi">2</span><span class="bp">.</span><span class="mi">623107</span> <span class="n">s</span><span class="o">:</span> <span class="n">int.bitwise_and</span>
<span class="mi">2</span><span class="bp">.</span><span class="mi">496212</span> <span class="n">s</span><span class="o">:</span> <span class="n">ring.fractional_ideal.eq_one_div_of_mul_eq_one</span>
<span class="mi">2</span><span class="bp">.</span><span class="mi">455020</span> <span class="n">s</span><span class="o">:</span> <span class="n">right_inverse_eq</span>
<span class="mi">2</span><span class="bp">.</span><span class="mi">418527</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">2</span><span class="bp">.</span><span class="mi">327386</span> <span class="n">s</span><span class="o">:</span> <span class="n">int.bitwise_xor</span>
<span class="mi">2</span><span class="bp">.</span><span class="mi">305817</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">1</span><span class="bp">.</span><span class="mi">926131</span> <span class="n">s</span><span class="o">:</span> <span class="n">category_theory.monoidal.CommMon_functor_category_equivalence.counit_iso._proof_8</span>
<span class="mi">1</span><span class="bp">.</span><span class="mi">770720</span> <span class="n">s</span><span class="o">:</span> <span class="n">smooth_bump_covering.exists_immersion_findim</span>
<span class="mi">1</span><span class="bp">.</span><span class="mi">710779</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean</span>
</code></pre></div>



<a name="236003399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236003399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236003399">(Apr 24 2021 at 20:34)</a>:</h4>
<p>The 20th slowest thing used to be 1.7 second and now it's 5.4 seconds</p>



<a name="236004977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236004977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236004977">(Apr 24 2021 at 20:54)</a>:</h4>
<ul>
<li><code>63801552184f2a519c95a45561300547837915cc</code> (just after <a href="https://github.com/leanprover-community/mathlib/issues/7084">#7084</a>)<br>
<a href="/user_uploads/3121/NlMfxI-zxIJu2yd937xlrqPM/leanchecker_63801552_sorted.txt">leanchecker_63801552_sorted.txt</a> <a href="/user_uploads/3121/AnluOe81VWmQvhTCNO2JbeiX/leanchecker_63801552.txt">leanchecker_63801552.txt</a> <br>
Top 20:</li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">99</span><span class="bp">.</span><span class="mi">348087</span> <span class="n">s</span><span class="o">:</span> <span class="n">lie_module.derived_series_le_lower_central_series</span>
<span class="mi">41</span><span class="bp">.</span><span class="mi">325001</span> <span class="n">s</span><span class="o">:</span> <span class="n">has_fpower_series_at.comp</span>
<span class="mi">38</span><span class="bp">.</span><span class="mi">674662</span> <span class="n">s</span><span class="o">:</span> <span class="n">cauchy_seq_finset_of_geometric_bound</span>
<span class="mi">18</span><span class="bp">.</span><span class="mi">162586</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux</span>
<span class="mi">17</span><span class="bp">.</span><span class="mi">136728</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux.equations._eqn_1</span>
<span class="mi">11</span><span class="bp">.</span><span class="mi">631498</span> <span class="n">s</span><span class="o">:</span> <span class="n">mv_power_series.X_pow_dvd_iff</span>
<span class="mi">11</span><span class="bp">.</span><span class="mi">470218</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean</span>
<span class="mi">11</span><span class="bp">.</span><span class="mi">415529</span> <span class="n">s</span><span class="o">:</span> <span class="n">smooth_bump_covering.exists_immersion_findim</span>
<span class="mi">10</span><span class="bp">.</span><span class="mi">795835</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean.equations._eqn_1</span>
<span class="mi">10</span><span class="bp">.</span><span class="mi">485176</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">10</span><span class="bp">.</span><span class="mi">044581</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">402438</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommMon.category_theory.forget₂.category_theory.creates_limit._proof_6</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">347118</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.limit_π_ring_hom.equations._eqn_1</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">283634</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.limit_π_ring_hom</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">914338</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_9</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">818749</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommMon.category_theory.forget₂.category_theory.creates_limit._proof_6</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">751567</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_10</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">586451</span> <span class="n">s</span><span class="o">:</span> <span class="n">bounded_continuous_function.add_comm_group._proof_8</span>
<span class="mi">6</span><span class="bp">.</span><span class="mi">178683</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.forget₂_AddCommMon_preserves_limits_aux</span>
<span class="mi">5</span><span class="bp">.</span><span class="mi">924244</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.forget₂_AddCommMon_preserves_limits_aux.equations._eqn_1</span>
</code></pre></div>



<a name="236005174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236005174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236005174">(Apr 24 2021 at 20:57)</a>:</h4>
<p>Differences from 3ec54df5 to 63801552 (with small relative or absolute differences filtered out): <a href="/user_uploads/3121/_37znEM6eCUdLTruWfFELOLL/difference.txt">difference.txt</a> <br>
Top 20:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">13</span><span class="bp">.</span><span class="mi">284117</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux</span>
<span class="mi">12</span><span class="bp">.</span><span class="mi">172984</span> <span class="n">s</span><span class="o">:</span> <span class="n">Algebra.forget₂_Ring_preserves_limits_aux.equations._eqn_1</span>
<span class="mi">9</span><span class="bp">.</span><span class="mi">759439</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean</span>
<span class="mi">9</span><span class="bp">.</span><span class="mi">644809</span> <span class="n">s</span><span class="o">:</span> <span class="n">smooth_bump_covering.exists_immersion_findim</span>
<span class="mi">9</span><span class="bp">.</span><span class="mi">346480</span> <span class="n">s</span><span class="o">:</span> <span class="n">to_euclidean.equations._eqn_1</span>
<span class="mi">8</span><span class="bp">.</span><span class="mi">179359</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">952717</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommMon.category_theory.forget₂.category_theory.creates_limit._proof_6</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">876578</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.limit_π_ring_hom.equations._eqn_1</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">872092</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.limit_π_ring_hom</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">626054</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommGroup.category_theory.forget₂.category_theory.creates_limit._proof_7</span>
<span class="mi">7</span><span class="bp">.</span><span class="mi">372604</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommMon.category_theory.forget₂.category_theory.creates_limit._proof_6</span>
<span class="mi">5</span><span class="bp">.</span><span class="mi">510193</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.forget₂_AddCommMon_preserves_limits_aux</span>
<span class="mi">5</span><span class="bp">.</span><span class="mi">177408</span> <span class="n">s</span><span class="o">:</span> <span class="n">SemiRing.forget₂_AddCommMon_preserves_limits_aux.equations._eqn_1</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">339591</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommMon.category_theory.forget₂.category_theory.creates_limit</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">259126</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommGroup.category_theory.forget₂.category_theory.creates_limit</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">167444</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommMon.category_theory.forget₂.category_theory.creates_limit</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">081465</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommGroup.category_theory.forget₂.category_theory.creates_limit.equations._eqn_1</span>
<span class="mi">4</span><span class="bp">.</span><span class="mi">003845</span> <span class="n">s</span><span class="o">:</span> <span class="n">CommGroup.category_theory.forget₂.category_theory.creates_limit</span>
<span class="mi">3</span><span class="bp">.</span><span class="mi">984336</span> <span class="n">s</span><span class="o">:</span> <span class="n">AddCommMon.category_theory.forget₂.category_theory.creates_limit.equations._eqn_1</span>
<span class="mi">3</span><span class="bp">.</span><span class="mi">955816</span> <span class="n">s</span><span class="o">:</span> <span class="n">euclidean.exists_pos_lt_subset_ball</span>
</code></pre></div>



<a name="236006914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236006914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ben Toner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236006914">(Apr 24 2021 at 21:07)</a>:</h4>
<p>(Script to calculate differences is <a href="https://github.com/bentoner/lean/blob/leanchecker-timing/script/compare_leanchecker_timings.py">here</a>.)</p>



<a name="236011303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236011303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236011303">(Apr 24 2021 at 22:02)</a>:</h4>
<p>Thank you so much!</p>



<a name="236014121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236014121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236014121">(Apr 24 2021 at 22:42)</a>:</h4>
<p>The totals seem to indicate that post 7084 leanchecker should now take just a couple of minutes longer.</p>



<a name="236014617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236014617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236014617">(Apr 24 2021 at 22:49)</a>:</h4>
<p>The <code>by convert</code> trick decreases elaboration time of <code>Algebra.forget₂_Ring_preserves_limits_aux</code> from 2.64 seconds to 0.7 seconds.</p>
<p>In contrast, <code>to_euclidean</code> times out if you insert <code>by convert</code> :-)</p>



<a name="236117373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236117373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236117373">(Apr 26 2021 at 04:06)</a>:</h4>
<p><span class="user-mention" data-user-id="392126">@Ben Toner</span> Thanks a lot for generating this data!</p>



<a name="236117402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236117402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236117402">(Apr 26 2021 at 04:07)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> could you please generate some histograms again, to see what the pictures look like now?</p>



<a name="236122032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236122032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236122032">(Apr 26 2021 at 05:23)</a>:</h4>
<p>It would be really great if we had this data regularly. Having a regularly updated "high score" chart to direct our attention to some combination of the slow stuff, and the newly-slow stuff, would be super helpful.</p>



<a name="236124574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236124574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236124574">(Apr 26 2021 at 06:04)</a>:</h4>
<p>I just kick <a href="https://github.com/leanprover-community/mathlib/issues/7359">#7359</a> on the queue, so the top spot on the leaderboard should be changing a couple of hours from now (-;</p>



<a name="236241989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236241989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236241989">(Apr 26 2021 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="110596">@Rob Lewis</span> do you think we should try to take more action here?</p>



<a name="236258918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236258918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236258918">(Apr 26 2021 at 23:12)</a>:</h4>
<p>Could someone double check my finding that trepplein is way faster on mathlib than leanchecker?</p>



<a name="236262766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236262766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236262766">(Apr 26 2021 at 23:55)</a>:</h4>
<p>whilst I was googling stuff to install, I found <a href="https://github.com/ammkrn/nanoda_lib">this</a> in rust - may also be a contender?</p>



<a name="236266081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236266081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236266081">(Apr 27 2021 at 00:34)</a>:</h4>
<p>okay, was trying to check but got:</p>
<div class="codehilite" data-code-language="plain"><pre><span></span><code>Exception in thread "main" java.lang.IllegalArgumentException: expected
, got

        at trepplein.LinesParser.consume(parser.scala:45)
        at trepplein.LinesParser.lines(parser.scala:50)
        at trepplein.TextExportParser$.$anonfun$parseStream$5(parser.scala:229)
        at scala.collection.immutable.LazyList$.$anonfun$flatMapImpl$1(LazyList.scala:1049)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state$lzycompute(LazyList.scala:259)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state(LazyList.scala:252)
        at scala.collection.immutable.LazyList.isEmpty(LazyList.scala:269)
        at scala.collection.immutable.LazyList$.$anonfun$collectImpl$1(LazyList.scala:1031)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state$lzycompute(LazyList.scala:259)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state(LazyList.scala:252)
        at scala.collection.immutable.LazyList.isEmpty(LazyList.scala:269)
        at trepplein.main$.main(main.scala:140)
        at trepplein.main.main(main.scala)
</code></pre></div>



<a name="236266107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236266107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236266107">(Apr 27 2021 at 00:35)</a>:</h4>
<p>(input:  <code>./trepplein -s export.out</code>)</p>



<a name="236267201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236267201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236267201">(Apr 27 2021 at 00:42)</a>:</h4>
<p>I've used nanoda / nanoda-lib before; it's much quicker than <code>leanchecker</code> though I didn't do any timing. This was also before the recent changes that made <code>leanchecker</code> much slower.</p>



<a name="236275346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236275346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236275346">(Apr 27 2021 at 02:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/236258918">said</a>:</p>
<blockquote>
<p>Could someone double check my finding that trepplein is way faster on mathlib than leanchecker?</p>
</blockquote>
<p>Can confirm. On my system with recent <code>master</code>:</p>
<ul>
<li><code>leanchecker</code>: 34m</li>
<li><code>trepplein -s</code>: 14m</li>
<li><code>trepplein</code> (16 threads): 3m</li>
<li><code>tc</code>: consumes &gt;25G memory and dies</li>
</ul>



<a name="236303872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236303872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236303872">(Apr 27 2021 at 08:59)</a>:</h4>
<p><span class="user-mention" data-user-id="256311">@Jannis Limperg</span> Could you test nanoda as well?</p>



<a name="236308248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236308248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236308248">(Apr 27 2021 at 09:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue/near/236266081">said</a>:</p>
<blockquote>
<p>okay, was trying to check but got:</p>
<p><div class="codehilite" data-code-language="plain"><pre><span></span><code>Exception in thread "main" java.lang.IllegalArgumentException: expected
, got

        at trepplein.LinesParser.consume(parser.scala:45)
        at trepplein.LinesParser.lines(parser.scala:50)
        at trepplein.TextExportParser$.$anonfun$parseStream$5(parser.scala:229)
        at scala.collection.immutable.LazyList$.$anonfun$flatMapImpl$1(LazyList.scala:1049)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state$lzycompute(LazyList.scala:259)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state(LazyList.scala:252)
        at scala.collection.immutable.LazyList.isEmpty(LazyList.scala:269)
        at scala.collection.immutable.LazyList$.$anonfun$collectImpl$1(LazyList.scala:1031)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state$lzycompute(LazyList.scala:259)
        at scala.collection.immutable.LazyList.scala$collection$immutable$LazyList$$state(LazyList.scala:252)
        at scala.collection.immutable.LazyList.isEmpty(LazyList.scala:269)
        at trepplein.main$.main(main.scala:140)
        at trepplein.main.main(main.scala)
</code></pre></div><br>
</p>
</blockquote>
<p>So this is actually because of Windows – <code>leanchecker</code> makes CRLF files, whilst turns out <code>\n</code> is Scala is platform-agnostic; strip out the CRLFs and it's totally fine</p>



<a name="236308461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236308461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236308461">(Apr 27 2021 at 09:38)</a>:</h4>
<p>Timings so far: (measured with powershell <code>Measure-Command</code>, on a Ryzen 3600X)</p>
<p><code>leanchecker</code>: 1.4407... hours<br>
<code>trepplein</code> : 4.1545... minutes<br>
<code>trepplein -s</code> : 16.712... minutes<br>
<code>nanoda</code> (12 threads) : stack overflow<br>
<code>nanoda</code> (ST): running</p>



<a name="236326511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236326511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236326511">(Apr 27 2021 at 12:26)</a>:</h4>
<p>I've edited my comment with <code>nanoda</code> timings. <code>nanoda</code> wins overall, but not by that much compared to <code>trepplein</code>. It doesn't overflow for me like it does for Eric. Might be Windows vs Linux coming into play.</p>



<a name="236328924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236328924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236328924">(Apr 27 2021 at 12:42)</a>:</h4>
<p>Cool, so we could even run <code>trepplein</code> and <code>nanoda</code> sequentially, and we wouldn't even notice <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="236335394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/236335394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#236335394">(Apr 27 2021 at 13:24)</a>:</h4>
<p>yep seems so; I can run em on WSL if people want any more timings, but I think the findings are pretty definitive :b</p>



<a name="238969514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/238969514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#238969514">(May 16 2021 at 11:16)</a>:</h4>
<p>I notice the queue is heavily cluttered at the moment. Stuff that was sent 2 hours ago is still not being processed. Those two actions have been running each for 5 hours: <a href="https://github.com/leanprover-community/mathlib/actions/runs/846421065">https://github.com/leanprover-community/mathlib/actions/runs/846421065</a> <a href="https://github.com/leanprover-community/mathlib/actions/runs/846475716">https://github.com/leanprover-community/mathlib/actions/runs/846475716</a><br>
Anything to be worried about?</p>



<a name="238970823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/238970823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#238970823">(May 16 2021 at 11:39)</a>:</h4>
<p>GH Actions is partially down this morning so may be related: <a href="https://www.githubstatus.com/">https://www.githubstatus.com/</a></p>



<a name="238997886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/238997886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#238997886">(May 16 2021 at 18:41)</a>:</h4>
<p>I just restarted some jobs that were still in the queue. The queue is now empty again.</p>



<a name="238998002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/238998002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#238998002">(May 16 2021 at 18:43)</a>:</h4>
<p>there's a few that failed with an error about continuous issues (e.g. <a href="https://github.com/leanprover-community/mathlib/issues/7623">#7623</a>, <a href="https://github.com/leanprover-community/mathlib/issues/7363">#7363</a>); an empty commit will fix them up - just wondering if there's a better way to do this?</p>



<a name="238998335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20repo%20GitHub%20actions%20queue/near/238998335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/mathlib.20repo.20GitHub.20actions.20queue.html#238998335">(May 16 2021 at 18:48)</a>:</h4>
<p>You can go to the actions page and click "re-run jobs".</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>