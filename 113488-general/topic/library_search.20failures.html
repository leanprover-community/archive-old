---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/library_search.20failures.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html">library_search failures</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="254171243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254171243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254171243">(Sep 21 2021 at 08:19)</a>:</h4>
<p>Hi,<br>
I'd like to know why <code>library_search</code> fails in the example below:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.ereal</span>
<span class="kn">import</span> <span class="n">order.complete_lattice</span>
<span class="kn">open</span> <span class="n">set</span>

<span class="kd">noncomputable theory</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ereal</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ereal</span><span class="o">)</span> <span class="bp">∈</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ereal</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">α</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">--library_search, -- fails</span>
  <span class="n">exact</span> <span class="n">le_Sup</span> <span class="n">h</span><span class="o">,</span> <span class="c1">-- works like a charm</span>
<span class="kd">end</span>
</code></pre></div>
<p>This is related to a small PR that <span class="user-mention" data-user-id="310045">@Eric Wieser</span> is reviewing about adding a bit of api to ereal's. (<a href="https://github.com/leanprover-community/mathlib/issues/9313">#9313</a>)</p>



<a name="254174044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254174044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254174044">(Sep 21 2021 at 08:47)</a>:</h4>
<p>Yeah, this surprises me too. It fails even without the coercions:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ereal</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">ereal</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">s</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>
<p>yet this works</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_linear_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">s</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>



<a name="254176220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254176220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254176220">(Sep 21 2021 at 09:09)</a>:</h4>
<p>Adding<br>
<code>haveI : complete_linear_order ereal := ereal.complete_linear_order,</code><br>
doesn't help either. How would one debug this?</p>



<a name="254183477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254183477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254183477">(Sep 21 2021 at 10:13)</a>:</h4>
<p>First, check <code>library_seach!</code>. (No luck.)</p>



<a name="254183537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254183537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254183537">(Sep 21 2021 at 10:14)</a>:</h4>
<p>Second, try <code>set_option trace.suggest true</code> to see which lemmas it is trying.</p>



<a name="254183554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254183554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254183554">(Sep 21 2021 at 10:14)</a>:</h4>
<p>Sure enough, <code>le_Sup</code> is on the list, but it is not successfully using it.</p>



<a name="254184239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184239">(Sep 21 2021 at 10:21)</a>:</h4>
<p>Look further down the huge trace output, to see what it says when it tries <code>le_Sup</code>, only to be disappointed that it just says:<br>
<code>Trying to apply lemma: le_Sup.{?_mlocal._fresh.23.109287}</code>.</p>



<a name="254184520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184520">(Sep 21 2021 at 10:23)</a>:</h4>
<p>Simulate by hand the step that <code>library_search</code> should hopefully be trying with this lemma:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="k">do</span> <span class="n">e</span> <span class="bp">←</span> <span class="n">tactic.to_expr</span> <span class="bp">``</span><span class="o">(</span><span class="n">le_Sup</span><span class="o">),</span> <span class="n">tactic.suggest.apply_and_solve</span> <span class="n">tt</span> <span class="o">{}</span> <span class="n">e</span><span class="o">),</span>
</code></pre></div>
<p>getting the error message:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">apply</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">unify</span>
  <span class="bp">↑</span><span class="n">x</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">α</span>
<span class="k">with</span>
  <span class="bp">?</span><span class="n">m_2</span> <span class="bp">∈</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="bp">?</span><span class="n">m_3</span>
</code></pre></div>



<a name="254184632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184632">(Sep 21 2021 at 10:24)</a>:</h4>
<p>(Wonder if a closer approximation to <code>library_search</code>s inner workings is:<br>
<code>(do e ← tactic.to_expr ``(@le_Sup), tactic.suggest.apply_and_solve tt {} e),</code>...)</p>



<a name="254184771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184771">(Sep 21 2021 at 10:26)</a>:</h4>
<p>Wonder why that doesn't unify, so turn on <code>set_option pp.all true</code>, and get the more detailed:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">apply</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">unify</span>
  <span class="bp">@</span><span class="n">has_le.le.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">directed_order.to_preorder.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">linear_order.to_directed_order.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">conditionally_complete_linear_order.to_linear_order.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">conditionally_complete_linear_order_of_complete_linear_order.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span>
                   <span class="n">ereal.complete_linear_order</span><span class="o">)))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">coe.</span><span class="o">{</span><span class="mi">1</span> <span class="mi">1</span><span class="o">}</span> <span class="n">real</span> <span class="n">ereal</span> <span class="o">(</span><span class="bp">@</span><span class="n">coe_to_lift.</span><span class="o">{</span><span class="mi">1</span> <span class="mi">1</span><span class="o">}</span> <span class="n">real</span> <span class="n">ereal</span> <span class="o">(</span><span class="bp">@</span><span class="n">coe_base.</span><span class="o">{</span><span class="mi">1</span> <span class="mi">1</span><span class="o">}</span> <span class="n">real</span> <span class="n">ereal</span> <span class="n">ereal.has_coe</span><span class="o">))</span> <span class="n">x</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_Sup.Sup.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">ereal</span> <span class="n">ereal.has_Sup</span> <span class="n">α</span><span class="o">)</span>
<span class="k">with</span>
  <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">},</span>
    <span class="bp">@</span><span class="n">has_mem.mem.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span> <span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="n">set.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">set.has_mem.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">)</span> <span class="n">a</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">→</span>
    <span class="bp">@</span><span class="n">has_le.le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">partial_order.to_preorder.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">complete_semilattice_Sup.to_partial_order.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_4</span><span class="o">)))</span>
      <span class="n">a</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">has_Sup.Sup.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">complete_semilattice_Sup.to_has_Sup.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_2</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">?</span><span class="n">m_4</span><span class="o">)</span> <span class="bp">?</span><span class="n">m_3</span><span class="o">)</span>
</code></pre></div>



<a name="254184908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184908">(Sep 21 2021 at 10:27)</a>:</h4>
<p>Not be immediately sure whether to expect that unification to work or not, but realise that first of all we should check what<br>
<code>apply le_Sup</code> does in this problem.</p>



<a name="254184968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184968">(Sep 21 2021 at 10:28)</a>:</h4>
<p>Discover that this fails! (Even though <code>exact le_Sup h</code> succeeds.)</p>



<a name="254184984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254184984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254184984">(Sep 21 2021 at 10:28)</a>:</h4>
<p>At this point we've learnt that this has nothing to do with <code>library_search</code> itself.</p>



<a name="254185000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254185000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254185000">(Sep 21 2021 at 10:28)</a>:</h4>
<p>(Or rather, we're asking too much of it if we expect it to work when <code>apply</code> fails.)</p>



<a name="254185201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254185201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254185201">(Sep 21 2021 at 10:30)</a>:</h4>
<p>But I'm not immediately sure of the diagnosis from this point. To summarise, the real mystery is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.ereal</span>
<span class="kn">import</span> <span class="n">order.complete_lattice</span>
<span class="kn">open</span> <span class="n">set</span>

<span class="kd">noncomputable theory</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ereal</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ereal</span><span class="o">)</span> <span class="bp">∈</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ereal</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">α</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">le_Sup</span><span class="o">,</span>   <span class="c1">-- fails</span>
  <span class="n">exact</span> <span class="n">le_Sup</span> <span class="n">h</span><span class="o">,</span> <span class="c1">-- works like a charm</span>
<span class="kd">end</span>
</code></pre></div>



<a name="254185249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254185249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254185249">(Sep 21 2021 at 10:31)</a>:</h4>
<p>I remember someone had this on the discord with one of the extended number lines (I think it was <code>nnreal</code> and <code>le_Refl</code>. Something is definitely off about this all</p>



<a name="254185906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254185906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254185906">(Sep 21 2021 at 10:38)</a>:</h4>
<p>I personally had lots of pain with  <a href="https://leanprover-community.github.io/mathlib_docs/find/bsupr_le">docs#bsupr_le</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/le_binfi">docs#le_binfi</a>. You will be desolated to know they don't behave the same, because unification doesn't start with the same arguments (it goes from left to right and the <code>supr</code> is to the left of <code>≤</code> while <code>infi</code> is to its right).</p>



<a name="254185947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254185947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254185947">(Sep 21 2021 at 10:38)</a>:</h4>
<p>The problem is that Lean has a very hard time knowing which function should <code>f i hi</code> match.</p>



<a name="254188047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254188047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254188047">(Sep 21 2021 at 10:59)</a>:</h4>
<p>Wow <span class="user-mention" data-user-id="110087">@Scott Morrison</span> , this is a great analysis (even if unsuccessful so far...). I'm more used to seeing apply work when exact doesn't, this is really weird. (But note that <code>apply le_Sup h</code> does indeed work!)</p>



<a name="254188601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254188601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254188601">(Sep 21 2021 at 11:04)</a>:</h4>
<p>This is the classic "apply bug". It occurs because <code>a ≤ b</code> is a Pi-type for <code>ereal</code> (<a href="https://leanprover-community.github.io/mathlib_docs/find/with_top.preorder/src">src#with_top.preorder</a>) but not in general, and then <code>apply</code> gets confused about how many <code>_</code>s to insert.</p>



<a name="254190559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254190559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254190559">(Sep 21 2021 at 11:21)</a>:</h4>
<p>Would it be reasonable to mark the order as irreducible on <code>with_top</code>?</p>



<a name="254190832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254190832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254190832">(Sep 21 2021 at 11:24)</a>:</h4>
<p>I would guess that you don't want to mark the instance itself irreducible, and instead want</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[irreducible]</span>
<span class="kn">protected</span> <span class="kd">def</span> <span class="n">with_top.le</span> <span class="o">(</span><span class="n">o₁</span> <span class="n">o₂</span> <span class="o">:</span> <span class="n">with_top</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">o₂</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">b</span> <span class="bp">∈</span> <span class="n">o₁</span><span class="o">,</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span>
</code></pre></div>
<p>and then use <code>with_top.le</code> to define the order instance.</p>



<a name="254190918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254190918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254190918">(Sep 21 2021 at 11:24)</a>:</h4>
<p>By that argument presumably we need to do the same thing to <a href="https://leanprover-community.github.io/mathlib_docs/find/pi.preorder">docs#pi.preorder</a>?</p>



<a name="254191025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254191025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254191025">(Sep 21 2021 at 11:25)</a>:</h4>
<p>And <a href="https://leanprover-community.github.io/mathlib_docs/find/set.preorder">docs#set.preorder</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.preorder">docs#finset.preorder</a>, ...</p>



<a name="254191041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254191041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254191041">(Sep 21 2021 at 11:25)</a>:</h4>
<p>Suggesting that maybe it's better to just stop <code>apply</code> getting confused in the first place</p>



<a name="254191236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254191236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254191236">(Sep 21 2021 at 11:27)</a>:</h4>
<p>It's not just <code>apply</code>: I really think that marking more things as irreducible can only help Lean, and that we should probably be doing this much more often. And yes, I meant doing it like you say, with an irreducible definition for <code>with_top.le</code>.</p>



<a name="254192614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254192614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254192614">(Sep 21 2021 at 11:40)</a>:</h4>
<p>It can also be turned into a structure as with <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous">docs#continuous</a> (as <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> will no doubt recall...)</p>



<a name="254192790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254192790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254192790">(Sep 21 2021 at 11:42)</a>:</h4>
<p>Maybe it would be good to have a generic "identity" structure for Props for cases where the overhead of making a new one seems excessive</p>



<a name="254194225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254194225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254194225">(Sep 21 2021 at 11:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/library_search.20failures/near/254192790">said</a>:</p>
<blockquote>
<p>Maybe it would be good to have a generic "identity" structure for Props for cases where the overhead of making a new one seems excessive</p>
</blockquote>
<p>I suspect we'll want to tailor the name of the projection in each case; <code>set.le</code> will probably want the field to be called <code>of_mem</code>, <code>pi.le</code> perhaps wants <code>.eval</code> or similar, ...</p>



<a name="254195467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254195467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254195467">(Sep 21 2021 at 12:05)</a>:</h4>
<p>I guess I'm thinking more about examples like <code>with_top.preorder</code> where the specific definition is irrelevant (once you set up the basic lemmas), so it doesn't really matter if it is just called <code>.out</code> or whatever</p>



<a name="254195642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254195642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254195642">(Sep 21 2021 at 12:07)</a>:</h4>
<p>I mean, the ordering on <code>with_top</code> could just as well have been defined by cases. There's no reason that anyone would guess that it is a Pi type.</p>



<a name="254195695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254195695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254195695">(Sep 21 2021 at 12:07)</a>:</h4>
<p><code>set.le</code> and <code>pi.le</code> should probably remain semireducible. At least for <code>set.le</code>, this is used all over the place.</p>



<a name="254196069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254196069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254196069">(Sep 21 2021 at 12:10)</a>:</h4>
<p>well I guess <code>set.subset</code> is the one whose definition is used all over the place, <code>set.le</code> isn't so common</p>



<a name="254196263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254196263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254196263">(Sep 21 2021 at 12:11)</a>:</h4>
<p>If we don't change the reducibility of <code>pi.le</code> then we presumably still have the library_search failure on pi types</p>



<a name="254347063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/254347063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#254347063">(Sep 22 2021 at 10:40)</a>:</h4>
<p>I don't think I understand what the discussion was about at the end, but is anyone working on this? What kind of work would it entail? Could I contribute?</p>



<a name="263219279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219279">(Nov 30 2021 at 22:38)</a>:</h4>
<p>Reusing this thread to complain about my own problem with <code>library_search</code>, mwe below. The thing causing <code>library_search</code> to fail here is apparently the fact that a higher-level file is being imported. It's not clear to me why library_search should time out anyway, since it's only used while coding, and shouldn't be pushed. It seems to me that this kind of problem will only get worse as more is added to mathlib, making timeouts more common and <code>library_search</code> harder to use.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.totient</span> <span class="c1">-- library_search succeeds without this import</span>
<span class="c1">-- import data.finset.locally_finite -- the file with the lemma</span>

<span class="kn">open</span> <span class="n">finset</span>

<span class="kd">lemma</span> <span class="n">split_Ico</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">S</span><span class="o">]</span> <span class="o">[</span><span class="n">locally_finite_order</span> <span class="n">S</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">S</span><span class="o">}</span>
  <span class="o">(</span><span class="n">a_le_b</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">b_le_c</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">Ico</span> <span class="n">a</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">Ico</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">∪</span> <span class="n">Ico</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">library_search</span><span class="o">,</span> <span class="c1">-- (deterministic) timeout</span>
  <span class="c1">-- rw finset.Ico_union_Ico_eq_Ico a_le_b b_le_c,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="263219564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219564">(Nov 30 2021 at 22:41)</a>:</h4>
<p>This doesn't time out for me -- I might have some timeout figure set higher than you?</p>



<a name="263219698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219698">(Nov 30 2021 at 22:42)</a>:</h4>
<p>I haven't done anything in particular to customize my timeout parameters.</p>



<a name="263219705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219705">(Nov 30 2021 at 22:42)</a>:</h4>
<p>yeah but I might have...</p>



<a name="263219864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219864">(Nov 30 2021 at 22:44)</a>:</h4>
<p>I would propose the solution of simply finding whatever parameter is causing the timeout here and raising it, but I suspect it would raise the timeout parameter for all of mathlib, which I wouldn't want.</p>



<a name="263219881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219881">(Nov 30 2021 at 22:44)</a>:</h4>
<p>It's just some VS Code setting.</p>



<a name="263219925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263219925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263219925">(Nov 30 2021 at 22:45)</a>:</h4>
<p>I ran the script to make <code>all.lean</code> and then if I import that, I get the excessive memory consumption error.</p>



<a name="263220018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263220018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263220018">(Nov 30 2021 at 22:46)</a>:</h4>
<p>Still, I don't want to change my VSCode settings, since then I might push some code and be surprised when CI tells me there's a timeout error.</p>



<a name="263220083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263220083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263220083">(Nov 30 2021 at 22:47)</a>:</h4>
<p>In VS Code settings I have <code>Lean: Time Limit</code> set to 300000 on this machine</p>



<a name="263220102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263220102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263220102">(Nov 30 2021 at 22:47)</a>:</h4>
<p>Let me try that</p>



<a name="263220800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263220800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263220800">(Nov 30 2021 at 22:54)</a>:</h4>
<p>Yes, it works for me with the limit set to 300000. I guess I would suggest based on my experience that the default be changed, I think this is the second time where a higher timeout limit would have been helpful.</p>



<a name="263220894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263220894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263220894">(Nov 30 2021 at 22:55)</a>:</h4>
<p>Perhaps it wouldn't be too big of an issue to let CI operate have one value and the default VSCode parameter have another.</p>



<a name="263221167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263221167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263221167">(Nov 30 2021 at 22:58)</a>:</h4>
<p>In fact, we changed the CI to match VSCode so that people wouldn't get confused as to why their code was failing in CI and not in VS Code (or vice versa).</p>



<a name="263221591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263221591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263221591">(Nov 30 2021 at 23:02)</a>:</h4>
<p>Ah, well, maybe it's not currently worth the hassle.</p>



<a name="263221746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263221746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263221746">(Nov 30 2021 at 23:04)</a>:</h4>
<p>Could not the mathlib repository itself override that setting though?</p>



<a name="263223073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263223073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263223073">(Nov 30 2021 at 23:18)</a>:</h4>
<p>What was the limit on the CI before it was changed?</p>



<a name="263223722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263223722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263223722">(Nov 30 2021 at 23:26)</a>:</h4>
<p>I can't remember anymore, but it looks like we didn't have a limit at all: <a href="https://github.com/leanprover-community/mathlib/issues/2276">#2276</a></p>



<a name="263250655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263250655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263250655">(Dec 01 2021 at 06:48)</a>:</h4>
<p>library_search is much faster in Lean 4, so I don't think this is worth worrying about.</p>



<a name="263306382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/263306382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#263306382">(Dec 01 2021 at 15:21)</a>:</h4>
<blockquote>
<p>library_search is much faster in Lean 4, so I don't think this is worth worrying about.</p>
</blockquote>
<p>I think it should definitely possible to make it much faster than in Lean 3 (we have term indices and caches that persist between tactic invocations), but there's still some performance issues to iron out.  Last time I tried it on the synported mathlib, it even timed out when indexing the lemmas. :-/</p>



<a name="275046702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/275046702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#275046702">(Mar 11 2022 at 23:09)</a>:</h4>
<p>Why is library_search failing here?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.rat.basic</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">q.num</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span> <span class="c1">-- fails</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">q.num</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">exact</span> <span class="n">rat.num_ne_zero_of_ne_zero</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- goals accomplished</span>
<span class="kd">end</span>
</code></pre></div>



<a name="275047296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/275047296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#275047296">(Mar 11 2022 at 23:14)</a>:</h4>
<p>I don't know, but somehow this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">q.num</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span> <span class="c1">-- succeeds</span>
</code></pre></div>



<a name="275047510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/275047510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#275047510">(Mar 11 2022 at 23:16)</a>:</h4>
<p>I think I know how to solve this. <span class="user-mention" data-user-id="282271">@Bolton Bailey</span> do you have other similar cases of failure? I can take a look when I get home.</p>



<a name="275047572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/275047572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#275047572">(Mar 11 2022 at 23:17)</a>:</h4>
<p>I literally just found it, did a double take, and posted it</p>



<a name="275070954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/library_search%20failures/near/275070954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/library_search.20failures.html#275070954">(Mar 12 2022 at 02:11)</a>:</h4>
<p>Done: <a href="https://github.com/leanprover-community/mathlib/pull/12616">#12616</a><br>
This PR  only changes two lines of code in the <code>src/tactic/suggest.lean</code> file. Other 7 lines are for tests.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>