---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/ordered.20monoids.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html">ordered monoids</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="169770164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770164">(Jul 06 2019 at 14:57)</a>:</h4>
<p>Is every canonically ordered monoid automatically cancellative?</p>



<a name="169770165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770165">(Jul 06 2019 at 14:57)</a>:</h4>
<p>Probably not, because it isn't in mathlib.</p>



<a name="169770380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770380">(Jul 06 2019 at 15:02)</a>:</h4>
<p><code>with_top nat</code> is a counterexample</p>



<a name="169770470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770470">(Jul 06 2019 at 15:05)</a>:</h4>
<p>Aha, thanks</p>



<a name="169770472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770472">(Jul 06 2019 at 15:05)</a>:</h4>
<p>No it isn't</p>



<a name="169770477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770477">(Jul 06 2019 at 15:05)</a>:</h4>
<p>Why not?</p>



<a name="169770478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770478">(Jul 06 2019 at 15:05)</a>:</h4>
<p><code>fin n</code> with saturating addition is a counterexample</p>



<a name="169770530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770530">(Jul 06 2019 at 15:06)</a>:</h4>
<p>Sorry it is.</p>



<a name="169770589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770589">(Jul 06 2019 at 15:08)</a>:</h4>
<p>There isn't really anything in the definition that looks like a cancellation law. Notice that <code>lt_of_add_lt_add_left</code> is just the contrapositive of <code>add_le_add_left</code> for total orders</p>



<a name="169770596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770596">(Jul 06 2019 at 15:08)</a>:</h4>
<p>Ok, thanks</p>



<a name="169770659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770659">(Jul 06 2019 at 15:10)</a>:</h4>
<p>The comment for <code>ordered_comm_monoid</code> is a lie</p>



<a name="169770676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169770676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169770676">(Jul 06 2019 at 15:11)</a>:</h4>
<p>I think it is trying to describe <code>ordered_cancel_comm_monoid</code></p>



<a name="169771765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169771765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169771765">(Jul 06 2019 at 15:46)</a>:</h4>
<p>Right... I guess that might have added to the confusion for me.</p>



<a name="169771773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169771773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169771773">(Jul 06 2019 at 15:46)</a>:</h4>
<p>Does it make sense to have a <code>canonically_ordered_cancel_monoid</code>?</p>



<a name="169772017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169772017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169772017">(Jul 06 2019 at 15:54)</a>:</h4>
<p>I guess this is not provable:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">[</span><span class="n">canonically_ordered_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">ordered_comm_monoid</span> <span class="o">(</span><span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
</pre></div>



<a name="169772019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169772019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169772019">(Jul 06 2019 at 15:54)</a>:</h4>
<p>You need the cancellative thing</p>



<a name="169777878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169777878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169777878">(Jul 06 2019 at 18:42)</a>:</h4>
<p>Talking of canonically ordered monoids,</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">canonically_ordered_monoid</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">ordered_comm_monoid</span> <span class="n">α</span><span class="o">,</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">order_bot</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_iff_exists_add</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">a</span> <span class="n">b</span><span class="o">:</span><span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">↔</span> <span class="bp">∃</span><span class="n">c</span><span class="o">,</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span>
</pre></div>


<p>it occurred to me yesterday that this <code>le_iff_exists_add</code> axiom implies that that <code>0 ≤ b</code> for all <code>b</code>, which makes it surprising that Lean asks for the <code>lattice.order_bot</code>structure; it could be generated automatically, because one can prove that bot must be 0 from the other stuff.</p>



<a name="169777958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169777958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169777958">(Jul 06 2019 at 18:44)</a>:</h4>
<p>I guess that I'm saying that instead of <code>canonically_ordered_monoid</code> extending <code>lattice.order_bot</code> it should not mention it at all, and then there should just be an instance making a lattice.order_bot from a canonically ordered monoid.</p>



<a name="169777973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169777973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169777973">(Jul 06 2019 at 18:45)</a>:</h4>
<p>That's true, but you still want the structure to have both a bot and a zero. What if the structure already has a bot and a zero? Granted it's pretty unlikely that they are not defeq, but this definition permits it</p>



<a name="169778035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778035">(Jul 06 2019 at 18:47)</a>:</h4>
<p>In any case I don't think that would be a very good instance - it is a kind of cross cutting thing, it will cause typeclass inference to get more complicated</p>



<a name="169778039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778039">(Jul 06 2019 at 18:47)</a>:</h4>
<p>Then again, it's already an instance with this definition <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="169778093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778093">(Jul 06 2019 at 18:49)</a>:</h4>
<p>So it seems to me that it should be like the lt in a preorder: <code>canonically_ordered_monoid</code> should not extend <code>lattice.order_bot</code> but it should ask for three fields, <code>le_iff_exists_add</code> and then <code>bot</code> but with the <code>:=</code> thing so that the user can define it if they want but if they don't it defaults to <code>zero</code>, and then a tactic can autogenerate <code>bot_le</code> if the user wants it to.</p>



<a name="169778225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778225">(Jul 06 2019 at 18:53)</a>:</h4>
<p>it is already doing basically that</p>



<a name="169778231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778231">(Jul 06 2019 at 18:53)</a>:</h4>
<p>You can stick <code>(bot := 0)</code> at the end and I think it will work</p>



<a name="169778373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778373">(Jul 06 2019 at 18:57)</a>:</h4>
<blockquote>
<p>it is already doing basically that</p>
</blockquote>
<p>It's not, at least in the sense that if I write this:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">:</span> <span class="n">canonically_ordered_comm_semiring</span> <span class="n">mynat</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">+</span><span class="o">),</span>
  <span class="n">add_assoc</span> <span class="o">:=</span> <span class="n">add_assoc</span><span class="o">,</span>
  <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">zero_add</span> <span class="o">:=</span> <span class="n">zero_add</span><span class="o">,</span>
  <span class="n">add_zero</span> <span class="o">:=</span> <span class="n">add_zero</span><span class="o">,</span>
  <span class="n">add_comm</span> <span class="o">:=</span> <span class="n">add_comm</span><span class="o">,</span>
  <span class="n">le</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">≤</span><span class="o">),</span>
  <span class="n">le_refl</span> <span class="o">:=</span> <span class="n">le_refl</span><span class="o">,</span>
  <span class="n">le_trans</span> <span class="o">:=</span> <span class="n">le_trans</span><span class="o">,</span>
  <span class="n">le_antisymm</span> <span class="o">:=</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="n">add_le_add_left</span> <span class="o">:=</span> <span class="n">add_le_add_left</span><span class="o">,</span>
  <span class="n">lt_of_add_lt_add_left</span> <span class="o">:=</span> <span class="n">lt_of_add_lt_add_left</span><span class="o">,</span>
<span class="c1">--  bot := ⊥,</span>
<span class="c1">--  bot_le := bot_le,</span>
  <span class="n">le_iff_exists_add</span> <span class="o">:=</span> <span class="n">le_iff_exists_add</span><span class="o">,</span>
  <span class="n">mul</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">*</span><span class="o">),</span>
  <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="n">mul_assoc</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">one_mul</span> <span class="o">:=</span> <span class="n">one_mul</span><span class="o">,</span>
  <span class="n">mul_one</span> <span class="o">:=</span> <span class="n">mul_one</span><span class="o">,</span>
  <span class="n">left_distrib</span> <span class="o">:=</span> <span class="n">left_distrib</span><span class="o">,</span>
  <span class="n">right_distrib</span> <span class="o">:=</span> <span class="n">right_distrib</span><span class="o">,</span>
  <span class="n">zero_mul</span> <span class="o">:=</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="n">mul_zero</span> <span class="o">:=</span> <span class="n">mul_zero</span><span class="o">,</span>
  <span class="n">mul_comm</span> <span class="o">:=</span> <span class="n">mul_comm</span><span class="o">,</span>
  <span class="n">zero_ne_one</span> <span class="o">:=</span> <span class="n">zero_ne_one</span><span class="o">,</span>
  <span class="n">mul_eq_zero_iff</span> <span class="o">:=</span> <span class="n">mul_eq_zero_iff</span> <span class="o">}</span>
</pre></div>


<p>then, unsurprisingly, it says</p>
<div class="codehilite"><pre><span></span>invalid structure value { ... }, field &#39;bot&#39; was not provided
invalid structure value { ... }, field &#39;bot_le&#39; was not provided
</pre></div>



<a name="169778419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778419">(Jul 06 2019 at 18:58)</a>:</h4>
<p>I don't want my player to have to worry about bot. I might just make another constructor.</p>



<a name="169778436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778436">(Jul 06 2019 at 18:59)</a>:</h4>
<p>I mean stick <code>(bot := 0)</code> in <code>canonically_ordered_monoid</code></p>



<a name="169778514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778514">(Jul 06 2019 at 19:01)</a>:</h4>
<p>I think having a custom constructor would solve a lot of problems, but lean magic only works on the builtin constructor which makes this unattractive</p>



<a name="169778561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778561">(Jul 06 2019 at 19:02)</a>:</h4>
<p>lean magic includes <code>i_just_proved_all_teh_theorems</code> or whatever it's called now (<code>structure_helper</code> I think)</p>



<a name="169778580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778580">(Jul 06 2019 at 19:03)</a>:</h4>
<p>One way to recover the structure notation is to have an auxiliary class with the arguments. <code>nonneg_comm_group</code> was my attempt at this, but I think in practice it ends up just being one more class in the hierarchy</p>



<a name="169778841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169778841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169778841">(Jul 06 2019 at 19:11)</a>:</h4>
<blockquote>
<p>I mean stick <code>(bot := 0)</code> in <code>canonically_ordered_monoid</code></p>
</blockquote>
<p>In <code>preorder</code> we see</p>
<div class="codehilite"><pre><span></span><span class="o">(</span><span class="n">lt</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt_iff_le_not_le</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">↔</span> <span class="o">(</span><span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="bp">.</span> <span class="n">order_laws_tac</span><span class="o">)</span>
</pre></div>


<p>So the question is how to prove <code>bot_le</code>;  I can't even right click on <code>order_laws_tac</code> to see what it's doing.</p>



<a name="169779588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169779588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169779588">(Jul 06 2019 at 19:35)</a>:</h4>
<p>If clicking doesn't work you can always put it somewhere else, i.e. <code>#print order_laws_tac</code> and then click on it there</p>



<a name="169779592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/169779592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#169779592">(Jul 06 2019 at 19:35)</a>:</h4>
<p>it's basically <code>exact rfl</code></p>



<a name="195944387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195944387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195944387">(May 01 2020 at 09:29)</a>:</h4>
<p>Ordered monoids are a big mess, I think. They are partly "locked" into core. Lots of lemmas are duplicated. In core we don't have the <code>to_additive</code> machinery. Sometimes assumptions are unnecessary. Etc...</p>
<p>It would be a big relief if this could be moved out of core and into mathlib. Is this at all an option? core probably needs that <code>nat</code> is an example of an ordered additive commutative monoid. But does that mean we need the general class in core?</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- in core</span>
<span class="n">class</span> <span class="n">ordered_cancel_add_comm_monoid</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
      <span class="kn">extends</span> <span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">,</span> <span class="n">add_left_cancel_semigroup</span> <span class="n">α</span><span class="o">,</span>
              <span class="n">add_right_cancel_semigroup</span> <span class="n">α</span><span class="o">,</span> <span class="n">partial_order</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_le_add_left</span>       <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">le_of_add_le_add_left</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span>

<span class="c1">-- #####################</span>

<span class="c1">-- in mathlib (on a local branch)</span>
<span class="c">/-</span><span class="cm">- An ordered (additive) commutative monoid is a commutative monoid</span>
<span class="cm">  with a partial order such that addition is an order embedding, i.e.</span>
<span class="cm">  `a + b ≤ a + c ↔ b ≤ c`. These monoids are automatically cancellative. -/</span>
<span class="n">class</span> <span class="n">ordered_add_comm_monoid</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">add_comm_monoid</span> <span class="n">α</span><span class="o">,</span> <span class="n">partial_order</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_le_add_left</span>       <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt_of_add_lt_add_left</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">&lt;</span> <span class="n">c</span><span class="o">)</span>

<span class="c">/-</span><span class="cm">- An ordered commutative monoid is a commutative monoid</span>
<span class="cm">  with a partial order such that addition is an order embedding, i.e.</span>
<span class="cm">  `a * b ≤ a * c ↔ b ≤ c`. These monoids are automatically cancellative. -/</span>
<span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">ordered_add_comm_monoid</span><span class="o">]</span>
<span class="n">class</span> <span class="n">ordered_comm_monoid</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">comm_monoid</span> <span class="n">α</span><span class="o">,</span> <span class="n">partial_order</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mul_le_mul_left</span>       <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">lt_of_mul_lt_mul_left</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">&lt;</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">&lt;</span> <span class="n">c</span><span class="o">)</span>
</code></pre></div>



<a name="195959388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959388">(May 01 2020 at 13:13)</a>:</h4>
<p>Without <code>to_additive</code> I fear that the multiplicative and additive versions will diverge, which doesn't seem like a good idea.<br>
Moving <code>to_additive</code> into core would be one option. But I don't really like that idea, because it will become harder to change it...</p>



<a name="195959462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959462">(May 01 2020 at 13:14)</a>:</h4>
<p>It actually was in core once</p>



<a name="195959474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959474">(May 01 2020 at 13:14)</a>:</h4>
<p>Therefore I would very much prefer moving these classes out of core and into mathlib...</p>



<a name="195959482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959482">(May 01 2020 at 13:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/ordered.20monoids/near/195959462" title="#narrow/stream/113488-general/topic/ordered.20monoids/near/195959462">said</a>:</p>
<blockquote>
<p>It actually was in core once</p>
</blockquote>
<p>I guess it was moved out of it for a reason (-;</p>



<a name="195959542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959542">(May 01 2020 at 13:15)</a>:</h4>
<p>at least, a kind of crappy version of it was, and I wrote the current version and PR'd it, and Leo said no, so there is now a massive workaround in <code>algebra.group</code> to fix all the attributes that should be in core</p>



<a name="195959645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959645">(May 01 2020 at 13:16)</a>:</h4>
<p>Why does core need <code>int</code> again? Shouldn't <code>nat</code> be enough?</p>



<a name="195959655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959655">(May 01 2020 at 13:16)</a>:</h4>
<p>it has special VM support</p>



<a name="195959660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959660">(May 01 2020 at 13:16)</a>:</h4>
<p>I see.</p>



<a name="195959673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959673">(May 01 2020 at 13:16)</a>:</h4>
<p>And why does it need lemmas about <code>nat</code> and <code>int</code>?</p>



<a name="195959695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959695">(May 01 2020 at 13:17)</a>:</h4>
<p>Or would it be enough if it knew <code>has_add nat</code>?</p>



<a name="195959698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959698">(May 01 2020 at 13:17)</a>:</h4>
<p>etc..</p>



<a name="195959702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959702">(May 01 2020 at 13:17)</a>:</h4>
<p>It doesn't, I think</p>



<a name="195959739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959739">(May 01 2020 at 13:17)</a>:</h4>
<p>At least, I can't think of a reason off hand</p>



<a name="195959749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959749">(May 01 2020 at 13:17)</a>:</h4>
<p>So... could we move almost all of the algebraic hierarchy out of core?</p>



<a name="195959803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959803">(May 01 2020 at 13:18)</a>:</h4>
<p>Or does <code>norm_num</code> need them?</p>



<a name="195959808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959808">(May 01 2020 at 13:18)</a>:</h4>
<p>we don't need <code>ring int</code> in core, but we do need <code>ring</code> and <code>int</code> in core</p>



<a name="195959821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959821">(May 01 2020 at 13:18)</a>:</h4>
<p>Why <code>ring</code>?</p>



<a name="195959832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959832">(May 01 2020 at 13:18)</a>:</h4>
<p>because it is used by <code>norm_num</code> lemmas</p>



<a name="195959853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959853">(May 01 2020 at 13:18)</a>:</h4>
<p>How many lemmas does <code>norm_num</code> need?</p>



<a name="195959872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959872">(May 01 2020 at 13:19)</a>:</h4>
<p>several, but they are all quite basic</p>



<a name="195959888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195959888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195959888">(May 01 2020 at 13:19)</a>:</h4>
<p>and purpose built</p>



<a name="195960000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960000">(May 01 2020 at 13:20)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/master/library/init/algebra/norm_num.lean" title="https://github.com/leanprover-community/lean/blob/master/library/init/algebra/norm_num.lean">https://github.com/leanprover-community/lean/blob/master/library/init/algebra/norm_num.lean</a></p>



<a name="195960108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960108">(May 01 2020 at 13:22)</a>:</h4>
<p>Hmm... so it wants to know about <code>ordered_ring</code>s... that doesn't sound good.</p>



<a name="195960148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960148">(May 01 2020 at 13:22)</a>:</h4>
<p>it wants to know an unbounded number of things about number theoretic functions, which is why <code>norm_num</code> in mathlib is so large</p>



<a name="195960170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960170">(May 01 2020 at 13:23)</a>:</h4>
<p>it's easy to scale back and move things around there</p>



<a name="195960218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960218">(May 01 2020 at 13:23)</a>:</h4>
<p>there is an open issue in my head to rewrite <code>tactic.norm_num</code> in lean</p>



<a name="195960228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960228">(May 01 2020 at 13:23)</a>:</h4>
<p>So... are there parts that could move to mathlib... or is norm_num locking it all up?</p>



<a name="195960275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960275">(May 01 2020 at 13:24)</a>:</h4>
<p>there isn't really any reason to have it in C++ except possibly efficiency</p>



<a name="195960344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960344">(May 01 2020 at 13:25)</a>:</h4>
<p>as far as I know that's about it for algebra in the C++, except for the mysterious <code>@[algebra]</code> attribute</p>



<a name="195960378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960378">(May 01 2020 at 13:25)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/master/library/init/algebra/classes.lean" title="https://github.com/leanprover-community/lean/blob/master/library/init/algebra/classes.lean">https://github.com/leanprover-community/lean/blob/master/library/init/algebra/classes.lean</a></p>



<a name="195960387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960387">(May 01 2020 at 13:25)</a>:</h4>
<p>Hmm... but we want <code>norm_num</code> to be efficient, right?</p>



<a name="195960465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960465">(May 01 2020 at 13:26)</a>:</h4>
<p>It will be pretty efficient even in lean</p>



<a name="195960487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960487">(May 01 2020 at 13:26)</a>:</h4>
<p>this is not the kind of program that benefits greatly from native implementation</p>



<a name="195960526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960526">(May 01 2020 at 13:27)</a>:</h4>
<p>but we will have to do performance tests to see what the damage is</p>



<a name="195960540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960540">(May 01 2020 at 13:27)</a>:</h4>
<p>How much work do you estimate this to be?</p>



<a name="195960629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960629">(May 01 2020 at 13:28)</a>:</h4>
<p>maybe 1/3 of mathlib's <code>norm_num</code></p>



<a name="195960648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960648">(May 01 2020 at 13:29)</a>:</h4>
<p>it's pretty straightforward what needs to be done</p>



<a name="195960668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960668">(May 01 2020 at 13:29)</a>:</h4>
<p>I meant: is this 1 day, 1 week, 1 month?</p>



<a name="195960694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960694">(May 01 2020 at 13:29)</a>:</h4>
<p>1 day? If I actually do it on that day</p>



<a name="195960767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960767">(May 01 2020 at 13:30)</a>:</h4>
<p>What do we need to do to make this issue in your head bubble to the top of your priority queue?</p>



<a name="195960810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960810">(May 01 2020 at 13:31)</a>:</h4>
<p>I think maybe waiting a week or so would help</p>



<a name="195960889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195960889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195960889">(May 01 2020 at 13:32)</a>:</h4>
<p>Because of your current refactor? Or what?</p>



<a name="195963070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963070">(May 01 2020 at 13:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> So... if I leave the definition of <code>ordered_add_comm_monoid</code> in core, do you think I can move almost all lemmas about it to mathlib?</p>



<a name="195963087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963087">(May 01 2020 at 13:57)</a>:</h4>
<p>The lemmas that <code>norm_num</code> needs are all in that file you linked to?</p>



<a name="195963195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963195">(May 01 2020 at 13:58)</a>:</h4>
<p>I believe so</p>



<a name="195963234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963234">(May 01 2020 at 13:59)</a>:</h4>
<p>Ok, maybe that is the easiest way forward. Then I don't have to pester you about norm_num <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="195963256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963256">(May 01 2020 at 13:59)</a>:</h4>
<p>there is an official list of definitions used by the C++</p>



<a name="195963632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963632">(May 01 2020 at 14:03)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/blob/master/src/library/constants.txt" title="https://github.com/leanprover-community/lean/blob/master/src/library/constants.txt">https://github.com/leanprover-community/lean/blob/master/src/library/constants.txt</a></p>



<a name="195963849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963849">(May 01 2020 at 14:05)</a>:</h4>
<p>Oooh cool! That will be helpful!</p>



<a name="195963867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963867">(May 01 2020 at 14:05)</a>:</h4>
<p>Is it transitively closed?</p>



<a name="195963992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195963992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195963992">(May 01 2020 at 14:06)</a>:</h4>
<p>I don't think so</p>



<a name="195964010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195964010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195964010">(May 01 2020 at 14:07)</a>:</h4>
<p>It shouldn't be</p>



<a name="195964039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195964039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195964039">(May 01 2020 at 14:07)</a>:</h4>
<p>these are constants that are directly referenced somewhere in C++</p>



<a name="195964133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195964133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195964133">(May 01 2020 at 14:08)</a>:</h4>
<p>Ok, would you mind writing 20 lines of lean code that will print the transitive closure?</p>



<a name="195964158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195964158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195964158">(May 01 2020 at 14:08)</a>:</h4>
<p>It's probably almost the same as printing all the places a name is used... but not exactly</p>



<a name="195964284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195964284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195964284">(May 01 2020 at 14:10)</a>:</h4>
<p>In the other thread you wrote</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">all</span>

<span class="kn">open</span> <span class="n">tactic</span>
<span class="n">run_cmd</span> <span class="n">do</span>
  <span class="n">env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">:=</span> <span class="n">env</span><span class="bp">.</span><span class="n">fold</span> <span class="n">mk_name_set</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">d</span> <span class="n">t</span><span class="o">,</span>
    <span class="n">d</span><span class="bp">.</span><span class="n">value</span><span class="bp">.</span><span class="n">fold</span> <span class="n">t</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">e</span> <span class="bp">_</span> <span class="n">t</span><span class="o">,</span> <span class="k">match</span> <span class="n">e</span> <span class="k">with</span>
      <span class="bp">|</span> <span class="n">expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">n</span> <span class="o">[]</span> <span class="o">:=</span>
        <span class="k">if</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">`</span><span class="n">with_zero</span><span class="bp">.</span><span class="n">ordered_add_comm_monoid</span> <span class="k">then</span>
          <span class="n">name_set</span><span class="bp">.</span><span class="n">insert</span> <span class="n">t</span> <span class="n">d</span><span class="bp">.</span><span class="n">to_name</span>
        <span class="k">else</span> <span class="n">t</span>
      <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">t</span>
      <span class="kn">end</span><span class="o">),</span>
  <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="n">l</span>
</code></pre></div>



<a name="195964293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195964293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195964293">(May 01 2020 at 14:10)</a>:</h4>
<p>Let me see if I can adapt that code.</p>



<a name="195965364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195965364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195965364">(May 01 2020 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/ordered.20monoids/near/195963256" title="#narrow/stream/113488-general/topic/ordered.20monoids/near/195963256">said</a>:</p>
<blockquote>
<p>there is an official list of definitions used by the C++</p>
</blockquote>
<p>Note that this list is far from exhaustive.  For example, most definitions that are overridden in the VM don't appear there.  Or the definitions necessary for tactics.</p>



<a name="195965690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195965690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195965690">(May 01 2020 at 14:25)</a>:</h4>
<p>So... is there an automated way to figure out which lemmas can be moved to mathlib?</p>



<a name="195968435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/195968435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#195968435">(May 01 2020 at 14:52)</a>:</h4>
<p>I think the list in <code>constants.txt</code> is pretty accurate when it comes to lemmas.  It's just very incomplete for definitions.  However, first we need to excise <code>norm_num</code>.</p>



<a name="196148724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196148724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196148724">(May 04 2020 at 07:34)</a>:</h4>
<p>What do you think about adding a <code>@[magic]</code> attribute (naming TBD) that is required on all definitions or lemmas referenced in C++? It should be possible to check this from the C++ file that <code>constants.txt</code> generates, as well as in <code>DECLARE_VM_BUILTIN</code> and other macros that construct bindings</p>



<a name="196149602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196149602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196149602">(May 04 2020 at 07:45)</a>:</h4>
<p>I'm not enthusiastic.  This sounds like a lot of work.  If it's just about moving stuff to mathlib, the easiest approach is delete-test-move-back.  Tactics written in Lean also reference definitions and lemmas, should these be tagged with magic as well?</p>



<a name="196149747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196149747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196149747">(May 04 2020 at 07:47)</a>:</h4>
<p>no, this is just so that the lean code has a visible marker that its behavior is affected in some way by C++</p>



<a name="196149840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196149840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196149840">(May 04 2020 at 07:48)</a>:</h4>
<p>I really don't like that there is no evidence in the file that <code>nat.add</code> does something different than its definition and <code>mynat.add</code> is mysteriously much worse</p>



<a name="196150047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150047">(May 04 2020 at 07:51)</a>:</h4>
<p>(the answer to the second question is no)</p>



<a name="196150091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150091">(May 04 2020 at 07:51)</a>:</h4>
<p>maybe <code>@[extern_cpp]</code> is a better name</p>



<a name="196150201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150201">(May 04 2020 at 07:53)</a>:</h4>
<p>Agda has something like that; they use the syntax <code>{-# BUILTIN #-}</code>. This allows the standard library to be a separate project from Agda itself (though with Lean's current release cadence, there'd be little benefit to that).</p>



<a name="196150228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150228">(May 04 2020 at 07:53)</a>:</h4>
<p>I don't know of any language that doesn't have some sigil on builtins except lean</p>



<a name="196150235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150235">(May 04 2020 at 07:53)</a>:</h4>
<p>Lean 4 uses <code>@[extern]</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c">/-</span><span class="cm"> Nat basic instances -/</span>
<span class="bp">@</span><span class="o">[</span><span class="n">extern</span> <span class="s2">&quot;lean_nat_add&quot;</span><span class="o">]</span>
<span class="kn">protected</span> <span class="n">def</span> <span class="n">Nat</span><span class="bp">.</span><span class="n">add</span> <span class="o">:</span> <span class="o">(</span><span class="bp">@&amp;</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">@&amp;</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">→</span> <span class="n">Nat</span>
<span class="bp">|</span> <span class="n">a</span><span class="o">,</span> <span class="n">Nat</span><span class="bp">.</span><span class="n">zero</span>   <span class="bp">=&gt;</span> <span class="n">a</span>
<span class="bp">|</span> <span class="n">a</span><span class="o">,</span> <span class="n">Nat</span><span class="bp">.</span><span class="n">succ</span> <span class="n">b</span> <span class="bp">=&gt;</span> <span class="n">Nat</span><span class="bp">.</span><span class="n">succ</span> <span class="o">(</span><span class="n">Nat</span><span class="bp">.</span><span class="n">add</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>


<p>I'd be oke with moving closer to Lean 4.</p>



<a name="196150312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150312">(May 04 2020 at 07:54)</a>:</h4>
<p>although I am also interested in extending this beyond just VM builtins to things like lemmas with external linkage to C++</p>



<a name="196150342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150342">(May 04 2020 at 07:55)</a>:</h4>
<p>perhaps that should be a separate attribute</p>



<a name="196150435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150435">(May 04 2020 at 07:56)</a>:</h4>
<p>I don't know whether it is necessary or useful to put the C++ name of the extern function in the attribute. Unlike lean 4, you can't really use those names to call the function in lean 3</p>



<a name="196150467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150467">(May 04 2020 at 07:56)</a>:</h4>
<p>so you would still need the <code>DECLARE_VM_BUILTIN</code> macro, and the best you could do is double check that the names declared in both places match</p>



<a name="196150474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150474">(May 04 2020 at 07:57)</a>:</h4>
<p>I think <code>@[extern]</code> without c++ function name would be fine.</p>



<a name="196150876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196150876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196150876">(May 04 2020 at 08:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="256311">Jannis Limperg</span> <a href="#narrow/stream/113488-general/topic/ordered.20monoids/near/196150201" title="#narrow/stream/113488-general/topic/ordered.20monoids/near/196150201">said</a>:</p>
<blockquote>
<p>Agda has something like that; they use the syntax <code>{-# BUILTIN #-}</code>. This allows the standard library to be a separate project from Agda itself (though with Lean's current release cadence, there'd be little benefit to that).</p>
</blockquote>
<p>Well, there seems to be good reason to move core theorems and definitions to mathlib. I think the main blocker to moving builtins out of core is that it would break the tests. How does Agda do tests?</p>



<a name="196153637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ordered%20monoids/near/196153637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ordered.20monoids.html#196153637">(May 04 2020 at 08:31)</a>:</h4>
<p>I don't know the codebase too well, but from what I recall, the Agda setup is this: Agda ships with a super minimal 'builtin library' containing only the builtins. The tests import these and define a few other things in a 'test standard library'. The real standard library that users work with also imports the builtins and builds on them. One could probably also ignore the builtin library completely, instead binding the builtins manually, but I don't know why one would.</p>
<p>With that said, Agda has way less builtins than Lean, so the ergonomics are probably different.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>