---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/tree-sitter.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html">tree-sitter</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="221264341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221264341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221264341">(Dec 31 2020 at 02:35)</a>:</h4>
<p>In case it's not already on the radar... tree-sitter (<a href="https://tree-sitter.github.io/tree-sitter/">https://tree-sitter.github.io/tree-sitter/</a> -- a nice incremental parsing library with lots of nice editor integrations) looks like it has some folks who put together an Agda parser: <a href="https://github.com/tree-sitter/tree-sitter-agda">https://github.com/tree-sitter/tree-sitter-agda</a> -- perhaps that's interesting to have some day for lean (4)?</p>



<a name="221264523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221264523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221264523">(Dec 31 2020 at 02:39)</a>:</h4>
<p>One cool reason to do this is that tree-sitter grammars are used for <a href="https://github.com/github/semantic">https://github.com/github/semantic</a> which is what gives the cool jump to definition/references feature you can see on github python repos. Having this for lean would be awesome, but of course a long way away</p>



<a name="221266361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221266361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221266361">(Dec 31 2020 at 03:27)</a>:</h4>
<p>I wrote tree-sitter grammars for mm0 and mm1 to try some stuff out; it's not too bad if you have something like an EBNF spec for the grammar.</p>



<a name="221266610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221266610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221266610">(Dec 31 2020 at 03:33)</a>:</h4>
<p>I think you kind of need the people doing the editor support on board though. If they already have their own model/abstractions for building and working on the AST, they probably won't want to graft the tree-sitter one on as a totally separate thing.</p>



<a name="221266683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221266683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221266683">(Dec 31 2020 at 03:35)</a>:</h4>
<p>That's what re-reminded me to mention tree-sitter yeah (I was about to fix a syntax issue in lean.vim and wished I didn't have to :D)</p>



<a name="221266901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221266901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221266901">(Dec 31 2020 at 03:40)</a>:</h4>
<p>The in-progress Lean 4 server seems to be <a href="https://github.com/leanprover/lean4/tree/master/src/Lean/Server">here</a>.</p>



<a name="221270744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221270744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221270744">(Dec 31 2020 at 05:23)</a>:</h4>
<p>Isn't this going to be hard/impossible for Lean 4, because it has such an extremely flexible syntax? You basically need to be Lean 4 to be able to parse the code.</p>



<a name="221297201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221297201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221297201">(Dec 31 2020 at 15:40)</a>:</h4>
<p>I'm not sure how v4 actually handles user-declared syntax extensions. If they're initially parsed generically as something like "user item" according to a set of rules and elaborated later then it should be possible for outside parsers to produce a usable AST. If users are able to arbitrarily add entirely new rules to the grammar then you're probably right.</p>



<a name="221297609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/221297609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#221297609">(Dec 31 2020 at 15:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/tree-sitter/near/221270744">said</a>:</p>
<blockquote>
<p>You basically need to be Lean 4 to be able to parse the code.</p>
</blockquote>
<p>This has already been true with Lean 3, custom syntax will just become more prevalent with Lean 4. The best you could probably do is to generate a tree-sitter grammar for a fixed set of syntax extensions. Whitespace sensitivity sounds like <a href="https://github.com/tree-sitter/tree-sitter/issues/219">fun</a> though.</p>



<a name="228135366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tree-sitter/near/228135366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/tree-sitter.html#228135366">(Feb 28 2021 at 14:59)</a>:</h4>
<p>I stubbornly tried to start doing this. What I have so far lives here: <a href="https://github.com/Julian/tree-sitter-lean">https://github.com/Julian/tree-sitter-lean</a></p>
<p>It's got many flaws, just trying to get a decent amount of coverage before doing any of the real difficult parts, but I can already use it for better syntax highlighting in my editor than what I had before.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>