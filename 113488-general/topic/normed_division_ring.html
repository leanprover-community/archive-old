---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/normed_division_ring.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html">normed_division_ring</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="272372535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272372535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272372535">(Feb 18 2022 at 08:18)</a>:</h4>
<p>I think I have a problem because mathlib doesn't have  a <code>normed_division_ring</code>, but I'm not sure. I think I reduced my problem to the following:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>problem</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.normed_space.basic</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">division_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">problem</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_unit</span> <span class="n">r</span> <span class="o">:=</span>
<span class="o">(</span><span class="bp">@</span><span class="n">is_unit_iff_ne_zero</span> <span class="n">R</span> <span class="n">_</span> <span class="n">r</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">h</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at application</span>
<span class="cm">  is_unit_iff_ne_zero.mpr h</span>
<span class="cm">term</span>
<span class="cm">  h</span>
<span class="cm">has type</span>
<span class="cm">  r ≠ 0</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  r ≠ 0</span>
<span class="cm">Additional information:</span>
<span class="cm">context: switched to simple application elaboration procedure because failed to use expected type to elaborate it, error message</span>
<span class="cm">  type mismatch, term</span>
<span class="cm">    is_unit_iff_ne_zero.mpr ?m_1</span>
<span class="cm">  has type</span>
<span class="cm">    @is_unit R</span>
<span class="cm">      (@monoid_with_zero.to_monoid R</span>
<span class="cm">         (@group_with_zero.to_monoid_with_zero R (@division_ring.to_group_with_zero R _inst_1)))</span>
<span class="cm">      r</span>
<span class="cm">  but is expected to have type</span>
<span class="cm">    @is_unit R (@ring.to_monoid R (@normed_ring.to_ring R _inst_2)) r</span>
<span class="cm">-/</span>
</code></pre></div>
</div></div>
<p>If I understand the error message correctly, the problem is that the term I constructed is a unit in the monoid coming from the fact that <code>R</code> is a <code>division_ring</code>, but it was expecting a unit in the monoid coming form the fact that <code>R</code> is a <code>normed_ring</code>.</p>
<ol>
<li>Did I interpret correctly?</li>
<li>I really do need both hypotheses as I am trying to define the Gelfand-Mazur isomorphism</li>
<li>How do I deal with this?</li>
</ol>



<a name="272372812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272372812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272372812">(Feb 18 2022 at 08:22)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/division_ring">docs#division_ring</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/normed_ring">docs#normed_ring</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/is_field">docs#is_field</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/is_division_ring">docs#is_division_ring</a> (sorry, on mobile!)</p>



<a name="272372922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272372922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272372922">(Feb 18 2022 at 08:24)</a>:</h4>
<p>Doing <code>convert (@is_unit_iff_ne_zero _ _ r).mpr _</code> produces a goal of</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">R</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span>
<span class="n">_inst_1</span><span class="o">:</span> <span class="n">division_ring</span> <span class="n">R</span>
<span class="n">_inst_2</span><span class="o">:</span> <span class="n">normed_ring</span> <span class="n">R</span>
<span class="n">r</span><span class="o">:</span> <span class="n">R</span>
<span class="n">h</span><span class="o">:</span> <span class="n">r</span> <span class="bp">≠</span> <span class="mi">0</span>
<span class="bp">⊢</span> <span class="n">ring.to_monoid</span> <span class="n">R</span> <span class="bp">=</span> <span class="n">monoid_with_zero.to_monoid</span> <span class="n">R</span>
</code></pre></div>
<p>Maybe this means that there are issues with going from ring to monoid?  I do not really know whether this is a diamond or not...</p>



<a name="272373020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272373020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272373020">(Feb 18 2022 at 08:25)</a>:</h4>
<p>(deleted)</p>



<a name="272373149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272373149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272373149">(Feb 18 2022 at 08:27)</a>:</h4>
<p><code>is_field</code> is an example, which is there, but if your ring is not commutative you'll need <code>is_division_ring</code> which is not, but which should be easy to add (just copy <code>is_field</code> and drop stuff)</p>



<a name="272373259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272373259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272373259">(Feb 18 2022 at 08:28)</a>:</h4>
<p>Aargh on mobile, accidentally just deleted post saying "it's not a diamond, you do indeed have two ring structures, fix it with a mixin"</p>



<a name="272373305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272373305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272373305">(Feb 18 2022 at 08:29)</a>:</h4>
<p>Kevin said:<br>
So yeah you're right -- division_ring R puts a ring structure on R and normed_ring R puts a different ring structure on it (so it's not diamond). You'll have to use what I think they call a Prop-valued mixin.</p>



<a name="272373319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272373319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272373319">(Feb 18 2022 at 08:29)</a>:</h4>
<p>(Kevin, I hope that you wanted to actually recover what you had said!)</p>



<a name="272374352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272374352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272374352">(Feb 18 2022 at 08:41)</a>:</h4>
<p>I think there's a problem with this idea, namely, <code>is_division_ring</code> can't just be Prop-valued mixin because <code>division_ring</code> needs an <code>inv</code> and <code>div</code>, whereas rings don't have this. <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="272374516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272374516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272374516">(Feb 18 2022 at 08:42)</a>:</h4>
<p>(and yes, my rings are noncommutative, until they aren't via the isomorphism)</p>



<a name="272374564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272374564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272374564">(Feb 18 2022 at 08:43)</a>:</h4>
<p>I have not looked at this much, so I might be wrong, but <code>is_field</code> also takes a ring and produces something with inverses.  Does asserting the existence of a left/right inverse (without using the \inv notation, simply an element of the ring) not work for <code>division_ring</code> as well?</p>



<a name="272374638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272374638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272374638">(Feb 18 2022 at 08:43)</a>:</h4>
<p>ah, good point, let me check out <a href="https://leanprover-community.github.io/mathlib_docs/find/is_field.to_field">docs#is_field.to_field</a></p>



<a name="272374779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272374779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272374779">(Feb 18 2022 at 08:45)</a>:</h4>
<p>It's noncomputable but that's where the data is added</p>



<a name="272374957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272374957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272374957">(Feb 18 2022 at 08:46)</a>:</h4>
<p>If I truly cared about computability, I don't know how I could have ended up in functional analysis. <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="272378425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272378425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272378425">(Feb 18 2022 at 09:24)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/division_ring_of_is_unit_or_eq_zero">docs#division_ring_of_is_unit_or_eq_zero</a></p>



<a name="272379672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272379672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272379672">(Feb 18 2022 at 09:38)</a>:</h4>
<p>So, I guess I don't understand how to actually use this. If I have a ring, and I have a Prop-valued mixin for division ring, how do I conclude some <code>group_with_zero</code> property? Because if I use <code>haveI</code> to construct my division ring, then I'm just back where I started (with 2 ring structures), but without the division ring type class instance, how do I get Lean to recognize the <code>group_with_zero</code> instance so I can use <code>is_unit_iff_ne_zero</code>?</p>



<a name="272379867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272379867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272379867">(Feb 18 2022 at 09:40)</a>:</h4>
<p>If you use <code>letI</code>, then the two instances should be definitionally equal</p>



<a name="272379893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272379893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272379893">(Feb 18 2022 at 09:41)</a>:</h4>
<p>(<code>have</code> and <code>haveI</code> forget the definition of the new hypothesis, <code>let</code> and <code>letI</code> preserve it)</p>



<a name="272379901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272379901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272379901">(Feb 18 2022 at 09:41)</a>:</h4>
<p>ah, of course, it's data. Stupid me.</p>



<a name="272390693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272390693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272390693">(Feb 18 2022 at 11:33)</a>:</h4>
<p>This is a highly non-mathematical issue which took me some time to get used to! This even goes back to the definition of group -- we often write the definition as "a group is a set plus a multiplication plus some axioms" and the axioms imply "there exists a unique identity" so the mathematicians say "let's now call it <code>1</code>" and I think that in ZFC there is no issue here but for Lean some magic has to occur to get the data from the prop, so instead of invoking magic all the time they just add 1 to the data in the definition -- and then we end up with both <code>field</code> and <code>is_field</code> etc etc. In some sense I'm surprised we don't have an <code>is_group</code> predicate on monoids -- perhaps the reason we don't is that in practice either the monoids we have are obviously not groups or obviously groups?</p>



<a name="272391220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272391220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272391220">(Feb 18 2022 at 11:39)</a>:</h4>
<p>Since I don't see it mentioned here, another solution here is just "define <code>normed_division_ring</code> in the obvious way". Chances are we don't have it yet because no one needed it</p>



<a name="272391308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272391308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272391308">(Feb 18 2022 at 11:40)</a>:</h4>
<p>One reason why <code>is_field</code> is useful is that it allows you express "this ring structure is not a field"; <code>is_empty (field α)</code> means something quite different to <code>¬is_field α</code>, and only the latter really expresses something mathematically interesting.</p>



<a name="272395209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272395209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272395209">(Feb 18 2022 at 12:26)</a>:</h4>
<p>not to diminish the point, but <code>is_empty (field α)</code> (or better, <code>nonempty (field α)</code>) is slightly mathematically interesting: it's a cardinality constraint which I believe is true iff <code>#α</code> is either a prime power or an infinite cardinal</p>



<a name="272395257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272395257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272395257">(Feb 18 2022 at 12:27)</a>:</h4>
<p>I'm not sure we have that proved though (maybe we know the first part?)</p>



<a name="272395358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272395358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272395358">(Feb 18 2022 at 12:28)</a>:</h4>
<p>come to think of it, do we have the existence of prime power fields? A computable definition would be extra cool</p>



<a name="272395752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272395752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272395752">(Feb 18 2022 at 12:32)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/galois_field">docs#galois_field</a></p>



<a name="272395793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272395793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272395793">(Feb 18 2022 at 12:33)</a>:</h4>
<p>seems to not be constructive</p>



<a name="272395802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272395802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272395802">(Feb 18 2022 at 12:33)</a>:</h4>
<p>(for the infinite case I think it's quite accessible from current mathlib: you use the fraction field of <code>mv_polynomial α ℚ</code>)</p>



<a name="272405952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272405952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272405952">(Feb 18 2022 at 14:11)</a>:</h4>
<p>i've just finished the finite case:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.finite.galois_field</span>
<span class="kn">import</span> <span class="n">algebra.is_prime_pow</span>
<span class="kn">import</span> <span class="n">data.equiv.transfer_instance</span>

<span class="kn">local</span> <span class="kd">notation</span> <span class="bp">`‖`</span> <span class="n">x</span> <span class="bp">`‖`</span> <span class="o">:=</span> <span class="n">fintype.card</span> <span class="n">x</span>

<span class="kd">lemma</span> <span class="n">nat.prime.is_prime_pow</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p.prime</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_prime_pow</span> <span class="n">p</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">is_prime_pow_nat_iff</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">⟨</span><span class="n">p</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">hp</span><span class="o">,</span> <span class="n">one_pos</span><span class="o">,</span> <span class="n">pow_one</span> <span class="n">p</span><span class="o">⟩</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="o">(</span><span class="n">field</span> <span class="n">α</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">is_prime_pow</span> <span class="o">(</span><span class="n">fintype.card</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="n">swap</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintros</span> <span class="o">⟨</span><span class="n">p</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">hp</span><span class="o">,</span> <span class="n">hn</span><span class="o">,</span> <span class="n">hα</span><span class="o">⟩,</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="n">fact.mk</span> <span class="o">(</span><span class="n">nat.prime_iff.mpr</span> <span class="n">hp</span><span class="o">),</span>
    <span class="n">exact</span> <span class="o">⟨(</span><span class="n">fintype.equiv_of_card_eq</span> <span class="o">((</span><span class="n">galois_field.card</span> <span class="n">p</span> <span class="n">n</span> <span class="n">hn.ne'</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="n">hα</span><span class="o">))</span><span class="bp">.</span><span class="n">symm.field</span><span class="o">⟩</span> <span class="o">},</span>
  <span class="n">rintro</span> <span class="o">⟨</span><span class="n">h</span><span class="o">⟩,</span>
  <span class="n">casesI</span> <span class="n">char_p.exists</span> <span class="n">α</span> <span class="k">with</span> <span class="n">p</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">haveI</span> <span class="n">hp</span> <span class="o">:=</span> <span class="n">fact.mk</span> <span class="o">(</span><span class="n">char_p.char_is_prime</span> <span class="n">α</span> <span class="n">p</span><span class="o">),</span>
  <span class="k">let</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">is_noetherian.finset_basis</span> <span class="o">(</span><span class="n">zmod</span> <span class="n">p</span><span class="o">)</span> <span class="n">α</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">module.card_fintype</span> <span class="n">b</span><span class="o">,</span> <span class="n">zmod.card</span><span class="o">,</span> <span class="n">is_prime_pow_pow_iff</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">hp.1.is_prime_pow</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">←</span><span class="n">finite_dimensional.finrank_eq_card_basis</span> <span class="n">b</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">finite_dimensional.finrank_pos.ne'</span>
<span class="kd">end</span>
</code></pre></div>
<p>I don't see the equiv <code>α ≃ fraction_ring (mv_polynomial α ℚ)</code>; how do you make it?</p>



<a name="272406008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272406008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272406008">(Feb 18 2022 at 14:12)</a>:</h4>
<p>sorry, we should probably move this to another thread</p>



<a name="272407669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272407669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272407669">(Feb 18 2022 at 14:25)</a>:</h4>
<p>you probably need some facts about cardinal of mv_polynomial (<a href="https://tqft.net/mathlib/data/mv_polynomial/cardinal">file#data/mv_polynomial/cardinal</a>) and fraction_ring (not sure we have those)</p>



<a name="272407904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272407904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272407904">(Feb 18 2022 at 14:27)</a>:</h4>
<p>I guess using that the localization map is surjective it shouldn't be too hard to get those?</p>



<a name="272408703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272408703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272408703">(Feb 18 2022 at 14:34)</a>:</h4>
<p>I guess you need facts about cardinality of finsupp too. Would be a nice Friday afternoon exercise!</p>



<a name="272409282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272409282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272409282">(Feb 18 2022 at 14:40)</a>:</h4>
<p>so do we want <code>is_division_ring</code> as a mix in, or do we just wanted to define a <code>normed_division_ring</code>? Tossing around the hypothesis <code>(h : ∀ b : A, is_unit b ∨ b = 0)</code> for everything related to Gelfand-Mazur is just silly. See here for the mixin version (you must be on the <code>j-loreaux/spectrum-nonempty</code> branch for the second half of this to compile):</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.normed_space.spectrum</span>

<span class="kd">universe</span> <span class="n">u</span>

<span class="kn">section</span> <span class="n">division_ring</span> <span class="c1">-- goes in `algebra.field.basic`</span>

<span class="n">open_locale</span> <span class="n">classical</span>

<span class="sd">/-- A predicate to express that a ring is a division ring.</span>
<span class="sd">This is mainly useful because such a predicate does not contain data,</span>
<span class="sd">and can therefore be easily transported along ring isomorphisms.</span>
<span class="sd">Additionaly, this is useful when trying to prove that</span>
<span class="sd">a particular ring structure extends to a division ring. -/</span>
<span class="kd">structure</span> <span class="n">is_division_ring</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">exists_pair_ne</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_inv_cancel</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="sd">/-- Transferring from division_ring to is_division_ring -/</span>
<span class="kd">lemma</span> <span class="n">division_ring.to_is_division_ring</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">division_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_division_ring</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul_inv_cancel</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="o">⟨</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="n">division_ring.mul_inv_cancel</span> <span class="n">ha</span><span class="o">⟩,</span>
  <span class="bp">..</span><span class="o">‹</span><span class="n">division_ring</span> <span class="n">R</span><span class="o">›</span> <span class="o">}</span>

<span class="sd">/-- Transferring from is_division_ring to division_ring -/</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">is_division_ring.to_division_ring</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_division_ring</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">division_ring</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="k">if</span> <span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">classical.some</span> <span class="o">(</span><span class="n">is_division_ring.mul_inv_cancel</span> <span class="n">h</span> <span class="n">ha</span><span class="o">),</span>
  <span class="n">inv_zero</span> <span class="o">:=</span> <span class="n">dif_pos</span> <span class="n">rfl</span><span class="o">,</span>
  <span class="n">mul_inv_cancel</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span>
    <span class="kd">begin</span>
      <span class="n">convert</span> <span class="n">classical.some_spec</span> <span class="o">(</span><span class="n">is_division_ring.mul_inv_cancel</span> <span class="n">h</span> <span class="n">ha</span><span class="o">),</span>
      <span class="n">exact</span> <span class="n">dif_neg</span> <span class="n">ha</span>
    <span class="kd">end</span><span class="o">,</span>
  <span class="bp">..</span> <span class="o">‹</span><span class="n">ring</span> <span class="n">R</span><span class="o">›,</span> <span class="bp">..</span><span class="n">h</span> <span class="o">}</span>

<span class="kd">end</span> <span class="n">division_ring</span>

<span class="kn">section</span> <span class="n">gelfand_mazur_isomorphism</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_algebra</span> <span class="n">ℂ</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">complete_space</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">nontrivial</span> <span class="n">A</span><span class="o">]</span>
<span class="o">[</span><span class="n">measurable_space</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">borel_space</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space.second_countable_topology</span> <span class="n">A</span><span class="o">]</span>

<span class="kn">local</span> <span class="kd">notation</span> <span class="bp">`</span><span class="n">σ</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">spectrum</span> <span class="n">ℂ</span>

<span class="kn">open</span> <span class="n">spectrum</span>

<span class="sd">/-- Choose an arbitrary element of the spectrum of each element in a nontrivial complex Banach</span>
<span class="sd">algebra. -/</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">spectrum.some</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="o">:=</span>
<span class="n">set.nonempty.some</span> <span class="o">(</span><span class="n">spectrum.nonempty</span> <span class="n">a</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">spectrum.some_spec</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">spectrum.some</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">spectrum</span> <span class="n">ℂ</span> <span class="n">a</span> <span class="o">:=</span>
<span class="n">set.nonempty.some_mem</span> <span class="o">(</span><span class="n">spectrum.nonempty</span> <span class="n">a</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">spectrum.unique_mem</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_division_ring</span> <span class="n">A</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">σ</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">∈</span> <span class="n">σ</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">letI</span> <span class="o">:=</span> <span class="n">is_division_ring.to_division_ring</span> <span class="n">A</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mem_iff</span><span class="o">,</span> <span class="n">not_iff_not.mpr</span> <span class="n">is_unit_iff_ne_zero</span><span class="o">,</span> <span class="n">not_not</span><span class="o">,</span> <span class="n">sub_eq_iff_eq_add</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">]</span> <span class="n">at</span> <span class="n">hx</span> <span class="n">hy</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">no_zero_smul_divisors.algebra_map_injective</span> <span class="n">ℂ</span> <span class="n">A</span> <span class="o">(</span><span class="n">hy.symm</span> <span class="bp">▸</span> <span class="n">hx</span><span class="o">),</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">spectrum.unique_of_mem</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_division_ring</span> <span class="n">A</span><span class="o">)</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">A</span><span class="o">}</span>
  <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">σ</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">σ</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">letI</span> <span class="o">:=</span> <span class="n">is_division_ring.to_division_ring</span> <span class="n">A</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mem_iff</span><span class="o">,</span> <span class="n">not_iff_not.mpr</span> <span class="n">is_unit_iff_ne_zero</span><span class="o">,</span> <span class="n">not_not</span><span class="o">,</span> <span class="n">sub_eq_iff_eq_add</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">]</span> <span class="n">at</span> <span class="n">ha</span> <span class="n">hb</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">ha</span> <span class="bp">▸</span> <span class="n">hb</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">spectrum.exists_some_singleton</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_division_ring</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">z</span><span class="o">,</span> <span class="n">spectrum</span> <span class="n">ℂ</span> <span class="n">a</span> <span class="bp">=</span> <span class="o">{</span><span class="n">z</span><span class="o">}</span> <span class="o">:=</span>
<span class="n">set.exists_eq_singleton_iff_nonempty_unique_mem.mpr</span>
  <span class="o">⟨</span><span class="n">spectrum.nonempty</span> <span class="n">a</span><span class="o">,</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="n">hx</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span> <span class="n">spectrum.unique_mem</span> <span class="n">h</span> <span class="n">hx</span> <span class="n">hy</span><span class="o">)⟩</span>

<span class="sd">/-- **Gelfand-Mazur theorem**: A complex Banach division algebra is isomorphic to `ℂ`, registered</span>
<span class="sd">as an algebra equivalence. -/</span>
<span class="kd">@[simps]</span>
<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">alg_equiv.complex_complete_normed_division_ring</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_division_ring</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="bp">≃ₐ</span><span class="o">[</span><span class="n">ℂ</span><span class="o">]</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">algebra_map</span> <span class="n">ℂ</span> <span class="n">A</span><span class="o">,</span>
  <span class="n">inv_fun</span> <span class="o">:=</span> <span class="n">spectrum.some</span><span class="o">,</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">z</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simpa</span> <span class="n">only</span> <span class="o">[</span><span class="n">scalar_eq</span><span class="o">]</span> <span class="n">using</span> <span class="n">spectrum.some_spec</span> <span class="o">((</span><span class="n">algebra_map</span> <span class="n">ℂ</span> <span class="n">A</span><span class="o">)</span> <span class="n">z</span><span class="o">),</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span>
  <span class="kd">begin</span>
    <span class="n">letI</span> <span class="o">:=</span> <span class="n">is_division_ring.to_division_ring</span> <span class="n">A</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h₁</span> <span class="o">:=</span> <span class="n">spectrum.some_spec</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">ℂ</span> <span class="n">A</span> <span class="o">(</span><span class="n">spectrum.some</span> <span class="n">a</span><span class="o">)),</span>
    <span class="k">have</span> <span class="n">h₂</span> <span class="o">:=</span> <span class="n">not_not.mp</span> <span class="o">((</span><span class="n">not_iff_not.mpr</span> <span class="n">is_unit_iff_ne_zero</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="o">(</span><span class="n">mem_iff.mp</span> <span class="n">h₁</span><span class="o">)),</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">sub_eq_iff_eq_add</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">]</span> <span class="n">at</span> <span class="n">h₂</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">no_zero_smul_divisors.algebra_map_injective</span> <span class="n">ℂ</span> <span class="n">A</span> <span class="n">h₂</span><span class="o">]</span> <span class="n">at</span> <span class="n">h₁</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">spectrum.unique_of_mem</span> <span class="n">h</span> <span class="n">h₁</span> <span class="o">(</span><span class="n">spectrum.some_spec</span> <span class="n">a</span><span class="o">),</span>
  <span class="kd">end</span><span class="o">,</span>
  <span class="n">map_mul'</span> <span class="o">:=</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">ℂ</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">map_mul</span><span class="o">,</span>
  <span class="n">map_add'</span> <span class="o">:=</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">ℂ</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">map_add</span><span class="o">,</span>
  <span class="n">commutes'</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span> <span class="o">}</span>

<span class="kd">end</span> <span class="n">gelfand_mazur_isomorphism</span>
</code></pre></div>
</div></div>
<p>Should I PR the mixin or define <code>normed_division_algebra</code>, or both?</p>



<a name="272409415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272409415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272409415">(Feb 18 2022 at 14:41)</a>:</h4>
<p>People who understand this sort of thing now start talking about quadratic growth of typeclass inference search or something; hopefully someone who understands the internals will chime in.</p>



<a name="272413053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272413053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272413053">(Feb 18 2022 at 15:10)</a>:</h4>
<p>The pattern here is to define <code>normed_division_ring</code>. The question of whether it should be a mixin belongs to another discussion as mathlib already has weaker and stronger typeclasses which are not mixins, namely <code>normed_ring</code> and <code>normed_field</code>.</p>



<a name="272415441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272415441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272415441">(Feb 18 2022 at 15:29)</a>:</h4>
<p>Oh! If they're there then it's probably case closed: we seem to want a new object <code>normed_division_ring</code>. Is it still OK to use <code>old_structure_cmd</code> or should it extend one structure and then add the fields for the other?</p>



<a name="272420404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272420404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272420404">(Feb 18 2022 at 16:08)</a>:</h4>
<p>Oh, I think we don't care much about that. I suspect all the other ones use <code>old_structure_cmd</code> happily.</p>



<a name="272421719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272421719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272421719">(Feb 18 2022 at 16:17)</a>:</h4>
<p>The whole normed_* hierarchy doesn't use old_structure_cmd (but it should).</p>



<a name="272421837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272421837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272421837">(Feb 18 2022 at 16:18)</a>:</h4>
<p>(Slightly related: I'm currently working on adding a typeclass for nat.cast&amp;int.cast and had to refactor normed_* to old_structure_cmd.  I should probably extract that to a separate PR.)</p>



<a name="272424186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272424186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272424186">(Feb 18 2022 at 16:38)</a>:</h4>
<p>I don't understand. Are you using old structures more? I thought the plan was to get rid of them?</p>



<a name="272425458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272425458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272425458">(Feb 18 2022 at 16:48)</a>:</h4>
<p>The plan is to use them again, since Lean 4 now uses a mixture of old/new structures (i.e., new whenever possible, old as an automatic fallback).  Looking over normed_*, there's lots of ugly hacks that can be removed by switching to old structures.</p>



<a name="272425580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272425580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272425580">(Feb 18 2022 at 16:49)</a>:</h4>
<p>Oh, that's good to know, since I've been going round the library to remove old structures.</p>



<a name="272425639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272425639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272425639">(Feb 18 2022 at 16:49)</a>:</h4>
<p>What I'm most complaining about the current situation is that new structures really could be as easy to declare as old ones, but for some reason they are not.</p>



<a name="272425722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272425722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272425722">(Feb 18 2022 at 16:50)</a>:</h4>
<p>It seems to be that this is an implementation detail that leaked through.</p>



<a name="272425961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272425961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272425961">(Feb 18 2022 at 16:52)</a>:</h4>
<p>What I want is to be able to declare new structures the same way as old ones, namely you put as many <code>extends</code> clauses as you want, with conflicting fields if you want.</p>



<a name="272426244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272426244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272426244">(Feb 18 2022 at 16:54)</a>:</h4>
<p>And it would generate the structure in the new style, namely the first parent is taken as a field and every parent that wants to add a conflicting field is blown up and we instead get a separate instance/projection.</p>



<a name="272426704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272426704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272426704">(Feb 18 2022 at 16:57)</a>:</h4>
<p>That's what's happening in Lean 4.</p>



<a name="272426728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272426728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272426728">(Feb 18 2022 at 16:57)</a>:</h4>
<p>That might not always do what you want, namely if <code>foo</code> has <code>a</code> and <code>b</code>, <code>bar</code> has <code>b</code> and <code>c</code>, <code>baz</code> has <code>c</code> and <code>d</code>, then</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">qux</span> <span class="kd">extends</span> <span class="n">foo</span><span class="o">,</span> <span class="n">bar</span><span class="o">,</span> <span class="n">baz</span>
</code></pre></div>
<p>would generate</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">qux</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_foo</span> <span class="o">:</span> <span class="n">foo</span><span class="o">)</span>
<span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="bp">...</span><span class="o">)</span>
<span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">...</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">qux.to_bar</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">qux</span><span class="o">)</span> <span class="o">:</span> <span class="n">bar</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span><span class="n">x</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">qux.to_baz</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">qux</span><span class="o">)</span> <span class="o">:</span> <span class="n">baz</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span><span class="n">x</span><span class="o">}</span>
</code></pre></div>
<p>instead of the more optimal</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">qux</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_foo</span> <span class="o">:</span> <span class="n">foo</span><span class="o">)</span>
<span class="o">(</span><span class="n">to_baz</span> <span class="o">:</span> <span class="n">baz</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">qux.to_bar</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">qux</span><span class="o">)</span> <span class="o">:</span> <span class="n">bar</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span><span class="n">x</span><span class="o">}</span>
</code></pre></div>



<a name="272426916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272426916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272426916">(Feb 18 2022 at 16:58)</a>:</h4>
<p>And this gets worse with bigger structures which have more complicated conflicting fields, but arguably rearranging the clauses would solve what it can.</p>



<a name="272427033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272427033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272427033">(Feb 18 2022 at 16:59)</a>:</h4>
<p>Is that possible, Gabriel, or am I daydreaming?</p>



<a name="272427166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272427166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272427166">(Feb 18 2022 at 17:00)</a>:</h4>
<p>It works if you write <code>extends Foo, Baz, Bar</code>.</p>



<a name="272427330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272427330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272427330">(Feb 18 2022 at 17:00)</a>:</h4>
<p>Sorry, that was my point <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="272427389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272427389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272427389">(Feb 18 2022 at 17:01)</a>:</h4>
<p>But it doesn't currently generate <code>qux.to_bar</code> automatically, right?</p>



<a name="272428221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272428221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272428221">(Feb 18 2022 at 17:07)</a>:</h4>
<p>If you write <code>extends Foo, Baz, Bar</code> it does create a projection to <code>Bar</code>.  I can't vouch for the name though.</p>



<a name="272428548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272428548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272428548">(Feb 18 2022 at 17:09)</a>:</h4>
<p>In Lean 3 too?</p>



<a name="272429212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272429212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272429212">(Feb 18 2022 at 17:14)</a>:</h4>
<p>No, but that's only a temporary issue.</p>



<a name="272449104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272449104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272449104">(Feb 18 2022 at 19:55)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/12132">#12132</a>: introduces division rings. For the moment I just copied the stuff that worked (i.e., didn't use commutativity) from normed fields. Should I in another PR refactor to only use the normed_division_ring versions and rely on type class inference for the rest? Obviously that could touch a lot of files, and it's not that much code duplication right now anyway.</p>



<a name="272450985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272450985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272450985">(Feb 18 2022 at 20:06)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/normed_field.norm_mul">docs#normed_field.norm_mul</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/norm_mul">docs#norm_mul</a></p>



<a name="272451098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272451098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272451098">(Feb 18 2022 at 20:07)</a>:</h4>
<p>Hmm... that's weird. Why is it not just called <code>norm_mul</code>?</p>



<a name="272451184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272451184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272451184">(Feb 18 2022 at 20:08)</a>:</h4>
<p>In any case I think you should replace the lemmas right away. This really fits with the rest of the PR.</p>



<a name="272458691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272458691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272458691">(Feb 18 2022 at 21:17)</a>:</h4>
<p><code>norm_mul</code> for fields and division rings is an equality, not an inequality like for (semi)normed rings. That's the reason for the difference.</p>



<a name="272458823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272458823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272458823">(Feb 18 2022 at 21:19)</a>:</h4>
<p>Probably we should call the inequality version <code>norm_mul_le</code></p>



<a name="272458881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272458881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272458881">(Feb 18 2022 at 21:19)</a>:</h4>
<p>If that's more work though, we could have <code>norm_mul'</code> for the division_ring / field versions</p>



<a name="272458949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272458949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272458949">(Feb 18 2022 at 21:20)</a>:</h4>
<p>I'm just worried about touching 30 or 40 files in one PR. The amount of work is not a huge deal, as long as it's feasible.</p>



<a name="272459387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272459387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272459387">(Feb 18 2022 at 21:24)</a>:</h4>
<p>grepping for <code>normed_field.norm_mul</code> alone hit 13 different files. I'm willing to do it, but someone has to explain to me how to go about it without making my life miserable.</p>



<a name="272459448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272459448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272459448">(Feb 18 2022 at 21:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/normed_division_ring/near/272458823">said</a>:</p>
<blockquote>
<p>Probably we should call the inequality version <code>norm_mul_le</code></p>
</blockquote>
<p>Interestingly, the API for it includes the <code>le</code>, it's just the structure projection that doesn't have it.</p>



<a name="272460208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272460208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272460208">(Feb 18 2022 at 21:31)</a>:</h4>
<p>Well nothing should be using the structure projection anyway</p>



<a name="272460269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272460269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272460269">(Feb 18 2022 at 21:32)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/norm_mul_le">docs#norm_mul_le</a> exists then?</p>



<a name="272460294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272460294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272460294">(Feb 18 2022 at 21:32)</a>:</h4>
<p>Does <a href="https://leanprover-community.github.io/mathlib_docs/find/norm_mul">docs#norm_mul</a> too?</p>



<a name="272460352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272460352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272460352">(Feb 18 2022 at 21:33)</a>:</h4>
<p>Alright, easy - rename <code>normed_field.norm_mul'</code> to <code>norm_mul</code> (by adding an API lemma to unwrap it) and you're done</p>



<a name="272547311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547311">(Feb 19 2022 at 22:34)</a>:</h4>
<p>Sorry, <span class="user-mention" data-user-id="310045">@Eric Wieser</span>, I think we were talking past each other. Here is the situation:</p>
<ol>
<li><code>normed_ring</code> has a <code>norm_mul</code> structure projection (which is actually an inequality), and an API wrapper <code>norm_mul_le</code> (root namespace)</li>
<li><code>normed_field</code> has a <code>norm_mul'</code> structure projection (which is an equality), and a <em>namespaced</em> API wrapper <code>normed_field.norm_mul</code></li>
</ol>
<p>I think <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> was <a href="#narrow/stream/113488-general/topic/normed_division_ring/near/272450985">asking</a> why the latter is namespaced, but the former isn't. When I followed up with the (in)equality comment, I had thought the namespacing was required because the ring version was called <code>norm_mul</code>, but it isn't, that's only the name of the structure projection.</p>
<p>My worry about deleting all these normed field lemmas (and only keeping the division ring versions) is that they're all in the <code>normed_field</code> namespace, and of course the division ring versions don't want to be in that namespace (right? I'm not crazy). So should I really delete them, and then go around into all the files that broke and add an <code>open normed_division_ring</code>? This was my concern about touching 30 or 40 files.</p>



<a name="272547554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547554">(Feb 19 2022 at 22:39)</a>:</h4>
<p>The projection from <code>normed_ring</code> really should be called <code>normed_ring.norm_mul_le</code>. Changing it shouldn't be too hard as it's supposedly called exactly once (to prove <code>norm_mul_le</code>). The projection from <code>normed_field</code> should be called <code>normed_field.norm_mul</code> and the API lemma should be called <code>norm_mul</code> (either by <code>export</code>ing it or declaring it separately). Almost no lemma should be in the <code>normed_field</code> namespace.</p>



<a name="272547623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547623">(Feb 19 2022 at 22:40)</a>:</h4>
<p>Similarly, no lemma should be in the <code>normed_division_ring</code> namespace.</p>



<a name="272547732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547732">(Feb 19 2022 at 22:42)</a>:</h4>
<p>That makes sense to me, but do we need someone (<span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span> because git blame) to weigh in about why they were originally put into the <code>normed_field</code> namespace?</p>



<a name="272547824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547824">(Feb 19 2022 at 22:44)</a>:</h4>
<p><code>normed_field</code> was there long before me.</p>



<a name="272547931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547931">(Feb 19 2022 at 22:46)</a>:</h4>
<p>I suspect this namespace is an historical accident.</p>



<a name="272547938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272547938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272547938">(Feb 19 2022 at 22:46)</a>:</h4>
<p>I agree that it should be in the root namespace.</p>



<a name="272548098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272548098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272548098">(Feb 19 2022 at 22:49)</a>:</h4>
<p>okay, I'll change it.</p>



<a name="272549209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272549209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272549209">(Feb 19 2022 at 23:09)</a>:</h4>
<p>I think we have a diamond problem. A normed field is both a normed division ring and a normed commutative ring.</p>



<a name="272549463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272549463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272549463">(Feb 19 2022 at 23:14)</a>:</h4>
<p>Sorry, I didn't explain enough: both of these have instances of normed group.</p>



<a name="272549470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272549470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272549470">(Feb 19 2022 at 23:14)</a>:</h4>
<p>But are they not defeq?</p>



<a name="272549494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272549494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272549494">(Feb 19 2022 at 23:15)</a>:</h4>
<p>There are diamonds everywhere. The real trouble is non-defeq diamonds.</p>



<a name="272549587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272549587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272549587">(Feb 19 2022 at 23:16)</a>:</h4>
<p>well, I think not because I was getting problems with the lemma <code>norm_norm</code> which to me looked like a diamond, but perhaps I misinterpreted the reason. Let me see if I can get the file back to that state and post the error.</p>



<a name="272549655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272549655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272549655">(Feb 19 2022 at 23:18)</a>:</h4>
<p>Don't hesitate to post the code either here or on the branch. I'll be happy to diagnose.</p>



<a name="272550390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272550390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272550390">(Feb 19 2022 at 23:34)</a>:</h4>
<p>nevermind, I think I'm an idiot. There was a <code>namespace normed_field</code> and a <code>section normed_field</code> and I think I deleted the wrong corresponding <code>end normed_field</code> which caused there to be a <code>[normed_field α]</code> and a <code>[nondiscrete_normed_field α]</code> at the same time, hence two norms.</p>



<a name="272550655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272550655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272550655">(Feb 19 2022 at 23:40)</a>:</h4>
<p>Wait, no, it's back. I don't understand. Here's the current file. Line 462: <a href="/user_uploads/3121/fyqonD12OYDhZscUJSGXlLnq/basic.lean">basic.lean</a></p>



<a name="272550681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272550681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272550681">(Feb 19 2022 at 23:41)</a>:</h4>
<p>When I instantiate the metavariable from the hole with <code>x</code>, I get this error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">real.norm_of_nonneg</span> <span class="o">(</span><span class="n">norm_nonneg</span> <span class="n">x</span><span class="o">)</span>
<span class="n">term</span>
  <span class="n">norm_nonneg</span> <span class="n">x</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">has_le.le</span> <span class="n">real</span> <span class="n">real.has_le</span> <span class="mi">0</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_norm.norm</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">semi_normed_group.to_has_norm</span> <span class="n">α</span> <span class="n">_inst_2</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">has_le.le</span> <span class="n">real</span> <span class="n">real.has_le</span> <span class="mi">0</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_norm.norm</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_field.to_has_norm</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">nondiscrete_normed_field.to_normed_field</span> <span class="n">α</span> <span class="n">_inst_1</span><span class="o">))</span> <span class="n">x</span><span class="o">)</span>
</code></pre></div>



<a name="272551037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272551037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272551037">(Feb 19 2022 at 23:49)</a>:</h4>
<p>oh wait, it's seeing a seminormed group from the declaration and a nondiscrete normed field from earlier</p>



<a name="272551260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272551260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272551260">(Feb 19 2022 at 23:54)</a>:</h4>
<p>okay, I made this file happy, thanks.</p>



<a name="272563961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272563961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272563961">(Feb 20 2022 at 04:05)</a>:</h4>
<p>Can someone diagnose why my changes in <a href="https://github.com/leanprover-community/mathlib/pull/12132">#12132</a> broke the usage of <code>ac_refl</code> on line 975 of analysis/asymptotics/asymtopotics.lean? Replacing it with <code>ring</code> solves the goal. My guess is something to do with instance priority for <code>normed_division_ring</code> and it is getting stuck there and failing to recognize commutativity, but I'm not sure.</p>



<a name="272582983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272582983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272582983">(Feb 20 2022 at 10:34)</a>:</h4>
<p>Perhaps it would be best to split this into a "rename the normed_field stuff" PR followed by the division_ring stuff - that would make it easier to isolate the problem</p>



<a name="272594470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272594470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272594470">(Feb 20 2022 at 14:07)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/12163">#12163</a>: moves normed field lemmas into root namespace. We'll see how CI goes.</p>



<a name="272599744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272599744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272599744">(Feb 20 2022 at 15:49)</a>:</h4>
<p>Success</p>



<a name="272757240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/normed_division_ring/near/272757240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/normed_division_ring.html#272757240">(Feb 22 2022 at 03:45)</a>:</h4>
<p>Anyone want to try to understand why <code>ac_refl</code> fails in commit <code>94b0b05</code> on branch <code>j-loreaux/normed-division-ring</code> (file <code>analysis/asymptotics/asymptotics</code> line 975)? I just pushed another commit to workaround it, but it might be good to understand why it's not working. I don't have the knowledge to know where to start.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>