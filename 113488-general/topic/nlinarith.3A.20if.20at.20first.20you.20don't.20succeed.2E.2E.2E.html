---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html">nlinarith: if at first you don't succeed...</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="310106199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106199">(Nov 14 2022 at 23:59)</a>:</h4>
<p>There are no unicode tricks here, the <code>example</code>s contain exactly the same text</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.linarith</span>
<span class="kn">import</span> <span class="n">data.rat.basic</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span>

<span class="kd">example</span>
  <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">y</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">nlinarith</span><span class="o">,</span> <span class="c1">-- fails</span>
<span class="kd">end</span>
<span class="kd">example</span>
  <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">y</span> <span class="bp">-</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">nlinarith</span><span class="o">,</span> <span class="c1">-- works</span>
<span class="kd">end</span>
</code></pre></div>
<p>What's going on?</p>



<a name="310106758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106758">(Nov 15 2022 at 00:04)</a>:</h4>
<p>Haha, I get the opposite failures. :-)</p>



<a name="310106855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106855">(Nov 15 2022 at 00:05)</a>:</h4>
<p>I also replicated Eric's result</p>



<a name="310106902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106902">(Nov 15 2022 at 00:05)</a>:</h4>
<p>It works with my fix.</p>



<a name="310106915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106915">(Nov 15 2022 at 00:06)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/17307">#17307</a></p>



<a name="310106965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106965">(Nov 15 2022 at 00:06)</a>:</h4>
<p>So you discovered the same bug in linarith I discovered while porting.</p>



<a name="310106993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310106993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310106993">(Nov 15 2022 at 00:06)</a>:</h4>
<p>Isn't your bug at least deterministic?</p>



<a name="310107009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107009">(Nov 15 2022 at 00:06)</a>:</h4>
<p>The appearance of the bug is sensitive to ordering of variables used.</p>



<a name="310107048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107048">(Nov 15 2022 at 00:06)</a>:</h4>
<p>And apparently that is not deterministic??</p>



<a name="310107049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107049">(Nov 15 2022 at 00:06)</a>:</h4>
<p>Is this "ordering" in the sense of "some random hash of some garbage-named metavariables"?</p>



<a name="310107062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107062">(Nov 15 2022 at 00:07)</a>:</h4>
<p>It might be due to the names of fvars?</p>



<a name="310107082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107082">(Nov 15 2022 at 00:07)</a>:</h4>
<p>this is weird, I agree</p>



<a name="310107088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107088">(Nov 15 2022 at 00:07)</a>:</h4>
<p>I think it's deterministic with <code>lean --make</code> within a single process</p>



<a name="310107101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107101">(Nov 15 2022 at 00:07)</a>:</h4>
<p>And just not with the lean server</p>



<a name="310107126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107126">(Nov 15 2022 at 00:07)</a>:</h4>
<p>variable ordering should not be nondeterministic</p>



<a name="310107201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107201">(Nov 15 2022 at 00:08)</a>:</h4>
<p>If your variables are named <code>_mfresh.123</code> or whatever, are they guaranteed to be the same every time you run the tactic?</p>



<a name="310107209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107209">(Nov 15 2022 at 00:08)</a>:</h4>
<p>Or are those counters global within a module?</p>



<a name="310107214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107214">(Nov 15 2022 at 00:08)</a>:</h4>
<p>they are a global counter</p>



<a name="310107265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107265">(Nov 15 2022 at 00:08)</a>:</h4>
<p>Then I bet if you put your variables in a <code>name_set</code> and iterate them, the iteration order is non-deterministic (as a function of human-visible state)</p>



<a name="310107269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107269">(Nov 15 2022 at 00:08)</a>:</h4>
<p>but I would have expected linarith to name its variables in the order they occur in the hypothesis list</p>



<a name="310107769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310107769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310107769">(Nov 15 2022 at 00:13)</a>:</h4>
<p>Note that the one-liner test case I made for bug <a href="https://github.com/leanprover-community/mathlib/pull/17307">#17307</a> depends on the traversal order to get variables numbered in the right way</p>



<a name="310108474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108474">(Nov 15 2022 at 00:20)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/597343b0995a2478628d03a9ce8ebdc8752bd3e8/src/tactic/linarith/preprocessing.lean#L245-L247">Found it</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">do</span> <span class="n">s</span> <span class="bp">←</span> <span class="n">ls.mfoldr</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">h</span> <span class="n">s'</span><span class="o">,</span> <span class="n">infer_type</span> <span class="n">h</span> <span class="bp">&gt;&gt;=</span> <span class="n">find_squares</span> <span class="n">s'</span><span class="o">)</span> <span class="n">mk_rb_set</span><span class="o">,</span>
   <span class="n">new_es</span> <span class="bp">←</span> <span class="n">s.mfold</span> <span class="o">([]</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span><span class="o">)</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="o">⟨</span><span class="n">e</span><span class="o">,</span> <span class="n">is_sq</span><span class="o">⟩</span> <span class="n">new_es</span><span class="o">,</span>
     <span class="o">((</span><span class="k">do</span> <span class="n">p</span> <span class="bp">←</span> <span class="n">mk_app</span> <span class="o">(</span><span class="k">if</span> <span class="n">is_sq</span> <span class="k">then</span> <span class="bp">``</span><span class="n">sq_nonneg</span> <span class="k">else</span> <span class="bp">``</span><span class="n">mul_self_nonneg</span><span class="o">)</span> <span class="o">[</span><span class="n">e</span><span class="o">],</span>
       <span class="n">return</span> <span class="bp">$</span> <span class="n">p</span><span class="o">::</span><span class="n">new_es</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">return</span> <span class="n">new_es</span><span class="o">),</span>
</code></pre></div>
<p>that's a monadic fold over an <code>rb_set (expr ×ₗ bool)</code></p>



<a name="310108663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108663">(Nov 15 2022 at 00:22)</a>:</h4>
<p>and <code>expr.lt</code> of course depends on the ordering of those unique names</p>



<a name="310108666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108666">(Nov 15 2022 at 00:22)</a>:</h4>
<p>Damn, beat me to it</p>



<a name="310108770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108770">(Nov 15 2022 at 00:23)</a>:</h4>
<p>I guess using <code>list.dedup</code> instead of <code>mk_rb_set</code> would solve the problem?</p>



<a name="310108831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108831">(Nov 15 2022 at 00:24)</a>:</h4>
<p>yes</p>



<a name="310108871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108871">(Nov 15 2022 at 00:24)</a>:</h4>
<p>what's more, that is usually better because we want to use defeq up to reducible or something like that</p>



<a name="310108892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108892">(Nov 15 2022 at 00:24)</a>:</h4>
<p>Surely <code>list.dedup</code> won't do that either?</p>



<a name="310108913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310108913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310108913">(Nov 15 2022 at 00:25)</a>:</h4>
<p>well I mean the algorithm</p>



<a name="310109020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109020">(Nov 15 2022 at 00:26)</a>:</h4>
<p>RIght, so just manually iterate and insert if none  of the existing items match; which is unfortunately O(n^2), but  I guess n is small</p>



<a name="310109023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109023">(Nov 15 2022 at 00:26)</a>:</h4>
<p>the dedup is usually done manually, using logic like <a href="https://github.com/leanprover-community/mathlib/blob/597343b0995a2478628d03a9ce8ebdc8752bd3e8/src/tactic/linarith/parsing.lean#L94-L96">this</a></p>



<a name="310109044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109044">(Nov 15 2022 at 00:26)</a>:</h4>
<p>yeah, nothing that can be done about that</p>



<a name="310109512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109512">(Nov 15 2022 at 00:31)</a>:</h4>
<p><code>find_squares</code> looks like it needs a similar fix</p>



<a name="310109527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109527">(Nov 15 2022 at 00:31)</a>:</h4>
<p>Either that, or we should canonize the order after doing all the initial deduplicating</p>



<a name="310109873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109873">(Nov 15 2022 at 00:34)</a>:</h4>
<p>the comment says something about the inputs having been canonized, not sure when that happens but it seems like it should have also numbered the atoms</p>



<a name="310109999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310109999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310109999">(Nov 15 2022 at 00:36)</a>:</h4>
<p>assuming we aren't doing any big changes to this code, I guess <code>find_squares</code> should accumulate two <code>list expr</code>s (or I guess <code>list (expr * unit)</code> to pass to <code>find_defeq</code>)</p>



<a name="310168943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310168943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310168943">(Nov 15 2022 at 10:20)</a>:</h4>
<p>Do you plan to make the patch, <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>?</p>



<a name="310169005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310169005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310169005">(Nov 15 2022 at 10:21)</a>:</h4>
<p>no, unless you are having trouble</p>



<a name="310169644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310169644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310169644">(Nov 15 2022 at 10:25)</a>:</h4>
<p>Do you think it's worth making at all, or is there little point with Scott's patch on the horizon?</p>



<a name="310170753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310170753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310170753">(Nov 15 2022 at 10:30)</a>:</h4>
<p>I think it is best not to have nondeterministic tactics. Scott's fix is an independent issue</p>



<a name="310171714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/nlinarith%3A%20if%20at%20first%20you%20don%27t%20succeed.../near/310171714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/nlinarith.3A.20if.20at.20first.20you.20don't.20succeed.2E.2E.2E.html#310171714">(Nov 15 2022 at 10:37)</a>:</h4>
<p>In theory it ought to be externally deterministic irrespective of the order, right? I suppose we can't use a <code>quot.lift</code> in meta code to prove that...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>