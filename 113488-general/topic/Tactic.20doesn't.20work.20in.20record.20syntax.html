---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html">Tactic doesn't work in record syntax</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="217951364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951364">(Nov 25 2020 at 23:34)</a>:</h4>
<p>Can anyone help me understand what's going on with the following code?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="c1">-- this works...</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="o">}</span> <span class="c1">-- this fails...</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="n">foo</span> <span class="n">_</span> <span class="o">}</span> <span class="c1">-- this works</span>
</code></pre></div>
<p><code>tidy</code> very happily proves that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1,0)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span> is nonzero in the lemma <code>foo</code>, but it doesn't work in the second example.</p>



<a name="217951649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951649">(Nov 25 2020 at 23:39)</a>:</h4>
<p>goodness knows whether this is relevant, but the infoview says that the first goal is about a map <code>fin 1.succ → L</code> but the failure is about a map <code>fin 2 → L</code></p>



<a name="217951776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951776">(Nov 25 2020 at 23:41)</a>:</h4>
<p>this is I think a red herring.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="o">}</span> <span class="c1">-- this still fails...</span>
</code></pre></div>



<a name="217951883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951883">(Nov 25 2020 at 23:43)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span><span class="bp">?</span> <span class="c1">-- intros ᾰ, simp at *, assumption</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span><span class="n">intros</span> <span class="n">x</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">assumption</span><span class="o">}</span> <span class="o">}</span> <span class="c1">-- simp fails...</span>
</code></pre></div>



<a name="217951934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951934">(Nov 25 2020 at 23:44)</a>:</h4>
<p><a href="https://www.diffchecker.com/xOMY4t91">https://www.diffchecker.com/xOMY4t91</a></p>



<a name="217951940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951940">(Nov 25 2020 at 23:44)</a>:</h4>
<p>the LHS is the version of <code>ᾰ</code> that fails; RHS is the version that succeeds</p>



<a name="217951952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951952">(Nov 25 2020 at 23:44)</a>:</h4>
<p>It this supposed to be read by a human?</p>



<a name="217951960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217951960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217951960">(Nov 25 2020 at 23:44)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span> <span class="n">assumption</span> <span class="o">}</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span><span class="n">intros</span> <span class="n">x</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span> <span class="n">assumption</span><span class="o">}</span> <span class="o">}</span> <span class="c1">-- simp fails...</span>
</code></pre></div>



<a name="217952051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217952051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217952051">(Nov 25 2020 at 23:46)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">one_ne_zero</span><span class="o">,</span> <span class="n">matrix.cons_eq_zero_iff</span><span class="o">,</span> <span class="n">false_and</span><span class="o">]</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">assumption</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span>
    <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">one_ne_zero</span><span class="o">,</span> <span class="n">matrix.cons_eq_zero_iff</span><span class="o">,</span> <span class="n">false_and</span><span class="o">]</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span> <span class="c1">-- fails</span>
    <span class="n">assumption</span><span class="o">}</span> <span class="o">}</span>
</code></pre></div>



<a name="217952054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217952054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217952054">(Nov 25 2020 at 23:46)</a>:</h4>
<p>this is the diff when I use <code>(nat.succ $ nat.succ 0)</code>: <a href="https://www.diffchecker.com/CR8HCTXs">https://www.diffchecker.com/CR8HCTXs</a></p>



<a name="217952058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217952058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217952058">(Nov 25 2020 at 23:46)</a>:</h4>
<p>the diff is smaller, but still exists</p>



<a name="217952070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217952070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217952070">(Nov 25 2020 at 23:46)</a>:</h4>
<p>I don't think it's about the 2 in <code>fin 2</code>. The second example works</p>



<a name="217952093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217952093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217952093">(Nov 25 2020 at 23:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax/near/217951952">said</a>:</p>
<blockquote>
<p>It this supposed to be read by a human?</p>
</blockquote>
<p>This is what kids who don't have <code>diff</code> do.</p>



<a name="217952172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217952172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217952172">(Nov 25 2020 at 23:48)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">ᾰ</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">ᾰ</span><span class="o">,</span> <span class="c1">-- works</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="bp">$</span> <span class="n">nat.succ</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">ᾰ</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">ᾰ</span><span class="o">,</span> <span class="c1">-- fails</span>
  <span class="kd">end</span>
 <span class="o">}</span>
</code></pre></div>



<a name="217953525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217953525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217953525">(Nov 26 2020 at 00:10)</a>:</h4>
<p>I think this is related:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span>

<span class="n">abbreviation</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">]</span>
<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">bar</span> <span class="n">L</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="c1">-- this works...</span>

<span class="kd">@[reducible]</span>
<span class="kd">def</span> <span class="n">baz</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">]</span>
<span class="kd">lemma</span> <span class="n">foo'</span> <span class="o">:</span> <span class="n">baz</span> <span class="n">L</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="c1">-- this works...</span>

<span class="kd">def</span> <span class="n">baz'</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">]</span>
<span class="kd">lemma</span> <span class="n">foo''</span> <span class="o">:</span> <span class="n">baz'</span> <span class="n">L</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="c1">-- this fails...</span>
</code></pre></div>



<a name="217953881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217953881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217953881">(Nov 26 2020 at 00:16)</a>:</h4>
<p>Fixed it for you:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">.</span><span class="n">succ.succ</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span>
    <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">set</span> <span class="n">goodzero</span> <span class="o">:=</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">pi.has_zero.</span><span class="o">{</span><span class="mi">0</span> <span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">))))</span>
          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span> <span class="n">L</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span>
             <span class="bp">@</span><span class="n">mul_zero_class.to_has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_class.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="n">_inst_1</span><span class="o">))))))))</span>
      <span class="k">with</span> <span class="n">hgoodzero</span><span class="o">,</span>
    <span class="n">set</span> <span class="n">badzero</span> <span class="o">:=</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_add_monoid.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">pi.add_comm_group.</span><span class="o">{</span><span class="mi">0</span> <span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">))))</span>
                   <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span> <span class="n">L</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span>
                      <span class="bp">@</span><span class="n">ring.to_add_comm_group.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="n">_inst_1</span><span class="o">))))))))</span>
      <span class="k">with</span> <span class="n">hbadzero</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">badzero</span> <span class="bp">=</span> <span class="n">goodzero</span> <span class="o">:=</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">this</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">tidy</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div>



<a name="217953906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217953906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217953906">(Nov 26 2020 at 00:17)</a>:</h4>
<p><code>variables (L : Type) [field L] (V : Type) [add_comm_group V] [vector_space L V]</code></p>



<a name="217953919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217953919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217953919">(Nov 26 2020 at 00:17)</a>:</h4>
<p>Kevin, you're not supposed to write the name <code>ᾰ</code> explicitly</p>



<a name="217953963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217953963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217953963">(Nov 26 2020 at 00:18)</a>:</h4>
<p>That was Kenny! I'd never dream of doing that!</p>



<a name="217953995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217953995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217953995">(Nov 26 2020 at 00:19)</a>:</h4>
<p>In fact the moment I saw his code I linted it, hoping that there was now an <code>ᾰ</code> linter.</p>



<a name="217954018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954018">(Nov 26 2020 at 00:19)</a>:</h4>
<p>oh no crap I just saw it in mine too :-/ Who put that there?</p>



<a name="217954072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954072">(Nov 26 2020 at 00:20)</a>:</h4>
<p>We really should have gone with something like <span aria-label="nuclear" class="emoji emoji-2622" role="img" title="nuclear">:nuclear:</span></p>



<a name="217954118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954118">(Nov 26 2020 at 00:21)</a>:</h4>
<p>Patrick claimed recently that we didn't need <code>pp.all</code> any more because the infoview would take care of everything, but it was very handy here. Of course I don't have a clue about the actual problem, namely that for some reason we have two different zeros.</p>



<a name="217954197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954197">(Nov 26 2020 at 00:22)</a>:</h4>
<p>Here's all the code. You can see after the two <code>intros x</code> that the types are slightly different -- this was Kenny's observation.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">set_option</span> <span class="n">pp.all</span> <span class="n">true</span>
<span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">matrix.cons_eq_zero_iff</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">one_ne_zero</span><span class="o">,</span> <span class="n">matrix.cons_eq_zero_iff</span><span class="o">,</span> <span class="n">false_and</span><span class="o">]</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">assumption</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">.</span><span class="n">succ.succ</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span>
    <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">set</span> <span class="n">goodzero</span> <span class="o">:=</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">pi.has_zero.</span><span class="o">{</span><span class="mi">0</span> <span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">))))</span>
          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span> <span class="n">L</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span>
             <span class="bp">@</span><span class="n">mul_zero_class.to_has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_class.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                     <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="n">_inst_1</span><span class="o">))))))))</span>
      <span class="k">with</span> <span class="n">hgoodzero</span><span class="o">,</span>
    <span class="n">set</span> <span class="n">badzero</span> <span class="o">:=</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_has_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_add_monoid.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">pi.add_comm_group.</span><span class="o">{</span><span class="mi">0</span> <span class="mi">0</span><span class="o">}</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">))))</span>
                   <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span> <span class="n">L</span><span class="o">)</span>
                   <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat.has_zero</span><span class="o">)))),</span>
                      <span class="bp">@</span><span class="n">ring.to_add_comm_group.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
                        <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="n">_inst_1</span><span class="o">))))))))</span>
      <span class="k">with</span> <span class="n">hbadzero</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">badzero</span> <span class="bp">=</span> <span class="n">goodzero</span> <span class="o">:=</span> <span class="n">rfl</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">this</span> <span class="n">at</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">tidy</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div>



<a name="217954287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954287">(Nov 26 2020 at 00:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax/near/217954197">said</a>:</p>
<blockquote>
<p>this was Kenny's observation</p>
</blockquote>
<p>This sounds like research-paper language to me</p>



<a name="217954317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954317">(Nov 26 2020 at 00:25)</a>:</h4>
<p><span class="tex-error">$$\text{[5] K. Lau, \emph{Private communication} (2020).}$$</span></p>



<a name="217954367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954367">(Nov 26 2020 at 00:26)</a>:</h4>
<p>fail</p>



<a name="217954395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954395">(Nov 26 2020 at 00:26)</a>:</h4>
<p>So do I understand correctly that the issue is with the <code>0</code> in <code>\neq 0</code>?</p>



<a name="217954509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954509">(Nov 26 2020 at 00:28)</a>:</h4>
<p>Yes that's my understanding too -- the RHS zeros are for some reason different.</p>



<a name="217954676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954676">(Nov 26 2020 at 00:32)</a>:</h4>
<p>This is less than ideal, but it works <span aria-label="expressionless" class="emoji emoji-1f611" role="img" title="expressionless">:expressionless:</span> </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="c1">-- this works...</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="n">L</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span> <span class="o">}</span>
</code></pre></div>



<a name="217954713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954713">(Nov 26 2020 at 00:32)</a>:</h4>
<p>Even better:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">.</span> <span class="n">obviously</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="n">L</span> <span class="mi">2</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">]⟩</span>
</code></pre></div>



<a name="217954734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954734">(Nov 26 2020 at 00:33)</a>:</h4>
<p>why are these things working but other things aren't working?</p>



<a name="217954762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217954762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217954762">(Nov 26 2020 at 00:33)</a>:</h4>
<p>¯\_(ツ)_/¯</p>



<a name="217955353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217955353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217955353">(Nov 26 2020 at 00:44)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span>

<span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="n">reducible</span><span class="o">]</span> <span class="n">has_zero.zero</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="n">L</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">change</span> <span class="n">_</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span> <span class="c1">-- fail!?</span>

  <span class="kd">end</span><span class="o">}</span>
</code></pre></div>



<a name="217955374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217955374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217955374">(Nov 26 2020 at 00:45)</a>:</h4>
<p>The <code>change</code> line fails. <code>not definitionally equal</code></p>



<a name="217955565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217955565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217955565">(Nov 26 2020 at 00:48)</a>:</h4>
<p>So I guess what's happening is that when you make the structure</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
</code></pre></div>
<p>the zero is coming from the fact that V is an <code>add_comm_group</code>. But here</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">begin</span>
<span class="bp">...</span>
</code></pre></div>
<p>Lean knows that the vector space is <code>fin 2 -&gt; L</code> and whilst this is an add_comm_group, the zero comes from <code>pi.has_zero</code>. These things are defeq so there are no diamond problems, but the problem is that the solution found by <code>simp</code> involves <code>matrix.cons_eq_zero_iff</code> which has the <code>pi.has_zero</code> zero. The rewrite shouldn't fail because the zeros are defeq, but for some reason it does fail -- this is not the first time I have seen rewrite failing under suspicious circumstances recently. Has there been a regression or something? Or am I talking nonsense?</p>



<a name="217955591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217955591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217955591">(Nov 26 2020 at 00:49)</a>:</h4>
<p><del>I assume <code>erw</code> would work.</del> It doesn't</p>



<a name="217955716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217955716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217955716">(Nov 26 2020 at 00:51)</a>:</h4>
<p>But yes, that sounds like a reasonable conclusion.</p>



<a name="217955781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217955781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217955781">(Nov 26 2020 at 00:52)</a>:</h4>
<p>But this doesn't really explain why <code>change</code> doesn't work.</p>



<a name="217981496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/217981496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#217981496">(Nov 26 2020 at 09:41)</a>:</h4>
<p>The <code>change</code> fails because that <code>0</code> is <code>0 : nat</code>. <code>change</code> doesn't try to do any unification with the goal, it's much more stupid than that. It interprets what you give it and then unifies afterwards.</p>



<a name="218004870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218004870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218004870">(Nov 26 2020 at 14:02)</a>:</h4>
<p>Oh, right. I figured lean would be smart enough to replace <code>0</code> with <code>has_zero.zero</code>, but I guess not.</p>



<a name="218013404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218013404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218013404">(Nov 26 2020 at 15:22)</a>:</h4>
<p>It's all about when elaboration happens I guess -- this is just something I've picked up over time. Before it attempts the change it decides it wants to figure out the type of <code>0</code> and because it doesn't have any other info, it goes for <code>nat</code>, and from then on we're doomed.</p>



<a name="218014182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014182">(Nov 26 2020 at 15:30)</a>:</h4>
<p>I'm still a little puzzled as to why foo0 works but not foo:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">foo0</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span>

<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="n">v</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">tidy</span><span class="o">,</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="218014333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014333">(Nov 26 2020 at 15:32)</a>:</h4>
<p>Oh I don't think we've got to the bottom of this! I still don't understand why the rewrite fails.</p>



<a name="218014454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014454">(Nov 26 2020 at 15:33)</a>:</h4>
<p>To un-#xy things, I'm trying to mimic a (fairly technical) argument using classical projective spaces (i.e. projectivization of <code>(fin n \to L)</code>), so I'm happy to restrict myself to those vector spaces, at least for now.</p>



<a name="218014627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014627">(Nov 26 2020 at 15:35)</a>:</h4>
<p>I think <code>tidy</code> made a wrong turn in the foo proof above. If <code>n=0</code> then probably the goal isn't solvable after <code>tidy</code>.</p>



<a name="218014710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014710">(Nov 26 2020 at 15:35)</a>:</h4>
<p>Note:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">foo</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">matrix.vec_cons</span> <span class="mi">1</span> <span class="n">v</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">tidy</span><span class="o">,</span> <span class="c1">-- works</span>
<span class="kd">end</span>
</code></pre></div>



<a name="218014796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014796">(Nov 26 2020 at 15:36)</a>:</h4>
<p>I would definitely suggest not using <code>tidy</code> as your proof when trying to debug something like this unless the problem is <code>tidy</code>-specific</p>



<a name="218014877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014877">(Nov 26 2020 at 15:37)</a>:</h4>
<p>oh it's nothing to do with <code>tidy</code> -- <code>![1,v]</code> is being interpreted as two terms of type <code>fin n -&gt; F</code> in the failing proof. <code>foo</code> isn't true I suspect.</p>



<a name="218014964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218014964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218014964">(Nov 26 2020 at 15:38)</a>:</h4>
<p>right, because <code>n</code> could be <code>0</code></p>



<a name="218015023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015023">(Nov 26 2020 at 15:38)</a>:</h4>
<p>But this fails:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">foo'</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin.cons</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">)</span> <span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">tidy</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="218015182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015182">(Nov 26 2020 at 15:40)</a>:</h4>
<p>And <span class="user-mention" data-user-id="110032">@Reid Barton</span> I agree that we should not be using tidy, but the main thing I'm trying to accomplish with this is to have some (however rudimentary) automation for proving vectors are nonzero, so that working with projective spaces isn't as awful, and tidy seems like the best choice.</p>



<a name="218015215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015215">(Nov 26 2020 at 15:40)</a>:</h4>
<p>Right but if there's some obscure elaboration issue going on, then getting rid of mysterious gadgets like <code>tidy</code> is the first step</p>



<a name="218015286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015286">(Nov 26 2020 at 15:41)</a>:</h4>
<p>if <code>tidy</code> does the same thing in the working and non-working cases, study that thing</p>



<a name="218015289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015289">(Nov 26 2020 at 15:41)</a>:</h4>
<p><code>tidy</code> isn't mysterious in this case. It just does <code>intros a, simp at *, assumption</code></p>



<a name="218015302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015302">(Nov 26 2020 at 15:41)</a>:</h4>
<p>if it does different things, then there's your problem</p>



<a name="218015312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015312">(Nov 26 2020 at 15:41)</a>:</h4>
<p>great, so get rid of <code>tidy</code> asap</p>



<a name="218015314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015314">(Nov 26 2020 at 15:41)</a>:</h4>
<p>and the <code>simp at *</code> fails for the second one.</p>



<a name="218015391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015391">(Nov 26 2020 at 15:42)</a>:</h4>
<p>Looks like it has to do with <code>matrix.cons_eq_zero_iff</code></p>



<a name="218015423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015423">(Nov 26 2020 at 15:42)</a>:</h4>
<p>So lean can't unify the <code>fin.cons</code> with <code>matrix.vec_cons</code>, I guess?</p>



<a name="218015449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015449">(Nov 26 2020 at 15:42)</a>:</h4>
<p>and then try to figure out whether it's <code>simp</code> not trying to apply the lemma, or whether <code>rw</code> won't do it either, or whether explicitly using the lemma also fails, etc</p>



<a name="218015465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218015465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218015465">(Nov 26 2020 at 15:42)</a>:</h4>
<p>it sounds like you've already done this</p>



<a name="218016408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218016408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218016408">(Nov 26 2020 at 15:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax/near/217952172">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">ᾰ</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">ᾰ</span><span class="o">,</span> <span class="c1">-- works</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">nat.succ</span> <span class="bp">$</span> <span class="n">nat.succ</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">ᾰ</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">ᾰ</span><span class="o">,</span> <span class="c1">-- fails</span>
  <span class="kd">end</span>
 <span class="o">}</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I already extracted the crucial component</p>



<a name="218017390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218017390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218017390">(Nov 26 2020 at 16:03)</a>:</h4>
<p>Playing a bit more with <span class="user-mention" data-user-id="110064">@Kenny Lau</span> 's examples:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">a</span><span class="o">,</span> <span class="c1">-- works</span>
  <span class="n">finish</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">a</span><span class="o">,</span>
    <span class="c1">-- "a : ![1,0] = 0" in context</span>
    <span class="n">change</span> <span class="n">_</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="n">at</span> <span class="n">a</span><span class="o">,</span>
    <span class="c1">-- "a : ![1,0] = 0" in context</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">a</span><span class="o">,</span> <span class="c1">--works</span>
    <span class="n">finish</span><span class="o">,</span>
  <span class="kd">end</span>
 <span class="o">}</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">a</span><span class="o">,</span>
    <span class="n">erw</span> <span class="o">[</span><span class="n">matrix.cons_eq_zero_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">a</span><span class="o">,</span> <span class="c1">--fails</span>
    <span class="n">sorry</span><span class="o">,</span>
  <span class="kd">end</span>
 <span class="o">}</span>
</code></pre></div>



<a name="218018123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218018123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218018123">(Nov 26 2020 at 16:11)</a>:</h4>
<p>Here's a slightly more minimised version:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">zero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">foo</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">zero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">foo</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">erw</span> <span class="n">matrix.cons_eq_zero_iff</span><span class="o">,</span> <span class="c1">-- fails</span>
  <span class="kd">end</span> <span class="o">}</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">zero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">foo</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">change</span> <span class="n">_</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">L</span><span class="o">),</span>
    <span class="n">rw</span> <span class="n">matrix.cons_eq_zero_iff</span><span class="o">,</span> <span class="c1">-- works</span>
    <span class="n">finish</span><span class="o">,</span>
  <span class="kd">end</span> <span class="o">}</span>
</code></pre></div>



<a name="218019289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218019289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218019289">(Nov 26 2020 at 16:22)</a>:</h4>
<p>Okay, I think I'm starting to understand the issue here...</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">refl</span> <span class="c1">-- fails</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">matrix.cons_eq_zero_iff</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">eq_iff_true_of_subsingleton</span><span class="o">,</span>
  <span class="n">tauto</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="218019318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218019318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218019318">(Nov 26 2020 at 16:23)</a>:</h4>
<p>Where is <code>has_zero (fin n \to L)</code> defined?</p>



<a name="218019368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218019368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218019368">(Nov 26 2020 at 16:23)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/pi.has_zero">docs#pi.has_zero</a></p>



<a name="218020223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218020223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218020223">(Nov 26 2020 at 16:33)</a>:</h4>
<p>Well.... I don't know. I think for now I'll just hack it like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span>
<span class="kn">import</span> <span class="n">linear_algebra</span>
<span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">zero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">foo</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">.</span> <span class="n">obviously</span><span class="o">)</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">zero_eq</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="n">matrix.vec_cons</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tidy</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">zero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">}</span>
</code></pre></div>



<a name="218020785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218020785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218020785">(Nov 26 2020 at 16:39)</a>:</h4>
<p>Unfortunately, this hack doesn't work for <code>nonzero_vectors</code>.</p>



<a name="218117742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218117742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218117742">(Nov 27 2020 at 18:11)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">L</span><span class="o">),</span><span class="mi">0</span><span class="o">]</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">intros</span> <span class="n">h</span><span class="o">,</span>
  <span class="c1">--  rw matrix.cons_eq_zero_iff at h, -- works</span>
  <span class="n">simpa</span> <span class="n">using</span> <span class="n">h</span><span class="o">,</span> <span class="c1">-- uses `matrix.cons_eq_zero_iff`</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">h</span><span class="o">,</span>
<span class="c1">--    rw matrix.cons_eq_zero_iff at h, -- fails</span>
<span class="c1">--    rw @matrix.cons_eq_zero_iff L _ at h, -- fails</span>
    <span class="n">rw</span> <span class="bp">@</span><span class="n">matrix.cons_eq_zero_iff</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="c1">-- works, presumably because Lean uses L's zero finally</span>
    <span class="n">simpa</span> <span class="n">using</span> <span class="n">h</span><span class="o">,</span>
  <span class="kd">end</span> <span class="o">}</span>
</code></pre></div>



<a name="218121605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218121605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218121605">(Nov 27 2020 at 19:09)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">vector_space</span> <span class="n">L</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">nonzero_vectors</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_vec</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">nonzero</span> <span class="o">:</span> <span class="n">to_vec</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>

<span class="kn">open</span> <span class="n">matrix</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">cons_eq_zero_iff'</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">v</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">vec_cons</span> <span class="n">x</span> <span class="n">v</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">v</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">cons_eq_zero_iff</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">nonzero_vectors</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_vec</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">],</span>
  <span class="n">nonzero</span> <span class="o">:=</span> <span class="kd">begin</span>
    <span class="n">intros</span> <span class="n">h</span><span class="o">,</span>
    <span class="c1">--erw cons_eq_zero_iff at h, -- fails</span>
    <span class="c1">--rw cons_eq_zero_iff' at h, -- fails</span>
    <span class="n">erw</span> <span class="n">cons_eq_zero_iff'</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="c1">-- works</span>
    <span class="n">simpa</span> <span class="n">using</span> <span class="n">h</span><span class="o">,</span>
  <span class="kd">end</span> <span class="o">}</span>
</code></pre></div>



<a name="218121690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218121690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218121690">(Nov 27 2020 at 19:10)</a>:</h4>
<p>My mental model of <code>erw</code> is "like <code>rw</code>, but tries harder to unify". However my mental model of what is actually going on with unification is poor.</p>



<a name="218121840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218121840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218121840">(Nov 27 2020 at 19:12)</a>:</h4>
<p><code>    simp only [cons_eq_zero_iff'] at h,</code> fails. We need <code>esimp</code> (and <code>esimpa</code>)</p>



<a name="218121845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218121845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218121845">(Nov 27 2020 at 19:13)</a>:</h4>
<p>Is it obvious what needs to be changed in <code>cons_eq_zero_iff'</code> to make <code>rw</code> work as opposed to <code>erw</code>? I think when <code>rw</code> works, then <code>simp</code> can apply it, but that's not the case with <code>erw</code>.</p>



<a name="218122018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122018">(Nov 27 2020 at 19:14)</a>:</h4>
<p>The "mistake" is not made by the lemma, my understanding of the issue is that unification has chosen a rather exotic zero for the right hand side of <code>h</code>, so somehow it's not the lemma's fault that we have to resort to <code>eew</code></p>



<a name="218122053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122053">(Nov 27 2020 at 19:15)</a>:</h4>
<p>or whatever it's called</p>



<a name="218122294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122294">(Nov 27 2020 at 19:18)</a>:</h4>
<p>It <a href="#narrow/stream/116290-rss/topic/Recent.20Commits.20to.20lean4.3Amaster/near/217925875">used to work in Lean 4</a></p>



<a name="218122323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122323">(Nov 27 2020 at 19:19)</a>:</h4>
<p>Isn't there some way to write a simp lemma that would allow us to solve <code>nonzero</code>in the example with <code>by tidy</code>?</p>



<a name="218122343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122343">(Nov 27 2020 at 19:19)</a>:</h4>
<p>I was hoping <code>cons_eq_zero_iff'</code> would do it, but no.</p>



<a name="218122417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122417">(Nov 27 2020 at 19:20)</a>:</h4>
<p>Oh I understand now, you're really trying to emulate the pi zero.</p>



<a name="218122474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122474">(Nov 27 2020 at 19:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">replace</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">cons_eq_zero_iff'.1</span> <span class="n">h</span><span class="o">,</span>
</code></pre></div>
<p>now works, but apparently this isn't good enough for <code>rw</code>. (oh -- the point is that not even this works with <code>cons_eq_zero_iff</code> -- I thought I'd posted some replace code but I ended up getting rw @ to work)</p>



<a name="218122636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122636">(Nov 27 2020 at 19:24)</a>:</h4>
<p>There's a way of turning on some trace messages so you can see exactly why it's failing...</p>



<a name="218122743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122743">(Nov 27 2020 at 19:25)</a>:</h4>
<p><a href="#narrow/stream/113488-general/topic/your.20favourite.20set_option.20option/near/201825547">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/your.20favourite.20set_option.20option/near/201825547</a></p>



<a name="218122865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218122865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218122865">(Nov 27 2020 at 19:27)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">set_option</span> <span class="n">trace.type_context.is_def_eq</span> <span class="n">true</span>
<span class="kd">set_option</span> <span class="n">trace.type_context.is_def_eq_detail</span> <span class="n">true</span>
</code></pre></div>
<p>and then you can try and figure out why the rewrite is failing. I think.</p>



<a name="218123060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218123060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218123060">(Nov 27 2020 at 19:29)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>Trace message</p>
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rewrite</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">did</span> <span class="n">not</span> <span class="n">find</span> <span class="kd">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pattern</span> <span class="k">in</span> <span class="n">the</span> <span class="n">target</span> <span class="n">expression</span>
  <span class="n">_</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="n">_inst_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="bp">⊢</span> <span class="n">false</span>

<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">1</span><span class="o">]:</span> <span class="n">vec_cons</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_4</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">eq</span> <span class="bp">=?=</span> <span class="n">eq</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="n">vec_cons</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_4</span> <span class="bp">=?=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">vec_cons</span> <span class="bp">=?=</span> <span class="n">vec_cons</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">L</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">L</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">=?=</span> <span class="n">fin</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="mi">1</span> <span class="bp">=?=</span> <span class="mi">1</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">assign</span><span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">2</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">=?=</span> <span class="n">fin</span> <span class="mi">2</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">=?=</span> <span class="mi">2</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">pi.has_zero</span> <span class="bp">=?=</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="mi">0</span><span class="o">}</span> <span class="bp">=?=</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="n">add_monoid.zero</span> <span class="o">(</span><span class="n">add_group.to_add_monoid</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">))}</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">5</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_monoid.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">6</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">7</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_comm_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">8</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">9</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span> <span class="bp">=?=</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="n">_x</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">after</span> <span class="n">whnf_core</span><span class="o">:</span> <span class="n">L</span> <span class="bp">=?=</span> <span class="n">L</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">)</span> <span class="n">_x</span> <span class="bp">=?=</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">i</span><span class="o">))</span> <span class="n">_x</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">after</span> <span class="n">whnf_core</span><span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">=?=</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">assign</span> <span class="bp">?</span><span class="n">m_1</span> <span class="n">to</span>
<span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span><span class="o">)</span>
<span class="n">value</span> <span class="n">contains</span> <span class="kn">local</span> <span class="n">declaration</span> <span class="n">_x</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="k">in</span> <span class="n">the</span> <span class="n">scope</span> <span class="n">of</span> <span class="n">the</span> <span class="n">metavariable</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_monoid.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">11</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">12</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_comm_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">13</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">ring.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">14</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">division_ring.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">15</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">16</span><span class="o">]:</span> <span class="n">has_zero.zero</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="n">has_zero.zero</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="mi">0</span><span class="o">}</span> <span class="bp">=?=</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="n">add_monoid.zero</span> <span class="o">(</span><span class="n">add_group.to_add_monoid</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">))}</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">has_zero.zero</span> <span class="bp">=?=</span> <span class="n">has_zero.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span> <span class="bp">=?=</span> <span class="n">fin</span> <span class="mi">2</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="bp">?</span><span class="n">m_1.succ</span> <span class="bp">=?=</span> <span class="mi">2</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">3</span><span class="o">]:</span> <span class="n">pi.has_zero</span> <span class="bp">=?=</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">4</span><span class="o">]:</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span><span class="o">),</span> <span class="mi">0</span><span class="o">}</span> <span class="bp">=?=</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="n">add_monoid.zero</span> <span class="o">(</span><span class="n">add_group.to_add_monoid</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">))}</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">5</span><span class="o">]:</span> <span class="n">has_zero.mk</span> <span class="bp">=?=</span> <span class="n">has_zero.mk</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">5</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_monoid.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">6</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">7</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_comm_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">8</span><span class="o">]:</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">9</span><span class="o">]:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span> <span class="bp">=?=</span> <span class="n">fin</span> <span class="mi">2</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="bp">?</span><span class="n">m_1.succ</span> <span class="bp">=?=</span> <span class="mi">2</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">9</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span> <span class="bp">=?=</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="n">_x</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">after</span> <span class="n">whnf_core</span><span class="o">:</span> <span class="n">L</span> <span class="bp">=?=</span> <span class="n">L</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="bp">.</span><span class="n">succ</span><span class="o">),</span> <span class="bp">?</span><span class="n">m_1</span><span class="o">)</span> <span class="n">_x</span> <span class="bp">=?=</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">i</span><span class="o">))</span> <span class="n">_x</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">after</span> <span class="n">whnf_core</span><span class="o">:</span> <span class="bp">?</span><span class="n">m_1</span> <span class="bp">=?=</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">process_assignment</span> <span class="bp">?</span><span class="n">m_1</span> <span class="o">:=</span> <span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span><span class="o">)</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">assign</span> <span class="bp">?</span><span class="n">m_1</span> <span class="n">to</span>
<span class="n">add_monoid.to_has_zero</span> <span class="o">((</span><span class="bp">λ</span> <span class="o">(</span><span class="n">ᾰ</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span><span class="o">),</span> <span class="n">L</span><span class="o">)</span> <span class="n">_x</span><span class="o">)</span>
<span class="n">value</span> <span class="n">contains</span> <span class="kn">local</span> <span class="n">declaration</span> <span class="n">_x</span> <span class="n">which</span> <span class="n">is</span> <span class="n">not</span> <span class="k">in</span> <span class="n">the</span> <span class="n">scope</span> <span class="n">of</span> <span class="n">the</span> <span class="n">metavariable</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">10</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_monoid.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">11</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">12</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">add_comm_group.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">13</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">ring.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">14</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">division_ring.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">15</span><span class="o">]:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="o">[</span><span class="mi">16</span><span class="o">]:</span> <span class="n">has_zero.zero</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="n">has_zero.zero</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="n">field.zero</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">_x</span> <span class="o">:</span> <span class="n">fin</span> <span class="bp">?</span><span class="n">m_1.succ</span><span class="o">),</span> <span class="mi">0</span><span class="o">}</span> <span class="bp">=?=</span> <span class="o">{</span><span class="n">zero</span> <span class="o">:=</span> <span class="n">add_monoid.zero</span> <span class="o">(</span><span class="n">add_group.to_add_monoid</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="n">L</span><span class="o">))}</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq_detail</span><span class="o">]</span> <span class="n">on</span> <span class="n">failure</span><span class="o">:</span> <span class="n">vec_cons</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_4</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="o">[</span><span class="n">type_context.is_def_eq</span><span class="o">]</span> <span class="n">vec_cons</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_4</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">=?=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">...</span> <span class="n">failed</span>  <span class="o">(</span><span class="n">approximate</span> <span class="n">mode</span><span class="o">)</span>
</code></pre></div>
</div></div>



<a name="218123607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218123607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218123607">(Nov 27 2020 at 19:37)</a>:</h4>
<p>With <code>erw</code> the trace indicates success here:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>...
[type_context.is_def_eq_detail] [13]: 0 =?= field.zero
[type_context.is_def_eq_detail] [14]: has_zero.zero =?= field.zero
[type_context.is_def_eq_detail] on failure: has_zero.zero =?= field.zero
[type_context.is_def_eq_detail] on failure: 0 =?= field.zero
[type_context.is_def_eq_detail] synthesized instances on left
[type_context.is_def_eq_detail] [14]: 0 =?= field.zero
[type_context.is_def_eq_detail] [15]: mul_zero_class.zero =?= field.zero
[type_context.is_def_eq_detail] [16]: monoid_with_zero.zero =?= field.zero
[type_context.is_def_eq_detail] [17]: semiring.zero =?= field.zero
[type_context.is_def_eq_detail] [18]: ring.zero =?= field.zero
[type_context.is_def_eq_detail] [19]: division_ring.zero =?= field.zero
[type_context.is_def_eq_detail] [2]: fin ?m_1.succ =?= fin 2
[type_context.is_def_eq_detail] [3]: ?m_1.succ =?= 2
[type_context.is_def_eq] vec_cons ?m_3 ?m_4 = λ (_x : fin ?m_1.succ), 0 =?= ![1, 0] = 0 ... success  (approximate mode)
</code></pre></div>
<p>With <code>rw</code> the "synthesized instances on left" message never appears and the failure is</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>...
[type_context.is_def_eq_detail] [15]: 0 =?= field.zero
[type_context.is_def_eq_detail] [16]: has_zero.zero =?= field.zero
[type_context.is_def_eq_detail] on failure: has_zero.zero =?= field.zero
[type_context.is_def_eq_detail] on failure: 0 =?= field.zero
[type_context.is_def_eq_detail] on failure: {zero := λ (_x : fin 1.succ), 0} =?= {zero := add_monoid.zero (add_group.to_add_monoid (fin 2 → L))}
[type_context.is_def_eq_detail] [3]: λ (_x : fin 1.succ), 0 =?= add_monoid.zero
[type_context.is_def_eq_detail] [4]: λ (_x : fin 1.succ), 0 =?= add_group.zero
[type_context.is_def_eq_detail] [5]: λ (_x : fin 1.succ), 0 =?= add_comm_group.zero
[type_context.is_def_eq_detail] [6]: λ (_x : fin 1.succ), 0 =?= 0
[type_context.is_def_eq_detail] [7]: 0 =?= 0
[type_context.is_def_eq_detail] [8]: (λ (ᾰ : fin 1.succ), L) _x =?= (λ (i : fin 2), (λ (ᾰ : fin 2), L) i) _x
[type_context.is_def_eq_detail] after whnf_core: L =?= L
[type_context.is_def_eq_detail] [8]: (λ (i : fin 1.succ), ?m_1) _x =?= (λ (i : fin 2), add_monoid.to_has_zero ((λ (ᾰ : fin 2), L) i)) _x
[type_context.is_def_eq_detail] after whnf_core: ?m_1 =?= add_monoid.to_has_zero ((λ (ᾰ : fin 2), L) _x)
[type_context.is_def_eq_detail] process_assignment ?m_1 := add_monoid.to_has_zero ((λ (ᾰ : fin 2), L) _x)
[type_context.is_def_eq_detail] failed to assign ?m_1 to
add_monoid.to_has_zero ((λ (ᾰ : fin 2), L) _x)
value contains local declaration _x which is not in the scope of the metavariable
[type_context.is_def_eq_detail] [8]: 0 =?= add_monoid.zero
[type_context.is_def_eq_detail] [9]: 0 =?= add_group.zero
[type_context.is_def_eq_detail] [10]: 0 =?= add_comm_group.zero
[type_context.is_def_eq_detail] [11]: 0 =?= ring.zero
[type_context.is_def_eq_detail] [12]: 0 =?= division_ring.zero
[type_context.is_def_eq_detail] [13]: 0 =?= field.zero
[type_context.is_def_eq_detail] [14]: has_zero.zero =?= field.zero
[type_context.is_def_eq_detail] on failure: has_zero.zero =?= field.zero
[type_context.is_def_eq_detail] on failure: 0 =?= field.zero
[type_context.is_def_eq_detail] on failure: vec_cons ?m_3 ?m_4 = 0 =?= ![1, 0] = 0
[type_context.is_def_eq] vec_cons ?m_3 ?m_4 = 0 =?= ![1, 0] = 0 ... failed  (approximate mode)
</code></pre></div>



<a name="218123705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Tactic%20doesn%27t%20work%20in%20record%20syntax/near/218123705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Tactic.20doesn't.20work.20in.20record.20syntax.html#218123705">(Nov 27 2020 at 19:38)</a>:</h4>
<p>but now I'm at the limit of my understanding.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>