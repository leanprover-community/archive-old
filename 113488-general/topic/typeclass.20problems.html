---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/typeclass.20problems.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html">typeclass problems</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="128143681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128143681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128143681">(Jun 15 2018 at 22:05)</a>:</h4>
<p>This loop is breaking everything</p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">25</span><span class="o">)</span> <span class="err">?</span><span class="n">x_99</span> <span class="o">:</span> <span class="n">out_param</span> <span class="o">(</span><span class="n">field</span> <span class="err">?</span><span class="n">x_97</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">field_extension</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_101</span> <span class="err">?</span><span class="n">x_102</span> <span class="err">?</span><span class="n">x_103</span> <span class="err">?</span><span class="n">x_104</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">26</span><span class="o">)</span> <span class="err">?</span><span class="n">x_104</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="err">?</span><span class="n">x_101</span> <span class="err">?</span><span class="n">x_102</span> <span class="err">?</span><span class="n">x_103</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">algebraic_field_extension</span><span class="bp">.</span><span class="n">to_field_extension</span> <span class="err">?</span><span class="n">x_105</span> <span class="err">?</span><span class="n">x_106</span> <span class="err">?</span><span class="n">x_107</span> <span class="err">?</span><span class="n">x_108</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">27</span><span class="o">)</span> <span class="err">?</span><span class="n">x_108</span> <span class="o">:</span> <span class="bp">@</span><span class="n">algebraic_field_extension</span> <span class="err">?</span><span class="n">x_105</span> <span class="err">?</span><span class="n">x_106</span> <span class="err">?</span><span class="n">x_107</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">algebraic_closure</span><span class="bp">.</span><span class="n">to_algebraic_field_extension</span> <span class="err">?</span><span class="n">x_109</span> <span class="err">?</span><span class="n">x_110</span> <span class="err">?</span><span class="n">x_111</span> <span class="err">?</span><span class="n">x_112</span>
</pre></div>



<a name="128143694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128143694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128143694">(Jun 15 2018 at 22:05)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">alg_closed_field</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">field</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">alg_closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">α</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">deg</span> <span class="bp">&gt;</span> <span class="mi">1</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">α</span> <span class="n">α</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="n">class</span> <span class="n">field_extension</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">field</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">[</span><span class="n">hom</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="n">f</span><span class="o">]</span>

<span class="kn">instance</span> <span class="n">field_extension</span><span class="bp">.</span><span class="n">to_is_ring_hom</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="o">(</span><span class="n">field_extension</span><span class="bp">.</span><span class="n">f</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">field_extension</span><span class="bp">.</span><span class="n">hom</span> <span class="n">β</span>

<span class="kn">instance</span> <span class="n">field_extension</span><span class="bp">.</span><span class="n">to_algebra</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">field_extension</span><span class="bp">.</span><span class="n">f</span> <span class="n">β</span> <span class="o">}</span>

<span class="n">class</span> <span class="n">algebraic_field_extension</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">algebraic</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">β</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">α</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">α</span> <span class="n">β</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="kn">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">true</span>

<span class="n">class</span> <span class="n">algebraic_closure</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">alg_closed_field</span> <span class="n">β</span><span class="o">,</span> <span class="n">algebraic_field_extension</span> <span class="n">α</span> <span class="n">β</span>

<span class="kn">set_option</span> <span class="n">old_structure_cmd</span> <span class="n">false</span>
</pre></div>



<a name="128143821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128143821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128143821">(Jun 15 2018 at 22:08)</a>:</h4>
<p>I'm not very good at dealing with typeclasses</p>



<a name="128144488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144488">(Jun 15 2018 at 22:23)</a>:</h4>
<p>somehow the same setting with <code>ring</code> instead of <code>field</code> doesn't cause this problem:</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">out_param</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">comm_ring</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">A</span><span class="o">)</span> <span class="o">[</span><span class="n">hom</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="n">f</span><span class="o">]</span>
</pre></div>


<p>This doesn't cause any loops</p>



<a name="128144728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144728">(Jun 15 2018 at 22:28)</a>:</h4>
<p>solution:</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">is_alg_closed_field</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">alg_closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">α</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">deg</span> <span class="bp">&gt;</span> <span class="mi">1</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">α</span> <span class="n">α</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="n">class</span> <span class="n">field_extension</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">field</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">[</span><span class="n">hom</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="n">f</span><span class="o">]</span>

<span class="kn">instance</span> <span class="n">field_extension</span><span class="bp">.</span><span class="n">to_is_ring_hom</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="o">(</span><span class="n">field_extension</span><span class="bp">.</span><span class="n">f</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">field_extension</span><span class="bp">.</span><span class="n">hom</span> <span class="n">β</span>

<span class="kn">instance</span> <span class="n">field_extension</span><span class="bp">.</span><span class="n">to_algebra</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">field_extension</span><span class="bp">.</span><span class="n">f</span> <span class="n">β</span> <span class="o">}</span>

<span class="n">class</span> <span class="n">is_algebraic_field_extension</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">algebraic</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">β</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">f</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="n">α</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">α</span> <span class="n">β</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="n">class</span> <span class="n">is_algebraic_closure</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">field_extension</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">is_alg_closed_field</span> <span class="n">β</span><span class="o">,</span> <span class="n">is_algebraic_field_extension</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Prop</span>
</pre></div>



<a name="128144742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144742">(Jun 15 2018 at 22:29)</a>:</h4>
<p>TLDR: change <code>algebraic_field_extension</code> (not <code>Prop</code>) to <code>is_algebraic_field_extension</code> (<code>Prop</code>) etc</p>



<a name="128144825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144825">(Jun 15 2018 at 22:30)</a>:</h4>
<p>update: it is not true that the <code>algebra</code> causes no problem</p>



<a name="128144857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144857">(Jun 15 2018 at 22:31)</a>:</h4>
<blockquote>
<p><code>out_param (field ?x_97)</code></p>
</blockquote>
<p>not the first time I've seen this today</p>



<a name="128144919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144919">(Jun 15 2018 at 22:32)</a>:</h4>
<p>but <code>module</code> seems to be doing fine</p>



<a name="128144929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144929">(Jun 15 2018 at 22:32)</a>:</h4>
<p>What caused this typeclass search? You never want to find arbitrary fields</p>



<a name="128144937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128144937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128144937">(Jun 15 2018 at 22:32)</a>:</h4>
<p>what stops <code>ring.to_module</code> and <code>class module ... [ring _]</code> from forming a loop?</p>



<a name="128145013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145013">(Jun 15 2018 at 22:34)</a>:</h4>
<blockquote>
<p>What caused this typeclass search? You never want to find arbitrary fields</p>
</blockquote>
<p>I have something involving rings and no fields at all. The searcher wants to know that it has addition. Somehow it got to fields, and then it started the loop</p>



<a name="128145033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145033">(Jun 15 2018 at 22:34)</a>:</h4>
<p>I don't mean just <code>field ?</code>, but also <code>ring ?</code> and other such things</p>



<a name="128145047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145047">(Jun 15 2018 at 22:35)</a>:</h4>
<p>the bad sign is a class on a metavar</p>



<a name="128145075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145075">(Jun 15 2018 at 22:36)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span>  <span class="n">class</span><span class="bp">-</span><span class="kn">instance</span> <span class="n">resolution</span> <span class="n">trace</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">has_zero</span> <span class="err">?</span><span class="n">x_1</span> <span class="err">?</span><span class="n">x_2</span> <span class="err">?</span><span class="n">x_3</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">cardinal</span><span class="bp">.</span><span class="n">has_zero</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">has_zero</span> <span class="err">?</span><span class="n">x_4</span> <span class="err">?</span><span class="n">x_5</span> <span class="err">?</span><span class="n">x_6</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">multiset</span><span class="bp">.</span><span class="n">has_zero</span> <span class="err">?</span><span class="n">x_7</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">unsigned</span><span class="bp">.</span><span class="n">has_zero</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">fin</span><span class="bp">.</span><span class="n">has_zero</span> <span class="err">?</span><span class="n">x_8</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">int</span><span class="bp">.</span><span class="n">has_zero</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_zero</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">no_zero_divisors</span><span class="bp">.</span><span class="n">to_has_zero</span> <span class="err">?</span><span class="n">x_9</span> <span class="err">?</span><span class="n">x_10</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="err">?</span><span class="n">x_10</span> <span class="o">:</span> <span class="n">no_zero_divisors</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">domain</span><span class="bp">.</span><span class="n">to_no_zero_divisors</span> <span class="err">?</span><span class="n">x_11</span> <span class="err">?</span><span class="n">x_12</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="err">?</span><span class="n">x_12</span> <span class="o">:</span> <span class="n">domain</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_nonneg_ring</span><span class="bp">.</span><span class="n">to_domain</span> <span class="err">?</span><span class="n">x_13</span> <span class="err">?</span><span class="n">x_14</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="err">?</span><span class="n">x_12</span> <span class="o">:</span> <span class="n">domain</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">to_domain</span> <span class="err">?</span><span class="n">x_13</span> <span class="err">?</span><span class="n">x_14</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="err">?</span><span class="n">x_14</span> <span class="o">:</span> <span class="n">linear_ordered_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_nonneg_ring</span><span class="bp">.</span><span class="n">to_linear_ordered_ring</span> <span class="err">?</span><span class="n">x_15</span> <span class="err">?</span><span class="n">x_16</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="err">?</span><span class="n">x_14</span> <span class="o">:</span> <span class="n">linear_ordered_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_field</span><span class="bp">.</span><span class="n">to_linear_ordered_ring</span> <span class="err">?</span><span class="n">x_15</span> <span class="err">?</span><span class="n">x_16</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="err">?</span><span class="n">x_16</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">discrete_linear_ordered_field</span><span class="bp">.</span><span class="n">to_linear_ordered_field</span> <span class="err">?</span><span class="n">x_17</span> <span class="err">?</span><span class="n">x_18</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="err">?</span><span class="n">x_14</span> <span class="o">:</span> <span class="n">linear_ordered_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_comm_ring</span><span class="bp">.</span><span class="n">to_linear_ordered_ring</span> <span class="err">?</span><span class="n">x_15</span> <span class="err">?</span><span class="n">x_16</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="err">?</span><span class="n">x_16</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">decidable_linear_ordered_comm_ring</span><span class="bp">.</span><span class="n">to_linear_ordered_comm_ring</span> <span class="err">?</span><span class="n">x_17</span> <span class="err">?</span><span class="n">x_18</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_18</span> <span class="o">:</span> <span class="n">decidable_linear_ordered_comm_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_nonneg_ring</span><span class="bp">.</span><span class="n">to_decidable_linear_ordered_comm_ring</span> <span class="err">?</span><span class="n">x_19</span> <span class="err">?</span><span class="n">x_20</span> <span class="err">?</span><span class="n">x_21</span> <span class="err">?</span><span class="n">x_22</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_18</span> <span class="o">:</span> <span class="n">decidable_linear_ordered_comm_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">int</span><span class="bp">.</span><span class="n">decidable_linear_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_18</span> <span class="o">:</span> <span class="n">decidable_linear_ordered_comm_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">discrete_linear_ordered_field</span><span class="bp">.</span><span class="n">to_decidable_linear_ordered_comm_ring</span> <span class="err">?</span><span class="n">x_19</span> <span class="err">?</span><span class="n">x_20</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="err">?</span><span class="n">x_12</span> <span class="o">:</span> <span class="n">domain</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">division_ring</span><span class="bp">.</span><span class="n">to_domain</span> <span class="err">?</span><span class="n">x_13</span> <span class="err">?</span><span class="n">x_14</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="err">?</span><span class="n">x_14</span> <span class="o">:</span> <span class="n">division_ring</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">field</span><span class="bp">.</span><span class="n">to_division_ring</span> <span class="err">?</span><span class="n">x_15</span> <span class="err">?</span><span class="n">x_16</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="err">?</span><span class="n">x_16</span> <span class="o">:</span> <span class="n">field</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">field_extension</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_17</span> <span class="err">?</span><span class="n">x_18</span> <span class="err">?</span><span class="n">x_19</span> <span class="err">?</span><span class="n">x_20</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_20</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="err">?</span><span class="n">x_17</span> <span class="n">α</span> <span class="err">?</span><span class="n">x_19</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">algebraic_field_extension</span><span class="bp">.</span><span class="n">to_field_extension</span> <span class="err">?</span><span class="n">x_21</span> <span class="err">?</span><span class="n">x_22</span> <span class="err">?</span><span class="n">x_23</span> <span class="err">?</span><span class="n">x_24</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_24</span> <span class="o">:</span> <span class="bp">@</span><span class="n">algebraic_field_extension</span> <span class="err">?</span><span class="n">x_21</span> <span class="n">α</span> <span class="err">?</span><span class="n">x_23</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">algebraic_closure</span><span class="bp">.</span><span class="n">to_algebraic_field_extension</span> <span class="err">?</span><span class="n">x_25</span> <span class="err">?</span><span class="n">x_26</span> <span class="err">?</span><span class="n">x_27</span> <span class="err">?</span><span class="n">x_28</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_27</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_25</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">field_extension</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_29</span> <span class="err">?</span><span class="n">x_30</span> <span class="err">?</span><span class="n">x_31</span> <span class="err">?</span><span class="n">x_32</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="err">?</span><span class="n">x_32</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="err">?</span><span class="n">x_29</span> <span class="err">?</span><span class="n">x_30</span> <span class="err">?</span><span class="n">x_31</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">algebraic_field_extension</span><span class="bp">.</span><span class="n">to_field_extension</span> <span class="err">?</span><span class="n">x_33</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span> <span class="err">?</span><span class="n">x_36</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">9</span><span class="o">)</span> <span class="err">?</span><span class="n">x_36</span> <span class="o">:</span> <span class="bp">@</span><span class="n">algebraic_field_extension</span> <span class="err">?</span><span class="n">x_33</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">algebraic_closure</span><span class="bp">.</span><span class="n">to_algebraic_field_extension</span> <span class="err">?</span><span class="n">x_37</span> <span class="err">?</span><span class="n">x_38</span> <span class="err">?</span><span class="n">x_39</span> <span class="err">?</span><span class="n">x_40</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="err">?</span><span class="n">x_39</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_37</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">field_extension</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_41</span> <span class="err">?</span><span class="n">x_42</span> <span class="err">?</span><span class="n">x_43</span> <span class="err">?</span><span class="n">x_44</span>
</pre></div>



<a name="128145120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145120">(Jun 15 2018 at 22:36)</a>:</h4>
<p>loop the last 3 lines</p>



<a name="128145133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145133">(Jun 15 2018 at 22:36)</a>:</h4>
<p><code>field_extension.to_field</code></p>



<a name="128145134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145134">(Jun 15 2018 at 22:36)</a>:</h4>
<p>kill it</p>



<a name="128145145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145145">(Jun 15 2018 at 22:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">field_extension</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">field</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">[</span><span class="n">hom</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="n">f</span><span class="o">]</span>
</pre></div>



<a name="128145161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145161">(Jun 15 2018 at 22:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">out_param</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">comm_ring</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">A</span><span class="o">)</span> <span class="o">[</span><span class="n">hom</span> <span class="o">:</span> <span class="n">is_ring_hom</span> <span class="n">f</span><span class="o">]</span>
</pre></div>



<a name="128145162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145162">(Jun 15 2018 at 22:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">module</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">out_param</span> <span class="err">$</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">out_param</span> <span class="err">$</span> <span class="n">ring</span> <span class="n">α</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">has_scalar</span> <span class="n">α</span> <span class="n">β</span><span class="o">,</span> <span class="n">add_comm_group</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">smul_add</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">r</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">r</span> <span class="err">•</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">r</span> <span class="err">•</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_smul</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">r</span> <span class="n">s</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="o">(</span><span class="n">r</span> <span class="bp">+</span> <span class="n">s</span><span class="o">)</span> <span class="err">•</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">s</span> <span class="err">•</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_smul</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">r</span> <span class="n">s</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="o">(</span><span class="n">r</span> <span class="bp">*</span> <span class="n">s</span><span class="o">)</span> <span class="err">•</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="n">s</span> <span class="err">•</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">one_smul</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">x</span> <span class="o">:</span> <span class="n">β</span><span class="o">,</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="err">•</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span><span class="o">)</span>
</pre></div>



<a name="128145165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145165">(Jun 15 2018 at 22:37)</a>:</h4>
<p>(not that <code>algebra</code> is not causing problem)</p>



<a name="128145204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145204">(Jun 15 2018 at 22:38)</a>:</h4>
<p>why does <code>module</code> have no problem</p>



<a name="128145313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145313">(Jun 15 2018 at 22:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> what should I replace it with?</p>



<a name="128145315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128145315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128145315">(Jun 15 2018 at 22:41)</a>:</h4>
<p>I see</p>



<a name="128147101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128147101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128147101">(Jun 15 2018 at 23:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">subring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_mem</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span><span class="o">)</span>
<span class="o">(</span><span class="n">neg_mem</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span><span class="o">},</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="bp">-</span><span class="n">x</span> <span class="err">∈</span> <span class="n">S</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_mem</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span><span class="o">)</span>
<span class="o">(</span><span class="n">one_mem</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">α</span><span class="o">)</span> <span class="err">∈</span> <span class="n">S</span><span class="o">)</span>

<span class="kn">open</span> <span class="n">subring</span>

<span class="kn">instance</span> <span class="n">subring</span><span class="bp">.</span><span class="n">to_comm_ring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">subring</span> <span class="n">α</span> <span class="n">S</span><span class="o">]</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">S</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add</span>            <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">,</span> <span class="n">add_mem</span> <span class="n">hx</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">add_assoc</span>      <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">add_assoc</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
  <span class="n">zero</span>           <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span> <span class="n">eq</span><span class="bp">.</span><span class="n">subst</span> <span class="o">(</span><span class="n">add_neg_self</span> <span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">α</span><span class="o">))</span> <span class="err">$</span> <span class="n">add_mem</span> <span class="o">(</span><span class="n">one_mem</span> <span class="n">S</span><span class="o">)</span> <span class="err">$</span> <span class="n">neg_mem</span> <span class="err">$</span> <span class="n">one_mem</span> <span class="n">S</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">zero_add</span>       <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">zero_add</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">add_zero</span>       <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">add_zero</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">neg</span>            <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨-</span><span class="n">x</span><span class="o">,</span> <span class="n">neg_mem</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">add_left_neg</span>   <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">add_left_neg</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">add_comm</span>       <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">add_comm</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">mul</span>            <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">,</span> <span class="n">mul_mem</span> <span class="n">hx</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">mul_assoc</span>      <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">mul_assoc</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
  <span class="n">one</span>            <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="n">one_mem</span> <span class="n">S</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">one_mul</span>        <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">one_mul</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">mul_one</span>        <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">mul_one</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">left_distrib</span>   <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">left_distrib</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
  <span class="n">right_distrib</span>  <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">right_distrib</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
  <span class="n">mul_comm</span>       <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">mul_comm</span> <span class="n">x</span> <span class="n">y</span> <span class="o">}</span>
</pre></div>



<a name="128147109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128147109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128147109">(Jun 15 2018 at 23:29)</a>:</h4>
<p>will this <code>instance</code> cause problems?</p>



<a name="128147157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128147157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128147157">(Jun 15 2018 at 23:30)</a>:</h4>
<p>if so, what should I replace it with?</p>



<a name="128150369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128150369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128150369">(Jun 16 2018 at 01:20)</a>:</h4>
<p>adding <code>by letI := subring.to_comm_ring _ S</code> to every definition and theorem is not very feasible</p>



<a name="128150378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128150378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128150378">(Jun 16 2018 at 01:20)</a>:</h4>
<p>and is wasting me a lot of time</p>



<a name="128150382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128150382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128150382">(Jun 16 2018 at 01:20)</a>:</h4>
<p>but as soon as I make it an instance, everything crashes</p>



<a name="128162502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128162502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128162502">(Jun 16 2018 at 09:11)</a>:</h4>
<p>what is this</p>



<a name="128162503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128162503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128162503">(Jun 16 2018 at 09:11)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">Hausdorff_abelianization</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">t</span> <span class="o">:</span> <span class="n">topological_group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">left_cosets</span> <span class="o">(</span><span class="n">abelianization</span> <span class="n">G</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">closure</span> <span class="o">{</span><span class="mi">1</span><span class="o">})</span>
  <span class="o">(</span><span class="k">by</span> <span class="n">apply_instance</span><span class="o">)</span>
</pre></div>



<a name="128162544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128162544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128162544">(Jun 16 2018 at 09:12)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="err">?</span><span class="n">x_60</span> <span class="o">:</span> <span class="n">topological_group</span> <span class="n">G</span> <span class="o">:=</span> <span class="n">t</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
</pre></div>



<a name="128162755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128162755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128162755">(Jun 16 2018 at 09:21)</a>:</h4>
<p>Lean, they <em>are</em> the same</p>



<a name="128165992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128165992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128165992">(Jun 16 2018 at 11:26)</a>:</h4>
<p>if <code>subring.to_comm_ring</code> causes problems then why doesn't <code>subtype.group</code> cause problems?</p>



<a name="128168992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128168992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128168992">(Jun 16 2018 at 13:29)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> it can be avoided by using universes instead of <code>Type*</code></p>
</blockquote>
<p><a href="#narrow/stream/113488-general/subject/unfolding.20notation.20in.20theorem.20vs.20def.2Finstance/near/128167978" title="#narrow/stream/113488-general/subject/unfolding.20notation.20in.20theorem.20vs.20def.2Finstance/near/128167978">https://leanprover.zulipchat.com/#narrow/stream/113488-general/subject/unfolding.20notation.20in.20theorem.20vs.20def.2Finstance/near/128167978</a></p>



<a name="128168993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128168993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128168993">(Jun 16 2018 at 13:29)</a>:</h4>
<p>oh and of <strong><em>course</em></strong> the same trick applies to this case</p>



<a name="128168994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128168994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128168994">(Jun 16 2018 at 13:29)</a>:</h4>
<p>there's no loop any more</p>



<a name="128168995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128168995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128168995">(Jun 16 2018 at 13:29)</a>:</h4>
<p>once I use <code>Type u</code> instead of <code>Type*</code></p>



<a name="128169044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128169044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128169044">(Jun 16 2018 at 13:31)</a>:</h4>
<blockquote>
<p>Lean, they <em>are</em> the same</p>
</blockquote>
<p><a href="#narrow/stream/113488-general/subject/typeclass.20problems/near/128162755" title="#narrow/stream/113488-general/subject/typeclass.20problems/near/128162755">https://leanprover.zulipchat.com/#narrow/stream/113488-general/subject/typeclass.20problems/near/128162755</a></p>



<a name="128169046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128169046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128169046">(Jun 16 2018 at 13:31)</a>:</h4>
<p>ditto</p>



<a name="128174540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174540">(Jun 16 2018 at 17:03)</a>:</h4>
<p>Is this a good instance?</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">Hausdorff_abelianization</span><span class="bp">.</span><span class="n">setoid</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
  <span class="o">[</span><span class="n">topological_group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="n">G</span> <span class="o">:=</span>
<span class="n">left_rel</span> <span class="o">(</span><span class="n">closure</span> <span class="o">(</span><span class="n">commutator_subgroup</span> <span class="n">G</span> <span class="n">set</span><span class="bp">.</span><span class="n">univ</span><span class="o">))</span>
</pre></div>



<a name="128174678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174678">(Jun 16 2018 at 17:08)</a>:</h4>
<p>A local instance maybe</p>



<a name="128174679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174679">(Jun 16 2018 at 17:08)</a>:</h4>
<p>it looks a bit domain specific</p>



<a name="128174680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174680">(Jun 16 2018 at 17:08)</a>:</h4>
<p>domain specific?</p>



<a name="128174681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174681">(Jun 16 2018 at 17:08)</a>:</h4>
<p>is there a reason that should be the canonical equivalence on any top group?</p>



<a name="128174686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174686">(Jun 16 2018 at 17:09)</a>:</h4>
<p>it's the functor from TopGrp to AbelianHasudorffTopGrp</p>



<a name="128174688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174688">(Jun 16 2018 at 17:09)</a>:</h4>
<p>Kenny, for every topological group G, there should be at most 1 instance of <code>setoid G</code>.</p>



<a name="128174689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174689">(Jun 16 2018 at 17:09)</a>:</h4>
<p>I see</p>



<a name="128174690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174690">(Jun 16 2018 at 17:09)</a>:</h4>
<p>ok this isn't canonical then</p>



<a name="128174737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174737">(Jun 16 2018 at 17:10)</a>:</h4>
<p>So you should probably not make this an instance. But possibly define AbHausTopGrp, and make it an instance of that...</p>



<a name="128174743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174743">(Jun 16 2018 at 17:11)</a>:</h4>
<p>I'm glad I didn't switch the first two words of the name of the category... :D</p>



<a name="128174782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174782">(Jun 16 2018 at 17:12)</a>:</h4>
<p>I don't get what would be wrong with that? ... Am I overly naive, and missing a joke?</p>



<a name="128174789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174789">(Jun 16 2018 at 17:13)</a>:</h4>
<p>it sounds similar to a rude word in german</p>



<a name="128174830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174830">(Jun 16 2018 at 17:14)</a>:</h4>
<p>Ach so, ich muss noch viel Deutsch üben. Und ich kenn kein unhöfliche Worten.</p>



<a name="128174838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174838">(Jun 16 2018 at 17:15)</a>:</h4>
<p>"Hau ab" means "piss off"</p>



<a name="128174879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128174879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128174879">(Jun 16 2018 at 17:16)</a>:</h4>
<p>Wunderbar</p>



<a name="128218541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128218541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128218541">(Jun 17 2018 at 22:12)</a>:</h4>
<p><a href="/user_uploads/3121/THVijpQP7DblIbSyWC9G2hGx/2018-06-17-2.png" target="_blank" title="2018-06-17-2.png">2018-06-17-2.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/THVijpQP7DblIbSyWC9G2hGx/2018-06-17-2.png" target="_blank" title="2018-06-17-2.png"><img src="/user_uploads/3121/THVijpQP7DblIbSyWC9G2hGx/2018-06-17-2.png"></a></div>



<a name="128218546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128218546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128218546">(Jun 17 2018 at 22:13)</a>:</h4>
<p>when I turn <code>trace.class_instances</code> on, there's nothing peculiar, except the <code>has_sizeof</code> thing getting pretty long</p>



<a name="128218550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128218550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128218550">(Jun 17 2018 at 22:13)</a>:</h4>
<p>that option is not really helpful in my experience</p>



<a name="128218552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128218552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128218552">(Jun 17 2018 at 22:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="128219542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219542">(Jun 17 2018 at 22:48)</a>:</h4>
<p>oh and the depth of the class instance search never went to 6</p>



<a name="128219604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219604">(Jun 17 2018 at 22:51)</a>:</h4>
<p>and I don't think <code>cogroup.base_change_left</code> is the problem, after looking at the trace</p>



<a name="128219700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219700">(Jun 17 2018 at 22:55)</a>:</h4>
<p>it's here: <a href="https://github.com/kckennylau/local-langlands-abelian/blob/master/src/torus.lean#L136" target="_blank" title="https://github.com/kckennylau/local-langlands-abelian/blob/master/src/torus.lean#L136">https://github.com/kckennylau/local-langlands-abelian/blob/master/src/torus.lean#L136</a></p>



<a name="128219741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219741">(Jun 17 2018 at 22:56)</a>:</h4>
<p>Why does it need an instance of <code>has_sizeof</code>?</p>



<a name="128219742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219742">(Jun 17 2018 at 22:56)</a>:</h4>
<p>no idea</p>



<a name="128219743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219743">(Jun 17 2018 at 22:57)</a>:</h4>
<p>to build a structure, I think?</p>



<a name="128219748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219748">(Jun 17 2018 at 22:57)</a>:</h4>
<p>Please help me, my deadline is in like 12 hours</p>



<a name="128219751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219751">(Jun 17 2018 at 22:57)</a>:</h4>
<p>Your screenshot is not telling me much. If you comment one field declaration at a time, when does it stop failing?</p>



<a name="128219752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219752">(Jun 17 2018 at 22:57)</a>:</h4>
<p>as soon as I remove the last field</p>



<a name="128219907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219907">(Jun 17 2018 at 23:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> is there other information I can provide?</p>



<a name="128219909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219909">(Jun 17 2018 at 23:03)</a>:</h4>
<p>I think your project needs mathlib</p>



<a name="128219910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219910">(Jun 17 2018 at 23:03)</a>:</h4>
<p>I'm building it on my machine to have a closer look</p>



<a name="128219911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219911">(Jun 17 2018 at 23:03)</a>:</h4>
<p>thank you very much</p>



<a name="128219912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219912">(Jun 17 2018 at 23:03)</a>:</h4>
<p>yes, it does require mathlib</p>



<a name="128219951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219951">(Jun 17 2018 at 23:04)</a>:</h4>
<p>Is it possible you did not commit the latest version of <code>leanpkg.toml</code>? (I don't need it, I can fix it but in general, that makes things smoother for people trying your project)</p>



<a name="128219960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219960">(Jun 17 2018 at 23:05)</a>:</h4>
<p>oh I didn't really set it up</p>



<a name="128219961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219961">(Jun 17 2018 at 23:05)</a>:</h4>
<p>Ah ok. Just to be sure, do you use Lean 3.4.1 and the latest mathlib?</p>



<a name="128219999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128219999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128219999">(Jun 17 2018 at 23:06)</a>:</h4>
<p>yes</p>



<a name="128220051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220051">(Jun 17 2018 at 23:08)</a>:</h4>
<p>ok not exactly the latest</p>



<a name="128220052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220052">(Jun 17 2018 at 23:08)</a>:</h4>
<p>i'm on mathlib commit fe590ca272a41bb321a13be505964e78cad1e731</p>



<a name="128220055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220055">(Jun 17 2018 at 23:09)</a>:</h4>
<p>third from latest</p>



<a name="128220966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220966">(Jun 17 2018 at 23:43)</a>:</h4>
<p>In this expression <code>(tensor_a F split.S T)</code> you get into trouble because <code>split.S</code> is a set but a type is expected. If you replace it with <code>subtype split.S</code>, type is required to have a <code>comm_ring</code> instance which you only have for <code>T</code></p>



<a name="128220967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220967">(Jun 17 2018 at 23:43)</a>:</h4>
<p>:o</p>



<a name="128220968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220968">(Jun 17 2018 at 23:43)</a>:</h4>
<p>thanks</p>



<a name="128220970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128220970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128220970">(Jun 17 2018 at 23:43)</a>:</h4>
<p>do you have a fix?</p>



<a name="128221062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221062">(Jun 17 2018 at 23:46)</a>:</h4>
<p>No, it really depends on what you're trying to do. If you actually want <code>subtype split.S</code>, you'd need to add <code>[comm_ring (subtype split.S)]</code> to the local instances which would get hairy because <code>split</code> is a field. Maybe replacing <code>split.S</code> with <code>T</code> would suit your purpose, in which case, the fit is perfect because you already have a <code>comm_ring T</code> instance</p>



<a name="128221064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221064">(Jun 17 2018 at 23:46)</a>:</h4>
<p>I can't just change my deifnition like that?</p>



<a name="128221065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221065">(Jun 17 2018 at 23:46)</a>:</h4>
<p>Which one?</p>



<a name="128221070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221070">(Jun 17 2018 at 23:47)</a>:</h4>
<p>replacing <code>split.S</code> with <code>T</code>?</p>



<a name="128221072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221072">(Jun 17 2018 at 23:47)</a>:</h4>
<p>That might work. I haven't tried it but that would fix that particular problem</p>



<a name="128221074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221074">(Jun 17 2018 at 23:47)</a>:</h4>
<p>I mean, it would be a wrong definition</p>



<a name="128221116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221116">(Jun 17 2018 at 23:48)</a>:</h4>
<p>What would be the right definition?</p>



<a name="128221117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221117">(Jun 17 2018 at 23:48)</a>:</h4>
<p><code>split.S</code> as it is</p>



<a name="128221121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221121">(Jun 17 2018 at 23:48)</a>:</h4>
<p>That would be nonsense: that's not type correct.</p>



<a name="128221129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221129">(Jun 17 2018 at 23:49)</a>:</h4>
<p>Unless your <code>tensor_a</code> definition is wrong and it should take a set there, not a type</p>



<a name="128221130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221130">(Jun 17 2018 at 23:49)</a>:</h4>
<p>I'm coercing a set to a type</p>



<a name="128221134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221134">(Jun 17 2018 at 23:49)</a>:</h4>
<p>it's done automatically</p>



<a name="128221135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221135">(Jun 17 2018 at 23:49)</a>:</h4>
<p>I do it every time</p>



<a name="128221186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221186">(Jun 17 2018 at 23:51)</a>:</h4>
<p>Right but that type is then expected to be a commutative ring. I'm not sure how that can be proved automatically</p>



<a name="128221190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221190">(Jun 17 2018 at 23:51)</a>:</h4>
<p>I have a working version above it, one can trace class instance</p>



<a name="128221228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221228">(Jun 17 2018 at 23:52)</a>:</h4>
<p>I think it will go through subfield -&gt; field -&gt; comm_ring</p>



<a name="128221235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221235">(Jun 17 2018 at 23:52)</a>:</h4>
<p>How do you prove that it's a subfield?</p>



<a name="128221237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221237">(Jun 17 2018 at 23:52)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">finite_Galois_intermediate_extension</span><span class="bp">.</span><span class="n">to_subfield</span>
</pre></div>



<a name="128221239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221239">(Jun 17 2018 at 23:52)</a>:</h4>
<p>L132 of field_extensions.lean</p>



<a name="128221248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221248">(Jun 17 2018 at 23:53)</a>:</h4>
<p>right, I just realized, there should be no problem, because there's a working version right above it!</p>



<a name="128221291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221291">(Jun 17 2018 at 23:54)</a>:</h4>
<p>Which line?</p>



<a name="128221292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221292">(Jun 17 2018 at 23:54)</a>:</h4>
<p>The <code>#check</code> one</p>



<a name="128221293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221293">(Jun 17 2018 at 23:54)</a>:</h4>
<p>L139</p>



<a name="128221301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221301">(Jun 17 2018 at 23:55)</a>:</h4>
<p>oops</p>



<a name="128221302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221302">(Jun 17 2018 at 23:55)</a>:</h4>
<p>L123</p>



<a name="128221303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221303">(Jun 17 2018 at 23:55)</a>:</h4>
<p><a href="https://github.com/kckennylau/local-langlands-abelian/blob/master/src/torus.lean#L123" target="_blank" title="https://github.com/kckennylau/local-langlands-abelian/blob/master/src/torus.lean#L123">https://github.com/kckennylau/local-langlands-abelian/blob/master/src/torus.lean#L123</a></p>



<a name="128221304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221304">(Jun 17 2018 at 23:55)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
  <span class="o">(</span><span class="n">AC</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">[</span><span class="n">field_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_algebraic_closure</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">cogroup</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span>
<span class="o">(</span><span class="n">split</span> <span class="o">:</span> <span class="n">finite_Galois_intermediate_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">)</span>
<span class="o">(</span><span class="n">rank</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span>
<span class="bp">@</span><span class="n">cogroup_iso</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="bp">_</span> <span class="o">(</span><span class="n">tensor_a</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">tensor_a</span><span class="bp">.</span><span class="n">comm_ring</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
  <span class="o">(</span><span class="n">base_change_left</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">GL₁ⁿ</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">rank</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span>
  <span class="o">(</span><span class="n">cogroup</span><span class="bp">.</span><span class="n">base_change_left</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">GL₁ⁿ</span><span class="bp">.</span><span class="n">cogroup</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
</pre></div>



<a name="128221344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221344">(Jun 17 2018 at 23:56)</a>:</h4>
<p>If I change that <code>check</code> into a <code>def</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
  <span class="o">(</span><span class="n">AC</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">[</span><span class="n">field_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_algebraic_closure</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">cogroup</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span>
<span class="o">(</span><span class="n">split</span> <span class="o">:</span> <span class="n">finite_Galois_intermediate_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">)</span>
<span class="o">(</span><span class="n">rank</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span>
<span class="bp">@</span><span class="n">cogroup_iso</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="bp">_</span> <span class="o">(</span><span class="n">tensor_a</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">tensor_a</span><span class="bp">.</span><span class="n">comm_ring</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
  <span class="o">(</span><span class="n">base_change_left</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">GL₁ⁿ</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">rank</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span>
  <span class="o">(</span><span class="n">cogroup</span><span class="bp">.</span><span class="n">base_change_left</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">GL₁ⁿ</span><span class="bp">.</span><span class="n">cogroup</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
</pre></div>



<a name="128221345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221345">(Jun 17 2018 at 23:56)</a>:</h4>
<p>I get I lot of errors</p>



<a name="128221352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221352">(Jun 17 2018 at 23:57)</a>:</h4>
<p>curious</p>



<a name="128221354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221354">(Jun 17 2018 at 23:57)</a>:</h4>
<p><a href="/user_uploads/3121/K4n0zheF40urE2YaifViOPKA/Screen-Shot-2018-06-17-at-7.57.01-PM.png" target="_blank" title="Screen-Shot-2018-06-17-at-7.57.01-PM.png">Screen-Shot-2018-06-17-at-7.57.01-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/K4n0zheF40urE2YaifViOPKA/Screen-Shot-2018-06-17-at-7.57.01-PM.png" target="_blank" title="Screen-Shot-2018-06-17-at-7.57.01-PM.png"><img src="/user_uploads/3121/K4n0zheF40urE2YaifViOPKA/Screen-Shot-2018-06-17-at-7.57.01-PM.png"></a></div>



<a name="128221356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221356">(Jun 17 2018 at 23:57)</a>:</h4>
<p>I think you're asking a lot of type class inference</p>



<a name="128221395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221395">(Jun 17 2018 at 23:58)</a>:</h4>
<p>heh...</p>



<a name="128221397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221397" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221397">(Jun 17 2018 at 23:58)</a>:</h4>
<p>how about I move them before the colon</p>



<a name="128221398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221398">(Jun 17 2018 at 23:58)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
  <span class="o">(</span><span class="n">AC</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">[</span><span class="n">field_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_algebraic_closure</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">cogroup</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span>
<span class="o">(</span><span class="n">split</span> <span class="o">:</span> <span class="n">finite_Galois_intermediate_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">)</span>
<span class="o">(</span><span class="n">rank</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">cogroup_iso</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="bp">_</span> <span class="o">(</span><span class="n">tensor_a</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">tensor_a</span><span class="bp">.</span><span class="n">comm_ring</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
  <span class="o">(</span><span class="n">base_change_left</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">GL₁ⁿ</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">rank</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span>
  <span class="o">(</span><span class="n">cogroup</span><span class="bp">.</span><span class="n">base_change_left</span> <span class="n">F</span> <span class="n">split</span><span class="bp">.</span><span class="n">S</span> <span class="n">T</span><span class="o">)</span>
  <span class="o">(</span><span class="n">GL₁ⁿ</span><span class="bp">.</span><span class="n">cogroup</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
</pre></div>



<a name="128221399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221399">(Jun 17 2018 at 23:58)</a>:</h4>
<p>no errors!</p>



<a name="128221404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221404">(Jun 17 2018 at 23:59)</a>:</h4>
<p>also I looked at the trace as I said before</p>



<a name="128221407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221407">(Jun 17 2018 at 23:59)</a>:</h4>
<p>You're right, I didn't do it well</p>



<a name="128221408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221408">(Jun 17 2018 at 23:59)</a>:</h4>
<p>there is no issue with the typeclass inferences</p>



<a name="128221409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221409">(Jun 17 2018 at 23:59)</a>:</h4>
<p>and the max depth is 5</p>



<a name="128221412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221412">(Jun 17 2018 at 23:59)</a>:</h4>
<p>there should not be any error</p>



<a name="128221463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221463">(Jun 18 2018 at 00:00)</a>:</h4>
<p>Try:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">torus</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
  <span class="o">(</span><span class="n">AC</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">[</span><span class="n">field_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_algebraic_closure</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">cogroup</span> <span class="n">F</span> <span class="n">T</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">split</span> <span class="o">:</span> <span class="n">finite_Galois_intermediate_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">)</span>
<span class="o">(</span><span class="n">rank</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span>
<span class="o">(</span><span class="n">splits</span> <span class="o">:</span> <span class="n">foo</span> <span class="n">F</span> <span class="n">AC</span> <span class="n">T</span> <span class="n">split</span> <span class="n">rank</span><span class="o">)</span>
</pre></div>



<a name="128221471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221471">(Jun 18 2018 at 00:01)</a>:</h4>
<p>what the actual</p>



<a name="128221475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221475">(Jun 18 2018 at 00:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> you need to see this</p>



<a name="128221518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221518">(Jun 18 2018 at 00:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> what do you think</p>



<a name="128221525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221525">(Jun 18 2018 at 00:03)</a>:</h4>
<p>I'm not actually sure why the other one wouldn't work. In general, there's nothing wrong with breaking down your definitions into smaller pieces though</p>



<a name="128221567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221567">(Jun 18 2018 at 00:04)</a>:</h4>
<p>I see</p>



<a name="128221763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221763">(Jun 18 2018 at 00:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> how should I break this loop?</p>



<a name="128221764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221764">(Jun 18 2018 at 00:12)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_31</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_6</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_31</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">subfield</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span> <span class="err">?</span><span class="n">x_36</span> <span class="err">?</span><span class="n">x_37</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_31</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">topological_field</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_38</span> <span class="err">?</span><span class="n">x_39</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_31</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_field</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_35</span> <span class="o">:</span> <span class="n">linear_ordered_field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">discrete_linear_ordered_field</span><span class="bp">.</span><span class="n">to_linear_ordered_field</span> <span class="err">?</span><span class="n">x_36</span> <span class="err">?</span><span class="n">x_37</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_37</span> <span class="o">:</span> <span class="n">discrete_linear_ordered_field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="n">rat</span><span class="bp">.</span><span class="n">discrete_linear_ordered_field</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_31</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">discrete_field</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_35</span> <span class="o">:</span> <span class="n">discrete_field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="n">rat</span><span class="bp">.</span><span class="n">field_rat</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_35</span> <span class="o">:</span> <span class="n">discrete_field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">discrete_linear_ordered_field</span><span class="bp">.</span><span class="n">to_discrete_field</span> <span class="err">?</span><span class="n">x_36</span> <span class="err">?</span><span class="n">x_37</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_37</span> <span class="o">:</span> <span class="n">discrete_linear_ordered_field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="n">rat</span><span class="bp">.</span><span class="n">discrete_linear_ordered_field</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_30</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_28</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">subfield</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span> <span class="err">?</span><span class="n">x_36</span> <span class="err">?</span><span class="n">x_37</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_35</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_34</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_37</span> <span class="o">:</span> <span class="bp">@</span><span class="n">subfield</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="err">?</span><span class="n">x_36</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">finite_Galois_intermediate_extension</span><span class="bp">.</span><span class="n">to_subfield</span> <span class="err">?</span><span class="n">x_38</span> <span class="err">?</span><span class="n">x_39</span> <span class="err">?</span><span class="n">x_40</span> <span class="err">?</span><span class="n">x_41</span> <span class="err">?</span><span class="n">x_42</span> <span class="err">?</span><span class="n">x_43</span> <span class="err">?</span><span class="n">x_44</span> <span class="err">?</span><span class="n">x_45</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_39</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_38</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_41</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_42</span> <span class="o">:</span> <span class="bp">@</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_8</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_43</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="n">AC</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_9</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_43</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="n">AC</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">is_intermediate_field</span><span class="bp">.</span><span class="n">to_field_extension&#39;</span> <span class="err">?</span><span class="n">x_46</span> <span class="err">?</span><span class="n">x_47</span> <span class="err">?</span><span class="n">x_48</span> <span class="err">?</span><span class="n">x_49</span> <span class="err">?</span><span class="n">x_50</span> <span class="err">?</span><span class="n">x_51</span> <span class="err">?</span><span class="n">x_52</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_43</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="n">AC</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">is_intermediate_field</span><span class="bp">.</span><span class="n">to_field_extension</span> <span class="err">?</span><span class="n">x_53</span> <span class="err">?</span><span class="n">x_54</span> <span class="err">?</span><span class="n">x_55</span> <span class="err">?</span><span class="n">x_56</span> <span class="err">?</span><span class="n">x_57</span> <span class="err">?</span><span class="n">x_58</span> <span class="err">?</span><span class="n">x_59</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_42</span> <span class="o">:</span> <span class="bp">@</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">is_algebraic_closure</span><span class="bp">.</span><span class="n">to_is_alg_closed_field</span> <span class="err">?</span><span class="n">x_46</span> <span class="err">?</span><span class="n">x_47</span> <span class="err">?</span><span class="n">x_48</span> <span class="err">?</span><span class="n">x_49</span> <span class="err">?</span><span class="n">x_50</span> <span class="err">?</span><span class="n">x_51</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="err">?</span><span class="n">x_48</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_46</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="err">?</span><span class="n">x_49</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="err">?</span><span class="n">x_50</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="n">AC</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_9</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="err">?</span><span class="n">x_50</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="n">AC</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">is_intermediate_field</span><span class="bp">.</span><span class="n">to_field_extension&#39;</span> <span class="err">?</span><span class="n">x_52</span> <span class="err">?</span><span class="n">x_53</span> <span class="err">?</span><span class="n">x_54</span> <span class="err">?</span><span class="n">x_55</span> <span class="err">?</span><span class="n">x_56</span> <span class="err">?</span><span class="n">x_57</span> <span class="err">?</span><span class="n">x_58</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">8</span><span class="o">)</span> <span class="err">?</span><span class="n">x_50</span> <span class="o">:</span> <span class="bp">@</span><span class="n">field_extension</span> <span class="n">AC</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">is_intermediate_field</span><span class="bp">.</span><span class="n">to_field_extension</span> <span class="err">?</span><span class="n">x_59</span> <span class="err">?</span><span class="n">x_60</span> <span class="err">?</span><span class="n">x_61</span> <span class="err">?</span><span class="n">x_62</span> <span class="err">?</span><span class="n">x_63</span> <span class="err">?</span><span class="n">x_64</span> <span class="err">?</span><span class="n">x_65</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
</pre></div>



<a name="128221823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221823">(Jun 18 2018 at 00:15)</a>:</h4>
<p>There seems to be a circular dependency between your instances. You should try to guarantee that something decreases (syntactically) whenever you apply an instance. For example, <code>instance [decidable_eq a] : decidable_eq (list a) := ... </code> is such an instance. It is about <code>list a</code> and all the instances it relies on involve simpler expressions.</p>



<a name="128221863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221863">(Jun 18 2018 at 00:16)</a>:</h4>
<p>sorry but could you explain what you mean by decreasing?</p>



<a name="128221918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221918">(Jun 18 2018 at 00:19)</a>:</h4>
<p>If you compare <code>a</code> and <code>list a</code> (one is a type in an assumed instance, the other, in the head of the instance) <code>list a</code> is a more complex expression than <code>a</code>. That means that if I look for an instance of <code>decidable_eq (list a)</code> and I apply the above instance, I'm decreasing the size of my problem so I'm getting closer to a solution. If every instance decreases the size of the problem, you can't search forever. (just like with structural recursion)</p>



<a name="128221973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221973">(Jun 18 2018 at 00:20)</a>:</h4>
<p>hmm... but there are times at which I would need to infer simpler instances from complex instances?</p>



<a name="128221980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221980">(Jun 18 2018 at 00:21)</a>:</h4>
<p>like <code>field</code> from <code>discrete_linear_ordered_field</code>?</p>



<a name="128221981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221981">(Jun 18 2018 at 00:21)</a>:</h4>
<p>sure</p>



<a name="128221982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221982">(Jun 18 2018 at 00:21)</a>:</h4>
<p>or sometimes I need to infer a single instance from like 10 instances</p>



<a name="128221984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128221984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128221984">(Jun 18 2018 at 00:21)</a>:</h4>
<p>do you have general workarounds?</p>



<a name="128222030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222030">(Jun 18 2018 at 00:23)</a>:</h4>
<p>A single instance from 10 instances is not a problem as long as each instance is smaller than the initial one</p>



<a name="128222031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222031">(Jun 18 2018 at 00:23)</a>:</h4>
<p>hmm I still don't know how to judge whether two instances are smaller</p>



<a name="128222032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222032">(Jun 18 2018 at 00:23)</a>:</h4>
<p>In the case of <code>discrete_linear_ordered_field</code>, does it not <code>extend</code> <code>field</code>?</p>



<a name="128222034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222034">(Jun 18 2018 at 00:23)</a>:</h4>
<p>I mean, your examples are quite obvious</p>



<a name="128222036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222036">(Jun 18 2018 at 00:24)</a>:</h4>
<p>yes it does</p>



<a name="128222077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222077">(Jun 18 2018 at 00:24)</a>:</h4>
<p>I think</p>



<a name="128222081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222081">(Jun 18 2018 at 00:24)</a>:</h4>
<p>That should be enough, no? You don't need an instance on top of that</p>



<a name="128222082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222082">(Jun 18 2018 at 00:24)</a>:</h4>
<p>this is a bad instance then?</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">subring</span><span class="bp">.</span><span class="n">to_comm_ring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">subring</span> <span class="n">α</span> <span class="n">S</span><span class="o">]</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">S</span> <span class="o">:=</span>
</pre></div>



<a name="128222085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222085">(Jun 18 2018 at 00:24)</a>:</h4>
<p>You can compare by counting the number of symbols and operators in each types.</p>



<a name="128222096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222096">(Jun 18 2018 at 00:25)</a>:</h4>
<p>that instance doesn't seem to be causing much problem though</p>



<a name="128222098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222098">(Jun 18 2018 at 00:25)</a>:</h4>
<p>I guess it's because it requires <code>subring</code></p>



<a name="128222143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222143">(Jun 18 2018 at 00:26)</a>:</h4>
<p>This seems to be the problem:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">finite_Galois_intermediate_extension</span><span class="bp">.</span><span class="n">to_subfield</span>
  <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span>
  <span class="o">(</span><span class="n">AC</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">[</span><span class="n">field_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span> <span class="o">[</span><span class="n">is_algebraic_closure</span> <span class="n">F</span> <span class="n">AC</span><span class="o">]</span>
  <span class="o">(</span><span class="n">E</span> <span class="o">:</span> <span class="n">finite_Galois_intermediate_extension</span> <span class="n">F</span> <span class="n">AC</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">subfield</span> <span class="bp">_</span> <span class="n">E</span><span class="bp">.</span><span class="n">S</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>



<a name="128222144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222144">(Jun 18 2018 at 00:26)</a>:</h4>
<p><code>subring</code> is actually what I find problematic in it</p>



<a name="128222148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222148">(Jun 18 2018 at 00:27)</a>:</h4>
<p>because I have an instance from subfield to field</p>



<a name="128222151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222151">(Jun 18 2018 at 00:27)</a>:</h4>
<blockquote>
<p><code>subring</code> is actually what I find problematic in it</p>
</blockquote>
<p>how so?</p>



<a name="128222192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222192">(Jun 18 2018 at 00:28)</a>:</h4>
<p>there are invisible operators: <code>comm_ring S</code> is actually <code>comm_ring (subtype S)</code> which is more complex than <code>comm_ring a</code>. However <code>subring a (subtype S)</code> is more complex than <code>comm_ring (subtype S)</code></p>



<a name="128222193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222193">(Jun 18 2018 at 00:28)</a>:</h4>
<p>nah it's <code>subring a S</code></p>



<a name="128222194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222194">(Jun 18 2018 at 00:28)</a>:</h4>
<p>there is no coercion there</p>



<a name="128222199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222199">(Jun 18 2018 at 00:29)</a>:</h4>
<p>It might actually fly then</p>



<a name="128222201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222201">(Jun 18 2018 at 00:29)</a>:</h4>
<p>Lean is actually more tolerant than what I'm used to and I'm not sure if that's a good thing or if it's just handing you enough rope to hang yourself with</p>



<a name="128222258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222258">(Jun 18 2018 at 00:31)</a>:</h4>
<p>this should be the problem</p>



<a name="128222259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222259">(Jun 18 2018 at 00:31)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="err">?</span><span class="n">x_30</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_28</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">subfield</span><span class="bp">.</span><span class="n">to_field</span> <span class="err">?</span><span class="n">x_34</span> <span class="err">?</span><span class="n">x_35</span> <span class="err">?</span><span class="n">x_36</span> <span class="err">?</span><span class="n">x_37</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_35</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_34</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span> <span class="err">?</span><span class="n">x_37</span> <span class="o">:</span> <span class="bp">@</span><span class="n">subfield</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="err">?</span><span class="n">x_36</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">finite_Galois_intermediate_extension</span><span class="bp">.</span><span class="n">to_subfield</span> <span class="err">?</span><span class="n">x_38</span> <span class="err">?</span><span class="n">x_39</span> <span class="err">?</span><span class="n">x_40</span> <span class="err">?</span><span class="n">x_41</span> <span class="err">?</span><span class="n">x_42</span> <span class="err">?</span><span class="n">x_43</span> <span class="err">?</span><span class="n">x_44</span> <span class="err">?</span><span class="n">x_45</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_39</span> <span class="o">:</span> <span class="n">field</span> <span class="err">?</span><span class="n">x_38</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_41</span> <span class="o">:</span> <span class="n">field</span> <span class="n">AC</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_7</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span> <span class="err">?</span><span class="n">x_42</span> <span class="o">:</span> <span class="bp">@</span><span class="n">is_alg_closed_field</span> <span class="n">AC</span> <span class="bp">_</span><span class="n">inst_7</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_8</span>
</pre></div>



<a name="128222298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222298">(Jun 18 2018 at 00:32)</a>:</h4>
<p>right, subfield.to_field is the problem</p>



<a name="128222299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222299">(Jun 18 2018 at 00:32)</a>:</h4>
<p>You can try commenting one instance at a time until the problem disappears</p>



<a name="128222302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222302">(Jun 18 2018 at 00:32)</a>:</h4>
<p>cool</p>



<a name="128222303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222303">(Jun 18 2018 at 00:32)</a>:</h4>
<p>that isn't how it works</p>



<a name="128222306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222306">(Jun 18 2018 at 00:32)</a>:</h4>
<p>if I comment one instance out, a million lines of code will break</p>



<a name="128222355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222355">(Jun 18 2018 at 00:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> a million things depend on <code>subfield.to_field</code> though...</p>



<a name="128222357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222357">(Jun 18 2018 at 00:34)</a>:</h4>
<p>this is a huge abyss</p>



<a name="128222358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222358">(Jun 18 2018 at 00:34)</a>:</h4>
<p>does <code>subfield</code> extend <code>field</code>?</p>



<a name="128222360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222360">(Jun 18 2018 at 00:34)</a>:</h4>
<p>no</p>



<a name="128222361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222361">(Jun 18 2018 at 00:34)</a>:</h4>
<p>Why not?</p>



<a name="128222364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222364">(Jun 18 2018 at 00:35)</a>:</h4>
<p>just as <code>is_subgroup</code> does not extend <code>group</code></p>



<a name="128222368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222368">(Jun 18 2018 at 00:35)</a>:</h4>
<p>and as I say this sentence</p>



<a name="128222370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222370">(Jun 18 2018 at 00:35)</a>:</h4>
<p>why doesn't that cause problems?</p>



<a name="128222373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222373">(Jun 18 2018 at 00:35)</a>:</h4>
<p>I'm not intimate enough with the algebraic hierarchy to know</p>



<a name="128222415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222415">(Jun 18 2018 at 00:36)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="bp">@</span><span class="n">subtype</span><span class="bp">.</span><span class="n">group</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">subtype.group : Π {α : Type u_1} [_inst_1 : group α] {s : set α} [_inst_2 : is_subgroup s], group ↥s</span>
<span class="cm">-/</span>
</pre></div>



<a name="128222425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222425">(Jun 18 2018 at 00:37)</a>:</h4>
<p>Actually, because there's no coercion, that's not that big of a deal. A different instance must be worse</p>



<a name="128222427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222427">(Jun 18 2018 at 00:37)</a>:</h4>
<p>hmm</p>



<a name="128222428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222428">(Jun 18 2018 at 00:38)</a>:</h4>
<p>this is a huge mess</p>



<a name="128222472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222472">(Jun 18 2018 at 00:39)</a>:</h4>
<p>Yeah, that's a problem with this way of doing type classes. You can't understand each instance in isolation</p>



<a name="128222566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128222566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128222566">(Jun 18 2018 at 00:42)</a>:</h4>
<p>I think depth first search is not very good</p>



<a name="128234704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/128234704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#128234704">(Jun 18 2018 at 07:52)</a>:</h4>
<p>Kenny remember as a last resort you can just override the type class system and give it the instances yourself. I used to do this all the time when I got stuck on (much easier) stuff.</p>



<a name="184070632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184070632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184070632">(Dec 22 2019 at 21:42)</a>:</h4>
<p>I just made the PR <a href="https://github.com/leanprover-community/mathlib/issues/1822" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1822">#1822</a> where I did something bad and broke multiplication, but I'm not sure how to fix it. I'm not sure how to minify it but you can look at line 154 in <a href="https://github.com/leanprover-community/mathlib/blob/6764734114a5e07eddc0409e485eb0bab6aea161/src/ring_theory/dedekind_finite.lean#L154" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/6764734114a5e07eddc0409e485eb0bab6aea161/src/ring_theory/dedekind_finite.lean#L154">https://github.com/leanprover-community/mathlib/blob/6764734114a5e07eddc0409e485eb0bab6aea161/src/ring_theory/dedekind_finite.lean#L154</a> compared to 115 where somehow the intervening instance <code>instance dedekind_finite_of_noetherian [is_noetherian_ring R] : dedekind_finite R :=</code> breaks <code>monoid.has_mul</code>.</p>



<a name="184072698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184072698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184072698">(Dec 22 2019 at 22:50)</a>:</h4>
<p>You should ask permission to make new branches on leanprover-community; that way I could use <code>cache-olean</code> to make checking out your issue less of a hassle.</p>



<a name="184072822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184072822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184072822">(Dec 22 2019 at 22:55)</a>:</h4>
<p>I hereby ask for permission!  Sorry, I also just added a new better version, but the question /relevant part is still the same.</p>



<a name="184072947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184072947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184072947">(Dec 22 2019 at 22:58)</a>:</h4>
<p><a href="https://gist.github.com/kbuzzard/aa3de5382b956ab9306dc8ec65f47cba" target="_blank" title="https://gist.github.com/kbuzzard/aa3de5382b956ab9306dc8ec65f47cba">Here's the instance trace</a>. I think you might have created a loop. For example I see</p>
<div class="codehilite"><pre><span></span>[class_instances] (17) ?x_59 : field G := real.field
failed is_def_eq
[class_instances] (17) ?x_59 : field G := rat.field
failed is_def_eq
...
[class_instances] (17) ?x_59 : field G := real.field
failed is_def_eq
[class_instances] (17) ?x_59 : field G := rat.field
failed is_def_eq
...
[class_instances] (20) ?x_124 : field G := real.field
failed is_def_eq
[class_instances] (20) ?x_124 : field G := rat.field
failed is_def_eq
...
[class_instances] (18) ?x_65 : field G := real.field
failed is_def_eq
[class_instances] (18) ?x_65 : field G := rat.field
failed is_def_eq
...
[class_instances] (19) ?x_67 : field G := real.field
failed is_def_eq
[class_instances] (19) ?x_67 : field G := rat.field
failed is_def_eq
...
[class_instances] (19) ?x_67 : field G := real.field
failed is_def_eq
[class_instances] (19) ?x_67 : field G := rat.field
failed is_def_eq
...
[class_instances] (19) ?x_67 : field G := real.field
failed is_def_eq
[class_instances] (19) ?x_67 : field G := rat.field
failed is_def_eq
...
</pre></div>


<p>but actually that just looks weird (to me), usually the numbers just creep up by one.</p>



<a name="184073570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184073570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184073570">(Dec 22 2019 at 23:17)</a>:</h4>
<div class="codehilite"><pre><span></span>[class_instances] (3) ?x_11 : ring G := @dedekind_finite.to_ring ?x_12 ?x_13
[class_instances] (4) ?x_13 : dedekind_finite G := @ @_root_.dedekind_finite_of_noetherian ?x_17 ?x_18 ?x_19
[class_instances] (5) ?x_18 : ring G := @dedekind_finite.to_ring ?x_20 ?x_21
[class_instances] (6) ?x_21 : dedekind_finite G := @ @_root_.dedekind_finite_of_noetherian ?x_25 ?x_26 ?x_27
...
</pre></div>


<p>I think that's your problem.</p>



<a name="184073578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184073578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184073578">(Dec 22 2019 at 23:17)</a>:</h4>
<p>To prove G is a ring it suffices to prove it's Dedekind finite, to prove it's Dedekind finite it suffices to prove it's a Noetherian ring and...oh.. also a ring! And to check that it's a ring, it suffices to prove it's Dedekind finite, and off we go again.</p>



<a name="184073803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184073803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184073803">(Dec 22 2019 at 23:24)</a>:</h4>
<p>You wrote</p>
<div class="codehilite"><pre><span></span><span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>

<span class="n">class</span> <span class="n">dedekind_finite</span> <span class="kn">extends</span> <span class="n">ring</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">inv_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>
</pre></div>


<p>and I am wondering whether this should be</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">dedekind_finite</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span> <span class="n">inv_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>
</pre></div>


<p>but unfortunately I am guessing here. I don't really understand how these things work -- I don't really understand the difference between the two in practice.</p>



<a name="184073874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184073874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184073874">(Dec 22 2019 at 23:27)</a>:</h4>
<p>The thing I know for sure is that I am quoting the last (3), the last (4), the last (5)...in the instance trace, which means for sure that things are spiralling out of control.</p>



<a name="184074008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184074008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184074008">(Dec 22 2019 at 23:31)</a>:</h4>
<p>OK so I can't guarantee that my fix is what you should be doing, but it does seem to fix the problem. You have to add the extra ring instances</p>
<div class="codehilite"><pre><span></span><span class="kn">variables</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">)</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">ring</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)]</span>
</pre></div>


<p>on line 27 but then the monoid error goes away. (I also have an error in <code>dedekind_finite_of_noetherian</code> but that was before I started fiddling and it might be because I just cut and pasted the file instead of forking your clone)</p>



<a name="184074195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184074195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184074195">(Dec 22 2019 at 23:36)</a>:</h4>
<blockquote>
<p>I hereby ask for permission!  Sorry, I also just added a new better version, but the question /relevant part is still the same.</p>
</blockquote>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> -- who can add people to the "can push to mathlib non-master branch" list? Is it you? Alex is <code>alexjbest</code> on github</p>



<a name="184076493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184076493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184076493">(Dec 23 2019 at 00:55)</a>:</h4>
<p>The invite is in the mail. <span class="user-mention" data-user-id="127136">@Alex J. Best</span> let me know if you encounter any issues</p>



<a name="184116152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184116152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184116152">(Dec 23 2019 at 16:40)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>  and <span class="user-mention" data-user-id="112680">@Johan Commelin</span> for the very helpful comments! It looks like it works well with classes taking ring as a parameter instead of extending (I should have copied the way <code>is_noetherian_ring</code> is set up, rather than <code>integral_domain</code>!) I'll do some more tidy up and push it (unfortunately I can't see a way to change the PR branch but for the next one I should be able to push to mathlib instead (ty <span class="user-mention" data-user-id="110026">@Simon Hudon</span> ))</p>



<a name="184185635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185635">(Dec 24 2019 at 19:33)</a>:</h4>
<p>I've been suffering with some typeclass problems which I've managed to reduce to the following:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">section</span> <span class="n">prio</span>
<span class="kn">set_option</span> <span class="n">default_priority</span> <span class="mi">200</span> <span class="c1">-- No problem if priority 199 or lower, evidently because algebra.to_module has priority 200</span>
<span class="n">class</span> <span class="n">foo</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="n">M&#39;</span>  <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
  <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">module</span> <span class="n">R</span> <span class="n">M&#39;</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">M&#39;</span><span class="o">)</span>
<span class="kn">end</span> <span class="n">prio</span>

<span class="kn">set_option</span> <span class="n">class</span><span class="bp">.</span><span class="n">instance_max_depth</span> <span class="mi">100</span>
<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>

<span class="kn">instance</span> <span class="n">bar</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
  <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">module</span> <span class="n">R</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">infer_instance</span>
</pre></div>



<a name="184185709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185709">(Dec 24 2019 at 19:35)</a>:</h4>
<p>The above will report that <code>maximum class-instance resolution depth has been reached</code> when elaborating <code>bar</code> but it will work if we lower the priority of the instances created by the declaration of <code>foo</code>, as indicated in my comment.</p>



<a name="184185826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185826">(Dec 24 2019 at 19:38)</a>:</h4>
<p>I do not understand the "Prolog-like search" that is performed as part of typeclass inference well at all but I am surprised because my fuzzy understanding had lead me to believe that changing priorities like this should merely affect performance, rather than the actual results. Evidently I am in error. Can anyone shed any light?</p>



<a name="184185873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185873">(Dec 24 2019 at 19:39)</a>:</h4>
<p>Typeclass loops can cause the max class-instance error and changing priorities can avoid the loops because a solution might be found before the loop is found</p>



<a name="184185877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185877">(Dec 24 2019 at 19:39)</a>:</h4>
<p>Furthermore, in debugging this, I attempted to read my first "class-instance resolution trace", and I note that my definition <code>foo</code> appears to introduce a looping behaviour, based on the following output from <code>lean foobar.lean 2&gt;&amp;1 | grep foo.to_module</code>:</p>



<a name="184185928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185928">(Dec 24 2019 at 19:40)</a>:</h4>
<div class="codehilite"><pre><span></span>[class_instances] (0) ?x_0 : @module R A (@comm_ring.to_ring R _inst_1) (@ring.to_add_comm_group A _inst_2) := @foo.to_module ?x_98 ?x_99 ?x_100 ?x_101 ?x_102 ?x_103 ?x_104 ?x_105
[class_instances] (1) ?x_104 : @module R (free_abelian_group ?x_122) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_122) := @foo.to_module ?x_222 ?x_223 ?x_224 ?x_225 ?x_226 ?x_227
[class_instances] (2) ?x_228 : @module R (free_abelian_group ?x_246) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_246) := @foo.to_module ?x_360 ?x_361 ?x_362 ?x_363 ?x_364 ?x_365
[class_instances] (3) ?x_366 : @module R (free_abelian_group ?x_384) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_384) := @foo.to_module ?x_498 ?x_499 ?x_500 ?x_501 ?x_502 ?x_503
[class_instances] (4) ?x_504 : @module R (free_abelian_group ?x_522) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_522) := @foo.to_module ?x_636 ?x_637 ?x_638 ?x_639 ?x_640 ?x_641
[class_instances] (5) ?x_642 : @module R (free_abelian_group ?x_660) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_660) := @foo.to_module ?x_774 ?x_775 ?x_776 ?x_777 ?x_778 ?x_779
[class_instances] (6) ?x_780 : @module R (free_abelian_group ?x_798) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_798) := @foo.to_module ?x_912 ?x_913 ?x_914 ?x_915 ?x_916 ?x_917
[class_instances] (7) ?x_918 : @module R (free_abelian_group ?x_936) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_936) := @foo.to_module ?x_1050 ?x_1051 ?x_1052 ?x_1053 ?x_1054 ?
[class_instances] (8) ?x_1056 : @module R (free_abelian_group ?x_1074) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1074) := @foo.to_module ?x_1188 ?x_1189 ?x_1190 ?x_1191 ?x_119
[class_instances] (9) ?x_1194 : @module R (free_abelian_group ?x_1212) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1212) := @foo.to_module ?x_1326 ?x_1327 ?x_1328 ?x_1329 ?x_133
[class_instances] (10) ?x_1332 : @module R (free_abelian_group ?x_1350) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1350) := @foo.to_module ?x_1464 ?x_1465 ?x_1466 ?x_1467 ?x_14
[class_instances] (11) ?x_1470 : @module R (free_abelian_group ?x_1488) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1488) := @foo.to_module ?x_1602 ?x_1603 ?x_1604 ?x_1605 ?x_16
[class_instances] (12) ?x_1608 : @module R (free_abelian_group ?x_1626) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1626) := @foo.to_module ?x_1740 ?x_1741 ?x_1742 ?x_1743 ?x_17
[class_instances] (13) ?x_1746 : @module R (free_abelian_group ?x_1764) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1764) := @foo.to_module ?x_1878 ?x_1879 ?x_1880 ?x_1881 ?x_18
[class_instances] (14) ?x_1884 : @module R (free_abelian_group ?x_1902) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_1902) := @foo.to_module ?x_2016 ?x_2017 ?x_2018 ?x_2019 ?x_20
[class_instances] (15) ?x_2022 : @module R (free_abelian_group ?x_2040) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_2040) := @foo.to_module ?x_2154 ?x_2155 ?x_2156 ?x_2157 ?x_21
[class_instances] (16) ?x_2160 : @module R (free_abelian_group ?x_2178) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_2178) := @foo.to_module ?x_2292 ?x_2293 ?x_2294 ?x_2295 ?x_22
[class_instances] (17) ?x_2298 : @module R (free_abelian_group ?x_2316) (@comm_ring.to_ring R _inst_1) (free_abelian_group.add_comm_group ?x_2316) := @foo.to_module ?x_2430 ?x_2431 ?x_2432 ?x_2433 ?x_24
[class_instances] (18) ?x_2436 : @module R (free_abelian_group
</pre></div>



<a name="184185936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185936">(Dec 24 2019 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Thank you, that is consistent with my fuzzy understanding.</p>



<a name="184185984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184185984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184185984">(Dec 24 2019 at 19:42)</a>:</h4>
<p>So what is the take-home message here? Is it:</p>
<p>1. I need to be more careful about instance priorities?, or<br>
  2. Priorities aside, the definition of <code>foo</code> is faulty / unidiomatic in some way?, or<br>
  3. I should give up on <code>extends</code> and just make <code>module R M'</code> a parameter in the definition of <code>foo</code>?, or<br>
  4. Something else?</p>



<a name="184186138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184186138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184186138">(Dec 24 2019 at 19:47)</a>:</h4>
<p>(deleted)</p>



<a name="184186280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184186280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184186280">(Dec 24 2019 at 19:51)</a>:</h4>
<p>My guess is that there is no unconditional answer to the above, and the best one can say is "sometimes option 1, sometimes option 3", depending on the situation.</p>



<a name="184188570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184188570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184188570">(Dec 24 2019 at 20:58)</a>:</h4>
<p>You're not allowed to make instance loops, that's the take home message I think. I'm certainly not an expert at this stuff but we saw the other day how extending a typeclass as opposed to asking for it can cause trouble sometimes</p>



<a name="184188668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184188668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184188668">(Dec 24 2019 at 21:01)</a>:</h4>
<p>I think <code>foo.to_module</code> exists because you're extending. I'd love to point you to some docs explaining the basic do's and don'ts in this area but there aren't any and I can't write them</p>



<a name="184191449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184191449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184191449">(Dec 24 2019 at 22:23)</a>:</h4>
<p>Thanks. Yes, I believe one of the things that extending does is to create <code>foo.to_module</code>; I too would love to read such docs, but I’ll happily plough ahead for now and wait till they are written (perhaps after Lean 4 arrives).</p>



<a name="184191622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184191622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184191622">(Dec 24 2019 at 22:28)</a>:</h4>
<p>I think I more or less understand the no loops prohibition (a tree-like search can't search a general graph) but I need to sharpen my understanding a little. I still have various questions but I'm unblocked so I think I'll just put them aside for now and see how I go when I pick this up, in a few days. Thanks again.</p>



<a name="184192445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184192445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184192445">(Dec 24 2019 at 22:55)</a>:</h4>
<p>The general rule being violated here is that <code>foo</code> has three explicit (type) args, but it has a parent that has only two</p>



<a name="184192449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184192449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184192449">(Dec 24 2019 at 22:55)</a>:</h4>
<p>which means that during instance search <code>M</code> gets invented, leading to the instance loop</p>



<a name="184194886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184194886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184194886">(Dec 25 2019 at 00:22)</a>:</h4>
<p>What's a parent? Something it extends?</p>



<a name="184194892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184194892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184194892">(Dec 25 2019 at 00:23)</a>:</h4>
<p>This can be avoided by just using <code>[module R M']</code> right?</p>



<a name="184199499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184199499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184199499">(Dec 25 2019 at 03:04)</a>:</h4>
<p>yes</p>



<a name="184205293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184205293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184205293">(Dec 25 2019 at 06:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Thank you, that is extremely helpful!</p>



<a name="184906091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184906091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184906091">(Jan 06 2020 at 13:36)</a>:</h4>
<p>Can anyone come up with a simple, mathematically-motivated version of the reduced problem <span class="user-mention" data-user-id="240862">@Oliver Nash</span> introduced in <a href="#narrow/stream/113488-general/topic/typeclass.20problems/near/184185635" title="#narrow/stream/113488-general/topic/typeclass.20problems/near/184185635">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass.20problems/near/184185635</a> ? Specifically, I am looking for any simple example of a "natural" collection of "action-like" instances that cannot be used in Lean3 because they would induce a cycle. Here by cycle I mean literally a cycle where the same exact subgoal repeats, and not just any infinite loop such as in <a href="#narrow/stream/113488-general/topic/Cute.20instance.20loop/near/180140798" title="#narrow/stream/113488-general/topic/Cute.20instance.20loop/near/180140798">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Cute.20instance.20loop/near/180140798</a> . Thanks!</p>



<a name="184906233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184906233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184906233">(Jan 06 2020 at 13:38)</a>:</h4>
<p>Fun fact: <code>tangent_space.topological_space</code> would induce a cycle on its own, if only <code>tangent_space</code> and <code>topological_fiber_bundle_core.fiber</code> were not considered opaque inside typeclass resolution. The following loops in current mathlib:</p>
<div class="codehilite"><pre><span></span><span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">reducible</span><span class="o">]</span> <span class="n">tangent_space</span> <span class="n">topological_fiber_bundle_core</span><span class="bp">.</span><span class="n">fiber</span>
<span class="kn">example</span> <span class="o">{</span><span class="err">𝕜</span> <span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">nondiscrete_normed_field</span> <span class="err">𝕜</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">E</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>



<a name="184908926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184908926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184908926">(Jan 06 2020 at 14:14)</a>:</h4>
<p>Do you mean something like this?</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>
<span class="kn">universe</span> <span class="kn">variables</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>

<span class="kn">instance</span> <span class="n">foo</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">}</span>
  <span class="o">[</span><span class="n">comm_ring</span> <span class="n">k</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">k</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">A</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">module</span> <span class="n">k</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">sorry</span>

<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>

<span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">2000</span><span class="o">]</span> <span class="n">ring</span><span class="bp">.</span><span class="n">to_add_comm_group</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">}</span>
  <span class="o">[</span><span class="n">comm_ring</span> <span class="n">k</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">k</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">A</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">module</span> <span class="n">k</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>


<p>Here type-class inference is trying to find <code>ring ?M</code> but doesn't know that <code>?M</code> should be <code>A</code>, and therefore goes in an infinite loop.</p>



<a name="184914884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184914884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184914884">(Jan 06 2020 at 15:20)</a>:</h4>
<p><span class="user-mention" data-user-id="111080">@Floris van Doorn</span> Thank you. I apologize that I was not precise enough in my request, and unfortunately this is not quite what I am looking for. First, this problem seems to be dependent on the order in which the instance subgoals are solved. The <code>[ring A]</code> argument of <code>foo</code> appears in the downstream instance, and it is a separate and easily fixable problem to simply postpone the search for such instances, e.g. by searching for the instances from right-to-left instead of left-to-right (which is what we do in Lean4). It would be great to find a small collection of desirable instances that would loop even under the right-to-left policy. Also, by "mathematically-motivated" I meant instances with real names and meanings, as opposed to (presumably) artificial instances like <code>foo</code>.</p>



<a name="184938522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184938522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184938522">(Jan 06 2020 at 19:39)</a>:</h4>
<p><code>foo</code> has a real mathematical meaning. An example of <code>foo</code> is the statement that a complex vector space can be considered as a real vector space (of twice the dimension, in this setting).</p>



<a name="184952258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184952258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184952258">(Jan 06 2020 at 20:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Thanks. What would be a good name for this instance then? Also, I suppose this instance is problematic no matter which direction we solve the subgoals in. If we go right-to-left, we <em>immediately</em> cycle. However, it does seems to work when <code>algebra k A</code> is tried before <code>module A M</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>

<span class="kn">universe</span> <span class="kn">variables</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>

<span class="kn">instance</span> <span class="n">foo</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">}</span>
  <span class="o">(</span><span class="bp">_</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="bp">_</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="bp">_</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">M</span><span class="o">)</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">k</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">A</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">module</span> <span class="n">k</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">sorry</span>

<span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">2000</span><span class="o">]</span> <span class="n">ring</span><span class="bp">.</span><span class="n">to_add_comm_group</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">w</span><span class="o">}</span>
  <span class="o">[</span><span class="n">comm_ring</span> <span class="n">k</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">k</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">A</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">module</span> <span class="n">k</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- works</span>
</pre></div>



<a name="184952870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184952870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184952870">(Jan 06 2020 at 20:26)</a>:</h4>
<p>In this particular case a possible solution is to have a tag "don't try this instance if <code>k = A</code>".</p>



<a name="184953437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184953437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184953437">(Jan 06 2020 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> It could be called <code>restrict_scalars</code></p>



<a name="184955772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184955772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184955772">(Jan 06 2020 at 20:59)</a>:</h4>
<p>Is there a reasonable "sister" instance that would make it loop even if <code>algebra k A</code> were tried first, before <code>module A M</code>?</p>



<a name="184957110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184957110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184957110">(Jan 06 2020 at 21:12)</a>:</h4>
<p>There is <code>instance algebra.id [comm_ring R] : algebra R R</code>.</p>



<a name="184958121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184958121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184958121">(Jan 06 2020 at 21:24)</a>:</h4>
<p>BTW, if we define <code>algebra.trans</code> similarly to <code>restrict_scalars</code>, then <code>algebra.id</code> + <code>algebra.trans</code> will create a loop too.</p>



<a name="184959085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184959085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184959085">(Jan 06 2020 at 21:34)</a>:</h4>
<blockquote>
<p>BTW, if we define <code>algebra.trans</code> similarly to <code>restrict_scalars</code>, then <code>algebra.id</code> + <code>algebra.trans</code> will create a loop too.</p>
</blockquote>
<p>Could you please post code for the <code>algebra.trans</code> you envision?</p>



<a name="184960236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184960236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184960236">(Jan 06 2020 at 21:47)</a>:</h4>
<p>Look at <code>algebra.comap</code> in <code>ring_theory/algebra.lean</code>. This is what I meant but it has a type tag to avoid loops.</p>



<a name="184960328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184960328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184960328">(Jan 06 2020 at 21:48)</a>:</h4>
<p>I don't know if we would <em>want</em> to have <code>algebra.trans</code> as an instance (without a type tag) if it was possible.</p>



<a name="184960572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184960572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184960572">(Jan 06 2020 at 21:51)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">trans</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">S</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">S</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">S</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">r</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">S</span> <span class="n">r</span> <span class="err">•</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span>
  <span class="n">to_fun</span> <span class="o">:=</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="o">:</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">A</span><span class="o">)</span> <span class="err">∘</span> <span class="n">algebra_map</span> <span class="n">S</span><span class="o">,</span>
  <span class="n">hom</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span><span class="o">,</span>
  <span class="n">commutes&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">r</span> <span class="n">x</span><span class="o">,</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">commutes</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">smul_def&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">smul_def</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>



<a name="184960580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184960580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184960580">(Jan 06 2020 at 21:51)</a>:</h4>
<p>(untested)</p>



<a name="184961591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184961591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184961591">(Jan 06 2020 at 22:03)</a>:</h4>
<p>(tested, works, needs some defs from <code>ring_theory/algebra.lean</code>)</p>



<a name="184962168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184962168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184962168">(Jan 06 2020 at 22:10)</a>:</h4>
<p><code>algebra.comap</code> is a nightmare. If you prove a theorem using <code>algebra.comap</code>, you won't be able to apply it easily to three rings where the canonical homomorphisms don't commute by definition. For example the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi></mrow><annotation encoding="application/x-tex">\mathbb{Q}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.85556em;vertical-align:-0.16667em;"></span><span class="mord"><span class="mord mathbb">Q</span></span></span></span></span>-algebra structure on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">C</mi></mrow><annotation encoding="application/x-tex">\mathbb{C}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">C</span></span></span></span></span>, is not defeq to <code>(coe : ℝ → ℂ) ∘ (coe : ℚ → ℝ)</code>. <code>algebra.trans</code> shouldn't be an instance because of these diamonds, and we also shouldn't prove theorems with <code>algebra.trans</code> in the statement. That does lead to ugly statements however.</p>



<a name="184962338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184962338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184962338">(Jan 06 2020 at 22:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> Thank you for the explanation.</p>



<a name="184993717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184993717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184993717">(Jan 07 2020 at 09:22)</a>:</h4>
<p>I think that Chris raises a very important problem. Without a good way to deal with commutative diagrams, advancing in commutative algebra will be nasty</p>



<a name="184993748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184993748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184993748">(Jan 07 2020 at 09:23)</a>:</h4>
<p>Of course we can just add proof obligations. But if it isn't done carefully, it makes everything hard to read and hard to write.</p>



<a name="184993830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184993830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184993830">(Jan 07 2020 at 09:24)</a>:</h4>
<p>In an ideal world, you just "bless" a diagram as being commutative, and don't need to mention it again. Some system (not type class inference, but maybe similar) should just solve these issues in the background.</p>



<a name="184993869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/184993869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#184993869">(Jan 07 2020 at 09:24)</a>:</h4>
<p>Finding paths through a graph is something that computers are better at than humans. So this part of proving should certainly not be kicked back into the users lap.</p>



<a name="185003381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185003381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185003381">(Jan 07 2020 at 11:51)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> I am not sure if I understand. Are you saying that even in Lean4, where typeclass resolution will handle cycles and diamonds correctly, <code>algebra.trans</code> would still be a bad instance because the path that typeclass resolution takes through the <code>algebra.trans</code> graph will affect whether some highly desirable definitional equalities hold or not? </p>
<p>According to the comment in <code>algebra.lean</code>, <code>algebra.comap</code> is a workaround for not being able to use <code>algebra.trans</code>. When you say it is a nightmare, are you saying it is a nightmare for the same reason that <code>algebra.trans</code> would be a nightmare? Can you please give an example of an "ugly" statement that avoids both?  </p>
<p>Thanks very much.</p>



<a name="185003938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185003938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185003938">(Jan 07 2020 at 12:01)</a>:</h4>
<p>As far as I understand, the problem that Chris mentions affects both <code>algebra.comap</code> and <code>algebra.trans</code>. Suppose that <code>A → B → C</code> are ring homs. Then <code>C</code> is an algebra over <code>B</code>, and <code>B</code> over <code>A</code>. By transitivity, <code>C</code> is also an algebra over <code>A</code>. But this fixes a particular (i.e., the transitive one) algebra structure for <code>C</code> over <code>A</code>. In practice, if one wants to apply a lemma, (e.g. to <code>ℚ → ℝ → ℂ</code>) then there is another algebra structure floating around which is not defeq to the transitive one.</p>



<a name="185004895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185004895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185004895">(Jan 07 2020 at 12:17)</a>:</h4>
<p>Thanks.</p>



<a name="185005203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185005203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185005203">(Jan 07 2020 at 12:22)</a>:</h4>
<p>I have not been able to get the <code>restrict_scalars</code> example to loop when it could have succeeded, once I controlled the subgoal ordering more carefully. So, I am still looking for a more compelling example of no-cycle-support being annoying in Lean3, or for a new cycle that you will want to introduce in Lean4.</p>



<a name="185005809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185005809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185005809">(Jan 07 2020 at 12:31)</a>:</h4>
<p><a href="https://cloud.commelin.net/s/C8PrCLoxe7995Nk" target="_blank" title="https://cloud.commelin.net/s/C8PrCLoxe7995Nk">https://cloud.commelin.net/s/C8PrCLoxe7995Nk</a> is a picture of a type class graph that algebraic geometers have in their head, and use all the time.</p>



<a name="185005837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185005837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185005837">(Jan 07 2020 at 12:31)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> We currently cannot state this graph yet, because we haven't built enough algebraic geometry yet.</p>



<a name="185005901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185005901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185005901">(Jan 07 2020 at 12:32)</a>:</h4>
<p>But all the info in this graph is used <em>implicitly</em> on almost every page of algebraic geometry (after introductory lecture notes)</p>



<a name="185006036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006036">(Jan 07 2020 at 12:34)</a>:</h4>
<p>So, this is not really a Lean 3 example. But being able to support dependencies like those in this graph would be really cool. As far as I understand, Lean 3 wouldn't be able to do that.</p>



<a name="185006304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006304">(Jan 07 2020 at 12:38)</a>:</h4>
<p>Interesting, thank you. What is the difference between the dotted edges, the regular edges, and the dark edges?</p>



<a name="185006332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006332">(Jan 07 2020 at 12:39)</a>:</h4>
<p>The bold edges seem to "merge" two dependencies</p>



<a name="185006365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006365">(Jan 07 2020 at 12:39)</a>:</h4>
<p>The dotted edges are considered "trivial" (either because the definition <code>extends</code> the other) or because, well... it's trivial (i.e., doesn't require proof in Hartshorne – one of the main introductory texts in AG).</p>



<a name="185006441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006441">(Jan 07 2020 at 12:40)</a>:</h4>
<p>I found this graph on the wall of my office, when I arrived here in Freiburg. I think it's from an appendix in a book on AG by Goertz and Wedhorn.</p>



<a name="185006450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006450">(Jan 07 2020 at 12:40)</a>:</h4>
<p>I left it on the wall <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="185006545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185006545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185006545">(Jan 07 2020 at 12:42)</a>:</h4>
<p>Thanks.</p>



<a name="185663943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185663943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185663943">(Jan 15 2020 at 03:03)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> One more typeclass related problem, see <a href="https://github.com/leanprover-community/mathlib/issues/1875" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1875">#1875</a> <a href="https://github.com/leanprover-community/mathlib/pull/1875#discussion_r366674829" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/1875#discussion_r366674829">https://github.com/leanprover-community/mathlib/pull/1875#discussion_r366674829</a> for a context, or below for a minimal example.</p>
<div class="codehilite"><pre><span></span><span class="n">noncomputable</span> <span class="n">theory</span>
<span class="n">open_locale</span> <span class="n">classical</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="n">def</span> <span class="n">indicator</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">if</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span> <span class="k">then</span> <span class="n">f</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span>

<span class="bp">@</span><span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="kn">axiom</span> <span class="n">is_add_monoid_hom</span><span class="bp">.</span><span class="n">indicator</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">is_add_monoid_hom</span> <span class="o">(</span><span class="bp">λ</span><span class="n">f</span><span class="o">:</span><span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">,</span> <span class="n">indicator</span> <span class="n">s</span> <span class="n">f</span><span class="o">)</span>

<span class="kn">lemma</span> <span class="n">indicator_sum</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">β</span><span class="o">]</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">ι</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">indicator</span> <span class="n">s</span> <span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">sum</span> <span class="n">f</span><span class="o">)</span> <span class="bp">=</span> <span class="n">I</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">indicator</span> <span class="n">s</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">convert</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">sum_hom</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
  <span class="n">convert</span> <span class="n">is_add_monoid_hom</span><span class="bp">.</span><span class="n">indicator</span> <span class="n">β</span> <span class="n">s</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">indicator_sum&#39;</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">β</span><span class="o">]</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">ι</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">indicator</span> <span class="n">s</span> <span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">sum</span> <span class="n">f</span><span class="o">)</span> <span class="bp">=</span> <span class="n">I</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">indicator</span> <span class="n">s</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">sum_hom</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span>
</pre></div>


<p>The <code>begin ... end</code> proof works while the last line fails to unify <code>add_monoid (α → β)</code> from <code>add_comm_monoid.to_add_monoid (pi.add_comm_monoid ...)</code> with <code>pi.add_monoid ...</code>. I have no idea how hard is to improve the situation here.</p>



<a name="185664356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185664356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185664356">(Jan 15 2020 at 03:13)</a>:</h4>
<p>I think this is missing MWE stuff</p>



<a name="185664951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185664951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185664951">(Jan 15 2020 at 03:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> What do you mean?</p>



<a name="185664958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185664958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185664958">(Jan 15 2020 at 03:28)</a>:</h4>
<p>what are the imports? I'm pretty sure <code>is_add_monoid_hom</code> is not in core</p>



<a name="185664984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185664984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185664984">(Jan 15 2020 at 03:29)</a>:</h4>
<p>ideally this should not have any imports, so it can be a standalone example that ports to lean 4</p>



<a name="185665069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185665069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185665069">(Jan 15 2020 at 03:31)</a>:</h4>
<p>I'll try to post a version with no imports.</p>



<a name="185666793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185666793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185666793">(Jan 15 2020 at 04:17)</a>:</h4>
<p>When I try to create a version with no imports and most <code>def</code> / <code>lemma</code> replaced by <code>constant</code> / <code>axiom</code>, it works... I'll try again tomorrow.</p>



<a name="185668544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/typeclass%20problems/near/185668544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/typeclass.20problems.html#185668544">(Jan 15 2020 at 04:54)</a>:</h4>
<p>Probably this is a bug in pi_instance. It generates strange <code>add_monoid.zero</code> and <code>add_monoid.add</code>. I'll see if I can make it reuse <code>pi.has_zero</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>