---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html">simp normal form for `e.to_equiv.symm`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="228641270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228641270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228641270">(Mar 03 2021 at 18:23)</a>:</h4>
<p>I've just noticed that <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous_linear_equiv.symm_to_linear_equiv">docs#continuous_linear_equiv.symm_to_linear_equiv</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous_linear_equiv.symm_to_homeomorph">docs#continuous_linear_equiv.symm_to_homeomorph</a> simplify similar expressions in the opposite directions. Each form <code>e.symm.to_weaker_equiv</code> and <code>e.to_weaker_equiv.symm</code> has its advantages but I think that we should decide which one should be the simp normal form.</p>



<a name="228641340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228641340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228641340">(Mar 03 2021 at 18:23)</a>:</h4>
<p>/poll Which form is better as the simp normal form?</p>



<a name="228641549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228641549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228641549">(Mar 03 2021 at 18:24)</a>:</h4>
<p>I think we typically try to push <code>symm</code> and <code>trans</code> as far down as possible.</p>



<a name="228641650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228641650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228641650">(Mar 03 2021 at 18:25)</a>:</h4>
<p>In case of <code>e.symm.to_weaker_equiv</code> we can automatically simplify <code>(e.symm.to_weaker_equiv : M → N)</code>. In the other case we can automatically apply lemmas like <code>weaker_equiv.trans_symm</code></p>



<a name="228641951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228641951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228641951">(Mar 03 2021 at 18:26)</a>:</h4>
<p>Lemmas about <code>continuous_linear_equiv.to_linear_equiv</code> and <code>symm</code>/<code>trans</code> go in the opposite direction.</p>



<a name="228642012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228642012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228642012">(Mar 03 2021 at 18:26)</a>:</h4>
<p>And I don't want to work on a refactor here without a poll.</p>



<a name="228642860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228642860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228642860">(Mar 03 2021 at 18:32)</a>:</h4>
<p>My instinct is the same as that of Gabriel, but I'm not sure about the particular advantages/disadvantages of each decision.</p>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60/near/228641650">said</a>:</p>
<blockquote>
<p>In case of <code>e.symm.to_weaker_equiv</code> we can automatically simplify <code>(e.symm.to_weaker_equiv : M → N)</code>. In the other case we can automatically apply lemmas like <code>weaker_equiv.trans_symm</code></p>
</blockquote>
<p>We will still have to prove <code>trans_symm</code> for the stronger equivalences as well, independent of our choice here, right? So I'm not sure if the second point is a big advantage.</p>



<a name="228643196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228643196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228643196">(Mar 03 2021 at 18:34)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.trans_symm">docs#equiv.trans_symm</a> refers to expressions like <code>e.symm.to_weaker_equiv.trans e.to_weaker_equiv</code>, right?</p>



<a name="228643359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228643359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228643359">(Mar 03 2021 at 18:35)</a>:</h4>
<p>If you have <code>e : M ≃L[R] M'</code> then with the second approach you can simplify <code>e.symm.to_linear_equiv.trans e.to_linear_equiv</code>.</p>



<a name="228643378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228643378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228643378">(Mar 03 2021 at 18:35)</a>:</h4>
<p>But I guess as long you also have a lemma sending <code>f.to_weaker_equiv.trans g.to_weaker_equiv</code> to <code>(f.trans g).to_weaker_equiv</code> then that should be ok</p>



<a name="228643566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228643566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228643566">(Mar 03 2021 at 18:36)</a>:</h4>
<p>So we need things like <a href="https://leanprover-community.github.io/mathlib_docs/find/ring_equiv.to_add_equiv_trans">docs#ring_equiv.to_add_equiv_trans</a>, which I assume we don't currently have?</p>



<a name="228643598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228643598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228643598">(Mar 03 2021 at 18:36)</a>:</h4>
<p>I thought it was implied in the question that if <code>e.symm.to_weaker_equiv</code> is simp-normal form, then <code>(e.trans e').to_weaker_equiv</code> is also simp-normal form. So then we can use <code>stronger_equiv.trans_symm</code> to rewrite <code>(e.trans e.symm).to_weaker_equiv</code> to <code>weaker_equiv.refl</code></p>



<a name="228643697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228643697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228643697">(Mar 03 2021 at 18:37)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/ring_equiv.to_ring_hom_trans">docs#ring_equiv.to_ring_hom_trans</a> also goes in the wrong direction</p>



<a name="228644106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228644106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228644106">(Mar 03 2021 at 18:39)</a>:</h4>
<p>Unless we decide that <code>e.to_same_hom</code> gets different rules</p>



<a name="228644297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228644297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228644297">(Mar 03 2021 at 18:40)</a>:</h4>
<p><span class="user-mention" data-user-id="111080">@Floris van Doorn</span> I just forgot about this simp lemma.</p>



<a name="228645064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228645064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228645064">(Mar 03 2021 at 18:45)</a>:</h4>
<p>An argument for the second option:</p>
<p>If I have some (complicated) construction on <code>stronger_equiv</code>, like <code>stronger_equiv_foo</code>, then I probably want a simp lemma that<br>
<code>stronger_equiv_foo.to_weaker_equiv = weaker_equiv_foo</code>. We can think of <code>to_weaker_equiv</code> as a "field" of <code>stronger_equiv</code> (independent of whether it actually is a field), so this simp lemma makes sense.<br>
If I have some operation on <code>stronger_equiv</code> like the product of two such equivalences, what direction does the simp lemma go?</p>
<ul>
<li><code>(e.prod e').to_weaker_equiv = e.to_weaker_equiv.prod e'.to_weaker_equiv</code> since <code>to_weaker_equiv</code> is a field?</li>
<li><code>e.to_weaker_equiv.prod e'.to_weaker_equiv = (e.prod e').to_weaker_equiv</code> because we want to push <code>to_weaker_equiv</code> to the outside, like for <code>symm</code>?</li>
</ul>
<p>I'm not so sure about this case, but I think it makes sense to have the same rule for <code>symm</code>, <code>trans</code>, <code>prod</code> and all the other operations on equivalences.</p>



<a name="228648191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228648191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228648191">(Mar 03 2021 at 19:04)</a>:</h4>
<p>I can't help feeling we're doomed to quadratically many lemmas (equiv strength x equiv operations) or worse no matter what we do</p>



<a name="228648601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228648601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228648601">(Mar 03 2021 at 19:06)</a>:</h4>
<p>A related issue I've observed (to the explosion of simp lemmas) is that we apparently need <code>e.symm (e x) = e</code> for every kind of equivalence.</p>



<a name="228648692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228648692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228648692">(Mar 03 2021 at 19:07)</a>:</h4>
<p>The usual way out of this type of explosion is polymorphism / multiple dispatch, which in lean would be typeclasses</p>



<a name="228651970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228651970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228651970">(Mar 03 2021 at 19:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> Could you please tell us what are your arguments in favor of <code>e.to_weaker_equiv.symm</code>?</p>



<a name="228652063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228652063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228652063">(Mar 03 2021 at 19:27)</a>:</h4>
<p>I definitely don't want to start a refactor with your vote against it.</p>



<a name="228655098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228655098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228655098">(Mar 03 2021 at 19:45)</a>:</h4>
<p>Can <code>norm_cast</code> help with <code>to_X</code> casts?</p>



<a name="228658712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228658712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228658712">(Mar 03 2021 at 20:06)</a>:</h4>
<p>My impression is that we try to push most operations to the lowest level. For instance, the canonical form of <code>coe (f + g)</code> is <code>coe f + coe g</code>, where we push the <code>+</code> to the weaker class. In the same way, <code>coe (-f)</code> is <code>- coe f</code>, pushing <code>neg</code> to the lowest level. If you replace <code>neg</code> with <code>symm</code> and <code>coe</code> with <code>to_weaker_equiv</code>, this hints at a normal form <code>e.to_weaker_equiv.symm</code>. But I don't feel very strongly about it, so if everyone agrees the other form is better then go for it!</p>



<a name="228659019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228659019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228659019">(Mar 03 2021 at 20:08)</a>:</h4>
<p>While the other point of view is that <code>to_weaker_equiv</code> is <code>neg</code> in this case, while <code>symm</code> is <code>coe</code>?</p>



<a name="228662748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228662748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228662748">(Mar 03 2021 at 20:31)</a>:</h4>
<p>Except that <code>to_weaker_equiv</code> is really a form of coercion, and <code>symm</code> is really a form of <code>neg</code>. I didn't choose this example completely randomly :-)</p>



<a name="228664292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228664292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228664292">(Mar 03 2021 at 20:41)</a>:</h4>
<p>One more argument for the second choice. If we have <code>e.to_weaker_equiv.trans e'.to_weaker_equiv</code>, where <code>e</code> and <code>e'</code> are of different types, then we can't transform it to a form similar to choice 1 without some <code>norm_cast</code> magic.</p>



<a name="228664373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228664373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228664373">(Mar 03 2021 at 20:41)</a>:</h4>
<p>So, I move to "undecided".</p>



<a name="228664520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228664520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228664520">(Mar 03 2021 at 20:42)</a>:</h4>
<p>It would be nice to have <code>norm_cast</code> treat all functions marked with some attribute as coercions.</p>



<a name="228664623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228664623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228664623">(Mar 03 2021 at 20:43)</a>:</h4>
<p>So that we can mark theorems like <code>coe_to_equiv</code> with <code>norm_cast</code> and use them in <code>norm_cast</code>/<code>push_cast</code>.</p>



<a name="228665553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/228665553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#228665553">(Mar 03 2021 at 20:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60/near/228664520">said</a>:</p>
<blockquote>
<p>It would be nice to have <code>norm_cast</code> treat all functions marked with some attribute as coercions.</p>
</blockquote>
<blockquote>
<p>So that we can mark theorems like <code>coe_to_equiv</code> with <code>norm_cast</code> and use them in <code>norm_cast</code>/<code>push_cast</code>.</p>
</blockquote>
<p>I was thinking at some point that it would be nice to let <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.C">docs#polynomial.C</a> be treated as a coercion.<br>
<a href="#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/norm_cast.20for.20algebras">https://leanprover.zulipchat.com/#narrow/stream/239415-metaprogramming-.2F.20tactics/topic/norm_cast.20for.20algebras</a></p>



<a name="248416742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/248416742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#248416742">(Aug 04 2021 at 22:23)</a>:</h4>
<p>I came across this again today; <code>simps</code> appears to work best with the second option that results in <code>e.symm.to_weaker_equiv</code>, as once the goal ends up in that state,<a href="https://leanprover-community.github.io/mathlib_docs/find/coe_to_add_equiv">docs#coe_to_add_equiv</a> will strip the <code>to_weaker_equiv</code> and then the generated <code>e_symm_apply</code> will unfold the <code>e.symm</code>.</p>



<a name="248440152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/248440152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#248440152">(Aug 05 2021 at 05:30)</a>:</h4>
<p>The second option makes <code>e.to_weaker_equiv.symm</code> the <code>simp</code>-normal form. This version needs a lemma like <a href="https://leanprover-community.github.io/mathlib_docs/find/diffeomorph.to_equiv_coe_symm">docs#diffeomorph.to_equiv_coe_symm</a> in the API.</p>



<a name="248445021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/248445021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#248445021">(Aug 05 2021 at 07:11)</a>:</h4>
<p>Whoops, that was a typo</p>



<a name="254664695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254664695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254664695">(Sep 24 2021 at 07:47)</a>:</h4>
<p>Did we finally make a decision here? I don't think the choice matters much (even though I still stand with option (2)), but I think that making a choice is important, to know what to use when writing new statements. Also, the question is both for <code>symm</code> and <code>trans</code>, i.e., should the normal form be <code>f.to_weaker_equiv.trans g.to_weaker_equiv</code> or <code>(f.trans g).to_weaker_equiv</code>? (The two questions are related, to make sure that simp works nicely).</p>



<a name="254665506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254665506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254665506">(Sep 24 2021 at 07:55)</a>:</h4>
<p>Reading the thread I've added my vote to (2), but this is contrary to my initial instinct, so I remain uncertain!</p>



<a name="254665661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254665661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254665661">(Sep 24 2021 at 07:56)</a>:</h4>
<p>I guess one way to think about it is "if we have an interesting strong-equiv, is it more likely that we have a nice description of its <code>symm</code>, or that we have a nice description of its <code>to_weaker_equiv</code>?" I would guess the latter, and hence 2).</p>



<a name="254670302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254670302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254670302">(Sep 24 2021 at 08:37)</a>:</h4>
<p>Don't bother about my opinion too much because I'm not using those much, but the first thing I want to do when seeing <code>(f.trans g).to_weaker_equiv</code> is to "simp" it to <code>f.to_weaker_equiv.trans g.to_weaker_equiv</code>.<br>
My idea is that the stronger equiv is just here for its further properties, so when you don't need them you want that overbundling gone as much as possible.</p>



<a name="254670465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254670465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254670465">(Sep 24 2021 at 08:38)</a>:</h4>
<p>Also, <code>f.to_weaker_equiv.trans g.to_weaker_equiv</code> is closer to <code>f.to_weaker_equiv.trans g</code> and <code>f.trans g.to_weaker_equiv</code>, when only one of the equivalences has to be weakened.</p>



<a name="254678775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254678775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254678775">(Sep 24 2021 at 09:55)</a>:</h4>
<p>(2) is the direction consistent with <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.functor.map_inv">docs#category_theory.functor.map_inv</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.functor.map_comp">docs#category_theory.functor.map_comp</a></p>



<a name="254678917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/254678917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#254678917">(Sep 24 2021 at 09:57)</a>:</h4>
<p>Also there's a third player here, <code>refl</code>--obviously we want <code>stronger_equiv.refl.to_weaker_equiv = weaker_equiv.refl</code>, and not the other way around</p>



<a name="316326494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/316326494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#316326494">(Dec 16 2022 at 17:55)</a>:</h4>
<p>I've changed my mind to the first option, because I just spent three hours fixing a simp call in <a href="https://github.com/leanprover-community/mathlib/pull/2819">#2819</a>. There I have <code>e (e.to_linear_equiv.to_continuous_linear_equiv.to_homeomorph.to_measurable_equiv.symm a)</code>, and all the simp lemmas were working against me!</p>



<a name="316327152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/316327152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#316327152">(Dec 16 2022 at 17:58)</a>:</h4>
<p><code>trans</code> is already pushed down because of distributivity considerations. We don't have such considerations for<code>symm</code>, so it's really up to us. And in that case, because we can simplify <code>e.symm.to_equiv a</code> but not <code>e.to_equiv.symm a</code>, I think we should push down.</p>



<a name="316328081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp%20normal%20form%20for%20%60e.to_equiv.symm%60/near/316328081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simp.20normal.20form.20for.20.60e.2Eto_equiv.2Esymm.60.html#316328081">(Dec 16 2022 at 18:02)</a>:</h4>
<p>I am doubtful of the argument that we want the other way for simp to find things of the form <code>e.trans e.symm</code> because this lemma works against distributivity and this is not really simp's job (indeed, a <code>norm_cast</code>-like tactic would be much better suited).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>