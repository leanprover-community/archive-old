---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html">Diamond of complete boolean algebras on sets</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="303258442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303258442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303258442">(Oct 10 2022 at 13:16)</a>:</h4>
<p>We seem to have a diamond as follows:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.set.lattice</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="c1">-- Succeeds</span>
<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">set.boolean_algebra</span> <span class="n">α</span> <span class="bp">=</span> <span class="n">pi.boolean_algebra</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="c1">-- Fails</span>
<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">set.complete_boolean_algebra</span> <span class="n">α</span> <span class="bp">=</span> <span class="n">pi.complete_boolean_algebra</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>Is this known?</p>



<a name="303260313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303260313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303260313">(Oct 10 2022 at 13:29)</a>:</h4>
<p>Hmm that's something I thought I had fixed. I'll investigate</p>



<a name="303260352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303260352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303260352">(Oct 10 2022 at 13:29)</a>:</h4>
<p>Thanks, I'd be very grateful!</p>



<a name="303260677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303260677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303260677">(Oct 10 2022 at 13:31)</a>:</h4>
<p>Note that this does not morally need fixing (because <code>set</code> is a type synonym) but in this case I know that this working is related to defeqs we do care about.</p>



<a name="303633074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303633074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303633074">(Oct 12 2022 at 13:59)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> Did you find time to investigate this? If not, I'm happy just to open an issue for it and move on.</p>



<a name="303633244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303633244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303633244">(Oct 12 2022 at 14:00)</a>:</h4>
<p>I appreciate the point about <code>set</code> being a type synonym but if it helps here is an example where this comes up for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">measure_theory.measure.measure_space</span>

<span class="kn">open</span> <span class="n">filter</span> <span class="n">measure_theory</span>

<span class="kd">lemma</span> <span class="n">limsup_sdiff</span>
  <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_boolean_algebra</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">filter</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">l.limsup</span> <span class="n">u</span><span class="o">)</span> <span class="bp">\</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">l.limsup</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="o">(</span><span class="n">u</span> <span class="n">b</span><span class="o">)</span> <span class="bp">\</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">limsup_eq_infi_supr</span><span class="o">,</span> <span class="n">sdiff_eq</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">binfi_inf</span> <span class="o">(⟨</span><span class="n">set.univ</span><span class="o">,</span> <span class="n">univ_mem</span><span class="o">⟩</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">set</span> <span class="n">β</span><span class="o">),</span> <span class="n">i</span> <span class="bp">∈</span> <span class="n">l</span><span class="o">),</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="n">inf_comm</span><span class="o">,</span> <span class="n">inf_bsupr_eq</span><span class="o">,</span> <span class="n">inf_comm</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">measurable_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">μ</span> <span class="o">:</span> <span class="n">measure</span> <span class="n">α</span><span class="o">}</span>

<span class="kd">lemma</span> <span class="n">limsup_ae_eq_of_forall_ae_eq</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">s</span> <span class="n">n</span> <span class="bp">=ᵐ</span><span class="o">[</span><span class="n">μ</span><span class="o">]</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span>
  <span class="c1">-- limsup at_top s =ᵐ[μ] t :=</span>
  <span class="bp">@</span><span class="n">limsup</span> <span class="o">(</span><span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="n">ℕ</span> <span class="n">_</span> <span class="n">at_top</span> <span class="n">s</span> <span class="bp">=ᵐ</span><span class="o">[</span><span class="n">μ</span><span class="o">]</span> <span class="n">t</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="n">ae_eq_set</span> <span class="n">at</span> <span class="n">h</span> <span class="bp">⊢</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">limsup_sdiff</span> <span class="n">at_top</span> <span class="n">s</span> <span class="n">t</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">measure_limsup_eq_zero</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span> <span class="o">},</span>
  <span class="o">{</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">},</span> <span class="c1">-- Omitting this proof to keep MWE short</span>
<span class="kd">end</span>
</code></pre></div>



<a name="303633372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303633372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303633372">(Oct 12 2022 at 14:00)</a>:</h4>
<p>The point is that I am forced to write <code>@limsup (set α) ℕ _ at_top s</code> rather than <code>limsup at_top s</code> because of the diamond.</p>



<a name="303633628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303633628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303633628">(Oct 12 2022 at 14:02)</a>:</h4>
<p>I believe the reason this is happening is that in the hypothesis <code>h : ∀ n, s n =ᵐ[μ] t</code>, Lean is required to see through the <code>set</code> type synonym and so then it continues doing that for the conclusion.</p>



<a name="303633788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303633788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303633788">(Oct 12 2022 at 14:02)</a>:</h4>
<p>That's what's bad, right? You should never write <code>s n</code> but instead <code>n ∈ s</code></p>



<a name="303634028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634028">(Oct 12 2022 at 14:04)</a>:</h4>
<p><code>s</code> here is a family of sets</p>



<a name="303634208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634208">(Oct 12 2022 at 14:04)</a>:</h4>
<p>Should it be <code>h : ∀ n, (∈ s n) =ᵐ[μ] (∈ t)</code>?</p>



<a name="303634215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634215">(Oct 12 2022 at 14:04)</a>:</h4>
<p>What's happening is that we have a design decision in our measure theory library to define almost-equal sets as almost-equal functions.</p>



<a name="303634428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634428">(Oct 12 2022 at 14:05)</a>:</h4>
<p>Hmm... That goes against the general design decision of making <code>set α</code> a proper type synonym.</p>



<a name="303634460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634460">(Oct 12 2022 at 14:05)</a>:</h4>
<p>Yes it does.</p>



<a name="303634521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634521">(Oct 12 2022 at 14:06)</a>:</h4>
<p>But it's been done.</p>



<a name="303634539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634539">(Oct 12 2022 at 14:06)</a>:</h4>
<p>And when we eventually make <code>set</code> a structure your trick doesn't work anymore and we have to change even more files to fix it.</p>



<a name="303634554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634554">(Oct 12 2022 at 14:06)</a>:</h4>
<p>Can you remind me what the notation above unfolds to?</p>



<a name="303634591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634591">(Oct 12 2022 at 14:06)</a>:</h4>
<p>I'm not familiar with measure theory notation</p>



<a name="303634730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634730">(Oct 12 2022 at 14:07)</a>:</h4>
<p>It means that, for a full measure set of points <code>x</code>, then <code>x</code> belongs to <code>s n</code> iff it belongs to <code>t</code>.</p>



<a name="303634798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634798">(Oct 12 2022 at 14:07)</a>:</h4>
<p>What's the declaration behind the notation though?</p>



<a name="303634847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634847">(Oct 12 2022 at 14:07)</a>:</h4>
<p>And yes, we are abusing defeq to avoid duplicating the API. And yes, it's bad :-)</p>



<a name="303634937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634937">(Oct 12 2022 at 14:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets/near/303634554">said</a>:</p>
<blockquote>
<p>Can you remind me what the notation above unfolds to?</p>
</blockquote>
<p>It's <code>∀ n, ∀ᶠ x in μ.ae, s n x = t x</code></p>



<a name="303634961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303634961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303634961">(Oct 12 2022 at 14:08)</a>:</h4>
<p>I think we should just add the <code> ∈</code>s</p>



<a name="303635133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635133">(Oct 12 2022 at 14:09)</a>:</h4>
<p>We did that for a bunch of <code>decidable</code> arguments a while ago and it was generally an improvement</p>



<a name="303635348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635348">(Oct 12 2022 at 14:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets/near/303634961">said</a>:</p>
<blockquote>
<p>I think we should just add the <code> ∈</code>s</p>
</blockquote>
<p>Can you clarify what this means?</p>



<a name="303635434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635434">(Oct 12 2022 at 14:10)</a>:</h4>
<p>I mean do what I said in the message above</p>



<a name="303635502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635502">(Oct 12 2022 at 14:11)</a>:</h4>
<p>The canonical way to view a set as a function is <code>(∈ s)</code></p>



<a name="303635706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635706">(Oct 12 2022 at 14:12)</a>:</h4>
<p>Which as a bonus, works for finset, submonoid, ... too</p>



<a name="303635852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635852">(Oct 12 2022 at 14:12)</a>:</h4>
<p>I am trying that randomly in some files, and it doesn't seem to break anything. So I agree it's probably a good idea. Let me try to complete this.</p>



<a name="303635968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303635968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303635968">(Oct 12 2022 at 14:13)</a>:</h4>
<p>Oh I see. If I do that then Lean still uses <code>pi.complete_boolean_algebra</code> which is a problem when I try to apply <code>limsup_sdiff</code> because <code>t</code> is a set.</p>



<a name="303636121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303636121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303636121">(Oct 12 2022 at 14:14)</a>:</h4>
<p>What's your full modified version?</p>



<a name="303636141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303636141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303636141">(Oct 12 2022 at 14:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">measure_theory.measure.measure_space</span>

<span class="kn">open</span> <span class="n">filter</span> <span class="n">measure_theory</span>

<span class="kd">lemma</span> <span class="n">limsup_sdiff</span>
  <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_boolean_algebra</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">filter</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">l.limsup</span> <span class="n">u</span><span class="o">)</span> <span class="bp">\</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">l.limsup</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="o">(</span><span class="n">u</span> <span class="n">b</span><span class="o">)</span> <span class="bp">\</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">limsup_eq_infi_supr</span><span class="o">,</span> <span class="n">sdiff_eq</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">binfi_inf</span> <span class="o">(⟨</span><span class="n">set.univ</span><span class="o">,</span> <span class="n">univ_mem</span><span class="o">⟩</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">set</span> <span class="n">β</span><span class="o">),</span> <span class="n">i</span> <span class="bp">∈</span> <span class="n">l</span><span class="o">),</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="n">inf_comm</span><span class="o">,</span> <span class="n">inf_bsupr_eq</span><span class="o">,</span> <span class="n">inf_comm</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">measurable_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">μ</span> <span class="o">:</span> <span class="n">measure</span> <span class="n">α</span><span class="o">}</span>

<span class="kd">lemma</span> <span class="n">limsup_ae_eq_of_forall_ae_eq</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="bp">∈</span> <span class="n">s</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=ᵐ</span><span class="o">[</span><span class="n">μ</span><span class="o">]</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">limsup</span> <span class="n">at_top</span> <span class="n">s</span> <span class="bp">=ᵐ</span><span class="o">[</span><span class="n">μ</span><span class="o">]</span> <span class="n">t</span> <span class="o">:=</span>
  <span class="c1">-- @limsup (set α) ℕ _ at_top s =ᵐ[μ] t :=</span>
<span class="kd">begin</span>
  <span class="c1">-- change (∀ n, ∀ᶠ x in μ.ae, s n x = t x) at h,</span>
  <span class="n">simp_rw</span> <span class="n">ae_eq_set</span> <span class="n">at</span> <span class="n">h</span> <span class="bp">⊢</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">limsup_sdiff</span> <span class="n">at_top</span> <span class="n">s</span> <span class="n">t</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">measure_limsup_eq_zero</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span> <span class="o">},</span>
  <span class="o">{</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">},</span> <span class="c1">-- Omitting this proof to keep MWE short</span>
<span class="kd">end</span>
</code></pre></div>



<a name="303636208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303636208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303636208">(Oct 12 2022 at 14:14)</a>:</h4>
<p>The conclusion needs <code>∈</code>s too</p>



<a name="303636294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303636294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303636294">(Oct 12 2022 at 14:15)</a>:</h4>
<p>As does <code>t</code>, as in my above comment</p>



<a name="303636677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303636677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303636677">(Oct 12 2022 at 14:17)</a>:</h4>
<p>Hmm, I'm trying this but failing. One moment.</p>



<a name="303637742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303637742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303637742">(Oct 12 2022 at 14:23)</a>:</h4>
<p>OK using this idea make progress. Indeed the following allows me to avoid mangling the hypothesis and conclusion:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">limsup_ae_eq_of_forall_ae_eq</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">s</span> <span class="n">n</span> <span class="bp">=ᵐ</span><span class="o">[</span><span class="n">μ</span><span class="o">]</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">limsup</span> <span class="n">at_top</span> <span class="n">s</span> <span class="bp">=ᵐ</span><span class="o">[</span><span class="n">μ</span><span class="o">]</span> <span class="n">t</span> <span class="o">:=</span>
  <span class="c1">-- @limsup (set α) ℕ _ at_top s =ᵐ[μ] t :=</span>
<span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="n">ae_eq_set</span> <span class="n">at</span> <span class="n">h</span> <span class="bp">⊢</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">erw</span> <span class="n">limsup_sdiff</span> <span class="n">at_top</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="bp">∈</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="n">t</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">measure_limsup_eq_zero</span><span class="o">,</span> <span class="c1">-- This now fails because it expects `set`s</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span> <span class="o">},</span>
  <span class="o">{</span> <span class="gr">sorry</span><span class="o">,</span> <span class="o">},</span> <span class="c1">-- Omitting this proof to keep MWE short</span>
<span class="kd">end</span>
</code></pre></div>
<p>but then I have the problem that <code>measure_limsup_eq_zero</code> expects <code>set</code>s.</p>



<a name="303638269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303638269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303638269">(Oct 12 2022 at 14:26)</a>:</h4>
<p>More precisely, <code>measure_limsup_eq_zero</code> is a statement about a <code>limsup</code> in the complete lattice of <code>set</code>s, which is (unfortunately) definitionally different from what I have if I make a statement about the <code>pi.complete_lattice</code>.</p>



<a name="303638740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303638740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303638740">(Oct 12 2022 at 14:28)</a>:</h4>
<p>Okay, I don't understand what's going on. I thought this would be fine given that <a href="https://leanprover-community.github.io/mathlib_docs/find/set.Sup_eq_sUnion">docs#set.Sup_eq_sUnion</a> is defeq.</p>



<a name="303649118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303649118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303649118">(Oct 12 2022 at 14:37)</a>:</h4>
<p>It's this failure, right:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">pi.has_Sup</span> <span class="n">α</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">set.has_Sup</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- Fails</span>
</code></pre></div>



<a name="303649162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303649162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303649162">(Oct 12 2022 at 14:37)</a>:</h4>
<p>(likewise Inf)</p>



<a name="303666853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303666853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303666853">(Oct 12 2022 at 15:41)</a>:</h4>
<p>Currently it seems that <code>Sup s</code> on sets is defined as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">t</span> <span class="bp">∈</span> <span class="n">s</span><span class="o">),</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">t</span><span class="o">}</span>
</code></pre></div>



<a name="303667224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303667224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303667224">(Oct 12 2022 at 15:43)</a>:</h4>
<p>Whereas on pi types it's</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="bp">⨆</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">↥</span><span class="n">s</span><span class="o">),</span> <span class="bp">↑</span><span class="n">f</span> <span class="n">i</span>
</code></pre></div>



<a name="303667529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303667529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303667529">(Oct 12 2022 at 15:45)</a>:</h4>
<p>My hunch is that changing that to one of <code>⨆ (f ∈ s), ↑f i</code> or <code>Sup (eval i '' s)</code> would fix that</p>



<a name="303667595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303667595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303667595">(Oct 12 2022 at 15:45)</a>:</h4>
<p>I've opened an issue <a href="https://github.com/leanprover-community/mathlib/pull/16932">#16932</a> for now at least.</p>



<a name="303667667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303667667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303667667">(Oct 12 2022 at 15:46)</a>:</h4>
<p>(mostly to give me something to reference in a PR which is forced to include the <code>@</code> characters)</p>



<a name="303667771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303667771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303667771">(Oct 12 2022 at 15:46)</a>:</h4>
<p>I agree that we should fix this diamond, but I also think that separately we should fix this measure theory defeq abuse</p>



<a name="303667802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303667802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303667802">(Oct 12 2022 at 15:46)</a>:</h4>
<p>Yes, agreed on both points.</p>



<a name="303677725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303677725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303677725">(Oct 12 2022 at 16:40)</a>:</h4>
<p>It's not just measure theory, unfortunately, it's also used for general filters. See <a href="https://leanprover-community.github.io/mathlib_docs/find/filter.eventually_eq_set">docs#filter.eventually_eq_set</a>. I'm gonna try to fix all these, but it might take longer than I was expecting naively.</p>



<a name="303677870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303677870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303677870">(Oct 12 2022 at 16:41)</a>:</h4>
<p>Oh! Well if you have the appetite, such a heroic effort would be great.</p>



<a name="303834071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303834071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303834071">(Oct 13 2022 at 13:38)</a>:</h4>
<p>I just looked at the complete lattice diamond issue and it seems to me that we would need to change the definition of both <code>set.has_Sup</code> and <code>pi.has_Sup</code>.</p>



<a name="303834151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303834151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303834151">(Oct 13 2022 at 13:38)</a>:</h4>
<p>I think the following might work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.set.lattice</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">pi.has_Sup'</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_Sup</span> <span class="o">(</span><span class="n">β</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span> <span class="n">has_Sup</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">β</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">s</span> <span class="n">i</span><span class="o">,</span> <span class="bp">⨆</span> <span class="n">f</span> <span class="bp">∈</span> <span class="n">s</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">β</span> <span class="n">i</span><span class="o">)</span> <span class="n">i</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">set.has_Sup'</span> <span class="o">:</span> <span class="n">has_Sup</span> <span class="o">(</span><span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">|</span> <span class="bp">⨆</span> <span class="n">t</span> <span class="bp">∈</span> <span class="n">s</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">t</span><span class="o">}⟩</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">pi.has_Sup'</span> <span class="n">α</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">set.has_Sup'</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="303834557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303834557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303834557">(Oct 13 2022 at 13:40)</a>:</h4>
<p>It's actually a one-character change in each case:</p>
<ul>
<li>For <code>pi.has_Sup</code>: <code>f : s</code> becomes <code>f ∈ s</code></li>
<li>For <code>set.has_Sup</code>: <code>∃ t ∈ s</code> becomes <code>⨆ t ∈ s</code></li>
</ul>



<a name="303834661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303834661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303834661">(Oct 13 2022 at 13:41)</a>:</h4>
<p>I'm tempted to try this but first I thought I'd see if anyone who has been more involved in the order hierarchy can see an obvious reason why this is doomed?</p>



<a name="303834717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303834717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303834717">(Oct 13 2022 at 13:41)</a>:</h4>
<p>(same remarks for <code>Inf</code>s ofc)</p>



<a name="303838153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303838153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303838153">(Oct 13 2022 at 13:59)</a>:</h4>
<p>Maybe it's easier to make such instances definitionally equal if we consistently define <code>Sup</code> in terms of <code>Sup</code> of the "lower" structure, instead of defining it using <code>bsupr</code> (which is a <code>Sup</code> of an image over another <code>Sup</code>)?</p>



<a name="303838912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303838912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303838912">(Oct 13 2022 at 14:02)</a>:</h4>
<p>i.e.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.set.lattice</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">pi.has_Sup'</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_Sup</span> <span class="o">(</span><span class="n">β</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span> <span class="n">has_Sup</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">β</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">s</span> <span class="n">i</span><span class="o">,</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">function.eval</span> <span class="n">i</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)⟩</span>

<span class="kd">def</span> <span class="n">set.has_Sup'</span> <span class="o">:</span> <span class="n">has_Sup</span> <span class="o">(</span><span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">|</span> <span class="n">Sup</span> <span class="o">((</span><span class="bp">λ</span> <span class="n">t</span><span class="o">,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">t</span><span class="o">)</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)}⟩</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">@</span><span class="n">pi.has_Sup'</span> <span class="n">α</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">set.has_Sup'</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="303839453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303839453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303839453">(Oct 13 2022 at 14:05)</a>:</h4>
<p>Thanks, this might indeed be better! If I take this up I'd be tempted to go with whichever change is easier to implement given what we already have in place but if its a tie, I think I'll go for this.</p>



<a name="303839524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303839524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303839524">(Oct 13 2022 at 14:05)</a>:</h4>
<p>We explicitly prefer <code>⨆ i ∈ s, f i</code> over <code>Sup (f '' s)</code>, though.</p>



<a name="303839933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303839933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303839933">(Oct 13 2022 at 14:07)</a>:</h4>
<p>See for example, <a href="https://leanprover-community.github.io/mathlib_docs/find/with_top.coe_Sup">docs#with_top.coe_Sup</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/lower_set.coe_Sup">docs#lower_set.coe_Sup</a>, ...</p>



<a name="303840415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303840415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303840415">(Oct 13 2022 at 14:10)</a>:</h4>
<p>We rely a lot on the defeq of <code>set.has_Sup</code>, so changing this would be a pain.</p>



<a name="303840830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303840830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303840830">(Oct 13 2022 at 14:12)</a>:</h4>
<p>Note that <code>⨆ i ∈ s, f i</code> almost always returns garbage in a conditionally complete lattice (because when <code>i</code> is not in <code>s</code>you are looking at the Sup of the empty set, which might be anything), while <code>Sup (f '' s)</code> is typically better behaved.</p>



<a name="303841019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303841019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303841019">(Oct 13 2022 at 14:13)</a>:</h4>
<p>Yes, that's the one reason we use it, but we avoid it completely in complete lattices.</p>



<a name="303841408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303841408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303841408">(Oct 13 2022 at 14:14)</a>:</h4>
<p>This might be a historical accident, by the way: at the beginning there were only complete lattices, and conditionally complete ones were added much later on.</p>



<a name="303841582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303841582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303841582">(Oct 13 2022 at 14:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets/near/303839524">said</a>:</p>
<blockquote>
<p>We explicitly prefer <code>⨆ i ∈ s, f i</code> over <code>Sup (f '' s)</code>, though.</p>
</blockquote>
<p>In lemma statements about complete lattices I agree, but on the basic plumbing in definitions like <code>pi.has_Sup</code> I think it's weird to define <code>Sup</code> in terms of a more complicated (but equal) operation in the <code>β i</code>.<br>
We probably do (ab?)use the defeq of <code>set.has_Sup</code> though...</p>



<a name="303841595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303841595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303841595">(Oct 13 2022 at 14:15)</a>:</h4>
<p><code>⨆ (i : s), f i</code> is good also in conditionally complete lattices, and maybe better defeqwise than <code>Sup (f '' s)</code>.</p>



<a name="303847561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303847561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303847561">(Oct 13 2022 at 14:16)</a>:</h4>
<p>I think those two are defeq?</p>



<a name="303847630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303847630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303847630">(Oct 13 2022 at 14:16)</a>:</h4>
<p>oh no, the former is in terms of <code>set.range</code>...</p>



<a name="303847632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303847632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303847632">(Oct 13 2022 at 14:16)</a>:</h4>
<p>No, they are one <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype.exists">docs#subtype.exists</a> away from each other.</p>



<a name="303899951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303899951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303899951">(Oct 13 2022 at 18:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets/near/303635502">said</a>:</p>
<blockquote>
<p>The canonical way to view a set as a function is <code>(∈ s)</code></p>
</blockquote>
<p>I did the experiment to change the measure theory folder to replace the defeq abuse <code>s =ᵐ[μ] t</code> with the more correct <code>(∈ s) =ᵐ[μ] (∈ t)</code>. You can see the outcome in <a href="https://github.com/leanprover-community/mathlib/pull/16960">#16960</a>. Personally, I am not convinced: readability is really worse, and the gain is virtually null (and the linter is not happy). So unless some people insist they like the new version better, I'll just close this in a few days.</p>



<a name="303908156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303908156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303908156">(Oct 13 2022 at 19:24)</a>:</h4>
<p>There's always the option of making an <code>abbreviation</code> to turn <code>(∈ s) =ᵐ[μ] (∈ t)</code>into <code>s =ᵐˢ[μ] t</code> (ot somet other notation) and restore readability.</p>



<a name="303916742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303916742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303916742">(Oct 13 2022 at 20:19)</a>:</h4>
<p>Oh, I now see that <a href="https://github.com/leanprover-community/mathlib/pull/16960">#16960</a> is related to this thread (I didn't read the whole thread before). I agree that that PR makes the readability worse, but we have been avoiding the <code>set</code>-defeq as much as we could. So I'm not sure if we should go further with it...</p>



<a name="303917221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303917221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303917221">(Oct 13 2022 at 20:22)</a>:</h4>
<p>The readability loss is really horrible.</p>



<a name="303917479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303917479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303917479">(Oct 13 2022 at 20:24)</a>:</h4>
<p>It makes more sense to define another variation on <code>eq_on</code> instead of using these lambdas everywhere</p>



<a name="303927952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/303927952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#303927952">(Oct 13 2022 at 21:35)</a>:</h4>
<p>Another systematic abuse is around presieves and sieves in category theory / Grothendieck topology /sites: <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.presieve">docs#category_theory.presieve</a> is defined to be <code>set</code> but you can see it's used like a function as in <code>S f</code> in <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.presieve.bind">docs#category_theory.presieve.bind</a>. There is even a <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.sieve.has_coe_to_fun">docs#category_theory.sieve.has_coe_to_fun</a> instance.</p>
<p>There are some implicit arguments involved so maybe you can't directly write <code>∈ S</code> but it should be possible to define a <code>set_like</code> instance to a sigma type like <a href="https://github.com/leanprover-community/mathlib/pull/16742/files#diff-3eb4bd9f7c708a63eb6dd66cf8b16b765b39abea5afbc7284f84b33a1da98097R133-R135">we did in the subgroupoid PR</a>.</p>
<p>But then you have to write <code>⟨Y, f⟩ ∈ S</code> instead of just <code>f ∈ S</code> but you may define another notation like <code>f ∈' S</code> that is more succinct.</p>



<a name="304103728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20of%20complete%20boolean%20algebras%20on%20sets/near/304103728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20of.20complete.20boolean.20algebras.20on.20sets.html#304103728">(Oct 14 2022 at 19:38)</a>:</h4>
<p>For what it's worth, if someone can make <code>∈ S</code> work here, then I'm in favour of removing the coe_to_fun and removing the defeq abuse. Alternatively we could change presieves to be phrased in terms of predicates, and enforce <code>set_of</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>