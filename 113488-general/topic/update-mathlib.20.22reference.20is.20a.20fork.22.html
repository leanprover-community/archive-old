---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html">update-mathlib "reference is a fork"</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="172172108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172172108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172172108">(Jul 31 2019 at 22:26)</a>:</h4>
<p>A student (<span class="user-mention" data-user-id="232317">@Ainsley Pahljina</span>) cloned mathlib from git@github.com:leanprover-community/mathlib.git, installed <code>update-mathlib</code> via <code>curl https://raw.githubusercontent.com/leanprover-community/mathlib-tools/master/scripts/remote-install-update-mathlib.sh -sSf | bash</code>, restarted to get paths right, then ran <code>update-mathlib</code> and received an error message saying "reference is a fork".</p>
<p>What's going on? (Can we have a more helpful error message, that explains the fix?)</p>



<a name="172172342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172172342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172172342">(Jul 31 2019 at 22:30)</a>:</h4>
<p>From looking at the <a href="https://github.com/leanprover-community/mathlib-tools/blob/master/scripts/update-mathlib.py#L39-L54" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/blob/master/scripts/update-mathlib.py#L39-L54">source code</a> it seems that this means that the dependency specified in <code>leanpkg.toml</code> is a fork of mathlib</p>



<a name="172172499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172172499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172172499">(Jul 31 2019 at 22:32)</a>:</h4>
<p>I'm not sure why that wouldn't be allowed, since forks share the same revision sha's, right? So as long as the revision has a corresponding compiled version to download, that seems fine.</p>



<a name="172172553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172172553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172172553">(Jul 31 2019 at 22:33)</a>:</h4>
<p>As far as I can tell Ainsley didn't add a fork, in any case. <span class="user-mention" data-user-id="232317">@Ainsley Pahljina</span>, would you mind posting the contents of your <code>leanpkg.toml</code> file here for us? (If you surround blocks of code with triple backticks it typesets nicely.)</p>



<a name="172172667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172172667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172172667">(Jul 31 2019 at 22:35)</a>:</h4>
<p>Was the error message indeed <code>Error: mathlib reference is a fork</code>?</p>



<a name="172173016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172173016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172173016">(Jul 31 2019 at 22:40)</a>:</h4>
<p>I'm pretty sure it was, but I didn't write it down exactly when looking at her computer. She hadn't added any other dependencies, certainly, besides mathlib.</p>



<a name="172196131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172196131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172196131">(Aug 01 2019 at 06:47)</a>:</h4>
<p>Update-mathlib doesn't work on mathlib as far as I know</p>



<a name="172196142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172196142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172196142">(Aug 01 2019 at 06:47)</a>:</h4>
<p>It only works on projects that have mathlib as a dependency</p>



<a name="172196144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172196144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172196144">(Aug 01 2019 at 06:47)</a>:</h4>
<p>Right, you need <code>cache-olean --fetch</code> for updating mathlib itself (when it is not a dependency).</p>



<a name="172201950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172201950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172201950">(Aug 01 2019 at 08:32)</a>:</h4>
<p>That's the situation we're in --- Ainsley made a new package, and added mathlib as a dependency, but <code>update-mathlib</code> isn't working.</p>



<a name="172202113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172202113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172202113">(Aug 01 2019 at 08:35)</a>:</h4>
<p>So by "cloned mathlib" in the first post, you just mean "added mathlib as a dependency to an existing project and typed <code>leanpkg configure</code>"?</p>



<a name="172202134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172202134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172202134">(Aug 01 2019 at 08:35)</a>:</h4>
<p>What does their <code>leanpkg.toml</code> look like?</p>



<a name="172202541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172202541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172202541">(Aug 01 2019 at 08:42)</a>:</h4>
<p>Did you follow instructions <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/install/project.md" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/install/project.md">https://github.com/leanprover-community/mathlib/blob/master/docs/install/project.md</a> or did you actually type "git" ?</p>



<a name="172205128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172205128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172205128">(Aug 01 2019 at 09:26)</a>:</h4>
<p>I think we followed those instructions. No use of git involved (except to commit the main package directory to a private gitlab repository).</p>



<a name="172205155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172205155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172205155">(Aug 01 2019 at 09:26)</a>:</h4>
<p>Weird. I gues we can't do anything without seeing the <code>leanpkg.toml</code></p>



<a name="172213711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172213711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172213711">(Aug 01 2019 at 11:55)</a>:</h4>
<p>Dumb related question -- if I just pulled mathlib and I want to get all the olean files, what's the best way of doing it? Currently the only way I know is by going to a random project which has mathlib as a dependency and running <code>update-mathlib</code> and then moving all the olean files, being careful to not mess with the timestamps.</p>



<a name="172214294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172214294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Kappelmann <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172214294">(Aug 01 2019 at 12:05)</a>:</h4>
<p>A - presumably not so great - alternative is to download the sources including olean files from here: <a href="https://github.com/leanprover-community/mathlib-nightly/releases/" target="_blank" title="https://github.com/leanprover-community/mathlib-nightly/releases/">https://github.com/leanprover-community/mathlib-nightly/releases/</a></p>



<a name="172224005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172224005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172224005">(Aug 01 2019 at 14:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> The command <code>cache-olean --fetch</code> is exactly for that (assuming you're fine with the branch <code>lean-3.4.2</code>). Or am I misunderstanding your question?</p>



<a name="172224249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172224249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172224249">(Aug 01 2019 at 14:14)</a>:</h4>
<p>That's surely exactly what I'm looking for. I usually don't edit mathlib so didn't know this trick (I never use cache-olean)</p>



<a name="172224255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172224255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172224255">(Aug 01 2019 at 14:14)</a>:</h4>
<p>Thanks!</p>



<a name="172329893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172329893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172329893">(Aug 02 2019 at 18:11)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> The command <code>cache-olean --fetch</code> is exactly for that (assuming you're fine with the branch <code>lean-3.4.2</code>). Or am I misunderstanding your question?</p>
</blockquote>
<p>Doesn't work for me :-/</p>
<div class="codehilite"><pre><span></span>$ git pull
Already up-to-date.
$ cache-olean --fetch
No github section found in &#39;git config&#39;
Querying GitHub...
Error: no nightly archive found
no cache found
</pre></div>



<a name="172334776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172334776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172334776">(Aug 02 2019 at 19:15)</a>:</h4>
<p><code>cache-olean --fetch</code> only works on the remote <code>lean-3.4.2</code> branch (or previous versions of that branch), so first do <code>git checkout origin/lean-3.4.2</code> (assuming <code>origin</code> is your name for the <code>leanprover-community</code> version).</p>



<a name="172334878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172334878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172334878">(Aug 02 2019 at 19:16)</a>:</h4>
<p>and as discussed in the other stream, you might have to do <code>find src/ -name '*.olean' -exec touch {} +</code> afterwards to update the timestamps of your olean files.</p>



<a name="172334946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%20%22reference%20is%20a%20fork%22/near/172334946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/update-mathlib.20.22reference.20is.20a.20fork.22.html#172334946">(Aug 02 2019 at 19:17)</a>:</h4>
<p>you can <code>checkout</code> another commit afterwards (of course, you will have to recompile all the changed files and the files depending on those afterwards)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>