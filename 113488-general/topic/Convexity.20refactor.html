---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Convexity.20refactor.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html">Convexity refactor</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="253162509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253162509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253162509">(Sep 13 2021 at 21:21)</a>:</h4>
<p><strong>State of the convexity refactor</strong></p>
<ul>
<li>port convexity to vector spaces (<code>[module 𝕜 E]</code>)<ul>
<li>redefine <code>segment</code> and <code>open_segment</code>. Done in <a href="https://github.com/leanprover-community/mathlib/issues/9094">#9094</a>.</li>
<li>redefine <code>convex</code> and <code>convex_hull</code>. See <a href="https://github.com/leanprover-community/mathlib/issues/9058">#9058</a>.</li>
<li>redefine <code>convex_on</code> and <code>concave_on</code></li>
<li>redefine <code>finset.center_mass</code></li>
<li>redefine <code>std_simplex</code></li>
<li>port the rest of the library</li>
</ul>
</li>
<li>port convexity to affine spaces (<code>[module 𝕜 V] [affine_space V E]</code>). Very much not done.</li>
</ul>



<a name="253162765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253162765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253162765">(Sep 13 2021 at 21:23)</a>:</h4>
<p>Little update, <a href="https://github.com/leanprover-community/mathlib/issues/9058">#9058</a> (finally!) compiles. It was much easier to generalize <code>convex</code> and <code>convex_hull</code> than <code>segment</code> and <code>open_segment</code> because somehow their properties are closer to the axioms and require less typeclass fuss.</p>



<a name="253163102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163102">(Sep 13 2021 at 21:25)</a>:</h4>
<p>BTw <span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span> I think you should have your say on this, as you started <a href="https://github.com/leanprover-community/mathlib/issues/4787">#4787</a>.</p>



<a name="253163285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163285">(Sep 13 2021 at 21:26)</a>:</h4>
<p>I failed to localize my porting efforts, created a huge mess, then failed to make it ready for review. So, I'm not sure that I should have a say on this. ;)</p>



<a name="253163318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163318">(Sep 13 2021 at 21:27)</a>:</h4>
<p>IMHO porting to affine spaces is not much harder than porting to modules.</p>



<a name="253163582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163582">(Sep 13 2021 at 21:28)</a>:</h4>
<p>Oh that's not kindly worded for yourself! I would rather say that you opened <del>my eyes</del> a PR, sparked the idea in me, warned me of the monstruousity of the refactor, and then let me the opportunity to have a go myself!</p>



<a name="253163661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163661">(Sep 13 2021 at 21:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/253163318">said</a>:</p>
<blockquote>
<p>IMHO porting to affine spaces is not much harder than porting to modules.</p>
</blockquote>
<p>That's exactly what I thought, but one design decision I have done (which is very easily reversible, though) is that I allow convexity and stuff even the space has no negation.</p>



<a name="253163828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163828">(Sep 13 2021 at 21:30)</a>:</h4>
<p>And that's incompatible with affine spaces, right? It looks like generalization of convexity branches here and there's no common ancestor we can generalize to.</p>



<a name="253163995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253163995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253163995">(Sep 13 2021 at 21:32)</a>:</h4>
<p>Here is a problem I can't solve without creating diamonds. You can define <code>convexity_space</code> to be a space with convex combinations <code>∀ x y : R, 0 ≤ x → 0 ≤ y → x + y = 1 → E → E → E</code> with some natural axioms.</p>



<a name="253164054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164054">(Sep 13 2021 at 21:32)</a>:</h4>
<p>Then you have two ways to go from <code>vector_space R E</code> to <code>convexity_space R E</code>.</p>



<a name="253164133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164133">(Sep 13 2021 at 21:33)</a>:</h4>
<p>(deleted)</p>



<a name="253164368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164368">(Sep 13 2021 at 21:35)</a>:</h4>
<p>One way is to use <code>module</code> structure and treat <code>R</code> as a semiring. Another is to use <code>affine_space</code> structure (but this needs subtraction).</p>



<a name="253164534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164534">(Sep 13 2021 at 21:36)</a>:</h4>
<p>Oh, interesting. I will sleep on it.</p>



<a name="253164629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164629">(Sep 13 2021 at 21:37)</a>:</h4>
<p>While these two ways result in equal convexity structures, it seems that we can't make these structures defeq.</p>



<a name="253164698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164698">(Sep 13 2021 at 21:38)</a>:</h4>
<p>So, only one of the ways can be an instance.</p>



<a name="253164780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253164780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253164780">(Sep 13 2021 at 21:38)</a>:</h4>
<p>Are you saying we should have <code>convexity_space</code>?</p>



<a name="253167004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253167004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Frédéric Dupuis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253167004">(Sep 13 2021 at 21:56)</a>:</h4>
<p>I'm having flashbacks to some old conversations:<br>
<a href="#narrow/stream/116395-maths/topic/convexity">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/convexity</a><br>
<a href="#narrow/stream/144837-PR-reviews/topic/3728.3A.20define.20ordered.20semimodules.20and.20generalize.20convexity.2E.2E.2E">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/3728.3A.20define.20ordered.20semimodules.20and.20generalize.20convexity.2E.2E.2E</a></p>



<a name="253168054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253168054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253168054">(Sep 13 2021 at 22:05)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> No, I've described a half-solution to the problem. Since it doesn't solve the problem, I don't suggest we implement it.</p>



<a name="253168107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253168107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253168107">(Sep 13 2021 at 22:06)</a>:</h4>
<p>On the one hand, we can't have a notion of convexity that works both for modules over <code>nnreal</code> and for affine spaces without an abstraction like <code>convexity_space</code>.</p>



<a name="253168158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253168158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253168158">(Sep 13 2021 at 22:06)</a>:</h4>
<p>On the other hand, I'm not sure that we really need both.</p>



<a name="253205781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253205781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253205781">(Sep 14 2021 at 06:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="311453">Frédéric Dupuis</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/253167004">said</a>:</p>
<blockquote>
<p>I'm having flashbacks to some old conversations:</p>
</blockquote>
<p>Pleas have flashbacks more often!</p>



<a name="253206207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253206207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253206207">(Sep 14 2021 at 06:57)</a>:</h4>
<p>If we were to implement your half-solution, Yury, then I feel like the convex operation in a vector space should be inherited from the <code>module</code> side of things, rather than the <code>affine_space</code> one, because it is much closer to the axioms of a vector space.</p>



<a name="253734772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253734772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253734772">(Sep 17 2021 at 12:35)</a>:</h4>
<p>Next up is <a href="https://github.com/leanprover-community/mathlib/issues/9247">#9247</a>! It's just splitting <code>analysis.convex.basic</code> further.</p>



<a name="253737028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253737028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253737028">(Sep 17 2021 at 12:54)</a>:</h4>
<p>Fantastic! That's easy to review (-;</p>



<a name="253772242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253772242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253772242">(Sep 17 2021 at 16:54)</a>:</h4>
<p><code>finset.center_mass</code> uses division, which makes it very restrictive. How much do people care about that division being there?</p>



<a name="253772923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253772923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253772923">(Sep 17 2021 at 16:59)</a>:</h4>
<p>From my point of view,<br>
Pros: Doesn't require that the sum of the weights is 1, but merely that it's positive.<br>
Cons: Needs a field. Doesn't follow <code>affine_combination</code>.</p>



<a name="253773231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773231">(Sep 17 2021 at 17:01)</a>:</h4>
<p>It was written before <code>affine_combination</code>.</p>



<a name="253773250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773250">(Sep 17 2021 at 17:01)</a>:</h4>
<p>This looks as if we had taken <a href="https://leanprover-community.github.io/mathlib_docs/find/convex_iff_div">docs#convex_iff_div</a> to be the definition of convexity.</p>



<a name="253773308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773308">(Sep 17 2021 at 17:01)</a>:</h4>
<p>Feel free to change it.</p>



<a name="253773331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773331">(Sep 17 2021 at 17:01)</a>:</h4>
<p>Okay <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="253773505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773505">(Sep 17 2021 at 17:02)</a>:</h4>
<p>What do you think about renaming it <code>linear_combination</code>?</p>



<a name="253773535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773535">(Sep 17 2021 at 17:03)</a>:</h4>
<p>You can also introduce a proper type for <code>{x : ι →₀ R | (∀ i, 0 ≤ x i) ∧ x.sum (λ i, id)}</code>.</p>



<a name="253773652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773652">(Sep 17 2021 at 17:03)</a>:</h4>
<p>This is the free object in the category of convex spaces.</p>



<a name="253773781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773781">(Sep 17 2021 at 17:04)</a>:</h4>
<p>See what we do about linear combinations in linear algebra.</p>



<a name="253773848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253773848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253773848">(Sep 17 2021 at 17:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/253773652">said</a>:</p>
<blockquote>
<p>This is the free object in the category of convex spaces.</p>
</blockquote>
<p>Erhm... will look that up <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span></p>



<a name="253775369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775369">(Sep 17 2021 at 17:14)</a>:</h4>
<p>I mean that for any convex space and a map <code>f : ι → E</code> you have a unique map from <code>g : {x : ι →₀ R | (∀ i, 0 ≤ x i) ∧ x.sum (λ i, id)}</code> to <code>E</code> such that <code>g (single i x) = f x</code>.</p>



<a name="253775400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775400">(Sep 17 2021 at 17:15)</a>:</h4>
<p>You can ignore the category theory language.</p>



<a name="253775480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775480">(Sep 17 2021 at 17:15)</a>:</h4>
<p>Ah! Did you mean to add an <code>= 1</code>?</p>



<a name="253775520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775520">(Sep 17 2021 at 17:15)</a>:</h4>
<p>I was stuck typechecking.</p>



<a name="253775672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775672">(Sep 17 2021 at 17:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/253775369">said</a>:</p>
<blockquote>
<p>I mean that for any convex space and a map <code>f : ι → E</code> you have a unique map from <code>g : {x : ι →₀ R | (∀ i, 0 ≤ x i) ∧ x.sum (λ i, id)}</code> to <code>E</code> such that <code>g (single i x) = f x</code>.</p>
</blockquote>
<p>Is this not exactly <a href="https://leanprover-community.github.io/mathlib_docs/find/std_simplex">docs#std_simplex</a>?</p>



<a name="253775779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775779">(Sep 17 2021 at 17:17)</a>:</h4>
<p>Aaah, <code>→₀</code> is <code>finsupp</code>.</p>



<a name="253775825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253775825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253775825">(Sep 17 2021 at 17:17)</a>:</h4>
<p>Time for me to learn what that does.</p>



<a name="253776110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776110">(Sep 17 2021 at 17:19)</a>:</h4>
<p>This is one of the ways to speak about sums indexed by an infinite type.</p>



<a name="253776242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776242">(Sep 17 2021 at 17:20)</a>:</h4>
<p>Ah so that's actually a generalization of <code>std_simplex</code>!</p>



<a name="253776299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776299">(Sep 17 2021 at 17:20)</a>:</h4>
<p>Basically, we have</p>
<ul>
<li><a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp">docs#finsupp</a>;</li>
<li><a href="https://leanprover-community.github.io/mathlib_docs/find/dfinsupp">docs#dfinsupp</a> - a dependent and more computable version;</li>
<li><a href="https://leanprover-community.github.io/mathlib_docs/find/finsum">docs#finsum</a>;</li>
<li><a href="https://leanprover-community.github.io/mathlib_docs/find/finset.sum">docs#finset.sum</a>.</li>
</ul>



<a name="253776315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776315">(Sep 17 2021 at 17:20)</a>:</h4>
<p>Yes.</p>



<a name="253776379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776379">(Sep 17 2021 at 17:21)</a>:</h4>
<p>You allow <code>ι</code> to be infinite but require <code>f</code> to be zero outside of a finite set.</p>



<a name="253776553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776553">(Sep 17 2021 at 17:22)</a>:</h4>
<p>Unrelatingly, what do you think about defining <code>strict_convex_on</code>/<code>strict_concave_on</code>?</p>



<a name="253776601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776601">(Sep 17 2021 at 17:22)</a>:</h4>
<p>I have no time to do this. Feel free to define them.</p>



<a name="253776691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776691">(Sep 17 2021 at 17:22)</a>:</h4>
<p>Then you'll get a better version of mean inequalities for free.</p>



<a name="253776700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253776700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253776700">(Sep 17 2021 at 17:22)</a>:</h4>
<p>Will do!</p>



<a name="253873673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/253873673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#253873673">(Sep 18 2021 at 14:54)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/9264">#9264</a> is ready. It takes care of <code>is_extreme</code> and <code>is_exposed</code>.</p>



<a name="254387262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254387262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254387262">(Sep 22 2021 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span>, you should have warned me about <a href="https://github.com/leanprover-community/mathlib/issues/9298">#9298</a> <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="254426077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254426077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254426077">(Sep 22 2021 at 19:39)</a>:</h4>
<p>Next up is <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a>! It takes care of <code>std_simplex</code> (yes, just as <a href="https://github.com/leanprover-community/mathlib/issues/9298">#9298</a>) and <code>finset.center_mass</code>, which I'm renaming to <code>finset.linear_combination</code>. Ultimately, <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.linear_combination">docs#finset.linear_combination</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.affine_combination">docs#finset.affine_combination</a> will take in <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp">docs#finsupp</a> and drop their <code>finset.</code> namespace.</p>



<a name="254433833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254433833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254433833">(Sep 22 2021 at 20:29)</a>:</h4>
<p>We already have linear combinations with <code>finsupp</code>. They're used all over the place in <code>linear_independent</code></p>



<a name="254437363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254437363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254437363">(Sep 22 2021 at 20:52)</a>:</h4>
<p>Wait, are they <em>defined</em>, or are they used ad hoc? I couldn't find the relevant declaration.</p>



<a name="254437520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254437520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254437520">(Sep 22 2021 at 20:54)</a>:</h4>
<p>What do you think I should do, then?</p>



<a name="254441250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254441250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254441250">(Sep 22 2021 at 21:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/254387262">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span>, you should have warned me about <a href="https://github.com/leanprover-community/mathlib/issues/9298">#9298</a> <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>
</blockquote>
<p>Sorry about that. I was worried there were other PRs going on but I hadn't been following closely. :-(</p>



<a name="254441392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254441392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254441392">(Sep 22 2021 at 21:20)</a>:</h4>
<p>If it's made a mess of a bigger PR we can back it out.</p>



<a name="254444319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254444319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254444319">(Sep 22 2021 at 21:46)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/linear_independent">docs#linear_independent</a> uses <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp.total">docs#finsupp.total</a></p>



<a name="254444444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254444444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254444444">(Sep 22 2021 at 21:48)</a>:</h4>
<p>We can bundle it even more into <code>(α → M) →ₗ[R] ((α →₀ R) →ₗ[R] M)</code></p>



<a name="254444819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254444819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254444819">(Sep 22 2021 at 21:51)</a>:</h4>
<p>For convexity, you actually need the restriction of this map to the standard simplex (which should be defined as <code>{x : α →₀ R | (∀ a, 0 ≤ x a) ∧ x.sum (λ a, id) = 1}</code>.</p>



<a name="254445723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254445723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254445723">(Sep 22 2021 at 21:58)</a>:</h4>
<p>I expect you may need to add quite a few definitions / lemmas about <code>finsupp</code> to make manipulations of <code>finsupp</code> as convenient as those of unbundled functions and <code>finset.sum</code> (i.e., so that none of the existing proofs involving affine combinations become any more complicated as a result of using <code>finsupp</code>). I certainly expect a definition of <code>affine_combination</code> using <code>finsupp</code> will turn out to be cleaner in the end, but <code>finsupp</code> seemed harder to use than unbundled functions and <code>finset.sum</code> when I was originally defining <code>affine_combination</code>.</p>
<p>There might be a question of whether <code>affine_combination</code> should use the affine subspace of <code>finsupp</code> where the sum of the weights is 1 (as opposed to using an arbitrary <code>finsupp</code> and a separate hypothesis about the sum of the weights on those lemmas that need it), but that could complicate things and I don't know if it would bring much practical benefit.</p>



<a name="254490105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254490105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254490105">(Sep 23 2021 at 07:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/254441392">said</a>:</p>
<blockquote>
<p>If it's made a mess of a bigger PR we can back it out.</p>
</blockquote>
<p>No, that's fine. I will just look petty by changing the name of the variable everywhere <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span></p>



<a name="254492611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254492611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254492611">(Sep 23 2021 at 07:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/254444319">said</a>:</p>
<blockquote>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/linear_independent">docs#linear_independent</a> uses <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp.total">docs#finsupp.total</a></p>
</blockquote>
<p>Okay, so what is supposed to be the point of <code>linear_combination</code>? If it's really just <code>finsupp.total</code> without <code>finsupp</code>, maybe we can drop it altogether?</p>



<a name="254493692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254493692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254493692">(Sep 23 2021 at 07:36)</a>:</h4>
<p>Part of the problem I suspect is that <code>finsupp.total</code> is hard to find vs <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.linear_combination">docs#finset.linear_combination</a> which has a clearer name.</p>



<a name="254493829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254493829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254493829">(Sep 23 2021 at 07:37)</a>:</h4>
<p>I'm confused, what <code>linear_combination</code> are you even talking about?</p>



<a name="254498585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254498585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254498585">(Sep 23 2021 at 08:18)</a>:</h4>
<p>I renamed <a href="https://leanprover-community.github.io/mathlib_docs/find/finset.center_mass">docs#finset.center_mass</a>. See <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a></p>



<a name="254498701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254498701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254498701">(Sep 23 2021 at 08:19)</a>:</h4>
<p>Thanks for inadvertently affirming this choice <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="254660564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254660564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254660564">(Sep 24 2021 at 07:04)</a>:</h4>
<p>Okay so <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a> (<code>convex_on</code>, <code>concave_on</code> is also ready for review. It's independent of <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a> (<code>std_simplex</code>, <code>finset.center_mass</code>/<code>finset.linear_combination</code>) except for Jensen's inequality. If we could just decide what to do with <code>finset.center_mass</code>, this one could go through rather easily.</p>



<a name="254664132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254664132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254664132">(Sep 24 2021 at 07:41)</a>:</h4>
<p>I'll take a look at these this afternoon.</p>



<a name="254669805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254669805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254669805">(Sep 24 2021 at 08:33)</a>:</h4>
<p>Thanks!</p>



<a name="254723210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254723210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254723210">(Sep 24 2021 at 15:32)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> I just spent some time looking over <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a> and left <a href="https://github.com/leanprover-community/mathlib/pull/9268#discussion_r715711362">this comment</a>.</p>



<a name="254723478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254723478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254723478">(Sep 24 2021 at 15:34)</a>:</h4>
<p>I have not looked at <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a> beyond noting that it has a huge diff and technically does depend on <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a>. I note that you say that "it's not much work to make it independent". I suggest doing this work as it will make me review it!</p>



<a name="254768291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254768291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254768291">(Sep 24 2021 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="240862">@Oliver Nash</span>, you have it!</p>



<a name="254768422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/254768422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#254768422">(Sep 24 2021 at 20:34)</a>:</h4>
<p>It won't compile for the Jensen inequality part. I'll fix that tomorrow morning. The rest won't be affected and can be reviewed already.</p>



<a name="255038381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255038381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255038381">(Sep 27 2021 at 12:23)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/9268#discussion_r715692515">https://github.com/leanprover-community/mathlib/pull/9268#discussion_r715692515</a> is still an open remark. Are there further comments for <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a> ? Otherwise I think that one should be mergeable soonish.</p>



<a name="255039076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039076">(Sep 27 2021 at 12:29)</a>:</h4>
<p>For me a resolution of <a href="https://github.com/leanprover-community/mathlib/pull/9268#pullrequestreview-763215418">https://github.com/leanprover-community/mathlib/pull/9268#pullrequestreview-763215418</a> would help decide.</p>



<a name="255039095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039095">(Sep 27 2021 at 12:29)</a>:</h4>
<p>But I agree, this PR is certainly close.</p>



<a name="255039347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039347">(Sep 27 2021 at 12:31)</a>:</h4>
<p>To be honest, I think there are two options now:</p>
<ul>
<li>Merge as is and I'll change to using <code>finsupp.total</code> in another PR</li>
<li>Change everything to use <code>finsupp.total</code></li>
</ul>



<a name="255039426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039426">(Sep 27 2021 at 12:32)</a>:</h4>
<p>What's wrong with writing <code>s.sum (w • p)</code> instead of <code>finset.linear_combination p w</code> everywhere?</p>



<a name="255039454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039454">(Sep 27 2021 at 12:32)</a>:</h4>
<p>Missing glue <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="255039482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039482">(Sep 27 2021 at 12:32)</a>:</h4>
<p>I also think that <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a> should be merged before now that it's been made independent from <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a>.</p>



<a name="255039628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039628">(Sep 27 2021 at 12:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/255039454">said</a>:</p>
<blockquote>
<p>Missing glue <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>
</blockquote>
<p>Maybe I'm begin dense but your proposed definition is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">linear_combination</span> <span class="o">{</span><span class="bp">𝕜</span> <span class="n">E</span> <span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ordered_semiring</span> <span class="bp">𝕜</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span>
  <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">finset</span> <span class="n">ι</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">w</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="bp">𝕜</span><span class="o">)</span> <span class="o">:</span> <span class="n">E</span> <span class="o">:=</span>
<span class="bp">∑</span> <span class="n">i</span> <span class="k">in</span> <span class="n">s</span><span class="o">,</span> <span class="n">w</span> <span class="n">i</span> <span class="bp">•</span> <span class="n">p</span> <span class="n">i</span>
</code></pre></div>
<p>Isn't that defeq to <code>s.sum (w • p)</code>?</p>



<a name="255039752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039752">(Sep 27 2021 at 12:34)</a>:</h4>
<p>Basically we avoided making this definition in the linear algebra part of the library so introducing it here (with restrictive typeclasses) seems wrong to me.</p>



<a name="255039789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039789">(Sep 27 2021 at 12:35)</a>:</h4>
<p>Ah wait, you're still having <code>s : finset ι</code>. I thought you meant to switch to <code>finsupp</code>.</p>



<a name="255039858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039858">(Sep 27 2021 at 12:35)</a>:</h4>
<p>But what's <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp.total">docs#finsupp.total</a> then?</p>



<a name="255039965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255039965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255039965">(Sep 27 2021 at 12:36)</a>:</h4>
<p>The finitely-supported version.</p>



<a name="255040107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040107">(Sep 27 2021 at 12:37)</a>:</h4>
<p>Okay so I have <a href="https://github.com/leanprover-community/mathlib/tree/std_simplex_finsupp">branch#std_simplex_finsupp</a> (currently a mess, feel free to help!) to change <a href="https://leanprover-community.github.io/mathlib_docs/find/std_simplex">docs#std_simplex</a> to a set of <code>finsupp</code>s, hence relaxing the fintype assumption.</p>



<a name="255040109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040109">(Sep 27 2021 at 12:37)</a>:</h4>
<p>I should say that even as it stands I think this PR is a net positive so if others want to merge it as it stands, I will support that.</p>



<a name="255040264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040264">(Sep 27 2021 at 12:38)</a>:</h4>
<p>And I think that <code>affine_combination</code> and <code>liner_combination</code> shoudl be changed to using <code>finsupp</code> too.</p>



<a name="255040322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040322">(Sep 27 2021 at 12:39)</a>:</h4>
<p>Scope creep can destroy the best intentions. My 2c is to focus on one thing at a time.</p>



<a name="255040395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040395">(Sep 27 2021 at 12:40)</a>:</h4>
<p>Yes sure. So I think the answer here is to merge <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a></p>



<a name="255040583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040583">(Sep 27 2021 at 12:41)</a>:</h4>
<p>I'm keen to see this merged but question about <code>finset.linear_combination</code> is still unresolved, right?</p>



<a name="255040599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040599">(Sep 27 2021 at 12:41)</a>:</h4>
<p>I think you'll need to convince someone else to merge it or convince me that it is non-trivial to start writing <code>s.sum (w • p)</code> instead of <code>s.linear_combination p w</code>.</p>



<a name="255040790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040790">(Sep 27 2021 at 12:43)</a>:</h4>
<p>I'm fine with dropping <code>finset.linear_combination</code> altogether and use <code>s.sum (w • p)</code>. Then we can use <code>finsupp.total</code> when we want to switch to <code>finsupp</code>.</p>



<a name="255040844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040844">(Sep 27 2021 at 12:43)</a>:</h4>
<p>Right, I see the role of <code>finsupp</code> as completely orthogonal to the concerns of this PR.</p>



<a name="255040962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255040962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255040962">(Sep 27 2021 at 12:44)</a>:</h4>
<p>The space of refactors is of high dimension <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="255085256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255085256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255085256">(Sep 27 2021 at 17:16)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span>  I've just been looking over <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a> and I think it can be merged but I think the title is out of date because you already split out the generalisation of convexity (concavity) of functions.</p>



<a name="255085317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255085317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255085317">(Sep 27 2021 at 17:16)</a>:</h4>
<p>Do you feel something along the lines of "reorganise lemmas about convexity (concavity) of functions and generalise Jensen" is about right?</p>



<a name="255085616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255085616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255085616">(Sep 27 2021 at 17:18)</a>:</h4>
<p>What about adding plainly "in lemmas"?</p>



<a name="255085641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255085641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255085641">(Sep 27 2021 at 17:18)</a>:</h4>
<p>Go for it!</p>



<a name="255085958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255085958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255085958">(Sep 27 2021 at 17:20)</a>:</h4>
<p>I pulled the trigger.</p>



<a name="255086041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255086041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255086041">(Sep 27 2021 at 17:21)</a>:</h4>
<p>Scary!</p>



<a name="255116041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255116041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255116041">(Sep 27 2021 at 20:37)</a>:</h4>
<p>Now that <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a> is merged, I'll clean up <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a> tomorrow and hopefully it is mergeable soon.</p>



<a name="255116140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255116140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255116140">(Sep 27 2021 at 20:38)</a>:</h4>
<p>In parallel (strictly speaking, this isn't part of the refactor), I'll define <code>strict_convex_on</code> and <code>strict_concave_on</code>.</p>



<a name="255224239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255224239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255224239">(Sep 28 2021 at 14:19)</a>:</h4>
<p>Good thing that we split off <code>analysis.convex.function</code>. Strict convex/concave functions are about to inflate the number of line to 1.1k!</p>



<a name="255251155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255251155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255251155">(Sep 28 2021 at 16:58)</a>:</h4>
<p>I've just opened</p>
<ul>
<li><a href="https://github.com/leanprover-community/mathlib/issues/9438">#9438</a> (+194, −137): general cleanup of <code>analysis.convex.function</code></li>
<li><a href="https://github.com/leanprover-community/mathlib/issues/9439">#9439</a> (+18, −6): define strictly convex/concave functions</li>
<li><a href="https://github.com/leanprover-community/mathlib/issues/9437">#9437</a> (+531, −123) : provide all the API for strictly convex/concave functions<br>
The first two are independent and can be merged simultaneously.</li>
</ul>



<a name="255268131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255268131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255268131">(Sep 28 2021 at 17:57)</a>:</h4>
<p>I just noticed that <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a> relaxed some <code>add_comm_group</code> typeclass assumptions to <code>add_comm_monoid</code>. I think we should possibly undo this because these monoids have a scalar action of a <code>ring</code> (in fact a <code>linear_ordered_field</code>) so they're actually groups and so this is not a more general situation and is just a bit more awkward.</p>



<a name="255268282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255268282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255268282">(Sep 28 2021 at 17:58)</a>:</h4>
<p>For example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.order.field</span>
<span class="kn">import</span> <span class="n">algebra.module.basic</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_ordered_field</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">E</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">E</span> <span class="o">:=</span> <span class="n">module.add_comm_monoid_to_add_comm_group</span> <span class="n">R</span>
</code></pre></div>



<a name="255268629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255268629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255268629">(Sep 28 2021 at 18:00)</a>:</h4>
<p>For an example of why this is more awkward note that I had to fix <a href="https://github.com/leanprover-community/mathlib/runs/3735088056">this bors failure</a> with <a href="https://github.com/leanprover-community/mathlib/pull/9103/commits/49717380c4ea31ff2c3652b3bef223910194960e">this commit</a>.</p>



<a name="255268927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255268927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255268927">(Sep 28 2021 at 18:01)</a>:</h4>
<p>However I claim the right fix is to revert <code>add_comm_monoid E</code> back to <code>add_comm_group E</code> <a href="https://github.com/leanprover-community/mathlib/blob/15f15a6e76f65b0b56938e3db831c2cde1431814/src/analysis/convex/combination.lean#L29">here</a></p>



<a name="255269176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255269176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255269176">(Sep 28 2021 at 18:02)</a>:</h4>
<p>Do I have support to carry out this reversion?</p>



<a name="255269442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255269442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255269442">(Sep 28 2021 at 18:04)</a>:</h4>
<p>Oh okay, as soon as you have <code>ring R</code>... That's interesting.</p>



<a name="255269540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255269540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255269540">(Sep 28 2021 at 18:04)</a>:</h4>
<p>Go for it. It might also simplify the structure of the files.</p>



<a name="255269545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255269545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255269545">(Sep 28 2021 at 18:04)</a>:</h4>
<p>Exactly, <code>x - y = x + (-1)•y</code>.</p>



<a name="255269648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255269648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255269648">(Sep 28 2021 at 18:05)</a>:</h4>
<p>OK I'll push that fix for this file as part of <a href="https://github.com/leanprover-community/mathlib/issues/9103">#9103</a></p>



<a name="255269727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255269727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255269727">(Sep 28 2021 at 18:05)</a>:</h4>
<p>Would you be available to hunt down any other examples of this introduced in <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a>?</p>



<a name="255270105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255270105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255270105">(Sep 28 2021 at 18:08)</a>:</h4>
<p><del>Actually I think that was the only instance of this (introduced in <a href="https://github.com/leanprover-community/mathlib/issues/9356">#9356</a>) so once <a href="https://github.com/leanprover-community/mathlib/issues/9103">#9103</a> lands all should be well again <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></del></p>
<p>This looks suspicious: <a href="https://github.com/leanprover-community/mathlib/pull/9356/files#diff-2c41777d2dc24191912a0713d599feb75a13f1f12ad4978dbba711b15e5d228bR461">https://github.com/leanprover-community/mathlib/pull/9356/files#diff-2c41777d2dc24191912a0713d599feb75a13f1f12ad4978dbba711b15e5d228bR461</a></p>



<a name="255270441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255270441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255270441">(Sep 28 2021 at 18:09)</a>:</h4>
<p>And this <a href="https://github.com/leanprover-community/mathlib/pull/9356/files#diff-2c41777d2dc24191912a0713d599feb75a13f1f12ad4978dbba711b15e5d228bR605">https://github.com/leanprover-community/mathlib/pull/9356/files#diff-2c41777d2dc24191912a0713d599feb75a13f1f12ad4978dbba711b15e5d228bR605</a></p>



<a name="255270525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255270525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255270525">(Sep 28 2021 at 18:10)</a>:</h4>
<p>Last one I think: <a href="https://github.com/leanprover-community/mathlib/pull/9356/files#diff-2c41777d2dc24191912a0713d599feb75a13f1f12ad4978dbba711b15e5d228bR644">https://github.com/leanprover-community/mathlib/pull/9356/files#diff-2c41777d2dc24191912a0713d599feb75a13f1f12ad4978dbba711b15e5d228bR644</a></p>



<a name="255270654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255270654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255270654">(Sep 28 2021 at 18:11)</a>:</h4>
<p>I should have flagged these in review. Sorry about that.</p>



<a name="255283761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255283761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255283761">(Sep 28 2021 at 19:29)</a>:</h4>
<p>Sorry these links are broken. What did you mean to show me?</p>



<a name="255284263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255284263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255284263">(Sep 28 2021 at 19:32)</a>:</h4>
<p>I think they work if you click “Load diff” on the file <code>analysis/convex/function.lean</code>. If you like you can ignore this and I’ll create a PR tomorrow morning!</p>



<a name="255284421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255284421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255284421">(Sep 28 2021 at 19:33)</a>:</h4>
<p>Okay, I'll wait for the PR!</p>



<a name="255284692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255284692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255284692">(Sep 28 2021 at 19:35)</a>:</h4>
<p>Just so you know, this should be an easy fix as I've structured the files according to the instance on <code>𝕜</code>. So the fix should be as simple as looking for <code>section ordered_ring</code>, <code>section linear_ordered_field</code>, ... and modifying the <code>variables</code> that comes just after.</p>



<a name="255285183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255285183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255285183">(Sep 28 2021 at 19:38)</a>:</h4>
<p>Great, that should make it very easy.</p>



<a name="255285274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255285274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255285274">(Sep 28 2021 at 19:39)</a>:</h4>
<p>Or just look for <code>add_comm_monoid E</code>, <code>add_comm_monoid F</code>. Also very easy.</p>



<a name="255321809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255321809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255321809">(Sep 29 2021 at 00:18)</a>:</h4>
<p>Would it make sense to put all the material about strictly convex functions in a new file?</p>



<a name="255356078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255356078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255356078">(Sep 29 2021 at 07:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/255284421">said</a>:</p>
<blockquote>
<p>Okay, I'll wait for the PR!</p>
</blockquote>
<p>I just created <a href="https://github.com/leanprover-community/mathlib/issues/9442">#9442</a> for this. In the end I left the <code>monoid</code>s appearing here <a href="https://github.com/leanprover-community/mathlib/blob/d7abdff7d5abd82d0fbdf795e2a0766150e06c42/src/analysis/convex/function.lean#L461-L467">https://github.com/leanprover-community/mathlib/blob/d7abdff7d5abd82d0fbdf795e2a0766150e06c42/src/analysis/convex/function.lean#L461-L467</a> unchanged because there is no compatibility between the action of the scalars and the structure on the types <code>E</code>, <code>β</code> (which incidentally suggests to me that there's room for improvement here).</p>



<a name="255357439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255357439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255357439">(Sep 29 2021 at 07:58)</a>:</h4>
<p>Great!</p>



<a name="255357509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255357509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255357509">(Sep 29 2021 at 07:59)</a>:</h4>
<p>The room for improvement you're talking about is replacing <code>add_comm_monoid E</code> by <code>has_zero E</code>,<code>has_add E</code> (and same in the definition of <code>convex</code>), I think.</p>



<a name="255358483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255358483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255358483">(Sep 29 2021 at 08:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113488-general/topic/Convexity.20refactor/near/255321809">said</a>:</p>
<blockquote>
<p>Would it make sense to put all the material about strictly convex functions in a new file?</p>
</blockquote>
<p>I don't think so. The stuff is <strong>really</strong> similar and all the variants of the same lemma deserve to be a few lines apart. Instead, we could split along other criteria, like Jensen's stuff + maximum principle can earn its own file (albeit it's not many lines).</p>



<a name="255359556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255359556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255359556">(Sep 29 2021 at 08:18)</a>:</h4>
<p>Without Jensen and maximum principle, we're at 993 lines. If we further remove the slope stuff (which is used for convexity from positive second derivative), we get down to 792.</p>



<a name="255360053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255360053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255360053">(Sep 29 2021 at 08:23)</a>:</h4>
<p>For comparison, <code>analysis.convex.basic</code> was 1723 lines long before I started the refactor <span aria-label="scream" class="emoji emoji-1f631" role="img" title="scream">:scream:</span></p>



<a name="255400486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255400486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255400486">(Sep 29 2021 at 13:40)</a>:</h4>
<p>Just opened <a href="https://github.com/leanprover-community/mathlib/issues/9444">#9444</a> (+114, −104) and <a href="https://github.com/leanprover-community/mathlib/issues/9445">#9445</a> (+128, −102)! They do exactly the two splits I just proposed.</p>



<a name="255408554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255408554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255408554">(Sep 29 2021 at 14:27)</a>:</h4>
<p>Thanks! <a href="https://github.com/leanprover-community/mathlib/issues/9445">#9445</a> currently has merge conflicts.</p>



<a name="255408984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255408984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255408984">(Sep 29 2021 at 14:30)</a>:</h4>
<p>Solved <span aria-label="tools" class="emoji emoji-1f6e0" role="img" title="tools">:tools:</span></p>



<a name="255590321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255590321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255590321">(Sep 30 2021 at 15:06)</a>:</h4>
<p>Does it make sense to move <code>convex_hull</code> to something like <code>analysis.convex.hull</code>?</p>



<a name="255590602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255590602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255590602">(Sep 30 2021 at 15:08)</a>:</h4>
<p>or do we declare that <code>analysis.convex.basic</code> is short enough?</p>



<a name="255597416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255597416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255597416">(Sep 30 2021 at 15:50)</a>:</h4>
<p><a href="https://en.wikipedia.org/wiki/1066">1066</a> is of course a very important number, but I don't think it hurts to make that file a bit shorter still. So yes, please split it further.</p>



<a name="255628622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255628622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255628622">(Sep 30 2021 at 18:57)</a>:</h4>
<p>I'm doing convex cones now.</p>



<a name="255862024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862024">(Oct 02 2021 at 10:55)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> I was just having a quick look at <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a> again but I see you've marked it WIP (I guess till you fix the build). So I'm going to wait for now unless you'd like more input right now. OK?</p>



<a name="255862111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862111">(Oct 02 2021 at 10:56)</a>:</h4>
<p>Yeah, I'm still pondering. Sorry I should have marked it WIP a bit earlier.</p>



<a name="255862122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862122">(Oct 02 2021 at 10:57)</a>:</h4>
<p>No problem at all! I'll be ready when you are.</p>



<a name="255862147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862147">(Oct 02 2021 at 10:57)</a>:</h4>
<p>Incidentally I've just created <a href="https://github.com/leanprover-community/mathlib/issues/9499">#9499</a> which will conflict but not much.</p>



<a name="255862202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862202">(Oct 02 2021 at 10:58)</a>:</h4>
<p>Oh yeah, maybe merge that before I do anything.</p>



<a name="255862212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862212">(Oct 02 2021 at 10:58)</a>:</h4>
<p>I'm happy either way, the conflicts will be simple to fix.</p>



<a name="255862342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862342">(Oct 02 2021 at 11:00)</a>:</h4>
<p>Proving <code>convex_hull_range_eq_exists_affine_combination</code> in <a href="https://github.com/leanprover-community/mathlib/issues/9499">#9499</a> almost convinced me to attempt my own version of <a href="https://github.com/leanprover-community/mathlib/issues/9268">#9268</a> where we nuke <code>center_mass</code> and replace it <code>affine_combination</code> but in the end I decided that can wait.</p>



<a name="255862343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862343">(Oct 02 2021 at 11:00)</a>:</h4>
<p>So long as you are there, could you prove the following lemma?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="o">(</span><span class="bp">𝕜</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">)</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_3</span><span class="o">}</span> <span class="o">[</span><span class="n">ordered_semiring</span> <span class="bp">𝕜</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">affine_independent</span> <span class="bp">𝕜</span> <span class="n">p</span> <span class="bp">=</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ι</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ι</span><span class="o">),</span> <span class="n">p</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">affine_span</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">p</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="255862378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862378">(Oct 02 2021 at 11:00)</a>:</h4>
<p><span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span> Let me see. I'm about to head out for a run but I'll give it a go!</p>



<a name="255862384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862384">(Oct 02 2021 at 11:01)</a>:</h4>
<p>This is the definition of <a href="https://leanprover-community.github.io/mathlib_docs/find/convex_independent">docs#convex_independent</a>, but made affine.</p>



<a name="255862406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862406">(Oct 02 2021 at 11:01)</a>:</h4>
<p>Once we have it, I can make <code>affine.independent.convex_independent</code> a one-liner!</p>



<a name="255862477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862477">(Oct 02 2021 at 11:02)</a>:</h4>
<p>(feel free to change to change the typeclasses, they are probably not the full generality)</p>



<a name="255862606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255862606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255862606">(Oct 02 2021 at 11:04)</a>:</h4>
<p>OK I've fired up VSCode and I'll see what I think. Here it is again in MWE form:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.affine_space.independent</span>

<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">(</span><span class="bp">𝕜</span> <span class="n">E</span> <span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">ordered_ring</span> <span class="bp">𝕜</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="bp">𝕜</span> <span class="n">E</span><span class="o">]</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">affine_independent</span> <span class="bp">𝕜</span> <span class="n">p</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ι</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ι</span><span class="o">),</span> <span class="n">p</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">affine_span</span> <span class="bp">𝕜</span> <span class="o">(</span><span class="n">p</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="255863285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/255863285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#255863285">(Oct 02 2021 at 11:15)</a>:</h4>
<p>Sorry, outatime for now!</p>



<a name="256714823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256714823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256714823">(Oct 08 2021 at 09:51)</a>:</h4>
<p>Here, <span class="user-mention" data-user-id="240862">@Oliver Nash</span>, <span class="user-mention" data-user-id="308899">@Yakov Pechersky</span></p>



<a name="256714864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256714864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256714864">(Oct 08 2021 at 09:51)</a>:</h4>
<p>What would be your definition of convex space?</p>



<a name="256714958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256714958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256714958">(Oct 08 2021 at 09:52)</a>:</h4>
<p>Well, if we decided we could restrict to the case of needing negation I think the following:</p>



<a name="256715027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256715027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256715027">(Oct 08 2021 at 09:52)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.affine_space.combination</span>

<span class="n">open_locale</span> <span class="n">affine</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">{</span><span class="n">V</span> <span class="n">P</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="kd">variables</span> <span class="o">[</span><span class="n">ordered_ring</span> <span class="n">k</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">k</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">affine_space</span> <span class="n">V</span> <span class="n">P</span><span class="o">]</span>
<span class="kn">include</span> <span class="n">V</span>

<span class="kd">def</span> <span class="n">convex</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">∀</span> <span class="o">⦃</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">P</span><span class="o">⦄,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">y</span> <span class="bp">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">a</span> <span class="o">:</span> <span class="n">k</span><span class="o">⦄,</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">affine_map.line_map</span> <span class="n">x</span> <span class="n">y</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">s</span>
</code></pre></div>



<a name="256715083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256715083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256715083">(Oct 08 2021 at 09:53)</a>:</h4>
<p>No, I meant a convex <strong>space</strong> <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="256715202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256715202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256715202">(Oct 08 2021 at 09:54)</a>:</h4>
<p>Am I right in thinking there isn't one kind of convex space but a hierarchy of them? Supposedly every kind of scalar action between <code>has_scalar</code> and <code>module</code> gives rise to a different kind of convex space.</p>



<a name="256715404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256715404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256715404">(Oct 08 2021 at 09:56)</a>:</h4>
<p>What's a convex space?</p>



<a name="256715766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256715766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256715766">(Oct 08 2021 at 09:59)</a>:</h4>
<p>A space where you can define convexity.</p>



<a name="256716060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716060">(Oct 08 2021 at 10:01)</a>:</h4>
<p>I don't have many references. That's the problem. Here's something on ncatlab: <a href="https://ncatlab.org/nlab/show/convex+space">https://ncatlab.org/nlab/show/convex+space</a></p>



<a name="256716210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716210">(Oct 08 2021 at 10:03)</a>:</h4>
<p>Oh I see.</p>



<a name="256716386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716386">(Oct 08 2021 at 10:05)</a>:</h4>
<p>So basically it's a space which has <code>line_map</code>.</p>



<a name="256716429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716429">(Oct 08 2021 at 10:05)</a>:</h4>
<p>Then my definition would be the same!</p>



<a name="256716449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716449">(Oct 08 2021 at 10:05)</a>:</h4>
<p>More like a <code>segment_map</code> because you don't care about what's not between the points.</p>



<a name="256716528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716528">(Oct 08 2021 at 10:06)</a>:</h4>
<p>Right.</p>



<a name="256716769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256716769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256716769">(Oct 08 2021 at 10:09)</a>:</h4>
<p>Do you think we should put convex combinations as a field of <code>convex_space</code> or construct it from <code>segment_map</code>?</p>



<a name="256717290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256717290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256717290">(Oct 08 2021 at 10:14)</a>:</h4>
<p>I don't know. My null hypothesis would be to construct it from <code>segment_map</code> but I would not have a strong view here.</p>



<a name="256752840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256752840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256752840">(Oct 08 2021 at 15:00)</a>:</h4>
<p>I think that the main difficulty with <code>convex_space</code> is not to define it and provide instances for an <code>affine_space</code> and a <code>module</code>. The main difficulty is that we unavoidably get a TC diamond for a <code>convex_space real E</code>: the instance going through <code>affine_space</code> can't be defeq to the instance going through <code>module</code>.</p>



<a name="256752963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256752963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256752963">(Oct 08 2021 at 15:00)</a>:</h4>
<p>So, only one of these instances can be a global instance.</p>



<a name="256753173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256753173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256753173">(Oct 08 2021 at 15:02)</a>:</h4>
<p>And more diamonds: probably you want to define a <code>convex_space</code> structure on the product of two spaces etc. If you get the product of two modules (or affine spaces), then probably the <code>segment_map</code> coming from <code>prod</code> won't be defeq to the <code>segment_map</code> coming from <code>module</code>/<code>affine_space</code>.</p>



<a name="256757477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256757477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256757477">(Oct 08 2021 at 15:30)</a>:</h4>
<p>Oh, I hadn't thought about <code>prod</code>. The module instance for <code>prod</code> is well-behaved, right? I know you probably want <code>affine_space</code> -&gt; <code>convex_space</code> to be the global instance instead of <code>module</code> -&gt; <code>convex_space</code>, but I have the instinct that the <code>module</code> -&gt; <code>convex_space</code> instance is cleaner.</p>



<a name="256758104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256758104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256758104">(Oct 08 2021 at 15:34)</a>:</h4>
<p>The best way to verify this is to make a one-field typeclass (just <code>segment_map</code>, no axioms), add instances, and try prove equality by <code>rfl</code>.</p>



<a name="256758600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Convexity%20refactor/near/256758600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Convexity.20refactor.html#256758600">(Oct 08 2021 at 15:38)</a>:</h4>
<p>Will do!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>