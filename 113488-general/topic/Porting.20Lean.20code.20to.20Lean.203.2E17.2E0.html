---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html">Porting Lean code to Lean 3.17.0</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="203206445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203206445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203206445">(Jul 07 2020 at 21:36)</a>:</h4>
<p>I have code working with <code>3.8.0</code> and I'm porting it to <code>3.17.0</code> and some of my rewrites break. I'm having a hard time identifying where the issue is coming from but someone understanding what happened to <code>unify</code> and <code>rewrite</code> (e.g. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> or <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> ) might be able to help.</p>
<p>I have a definition <code>to_subtype</code> that I'm unfolding using <code>rw to_subtype</code>. That rewrite doesn't work anymore and neither do <code>dsimp</code>, <code>simp</code>, <code>unfold</code> and <code>dunfold</code>. I can get the work done again by using either </p>
<div class="codehilite"><pre><span></span><code>    <span class="n">simp</span> <span class="o">[</span><span class="n">to_subtype</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="n">i_n</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span><span class="o">],</span> <span class="c1">-- or</span>
    <span class="n">rw</span> <span class="n">to_subtype</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="n">i_n</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span><span class="o">,</span>
</code></pre></div>


<p>That is to say that I'm providing all the arguments of the exact right equation. Here is the error message when I write:</p>
<div class="codehilite"><pre><span></span><code>    <span class="n">rw</span> <span class="n">to_subtype</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">,</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">rewrite</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">did</span> <span class="n">not</span> <span class="n">find</span> <span class="kn">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pattern</span> <span class="k">in</span> <span class="n">the</span> <span class="n">target</span> <span class="n">expression</span>
  <span class="bp">@</span><span class="n">to_subtype</span> <span class="o">(</span><span class="n">succ</span> <span class="err">?</span><span class="n">m_1</span><span class="o">)</span> <span class="err">?</span><span class="n">m_2</span> <span class="err">?</span><span class="n">m_3</span> <span class="o">(</span><span class="bp">@</span><span class="n">fin&#39;</span><span class="bp">.</span><span class="n">raise</span> <span class="err">?</span><span class="n">m_1</span> <span class="err">?</span><span class="n">m_4</span><span class="o">)</span> <span class="err">?</span><span class="n">m_5</span>
<span class="n">state</span><span class="o">:</span>
<span class="mi">2</span> <span class="n">goals</span>
<span class="n">n</span> <span class="n">i_n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">i_a</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">i_n</span><span class="o">,</span>
<span class="n">i_ih</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">i_n</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">i_n</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">@</span><span class="n">subtype_</span> <span class="n">i_n</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span><span class="o">),</span>
    <span class="bp">@</span><span class="n">to_subtype</span> <span class="n">i_n</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span> <span class="o">(</span><span class="bp">@</span><span class="n">of_subtype</span> <span class="n">i_n</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">id</span> <span class="n">i_n</span> <span class="o">(</span><span class="bp">@</span><span class="n">subtype_</span> <span class="n">i_n</span> <span class="n">α</span> <span class="n">p</span><span class="o">)</span> <span class="n">i_a</span> <span class="n">x</span><span class="o">,</span>
<span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span><span class="o">,</span>
<span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="n">x</span> <span class="o">:</span> <span class="bp">@</span><span class="n">subtype_</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span>
<span class="err">⊢</span> <span class="bp">@</span><span class="n">to_subtype</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="n">α</span> <span class="n">p</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span> <span class="o">(</span><span class="bp">@</span><span class="n">of_subtype</span> <span class="n">i_n</span> <span class="n">α</span><span class="bp">.</span><span class="n">drop</span> <span class="o">(</span><span class="bp">@</span><span class="n">drop_fun</span> <span class="n">i_n</span> <span class="n">α</span> <span class="o">(</span><span class="n">repeat</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">p</span><span class="o">)</span> <span class="n">i_a</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span>
    <span class="bp">@</span><span class="n">id</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">subtype_</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="n">α</span> <span class="n">p</span><span class="o">)</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span> <span class="n">x</span>
</code></pre></div>


<p>Any idea?</p>



<a name="203209106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203209106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203209106">(Jul 07 2020 at 22:03)</a>:</h4>
<p>Do you have a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>?</p>



<a name="203209121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203209121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203209121">(Jul 07 2020 at 22:03)</a>:</h4>
<p>Not yet</p>



<a name="203209208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203209208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203209208">(Jul 07 2020 at 22:04)</a>:</h4>
<p>Maybe just something with the definition of <code>to_subtype</code> and <code>fin'.raise</code> and everything else stubbed out</p>



<a name="203209468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203209468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203209468">(Jul 07 2020 at 22:07)</a>:</h4>
<p>Let's see</p>



<a name="203211729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203211729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203211729">(Jul 07 2020 at 22:35)</a>:</h4>
<p>Ok, I got a small-ish example to type check and ... <code>rw</code> doesn't fail</p>



<a name="203212105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203212105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203212105">(Jul 07 2020 at 22:41)</a>:</h4>
<p>Ok now I managed to fail:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">inductive</span> <span class="n">fin&#39;</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">raise</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">fin&#39;</span> <span class="n">n</span><span class="bp">.</span><span class="n">succ</span>
<span class="bp">|</span> <span class="n">last</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">n</span><span class="bp">.</span><span class="n">succ</span>

<span class="n">def</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">elim0</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">.</span>

<span class="n">universes</span> <span class="n">u</span>

<span class="n">def</span> <span class="n">typevec</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fin&#39;</span> <span class="n">n</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span>

<span class="n">def</span> <span class="n">arrow</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">n</span><span class="o">,</span> <span class="n">α</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">β</span> <span class="n">i</span>

<span class="kn">infixl</span> <span class="bp">`</span> <span class="err">⟹</span> <span class="bp">`</span><span class="o">:</span><span class="mi">40</span> <span class="o">:=</span> <span class="n">arrow</span>
<span class="kn">open</span> <span class="n">nat</span>

<span class="n">def</span> <span class="n">append1</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:</span> <span class="n">typevec</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">fin&#39;</span><span class="bp">.</span><span class="n">raise</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">α</span> <span class="n">i</span>
<span class="bp">|</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span>      <span class="o">:=</span> <span class="n">β</span>

<span class="n">def</span> <span class="n">repeat</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">Sort</span><span class="bp">*</span><span class="o">),</span> <span class="n">typevec</span> <span class="n">n</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">t</span> <span class="o">:=</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">elim0</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="n">i</span><span class="o">)</span> <span class="n">t</span> <span class="o">:=</span> <span class="n">append1</span> <span class="o">(</span><span class="n">repeat</span> <span class="n">i</span> <span class="n">t</span><span class="o">)</span> <span class="n">t</span>

<span class="n">def</span> <span class="n">of_repeat</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">n</span> <span class="n">i</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">repeat</span> <span class="n">n</span> <span class="kt">Prop</span> <span class="n">i</span><span class="o">),</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">fin&#39;</span><span class="bp">.</span><span class="n">raise</span> <span class="n">i</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">of_repeat</span> <span class="n">n</span> <span class="n">i</span> <span class="n">x</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span>

<span class="kn">namespace</span> <span class="n">typevec</span>

<span class="n">def</span> <span class="n">id</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">n</span><span class="o">}</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span>

<span class="n">def</span> <span class="n">drop</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">n</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">α</span> <span class="n">i</span><span class="bp">.</span><span class="n">raise</span>

<span class="n">def</span> <span class="n">last</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">:=</span> <span class="n">α</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span>

<span class="kn">end</span> <span class="n">typevec</span>

<span class="kn">open</span> <span class="n">typevec</span>

<span class="n">def</span> <span class="n">drop_fun</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">typevec</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">drop</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">drop</span> <span class="n">β</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="bp">.</span><span class="n">raise</span>

<span class="kn">infixl</span> <span class="bp">`</span> <span class="bp">::</span><span class="o">:</span> <span class="bp">`</span><span class="o">:</span><span class="mi">67</span> <span class="o">:=</span> <span class="n">append1</span>

<span class="n">def</span> <span class="n">subtype_</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">n</span> <span class="kt">Prop</span><span class="o">),</span> <span class="n">typevec</span> <span class="n">n</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">α</span> <span class="n">p</span> <span class="o">:=</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">elim0</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="n">α</span> <span class="n">p</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">subtype_</span> <span class="n">n</span> <span class="o">(</span><span class="n">drop</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">drop_fun</span> <span class="n">p</span><span class="o">)</span> <span class="bp">::</span><span class="o">:</span> <span class="bp">_</span><span class="n">root_</span><span class="bp">.</span><span class="n">subtype</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">p</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span> <span class="n">x</span><span class="o">)</span>

<span class="n">def</span> <span class="n">to_subtype</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">n</span> <span class="kt">Prop</span><span class="o">),</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">n</span><span class="o">),</span> <span class="o">{</span> <span class="n">x</span> <span class="bp">//</span> <span class="n">of_repeat</span> <span class="err">$</span> <span class="n">p</span> <span class="n">i</span> <span class="n">x</span> <span class="o">})</span> <span class="err">⟹</span> <span class="n">subtype_</span> <span class="n">p</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="n">α</span> <span class="n">p</span> <span class="o">(</span><span class="n">fin&#39;</span><span class="bp">.</span><span class="n">raise</span> <span class="n">i</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">to_subtype</span> <span class="o">(</span><span class="n">drop_fun</span> <span class="n">p</span><span class="o">)</span> <span class="n">i</span> <span class="n">x</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="n">α</span> <span class="n">p</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span>

<span class="n">def</span> <span class="n">of_subtype</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">n</span> <span class="kt">Prop</span><span class="o">),</span>
  <span class="n">subtype_</span> <span class="n">p</span> <span class="err">⟹</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">n</span><span class="o">),</span> <span class="o">{</span> <span class="n">x</span> <span class="bp">//</span> <span class="n">of_repeat</span> <span class="err">$</span> <span class="n">p</span> <span class="n">i</span> <span class="n">x</span> <span class="o">})</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="n">α</span> <span class="n">p</span> <span class="o">(</span><span class="n">fin&#39;</span><span class="bp">.</span><span class="n">raise</span> <span class="n">i</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">of_subtype</span> <span class="bp">_</span> <span class="n">i</span> <span class="n">x</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="n">α</span> <span class="n">p</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">i_n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">i_a</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">i_n</span><span class="o">)</span>
  <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">i_n</span><span class="bp">.</span><span class="n">succ</span> <span class="kt">Prop</span><span class="o">)</span>
  <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">subtype_</span> <span class="n">p</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">to_subtype</span> <span class="n">p</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span> <span class="o">(</span><span class="n">of_subtype</span> <span class="n">p</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">id</span> <span class="n">i_a</span><span class="bp">.</span><span class="n">raise</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">of_subtype</span><span class="o">,</span><span class="n">to_subtype</span><span class="o">],</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203212635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203212635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203212635">(Jul 07 2020 at 22:47)</a>:</h4>
<p>It works in 3.10.0 and breaks in 3.11.0</p>



<a name="203212655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203212655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203212655">(Jul 07 2020 at 22:47)</a>:</h4>
<p>I think that where your <code>rw</code> PR came in but I don't see why it would break it</p>



<a name="203212840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203212840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203212840">(Jul 07 2020 at 22:50)</a>:</h4>
<p>which PR is that?</p>



<a name="203212916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203212916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203212916">(Jul 07 2020 at 22:51)</a>:</h4>
<p>Instantiate meta vars before applying <code>rw</code></p>



<a name="203213479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203213479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203213479">(Jul 07 2020 at 22:58)</a>:</h4>
<p>#?</p>



<a name="203213696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203213696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203213696">(Jul 07 2020 at 23:01)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/213">lean#213</a></p>



<a name="203216212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203216212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203216212">(Jul 07 2020 at 23:35)</a>:</h4>
<p>You seem to have something funny going on with definitional equality, even before getting to the <code>rw</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">variables</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin&#39;</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">m</span><span class="bp">.</span><span class="n">succ</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">m</span><span class="bp">.</span><span class="n">succ</span> <span class="kt">Prop</span><span class="o">)</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="n">rfl</span> <span class="o">:</span> <span class="n">subtype_</span> <span class="n">p</span> <span class="n">i</span><span class="bp">.</span><span class="n">raise</span> <span class="bp">=</span> <span class="n">subtype_</span> <span class="o">(</span><span class="n">drop_fun</span> <span class="n">p</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="c1">-- works</span>
<span class="bp">#</span><span class="kn">check</span> <span class="bp">λ</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">subtype_</span> <span class="n">p</span> <span class="n">i</span><span class="bp">.</span><span class="n">raise</span><span class="o">),</span> <span class="k">show</span> <span class="n">subtype_</span> <span class="o">(</span><span class="n">drop_fun</span> <span class="n">p</span><span class="o">)</span> <span class="n">i</span><span class="o">,</span> <span class="k">from</span> <span class="n">x</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="203216426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203216426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203216426">(Jul 07 2020 at 23:38)</a>:</h4>
<p>Does it fail also in Lean 3.10?</p>



<a name="203217093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203217093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203217093">(Jul 07 2020 at 23:48)</a>:</h4>
<p>This version of <code>subtype_</code> makes it work:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">subtype_</span> <span class="o">{</span><span class="n">n</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">typevec</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">n</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="err">⟹</span> <span class="n">repeat</span> <span class="n">n</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">typevec</span> <span class="n">n</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">begin</span>
  <span class="n">induction</span> <span class="n">i</span> <span class="k">with</span> <span class="n">n</span> <span class="n">i</span> <span class="n">IH</span> <span class="n">generalizing</span> <span class="n">α</span> <span class="n">p</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">@</span><span class="n">IH</span> <span class="o">(</span><span class="n">drop</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">drop_fun</span> <span class="n">p</span><span class="o">)</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">_</span><span class="n">root_</span><span class="bp">.</span><span class="n">subtype</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">p</span> <span class="n">fin&#39;</span><span class="bp">.</span><span class="n">last</span> <span class="n">x</span><span class="o">)</span> <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203217216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203217216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203217216">(Jul 07 2020 at 23:49)</a>:</h4>
<p>Why does this make a difference?</p>



<a name="203217687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203217687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203217687">(Jul 07 2020 at 23:57)</a>:</h4>
<p>Well for one thing it's doing induction on the <code>fin'</code> instead of induction on <code>nat</code> and then cases on <code>fin'</code></p>



<a name="203217920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203217920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203217920">(Jul 08 2020 at 00:01)</a>:</h4>
<p>I see. That fixes your example but not mine though</p>



<a name="203218367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218367">(Jul 08 2020 at 00:08)</a>:</h4>
<p>there seems to be a similar problem in <code>of_subtype</code></p>



<a name="203218508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218508">(Jul 08 2020 at 00:11)</a>:</h4>
<p>Adding this modification of <code>of_repeat</code> makes your example work</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">of_repeat</span> <span class="o">{</span><span class="n">n</span> <span class="n">i</span><span class="o">}</span> <span class="o">:</span> <span class="n">repeat</span> <span class="n">n</span> <span class="kt">Prop</span> <span class="n">i</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">i</span> <span class="k">with</span> <span class="n">n</span> <span class="n">i</span> <span class="n">IH</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">IH</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">id</span> <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203218835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218835">(Jul 08 2020 at 00:16)</a>:</h4>
<p>uh</p>



<a name="203218847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218847">(Jul 08 2020 at 00:17)</a>:</h4>
<p>How did you zero in on <code>of_repeat</code>?</p>



<a name="203218856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218856">(Jul 08 2020 at 00:17)</a>:</h4>
<p>I'm suspecting everything that uses the equation compiler right now</p>



<a name="203218861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218861">(Jul 08 2020 at 00:17)</a>:</h4>
<p>because you need defeqs everything has to be clean inductive definitions</p>



<a name="203218911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218911">(Jul 08 2020 at 00:18)</a>:</h4>
<p>None of this is to say that lean isn't being buggy</p>



<a name="203218937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218937">(Jul 08 2020 at 00:18)</a>:</h4>
<p>Has anything changed in the equation compiler lately?</p>



<a name="203218947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218947">(Jul 08 2020 at 00:19)</a>:</h4>
<p>It is something in the elaborator I think</p>



<a name="203218982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203218982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203218982">(Jul 08 2020 at 00:19)</a>:</h4>
<p>As the <code>rfl</code> proof shows, it is actually defeq and lean knows it when asked directly</p>



<a name="203219060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219060">(Jul 08 2020 at 00:20)</a>:</h4>
<p>but when it comes up in the application lean is using a different reducibility setting or something and refuses to accept it</p>



<a name="203219101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219101">(Jul 08 2020 at 00:21)</a>:</h4>
<p>In your example, this means that the goal after the first rewrite is "not well typed" and this is causing some knock on effect in the second rw</p>



<a name="203219169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219169">(Jul 08 2020 at 00:22)</a>:</h4>
<p>I think <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> changed the unification to prevent <code>irreducible</code> definitions from getting unfolded. I wonder if this could be a side effect</p>



<a name="203219218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219218">(Jul 08 2020 at 00:23)</a>:</h4>
<p>For these type level recursive definitions, I suggest you stick to using <code>rec_on</code> directly or <code>induction</code>, and prove the equational lemmas yourself</p>



<a name="203219269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219269">(Jul 08 2020 at 00:24)</a>:</h4>
<p>Fun</p>



<a name="203219332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219332">(Jul 08 2020 at 00:25)</a>:</h4>
<p>I don't think have PRed the new API functions to register equational lemmas yet. Maybe this would be a good use for it</p>



<a name="203219532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Porting%20Lean%20code%20to%20Lean%203.17.0/near/203219532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Porting.20Lean.20code.20to.20Lean.203.2E17.2E0.html#203219532">(Jul 08 2020 at 00:29)</a>:</h4>
<p>Thanks for helping me debug this</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>