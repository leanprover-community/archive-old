---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html">Debugging Lean games & building JS/WASM versions for Lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="225438225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438225">(Feb 07 2021 at 00:59)</a>:</h4>
<p>I'm currently packaging Lean games into NixOS, with some generic builder to deploy easily more Lean games (some code is around there: <a href="https://github.com/RaitoBezarius/nixexprs/blob/master/pkgs/tools/make-lean-game.nix">https://github.com/RaitoBezarius/nixexprs/blob/master/pkgs/tools/make-lean-game.nix</a>).</p>
<p>I have deployed the master branch of NNG on <a href="https://nng.lean.v6.lahfa.xyz">https://nng.lean.v6.lahfa.xyz</a> (IPv6-only website sorry! Can make it available through IPv4 though upon request), though I am getting empty infoboxes everywhere.</p>
<p>I admit that I have done something that I should not have, e.g. it produces the NNG game using Lean 3.24.0 when it asks for Lean 3.4.2, and it uses Lean 3.4.2 JS/WASM files in the browser with 3.24.0 olean files I guess (as the ZIP file must contain those).</p>
<p>Though, I expect some kind of error, the thing is I get nothing, the editor, the world looks to be working fine, but when I do "refl," on the first level, it just does nothing after a short "Lean is busy...", so I assume that there is something wrong with the Lean runtime.</p>
<p>That's the first part of the question.</p>
<p>For the second part, one way to test the previous hypothesis would be to produce JS/WASM files for Lean 3.24.0 and remake the NNG for 3.24.0, it appears to me that <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> is maintainer on the Lean package on NixOS, I would like to ask: how much effort would be needed to add as an output the <code>lean_js_js.js, lean_js_wasm.js, lean_js_wasm.wasm</code> files in the Lean package? Or how can I produce them given the Lean package? I tried to poke around in the source code but didn't find really explicit stuff, I was planning to dig into the CMake files but maybe it is faster and better to just ask?</p>



<a name="225438443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438443">(Feb 07 2021 at 01:04)</a>:</h4>
<p>The <code>lean_js_*</code> files are available from the community Lean releases on GitHub, e.g. <a href="https://github.com/leanprover-community/lean/releases/tag/v3.26.0">https://github.com/leanprover-community/lean/releases/tag/v3.26.0</a> (see <code>lean-3.26.0--browser.zip</code>).</p>



<a name="225438446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438446">(Feb 07 2021 at 01:04)</a>:</h4>
<p>Does any of the info <a href="https://github.com/leanprover-community/lean-web-editor">here</a> help?</p>



<a name="225438513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438513">(Feb 07 2021 at 01:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438443">said</a>:</p>
<blockquote>
<p>The <code>lean_js_*</code> files are available from the community Lean releases on GitHub, e.g. <a href="https://github.com/leanprover-community/lean/releases/tag/v3.26.0">https://github.com/leanprover-community/lean/releases/tag/v3.26.0</a> (see <code>lean-3.26.0--browser.zip</code>).</p>
</blockquote>
<p>I could just copy them in the repo and follow the same workflow but hopefully I'm aiming at automating to "produce" the right Lean version end to end for those games, so I would just need to know how to derive them from source</p>



<a name="225438523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438523">(Feb 07 2021 at 01:06)</a>:</h4>
<p>If Lean in the browser gets stuck, you can sometimes figure out what's going wrong by looking in your browser's console.</p>



<a name="225438540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438540">(Feb 07 2021 at 01:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438523">said</a>:</p>
<blockquote>
<p>If Lean in the browser gets stuck, you can sometimes figure out what's going wrong by looking in your browser's console.</p>
</blockquote>
<p>The console shows nothing alas</p>



<a name="225438542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438542">(Feb 07 2021 at 01:07)</a>:</h4>
<p><a href="/user_uploads/3121/nnbg3iISYNSU4kZVcWg7exq4/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/nnbg3iISYNSU4kZVcWg7exq4/image.png" title="image.png"><img src="/user_uploads/3121/nnbg3iISYNSU4kZVcWg7exq4/image.png"></a></div>



<a name="225438591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438591">(Feb 07 2021 at 01:08)</a>:</h4>
<p>(afaik the two "unrelated" errors are due to Chrome WASM impl and are indeed <em>unrelated</em>)</p>



<a name="225438598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438598">(Feb 07 2021 at 01:08)</a>:</h4>
<p>Unfortunately I can't access your test website (I guess due to the IPv6 vs IPv4 thing). The screenshot you posted seems to indicate that Lean in the browser is working OK.</p>



<a name="225438612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438612">(Feb 07 2021 at 01:09)</a>:</h4>
<p>If you want to compile the JS/WASM versions of Lean 3 yourself, you could get inspiration from what's done in our CI: <a href="https://github.com/leanprover-community/lean/blob/master/.github/workflows/on-push.yml#L161">https://github.com/leanprover-community/lean/blob/master/.github/workflows/on-push.yml#L161</a></p>



<a name="225438719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438719">(Feb 07 2021 at 01:12)</a>:</h4>
<p>There's also some docs <a href="https://github.com/leanprover-community/lean/blob/master/doc/make/index.md#building-js--wasm-binaries-with-emscripten">here</a> for building Lean with Emscripten, but they might be out of date.</p>



<a name="225438864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438864">(Feb 07 2021 at 01:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438719">said</a>:</p>
<blockquote>
<p>There's also some docs <a href="https://github.com/leanprover-community/lean/blob/master/doc/make/index.md#building-js--wasm-binaries-with-emscripten">here</a> for building Lean with Emscripten, but they might be out of date.</p>
</blockquote>
<p>Awesome, that sounds like what I need</p>



<a name="225438927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438927">(Feb 07 2021 at 01:18)</a>:</h4>
<p>Ah, my guess is Lean on your page is getting stuck because it can't find olean files with the right version so it's trying to compile everything...</p>



<a name="225438929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438929">(Feb 07 2021 at 01:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438598">said</a>:</p>
<blockquote>
<p>Unfortunately I can't access your test website (I guess due to the IPv6 vs IPv4 thing). The screenshot you posted seems to indicate that Lean in the browser is working OK.</p>
</blockquote>
<p><a href="https://nng.lean.lahfa.xyz/">https://nng.lean.lahfa.xyz/</a> should do the trick, unfortunately, the HTTPS cert is broken</p>



<a name="225438939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225438939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225438939">(Feb 07 2021 at 01:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438927">said</a>:</p>
<blockquote>
<p>Ah, my guess is Lean on your page is getting stuck because it can't find olean files with the right version so it's trying to compile everything...</p>
</blockquote>
<p>Wouldn't this print something on the console ideally? (maybe not)</p>



<a name="225439002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439002">(Feb 07 2021 at 01:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438927">said</a>:</p>
<blockquote>
<p>Ah, my guess is Lean on your page is getting stuck because it can't find olean files with the right version so it's trying to compile everything...</p>
</blockquote>
<p>But that would make a lot of sense</p>



<a name="225439010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439010">(Feb 07 2021 at 01:21)</a>:</h4>
<p>Compiling Lean 3.4.2 is a bit annoying it looks like due to GCC version constraints apparently ; so I will try to produce 3.24.0 JS/WASM files and use them in the final bundle</p>



<a name="225439013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439013">(Feb 07 2021 at 01:21)</a>:</h4>
<p>But now, time to sleep</p>



<a name="225439015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439015">(Feb 07 2021 at 01:21)</a>:</h4>
<p>Thanks a lot <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> !</p>



<a name="225439521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439521">(Feb 07 2021 at 01:31)</a>:</h4>
<p>Hmm, it's actually not getting stuck for me in Firefox, instead it's complaining about missing Lean files (which is another symptom of the olean versions not matching). [Annoyingly, the error popup sometimes ends up above the line with an error in it, which makes it impossible to see.]</p>
<p><a href="/user_uploads/3121/FuCxKV9ysMQ-w-zFgFap-tt7/Screen-Shot-2021-02-06-at-8.30.03-PM.png">Screen-Shot-2021-02-06-at-8.30.03-PM.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/FuCxKV9ysMQ-w-zFgFap-tt7/Screen-Shot-2021-02-06-at-8.30.03-PM.png" title="Screen-Shot-2021-02-06-at-8.30.03-PM.png"><img src="/user_uploads/3121/FuCxKV9ysMQ-w-zFgFap-tt7/Screen-Shot-2021-02-06-at-8.30.03-PM.png"></a></div>



<a name="225439647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439647">(Feb 07 2021 at 01:35)</a>:</h4>
<p>ha! <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span>  :D Maybe that was my bug :')</p>



<a name="225439653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439653">(Feb 07 2021 at 01:35)</a>:</h4>
<p>Though, I'm now put at ease that the Lean runtime is doing something</p>



<a name="225439714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439714">(Feb 07 2021 at 01:37)</a>:</h4>
<p>Yeah, feel free to ping me if you get stuck again. I spent a fair bit of time debugging this kind of thing when I was playing around with the Lean web editor. I don't have experience with the NNG itself, but I imagine it's very similar.</p>



<a name="225439720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225439720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225439720">(Feb 07 2021 at 01:37)</a>:</h4>
<p>Thanks a lot, will do tomorrow</p>



<a name="225443596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225443596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225443596">(Feb 07 2021 at 03:57)</a>:</h4>
<p>A quick tip: if you want to access an IPv6 only website when your ISP doesn't support it for some reason, you can use the Tor Browser.</p>



<a name="225443710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225443710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Huỳnh Trần Khanh <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225443710">(Feb 07 2021 at 04:01)</a>:</h4>
<p>But Tor Browser doesn't support WASM because of security reasons <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="225452942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225452942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225452942">(Feb 07 2021 at 08:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="262143">Ryan Lahfa</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438225">said</a>:</p>
<blockquote>
<p>For the second part, one way to test the previous hypothesis would be to produce JS/WASM files for Lean 3.24.0 and remake the NNG for 3.24.0, it appears to me that <span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> is maintainer on the Lean package on NixOS, I would like to ask: how much effort would be needed to add as an output the <code>lean_js_js.js, lean_js_wasm.js, lean_js_wasm.wasm</code> files in the Lean package? Or how can I produce them given the Lean package? I tried to poke around in the source code but didn't find really explicit stuff, I was planning to dig into the CMake files but maybe it is faster and better to just ask?</p>
</blockquote>
<p>Not trivial, but not impossible either.  To get these files, you need to compile lean with emscripten.  (But we have emscripten in nixpkgs.)  If you want to upstream the nixos modules into nixpkgs, then I'd suggest to make a second <code>lean3-emscripten</code> derivation which compiles lean from source using emscripten.  If you just want it for personal use, then use <code>fetchurl { src = "https://github.com/leanprover-community/lean/releases/download/v3.26.0/lean-3.26.0--browser.zip"; ... }</code>.</p>



<a name="225493025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225493025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225493025">(Feb 08 2021 at 00:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225452942">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="262143">Ryan Lahfa</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225438225">said</a>:</p>
<blockquote>
<p>For the second part, one way to test the previous hypothesis would be to produce JS/WASM files for Lean 3.24.0 and remake the NNG for 3.24.0, it appears to me that <span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> is maintainer on the Lean package on NixOS, I would like to ask: how much effort would be needed to add as an output the <code>lean_js_js.js, lean_js_wasm.js, lean_js_wasm.wasm</code> files in the Lean package? Or how can I produce them given the Lean package? I tried to poke around in the source code but didn't find really explicit stuff, I was planning to dig into the CMake files but maybe it is faster and better to just ask?</p>
</blockquote>
<p>Not trivial, but not impossible either.  To get these files, you need to compile lean with emscripten.  (But we have emscripten in nixpkgs.)  If you want to upstream the nixos modules into nixpkgs, then I'd suggest to make a second <code>lean3-emscripten</code> derivation which compiles lean from source using emscripten.  If you just want it for personal use, then use <code>fetchurl { src = "https://github.com/leanprover-community/lean/releases/download/v3.26.0/lean-3.26.0--browser.zip"; ... }</code>.</p>
</blockquote>
<p>Unfortunately, it seems like this step: <a href="https://github.com/leanprover-community/lean/blob/master/src/CMakeLists.txt#L282">https://github.com/leanprover-community/lean/blob/master/src/CMakeLists.txt#L282</a> makes it impossible to reproduce WASM/JS files without further patching of the source tree</p>



<a name="225497994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225497994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225497994">(Feb 08 2021 at 02:38)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> Well chasing down the problem made me understood that it's nastier than what I thought, I am now trying locally to do make-lean-game which does lean --make and package everything in a ZIP ; but when I try locally without Nix except to provide Lean 3.24.0, it still fails with the same errors as the olean are incompatible</p>
<p>I'm unsure if I can just open the olean and check which versions they are for, also, I get this message each time from leanpkg:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">WARNING</span><span class="o">:</span> <span class="n">Lean</span> <span class="n">version</span> <span class="n">mismatch</span><span class="o">:</span> <span class="n">installed</span> <span class="n">version</span> <span class="n">is</span> <span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">lean</span><span class="o">:</span><span class="mi">3</span><span class="bp">.</span><span class="mi">24</span><span class="bp">.</span><span class="mi">0</span><span class="o">,</span> <span class="n">but</span> <span class="n">package</span> <span class="n">requires</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">24</span><span class="bp">.</span><span class="mi">0</span>
</code></pre></div>
<p>Unsure what to do with this, can it really cause issue? To me, <code>leanpkg.toml</code> is only declarative stuff, right? As long as I indeed use Lean 3.24.0 for WASM/JS and Lean 3.24.0 for olean building, it should be just fine?</p>



<a name="225498083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498083">(Feb 08 2021 at 02:40)</a>:</h4>
<p>Here's a tarball of the locally, by hand, produced web source: <a href="/user_uploads/3121/u5Z3TwZeGfPG-gE39buibx5Z/local_nng_for_3-24-0.tar.gz">local_nng_for_3-24-0.tar.gz</a></p>



<a name="225498432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498432">(Feb 08 2021 at 02:48)</a>:</h4>
<p>That warning can be safely ignored. I mention this in the <code>leanprover-community/lean-web-editor</code> README in <a href="https://github.com/leanprover-community/lean-web-editor#creating-a-customized-libraryzip">this section</a>.</p>



<a name="225498543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498543">(Feb 08 2021 at 02:51)</a>:</h4>
<p>If you open an <code>.olean</code> file in e.g. vim, it should start with something like this: <code>oleanfile^@3.26.0, commit 5a5c139af3e9</code>.</p>



<a name="225498591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498591">(Feb 08 2021 at 02:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225498543">said</a>:</p>
<blockquote>
<p>If you open an <code>.olean</code> file in e.g. vim, it should start with something like this: <code>oleanfile^@3.26.0, commit 5a5c139af3e9</code>.</p>
</blockquote>
<p>Alright, I can see it in my olean</p>



<a name="225498600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498600">(Feb 08 2021 at 02:53)</a>:</h4>
<p>I also fixed somewhat the warning by following the exact path, with no further success</p>



<a name="225498681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498681">(Feb 08 2021 at 02:54)</a>:</h4>
<p>I also tried the maze game skeleton provided in <a href="https://github.com/kbuzzard/lean-game-skeleton">https://github.com/kbuzzard/lean-game-skeleton</a> with the same errors (cannot import the user code seems like)</p>



<a name="225498705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498705">(Feb 08 2021 at 02:55)</a>:</h4>
<p>You're using commit Lean 3.24.0 <code>13007eb</code> to build the oleans and using the JS/WASM files from the GitHub release?</p>



<a name="225498772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498772">(Feb 08 2021 at 02:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225498705">said</a>:</p>
<blockquote>
<p>You're using commit Lean 3.24.0 <code>13007eb</code> to build the oleans and using the JS/WASM files from the GitHub release?</p>
</blockquote>
<p>Yes</p>



<a name="225498778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498778">(Feb 08 2021 at 02:57)</a>:</h4>
<p>I double-tripled-checked</p>



<a name="225498798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498798">(Feb 08 2021 at 02:57)</a>:</h4>
<p>I'm trying with a Lean downloaded from elan now just in case</p>



<a name="225498923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498923">(Feb 08 2021 at 03:00)</a>:</h4>
<p>tough luck :&gt;<br>
It's now working with the elan-downloaded Lean</p>



<a name="225498937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498937">(Feb 08 2021 at 03:00)</a>:</h4>
<p>So the issue lies in the Nix packaged Lean</p>



<a name="225498942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498942">(Feb 08 2021 at 03:00)</a>:</h4>
<p>I have an idea on what's going on</p>



<a name="225498959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498959">(Feb 08 2021 at 03:01)</a>:</h4>
<p>The Nix packaged Lean has no commit git hash as the src is not provided with a <code>.git</code> so <code>lean -v</code> shows no commit githash even though it's the proper 3.24.0 version</p>



<a name="225498970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225498970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225498970">(Feb 08 2021 at 03:01)</a>:</h4>
<p>Generating olean this way produces olean with no commit marker in the start of the file</p>



<a name="225499044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225499044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225499044">(Feb 08 2021 at 03:02)</a>:</h4>
<p>IMHO, commit hash should not be embedded in the oleans, as long as there is a proper versioning scheme, am I wrong?</p>



<a name="225499124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225499124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225499124">(Feb 08 2021 at 03:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Shouldn't you use <code>fetchurl</code> and the tarball URLs for the src attr for the Lean package to inject the githash stuff? I will check if that actually fixes the bug</p>



<a name="225499236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225499236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225499236">(Feb 08 2021 at 03:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="262143">Ryan Lahfa</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225498959">said</a>:</p>
<blockquote>
<p>The Nix packaged Lean has no commit git hash as the src is not provided with a <code>.git</code> so <code>lean -v</code> shows no commit githash even though it's the proper 3.24.0 version</p>
</blockquote>
<p>Yep, I was just about to point this out.</p>



<a name="225499336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225499336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225499336">(Feb 08 2021 at 03:07)</a>:</h4>
<p>I have built a quick override on the source tree to see if that's definitely the issue</p>



<a name="225499522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225499522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225499522">(Feb 08 2021 at 03:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="262143">Ryan Lahfa</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225499044">said</a>:</p>
<blockquote>
<p>IMHO, commit hash should not be embedded in the oleans, as long as there is a proper versioning scheme, am I wrong?</p>
</blockquote>
<p>There was some previous discussion (wow, in 2019) about removing the commit from the oleans or making Lean 3 less sensitive to the commit string in the oleans: <a href="#narrow/stream/113488-general/topic/Time.20to.20move.20to.203.2E5.3F/near/179100595">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Time.20to.20move.20to.203.2E5.3F/near/179100595</a></p>
<p>I think at this point with Lean 4 on the horizon there's very little downside to this. <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> what do you think?</p>



<a name="225500053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225500053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225500053">(Feb 08 2021 at 03:21)</a>:</h4>
<p>Sounds like neither leaveDotGit = true; neither deepClone in addition can produce the proper sha1, unsure if I'm doing something wrong as those features are apparently non-deterministic</p>



<a name="225500063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225500063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225500063">(Feb 08 2021 at 03:22)</a>:</h4>
<p>The easy solution could be to substitute the CMakeLists to give it the commit hash if needed at all, sounds like an easier solution</p>



<a name="225500149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225500149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225500149">(Feb 08 2021 at 03:23)</a>:</h4>
<p>patching these two lines: <a href="https://github.com/leanprover-community/lean/blob/master/src/CMakeLists.txt#L362-L363">https://github.com/leanprover-community/lean/blob/master/src/CMakeLists.txt#L362-L363</a> seems to be enough I guess, I will try in a quick'n'dirty fashion</p>



<a name="225500610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225500610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225500610">(Feb 08 2021 at 03:34)</a>:</h4>
<p>and… that's the win!</p>



<a name="225535619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225535619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225535619">(Feb 08 2021 at 12:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Hmm, it seems like that <code>leanpkg</code> always tries to update the revision of dependencies, is there a way to skip this kind of behavior? As fetching git repositories removes the dot git for determinism, would there a way to say: do not try to configure the dependencies and just build using what I give you?</p>



<a name="225535827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225535827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225535827">(Feb 08 2021 at 12:21)</a>:</h4>
<p>I would just fetch the dependencies by hand and then call <code>lean --make src</code> manually.</p>



<a name="225535856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225535856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ryan Lahfa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225535856">(Feb 08 2021 at 12:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean/near/225535827">said</a>:</p>
<blockquote>
<p>I would just fetch the dependencies by hand and then call <code>lean --make src</code> manually.</p>
</blockquote>
<p>On each dependency?</p>



<a name="225540716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225540716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225540716">(Feb 08 2021 at 13:05)</a>:</h4>
<p>Yes.  You can also do <code>lean --make src/ _target/deps/foo/src</code> to make everything at once.</p>



<a name="225581623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Debugging%20Lean%20games%20%26%20building%20JS/WASM%20versions%20for%20Lean/near/225581623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Debugging.20Lean.20games.20.26.20building.20JS.2FWASM.20versions.20for.20Lean.html#225581623">(Feb 08 2021 at 17:48)</a>:</h4>
<p>Note that <code>lean --make src/ _target/deps/foo/src</code> will build <strong>everything</strong> in <code>foo</code>, which usually isn't necessary (e.g. there's a lot of mathlib that the NNG doesn't depend on). So <code>lean --make src</code> should be sufficient in most cases.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>