---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/fast.20fractional.20number.20computation.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html">fast fractional number computation</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204983075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kendall Frey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983075">(Jul 25 2020 at 02:09)</a>:</h4>
<p>What's the fastest way to perform calculations involving fractional numbers? Specifically, I defined a complex number as a pair of rational numbers, and performed a Mandelbrot set test for 100000 iterations, which took several seconds. This is pretty slow, so what would be a better solution?</p>



<a name="204983130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983130">(Jul 25 2020 at 02:10)</a>:</h4>
<p><span aria-label="four leaf clover" class="emoji emoji-1f340" role="img" title="four leaf clover">:four_leaf_clover:</span>? (i.e. wait until Lean4 which will be much faster?)</p>



<a name="204983136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983136">(Jul 25 2020 at 02:10)</a>:</h4>
<p>How are you doing the calculation?</p>



<a name="204983233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kendall Frey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983233">(Jul 25 2020 at 02:13)</a>:</h4>
<p>It's pretty simple, no thought to optimization.</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">comp_rat</span> <span class="o">:=</span> <span class="n">ℚ</span> <span class="bp">×</span> <span class="n">ℚ</span>

<span class="kn">notation</span> <span class="bp">`</span><span class="n">ℂ</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">comp_rat</span>

<span class="n">def</span> <span class="n">cadd</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="bp">→</span> <span class="n">ℂ</span> <span class="bp">→</span> <span class="n">ℂ</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">r₁</span><span class="o">,</span> <span class="n">i₁</span><span class="o">)</span> <span class="o">(</span><span class="n">r₂</span><span class="o">,</span> <span class="n">i₂</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">r₁</span> <span class="bp">+</span> <span class="n">r₂</span><span class="o">,</span> <span class="n">i₁</span> <span class="bp">+</span> <span class="n">i₂</span><span class="o">)</span>

<span class="n">def</span> <span class="n">cmul</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="bp">→</span> <span class="n">ℂ</span> <span class="bp">→</span> <span class="n">ℂ</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">r₁</span><span class="o">,</span> <span class="n">i₁</span><span class="o">)</span> <span class="o">(</span><span class="n">r₂</span><span class="o">,</span> <span class="n">i₂</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">r₁</span> <span class="bp">*</span> <span class="n">r₂</span> <span class="bp">-</span> <span class="n">i₁</span> <span class="bp">*</span> <span class="n">i₂</span><span class="o">,</span> <span class="n">r₁</span> <span class="bp">*</span> <span class="n">i₂</span> <span class="bp">+</span> <span class="n">r₂</span> <span class="bp">*</span> <span class="n">i₁</span><span class="o">)</span>
</code></pre></div>



<a name="204983307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kendall Frey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983307">(Jul 25 2020 at 02:14)</a>:</h4>
<p>I see mathlib has a floating point implementation, so I may try that one as well for comparison</p>



<a name="204983336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983336">(Jul 25 2020 at 02:15)</a>:</h4>
<p>I assume you're using <code>#eval</code> (or equivalent <code>lean --run</code>)</p>



<a name="204983344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204983344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kendall Frey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204983344">(Jul 25 2020 at 02:15)</a>:</h4>
<p><code>lean --run</code>, yeah</p>



<a name="204984660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204984660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kendall Frey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204984660">(Jul 25 2020 at 02:53)</a>:</h4>
<p>I tried native.float, but it generates errors like:</p>
<div class="codehilite"><pre><span></span><code><span class="n">kernel</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">type</span> <span class="kn">check</span> <span class="n">declaration</span> <span class="err">&#39;</span><span class="n">x&#39;</span> <span class="n">this</span> <span class="n">is</span> <span class="n">usually</span> <span class="n">due</span> <span class="n">to</span> <span class="n">a</span> <span class="n">buggy</span> <span class="n">tactic</span> <span class="n">or</span> <span class="n">a</span> <span class="n">bug</span> <span class="k">in</span> <span class="n">the</span> <span class="n">builtin</span> <span class="n">elaborator</span>
<span class="n">elaborated</span> <span class="n">type</span><span class="o">:</span>
  <span class="n">native</span><span class="bp">.</span><span class="n">float</span>
<span class="n">elaborated</span> <span class="n">value</span><span class="o">:</span>
  <span class="mi">3927</span> <span class="bp">/</span> <span class="mi">1250</span>
<span class="n">nested</span> <span class="n">exception</span> <span class="n">message</span><span class="o">:</span>
<span class="n">invalid</span> <span class="kn">definition</span><span class="o">,</span> <span class="n">it</span> <span class="n">uses</span> <span class="n">untrusted</span> <span class="n">declaration</span> <span class="err">&#39;</span><span class="n">native</span><span class="bp">.</span><span class="n">float&#39;</span>
</code></pre></div>


<p>Can this error be suppressed or ignored in some way?</p>



<a name="204984715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204984715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204984715">(Jul 25 2020 at 02:54)</a>:</h4>
<p>You might have to put <code>meta</code> in front of your definitions?</p>



<a name="204991010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204991010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204991010">(Jul 25 2020 at 06:29)</a>:</h4>
<p>The problem with rational number arithmetic is that the denominators (and usually numerators as well) grow exponentially in the number of operations</p>



<a name="204991023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204991023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204991023">(Jul 25 2020 at 06:29)</a>:</h4>
<p>You probably want to do some heuristic rounding and interval arithmetic once the denominator gets large enough</p>



<a name="204991134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/fast%20fractional%20number%20computation/near/204991134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/fast.20fractional.20number.20computation.html#204991134">(Jul 25 2020 at 06:32)</a>:</h4>
<p>What is your actual mandelbrot set test? I only see the core add/mul operations in your snippet. In order to know what kind of rounding is appropriate I would like to know how exactly you are doing the mandelbrot set test</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>