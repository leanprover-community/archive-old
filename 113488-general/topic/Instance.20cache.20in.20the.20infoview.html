---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html">Instance cache in the infoview</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="291481647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291481647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291481647">(Jul 31 2022 at 09:57)</a>:</h4>
<p>Has the infoview access to the instance cache? If so, could we make this information available by coloring the name of an instance variable differently from a non-instance one? This would bring us closer to our mental model that "The infoview is all you need to see".</p>



<a name="291481697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291481697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291481697">(Jul 31 2022 at 09:58)</a>:</h4>
<p>Here's a (somewhat artificial) example where one can't tell whether a variable is in the instance cache or not:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.hom.equiv</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">H</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">≃*</span> <span class="n">H</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">my_instance</span> <span class="o">:</span> <span class="n">group</span> <span class="n">H</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="n">mul_left_inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="bp">..</span><span class="o">‹</span><span class="n">monoid</span> <span class="n">H</span><span class="o">›</span> <span class="o">},</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">G: Type u_1</span>
<span class="cm">H: Type u_2</span>
<span class="cm">_inst_1: group G</span>
<span class="cm">_inst_2: monoid H</span>
<span class="cm">f: G ≃* H</span>
<span class="cm">my_instance: group H</span>
<span class="cm">⊢ true-/</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">≃*</span> <span class="n">H</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">haveI</span> <span class="n">my_instance</span> <span class="o">:</span> <span class="n">group</span> <span class="n">H</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="n">mul_left_inv</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span> <span class="bp">..</span><span class="o">‹</span><span class="n">monoid</span> <span class="n">H</span><span class="o">›</span> <span class="o">},</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">G: Type u_1</span>
<span class="cm">H: Type u_2</span>
<span class="cm">_inst_1: group G</span>
<span class="cm">_inst_2: monoid H</span>
<span class="cm">f: G ≃* H</span>
<span class="cm">my_instance: group H</span>
<span class="cm">⊢ true-/</span>
<span class="kd">end</span>
</code></pre></div>



<a name="291483538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291483538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291483538">(Jul 31 2022 at 10:41)</a>:</h4>
<p>I do not know the answer to your question, but for your examples, <code>G, f</code> are unnecessary, right?  Could you just have a type and prove with sorry that it is inhabited or is there something else that I am overlooking?</p>



<a name="291484873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291484873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291484873">(Jul 31 2022 at 11:11)</a>:</h4>
<p>The example was "Transfer the group structure on <code>G</code> to a group structure on <code>H</code> using <code>f</code>" <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="291485026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291485026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291485026">(Jul 31 2022 at 11:14)</a>:</h4>
<p>I think the answer is "the infoview is implemented via widgets in leanprover-community/lean, so in theory it has access to everything"</p>



<a name="291485477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291485477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291485477">(Jul 31 2022 at 11:25)</a>:</h4>
<p>Yaël, I guessed as much, I was simply making a Meaningless Working Example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">my_non_instance</span> <span class="o">:</span> <span class="n">inhabited</span> <span class="n">α</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">haveI</span> <span class="n">my_instance</span> <span class="o">:</span> <span class="n">inhabited</span> <span class="n">α</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">α: Sort ?</span>
<span class="cm">my_non_instance my_instance: inhabited α</span>
<span class="cm">⊢ true -/</span>
  <span class="n">trivial</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="291487492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291487492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291487492">(Jul 31 2022 at 12:16)</a>:</h4>
<p>There is a tactic <code>frozen_local_instances</code>: using <code>trace frozen_local_instances,</code> reveals that it interprets <code>my_non_instance</code> as a non-instance in isolation, but as an instance when <code>my_instance</code> is around.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
<span class="c1">--  have my_non_instance : inhabited α := sorry,   -- comment/uncomment this and the next line in all configurations and look at the trace!</span>
  <span class="n">haveI</span> <span class="n">my_instance</span> <span class="o">:</span> <span class="n">inhabited</span> <span class="n">α</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">trace</span> <span class="n">frozen_local_instances</span><span class="o">,</span>
  <span class="n">trivial</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="291490316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291490316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291490316">(Jul 31 2022 at 13:21)</a>:</h4>
<p>I think that might be a quirk in haveI; nice find!</p>



<a name="291490539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291490539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291490539">(Jul 31 2022 at 13:25)</a>:</h4>
<p>Does that mean <code>haveI</code> resets the instance cache?</p>



<a name="291491385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291491385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291491385">(Jul 31 2022 at 13:42)</a>:</h4>
<p>If I were to implement my above suggestion, is there a way for me to try out the modified infoview easily?</p>



<a name="291491429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291491429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291491429">(Jul 31 2022 at 13:44)</a>:</h4>
<p>Actually, the widgets are defined in core Lean, right? so I can literally write a test file that imports them and I will see the modified there?</p>



<a name="291491576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291491576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291491576">(Jul 31 2022 at 13:46)</a>:</h4>
<p>You can override from user code, even outside mathlib.</p>



<a name="291491669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291491669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291491669">(Jul 31 2022 at 13:48)</a>:</h4>
<p>See <a href="https://github.com/PatrickMassot/MDD154/blob/master/src/lib/interactive_expr.lean">https://github.com/PatrickMassot/MDD154/blob/master/src/lib/interactive_expr.lean</a> which is imported at <a href="https://github.com/PatrickMassot/MDD154/blob/master/src/lib/tactiques.lean">https://github.com/PatrickMassot/MDD154/blob/master/src/lib/tactiques.lean</a></p>



<a name="291491692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291491692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291491692">(Jul 31 2022 at 13:49)</a>:</h4>
<p>The last three lines of the first file do the magic of overriding the version of that file that is in mathlib.</p>



<a name="291491768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/291491768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#291491768">(Jul 31 2022 at 13:51)</a>:</h4>
<p>You can compare with the mathlib version. The main changes should be the parenthesis option (this was before Kyle put an option in core Lean) and pretty printing bounded quantifiers (using code from <a href="https://github.com/leanprover-community/mathlib/pull/5440">#5440</a>)</p>



<a name="292397809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292397809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292397809">(Aug 08 2022 at 12:59)</a>:</h4>
<p>A first try, with... salmon instances! Anne also offered <em>pinkstances</em>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">tagged_format</span> <span class="n">tactic</span>
<span class="kn">open</span> <span class="n">widget</span> <span class="n">widget.html</span> <span class="n">widget.attr</span> <span class="n">widget.interactive_expression</span>

<span class="kn">namespace</span> <span class="n">inst_widget</span>

<span class="sd">/-- Component that displays the main (first) goal. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">tactic_view_goal</span> <span class="o">{</span><span class="n">γ</span><span class="o">}</span> <span class="o">(</span><span class="n">local_c</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">local_collection</span> <span class="n">γ</span><span class="o">)</span> <span class="o">(</span><span class="n">target_c</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">expr</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">filter_type</span> <span class="n">γ</span> <span class="o">:=</span>
<span class="n">tc.stateless</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">ft</span><span class="o">,</span> <span class="k">do</span>
  <span class="n">is</span> <span class="bp">←</span> <span class="n">tactic.frozen_local_instances</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">is'</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span> <span class="o">:=</span> <span class="n">option.cases_on</span> <span class="n">is</span> <span class="o">[]</span> <span class="n">id</span><span class="o">,</span>
  <span class="n">g</span><span class="bp">@</span><span class="o">(</span><span class="n">expr.mvar</span> <span class="n">u_n</span> <span class="n">pp_n</span> <span class="n">y</span><span class="o">)</span> <span class="bp">←</span> <span class="n">main_goal</span><span class="o">,</span>
  <span class="n">t</span> <span class="bp">←</span> <span class="n">get_tag</span> <span class="n">g</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">case_tag</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">html</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:=</span>
    <span class="k">match</span> <span class="n">interactive.case_tag.parse</span> <span class="n">t</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">some</span> <span class="n">t</span> <span class="o">:=</span>
      <span class="o">[</span><span class="n">h</span> <span class="s2">"li"</span> <span class="o">[</span><span class="n">key</span> <span class="s2">"_case"</span><span class="o">]</span> <span class="bp">$</span> <span class="o">[</span><span class="n">h</span> <span class="s2">"span"</span> <span class="o">[</span><span class="n">cn</span> <span class="s2">"goal-case b"</span><span class="o">]</span> <span class="o">[</span><span class="s2">"case"</span><span class="o">]]</span> <span class="bp">++</span>
        <span class="o">(</span><span class="n">t.case_names.bind</span> <span class="bp">$</span> <span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">[</span><span class="s2">" "</span><span class="o">,</span> <span class="n">n</span><span class="o">])]</span>
    <span class="bp">|</span> <span class="n">none</span> <span class="o">:=</span> <span class="o">[]</span>
    <span class="kd">end</span><span class="o">,</span>
  <span class="n">lcs</span> <span class="bp">←</span> <span class="n">local_context</span><span class="o">,</span>
  <span class="n">lcs</span> <span class="bp">←</span> <span class="n">list.mfilter</span> <span class="o">(</span><span class="n">filter_local</span> <span class="n">ft</span><span class="o">)</span> <span class="n">lcs</span><span class="o">,</span>
  <span class="n">lcs</span> <span class="bp">←</span> <span class="n">to_local_collection</span> <span class="o">[]</span> <span class="n">lcs</span><span class="o">,</span>
  <span class="c1">-- Display the local variables; grouping together locals of the same type.</span>
  <span class="n">lchs</span> <span class="bp">←</span> <span class="n">lcs.mmap</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">lc</span><span class="o">,</span> <span class="k">do</span>
    <span class="n">lh</span> <span class="bp">←</span> <span class="n">local_c</span> <span class="n">lc</span><span class="o">,</span>
    <span class="n">ns</span> <span class="bp">←</span> <span class="n">lc.locals.mmap</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="k">do</span>
      <span class="k">let</span> <span class="n">var_color</span> <span class="o">:</span> <span class="n">attr</span> <span class="n">γ</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">n</span> <span class="bp">∈</span> <span class="n">is'</span>
      <span class="k">then</span> <span class="n">attr.style</span> <span class="o">[(</span><span class="s2">"color"</span><span class="o">,</span> <span class="s2">"#ff0073"</span><span class="o">)]</span>  <span class="c1">-- "goal-hyp-inst"</span>
      <span class="k">else</span> <span class="n">attr.style</span> <span class="o">[(</span><span class="s2">"color"</span><span class="o">,</span> <span class="s2">"#ffcc00"</span><span class="o">)],</span> <span class="c1">-- "goal-hyp"</span>
        <span class="n">pure</span> <span class="bp">$</span> <span class="n">h</span> <span class="s2">"span"</span> <span class="o">[</span><span class="n">cn</span> <span class="s2">"goal-hyp b pr2"</span><span class="o">,</span> <span class="n">var_color</span><span class="o">]</span> <span class="o">[</span><span class="n">html.of_name</span> <span class="bp">$</span> <span class="n">expr.local_pp_name</span> <span class="n">n</span><span class="o">]),</span>
    <span class="n">pure</span> <span class="bp">$</span> <span class="n">h</span> <span class="s2">"li"</span> <span class="o">[</span><span class="n">key</span> <span class="n">lc.key</span><span class="o">]</span> <span class="o">(</span><span class="n">ns</span> <span class="bp">++</span> <span class="o">[</span><span class="s2">": "</span><span class="o">,</span> <span class="n">h</span> <span class="s2">"span"</span> <span class="o">[</span><span class="n">cn</span> <span class="s2">"goal-hyp-type"</span><span class="o">]</span> <span class="o">[</span><span class="n">lh</span><span class="o">]])),</span>
  <span class="n">t_comp</span> <span class="bp">←</span> <span class="n">target_c</span> <span class="n">g</span><span class="o">,</span>
  <span class="n">pure</span> <span class="bp">$</span> <span class="n">h</span> <span class="s2">"ul"</span> <span class="o">[</span><span class="n">key</span> <span class="n">g.hash</span><span class="o">,</span> <span class="n">className</span> <span class="s2">"list pl0 font-code"</span><span class="o">]</span> <span class="bp">$</span> <span class="n">case_tag</span> <span class="bp">++</span> <span class="n">lchs</span> <span class="bp">++</span> <span class="o">[</span>
    <span class="n">h</span> <span class="s2">"li"</span> <span class="o">[</span><span class="n">key</span> <span class="n">u_n</span><span class="o">]</span> <span class="o">[</span>
      <span class="n">h</span> <span class="s2">"span"</span> <span class="o">[</span><span class="n">cn</span> <span class="s2">"goal-vdash b"</span><span class="o">]</span> <span class="o">[</span><span class="s2">"⊢ "</span><span class="o">],</span>
      <span class="n">t_comp</span>
  <span class="o">]]</span>

<span class="sd">/-- Component that displays all goals, together with the `$n goals` message. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">tactic_view_component</span> <span class="o">{</span><span class="n">γ</span><span class="o">}</span> <span class="o">(</span><span class="n">local_c</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">local_collection</span> <span class="n">γ</span><span class="o">)</span> <span class="o">(</span><span class="n">target_c</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">expr</span> <span class="n">γ</span><span class="o">)</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">unit</span> <span class="n">γ</span> <span class="o">:=</span>
<span class="n">tc.mk_simple</span>
  <span class="o">(</span><span class="n">tactic_view_action</span> <span class="n">γ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">filter_type</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">pure</span> <span class="bp">$</span> <span class="n">filter_type.none</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨⟩</span> <span class="n">ft</span> <span class="n">a</span><span class="o">,</span> <span class="k">match</span> <span class="n">a</span> <span class="k">with</span>
              <span class="bp">|</span> <span class="o">(</span><span class="n">tactic_view_action.out</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">pure</span> <span class="o">(</span><span class="n">ft</span><span class="o">,</span> <span class="n">some</span> <span class="n">a</span><span class="o">)</span>
              <span class="bp">|</span> <span class="o">(</span><span class="n">tactic_view_action.filter</span> <span class="n">ft</span><span class="o">)</span> <span class="o">:=</span> <span class="n">pure</span> <span class="o">(</span><span class="n">ft</span><span class="o">,</span> <span class="n">none</span><span class="o">)</span>
              <span class="kd">end</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨⟩</span> <span class="n">ft</span><span class="o">,</span> <span class="k">do</span>
    <span class="n">gs</span> <span class="bp">←</span> <span class="n">get_goals</span><span class="o">,</span>
    <span class="n">hs</span> <span class="bp">←</span> <span class="n">gs.mmap</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">g</span><span class="o">,</span> <span class="k">do</span> <span class="n">set_goals</span> <span class="o">[</span><span class="n">g</span><span class="o">],</span> <span class="n">flip</span> <span class="n">tc.to_html</span> <span class="n">ft</span> <span class="bp">$</span> <span class="n">tactic_view_goal</span> <span class="n">local_c</span> <span class="n">target_c</span><span class="o">),</span>
    <span class="n">set_goals</span> <span class="n">gs</span><span class="o">,</span>
    <span class="k">let</span> <span class="n">goal_message</span> <span class="o">:=</span>
      <span class="k">if</span> <span class="n">gs.length</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="s2">"goals accomplished"</span>
      <span class="k">else</span> <span class="k">if</span> <span class="n">gs.length</span> <span class="bp">=</span> <span class="mi">1</span> <span class="k">then</span>
        <span class="s2">"1 goal"</span>
      <span class="k">else</span>
        <span class="n">to_string</span> <span class="n">gs.length</span> <span class="bp">++</span> <span class="s2">" goals"</span><span class="o">,</span>
    <span class="k">let</span> <span class="n">goal_message</span> <span class="o">:</span> <span class="n">html</span> <span class="n">γ</span> <span class="o">:=</span> <span class="n">h</span> <span class="s2">"strong"</span> <span class="o">[</span><span class="n">cn</span> <span class="s2">"goal-goals"</span><span class="o">]</span> <span class="o">[</span><span class="n">goal_message</span><span class="o">],</span>
    <span class="k">let</span> <span class="n">goals</span> <span class="o">:</span> <span class="n">html</span> <span class="n">γ</span> <span class="o">:=</span> <span class="n">h</span> <span class="s2">"ul"</span> <span class="o">[</span><span class="n">className</span> <span class="s2">"list pl0"</span><span class="o">]</span>
        <span class="bp">$</span> <span class="n">list.map_with_index</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="n">x</span><span class="o">,</span>
          <span class="n">h</span> <span class="s2">"li"</span> <span class="o">[</span><span class="n">className</span> <span class="bp">$</span> <span class="s2">"lh-copy mt2"</span><span class="o">,</span> <span class="n">key</span> <span class="n">i</span><span class="o">]</span> <span class="o">[</span><span class="n">x</span><span class="o">])</span>
        <span class="bp">$</span> <span class="o">(</span><span class="n">goal_message</span> <span class="o">::</span> <span class="n">hs</span><span class="o">),</span>
    <span class="n">pure</span> <span class="o">[</span>
      <span class="n">h</span> <span class="s2">"div"</span> <span class="o">[</span><span class="n">className</span> <span class="s2">"fr"</span><span class="o">]</span> <span class="o">[</span><span class="n">html.of_component</span> <span class="n">ft</span> <span class="bp">$</span> <span class="n">component.map_action</span> <span class="n">tactic_view_action.filter</span> <span class="n">filter_component</span><span class="o">],</span>
      <span class="n">html.map_action</span> <span class="n">tactic_view_action.out</span> <span class="n">goals</span>
    <span class="o">])</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">tactic_render</span> <span class="o">:</span> <span class="n">tc</span> <span class="n">unit</span> <span class="n">empty</span> <span class="o">:=</span>
<span class="n">component.ignore_action</span> <span class="bp">$</span> <span class="n">tactic_view_component</span> <span class="n">show_local_collection_component</span> <span class="n">show_type_component</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">tactic_state_widget</span> <span class="o">:</span> <span class="n">component</span> <span class="n">tactic_state</span> <span class="n">empty</span> <span class="o">:=</span>
<span class="n">tc.to_component</span> <span class="n">tactic_render</span>

<span class="kd">end</span> <span class="n">inst_widget</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">vm_override</span> <span class="n">inst_widget.tactic_state_widget</span><span class="o">]</span> <span class="n">widget.tactic_state_widget</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">haveI</span> <span class="n">an_instance</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">not_instance</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">another_not_instance</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">yet_another</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">trivial</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p><a href="/user_uploads/3121/cM_2w5s2vC9g5pwmPq0pvBNd/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/cM_2w5s2vC9g5pwmPq0pvBNd/image.png" title="image.png"><img src="/user_uploads/3121/cM_2w5s2vC9g5pwmPq0pvBNd/image.png"></a></div>



<a name="292398335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398335">(Aug 08 2022 at 13:03)</a>:</h4>
<p>Italics, maybe? <a href="/user_uploads/3121/z7DU1LSJxARf7_8QhUSzmSz2/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/z7DU1LSJxARf7_8QhUSzmSz2/image.png" title="image.png"><img src="/user_uploads/3121/z7DU1LSJxARf7_8QhUSzmSz2/image.png"></a></div>



<a name="292398422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398422">(Aug 08 2022 at 13:04)</a>:</h4>
<p>I'd maybe go for a more muted color</p>



<a name="292398443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398443">(Aug 08 2022 at 13:04)</a>:</h4>
<p>Since you shouldn't have to know the name of things in the instance cache anyway</p>



<a name="292398448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398448">(Aug 08 2022 at 13:04)</a>:</h4>
<p>Note, the colors are surprisingly strong on the first one for a reason that escapes me.</p>



<a name="292398483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398483">(Aug 08 2022 at 13:04)</a>:</h4>
<p>My guess would be that they're the dark mode colors being used in white mode</p>



<a name="292398514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398514">(Aug 08 2022 at 13:05)</a>:</h4>
<p>Ah! Yes exactly.</p>



<a name="292398670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398670">(Aug 08 2022 at 13:06)</a>:</h4>
<p>Muted colors. <a href="/user_uploads/3121/pV-4e2Bg0sRYWVSUP7QAL1hv/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/pV-4e2Bg0sRYWVSUP7QAL1hv/image.png" title="image.png"><img src="/user_uploads/3121/pV-4e2Bg0sRYWVSUP7QAL1hv/image.png"></a></div>



<a name="292398684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398684">(Aug 08 2022 at 13:06)</a>:</h4>
<p>Possibly coloring things that aren't in the instance cache but are <code>@[class]</code> would be a good idea too / instead</p>



<a name="292398741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398741">(Aug 08 2022 at 13:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview/near/292398422">said</a>:</p>
<blockquote>
<p>I'd maybe go for a more muted color</p>
</blockquote>
<p>I meant make the ones in the cache be more muted than the ones not in the cache</p>



<a name="292398919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398919">(Aug 08 2022 at 13:08)</a>:</h4>
<p>Rob suggested this as well. It's a choice to make.</p>



<a name="292398925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398925">(Aug 08 2022 at 13:08)</a>:</h4>
<p>Like this? <a href="http://">Uploading image.png…</a></p>



<a name="292398975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292398975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292398975">(Aug 08 2022 at 13:09)</a>:</h4>
<p>(Zulip's behavior of allowing you to send the loading text is wonderful, isn't it...)</p>



<a name="292399181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292399181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292399181">(Aug 08 2022 at 13:10)</a>:</h4>
<p>Another good option might just be a red dotted / squiggly line underneath the non-instance cache ones, with a <code>title="not in the instance cache"</code> attribute</p>



<a name="292399258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292399258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292399258">(Aug 08 2022 at 13:11)</a>:</h4>
<p>Underlines sound like a good idea</p>



<a name="292399282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292399282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292399282">(Aug 08 2022 at 13:11)</a>:</h4>
<p>Or maybe not red since it's not an error, but some kind of underline, probably not in yellow</p>



<a name="292403401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292403401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292403401">(Aug 08 2022 at 13:44)</a>:</h4>
<p>I'd definitely suggest highlighting what's not in the cache instead of what is</p>



<a name="292476771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292476771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292476771">(Aug 08 2022 at 18:12)</a>:</h4>
<p>/poll What should we separate visually?<br>
Instances vs non instances<br>
Typeclass assumptions that are not instances vs the rest<br>
Instances vs typeclass assumptions that are not instances vs the rest<br>
Typeclass assumptions from the rest</p>



<a name="292476838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292476838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292476838">(Aug 08 2022 at 18:13)</a>:</h4>
<p>/poll How should we separate it?<br>
Different color<br>
Italic<br>
Bold<br>
Underline</p>



<a name="292477499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292477499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292477499">(Aug 08 2022 at 18:19)</a>:</h4>
<p>By "instances" you mean "in the instance cache" or "of a type tagged with <code>@[class]</code>"?</p>



<a name="292479077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292479077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292479077">(Aug 08 2022 at 18:32)</a>:</h4>
<p>In the instance cache. as opposed to "typeclass assumptions".</p>



<a name="292479521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292479521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292479521">(Aug 08 2022 at 18:36)</a>:</h4>
<p>Are you considering either of <code>[n : nat]</code> and <code>{s : setoid X}</code> a typeclass assumption?</p>



<a name="292479542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292479542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292479542">(Aug 08 2022 at 18:36)</a>:</h4>
<p>(I would hope the answer is just the latter)</p>



<a name="292479630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292479630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292479630">(Aug 08 2022 at 18:37)</a>:</h4>
<p>Just the latter.</p>



<a name="292484174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484174">(Aug 08 2022 at 19:17)</a>:</h4>
<p>Regarding the first poll, it might be possible to make variable names clickable or hoverable in order to show a bubble of the form "This is a class but not an instance" or something along those lines...</p>



<a name="292484297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484297">(Aug 08 2022 at 19:18)</a>:</h4>
<p>is "frozen local instance" being distinguished here? (i.e. something that would make revert fail)</p>



<a name="292484368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484368">(Aug 08 2022 at 19:19)</a>:</h4>
<p>If you explain me what it is, I would be happy to try! My code above only knows about the instance cache.</p>



<a name="292484535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484535">(Aug 08 2022 at 19:20)</a>:</h4>
<p>the frozen local instances generally coincide with the ones in the cache</p>



<a name="292484666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484666">(Aug 08 2022 at 19:21)</a>:</h4>
<p>Okay, that was my mental model. What are the exceptions?</p>



<a name="292484732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484732">(Aug 08 2022 at 19:22)</a>:</h4>
<p>when you say <code>unfreeze_local_instances</code></p>



<a name="292484828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292484828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292484828">(Aug 08 2022 at 19:22)</a>:</h4>
<p>the tactic <code>frozen_local_instances</code> returns the list of frozen local instances</p>



<a name="292485101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292485101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292485101">(Aug 08 2022 at 19:25)</a>:</h4>
<p>This is not supposed to be used by the end user, right?</p>



<a name="292485894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292485894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292485894">(Aug 08 2022 at 19:32)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span>, can you make a draft PR of this against lean to make it clear which bits of your code are copy-pasted to make <code>vm_override</code> work, and which bits are changed? My impression is that we want this in lean core eventually, and that <code>vm_override</code> is just a neat tool for protyping</p>



<a name="292486045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292486045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292486045">(Aug 08 2022 at 19:33)</a>:</h4>
<p>Yes absolutely! The twist is that to avoid harcoding the style I will need to first get a PR merged to <code>vscode-lean</code> to add the missing style attributes to the CSS file, unless you see another way out.</p>



<a name="292486267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292486267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292486267">(Aug 08 2022 at 19:35)</a>:</h4>
<p>I think for the purpose of a draft PR that can be dealt with later (either by assuming the PR exists, or by inlining the styles for now)</p>



<a name="292486647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292486647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292486647">(Aug 08 2022 at 19:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview/near/292485101">said</a>:</p>
<blockquote>
<p>This is not supposed to be used by the end user, right?</p>
</blockquote>
<p>No, but it is user-visible and I assumed that's why you want to color these things in the first place</p>



<a name="292486765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292486765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292486765">(Aug 08 2022 at 19:40)</a>:</h4>
<p>I assume you are trying to make it possible for the user to predict in advance that a typeclass in the context won't be used or something like that</p>



<a name="292486960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292486960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292486960">(Aug 08 2022 at 19:42)</a>:</h4>
<p>There are basically two user-facing issues that would be relevant here: (1) a typeclass in the context is not going to be used because it was added after the cache was frozen, (2) a typeclass in the context cannot be reverted or rewritten because it is frozen</p>



<a name="292488051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292488051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292488051">(Aug 08 2022 at 19:52)</a>:</h4>
<p>Here's a suggested scheme:</p>
<ul>
<li>If the instance cache is not frozen, all instances are reddish</li>
<li>If the instance cache is frozen, frozen instances are bluish and unfrozen instances are italic</li>
</ul>



<a name="292488152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292488152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292488152">(Aug 08 2022 at 19:53)</a>:</h4>
<p>so bluish means you can't revert it and italic means you forgot a <code>haveI</code></p>



<a name="292488190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292488190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292488190">(Aug 08 2022 at 19:53)</a>:</h4>
<p>reddish means you are in the middle of a <code>unfreezingI</code>, this should be rare</p>



<a name="292496026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292496026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292496026">(Aug 08 2022 at 21:01)</a>:</h4>
<p>I would only color "unavailable" type classes instances in red (= local instances are frozen &amp; the instance is not part of the frozen ones), because that's when you need to take action.</p>



<a name="292496173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292496173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292496173">(Aug 08 2022 at 21:02)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> You need to do the changes in mathlib: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/interactive_expr.lean">https://github.com/leanprover-community/mathlib/blob/master/src/tactic/interactive_expr.lean</a>  Feel free to sync that file to core though if you want.</p>



<a name="292498625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292498625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292498625">(Aug 08 2022 at 21:24)</a>:</h4>
<p>I think showing somehow that the cache is frozen/unfrozen is good too, otherwise there's no observable effect of unfreezing the instance cache</p>



<a name="292537627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292537627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292537627">(Aug 09 2022 at 07:59)</a>:</h4>
<p>Mario's dream:<br>
<a href="/user_uploads/3121/f99u7amw1XuQzdpkUQiH9sXp/image.png">Before unfreezing</a><br>
<a href="/user_uploads/3121/4iXkMhdMiJ5pBR4d3psoQTxU/image.png">Within an <code>unfreezingI</code></a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/f99u7amw1XuQzdpkUQiH9sXp/image.png" title="Before unfreezing"><img src="/user_uploads/3121/f99u7amw1XuQzdpkUQiH9sXp/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/3121/4iXkMhdMiJ5pBR4d3psoQTxU/image.png" title="Within an "><img src="/user_uploads/3121/4iXkMhdMiJ5pBR4d3psoQTxU/image.png"></a></div>



<a name="292556657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292556657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292556657">(Aug 09 2022 at 10:53)</a>:</h4>
<p>One other thought: it's quite common to paste goals into Zulip /discord where the colors are lost</p>



<a name="292556724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292556724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292556724">(Aug 09 2022 at 10:54)</a>:</h4>
<p>Should we use a symbol instead / as well?</p>



<a name="292559973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292559973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292559973">(Aug 09 2022 at 11:21)</a>:</h4>
<p>Also symbols might be useful for people who are colourblind...</p>



<a name="292560411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292560411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292560411">(Aug 09 2022 at 11:24)</a>:</h4>
<p>Agreed! I paid attention to the colors scheme, because I am myself colorblind. But I am only one flavor of colorblind so it would be good to get other people's opinions.</p>



<a name="292577801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/292577801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#292577801">(Aug 09 2022 at 13:26)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/15959">#15959</a></p>



<a name="295109927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Instance%20cache%20in%20the%20infoview/near/295109927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Instance.20cache.20in.20the.20infoview.html#295109927">(Aug 24 2022 at 19:14)</a>:</h4>
<p>This is still not merged, if people want to suggest ways to show the instance cache in the infoview on <a href="https://github.com/leanprover-community/mathlib/pull/15959">#15959</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>