---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html">lean codeblocks in docstrings</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="187275556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187275556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187275556">(Feb 03 2020 at 16:04)</a>:</h4>
<p>I tried to put a codeblock as in</p>
<div class="codehilite"><pre><span></span>```lean
foo
```
</pre></div>


<p>in a docstring. But I got a complaint, so I removed it: <a href="https://github.com/leanprover-community/mathlib/pull/1946/commits/48a5d7c99a83709e5736398db58ef39fb4bc0821#diff-e43627ca2566b806fcd077fad0fe29c9L26" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/1946/commits/48a5d7c99a83709e5736398db58ef39fb4bc0821#diff-e43627ca2566b806fcd077fad0fe29c9L26">https://github.com/leanprover-community/mathlib/pull/1946/commits/48a5d7c99a83709e5736398db58ef39fb4bc0821#diff-e43627ca2566b806fcd077fad0fe29c9L26</a></p>
<p>If you don't add the <code>lean</code> tag, then everything is fine. So</p>
<div class="codehilite"><pre><span></span>```
foo
```
</pre></div>


<p>works fine. I can imagine that the language modifier might be useful. But it isn't crucial. Just posting to see what others think.</p>



<a name="187275622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187275622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187275622">(Feb 03 2020 at 16:05)</a>:</h4>
<p>FYI: the error that Lean gave was <code>invalid docstring: expected end of code block</code>, or something like that.</p>



<a name="187276505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187276505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187276505">(Feb 03 2020 at 16:14)</a>:</h4>
<p>Looks like the error message comes from the code around <a href="https://github.com/leanprover-community/lean/blob/e1fe877236cd0c7aa4a655bfc51675e17e2353f7/src/library/documentation.cpp#L128" target="_blank" title="https://github.com/leanprover-community/lean/blob/e1fe877236cd0c7aa4a655bfc51675e17e2353f7/src/library/documentation.cpp#L128">here</a>, so we could update that in 3.5.x to ignore such tags.</p>



<a name="187276687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187276687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187276687">(Feb 03 2020 at 16:15)</a>:</h4>
<p>It's handled correctly here: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/reassoc_axiom.lean#L15" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/reassoc_axiom.lean#L15">https://github.com/leanprover-community/mathlib/blob/master/src/tactic/reassoc_axiom.lean#L15</a></p>



<a name="187277157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187277157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187277157">(Feb 03 2020 at 16:19)</a>:</h4>
<p>What's the difference?</p>



<a name="187277726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187277726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187277726">(Feb 03 2020 at 16:25)</a>:</h4>
<p>I guess there's a bug somewhere. This gives the invalid docstring error:</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">!</span>

<span class="cm">```lean</span>
<span class="cm">a</span>
<span class="cm">```</span>

<span class="cm">a</span>
<span class="cm">-/</span>
</pre></div>


<p>This doesn't:</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">!</span>

<span class="cm">```lean</span>
<span class="cm">a</span>
<span class="cm">```</span>


<span class="cm">-/</span>
</pre></div>


<p>Neither does this (though it should):</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">!</span>

<span class="cm">```lean</span>
<span class="cm">a</span>
<span class="cm">```</span>

<span class="cm">```</span>
<span class="cm">-/</span>
</pre></div>



<a name="187289959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/187289959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#187289959">(Feb 03 2020 at 18:30)</a>:</h4>
<p>This is now <a href="https://github.com/leanprover-community/lean/issues/108" target="_blank" title="https://github.com/leanprover-community/lean/issues/108">issue 108 on leanprover-community/lean</a>. I probably won't be able to look at this any more for now.</p>



<a name="188174876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/lean%20codeblocks%20in%20docstrings/near/188174876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/lean.20codeblocks.20in.20docstrings.html#188174876">(Feb 14 2020 at 03:20)</a>:</h4>
<p>I looked at this again. The issue that <span class="user-mention" data-user-id="112680">@Johan Commelin</span> pointed out was actually fixed last year in <a href="https://github.com/leanprover-community/lean/pull/40" target="_blank" title="https://github.com/leanprover-community/lean/pull/40">this PR</a> which was merged into 3.5.0. </p>
<p>However, this example:</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">!</span>
<span class="cm">```</span>
<span class="cm">```</span>
<span class="cm">```</span>
<span class="cm">-/</span>
</pre></div>


<p>does not throw an error, even though it should.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>