---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/autoformatter.20for.20lean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html">autoformatter for lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="209511839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209511839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Tran <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209511839">(Sep 09 2020 at 13:44)</a>:</h4>
<p>when i use a "real" programming language, i like to use an autoformatter, because i don't like to think about formatting my code beyond "good enough". is there an autoformatter or one planned for lean?</p>



<a name="209511966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209511966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209511966">(Sep 09 2020 at 13:45)</a>:</h4>
<p>Nothing for Lean 3. I guess we're all waiting for Lean 4.</p>



<a name="209512079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209512079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209512079">(Sep 09 2020 at 13:46)</a>:</h4>
<p>But it might be really hard to do this for Lean 4, because its syntax is <em>extremely</em> flexible.</p>



<a name="209515181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515181">(Sep 09 2020 at 14:06)</a>:</h4>
<p>Is there a linter? I saw mathlib used one, but it didn't seem general purpose</p>



<a name="209515213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515213">(Sep 09 2020 at 14:07)</a>:</h4>
<p>(Something that doesn't fully do the autoformatting but at least complains for whatever style lean files might want to follow)</p>



<a name="209515275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515275">(Sep 09 2020 at 14:07)</a>:</h4>
<p>The linting is different from usual linters</p>



<a name="209515356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515356">(Sep 09 2020 at 14:08)</a>:</h4>
<p>The mathlib linters check that a theorem uses all its assumptions, things like that.</p>



<a name="209515400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515400">(Sep 09 2020 at 14:08)</a>:</h4>
<p>Or bad simp-lemmas, or using <code>&gt;</code> instead of <code>&lt;</code></p>



<a name="209515458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515458">(Sep 09 2020 at 14:08)</a>:</h4>
<p>ah</p>



<a name="209515519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515519">(Sep 09 2020 at 14:09)</a>:</h4>
<p>They aren't even technically capable of inspecting the syntax that the user wrote.</p>



<a name="209515553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515553">(Sep 09 2020 at 14:09)</a>:</h4>
<p>Because they operate on a level behind the parser.</p>



<a name="209515920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/209515920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#209515920">(Sep 09 2020 at 14:12)</a>:</h4>
<p><em>nod</em></p>



<a name="255954302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255954302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Kempster <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255954302">(Oct 03 2021 at 14:13)</a>:</h4>
<p>Bumping this year-old thread. Are we still waiting for lean4? Is the lean4 syntax now fully specified and unchanging?</p>



<a name="255954664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255954664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255954664">(Oct 03 2021 at 14:19)</a>:</h4>
<p>The Lean 4 syntax is so extensible I'm not sure this "fully specified and unchanging" question makes sense. But Lean 4 can definitely autoformat itself.</p>



<a name="255954714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255954714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255954714">(Oct 03 2021 at 14:20)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span></p>



<a name="255954847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255954847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Kempster <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255954847">(Oct 03 2021 at 14:22)</a>:</h4>
<p>Aha, so a lean4 autoformatter would of course be a lean4 codebase. This makes sense.</p>
<p>Meanwhile, we are N years away from mathlib4 being the "main" mathlib. What is N? If N is large, does it justify a lean3 autoformatter in the meantime? I've noticed on many PRs that formatting causes several rounds of asynchronous communication, while also being largely automatable.</p>



<a name="255954945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255954945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255954945">(Oct 03 2021 at 14:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/autoformatter.20for.20lean/near/255954664">said</a>:</p>
<blockquote>
<p>The Lean 4 syntax is so extensible I'm not sure this "fully specified and unchanging" question makes sense. But Lean 4 can definitely autoformat itself.</p>
</blockquote>
<p>Well enough for the goal view at least, but not for formatting source code. <a href="https://github.com/leanprover/lean4/blob/af12c91b0a50db2e474a1e9e04960966eea85499/tests/lean/Reformat.lean.expected.out">https://github.com/leanprover/lean4/blob/af12c91b0a50db2e474a1e9e04960966eea85499/tests/lean/Reformat.lean.expected.out</a> shows the current state, though many edge case are not present in there.</p>



<a name="255955048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255955048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255955048">(Oct 03 2021 at 14:26)</a>:</h4>
<p>Yes, my understanding is there is no hope to write a Lean 4 autoformatter in any other language. And we hope N is less than one.</p>



<a name="255955064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255955064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255955064">(Oct 03 2021 at 14:26)</a>:</h4>
<p>Formatting code with sensible line breaks is an art and someone would likely need to spend a month or so solely on the Lean 4 formatter to achieve remotely acceptable output</p>



<a name="255990391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/autoformatter%20for%20lean/near/255990391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/autoformatter.20for.20lean.html#255990391">(Oct 04 2021 at 00:14)</a>:</h4>
<p>One of my hopes for the Lean 4 version of the Bernardy pretty-printer is to figure out the best way to leverage it as a library for making formatters; I think it can significantly reduce the amount of work needed to get good (but still customizable) formatting.  I haven't pushed the update yet, but I implemented a much more efficient handling for blocks of text to allow for incorporation of docs and comments.</p>
<p>If anyone's actually interested in making a full-blown formatter, get in touch and I'll work with you to figure out the best way to adapt it to work with Lean syntax trees.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>