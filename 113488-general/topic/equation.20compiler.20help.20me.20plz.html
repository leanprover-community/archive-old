---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html">equation compiler help me plz</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="254204441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254204441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254204441">(Sep 21 2021 at 13:13)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.preadditive</span>
<span class="kn">import</span> <span class="n">category_theory.abelian.projective</span>
<span class="kn">import</span> <span class="n">tactic.interval_cases</span>


<span class="kd">noncomputable theory</span>

<span class="kn">open</span> <span class="n">category_theory</span>
<span class="kn">open</span> <span class="n">category_theory.limits</span>

<span class="kd">universe</span> <span class="kd">variables</span> <span class="n">v</span> <span class="n">u</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">category.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span> <span class="bp">‚Üí</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">F</span> <span class="mi">0</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">F</span> <span class="mi">1</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">F</span> <span class="mi">2</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="mi">3</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">fin4_functor_mk</span>

<span class="kd">def</span> <span class="n">map</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hij</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">),</span> <span class="n">F</span> <span class="n">i</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="n">j</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="c1">-- how do I tell Lean that I'm done?</span>

<span class="kd">end</span> <span class="n">fin4_functor_mk</span>

<span class="kd">def</span> <span class="n">fin4_functor_mk</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span> <span class="bp">‚•§</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">map_id'</span> <span class="o">:=</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">map_comp'</span> <span class="o">:=</span> <span class="n">_</span> <span class="o">}</span>

<span class="kd">end</span> <span class="n">category_theory</span>
</code></pre></div>



<a name="254207448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254207448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254207448">(Sep 21 2021 at 13:34)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">map</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hij</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">),</span> <span class="n">F</span> <span class="n">i</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="n">j</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="c1">-- oh boy</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">subtype.coe_le_coe.mpr</span> <span class="n">h</span><span class="o">]</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">subtype.coe_le_coe.mpr</span> <span class="n">h</span><span class="o">]</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">subtype.coe_le_coe.mpr</span> <span class="n">h</span><span class="o">]</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">subtype.coe_le_coe.mpr</span> <span class="n">h</span><span class="o">]</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">subtype.coe_le_coe.mpr</span> <span class="n">h</span><span class="o">]</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">subtype.coe_le_coe.mpr</span> <span class="n">h</span><span class="o">]</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">n</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="kd">by</span> <span class="n">linarith</span>
</code></pre></div>



<a name="254207608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254207608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254207608">(Sep 21 2021 at 13:36)</a>:</h4>
<p>Not exactly satisfying</p>



<a name="254208154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254208154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David W√§rn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254208154">(Sep 21 2021 at 13:39)</a>:</h4>
<p>MWE:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">,</span> <span class="n">n</span> <span class="bp">‚â§</span> <span class="mi">1</span> <span class="bp">‚Üí</span> <span class="n">true</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
<span class="c1">-- non-exhaustive match, the following cases are missing:</span>
<span class="c1">-- _example (nat.succ _).succ _</span>
</code></pre></div>
<p>I'm not sure this is a job for the equation compiler?</p>



<a name="254208832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254208832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254208832">(Sep 21 2021 at 13:44)</a>:</h4>
<p>This is what I have now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">map'</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hij</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">),</span> <span class="n">F</span> <span class="n">i</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="n">j</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">hi</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="n">_</span> <span class="o">‚ü®</span><span class="n">j</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">hj</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
</code></pre></div>



<a name="254208893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254208893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254208893">(Sep 21 2021 at 13:44)</a>:</h4>
<p>Accompanied by</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">map'_id</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">),</span> <span class="n">map'</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">i</span> <span class="n">i</span> <span class="n">le_rfl</span> <span class="bp">=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">hi</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">map'_comp</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hij</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">hjk</span> <span class="o">:</span> <span class="n">j</span> <span class="bp">‚â§</span> <span class="n">k</span><span class="o">),</span>
  <span class="n">map'</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">i</span> <span class="n">j</span> <span class="n">hij</span> <span class="bp">‚â´</span> <span class="n">map'</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">j</span> <span class="n">k</span> <span class="n">hjk</span> <span class="bp">=</span> <span class="n">map'</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">i</span> <span class="n">k</span> <span class="o">(</span><span class="n">hij.trans</span> <span class="n">hjk</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">k</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.id_comp</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">k</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.id_comp</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">k</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.id_comp</span> <span class="n">_</span>
<span class="bp">|</span> <span class="n">i</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.comp_id</span> <span class="n">_</span>
<span class="bp">|</span> <span class="n">i</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.comp_id</span> <span class="n">_</span>
<span class="bp">|</span> <span class="n">i</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.comp_id</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">category.assoc</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">hi</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="n">_</span> <span class="o">‚ü®</span><span class="n">j</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">hj</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="n">_</span> <span class="n">_</span> <span class="o">‚ü®</span><span class="n">k</span><span class="bp">+</span><span class="mi">4</span><span class="o">,</span><span class="n">hk</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">hk</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">H</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">H</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">H</span> <span class="n">_</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="n">_</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="n">_</span> <span class="o">‚ü®</span><span class="n">i</span><span class="bp">+</span><span class="mi">2</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
<span class="bp">|</span> <span class="n">_</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span><span class="n">hi</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span><span class="n">hj</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="n">H</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">H</span><span class="o">,</span> <span class="n">dec_trivial</span> <span class="o">}</span>
</code></pre></div>



<a name="254208965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254208965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254208965">(Sep 21 2021 at 13:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130377">David W√§rn</span> <a href="#narrow/stream/113488-general/topic/equation.20compiler.20help.20me.20plz/near/254208154">said</a>:</p>
<blockquote>
<p>MWE:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">,</span> <span class="n">n</span> <span class="bp">‚â§</span> <span class="mi">1</span> <span class="bp">‚Üí</span> <span class="n">true</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
<span class="c1">-- non-exhaustive match, the following cases are missing:</span>
<span class="c1">-- _example (nat.succ _).succ _</span>
</code></pre></div>
<p>I'm not sure this is a job for the equation compiler?</p>
</blockquote>
<p>For this specific case I feel like it should be, since the proof is simply by-cases:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">,</span> <span class="n">n</span> <span class="bp">‚â§</span> <span class="mi">1</span> <span class="bp">‚Üí</span> <span class="n">true</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
<span class="c1">-- there is no `h` that can fill this gap, but we still have to case it ourselves</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">nat.less_than_or_equal.step</span> <span class="n">h</span><span class="o">)</span> <span class="o">:=</span> <span class="n">false.elim</span> <span class="bp">$</span> <span class="k">match</span> <span class="n">h</span> <span class="k">with</span> <span class="kd">end</span>
</code></pre></div>



<a name="254209829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254209829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David W√§rn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254209829">(Sep 21 2021 at 13:51)</a>:</h4>
<p>Note that this one works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">,</span> <span class="n">n</span> <span class="bp">‚â§</span> <span class="mi">0</span> <span class="bp">‚Üí</span> <span class="n">true</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">trivial</span>
</code></pre></div>



<a name="254210267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254210267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David W√§rn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254210267">(Sep 21 2021 at 13:54)</a>:</h4>
<p>I mean using <code>exfalso</code> like this makes sense, but I'm curious about which absurd patterns the equation compiler can spot on its own</p>



<a name="254210378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254210378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David W√§rn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254210378">(Sep 21 2021 at 13:55)</a>:</h4>
<p>Surely when your goal is a Prop you don't have to do this manual case-splitting, there should be some short tactic script which does it for you</p>



<a name="254213278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254213278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254213278">(Sep 21 2021 at 14:12)</a>:</h4>
<p>When the goal is a prop there is <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#fin_cases">tactic#fin_cases</a> and <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#interval_cases">tactic#interval_cases</a>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kd">example</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="n">n</span> <span class="o">:</span> <span class="n">‚Ñï</span><span class="o">,</span> <span class="n">n</span> <span class="bp">‚â§</span> <span class="mi">1</span> <span class="bp">‚Üí</span> <span class="n">true</span><span class="o">:=</span>
<span class="kd">begin</span>
<span class="n">intros</span> <span class="n">n</span> <span class="n">hn</span><span class="o">,</span>
<span class="n">interval_cases</span> <span class="n">n</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>Johan's map' isn't a Prop though, but I guess map'_comp is?</p>



<a name="254213588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254213588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254213588">(Sep 21 2021 at 14:13)</a>:</h4>
<p>Aah, so I could use <code>fin_cases</code> for <code>map'_comp</code>.</p>



<a name="254214510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254214510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ya√´l Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254214510">(Sep 21 2021 at 14:19)</a>:</h4>
<p>Btw <a href="https://github.com/leanprover-community/mathlib/issues/7987">#7987</a> will buff <code>fin_cases</code> by allowing it to work for <code>fin n</code> (and other stuff you can think of).</p>



<a name="254217019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254217019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254217019">(Sep 21 2021 at 14:33)</a>:</h4>
<p>Doesn't it already work for <code>fin n</code>?</p>



<a name="254218101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254218101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ya√´l Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254218101">(Sep 21 2021 at 14:40)</a>:</h4>
<p>I think not? At least I'm adding the stuff that's needed for it, but it already works using something else?</p>



<a name="254292546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254292546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254292546">(Sep 21 2021 at 23:19)</a>:</h4>
<p>The tests for <code>fin_cases</code> says it works on <code>fin n</code>. In fact, the reason it's called <code>fin_cases</code> is the initial implementation <em>only</em> worked on <code>fin n</code>, rather than most finite stuff.</p>



<a name="254292632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254292632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254292632">(Sep 21 2021 at 23:20)</a>:</h4>
<p>Regarding the restriction that the target is <code>Prop</code>: we can easily drop this by allowing the tactics to be nonconstructive, and I think we should do this.</p>



<a name="254292881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254292881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254292881">(Sep 21 2021 at 23:23)</a>:</h4>
<p>Anytime you get a "can only eliminate into Prop" error, you always have the option of calling <code>nonempty.some</code> first:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">‚Ñï</span> <span class="bp">‚Üí</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h0</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- Fails with `induction tactic failed, recursor 'or.dcases_on' can only eliminate into Prop`:</span>
  <span class="c1">-- fin_cases p,</span>

  <span class="c1">-- So try harder:</span>
  <span class="n">apply</span> <span class="n">nonempty.some</span><span class="o">,</span>
  <span class="n">fin_cases</span> <span class="n">p</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="n">assumption</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="254292915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254292915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254292915">(Sep 21 2021 at 23:23)</a>:</h4>
<p>Given how resolutely classical mathlib is at this point, I think there's little point in our tactics being cautious about this.</p>



<a name="254293006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254293006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254293006">(Sep 21 2021 at 23:24)</a>:</h4>
<p>(We could also try to make <code>fin_cases</code> work constructively!)</p>



<a name="254297544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254297544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254297544">(Sep 22 2021 at 00:18)</a>:</h4>
<p>I don't know whether this technique is advisable in all circumstances, but it works here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">map_aux</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hi</span> <span class="o">:</span> <span class="n">to_bool</span> <span class="o">(</span><span class="n">i.1</span> <span class="bp">&lt;</span> <span class="mi">4</span> <span class="bp">‚àß</span> <span class="n">j.1</span> <span class="bp">&lt;</span> <span class="mi">4</span> <span class="bp">‚àß</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">)),</span> <span class="n">F</span> <span class="n">i</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="n">j</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>

<span class="kd">def</span> <span class="n">map</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hij</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span> <span class="n">i</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="n">j</span> <span class="o">:=</span>
<span class="n">map_aux</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">i</span> <span class="n">j</span> <span class="o">(</span><span class="n">to_bool_tt</span> <span class="o">‚ü®</span><span class="n">i.2</span><span class="o">,</span> <span class="n">j.2</span><span class="o">,</span> <span class="n">hij</span><span class="o">‚ü©)</span>
</code></pre></div>



<a name="254297653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254297653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254297653">(Sep 22 2021 at 00:19)</a>:</h4>
<p>or</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">map</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">4</span><span class="o">)</span> <span class="o">(</span><span class="n">hij</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span> <span class="n">i</span> <span class="bp">‚ü∂</span> <span class="n">F</span> <span class="n">j</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">,</span> <span class="n">to_bool_tt</span> <span class="o">(‚ü®</span><span class="n">i.2</span><span class="o">,</span> <span class="n">j.2</span><span class="o">,</span> <span class="n">hij</span><span class="o">‚ü©</span> <span class="o">:</span> <span class="n">i.1</span> <span class="bp">&lt;</span> <span class="mi">4</span> <span class="bp">‚àß</span> <span class="n">j.1</span> <span class="bp">&lt;</span> <span class="mi">4</span> <span class="bp">‚àß</span> <span class="n">i</span> <span class="bp">‚â§</span> <span class="n">j</span><span class="o">)</span> <span class="k">with</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="mi">ùüô</span> <span class="n">_</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">2</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">1</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="mi">3</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">‚â´</span> <span class="n">b</span> <span class="bp">‚â´</span> <span class="n">c</span>
<span class="kd">end</span>
</code></pre></div>



<a name="254306560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254306560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254306560">(Sep 22 2021 at 02:29)</a>:</h4>
<p>That's pretty cool, I had no idea about this <code>to_bool</code> method!</p>



<a name="254320791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20compiler%20help%20me%20plz/near/254320791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ya√´l Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/equation.20compiler.20help.20me.20plz.html#254320791">(Sep 22 2021 at 06:25)</a>:</h4>
<p>Oh whoops. I guess I broke it all before fixing it <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>