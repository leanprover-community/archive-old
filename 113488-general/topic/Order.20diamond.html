---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Order.20diamond.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html">Order diamond</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="253632743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253632743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253632743">(Sep 16 2021 at 18:59)</a>:</h4>
<p>I don't know what to do to solve this.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">order.bounds</span>

<span class="kd">lemma</span> <span class="n">monotone_fst'</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">monotone</span> <span class="o">(</span><span class="bp">@</span><span class="n">prod.fst</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">lemma</span> <span class="n">monotone_snd'</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">monotone</span> <span class="o">(</span><span class="bp">@</span><span class="n">prod.snd</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">lemma</span> <span class="n">mem_upper_bounds_image</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">β</span><span class="o">]</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">Hf</span> <span class="o">:</span> <span class="n">monotone</span> <span class="n">f</span><span class="o">)</span>
  <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">Ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="o">(</span><span class="n">f</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">β</span><span class="o">]</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">Hf</span> <span class="o">:</span> <span class="n">monotone</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mem_upper_bounds_image</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">prod.preorder</span> <span class="n">α</span> <span class="n">β</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">monotone_fst'</span><span class="o">,</span> <span class="c1">-- works</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mem_upper_bounds_image</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">monotone_fst'</span><span class="o">,</span> <span class="c1">--fails</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">mem_upper_bounds_image</span> <span class="n">monotone_fst'</span><span class="o">,</span> <span class="c1">--fails</span>
<span class="kd">end</span>
</code></pre></div>



<a name="253633101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253633101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253633101">(Sep 16 2021 at 19:01)</a>:</h4>
<p>The problem seems to stem from <code>(Hf : monotone f)</code> taking in <code>@preorder.to_has_le α</code> and <code>preorder.to_has_le β</code> and not just any <code>has_le</code>.</p>



<a name="253633238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253633238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253633238">(Sep 16 2021 at 19:02)</a>:</h4>
<p>Note this is all already in mathlib, and somehow I've broken it in the past 6 commits I made to <a href="https://github.com/leanprover-community/mathlib/issues/7987">#7987</a> <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="253634119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253634119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253634119">(Sep 16 2021 at 19:07)</a>:</h4>
<p>What do you mean by "works" and "fails"?<br>
Surely, the last two can't infer <code>α</code> or <code>β</code>.</p>



<a name="253634443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253634443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253634443">(Sep 16 2021 at 19:09)</a>:</h4>
<p>Yeah but they should be left as metavariables. If you provide them using other arguments, that still doesn't work</p>



<a name="253634614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253634614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253634614">(Sep 16 2021 at 19:10)</a>:</h4>
<p>Well in the Lean playground, they all "work" then.</p>



<a name="253634673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253634673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253634673">(Sep 16 2021 at 19:11)</a>:</h4>
<p>Hmm...</p>



<a name="253634900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253634900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253634900">(Sep 16 2021 at 19:12)</a>:</h4>
<p>Well a non minimal really non working example is the branch <code>locally_finite</code> in <code>order.bounds</code>, if somebody could have a look.</p>



<a name="253672413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253672413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253672413">(Sep 17 2021 at 00:41)</a>:</h4>
<p>prod orders are broken, lt and le don't agree.</p>



<a name="253675885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253675885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253675885">(Sep 17 2021 at 01:28)</a>:</h4>
<p><span class="user-mention" data-user-id="308899">@Yakov Pechersky</span> Could you please point me to the pair of instances that create a diamond?</p>



<a name="253676033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676033">(Sep 17 2021 at 01:30)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/prod.has_lt/src">src#prod.has_lt</a>, <a href="https://leanprover-community.github.io/mathlib_docs/find/prod.has_le/src">src#prod.has_le</a></p>



<a name="253676098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676098">(Sep 17 2021 at 01:31)</a>:</h4>
<p>What's wrong with these two instances? We never require <code>lt_iff_le_not_le</code> to be a definitional equality.</p>



<a name="253676162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676162">(Sep 17 2021 at 01:32)</a>:</h4>
<p>Probably some other instance up in the chain uses the default <code>(&lt;)</code> instead of <code>lt := (&lt;)</code>.</p>



<a name="253676204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676204">(Sep 17 2021 at 01:33)</a>:</h4>
<p>Indeed, <a href="https://leanprover-community.github.io/mathlib_docs/find/prod.preorder">docs#prod.preorder</a> is bad.</p>



<a name="253676211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676211">(Sep 17 2021 at 01:33)</a>:</h4>
<p>Specifically in <a href="https://leanprover-community.github.io/mathlib_docs/find/prod.ordered_smul/src">src#prod.ordered_smul</a>, I couldn't generalize it properly.</p>



<a name="253676221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676221">(Sep 17 2021 at 01:33)</a>:</h4>
<p>I'll try to fix it now.</p>



<a name="253676231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676231">(Sep 17 2021 at 01:33)</a>:</h4>
<p>Yes, what I meant is that. I just sent the actually conflicting definitions.</p>



<a name="253676303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676303">(Sep 17 2021 at 01:34)</a>:</h4>
<p>I'll fix <code>prod.preorder</code>, then the diamond should disappear.</p>



<a name="253676698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676698">(Sep 17 2021 at 01:40)</a>:</h4>
<p>OMG, <code>prod.has_lt</code> is not equivalent to <code>le_and_not_le</code> for a <code>preorder</code>.</p>



<a name="253676719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676719">(Sep 17 2021 at 01:40)</a>:</h4>
<p>We'll need to fix it in the core.</p>



<a name="253676737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676737">(Sep 17 2021 at 01:40)</a>:</h4>
<p>(or move <code>prod.has_lt</code> to <code>mathlib</code>)</p>



<a name="253676920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676920">(Sep 17 2021 at 01:43)</a>:</h4>
<p>I don't think <code>prod.has_lt</code> should be an instance at all</p>



<a name="253676933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253676933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253676933">(Sep 17 2021 at 01:43)</a>:</h4>
<p>there should be a type alias for the total order</p>



<a name="253677001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253677001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253677001">(Sep 17 2021 at 01:44)</a>:</h4>
<p>or use <code>prod.lex</code> instead of <code>&lt;</code></p>



<a name="253677475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253677475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253677475">(Sep 17 2021 at 01:50)</a>:</h4>
<p>I'm going to delete the old instance from core.</p>



<a name="253677643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253677643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253677643">(Sep 17 2021 at 01:53)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/620">lean#620</a></p>



<a name="253677666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253677666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253677666">(Sep 17 2021 at 01:54)</a>:</h4>
<p>We already have a type alias <a href="https://leanprover-community.github.io/mathlib_docs/find/lex">docs#lex</a> for the lexicographical order.</p>



<a name="253677850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253677850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253677850">(Sep 17 2021 at 01:56)</a>:</h4>
<p>Right, this is the issue I hit earlier. You're taking on the core change that I avoided :-) thank you</p>



<a name="253678023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678023">(Sep 17 2021 at 01:59)</a>:</h4>
<p>BTW, do we use the right definition for <code>lex.has_le</code> in case of a preorder? It looks like the map <code>λ x, (x, a)</code> is not monotone with our definition.</p>



<a name="253678069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678069">(Sep 17 2021 at 01:59)</a>:</h4>
<p>Because we don't have <code>eq_or_lt_of_le</code>.</p>



<a name="253678386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678386">(Sep 17 2021 at 02:03)</a>:</h4>
<p>I think that we should use <code>(a, b) ≤ (c, d) ↔ a ≤ c ∧ (c ≤ a → b ≤ d)</code> (or don't claim to support preorders).</p>



<a name="253678481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678481">(Sep 17 2021 at 02:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110187">@Minchao Wu</span> According to the header, you're the authors of <code>order.lexicographic</code>.</p>



<a name="253678718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678718">(Sep 17 2021 at 02:07)</a>:</h4>
<p>We'll need another statement that still says <code>(a, b) ≤ (c, d) ↔ a &lt; c \or (a = c ∧ b ≤ d)</code> with <code>[partial_order]</code>.</p>



<a name="253678747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678747">(Sep 17 2021 at 02:07)</a>:</h4>
<p>Yes, sure. We need a partial order on <code>α</code> and a preorder on <code>β</code> for this statement.</p>



<a name="253678825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253678825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253678825">(Sep 17 2021 at 02:08)</a>:</h4>
<p>There should be an <code>iff</code> with <code>lex</code> as well if we want to reuse the fact that it's well-founded.</p>



<a name="253696433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253696433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253696433">(Sep 17 2021 at 06:26)</a>:</h4>
<p>Oh duh, I didn't notice <code>prod.has_lt</code> existed.</p>



<a name="253696478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253696478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253696478">(Sep 17 2021 at 06:27)</a>:</h4>
<p>(<a href="https://leanprover-community.github.io/mathlib_docs/find/prod.has_lt">docs#prod.has_lt</a>)</p>



<a name="253696503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253696503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253696503">(Sep 17 2021 at 06:27)</a>:</h4>
<p>Thansk for correcting this! What's puzzling me is that all this was working before and I somehow broke it. Maybe it was just fragile.</p>



<a name="253725727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/253725727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#253725727">(Sep 17 2021 at 11:12)</a>:</h4>
<p>As you can see with <a href="https://leanprover-community.github.io/mathlib_docs/find/prod.ordered_smul/src">src#prod.ordered_smul</a>, if you're at a complex enough structure, then it takes only one "canonical" path through the TCs. But generalizing, it has more options to branch. That's probably what's going on in your generalization branch.</p>



<a name="254353352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254353352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254353352">(Sep 22 2021 at 11:45)</a>:</h4>
<p>Okay, I've made an actual MWE. This is the most minimizing I've ever done.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.interactive_expr</span>

<span class="kd">instance</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_le</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span><span class="o">,</span> <span class="n">p.1</span> <span class="bp">≤</span> <span class="n">q.1</span> <span class="bp">∧</span> <span class="n">p.2</span> <span class="bp">≤</span> <span class="n">q.2</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">preorder</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">le_refl</span>  <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="n">le_trans</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="bp">..</span> <span class="n">prod.has_le</span> <span class="n">α</span> <span class="n">β</span> <span class="o">}</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">monotone</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_le</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">a</span> <span class="n">b</span><span class="o">⦄,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">f</span> <span class="n">b</span>

<span class="kd">variables</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">β</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">monotone_fst</span> <span class="o">:</span> <span class="n">monotone</span> <span class="o">(</span><span class="bp">@</span><span class="n">prod.fst</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="kd">infix</span> <span class="bp">`</span> <span class="bp">''</span> <span class="bp">`</span><span class="o">:</span><span class="mi">80</span> <span class="o">:=</span> <span class="n">set.image</span>

<span class="kd">def</span> <span class="n">upper_bounds</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span> <span class="o">:=</span> <span class="o">{</span><span class="n">x</span> <span class="bp">|</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">a</span><span class="o">⦄,</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">}</span>

<span class="kd">lemma</span> <span class="n">monotone.mem_upper_bounds_image</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">monotone</span> <span class="n">f</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="o">(</span><span class="n">f</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="kd">lemma</span> <span class="n">mwe_works</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">a.1</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="o">(</span><span class="n">prod.fst</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">exact</span> <span class="n">monotone.mem_upper_bounds_image</span> <span class="n">monotone_fst</span> <span class="n">ha</span><span class="o">,</span> <span class="c1">-- works</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">mwe_fails</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">a.1</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="o">(</span><span class="n">prod.fst</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">exact</span> <span class="n">monotone_fst.mem_upper_bounds_image</span> <span class="n">ha</span><span class="o">,</span> <span class="c1">-- fails</span>
<span class="kd">end</span>
</code></pre></div>



<a name="254353495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254353495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254353495">(Sep 22 2021 at 11:46)</a>:</h4>
<p>I think this is clearly(?) an elaboration issue.</p>



<a name="254353634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254353634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254353634">(Sep 22 2021 at 11:47)</a>:</h4>
<p>If I replace the definition of <code>monotone</code> by <code>def monotone [preorder α] [has_le β] (f : α → β) : Prop := ∀ ⦃a b⦄, a ≤ b → f a ≤ f b</code>, then <code>mwe_fails</code> works.</p>



<a name="254354042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254354042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254354042">(Sep 22 2021 at 11:51)</a>:</h4>
<p>This is because dot notation has different elaboration rules I guess</p>



<a name="254354318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254354318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254354318">(Sep 22 2021 at 11:54)</a>:</h4>
<p>I guess it does <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span> <br>
Lean fails to unify <code>@prod.has_le α β</code> with <code>@preorder.to_has_le α β _</code></p>



<a name="254354908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254354908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254354908">(Sep 22 2021 at 12:00)</a>:</h4>
<p>In current mathlib, this works because <code>monotone</code> assumes <code>[preorder α] [preorder β]</code>. What should I do? Remove the affected dot notation? Stick to <code>preorder</code> in the definition? Get someone to fix that elaboration issue?</p>



<a name="254355283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254355283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254355283">(Sep 22 2021 at 12:03)</a>:</h4>
<p>Does putting a type annotation on <code>monotone_fst</code> before the dot notation help?</p>



<a name="254356615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254356615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254356615">(Sep 22 2021 at 12:15)</a>:</h4>
<p>Indeed this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">mwe_fails</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="n">s</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">a.1</span> <span class="bp">∈</span> <span class="n">upper_bounds</span> <span class="o">(</span><span class="n">prod.fst</span> <span class="bp">''</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">monotone_fst</span> <span class="o">:</span> <span class="n">monotone</span> <span class="o">(</span><span class="bp">@</span><span class="n">prod.fst</span> <span class="n">α</span> <span class="n">β</span><span class="o">))</span><span class="bp">.</span><span class="n">mem_upper_bounds_image</span> <span class="n">ha</span>
</code></pre></div>



<a name="254357000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254357000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254357000">(Sep 22 2021 at 12:18)</a>:</h4>
<p>(I put <code>α</code> and <code>β</code> in the same universe to make the errors a bit shorter.)<br>
So here's something I don't understand. In a message like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Additional</span> <span class="n">information</span><span class="o">:</span>
<span class="bp">/</span><span class="n">test.lean</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span> <span class="n">context</span><span class="o">:</span> <span class="n">switched</span> <span class="n">to</span> <span class="n">simple</span> <span class="n">application</span> <span class="n">elaboration</span> <span class="n">procedure</span> <span class="n">because</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">use</span> <span class="n">expected</span> <span class="n">type</span> <span class="n">to</span> <span class="n">elaborate</span> <span class="n">it</span><span class="o">,</span> <span class="n">error</span> <span class="n">message</span>
  <span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
    <span class="bp">@</span><span class="n">monotone.mem_upper_bounds_image.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_4</span> <span class="bp">?</span><span class="n">m_5</span> <span class="bp">?</span><span class="n">m_6</span> <span class="o">(</span><span class="bp">@</span><span class="n">monotone_fst.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_7</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_8</span> <span class="bp">?</span><span class="n">m_9</span> <span class="bp">?</span><span class="n">m_10</span> <span class="bp">?</span><span class="n">m_11</span><span class="o">)</span>
  <span class="n">term</span>
    <span class="bp">@</span><span class="n">monotone_fst.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_4</span> <span class="bp">?</span><span class="n">m_5</span>
  <span class="n">has</span> <span class="n">type</span>
    <span class="bp">@</span><span class="n">monotone.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="o">(</span><span class="n">prod.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span> <span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span><span class="o">)</span> <span class="bp">?</span><span class="n">m_2</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">prod.has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span> <span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_4</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_5</span><span class="o">))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_4</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">prod.fst.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span> <span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span><span class="o">)</span>
  <span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
    <span class="bp">@</span><span class="n">monotone.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_3</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_2</span> <span class="bp">?</span><span class="n">m_4</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">preorder.to_has_le.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">m_3</span> <span class="bp">?</span><span class="n">m_5</span><span class="o">)</span> <span class="bp">?</span><span class="n">m_6</span>
</code></pre></div>
<p>are the <code>?m_2</code> and <code>?m_3</code> that appear in the actual and expected types the same metavariables in both, or are they independent?</p>



<a name="254357293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254357293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254357293">(Sep 22 2021 at 12:20)</a>:</h4>
<p>Ah I guess they are numbered independently, since in the first line <code>monotone_fst</code> is applied to things like <code>?m_8</code> and <code>?m_9</code></p>



<a name="254358513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254358513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254358513">(Sep 22 2021 at 12:30)</a>:</h4>
<p>I guess the story must be something like: We need to type check <code>monotone_fst</code> first, in order to even find out what definition <code>monotone_fst.mem_upper_bounds_image</code> refers to. At this point, we have no idea how the value <code>monotone_fst</code> will get used so we can't infer anything about its type arguments. So if we try to do instance search now, we can't make any progress. So we end up with <code>monotone_fst</code> applied to a slew of metavariables. But at least we know its type is of the form <code>monotone _</code>.<br>
Then, we know the dot notation is referring to <code>monotone.mem_upper_bounds_image</code>. But <code>monotone.mem_upper_bounds_image monotone_fst</code> can only type check <em>after</em> we do another instance search and find that we mean <code>prod.has_le</code>. Apparently Lean doesn't do an instance search at this point.</p>



<a name="254358834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/254358834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#254358834">(Sep 22 2021 at 12:33)</a>:</h4>
<p>I think the reason it works with <code>preorder</code> in <code>monotone</code> but not <code>has_le</code> is that in the latter case, there's a <em>potentially</em> non-defeq instance issue. Of course if you actually look at the definition of <code>prod.preorder</code> you'll see that <code>to_has_le</code> of it is the same as <code>prod.has_le</code>, but you have to look at the instances to see this. If you only talk about <code>preorder</code> everywhere then this issue doesn't come up.</p>



<a name="255849698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Order%20diamond/near/255849698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Order.20diamond.html#255849698">(Oct 02 2021 at 07:22)</a>:</h4>
<p>For reference, what I did here in the end is to require <code>preorder</code> everywhere and it works fine.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>