---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html">with_top, enat, and with_zero</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="228502448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228502448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228502448">(Mar 02 2021 at 22:58)</a>:</h4>
<p>I find myself wishing that <code>enat</code> and <code>with_top</code>, and <code>with_zero</code> and <code>with_bot</code>, had definition equality.<br>
Instead, in each case, one is an <code>option</code> and the other is a <code>roption</code>.</p>



<a name="228502821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228502821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228502821">(Mar 02 2021 at 23:01)</a>:</h4>
<p>I might find myself motivated to try making one of these changes, say, to make <code>enat</code> an abbreviation for <code>with_top nat</code>. Is there a good reason not to do that?  I'm not terribly well-versed in the philosophy of decidability here, but I think it doesn't matter much for <code>enat</code> at least. After all, there is already an <code>equiv</code> there.</p>



<a name="228503450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228503450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228503450">(Mar 02 2021 at 23:06)</a>:</h4>
<p>I find it frustrating that some of these things are definitionally equal because it can lead to leaks where <code>r : with_zero G</code> suddenly magically becomes <code>r : option G</code> and then stuff can break. I also had this vague idea that in Lean 4 we were going to be encouraged to make new structures for all of these? Or am I talking nonsense?</p>



<a name="228503815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228503815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228503815">(Mar 02 2021 at 23:09)</a>:</h4>
<p>Well, I've already found one answer to my question, which is that somehow <code>roption</code>s get around the decidability of <code>∃ n, P n</code> in the definition of <code>enat.find</code>.</p>



<a name="228503933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228503933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228503933">(Mar 02 2021 at 23:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero/near/228503450">said</a>:</p>
<blockquote>
<p>I find it frustrating that some of these things are definitionally equal because it can lead to leaks where <code>r : with_zero G</code> suddenly magically becomes <code>r : option G</code> and then stuff can break. I also had this vague idea that in Lean 4 we were going to be encouraged to make new structures for all of these? Or am I talking nonsense?</p>
</blockquote>
<p>Perhaps with <code>with_zero</code> and <code>with_bot</code> I'm overreaching with definitional hubris (not that they feel like they <em>should</em> be implemented differently)</p>



<a name="228504083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228504083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228504083">(Mar 02 2021 at 23:11)</a>:</h4>
<p>but the fact that there are times we want <code>with_top nat</code> and times we want <code>enat</code> is really disturbing...</p>



<a name="228504208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228504208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228504208">(Mar 02 2021 at 23:12)</a>:</h4>
<p>I don't think I ever want <code>enat</code>...</p>



<a name="228504231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228504231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228504231">(Mar 02 2021 at 23:12)</a>:</h4>
<p>Isn't it just some constructivist nonsense?</p>



<a name="228504329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228504329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228504329">(Mar 02 2021 at 23:13)</a>:</h4>
<p>I'm pretty sure the reason is literally so that you can define <code>enat.find P</code> whenever <code>P</code> is decidable, without needing <code>∃ n, P n</code> to be decidable.</p>



<a name="228505230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228505230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228505230">(Mar 02 2021 at 23:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="302826">Aaron Anderson</span> <a href="#narrow/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero/near/228504083">said</a>:</p>
<blockquote>
<p>but the fact that there are times we want <code>with_top nat</code> and times we want <code>enat</code> is really disturbing...</p>
</blockquote>
<p>What's the killer feature of <code>with_top</code>, if the killer feature of <code>enat</code> is avoiding decidability for <a href="https://leanprover-community.github.io/mathlib_docs/find/enat.find">docs#enat.find</a>?</p>



<a name="228505287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228505287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228505287">(Mar 02 2021 at 23:21)</a>:</h4>
<p>Is the problem just that one has less API than the other?</p>



<a name="228506034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228506034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228506034">(Mar 02 2021 at 23:28)</a>:</h4>
<p>The problem to me is that I’d like to use the APIs interchangeably (also, I’d like to be able to define additive valuations using <code>with_top</code>, but maybe that’s not critical)</p>



<a name="228507159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228507159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228507159">(Mar 02 2021 at 23:38)</a>:</h4>
<p>I would then just say to change <code>with_top</code> and <code>with_bot</code> to <code>roption</code>s, but maybe soon I will find out a reason that that’s a bad idea</p>



<a name="228507180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228507180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228507180">(Mar 02 2021 at 23:38)</a>:</h4>
<p>The killer feature of with_top is that <code>option</code> is so easy to use, you just do proofs by cases or with the equation compiler</p>



<a name="228507221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228507221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228507221">(Mar 02 2021 at 23:39)</a>:</h4>
<p>However, <code>with_zero</code> seems to have worked fine as a <code>roption</code>...</p>



<a name="228509057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228509057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228509057">(Mar 02 2021 at 23:55)</a>:</h4>
<p>I don't think the earlier statement about <a href="https://leanprover-community.github.io/mathlib_docs/find/enat.find">docs#enat.find</a> was correct, it has exactly the same decidable assumptions as <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.find">docs#nat.find</a></p>



<a name="228512065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228512065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228512065">(Mar 03 2021 at 00:21)</a>:</h4>
<p>That’s correct, but I can’t seem to replicate it with <code>with_top nat</code></p>



<a name="228512132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228512132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228512132">(Mar 03 2021 at 00:22)</a>:</h4>
<p>At least, not computably</p>



<a name="228541109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228541109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228541109">(Mar 03 2021 at 05:53)</a>:</h4>
<p>The killer feature of <code>with_top</code> is probably that you can use the equation compiler to split between <code>nat</code> and <code>infty</code>.</p>



<a name="228561092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/228561092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#228561092">(Mar 03 2021 at 09:29)</a>:</h4>
<p>In my eyes, the biggest API problem with enat (and also related to not being able to use the equation compiler) is that it encourages the use of <code>roption.get</code>.  That function is pretty unergonomic since you always need to provide a proof that the enat is finite as a second argument.<br>
The <code>roption</code> definition of <code>enat</code> is a tradeoff: <code>enat.find</code> becomes computable, but other operations such as <code>≤</code> become noncomputable.  I don't think this tradeoff is worth it, and I believe that <code>def enat := with_top nat</code> would be the better choice.</p>



<a name="248327194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248327194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248327194">(Aug 04 2021 at 09:20)</a>:</h4>
<p>If everybody agrees, I'll prepare a PR for that to change.</p>



<a name="248328308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248328308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248328308">(Aug 04 2021 at 09:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="302826">Aaron Anderson</span> <a href="#narrow/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero/near/228507221">said</a>:</p>
<blockquote>
<p>However, <code>with_zero</code> seems to have worked fine as a <code>roption</code>...</p>
</blockquote>
<p>Not sure what you mean by that, <a href="https://leanprover-community.github.io/mathlib_docs/find/with_zero/src">src#with_zero</a> is an <code>option</code>, and has been for at least two years.</p>



<a name="248329237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248329237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248329237">(Aug 04 2021 at 09:44)</a>:</h4>
<p>Yes it's enat which is the roption, and this fact basically renders it unusable for me (I don't know the API and don't see any reason why it shouldn't just be an option but no doubt others do!).</p>



<a name="248330688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330688">(Aug 04 2021 at 10:02)</a>:</h4>
<p>Yeah sorry I meant that I will change the def of <code>enat</code> to <code>with_top ℕ</code>. And Aaron probably tried to make <code>with_zero</code> a <code>roption</code>.</p>



<a name="248330801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330801">(Aug 04 2021 at 10:03)</a>:</h4>
<p>Is it worth keeping <code>enat</code> around as <code>renat</code>?</p>



<a name="248330824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330824">(Aug 04 2021 at 10:03)</a>:</h4>
<p>Otherwise, is anything else using <code>roption</code>?</p>



<a name="248330862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330862">(Aug 04 2021 at 10:04)</a>:</h4>
<p>Yeah, all of Mario's computability stuff.</p>



<a name="248330911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330911">(Aug 04 2021 at 10:04)</a>:</h4>
<p>What's weird is to define concrete types with it. That's <code>option</code>'s job.</p>



<a name="248330949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330949">(Aug 04 2021 at 10:05)</a>:</h4>
<p>I think it would probably be good to get <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  to sign off on removal as opposed to renaming</p>



<a name="248330982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248330982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248330982">(Aug 04 2021 at 10:05)</a>:</h4>
<p>Certainly <code>enat</code> via <code>roption</code> is annoying to mathematicians, but perhaps it's still useful and just needs to be more hidden.</p>



<a name="248331062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248331062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248331062">(Aug 04 2021 at 10:06)</a>:</h4>
<p>From the above discussion, the argument in favor of <code>roption</code> is mostly to have <code>enat.find</code> computable.</p>



<a name="248334280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248334280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248334280">(Aug 04 2021 at 10:47)</a>:</h4>
<p>I think that this would be a rather painful refactor and it's not clear to me what we're gaining. </p>
<p>There are tons of places in mathlib where the constructivists have done something and I would have done something different. For example <code>finset</code> is constructive, <code>finsupp</code> and <code>dfinsupp</code> are constructive, <code>enat</code> is constructive etc; I find all of these things hard to work with for various reasons. But just because we now have <code>set.finite</code> and <code>finsum</code> and <code>nat.card</code> doesn't mean that I'm pressing for the removal of <code>finset</code> -- indeed people like Bhavik swear by it for the kind of mathematics they're doing.</p>



<a name="248335004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248335004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248335004">(Aug 04 2021 at 10:56)</a>:</h4>
<blockquote>
<p>I think that this would be a rather painful refactor and it's not clear to me what we're gaining.</p>
</blockquote>
<p>A big one that was already mentioned in this thread is support for the equation compiler.  We can also reuse all lemmas about <code>with_top</code>.  The refactor should be relatively quick (there's only 268 lines mentioning the word enat in mathlib and half of them in data/nat/enat.lean).</p>



<a name="248335506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248335506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248335506">(Aug 04 2021 at 11:02)</a>:</h4>
<p>I think a big argument for a constructive <code>finset</code> is that you can actually compute with it.  You can prove equalities between finsets using <code>dec_trivial</code>, you can print them in the VM, etc.</p>
<p>It is much harder to compute with (the roption version of) enat.  Almost no property of enats is decidable: equality is not decidable, order is not decidable.  So no <code>dec_trivial</code>.  Printing an enat to a string is of course not computable either.</p>



<a name="248340037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248340037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248340037">(Aug 04 2021 at 11:57)</a>:</h4>
<p>I still think <code>roption</code> is the more mathematically natural choice given its topology, but I understand the arguments in favor of option, and the equation compiler in particular is something that API lemmas can't paper over. And the duplication with <code>with_top nat</code> is undesirable. So there is probably no point in me blocking this on purist grounds when it isn't actually helping anyone.</p>
<p>To the extent that the <code>option</code> / <code>roption</code> distinction has been hidden behind an API, it should not be that bad to refactor, although some care (a typeclass?) will be needed to ensure that multiplicity on int comes out computable (which is useful for <code>dec_trivial</code>).</p>



<a name="248341567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/with_top%2C%20enat%2C%20and%20with_zero/near/248341567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/with_top.2C.20enat.2C.20and.20with_zero.html#248341567">(Aug 04 2021 at 12:15)</a>:</h4>
<p>(deleted)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>