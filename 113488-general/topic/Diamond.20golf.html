---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Diamond.20golf.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html">Diamond golf</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="220408474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220408474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220408474">(Dec 18 2020 at 18:09)</a>:</h4>
<p>Can anyone suggest a shorter proof for this lemma (to qualify you have to be using mathlib@775edc615ecec631d65b6180dbcc7bc26c3abc26 or newer):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.tensor_product</span>

<span class="kd">theorem</span> <span class="n">smul_tmul'_int</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">N</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">N</span><span class="o">]</span>
  <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">N</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="n">m</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">N</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">r</span> <span class="bp">•</span> <span class="n">m</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">←</span><span class="n">gsmul_eq_smul</span><span class="o">],</span>
  <span class="n">induction</span> <span class="n">r</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">gsmul_of_nat</span><span class="o">,</span> <span class="bp">←</span><span class="n">nat.smul_def</span><span class="o">],</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">subsingleton.elim</span> <span class="n">add_comm_monoid.nat_semimodule</span> <span class="n">tensor_product.semimodule'</span><span class="o">,</span>
    <span class="n">convert</span> <span class="n">smul_tmul'</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">refl</span><span class="o">,</span>
    <span class="n">repeat</span> <span class="o">{</span><span class="n">apply_instance</span> <span class="o">},</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">gsmul_neg_succ_of_nat</span><span class="o">,</span> <span class="bp">←</span><span class="n">nat.smul_def</span><span class="o">,</span> <span class="n">neg_tmul</span><span class="o">,</span> <span class="n">tmul_neg</span><span class="o">],</span>
    <span class="n">rw</span> <span class="n">neg_inj</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">subsingleton.elim</span> <span class="n">add_comm_monoid.nat_semimodule</span> <span class="n">tensor_product.semimodule'</span><span class="o">,</span>
    <span class="n">convert</span> <span class="n">smul_tmul'</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">refl</span><span class="o">,</span>
    <span class="n">repeat</span> <span class="o">{</span><span class="n">apply_instance</span> <span class="o">},</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220410561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220410561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220410561">(Dec 18 2020 at 18:27)</a>:</h4>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>$ git checkout 775edc615ecec631d65b6180dbcc7bc26c3abc26
fatal: reference is not a tree: 775edc615ecec631d65b6180dbcc7bc26c3abc26
</code></pre></div>
<p>and on master I get an unexpected token at <code>M ⊗[R] N</code> in the statement.</p>



<a name="220410659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220410659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220410659">(Dec 18 2020 at 18:28)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/commit/775edc615ecec631d65b6180dbcc7bc26c3abc26">https://github.com/leanprover-community/mathlib/commit/775edc615ecec631d65b6180dbcc7bc26c3abc26</a></p>



<a name="220410789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220410789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220410789">(Dec 18 2020 at 18:29)</a>:</h4>
<p>Added the missing <code>open_locale</code></p>



<a name="220411390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220411390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220411390">(Dec 18 2020 at 18:34)</a>:</h4>
<p>The proof for that lemma was easier before that commit, but on the other hand the proof for <code>nat</code> was harder.</p>



<a name="220411613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220411613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220411613">(Dec 18 2020 at 18:36)</a>:</h4>
<p>aah, I was a few hours out of date :-)</p>



<a name="220412029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220412029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220412029">(Dec 18 2020 at 18:40)</a>:</h4>
<p>Still doesn't compile for me.</p>



<a name="220412058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220412058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220412058">(Dec 18 2020 at 18:40)</a>:</h4>
<p><code>open tensor_product</code>?</p>



<a name="220412286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220412286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220412286">(Dec 18 2020 at 18:42)</a>:</h4>
<p>I wonder if either there's a clever simp lemma that could be made to solve this type of thing, or whether it would need to be a tactic.</p>



<a name="220412662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220412662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220412662">(Dec 18 2020 at 18:45)</a>:</h4>
<p>why doesn't <a href="https://leanprover-community.github.io/mathlib_docs/find/tensor_product.smul_tmul">docs#tensor_product.smul_tmul</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/tensor_product.tmul_smul">docs#tensor_product.tmul_smul</a> take care of this?</p>



<a name="220413008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413008">(Dec 18 2020 at 18:49)</a>:</h4>
<p>Because there is no Z-module instance for <code>comm_semiring R</code> provided in that file</p>



<a name="220413028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413028">(Dec 18 2020 at 18:49)</a>:</h4>
<p>Oh I see.</p>



<a name="220413054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413054">(Dec 18 2020 at 18:49)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">smul_tmul'_int</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">N</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">N</span><span class="o">]</span>
  <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">N</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="n">m</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">N</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">r</span> <span class="bp">•</span> <span class="n">m</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">int.induction_on</span> <span class="n">r</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">add_smul</span><span class="o">,</span> <span class="n">hi</span><span class="o">,</span> <span class="n">add_tmul</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">add_smul</span><span class="o">,</span> <span class="n">hi</span><span class="o">,</span> <span class="n">neg_tmul</span><span class="o">,</span> <span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="n">add_tmul</span><span class="o">],</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220413055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413055">(Dec 18 2020 at 18:49)</a>:</h4>
<p>Adam, in master there is now an instance for <code>comm_ring R</code> though, and those lemmas do work</p>



<a name="220413330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413330">(Dec 18 2020 at 18:52)</a>:</h4>
<p>Do we have the construction which "ringifies" a semiring?</p>



<a name="220413362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413362">(Dec 18 2020 at 18:52)</a>:</h4>
<p>Is there one?</p>



<a name="220413388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413388">(Dec 18 2020 at 18:52)</a>:</h4>
<p>Sure, formally add all negations</p>



<a name="220413419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413419">(Dec 18 2020 at 18:52)</a>:</h4>
<p>You might get the trivial ring but it still works.</p>



<a name="220413469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413469">(Dec 18 2020 at 18:53)</a>:</h4>
<p>E.g. the ringification of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">\mathbb{N}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">N</span></span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">\mathbb{Z}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">Z</span></span></span></span></span>.</p>



<a name="220413619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413619">(Dec 18 2020 at 18:54)</a>:</h4>
<p>Oh right, I thought you mean a mechanism to create a ring structure on N, not a new type that has the structure</p>



<a name="220413745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413745">(Dec 18 2020 at 18:55)</a>:</h4>
<p>My point is the an additive commutative group which is a semimodule over a semiring turns out to be a module over the ringification</p>



<a name="220413773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413773">(Dec 18 2020 at 18:55)</a>:</h4>
<p>Yeah, I see that now</p>



<a name="220413850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413850">(Dec 18 2020 at 18:56)</a>:</h4>
<p>So if we had this construction and some simp lemma that takes tmul over the semiring to tmul over the ringification, then those two lemmas would prove your result immediately</p>



<a name="220413878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413878">(Dec 18 2020 at 18:56)</a>:</h4>
<p>my original plan was to create a new <code>tensor_product.smul_compatible</code> type-class, and add <code>is_scalar_tower.to_smul_compatible</code> and <code>int.smul_compatible</code> so that the <code>smul_tmul'</code> lemma automatically works for int in this case</p>



<a name="220413991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220413991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220413991">(Dec 18 2020 at 18:57)</a>:</h4>
<p>But maybe there's a better generalization of <code>is_scalar_tower</code> to make this case work</p>



<a name="220414042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414042">(Dec 18 2020 at 18:57)</a>:</h4>
<p>Kevin's proof is very special for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Z</mi></mrow><annotation encoding="application/x-tex">\mathbb{Z}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord"><span class="mord mathbb">Z</span></span></span></span></span>, it seems.</p>



<a name="220414049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414049">(Dec 18 2020 at 18:58)</a>:</h4>
<p>Right</p>



<a name="220414090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414090">(Dec 18 2020 at 18:58)</a>:</h4>
<p>Hence my plan to create a typeclass to hook the proof into</p>



<a name="220414129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414129">(Dec 18 2020 at 18:58)</a>:</h4>
<p>Which means that the user doesn't have to care that the proof is special, they just apply the <code>smul_tmul</code> lemma and it works</p>



<a name="220414216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414216">(Dec 18 2020 at 18:59)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.tensor_product</span>

<span class="n">open_locale</span> <span class="n">tensor_product</span>

<span class="kn">open</span> <span class="n">tensor_product</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">N</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">semimodule</span> <span class="n">R</span> <span class="n">N</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">sub_tmul</span> <span class="o">(</span><span class="n">m₁</span> <span class="n">m₂</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">N</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">m₁</span> <span class="bp">-</span> <span class="n">m₂</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">m₁</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">m₂</span> <span class="bp">⊗ₜ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">sub_eq_add_neg</span><span class="o">,</span> <span class="n">add_tmul</span><span class="o">,</span> <span class="n">neg_tmul</span><span class="o">]</span>

<span class="kd">theorem</span> <span class="n">smul_tmul'_int</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">N</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span> <span class="bp">•</span> <span class="o">(</span><span class="n">m</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">N</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">r</span> <span class="bp">•</span> <span class="n">m</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">int.induction_on</span> <span class="n">r</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">add_smul</span><span class="o">,</span> <span class="n">hi</span><span class="o">,</span> <span class="n">add_tmul</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">sub_smul</span><span class="o">,</span> <span class="n">hi</span><span class="o">,</span> <span class="n">sub_tmul</span><span class="o">]</span> <span class="o">},</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220414289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414289">(Dec 18 2020 at 18:59)</a>:</h4>
<p><code>sub_tmul</code> is missing for some reason.</p>



<a name="220414514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220414514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220414514">(Dec 18 2020 at 19:01)</a>:</h4>
<p>I suspect a lot of <code>sub</code> lemmas were missing because we could get away with definitional equality to add before</p>



<a name="220416381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220416381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220416381">(Dec 18 2020 at 19:16)</a>:</h4>
<p>My lean is stuck on orange bars again, but I think <code>sub_tmul</code> golfs to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">sub_tmul</span> <span class="o">(</span><span class="n">m₁</span> <span class="n">m₂</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">N</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">m₁</span> <span class="bp">-</span> <span class="n">m₂</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">m₁</span> <span class="bp">⊗ₜ</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">m₂</span> <span class="bp">⊗ₜ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">n</span> <span class="o">:=</span>
<span class="o">((</span><span class="n">mk</span> <span class="n">R</span> <span class="n">M</span> <span class="n">N</span><span class="o">)</span><span class="bp">.</span><span class="n">flip</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">map_sub</span> <span class="n">_</span> <span class="n">_</span>
</code></pre></div>



<a name="220418443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220418443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220418443">(Dec 18 2020 at 19:35)</a>:</h4>
<p>Thanks Kevin, I've added the missing <code>sub</code> lemmas in <a href="https://github.com/leanprover-community/mathlib/issues/5428">#5428</a></p>



<a name="220428532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220428532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220428532">(Dec 18 2020 at 21:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Diamond.20golf/near/220413878">said</a>:</p>
<blockquote>
<p>my original plan was to create a new <code>tensor_product.smul_compatible</code> type-class, and add <code>is_scalar_tower.to_smul_compatible</code> and <code>int.smul_compatible</code> so that the <code>smul_tmul'</code> lemma automatically works for int in this case</p>
</blockquote>
<p>And <a href="https://github.com/leanprover-community/mathlib/issues/5430">#5430</a> contains a sketch of this idea, although I wonder if it makes sense to try to generalize it to also solve:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- with a suitable typeclass, this could be solved with `apply map_smul`</span>
<span class="kd">lemma</span> <span class="n">map_smul_int</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">z</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span> <span class="n">l</span> <span class="o">(</span><span class="n">z</span> <span class="bp">•</span> <span class="n">m</span><span class="o">)</span> <span class="bp">=</span> <span class="n">z</span> <span class="bp">•</span> <span class="n">l</span> <span class="n">m</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">z</span> <span class="n">using</span> <span class="n">int.induction_on</span> <span class="k">with</span> <span class="n">r</span> <span class="n">ih</span> <span class="n">r</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="o">[</span><span class="n">add_smul</span><span class="o">]</span> <span class="n">using</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="o">[</span><span class="n">sub_smul</span><span class="o">]</span> <span class="n">using</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220787213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/220787213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#220787213">(Dec 23 2020 at 13:13)</a>:</h4>
<p>I've updated <a href="https://github.com/leanprover-community/mathlib/issues/5430">#5430</a> to make the above provable with <code>linear_map.map_smul_of_tower</code>, would appreciate if someone could take a look</p>



<a name="221063079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20golf/near/221063079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20golf.html#221063079">(Dec 28 2020 at 14:12)</a>:</h4>
<p>I also found that I could make a lot of diamond pain go away by making the <code>is_scalar_tower \N</code> instances not depend on a specific instance of <code>has_scalar</code>: <a href="https://github.com/leanprover-community/mathlib/issues/5509">#5509</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>