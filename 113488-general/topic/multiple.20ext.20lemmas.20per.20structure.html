---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html">multiple ext lemmas per structure</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197442322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197442322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197442322">(May 13 2020 at 16:54)</a>:</h4>
<p>I'm currently fixing some horrible performance problems in the <code>ext</code> tactic.  (It takes a few seconds after <code>import all</code>.)  Some parts of the code support more than one extensionality lemma per structure.  Does anybody use this / want this / have any idea what this is about?</p>



<a name="197442387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197442387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197442387">(May 13 2020 at 16:55)</a>:</h4>
<p>how does that even work?</p>



<a name="197442867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197442867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197442867">(May 13 2020 at 16:57)</a>:</h4>
<p><span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="197442926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197442926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197442926">(May 13 2020 at 16:58)</a>:</h4>
<p>I just noticed that the ext attribute stores a list of names.</p>



<a name="197443019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197443019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197443019">(May 13 2020 at 16:58)</a>:</h4>
<p>I guess we don't want/need this. Do you have examples?</p>



<a name="197443072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197443072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197443072">(May 13 2020 at 16:58)</a>:</h4>
<p>I'm pretty sure we don't because every lemma but the last is discarded.</p>



<a name="197443215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197443215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197443215">(May 13 2020 at 16:59)</a>:</h4>
<p>There are examples in the doc comment on <code>extensional_attribute</code></p>



<a name="197443293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197443293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197443293">(May 13 2020 at 17:00)</a>:</h4>
<p>you can mark one lemma as the extensionality for two types</p>



<a name="197443320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197443320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197443320">(May 13 2020 at 17:00)</a>:</h4>
<p>that are presumably defeq</p>



<a name="197445140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197445140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197445140">(May 13 2020 at 17:11)</a>:</h4>
<p>Is this related to the several lines of <code>bit1 (bit0 (bit0 ...))</code> I get when <code>#print</code>ing an extensionality lemma?</p>



<a name="197446289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197446289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197446289">(May 13 2020 at 17:18)</a>:</h4>
<p>oh wow that looks pretty terrible</p>



<a name="197446343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197446343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197446343">(May 13 2020 at 17:19)</a>:</h4>
<p><code>@[ext]</code> stores an <code>expr</code>, and <code>#print</code> apparently doesn't use the proper pp settings to show that expr</p>



<a name="197446499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197446499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197446499">(May 13 2020 at 17:20)</a>:</h4>
<p>The whole <code>user_attribute</code> param story is pretty bad.  NEVER USE <code>user_attribute.get_param</code>.  This will call <code>eval_expr</code>.  Calling <code>eval_expr</code> coincidentally also disables the attribute cache IIRC.</p>



<a name="197446570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197446570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197446570">(May 13 2020 at 17:20)</a>:</h4>
<p>The parameters are stored as expressions using <code>has_reflect</code> in case it wasn't clear.</p>



<a name="197446731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197446731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197446731">(May 13 2020 at 17:21)</a>:</h4>
<p>how are you supposed to get the parameter without <code>get_param</code>? It's not passed to <code>after_set</code></p>



<a name="197450016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197450016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197450016">(May 13 2020 at 17:45)</a>:</h4>
<p>Multiple <code>ext</code> lemmas per structure can be useful, e.g., <a href="https://github.com/leanprover-community/mathlib/pull/2670/files#diff-cf5abebacea368c294b6dd8f78d7daccR62">here</a></p>



<a name="197450135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197450135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197450135">(May 13 2020 at 17:46)</a>:</h4>
<p><code>free_monoid.hom_eq</code> is an <code>ext</code> lemma for <code>free_monoid α →* M</code>.</p>



<a name="197451105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197451105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197451105">(May 13 2020 at 17:52)</a>:</h4>
<p>And it makes sense to have similar lemmas for other structures with relatively small generating sets.</p>



<a name="197451167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197451167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197451167">(May 13 2020 at 17:53)</a>:</h4>
<p>E.g., two <code>nat →+ M</code> are equal if they agree at <code>1</code>.</p>



<a name="197451574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197451574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197451574">(May 13 2020 at 17:56)</a>:</h4>
<p>Yup, that's a good example</p>



<a name="197451693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197451693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197451693">(May 13 2020 at 17:56)</a>:</h4>
<p>But it doesn't work at the moment, right?  We can do that as a follow-up PR.</p>



<a name="197451761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197451761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197451761">(May 13 2020 at 17:57)</a>:</h4>
<p>This needs some kind of discrimination tree lookup</p>



<a name="197456224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197456224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197456224">(May 13 2020 at 18:31)</a>:</h4>
<p>I added <code>@[ext]</code> to <code>free_monoid.hom_eq</code>, and <code>mathlib</code> still builds.</p>



<a name="197456405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197456405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197456405">(May 13 2020 at 18:32)</a>:</h4>
<p>Probably it tries this lemma first for each <code>monoid_hom</code>, then falls back to <code>monoid_hom.ext</code>.</p>



<a name="197458006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiple%20ext%20lemmas%20per%20structure/near/197458006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/multiple.20ext.20lemmas.20per.20structure.html#197458006">(May 13 2020 at 18:43)</a>:</h4>
<p>Even better, it first tries the named extensionality lemma, and if that fails, it tries all of them..</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>