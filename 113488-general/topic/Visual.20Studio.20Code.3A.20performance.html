---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html">Visual Studio Code: performance</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="229417173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417173">(Mar 09 2021 at 03:47)</a>:</h4>
<p>Hi,<br>
I'm using Lean 3 in Visual Studio Code on a 2015 MacBook and find that it can get very slow when checking certain files. The only trick I found that helps a little is to set Lean to "checking visible lines". It helps sometimes but for certain files it still takes minutes until I see the proof state appear...  It also slows down my computer as a whole and I need to quit Visual Studio Code sometimes when having it in the background and navigating in Chrome. I was wondering if there is anything I can do to make it faster.<br>
Thanks!</p>



<a name="229417455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417455">(Mar 09 2021 at 03:50)</a>:</h4>
<p>If you're editing mathlib files that are far apart in the import chain, this is expected, as the Lean server has to recompile all files that depend on any edited file. What files are you editing?</p>



<a name="229417582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417582">(Mar 09 2021 at 03:52)</a>:</h4>
<p>I created a short file in analysis/complex that imports <code>analysis.complex.basic</code>.</p>



<a name="229417596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417596">(Mar 09 2021 at 03:52)</a>:</h4>
<p>Did you edit any files that are imported by that file?</p>



<a name="229417625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417625">(Mar 09 2021 at 03:53)</a>:</h4>
<p>no I didn't..</p>



<a name="229417628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417628">(Mar 09 2021 at 03:53)</a>:</h4>
<p>If not, then you can try restarting the Lean server in VS Code: hit cmd+shift+P and then search for "Lean: restart".</p>



<a name="229417686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417686">(Mar 09 2021 at 03:54)</a>:</h4>
<p>I think sometimes opening lots of files can cause Lean to think that something has been edited.</p>



<a name="229417757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417757">(Mar 09 2021 at 03:56)</a>:</h4>
<p>Oh I see. So is it better then to only keep one file open at a time?</p>



<a name="229417884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417884">(Mar 09 2021 at 03:58)</a>:</h4>
<p>It usually doesn't matter too much, but I think I usually don't have more than 5 Lean files open at a time either. If you can reliably reproduce the issue, let us know; maybe there's a bug somewhere that can be fixed.</p>



<a name="229417988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229417988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229417988">(Mar 09 2021 at 03:59)</a>:</h4>
<p>Ok for now (after restarting the Lean server) it's taking forever to load...</p>



<a name="229418110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418110">(Mar 09 2021 at 04:00)</a>:</h4>
<p>In terms of the "checking ..." settings, is there one that is preferable for performance? I guessed that "checking visible lines" might be the one taking the least time.</p>



<a name="229418203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418203">(Mar 09 2021 at 04:01)</a>:</h4>
<p>I suspect some Lean files were touched or changed inadvertently. You can try stashing your work with <code>git stash</code> and then running <code>leanproject get-cache</code> to reset the compiled <code>olean</code> files. (And then <code>git stash pop</code> afterwards). If that doesn't help you might have to build mathlib yourself with <code>leanproject build</code>.</p>



<a name="229418477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418477">(Mar 09 2021 at 04:04)</a>:</h4>
<p>You can play around with the various checking ... settings but I don't think they'll solve your issue (to be honest, I don't remember what the differences are between them). If you have the correct compiled "olean" files for mathlib, it should take only a few seconds to open any file in mathlib. Now, your file itself might have some very slow proofs, but presumably that's not what you're seeing.</p>



<a name="229418640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418640">(Mar 09 2021 at 04:07)</a>:</h4>
<p>Ok good to know. It definitely isn't taking just a few seconds for me... even after doing <code>leanproject get-cache</code></p>



<a name="229418731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418731">(Mar 09 2021 at 04:08)</a>:</h4>
<p>Out of curiosity, what does <code>git status</code> say after you pop your changes off the stash?</p>



<a name="229418811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418811">(Mar 09 2021 at 04:09)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">On</span> <span class="n">branch</span> <span class="n">master</span>
<span class="n">Your</span> <span class="n">branch</span> <span class="n">is</span> <span class="n">behind</span> <span class="bp">'</span><span class="n">origin</span><span class="bp">/</span><span class="n">master'</span> <span class="kd">by</span> <span class="mi">12</span> <span class="n">commits</span><span class="o">,</span> <span class="n">and</span> <span class="n">can</span> <span class="n">be</span> <span class="n">fast</span><span class="bp">-</span><span class="n">forwarded.</span>
  <span class="o">(</span><span class="n">use</span> <span class="s2">"git pull"</span> <span class="n">to</span> <span class="n">update</span> <span class="n">your</span> <span class="kn">local</span> <span class="n">branch</span><span class="o">)</span>

<span class="n">Untracked</span> <span class="n">files</span><span class="o">:</span>
  <span class="o">(</span><span class="n">use</span> <span class="s2">"git add &lt;file&gt;..."</span> <span class="n">to</span> <span class="kn">include</span> <span class="k">in</span> <span class="n">what</span> <span class="n">will</span> <span class="n">be</span> <span class="n">committed</span><span class="o">)</span>

        <span class="n">src</span><span class="bp">/</span><span class="n">analysis</span><span class="bp">/</span><span class="n">complex</span><span class="bp">/</span><span class="n">isometry.lean</span>

<span class="n">nothing</span> <span class="n">added</span> <span class="n">to</span> <span class="n">commit</span> <span class="n">but</span> <span class="n">untracked</span> <span class="n">files</span> <span class="n">present</span> <span class="o">(</span><span class="n">use</span> <span class="s2">"git add"</span> <span class="n">to</span> <span class="n">track</span><span class="o">)</span>
</code></pre></div>



<a name="229418815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418815">(Mar 09 2021 at 04:09)</a>:</h4>
<p>(Also, after you run <code>leanproject get-cache</code> don't forget to restart the Lean server).</p>



<a name="229418961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229418961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229418961">(Mar 09 2021 at 04:11)</a>:</h4>
<p>If it's still slow after that, then I wonder if a file in the core Lean library got modified somehow.</p>



<a name="229419023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419023">(Mar 09 2021 at 04:11)</a>:</h4>
<p>Oh it's so much faster now!</p>



<a name="229419032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419032">(Mar 09 2021 at 04:11)</a>:</h4>
<p>I hadn't restarted the server after the <code>leanproject get-cache</code></p>



<a name="229419186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419186">(Mar 09 2021 at 04:13)</a>:</h4>
<p>OK, great! I think we should add some documentation suggesting to restart the server after running <code>leanproject</code>, as it seems to be a common issue.</p>



<a name="229419193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419193">(Mar 09 2021 at 04:13)</a>:</h4>
<p>Thanks so much! I'm still new to Lean so I didn't know about <code>leanproject get-cache</code>.. Thanks for letting me know about it</p>



<a name="229419286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419286">(Mar 09 2021 at 04:14)</a>:</h4>
<p>Yeah, there's some documentation for <code>leanproject</code> <a href="https://leanprover-community.github.io/leanproject.html">here</a>: it suggests running <code>leanproject get-mathlib-cache</code> (which is equivalent, when run in mathlib itself).</p>



<a name="229419368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419368">(Mar 09 2021 at 04:15)</a>:</h4>
<p>Thanks for the link... maybe I should have gone through that doc before getting too deep into Lean.. (I guess I was too impatient to start writing some Lean code!)</p>



<a name="229419444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/229419444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#229419444">(Mar 09 2021 at 04:16)</a>:</h4>
<p>No problem and good luck! Feel free to ask again if you have more questions.</p>



<a name="240271900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/240271900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#240271900">(May 26 2021 at 02:06)</a>:</h4>
<p>Hi, I just pulled <code>master</code> and ran</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span>
</code></pre></div>
<p>and I got:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Looking</span> <span class="n">for</span> <span class="kn">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">remote</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Trying</span> <span class="n">to</span> <span class="n">download</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">oleanstorage.azureedge.net</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="mi">14</span><span class="n">d71874fa87c8cf108e6f1441fb963c5363522a.tar.xz</span> <span class="n">to</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">fss</span><span class="bp">/.</span><span class="n">mathlib</span><span class="bp">/</span><span class="mi">14</span><span class="n">d71874fa87c8cf108e6f1441fb963c5363522a.tar.xz</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">fetch</span> <span class="n">cached</span> <span class="n">oleans</span>
</code></pre></div>
<p>am I missing something for it to be able to fetch the cached oleans?<br>
Thanks!</p>



<a name="240272502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/240272502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#240272502">(May 26 2021 at 02:17)</a>:</h4>
<p>What does <code>git status</code> say? <code>14d71874fa</code> is not a commit in our mathlib repo as far as I can tell.</p>



<a name="240272781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/240272781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#240272781">(May 26 2021 at 02:22)</a>:</h4>
<p>oh my bad I switched to my working branch before running <code>$ leanproject get-cache</code></p>



<a name="240273451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Visual%20Studio%20Code%3A%20performance/near/240273451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> François Sunatori <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Visual.20Studio.20Code.3A.20performance.html#240273451">(May 26 2021 at 02:35)</a>:</h4>
<p>thanks for the hint :)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>