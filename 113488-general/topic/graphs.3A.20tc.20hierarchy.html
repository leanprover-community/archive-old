---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html">graphs: tc hierarchy</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="199002259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199002259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199002259">(May 28 2020 at 09:54)</a>:</h4>
<p><span class="user-mention" data-user-id="111080">@Floris van Doorn</span> you had some scripts that generated graphs of the type class hierarchy. Is that right? Do you still have them somewhere?</p>



<a name="199002286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199002286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199002286">(May 28 2020 at 09:54)</a>:</h4>
<p>If so, we can probably teach them to output json.</p>



<a name="199114759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199114759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199114759">(May 29 2020 at 05:13)</a>:</h4>
<p>Yes, and I put it here: <a href="https://gist.github.com/fpvandoorn/4d4c52322d7eb661e5154f9a732754d4">https://gist.github.com/fpvandoorn/4d4c52322d7eb661e5154f9a732754d4</a></p>
<p>It currently produces output like this:</p>
<div class="codehilite"><pre><span></span><code>partial_order:
  File: C:\Users\Floris\.elan\toolchains\leanprover-community-lean-3.14.0\lib\lean\library\init\algebra\order.lean
  Line: 26
  Type: class
semilattice_inf_bot_of_bounded_lattice:
  File: d:\projects\mathlib\src\order\bounded_lattice.lean
  Line: 250
  Type: instance
  Source: bounded_lattice
  Target: semilattice_inf_bot
group.to_has_inv:
  File: d:\projects\mathlib\src\algebra\group\basic.lean
  Line: 219
  Type: instance
  Source: group
  Target: has_inv
order_bot:
  File: d:\projects\mathlib\src\order\bounded_lattice.lean
  Line: 94
  Type: class
[...]
</code></pre></div>


<p>It shouldn't be hard to modify the output.</p>
<p>It  currently mostly prints "the algebraic hierarchy". This means instances and classes that have at most 1 argument that is not a type-class argument (within square brackets), and the instances can only be forgetful instances (where the conclusion is a class applied to a variable).</p>



<a name="199114774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199114774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199114774">(May 29 2020 at 05:13)</a>:</h4>
<p>What is the output you want, and how do you want to use it? Automatically generating a graph would be nice.</p>



<a name="199118095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199118095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199118095">(May 29 2020 at 06:37)</a>:</h4>
<p>The idea would be to automatically generated an interactive graph using d3.js</p>



<a name="199118115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199118115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199118115">(May 29 2020 at 06:37)</a>:</h4>
<p>So the output should probably be some sort of json, although Patrick also linked to a package that can convert <code>.dot</code> files into d3 graphs.</p>



<a name="199346532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199346532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199346532">(Jun 01 2020 at 08:29)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> The output of the script by Floris (see above) is yaml... is that ok for you? I guess we can easily postprocess that into suitable json, right?</p>



<a name="199379597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199379597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199379597">(Jun 01 2020 at 15:02)</a>:</h4>
<p>Yes, it shouldn't be too hard to postprocess. I bet the script could be modified to output JSON pretty easily too though.</p>



<a name="199383192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199383192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199383192">(Jun 01 2020 at 15:30)</a>:</h4>
<p>Right, that's what I thought. What kind of JSON format are we looking for?</p>



<a name="199385162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199385162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199385162">(Jun 01 2020 at 15:47)</a>:</h4>
<p>For experimentation we can just go with whatever's quickest to implement.</p>



<a name="199388264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199388264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199388264">(Jun 01 2020 at 16:10)</a>:</h4>
<p>Should it look like</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span> <span class="err">#</span> <span class="err">a</span> <span class="err">list</span> <span class="err">of</span> <span class="err">edges</span>
<span class="p">{</span> <span class="err">source</span> <span class="err">:</span> <span class="err">&#39;group&#39;,</span> <span class="err">target:</span> <span class="err">&#39;monoid&#39;</span> <span class="p">},</span>
<span class="p">{</span> <span class="err">blabbla</span> <span class="p">},</span>
<span class="p">]</span>
</code></pre></div>



<a name="199388741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199388741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199388741">(Jun 01 2020 at 16:14)</a>:</h4>
<p>Yeah, I think that would work fine (modulo correct JSON syntax <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span> )</p>



<a name="199390009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199390009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199390009">(Jun 01 2020 at 16:24)</a>:</h4>
<p>/me doesn't really know json</p>



<a name="199390031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199390031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199390031">(Jun 01 2020 at 16:24)</a>:</h4>
<p>I'll try to hack the output into that form once my kids are in bed</p>



<a name="199390785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199390785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199390785">(Jun 01 2020 at 16:30)</a>:</h4>
<p>No worries, I probably won't have time to play around with graphs until the weekend, and I can probably quickly do this myself then.</p>



<a name="199404612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199404612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199404612">(Jun 01 2020 at 18:22)</a>:</h4>
<p>There's also the question what you want the content of the graph to be exactly. The algebraic hierarchy? All type-classes?<br>
I think currently my script gives you a bit more than the algebraic hierarchy. It gives you all "unary type-classes" but I think there are also some typeclasses with argument <code>m : Type u -&gt; Type u</code> which you might want to remove.</p>



<a name="199409243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199409243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199409243">(Jun 01 2020 at 19:03)</a>:</h4>
<p>I was thinking initially just all type classes...</p>



<a name="199409267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199409267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199409267">(Jun 01 2020 at 19:03)</a>:</h4>
<p>But maybe you get lots of junk then?</p>



<a name="199411312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199411312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199411312">(Jun 01 2020 at 19:19)</a>:</h4>
<p>Well, if your idea is to get a graph similar to the one in the mathlib paper, then I recommend just using the algebraic hierarchy + "forgetful" instances. For other classes/instances it's a lot less clear what arrows to draw. <br>
What arrows represent <code>group A -&gt; group B -&gt; group (A x B)</code> or <code>decidable_eq A -&gt; decidable_eq (list A)</code> or <code>decidable_eq real</code>?</p>



<a name="199411494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/199411494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#199411494">(Jun 01 2020 at 19:21)</a>:</h4>
<p>Hmmm, I hadn't really thought about the edges, I think. Your suggestion sounds good to me.</p>



<a name="203021744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203021744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203021744">(Jul 06 2020 at 18:04)</a>:</h4>
<p>I'm going to try to generate an update version of this graph for the workshop</p>



<a name="203021864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203021864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203021864">(Jul 06 2020 at 18:05)</a>:</h4>
<p>Now it would be great if we could reuse some sphere eversion machinery (<span class="user-mention" data-user-id="110031">@Patrick Massot</span>) to create a clickable version that takes you to the corresponding page in the docs.</p>



<a name="203022417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203022417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203022417">(Jul 06 2020 at 18:10)</a>:</h4>
<p>That part is very easy. The tricky part is to have a meaningful manageable graph to display.</p>



<a name="203023482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203023482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203023482">(Jul 06 2020 at 18:21)</a>:</h4>
<p>I just ran the script by Floris. It generates a graph with 120 edges.</p>



<a name="203023598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203023598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203023598">(Jul 06 2020 at 18:22)</a>:</h4>
<p>Oops, that's wrong</p>



<a name="203023881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203023881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203023881">(Jul 06 2020 at 18:25)</a>:</h4>
<p>My new count is about 520 nodes and 400 edges. Which still seems weird.</p>



<a name="203112225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112225">(Jul 07 2020 at 14:49)</a>:</h4>
<p>I'm trying to make the script by Floris output two JSON lists, one with nodes, and one with edges. But I'm bad at <code>meta</code> stuff. Here is what I have so far:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">defs</span>

<span class="kn">open</span> <span class="n">tactic</span> <span class="n">declaration</span> <span class="n">environment</span> <span class="n">native</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">option</span> <span class="n">pos</span><span class="o">)</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">p</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">some</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">x</span><span class="bp">.</span><span class="n">line</span>
<span class="bp">|</span> <span class="bp">_</span>      <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">file_to_topic</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">split_on</span> <span class="err">&#39;</span><span class="bp">/</span><span class="err">&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">head</span>

<span class="kn">structure</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">file</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">line</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">topic</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span> <span class="n">file_to_topic</span> <span class="n">file</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">node</span> <span class="kn">extends</span> <span class="n">item</span><span class="bp">.</span>

<span class="kn">namespace</span> <span class="n">node</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">node</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">n</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">node</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">node</span>

<span class="kn">structure</span> <span class="n">edge</span> <span class="kn">extends</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">source</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">target</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">edge</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">edge</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">e</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;source : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">source</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;target : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">target</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">edge</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">edge</span>

<span class="c">/-</span><span class="cm"> parses information about `decl` if it is an instance or a class. -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">parse_decl</span> <span class="o">(</span><span class="n">env</span> <span class="o">:</span> <span class="n">environment</span><span class="o">)</span> <span class="o">(</span><span class="n">decl</span> <span class="o">:</span> <span class="n">declaration</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">tactic</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">node</span> <span class="err">⊕</span> <span class="n">edge</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">let</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">decl</span><span class="bp">.</span><span class="n">to_name</span> <span class="k">in</span>
<span class="n">do</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">)</span><span class="bp">.</span><span class="n">is_some</span>
    <span class="k">then</span> <span class="n">do</span>
      <span class="n">olean_file</span> <span class="err">←</span> <span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">,</span>
      <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">item</span> <span class="o">:=</span>
      <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">name</span><span class="o">,</span>
        <span class="n">file</span> <span class="o">:=</span> <span class="n">olean_file</span><span class="o">,</span>
        <span class="n">line</span> <span class="o">:=</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_pos</span> <span class="n">name</span><span class="o">)</span> <span class="o">},</span>
      <span class="n">is_c</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="n">class</span> <span class="n">name</span><span class="o">,</span>
      <span class="k">if</span> <span class="n">is_c</span><span class="bp">.</span><span class="mi">1</span> <span class="k">then</span>
        <span class="k">let</span> <span class="n">N</span> <span class="o">:</span> <span class="n">node</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">}</span> <span class="k">in</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">N</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span>
      <span class="n">is_i</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="kn">instance</span> <span class="n">name</span><span class="o">,</span>
      <span class="k">if</span> <span class="n">is_i</span><span class="bp">.</span><span class="mi">1</span> <span class="k">then</span> <span class="n">do</span>
        <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">tgt</span><span class="o">)</span> <span class="err">←</span> <span class="n">return</span> <span class="n">decl</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">pi_binders</span><span class="o">,</span>
        <span class="n">guard</span> <span class="o">(</span><span class="n">l</span><span class="bp">.</span><span class="n">tail</span><span class="bp">.</span><span class="n">all</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">b</span><span class="bp">.</span><span class="n">info</span> <span class="bp">=</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">inst_implicit</span><span class="o">),</span>
        <span class="n">guard</span> <span class="o">(</span><span class="n">tgt</span><span class="bp">.</span><span class="n">get_app_args</span><span class="bp">.</span><span class="n">head</span><span class="bp">.</span><span class="n">is_var</span> <span class="bp">&amp;&amp;</span> <span class="n">l</span><span class="bp">.</span><span class="n">ilast</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">get_app_args</span><span class="bp">.</span><span class="n">head</span><span class="bp">.</span><span class="n">is_var</span><span class="o">),</span>
        <span class="k">let</span> <span class="n">src</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">l</span><span class="bp">.</span><span class="n">ilast</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="k">let</span> <span class="n">tgt</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">tgt</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="n">guard</span> <span class="o">(</span><span class="n">src</span> <span class="bp">≠</span> <span class="n">tgt</span><span class="o">),</span>
        <span class="k">let</span> <span class="n">E</span> <span class="o">:</span> <span class="n">edge</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">name</span><span class="o">,</span> <span class="n">source</span> <span class="o">:=</span> <span class="n">src</span><span class="o">,</span> <span class="n">target</span> <span class="o">:=</span> <span class="n">tgt</span><span class="o">,</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">},</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">E</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>
    <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">remove_none</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>            <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">none</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span>   <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">some</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">split_sum</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">α</span> <span class="err">⊕</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">list</span> <span class="n">β</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span>  <span class="o">:=</span> <span class="o">([],</span> <span class="o">[])</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">a</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">((</span><span class="n">a</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">b</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">(</span><span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="n">b</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">))</span>

<span class="c">/-</span><span class="cm">- prints information about unary classes and forgetful instances in the environment.</span>
<span class="cm">  It only prints instances and classes that have at most 1 argument</span>
<span class="cm">  that is not a type-class argument (within square brackets),</span>
<span class="cm">  and the instances can only be forgetful instances</span>
<span class="cm">  (where the conclusion is a class applied to a variable) -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">print_content</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">o</span> <span class="err">←</span> <span class="o">(</span><span class="n">curr_env</span><span class="bp">.</span><span class="n">fold</span> <span class="n">list</span><span class="bp">.</span><span class="n">nil</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span><span class="o">)</span><span class="bp">.</span><span class="n">mmap</span> <span class="o">(</span><span class="n">parse_decl</span> <span class="n">curr_env</span><span class="o">),</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="bp">.</span><span class="n">remove_none</span><span class="bp">.</span><span class="n">split_sum</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">test</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">d</span> <span class="err">←</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">comm_monoid</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">d</span><span class="bp">.</span><span class="n">to_name</span><span class="o">),</span>
   <span class="n">o</span> <span class="err">←</span> <span class="n">parse_decl</span> <span class="n">curr_env</span> <span class="n">d</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="n">run_cmd</span> <span class="n">test</span>

<span class="n">run_cmd</span> <span class="n">print_content</span>
</code></pre></div>



<a name="203112252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112252">(Jul 07 2020 at 14:49)</a>:</h4>
<p>If someone could help, that would be awesome.</p>



<a name="203112468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112468">(Jul 07 2020 at 14:51)</a>:</h4>
<p>The idea is to be able to generate interactive graphs that will link to the correct docs.<br>
We might need to tweak the info that we save in the nodes and edges.<br>
Also, I want items to have a "topic" so that you can easily hide all the nodes that come from the subdirectory <code>src/algebra</code>, and focus on <code>src/topology</code>, etc...</p>



<a name="203112497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112497">(Jul 07 2020 at 14:51)</a>:</h4>
<p>(The full graph will be too large to be useful.)</p>



<a name="203112702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112702">(Jul 07 2020 at 14:53)</a>:</h4>
<p><code>tactic.has_attribute</code> returns a bool and a nat. The bool isn't whether the attribute is there or not, it's whether the attribute is persistent (non-local). <code>has_attribute</code> will fail if the attribute isn't there.</p>



<a name="203112784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112784">(Jul 07 2020 at 14:54)</a>:</h4>
<p>Aha... so what do I do now?</p>



<a name="203112827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112827">(Jul 07 2020 at 14:54)</a>:</h4>
<p>You can use <code>succeeds</code> if you don't actually need the output of <code>has_attribute</code>, which I don't think you do.</p>



<a name="203112829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203112829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203112829">(Jul 07 2020 at 14:54)</a>:</h4>
<p>Is there some sort of <code>success</code> thing? That I should prepend?</p>



<a name="203114623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203114623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203114623">(Jul 07 2020 at 15:06)</a>:</h4>
<p>I now have, but it still doesn't seem to work</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">defs</span>

<span class="kn">open</span> <span class="n">tactic</span> <span class="n">declaration</span> <span class="n">environment</span> <span class="n">native</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">option</span> <span class="n">pos</span><span class="o">)</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">p</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">some</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">x</span><span class="bp">.</span><span class="n">line</span>
<span class="bp">|</span> <span class="bp">_</span>      <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">file_to_topic</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">split_on</span> <span class="err">&#39;</span><span class="bp">/</span><span class="err">&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">head</span>

<span class="kn">structure</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">file</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">line</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">topic</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span> <span class="n">file_to_topic</span> <span class="n">file</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">node</span> <span class="kn">extends</span> <span class="n">item</span><span class="bp">.</span>

<span class="kn">namespace</span> <span class="n">node</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">node</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">n</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">node</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">node</span>

<span class="kn">structure</span> <span class="n">edge</span> <span class="kn">extends</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">source</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">target</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">edge</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">edge</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">e</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;source : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">source</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;target : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">target</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">edge</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">edge</span>

<span class="c">/-</span><span class="cm"> parses information about `decl` if it is an instance or a class. -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">parse_decl</span> <span class="o">(</span><span class="n">env</span> <span class="o">:</span> <span class="n">environment</span><span class="o">)</span> <span class="o">(</span><span class="n">decl</span> <span class="o">:</span> <span class="n">declaration</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">tactic</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">node</span> <span class="err">⊕</span> <span class="n">edge</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">let</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">decl</span><span class="bp">.</span><span class="n">to_name</span> <span class="k">in</span>
<span class="n">do</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">)</span><span class="bp">.</span><span class="n">is_some</span>
    <span class="k">then</span> <span class="n">do</span>
      <span class="n">olean_file</span> <span class="err">←</span> <span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">,</span>
      <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">item</span> <span class="o">:=</span>
      <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">name</span><span class="o">,</span>
        <span class="n">file</span> <span class="o">:=</span> <span class="n">olean_file</span><span class="o">,</span>
        <span class="n">line</span> <span class="o">:=</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_pos</span> <span class="n">name</span><span class="o">)</span> <span class="o">},</span>
      <span class="n">is_c</span> <span class="err">←</span> <span class="n">succeeds</span> <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="n">class</span> <span class="n">name</span><span class="o">),</span>
      <span class="k">if</span> <span class="n">is_c</span> <span class="k">then</span>
        <span class="k">let</span> <span class="n">N</span> <span class="o">:</span> <span class="n">node</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">}</span> <span class="k">in</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">N</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span>
      <span class="n">is_i</span> <span class="err">←</span> <span class="n">succeeds</span> <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="kn">instance</span> <span class="n">name</span><span class="o">),</span>
      <span class="k">if</span> <span class="n">is_i</span> <span class="k">then</span> <span class="n">do</span>
        <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">tgt</span><span class="o">)</span> <span class="err">←</span> <span class="n">return</span> <span class="n">decl</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">pi_binders</span><span class="o">,</span>
        <span class="n">guard</span> <span class="o">(</span><span class="n">l</span><span class="bp">.</span><span class="n">tail</span><span class="bp">.</span><span class="n">all</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">b</span><span class="bp">.</span><span class="n">info</span> <span class="bp">=</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">inst_implicit</span><span class="o">),</span>
        <span class="n">guard</span> <span class="o">(</span><span class="n">tgt</span><span class="bp">.</span><span class="n">get_app_args</span><span class="bp">.</span><span class="n">head</span><span class="bp">.</span><span class="n">is_var</span> <span class="bp">&amp;&amp;</span> <span class="n">l</span><span class="bp">.</span><span class="n">ilast</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">get_app_args</span><span class="bp">.</span><span class="n">head</span><span class="bp">.</span><span class="n">is_var</span><span class="o">),</span>
        <span class="k">let</span> <span class="n">src</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">l</span><span class="bp">.</span><span class="n">ilast</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="k">let</span> <span class="n">tgt</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">tgt</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="n">guard</span> <span class="o">(</span><span class="n">src</span> <span class="bp">≠</span> <span class="n">tgt</span><span class="o">),</span>
        <span class="k">let</span> <span class="n">E</span> <span class="o">:</span> <span class="n">edge</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">source</span> <span class="o">:=</span> <span class="n">src</span><span class="o">,</span> <span class="n">target</span> <span class="o">:=</span> <span class="n">tgt</span><span class="o">,</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">},</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">E</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>
    <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">remove_none</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>            <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">none</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span>   <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">some</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">split_sum</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">α</span> <span class="err">⊕</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">list</span> <span class="n">β</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span>  <span class="o">:=</span> <span class="o">([],</span> <span class="o">[])</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">a</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">((</span><span class="n">a</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">b</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">(</span><span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="n">b</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">))</span>

<span class="c">/-</span><span class="cm">- prints information about unary classes and forgetful instances in the environment.</span>
<span class="cm">  It only prints instances and classes that have at most 1 argument</span>
<span class="cm">  that is not a type-class argument (within square brackets),</span>
<span class="cm">  and the instances can only be forgetful instances</span>
<span class="cm">  (where the conclusion is a class applied to a variable) -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">print_content</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">o</span> <span class="err">←</span> <span class="o">(</span><span class="n">curr_env</span><span class="bp">.</span><span class="n">fold</span> <span class="o">[]</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span><span class="o">)</span><span class="bp">.</span><span class="n">mmap</span> <span class="o">(</span><span class="n">parse_decl</span> <span class="n">curr_env</span><span class="o">),</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="bp">.</span><span class="n">remove_none</span><span class="bp">.</span><span class="n">split_sum</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">test</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">d</span> <span class="err">←</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">comm_monoid</span><span class="bp">.</span><span class="n">to_comm_semigroup</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">d</span><span class="bp">.</span><span class="n">to_name</span><span class="o">),</span>
   <span class="n">o</span> <span class="err">←</span> <span class="n">parse_decl</span> <span class="n">curr_env</span> <span class="n">d</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="n">run_cmd</span> <span class="n">test</span>

<span class="n">run_cmd</span> <span class="n">print_content</span>
</code></pre></div>



<a name="203116361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203116361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203116361">(Jul 07 2020 at 15:18)</a>:</h4>
<p>This bit</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">print_content</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">o</span> <span class="err">←</span> <span class="o">(</span><span class="n">curr_env</span><span class="bp">.</span><span class="n">fold</span> <span class="o">[]</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span><span class="o">)</span><span class="bp">.</span><span class="n">mmap</span> <span class="o">(</span><span class="n">parse_decl</span> <span class="n">curr_env</span><span class="o">),</span>
   <span class="n">skip</span>
</code></pre></div>


<p>gives an error</p>



<a name="203116383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203116383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203116383">(Jul 07 2020 at 15:18)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">failed</span>
<span class="n">state</span><span class="o">:</span>
<span class="err">⊢</span> <span class="n">true</span>
</code></pre></div>



<a name="203116610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203116610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203116610">(Jul 07 2020 at 15:20)</a>:</h4>
<p>It looks like the line <code>guard (tgt.get_app_args.head.is_var &amp;&amp; l.ilast.type.get_app_args.head.is_var),</code> is the one that fails. What is the goal of that check?</p>



<a name="203116838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203116838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203116838">(Jul 07 2020 at 15:21)</a>:</h4>
<p>I don't know... it was there in Floris's version</p>



<a name="203117156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117156">(Jul 07 2020 at 15:23)</a>:</h4>
<p>I'm guessing then that it detects declarations that we don't want to process. In that case, the issue is that the first failing declaration aborts the whole command, so we want to wrap the command in a <code>&lt;|&gt; return none</code>. Let's see if it helps...</p>



<a name="203117183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117183">(Jul 07 2020 at 15:23)</a>:</h4>
<p>Without the guards it works!</p>



<a name="203117200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117200">(Jul 07 2020 at 15:23)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">defs</span>

<span class="kn">open</span> <span class="n">tactic</span> <span class="n">declaration</span> <span class="n">environment</span> <span class="n">native</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">option</span> <span class="n">pos</span><span class="o">)</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">p</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">some</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">x</span><span class="bp">.</span><span class="n">line</span>
<span class="bp">|</span> <span class="bp">_</span>      <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">file_to_topic</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">split_on</span> <span class="err">&#39;</span><span class="bp">/</span><span class="err">&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">head</span>

<span class="kn">structure</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">file</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">line</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">topic</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span> <span class="n">file_to_topic</span> <span class="n">file</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">node</span> <span class="kn">extends</span> <span class="n">item</span><span class="bp">.</span>

<span class="kn">namespace</span> <span class="n">node</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">node</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">n</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">node</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">node</span>

<span class="kn">structure</span> <span class="n">edge</span> <span class="kn">extends</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">source</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">target</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">edge</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">edge</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">e</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;source : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">source</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;target : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">target</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">edge</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">edge</span>

<span class="c">/-</span><span class="cm"> parses information about `decl` if it is an instance or a class. -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">parse_decl</span> <span class="o">(</span><span class="n">env</span> <span class="o">:</span> <span class="n">environment</span><span class="o">)</span> <span class="o">(</span><span class="n">decl</span> <span class="o">:</span> <span class="n">declaration</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">tactic</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">node</span> <span class="err">⊕</span> <span class="n">edge</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">let</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">decl</span><span class="bp">.</span><span class="n">to_name</span> <span class="k">in</span>
<span class="n">do</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">)</span><span class="bp">.</span><span class="n">is_some</span>
    <span class="k">then</span> <span class="n">do</span>
      <span class="n">olean_file</span> <span class="err">←</span> <span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">,</span>
      <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">item</span> <span class="o">:=</span>
      <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">name</span><span class="o">,</span>
        <span class="n">file</span> <span class="o">:=</span> <span class="n">olean_file</span><span class="o">,</span>
        <span class="n">line</span> <span class="o">:=</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_pos</span> <span class="n">name</span><span class="o">)</span> <span class="o">},</span>
      <span class="n">is_c</span> <span class="err">←</span> <span class="n">succeeds</span> <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="n">class</span> <span class="n">name</span><span class="o">),</span>
      <span class="k">if</span> <span class="n">is_c</span> <span class="k">then</span>
        <span class="k">let</span> <span class="n">N</span> <span class="o">:</span> <span class="n">node</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">}</span> <span class="k">in</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">N</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span>
      <span class="n">is_i</span> <span class="err">←</span> <span class="n">succeeds</span> <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="kn">instance</span> <span class="n">name</span><span class="o">),</span>
      <span class="k">if</span> <span class="n">is_i</span> <span class="k">then</span> <span class="n">do</span>
        <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">tgt</span><span class="o">)</span> <span class="err">←</span> <span class="n">return</span> <span class="n">decl</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">pi_binders</span><span class="o">,</span>
        <span class="c1">-- guard (l.tail.all $ λ b, b.info = binder_info.inst_implicit),</span>
        <span class="c1">-- guard (tgt.get_app_args.head.is_var &amp;&amp; l.ilast.type.get_app_args.head.is_var),</span>
        <span class="k">let</span> <span class="n">src</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">l</span><span class="bp">.</span><span class="n">ilast</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="k">let</span> <span class="n">tgt</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">tgt</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="c1">-- guard (src ≠ tgt),</span>
        <span class="k">let</span> <span class="n">E</span> <span class="o">:</span> <span class="n">edge</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">source</span> <span class="o">:=</span> <span class="n">src</span><span class="o">,</span> <span class="n">target</span> <span class="o">:=</span> <span class="n">tgt</span><span class="o">,</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">},</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">E</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>
    <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">remove_none</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>            <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">none</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span>   <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">some</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">split_sum</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">α</span> <span class="err">⊕</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">list</span> <span class="n">β</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span>  <span class="o">:=</span> <span class="o">([],</span> <span class="o">[])</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">a</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">((</span><span class="n">a</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">b</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">(</span><span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="n">b</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">))</span>

<span class="c">/-</span><span class="cm">- prints information about unary classes and forgetful instances in the environment.</span>
<span class="cm">  It only prints instances and classes that have at most 1 argument</span>
<span class="cm">  that is not a type-class argument (within square brackets),</span>
<span class="cm">  and the instances can only be forgetful instances</span>
<span class="cm">  (where the conclusion is a class applied to a variable) -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">print_content</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">o</span> <span class="err">←</span> <span class="o">(</span><span class="n">curr_env</span><span class="bp">.</span><span class="n">fold</span> <span class="o">[]</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span><span class="o">)</span><span class="bp">.</span><span class="n">mmap</span> <span class="o">(</span><span class="n">parse_decl</span> <span class="n">curr_env</span><span class="o">),</span>
   <span class="k">let</span> <span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">es</span><span class="o">)</span> <span class="o">:=</span> <span class="n">o</span><span class="bp">.</span><span class="n">remove_none</span><span class="bp">.</span><span class="n">split_sum</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">ns</span><span class="o">),</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">es</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">test</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">d</span> <span class="err">←</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">comm_monoid</span><span class="bp">.</span><span class="n">to_comm_semigroup</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">d</span><span class="bp">.</span><span class="n">to_name</span><span class="o">),</span>
   <span class="n">o</span> <span class="err">←</span> <span class="n">parse_decl</span> <span class="n">curr_env</span> <span class="n">d</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="n">run_cmd</span> <span class="n">test</span>

<span class="n">run_cmd</span> <span class="n">print_content</span>
</code></pre></div>



<a name="203117314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117314">(Jul 07 2020 at 15:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/113488-general/topic/graphs.3A.20tc.20hierarchy/near/203117156">said</a>:</p>
<blockquote>
<p>I'm guessing then that it detects declarations that we don't want to process. In that case, the issue is that the first failing declaration aborts the whole command, so we want to wrap the command in a <code>&lt;|&gt; return none</code>. Let's see if it helps...</p>
</blockquote>
<p>Ooh, that makes sense. Because I do indeed get garbage output if I simply comment out the guard.</p>



<a name="203117389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117389">(Jul 07 2020 at 15:25)</a>:</h4>
<p>I don't know exactly where to put the <code>&lt;|&gt; return none</code>. Would be delighted if you show me.</p>



<a name="203117461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117461">(Jul 07 2020 at 15:25)</a>:</h4>
<p>I tried to put it around the call to parse_decl:</p>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">print_content</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">o</span> <span class="err">←</span> <span class="o">(</span><span class="n">curr_env</span><span class="bp">.</span><span class="n">fold</span> <span class="o">[]</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span><span class="o">)</span><span class="bp">.</span><span class="n">mmap</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">parse_decl</span> <span class="n">curr_env</span> <span class="n">x</span> <span class="bp">&lt;|&gt;</span> <span class="n">pure</span> <span class="n">none</span><span class="o">),</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="bp">.</span><span class="n">remove_none</span><span class="bp">.</span><span class="n">split_sum</span><span class="o">),</span>
   <span class="n">skip</span>
</code></pre></div>



<a name="203117579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117579">(Jul 07 2020 at 15:26)</a>:</h4>
<p>Then I get output like:</p>
<div class="codehilite"><pre><span></span><code>([{ name : partial_order,
topic : ,
file : /home/arch/arb/.elan/toolchains/leanprover-community-lean-3.17.0/lib/lean/library/init/algebra/order.lean,
line : 26 }
, { name : has_coe_t_aux,
topic : ,
file : /home/arch/arb/.elan/toolchains/leanprover-community-lean-3.17.0/lib/lean/library/init/coe.lean,
line : 123 }
, { name : is_cond_left_inv,
topic : ,
file : /home/arch/arb/.elan/toolchains/leanprover-community-lean-3.17.0/lib/lean/library/init/algebra/classes.lean,
line : 55 }
, { name : is_total,
topic : ,
file : /home/arch/arb/.elan/toolchains/leanprover-community-lean-3.17.0/lib/lean/library/init/algebra/classes.lean,
line : 95 }
, ...
</code></pre></div>



<a name="203117689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117689">(Jul 07 2020 at 15:27)</a>:</h4>
<p>Yup, same here...</p>



<a name="203117729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117729">(Jul 07 2020 at 15:27)</a>:</h4>
<p>Now, all we need is a way to turn a filename into a topic</p>



<a name="203117918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203117918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203117918">(Jul 07 2020 at 15:28)</a>:</h4>
<p>Probably <code>split_on '/'</code>, end then take the first thing after <code>src</code>, or after <code>library</code>.</p>



<a name="203118060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203118060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203118060">(Jul 07 2020 at 15:29)</a>:</h4>
<p>And for nice links to <code>docs#foobar</code> we probably need to save more stuff, like the full name.</p>



<a name="203118097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203118097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203118097">(Jul 07 2020 at 15:29)</a>:</h4>
<p>Or maybe <code>name</code> is already the full name... I don't know.</p>



<a name="203118644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203118644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203118644">(Jul 07 2020 at 15:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/graphs.3A.20tc.20hierarchy/near/203117918">said</a>:</p>
<blockquote>
<p>Probably <code>split_on '/'</code>, end then take the first thing after <code>src</code>, or after <code>library</code>.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">file_to_topic</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">xs</span><span class="o">,</span> <span class="s2">&quot;.&quot;</span><span class="bp">.</span><span class="n">intercalate</span> <span class="o">((</span><span class="n">xs</span><span class="bp">.</span><span class="n">split_on</span> <span class="err">&#39;</span><span class="bp">/</span><span class="err">&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">drop_while</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≠</span> <span class="s2">&quot;library&quot;</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">≠</span> <span class="s2">&quot;src&quot;</span><span class="o">))</span><span class="bp">.</span><span class="n">tail</span><span class="bp">.</span><span class="n">init</span>
</code></pre></div>



<a name="203118762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203118762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203118762">(Jul 07 2020 at 15:34)</a>:</h4>
<p>Maps <code>"/home/arch/arb/.elan/toolchains/leanprover-community-lean-3.17.0/lib/lean/library/init/algebra/classes.lean"</code> to <code>init.algebra</code></p>



<a name="203118944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203118944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203118944">(Jul 07 2020 at 15:35)</a>:</h4>
<p>Cool!</p>



<a name="203119077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203119077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203119077">(Jul 07 2020 at 15:36)</a>:</h4>
<p>We'll have to play a bit with the exact value of this function, I guess. But this is a good start.</p>



<a name="203126375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203126375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203126375">(Jul 07 2020 at 16:29)</a>:</h4>
<p>This script should not be run by people that have a username <code>library</code> or <code>src</code> <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="203128173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203128173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203128173">(Jul 07 2020 at 16:42)</a>:</h4>
<p>I'm reasonably happy with this version:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">defs</span>

<span class="kn">open</span> <span class="n">tactic</span> <span class="n">declaration</span> <span class="n">environment</span> <span class="n">native</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">option</span> <span class="n">pos</span><span class="o">)</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">p</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">some</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">x</span><span class="bp">.</span><span class="n">line</span>
<span class="bp">|</span> <span class="bp">_</span>      <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">prepare_filename₁</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">xs</span><span class="o">,</span> <span class="o">((</span><span class="n">xs</span><span class="bp">.</span><span class="n">split_on</span> <span class="err">&#39;</span><span class="bp">/</span><span class="err">&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">drop_while</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≠</span> <span class="s2">&quot;library&quot;</span> <span class="bp">∧</span> <span class="n">x</span> <span class="bp">≠</span> <span class="s2">&quot;src&quot;</span><span class="o">))</span>

<span class="n">def</span> <span class="n">prepare_filename₂</span> <span class="o">:</span> <span class="n">list</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">string</span>
<span class="bp">|</span> <span class="o">(</span><span class="s2">&quot;library&quot;</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="s2">&quot;core&quot;</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="s2">&quot;src&quot;</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span>     <span class="o">:=</span> <span class="n">l</span>
<span class="bp">|</span> <span class="bp">_</span>                <span class="o">:=</span> <span class="o">[]</span>

<span class="n">def</span> <span class="n">filename</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="s2">&quot;/&quot;</span><span class="bp">.</span><span class="n">intercalate</span> <span class="err">∘</span> <span class="n">prepare_filename₂</span> <span class="err">∘</span> <span class="n">prepare_filename₁</span>

<span class="n">def</span> <span class="n">topic</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="n">list</span><span class="bp">.</span><span class="n">head</span> <span class="err">∘</span> <span class="n">prepare_filename₂</span> <span class="err">∘</span> <span class="n">prepare_filename₁</span>

<span class="kn">structure</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">file</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">line</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">topic</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">node</span> <span class="kn">extends</span> <span class="n">item</span><span class="bp">.</span>

<span class="kn">namespace</span> <span class="n">node</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">node</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">n</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">n</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">node</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">node</span>

<span class="kn">structure</span> <span class="n">edge</span> <span class="kn">extends</span> <span class="n">item</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">source</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>
<span class="o">(</span><span class="n">target</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">edge</span>

<span class="n">def</span> <span class="n">jsonify</span> <span class="o">:</span> <span class="n">edge</span> <span class="bp">→</span> <span class="n">string</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">e</span><span class="o">,</span>
<span class="s2">&quot;{ name : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">name</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;topic : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">topic</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;source : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">source</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;target : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">target</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;file : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">file</span> <span class="bp">++</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="bp">++</span>
  <span class="s2">&quot;line : &quot;</span> <span class="bp">++</span> <span class="n">e</span><span class="bp">.</span><span class="n">line</span> <span class="bp">++</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="n">edge</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">jsonify</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">edge</span>

<span class="c">/-</span><span class="cm"> parses information about `decl` if it is an instance or a class. -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">parse_decl</span> <span class="o">(</span><span class="n">env</span> <span class="o">:</span> <span class="n">environment</span><span class="o">)</span> <span class="o">(</span><span class="n">decl</span> <span class="o">:</span> <span class="n">declaration</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">tactic</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">node</span> <span class="err">⊕</span> <span class="n">edge</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">let</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">decl</span><span class="bp">.</span><span class="n">to_name</span> <span class="k">in</span>
<span class="n">do</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">)</span><span class="bp">.</span><span class="n">is_some</span>
    <span class="k">then</span> <span class="n">do</span>
      <span class="n">olean_file</span> <span class="err">←</span> <span class="n">env</span><span class="bp">.</span><span class="n">decl_olean</span> <span class="n">name</span><span class="o">,</span>
      <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">item</span> <span class="o">:=</span>
      <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">name</span><span class="o">,</span>
        <span class="n">file</span> <span class="o">:=</span> <span class="n">filename</span> <span class="n">olean_file</span><span class="o">,</span>
        <span class="n">line</span> <span class="o">:=</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">decl_pos</span> <span class="n">name</span><span class="o">),</span>
        <span class="n">topic</span> <span class="o">:=</span> <span class="n">topic</span> <span class="n">olean_file</span> <span class="o">},</span>
      <span class="n">is_c</span> <span class="err">←</span> <span class="n">succeeds</span> <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="n">class</span> <span class="n">name</span><span class="o">),</span>
      <span class="k">if</span> <span class="n">is_c</span> <span class="k">then</span>
        <span class="k">let</span> <span class="n">N</span> <span class="o">:</span> <span class="n">node</span> <span class="o">:=</span> <span class="o">{</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">}</span> <span class="k">in</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">N</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span>
      <span class="n">is_i</span> <span class="err">←</span> <span class="n">succeeds</span> <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">has_attribute</span> <span class="bp">`</span><span class="kn">instance</span> <span class="n">name</span><span class="o">),</span>
      <span class="k">if</span> <span class="n">is_i</span> <span class="k">then</span> <span class="n">do</span>
        <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">tgt</span><span class="o">)</span> <span class="err">←</span> <span class="n">return</span> <span class="n">decl</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">pi_binders</span><span class="o">,</span>
        <span class="c1">-- guard (l.tail.all $ λ b, b.info = binder_info.inst_implicit),</span>
        <span class="c1">-- guard (tgt.get_app_args.head.is_var &amp;&amp; l.ilast.type.get_app_args.head.is_var),</span>
        <span class="k">let</span> <span class="n">src</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">l</span><span class="bp">.</span><span class="n">ilast</span><span class="bp">.</span><span class="n">type</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="k">let</span> <span class="n">tgt</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">tgt</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">const_name</span><span class="o">,</span>
        <span class="c1">-- guard (src ≠ tgt),</span>
        <span class="k">let</span> <span class="n">E</span> <span class="o">:</span> <span class="n">edge</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">source</span> <span class="o">:=</span> <span class="n">src</span><span class="o">,</span> <span class="n">target</span> <span class="o">:=</span> <span class="n">tgt</span><span class="o">,</span> <span class="bp">..</span> <span class="n">I</span> <span class="o">},</span>
        <span class="n">return</span> <span class="o">(</span><span class="n">some</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">E</span><span class="o">))</span>
      <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>
    <span class="k">else</span> <span class="n">do</span> <span class="n">return</span> <span class="n">none</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">remove_none</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">option</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>            <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">none</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span>   <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">some</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">::</span> <span class="n">l</span><span class="bp">.</span><span class="n">remove_none</span>

<span class="n">def</span> <span class="n">list</span><span class="bp">.</span><span class="n">split_sum</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">α</span> <span class="err">⊕</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="bp">×</span> <span class="o">(</span><span class="n">list</span> <span class="n">β</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span>  <span class="o">:=</span> <span class="o">([],</span> <span class="o">[])</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">a</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">((</span><span class="n">a</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">((</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">b</span><span class="o">)</span> <span class="bp">::</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">l</span><span class="bp">.</span><span class="n">split_sum</span> <span class="k">in</span> <span class="o">(</span><span class="n">L</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="n">b</span> <span class="bp">::</span> <span class="n">L</span><span class="bp">.</span><span class="mi">2</span><span class="o">))</span>

<span class="c">/-</span><span class="cm">- prints information about unary classes and forgetful instances in the environment.</span>
<span class="cm">  It only prints instances and classes that have at most 1 argument</span>
<span class="cm">  that is not a type-class argument (within square brackets),</span>
<span class="cm">  and the instances can only be forgetful instances</span>
<span class="cm">  (where the conclusion is a class applied to a variable) -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">print_content</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">o</span> <span class="err">←</span> <span class="o">(</span><span class="n">curr_env</span><span class="bp">.</span><span class="n">fold</span> <span class="o">[]</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span><span class="o">)</span><span class="bp">.</span><span class="n">mmap</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">parse_decl</span> <span class="n">curr_env</span> <span class="n">x</span> <span class="bp">&lt;|&gt;</span> <span class="n">pure</span> <span class="n">none</span><span class="o">),</span>
   <span class="k">let</span> <span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">es</span><span class="o">)</span> <span class="o">:=</span> <span class="n">o</span><span class="bp">.</span><span class="n">remove_none</span><span class="bp">.</span><span class="n">split_sum</span><span class="o">,</span>
   <span class="n">trace</span> <span class="s2">&quot;{ nodes : </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">ns</span><span class="o">),</span>
   <span class="n">trace</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">  edges :</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">es</span><span class="o">),</span>
   <span class="n">trace</span> <span class="s2">&quot;}&quot;</span><span class="o">,</span>
   <span class="n">skip</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">test</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">curr_env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span>
   <span class="n">d</span> <span class="err">←</span> <span class="n">get_decl</span> <span class="bp">`</span><span class="n">comm_monoid</span><span class="bp">.</span><span class="n">to_comm_semigroup</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">d</span><span class="bp">.</span><span class="n">to_name</span><span class="o">),</span>
   <span class="n">o</span> <span class="err">←</span> <span class="n">parse_decl</span> <span class="n">curr_env</span> <span class="n">d</span><span class="o">,</span>
   <span class="n">trace</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">o</span><span class="o">),</span>
   <span class="n">skip</span>

<span class="c1">-- run_cmd test</span>

<span class="n">run_cmd</span> <span class="n">print_content</span>
</code></pre></div>



<a name="203128449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203128449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203128449">(Jul 07 2020 at 16:44)</a>:</h4>
<p>See <a href="https://gist.github.com/jcommelin/da4a87f4d7d87b6e11e3308b5ba97771">https://gist.github.com/jcommelin/da4a87f4d7d87b6e11e3308b5ba97771</a> for the output</p>



<a name="203128479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203128479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203128479">(Jul 07 2020 at 16:44)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> Is this the type of json file that you could turn into a nice D3 graph?</p>



<a name="203128564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203128564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203128564">(Jul 07 2020 at 16:45)</a>:</h4>
<p>Almost! Just add double quotes around the key names and any string values.</p>



<a name="203128662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203128662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203128662">(Jul 07 2020 at 16:46)</a>:</h4>
<p>Ok, cool! Let me try that.</p>



<a name="203129253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129253">(Jul 07 2020 at 16:51)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> Voila: <a href="https://gist.github.com/cffe869fe6ba0f154b15d45a2e4a08f2">https://gist.github.com/cffe869fe6ba0f154b15d45a2e4a08f2</a></p>



<a name="203129525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129525">(Jul 07 2020 at 16:54)</a>:</h4>
<p><code>SyntaxError: JSON.parse: unexpected character at line 580 column 11 of the JSON data</code>. Something is still wrong, let me check...</p>



<a name="203129617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129617">(Jul 07 2020 at 16:55)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3307">#3307</a> contains the script that I'm using.</p>



<a name="203129693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129693">(Jul 07 2020 at 16:55)</a>:</h4>
<p>Ah, line 580 looks like this: <code>"line" :  }</code>. Maybe if there's no <code>line</code> data you'll want to put <code>null</code> there? Or just skip the <code>line</code> field entirely?</p>



<a name="203129738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129738">(Jul 07 2020 at 16:56)</a>:</h4>
<p>Aah, there is an empty <code>"line"</code></p>



<a name="203129756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129756">(Jul 07 2020 at 16:56)</a>:</h4>
<p>Hmm, whatever you think is best.</p>



<a name="203129837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129837">(Jul 07 2020 at 16:56)</a>:</h4>
<p>I haven't been following, what would an empty line mean?</p>



<a name="203129891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129891">(Jul 07 2020 at 16:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">pos_line</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">option</span> <span class="n">pos</span><span class="o">)</span> <span class="o">:</span> <span class="n">string</span> <span class="o">:=</span>
<span class="k">match</span> <span class="n">p</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">some</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">to_string</span> <span class="n">x</span><span class="bp">.</span><span class="n">line</span>
<span class="bp">|</span> <span class="bp">_</span>      <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203129907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129907">(Jul 07 2020 at 16:57)</a>:</h4>
<p>We can turn the <code>""</code> into <code>"null"</code>.</p>



<a name="203129920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129920">(Jul 07 2020 at 16:57)</a>:</h4>
<p>Yeah, that would work.</p>



<a name="203129987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203129987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203129987">(Jul 07 2020 at 16:58)</a>:</h4>
<p>I have no idea what it means that <code>p</code> is <code>none</code>...</p>



<a name="203130040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130040">(Jul 07 2020 at 16:58)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> <a href="https://gist.github.com/6d9da8c35a91cacb4a70d5c390c1d17f">https://gist.github.com/6d9da8c35a91cacb4a70d5c390c1d17f</a></p>



<a name="203130137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130137">(Jul 07 2020 at 16:59)</a>:</h4>
<p>Ooh, that's the script</p>



<a name="203130178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130178">(Jul 07 2020 at 16:59)</a>:</h4>
<p><a href="https://gist.github.com/6e16f71a163a1dd42a1f9b3ec23f6a9b">https://gist.github.com/6e16f71a163a1dd42a1f9b3ec23f6a9b</a></p>



<a name="203130185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130185">(Jul 07 2020 at 16:59)</a>:</h4>
<p>That's updated output</p>



<a name="203130353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130353">(Jul 07 2020 at 17:01)</a>:</h4>
<p>OK, it parsed! I'll see what I can do later (possibly the weekend). I might prioritize looking at the Live Share stuff first though.</p>



<a name="203130387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130387">(Jul 07 2020 at 17:01)</a>:</h4>
<p>Ooh, Live Share would be awesome!</p>



<a name="203130426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203130426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203130426">(Jul 07 2020 at 17:01)</a>:</h4>
<p>(I still didn't get it to work on my setup, though. Stupid MS sign-in page.)</p>



<a name="203131778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203131778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203131778">(Jul 07 2020 at 17:12)</a>:</h4>
<p>I imagine something like <a href="https://observablehq.com/@peatroot/interacting-with-directed-acyclic-graphs">https://observablehq.com/@peatroot/interacting-with-directed-acyclic-graphs</a>, where we can hide nodes and edges depending on which topics are selected as "visible".<br>
(I got that link from Bryan, in another thread.)</p>



<a name="203148415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203148415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203148415">(Jul 07 2020 at 19:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/graphs.3A.20tc.20hierarchy/near/203116838">said</a>:</p>
<blockquote>
<p>I don't know... it was there in Floris's version</p>
</blockquote>
<p>The goal of my script was to only print unary type classes and forgetful instances between them.</p>
<p>These guards were there to filter out instances that did not fall into this category. <br>
The way my script was setup was that failing means the declaration was skipped.</p>



<a name="203148957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203148957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203148957">(Jul 07 2020 at 19:29)</a>:</h4>
<p>Is a class like <a href="https://leanprover-community.github.io/mathlib_docs/find/is_idempotent/src">src#is_idempotent</a> a class you want to print in your graph?</p>



<a name="203149087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203149087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203149087">(Jul 07 2020 at 19:30)</a>:</h4>
<p>Or an instance like <a href="https://leanprover-community.github.io/mathlib_docs/find/nat.has_mod/src">src#nat.has_mod</a>?</p>



<a name="203150043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203150043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203150043">(Jul 07 2020 at 19:38)</a>:</h4>
<p>I think I don't really care about those</p>



<a name="203150094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203150094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203150094">(Jul 07 2020 at 19:39)</a>:</h4>
<p>I would prefer to get a graph containing things like <code>group</code>, <code>field</code>, <code>topological_space</code>, <code>normed_space</code>, <code>metric_space</code>, <code>topological_monoid</code>, etc...</p>



<a name="203150126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203150126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203150126">(Jul 07 2020 at 19:39)</a>:</h4>
<p>But exactly how to characterise those... I dunno</p>



<a name="203151348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203151348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203151348">(Jul 07 2020 at 19:49)</a>:</h4>
<p>That's what my script did, and what those <code>guard</code> expressions did. <br>
I'll modify your script to filter them out.</p>



<a name="203194353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194353">(Jul 07 2020 at 19:50)</a>:</h4>
<p>To filter what out?</p>



<a name="203194432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194432">(Jul 07 2020 at 19:50)</a>:</h4>
<p><span class="user-mention" data-user-id="111080">@Floris van Doorn</span> I think I want basically what your script did. And it seemed that it's what I have now... after Anne debugged it for me.</p>



<a name="203194492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194492">(Jul 07 2020 at 19:51)</a>:</h4>
<p>But your script also outputs a bunch of "junk", like the class and instance I mentioned above.</p>



<a name="203194519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194519">(Jul 07 2020 at 19:51)</a>:</h4>
<p>Aha... no idea why it does that</p>



<a name="203194547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194547">(Jul 07 2020 at 19:51)</a>:</h4>
<p>because you removed those <code>guard</code> expressions.</p>



<a name="203194550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194550">(Jul 07 2020 at 19:51)</a>:</h4>
<p>Ooh, lol... I forgot to uncomment the guards</p>



<a name="203194651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194651">(Jul 07 2020 at 19:52)</a>:</h4>
<p>This is how it starts after uncommenting them</p>
<div class="codehilite"><pre><span></span><code><span class="o">{</span> <span class="s2">&quot;nodes&quot;</span> <span class="o">:</span>

<span class="o">[{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;partial_order&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/algebra/order.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">26</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;has_coe_t_aux&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/coe.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">123</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;is_cond_left_inv&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/algebra/classes.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">55</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;is_total&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/algebra/classes.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">95</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;has_ssubset&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/core.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">340</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;has_andthen&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/core.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">334</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;is_cond_right_inv&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/algebra/classes.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">58</span> <span class="o">}</span>
</code></pre></div>



<a name="203194713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194713">(Jul 07 2020 at 19:53)</a>:</h4>
<p>Is there a reasonable way to filter out <code>has_coe_t_aux</code>? Or does is quack too much like a group or a topological monoid?</p>



<a name="203194770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194770">(Jul 07 2020 at 19:53)</a>:</h4>
<p>It shouldn't be there, since it has two arguments. I think my original script filtered those out.</p>



<a name="203194823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194823">(Jul 07 2020 at 19:54)</a>:</h4>
<p>Things like <code>has_mul</code> and the like will of course be printed.</p>



<a name="203194955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203194955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203194955">(Jul 07 2020 at 19:55)</a>:</h4>
<p>Just checked, my original script doesn't print <code>has_coe_t_aux</code>.</p>



<a name="203195079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203195079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203195079">(Jul 07 2020 at 19:56)</a>:</h4>
<p>Ok... I clearly blundered.</p>



<a name="203195123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203195123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203195123">(Jul 07 2020 at 19:56)</a>:</h4>
<p>The line</p>
<div class="codehilite"><pre><span></span><code><span class="n">guard</span> <span class="o">(</span><span class="n">l</span><span class="bp">.</span><span class="n">tail</span><span class="bp">.</span><span class="n">all</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">b</span><span class="bp">.</span><span class="n">info</span> <span class="bp">=</span> <span class="n">binder_info</span><span class="bp">.</span><span class="n">inst_implicit</span><span class="o">),</span>
</code></pre></div>


<p>was there for both instances and classes, you removed it for classes. You can probably put it back, and it should filter those out.</p>



<a name="203195323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203195323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203195323">(Jul 07 2020 at 19:58)</a>:</h4>
<p>thanks!</p>



<a name="203195443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203195443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203195443">(Jul 07 2020 at 19:59)</a>:</h4>
<p>I pushed to the PR</p>



<a name="203195535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203195535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203195535">(Jul 07 2020 at 20:00)</a>:</h4>
<p>Output now starts with</p>
<div class="codehilite"><pre><span></span><code><span class="o">{</span> <span class="s2">&quot;nodes&quot;</span> <span class="o">:</span>

<span class="o">[{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;partial_order&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/algebra/order.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">26</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;has_ssubset&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;core&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;core/init/core.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">340</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;add_comm_group&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;algebra&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;algebra/group/defs.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">301</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;add_left_cancel_semigroup&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;algebra&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;algebra/group/defs.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">106</span> <span class="o">}</span>
<span class="o">,</span> <span class="o">{</span> <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;comm_group&quot;</span><span class="o">,</span>
<span class="s2">&quot;topic&quot;</span> <span class="o">:</span> <span class="s2">&quot;algebra&quot;</span><span class="o">,</span>
<span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="s2">&quot;algebra/group/defs.lean&quot;</span><span class="o">,</span>
<span class="s2">&quot;line&quot;</span> <span class="o">:</span> <span class="mi">298</span> <span class="o">}</span>
</code></pre></div>



<a name="203195561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203195561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203195561">(Jul 07 2020 at 20:00)</a>:</h4>
<p>That looks quite promising.</p>



<a name="203196519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203196519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203196519">(Jul 07 2020 at 20:08)</a>:</h4>
<p>If you add <code>guard l.head.type.is_sort</code> (for both instances and classes), that should filter out things like <code>monad</code>.</p>



<a name="203196895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203196895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203196895">(Jul 07 2020 at 20:11)</a>:</h4>
<p>Aha... I'm not sure if we want that... would it kill too much?</p>



<a name="203201115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203201115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203201115">(Jul 07 2020 at 20:50)</a>:</h4>
<p>I don't think so, what class on <code>Type* -&gt; Type*</code> do you want to include in your graph?</p>



<a name="203231128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/graphs%3A%20tc%20hierarchy/near/203231128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/graphs.3A.20tc.20hierarchy.html#203231128">(Jul 08 2020 at 04:48)</a>:</h4>
<p>Well, maybe we want to allow all the <code>monad</code> and <code>functor</code> etc..., because if you can easily switch them off using the <code>topic</code> field, why not support them?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>