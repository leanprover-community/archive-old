---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html">{} vs [] again</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="218165767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218165767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218165767">(Nov 28 2020 at 14:08)</a>:</h4>
<p>Here's a fun place to have <code>[]</code> arguments where they don't seem to be desired:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mul_action.to_has_scalar</span> <span class="o">:</span>
  <span class="bp">Π</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_5</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_6</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">c</span> <span class="o">:</span> <span class="n">mul_action</span> <span class="n">α</span> <span class="n">β</span><span class="o">],</span> <span class="n">has_scalar</span> <span class="n">α</span> <span class="n">β</span>
</code></pre></div>



<a name="218165910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218165910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218165910">(Nov 28 2020 at 14:12)</a>:</h4>
<p>I have a non-instance value of <code>mul_action α β</code> which uses a non-instance value of <code>monoid α</code></p>



<a name="218166097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218166097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218166097">(Nov 28 2020 at 14:18)</a>:</h4>
<p>I hope this doesn't mean that Lean does a typeclass search for the indices whenever it uses one of these <code>to_foo</code> functions?</p>



<a name="218166115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218166115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218166115">(Nov 28 2020 at 14:19)</a>:</h4>
<p>The field projections also have <code>[]</code></p>



<a name="218166118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218166118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218166118">(Nov 28 2020 at 14:19)</a>:</h4>
<p>is this really sensible?</p>



<a name="218166171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218166171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218166171">(Nov 28 2020 at 14:20)</a>:</h4>
<p>e.g. <code>mul_action.one_smul</code> has type <code>∀ {α : Type u_5} {β : Type u_6} [_inst_1 : monoid α] [c : mul_action α β] (b : β), 1 • b = b</code> but <code>∀ {α : Type u_5} {β : Type u_6} {_inst_1 : monoid α} [c : mul_action α β] (b : β), 1 • b = b</code> seems more reasonable</p>



<a name="218167963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218167963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218167963">(Nov 28 2020 at 15:06)</a>:</h4>
<p>I assume <code>mul_action</code> is a class</p>



<a name="218168120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168120">(Nov 28 2020 at 15:10)</a>:</h4>
<p>I recall there being some upheaval about the order to search typeclasses in that resulted in a reordering of <code>int.cast</code>'s arguments</p>



<a name="218168130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168130">(Nov 28 2020 at 15:11)</a>:</h4>
<p>from</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_add</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_neg</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">protected</span> <span class="kd">def</span> <span class="n">cast</span> <span class="o">:</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">α</span>
</code></pre></div>
<p>I infer that they are searched from right to left, so you should be fine</p>



<a name="218168346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168346">(Nov 28 2020 at 15:17)</a>:</h4>
<p>In my case it means I have to write <code>@mul_action.to_has_scalar _ _ (extended_monoid f) (extended_mul_action f hY)</code> and I can't leave out the <code>monoid</code> instance <code>extended_monoid f</code>, because Lean will try to find it by instance search. But this is obviously a relatively rare situation, to have multiple levels of non-instances like this</p>



<a name="218168477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168477">(Nov 28 2020 at 15:20)</a>:</h4>
<p>I guess normally if we found a <code>mul_action α β</code> instance then we probably already just found a <code>monoid α</code> instance, so hopefully a subsequent search for the latter will hit the cache</p>



<a name="218168654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168654">(Nov 28 2020 at 15:24)</a>:</h4>
<p>(In case it's not obvious, the point is that <code>_inst_1 : monoid α</code> is an implicit argument of <code>mul_action α β</code>)</p>



<a name="218168669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168669">(Nov 28 2020 at 15:25)</a>:</h4>
<p>I guess it's fine here, I don't know if it makes sense in general</p>



<a name="218168716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168716">(Nov 28 2020 at 15:26)</a>:</h4>
<p>isn't there some issue about having multiple monoid instances for multiple mul_actions?</p>



<a name="218168721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168721">(Nov 28 2020 at 15:27)</a>:</h4>
<p>Or maybe they are all supposed to be unique anyway</p>



<a name="218168843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168843">(Nov 28 2020 at 15:30)</a>:</h4>
<p>The class setup is fine here, my only issue is that the <code>[]</code> for <code>_inst_1</code> means that Lean does instance searches that are at best redundant (the instance is already specified if we know <code>c</code>) and at worst might fail or produce a different instance</p>



<a name="218168864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218168864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218168864">(Nov 28 2020 at 15:31)</a>:</h4>
<p>Or do we search for <code>_inst_1</code> first in order to determine the search problem for <code>c</code>?</p>



<a name="218169760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%7B%7D%20vs%20%5B%5D%20again/near/218169760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.7B.7D.20vs.20.5B.5D.20again.html#218169760">(Nov 28 2020 at 15:57)</a>:</h4>
<p>won't the cache take care of most of this problem?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>