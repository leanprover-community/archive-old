---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/to_additive.20and.20tags.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html">to_additive and tags</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="172845919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172845919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172845919">(Aug 09 2019 at 12:16)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">group_theory</span><span class="bp">.</span><span class="n">submonoid</span>

<span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">bar1</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">foo1</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">bar1</span> <span class="c1">-- ∀ (α : Type u_1) [_inst_1 : add_monoid α], 0 = 0</span>


<span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">bar2</span><span class="o">,</span> <span class="n">simp</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">foo2</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">bar2</span> <span class="c1">-- no simp tag</span>


<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">to_additive</span> <span class="n">bar3</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">foo3</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">bar3</span> <span class="c1">-- has a simp tag</span>

<span class="bp">@</span><span class="o">[</span><span class="n">extensionality</span><span class="o">,</span> <span class="n">to_additive</span> <span class="n">bar4</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">foo4</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">=</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">=</span> <span class="n">β</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">foo4</span> <span class="c1">-- has extensionality tag</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">bar4</span> <span class="c1">-- no extensionality tag</span>
</pre></div>


<p><code>to_additive</code> can move <code>simp</code> tags if they're put in the right place. Can it move extensionality tags? I just had to tag a couple of things manually, so there's an easy workaround, but it made me wonder.</p>



<a name="172845997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172845997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172845997">(Aug 09 2019 at 12:18)</a>:</h4>
<p>Unrelated: the output of <code>#print</code> is quite something if the lemma is tagged with the extensionality tag.</p>



<a name="172846113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172846113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172846113">(Aug 09 2019 at 12:20)</a>:</h4>
<p>The attribute list is processed in left to right order, and when the <code>to_additive</code> attribute is called it will copy any attributes on the theorem to the additive version. So <code>to_additive</code> should always go at the end</p>



<a name="172846257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172846257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172846257">(Aug 09 2019 at 12:22)</a>:</h4>
<p>But <code>bar4</code> is not getting the extensionality tag.</p>



<a name="172846300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172846300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172846300">(Aug 09 2019 at 12:23)</a>:</h4>
<p>ugh, lean core failed me again</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">transport_with_dict</span> <span class="o">(</span><span class="n">dict</span> <span class="o">:</span> <span class="n">name_map</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">src</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">tgt</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">command</span> <span class="o">:=</span>
<span class="n">copy_decl_using</span> <span class="n">dict</span> <span class="n">src</span> <span class="n">tgt</span>
<span class="bp">&gt;&gt;</span> <span class="n">copy_attribute</span> <span class="bp">`</span><span class="kn">reducible</span> <span class="n">src</span> <span class="n">tt</span> <span class="n">tgt</span>
<span class="bp">&gt;&gt;</span> <span class="n">copy_attribute</span> <span class="bp">`</span><span class="n">simp</span> <span class="n">src</span> <span class="n">tt</span> <span class="n">tgt</span>
<span class="bp">&gt;&gt;</span> <span class="n">copy_attribute</span> <span class="bp">`</span><span class="kn">instance</span> <span class="n">src</span> <span class="n">tt</span> <span class="n">tgt</span>
</pre></div>



<a name="172846452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172846452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172846452">(Aug 09 2019 at 12:25)</a>:</h4>
<p>then again, there is probably a reason why it isn't copying <em>all</em> attributes on the original. For instance it would be a bad idea to copy <code>to_additive</code></p>



<a name="172846906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172846906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172846906">(Aug 09 2019 at 12:32)</a>:</h4>
<p><code>to_additive</code> is better than nothing, but it is still rather inadequate. I have got 30 definitions and theorems about submonoids with a PR which is ready to go other than the fact that I have to to-additive everything. I have namespaces and variables and it would be wonderful just to get everything working with <code>@[to_additive ...]</code> because that way one doesn't have to write the proofs twice.  But there are many obstructions to doing this. Here's an example of a definition with problems:</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">- A submonoid is closed under multiplication. -/</span>
<span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">add_mem</span><span class="o">]</span>
<span class="n">def</span> <span class="n">mul_mem</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span> <span class="o">:=</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mul_mem&#39;</span> <span class="n">S</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">add_mem</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mul_mem</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
</pre></div>


<p><code>to_additive</code> defines <code>add_mem</code>, but I have to manually tag <code>eqn_1</code>. The other problem with this approach is that add_mem does not get a docstring.</p>
<p>Here's a worse issue; a complicated definition.</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">- A directed union of submonoids is a submonoid. -/</span>
<span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="o">]</span>
<span class="n">def</span> <span class="n">Union_of_directed</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">hι</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">ι</span><span class="o">]</span>
  <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">submonoid</span> <span class="n">M</span><span class="o">)</span>
  <span class="o">(</span><span class="n">directed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">k</span><span class="o">,</span> <span class="n">s</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">s</span> <span class="n">k</span> <span class="bp">∧</span> <span class="n">s</span> <span class="n">j</span> <span class="bp">≤</span> <span class="n">s</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">submonoid</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">carrier</span> <span class="o">:=</span> <span class="o">(</span><span class="err">⋃</span><span class="n">i</span><span class="o">,</span> <span class="n">s</span> <span class="n">i</span><span class="o">),</span>
  <span class="n">one_mem&#39;</span> <span class="o">:=</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">i</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hι</span> <span class="k">in</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_Union</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">one_mem</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="n">mul_mem&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">ha</span> <span class="n">hb</span><span class="o">,</span>
    <span class="k">let</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hi</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_Union</span><span class="bp">.</span><span class="mi">1</span> <span class="n">ha</span> <span class="k">in</span>
    <span class="k">let</span> <span class="bp">⟨</span><span class="n">j</span><span class="o">,</span> <span class="n">hj</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_Union</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hb</span> <span class="k">in</span>
    <span class="k">let</span> <span class="bp">⟨</span><span class="n">k</span><span class="o">,</span> <span class="n">hk</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">directed</span> <span class="n">i</span> <span class="n">j</span> <span class="k">in</span>
    <span class="n">set</span><span class="bp">.</span><span class="n">mem_Union</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">k</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">mul_mem</span> <span class="o">(</span><span class="n">hk</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hi</span><span class="o">)</span> <span class="o">(</span><span class="n">hk</span><span class="bp">.</span><span class="mi">2</span> <span class="n">hj</span><span class="o">)</span><span class="bp">⟩</span> <span class="o">}</span>
</pre></div>


<p>Here <code>to_additive</code> fails to port the theorem, and my understanding of the error is that <code>submonoid.Union_of_directed._match_1</code> has not been tagged with <code>to_additive</code> -- but I don't see anywhere where I have a chance to tag this. If I close the namespace now and add the additive version manually (copying and pasting the code, which in my mind already indicates something is wrong) then I have to set up all my variables again. If instead I decide to close the namespace after I've formalised all 20 lemmas/definitions then it gets to the point where even the lemmas stop working because not enough earlier stuff has been tagged. Together with the docstring issue it seems to me that currently the best way to deal with this is simply to prove a bunch of stuff in a submonoid namespace and then simply prove everything again in an add_submonoid namespace and port the proofs manually. That way I can get docstrings as well. But then I have to go through all this rigmarole of tagging all the _match and _eqn1 stuff , and, more importantly, <em>I never use <code>to_additive</code> myself at all</em>.</p>



<a name="172847028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847028">(Aug 09 2019 at 12:34)</a>:</h4>
<p>In short: it seems to me that Lean best practice is to avoid to_additive when the going gets tough.</p>



<a name="172847067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847067">(Aug 09 2019 at 12:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110193">@Cyril Cohen</span> do you have these problems in Coq? Do you have additive groups and multiplicative groups, and a system for porting definitions / theorems in one domain to the other?</p>



<a name="172847145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847145">(Aug 09 2019 at 12:36)</a>:</h4>
<p>I am bundling submonoids and add_submonoids and coming to the conclusion that our infrastructure for helping is giving me literally nothing more than the fact that the work I have to do is <em>more</em> than doubled, instead of just doubled.</p>



<a name="172847213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847213">(Aug 09 2019 at 12:37)</a>:</h4>
<p>why is <code>mul_mem</code> a def?</p>



<a name="172847258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847258">(Aug 09 2019 at 12:38)</a>:</h4>
<p>Because I'm a twit.</p>



<a name="172847275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847275">(Aug 09 2019 at 12:38)</a>:</h4>
<p>if it's a theorem there is no eqn_1 to worry about</p>



<a name="172847288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847288">(Aug 09 2019 at 12:38)</a>:</h4>
<p>I can dig out another example if you like.</p>



<a name="172847303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847303">(Aug 09 2019 at 12:38)</a>:</h4>
<p>The docstring thing would be nice, but what should it say?</p>



<a name="172847317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847317">(Aug 09 2019 at 12:39)</a>:</h4>
<p>It's possible to create a docstring for the copy</p>



<a name="172847412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847412">(Aug 09 2019 at 12:40)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="o">]</span>
<span class="n">def</span> <span class="n">univ</span> <span class="o">:</span> <span class="n">submonoid</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">carrier</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">univ</span><span class="o">,</span>
  <span class="n">one_mem&#39;</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_univ</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">mul_mem&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_univ</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>



<a name="172847421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847421">(Aug 09 2019 at 12:40)</a>:</h4>
<p>This one fails  -- </p>
<div class="codehilite"><pre><span></span>type mismatch at application
  univ._proof_1 M _inst_3
term
  _inst_3
has type
  add_monoid M
but is expected to have type
  monoid M
</pre></div>



<a name="172847427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847427">(Aug 09 2019 at 12:40)</a>:</h4>
<p>yeah, that happens</p>



<a name="172847436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847436">(Aug 09 2019 at 12:40)</a>:</h4>
<p>There's nothing I can do about this, right?</p>



<a name="172847445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847445">(Aug 09 2019 at 12:41)</a>:</h4>
<p>You have to transfer more things</p>



<a name="172847469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847469">(Aug 09 2019 at 12:41)</a>:</h4>
<p>What do you mean? I have transferred everything up unto this point I think.</p>



<a name="172847490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847490">(Aug 09 2019 at 12:41)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">- A submonoid of a monoid α is a subset containing 1 and closed under multiplication. -/</span>
<span class="kn">structure</span> <span class="n">submonoid</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">carrier</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span>
<span class="o">(</span><span class="n">one_mem&#39;</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="err">∈</span> <span class="n">carrier</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_mem&#39;</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">carrier</span> <span class="bp">→</span> <span class="n">b</span> <span class="err">∈</span> <span class="n">carrier</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="err">∈</span> <span class="n">carrier</span><span class="o">)</span>

<span class="c">/-</span><span class="cm">- An  additive submonoid of an additive monoid α is a subset containing 0 and</span>
<span class="cm">  closed under addition. -/</span>
<span class="kn">structure</span> <span class="n">add_submonoid</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">carrier</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span>
<span class="o">(</span><span class="n">zero_mem&#39;</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="err">∈</span> <span class="n">carrier</span><span class="o">)</span>
<span class="o">(</span><span class="n">add_mem&#39;</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">carrier</span> <span class="bp">→</span> <span class="n">b</span> <span class="err">∈</span> <span class="n">carrier</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="err">∈</span> <span class="n">carrier</span><span class="o">)</span>

<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="o">]</span> <span class="n">submonoid</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">carrier</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">carrier</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">cases_on</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">cases_on</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">has_sizeof_inst</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">has_sizeof_inst</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mk</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj_arrow</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj_arrow</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj_eq</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj_eq</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">sizeof_spec</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">sizeof_spec</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">add_mem&#39;</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">mul_mem&#39;</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">no_confusion</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">no_confusion</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">no_confusion_type</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">no_confusion_type</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">zero_mem&#39;</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">one_mem&#39;</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">rec</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">rec</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">rec_on</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">rec_on</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">sizeof</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">sizeof</span>
</pre></div>



<a name="172847495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847495">(Aug 09 2019 at 12:42)</a>:</h4>
<p>I have been doing this extremely anally, trying to get the system to work.</p>



<a name="172847547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847547">(Aug 09 2019 at 12:42)</a>:</h4>
<p>I have tagged things which will never ever be used.</p>



<a name="172847606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847606">(Aug 09 2019 at 12:42)</a>:</h4>
<p>Oh, I see, you have to do an after the fact annotation</p>



<a name="172847621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847621">(Aug 09 2019 at 12:43)</a>:</h4>
<p>like this one</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">left_rel</span> <span class="o">[</span><span class="n">group</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">is_subgroup</span> <span class="n">s</span><span class="o">]</span> <span class="o">:</span> <span class="n">setoid</span> <span class="n">α</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span>
  <span class="k">assume</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">is_submonoid</span><span class="bp">.</span><span class="n">one_mem</span><span class="o">],</span>
  <span class="k">assume</span> <span class="n">x</span> <span class="n">y</span> <span class="n">hxy</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">(</span><span class="n">x</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span> <span class="k">from</span> <span class="n">is_subgroup</span><span class="bp">.</span><span class="n">inv_mem</span> <span class="n">hxy</span><span class="o">,</span>
  <span class="k">by</span> <span class="n">simpa</span> <span class="kn">using</span> <span class="n">this</span><span class="o">,</span>
  <span class="k">assume</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">hxy</span> <span class="n">hyz</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">x</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">z</span><span class="o">)</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span> <span class="k">from</span> <span class="n">is_submonoid</span><span class="bp">.</span><span class="n">mul_mem</span> <span class="n">hxy</span> <span class="n">hyz</span><span class="o">,</span>
  <span class="k">by</span> <span class="n">simpa</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">]</span> <span class="kn">using</span> <span class="n">this</span><span class="bp">⟩</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">quotient_add_group</span><span class="bp">.</span><span class="n">left_rel</span><span class="bp">._</span><span class="n">proof_1</span><span class="o">]</span> <span class="n">left_rel</span><span class="bp">._</span><span class="n">proof_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">quotient_add_group</span><span class="bp">.</span><span class="n">left_rel</span><span class="o">]</span> <span class="n">left_rel</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">quotient_add_group</span><span class="bp">.</span><span class="n">left_rel</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">left_rel</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
</pre></div>



<a name="172847628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847628">(Aug 09 2019 at 12:43)</a>:</h4>
<p>But then will the additive version be auto-generated?</p>



<a name="172847641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847641">(Aug 09 2019 at 12:43)</a>:</h4>
<p>yes</p>



<a name="172847653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847653">(Aug 09 2019 at 12:43)</a>:</h4>
<p>you just have to make sure to tag <code>foo._proof_1</code> before you tag <code>foo</code></p>



<a name="172847732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847732">(Aug 09 2019 at 12:44)</a>:</h4>
<p>Why am I being left to discover these things myself? [because nobody wrote the docs I guess]</p>



<a name="172847760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847760">(Aug 09 2019 at 12:44)</a>:</h4>
<p>I agree that tagging new structures is horrible, because lean generates a ton of definitions and doesn't let user code know what it did</p>



<a name="172847866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847866">(Aug 09 2019 at 12:45)</a>:</h4>
<p>I just run <code>#print prefix</code> after everything. I have been writing the code in emacs because I can automate much of the procedure which does all the post hoc tagging.</p>



<a name="172847870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847870">(Aug 09 2019 at 12:45)</a>:</h4>
<p>But it's still a pain.</p>



<a name="172847937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847937">(Aug 09 2019 at 12:46)</a>:</h4>
<p>I tried setting up <code>to_additive</code> so that it would copy everything in the namespace, but this turns out to be really slow because there is no index for that so you have to basically go through every definition in the environment to find which ones were added just a few lines ago</p>



<a name="172847963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847963">(Aug 09 2019 at 12:46)</a>:</h4>
<p>basically we're painted into a corner by lean 3</p>



<a name="172847977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847977">(Aug 09 2019 at 12:46)</a>:</h4>
<p>Is it slower than a human copying everything in the namespace?</p>



<a name="172847984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847984">(Aug 09 2019 at 12:47)</a>:</h4>
<p>Ha ha!</p>



<a name="172847988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172847988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172847988">(Aug 09 2019 at 12:47)</a>:</h4>
<p>we might be able to do it with a hole command?</p>



<a name="172848002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172848002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172848002">(Aug 09 2019 at 12:47)</a>:</h4>
<p>[gets back to tagging]</p>



<a name="172848280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172848280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172848280">(Aug 09 2019 at 12:51)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">- `univ` is the submonoid M of the monoid M -/</span>
<span class="n">def</span> <span class="n">univ</span> <span class="o">:</span> <span class="n">submonoid</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">carrier</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">univ</span><span class="o">,</span>
  <span class="n">one_mem&#39;</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_univ</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">mul_mem&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_univ</span> <span class="bp">_</span> <span class="o">}</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="bp">._</span><span class="n">proof_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="bp">._</span><span class="n">proof_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="bp">._</span><span class="n">proof_2</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="bp">._</span><span class="n">proof_2</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">univ</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">univ</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
</pre></div>


<p>So this does work and the additive version is indeed auto-generated; I hadn't understood that I could do that after the fact. Now how do I do the docstring?</p>



<a name="172848431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172848431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172848431">(Aug 09 2019 at 12:53)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">univ</span> <span class="c1">-- hover to see docstring</span>
<span class="bp">#</span><span class="kn">check</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">univ</span> <span class="c1">-- works but no docstring</span>
</pre></div>



<a name="172848534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172848534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172848534">(Aug 09 2019 at 12:55)</a>:</h4>
<p>[The point here is that the attributes have to be set in the right order]</p>



<a name="172849072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849072">(Aug 09 2019 at 13:02)</a>:</h4>
<p>Before:</p>
<div class="codehilite"><pre><span></span><span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">proof_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">proof_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
</pre></div>


<p>(auto-generated by emacs, with added errors)</p>



<a name="172849094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849094">(Aug 09 2019 at 13:02)</a>:</h4>
<p>That requires modifying the <code>to_additive</code> code. If you want to write a docstring rather than have an autogenerated one, there is some <code>run_cmd</code> thing you can do</p>



<a name="172849145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849145">(Aug 09 2019 at 13:03)</a>:</h4>
<p>Yeah I'm happy to do the run_cmd. It's been mentioned before. In some sense I am trying to write a "best practice" to_additive thing here. I've noticed looking through other people's code in mathlib that there are others who don't know all the tricks either.</p>



<a name="172849237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849237">(Aug 09 2019 at 13:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="bp">ℕ</span>

<span class="n">run_cmd</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">add_doc_string</span> <span class="bp">`</span><span class="n">foo</span> <span class="s2">&quot;*This* is a docstring for `foo`.&quot;</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">foo</span>
</pre></div>



<a name="172849250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849250">(Aug 09 2019 at 13:04)</a>:</h4>
<p>Thanks. I think that's everything.</p>



<a name="172849258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849258">(Aug 09 2019 at 13:05)</a>:</h4>
<p>Thanks a lot, in fact.</p>



<a name="172849395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849395">(Aug 09 2019 at 13:07)</a>:</h4>
<p>After:</p>
<div class="codehilite"><pre><span></span><span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">proof_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">proof_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_2</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_3</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">._</span><span class="n">match_4</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">Union_of_directed</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
</pre></div>


<p>You just keep looking at the first error, see what Lean is complaining about, find the corresponding line and then move it above where the error was. I cannot guarantee that this terminates in general but it's just terminated for this complicated lemma so that's a positive sign.</p>



<a name="172849490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849490">(Aug 09 2019 at 13:08)</a>:</h4>
<p>I will remark that whilst the answer clearly has some structure, the moves taken to get there were match 1, match 4, proof 1, match 3, match 2 (or something -- I'm doing this from memory; it works now and I'm not going back)</p>



<a name="172849630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849630">(Aug 09 2019 at 13:10)</a>:</h4>
<p>Oh cool, you can really confuse VS Code by editing an open file in emacs ;-)</p>



<a name="172849924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172849924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172849924">(Aug 09 2019 at 13:14)</a>:</h4>
<p>dammit now I'm back to doing emacs command line shortcuts in VS Code :-/ It took me months to shake this off the first time around...</p>



<a name="172851111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172851111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172851111">(Aug 09 2019 at 13:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">mul</span><span class="bp">._</span><span class="n">main</span><span class="o">]</span> <span class="n">monoid</span><span class="bp">.</span><span class="n">pow</span><span class="bp">._</span><span class="n">main</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">mul</span><span class="o">]</span> <span class="n">monoid</span><span class="bp">.</span><span class="n">pow</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">has_mul</span><span class="o">]</span> <span class="n">monoid</span><span class="bp">.</span><span class="n">has_pow</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">multiples</span><span class="bp">._</span><span class="n">proof_1</span><span class="o">]</span> <span class="n">powers</span><span class="bp">._</span><span class="n">proof_1</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">multiples</span><span class="bp">._</span><span class="n">proof_2</span><span class="o">]</span> <span class="n">powers</span><span class="bp">._</span><span class="n">proof_2</span>
</pre></div>


<p>Thanks a bunch, other people.</p>



<a name="172851199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172851199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172851199">(Aug 09 2019 at 13:30)</a>:</h4>
<p>I'm quite getting into this :-) Someone could write a script to figure out which attributes are missing. There's just some dictionary monoid-&gt;add_monoid, powers-&gt;multiples, mul-&gt;add etc and then you scan every namespace and try and spot what's missing.</p>



<a name="172851488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172851488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172851488">(Aug 09 2019 at 13:34)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">multiples</span><span class="bp">.</span><span class="n">self_mem</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">powers</span><span class="bp">.</span><span class="n">self_mem</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">powers</span> <span class="n">x</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="n">pow_one</span> <span class="bp">_⟩</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at application</span>
<span class="cm">  0</span>
<span class="cm">term</span>
<span class="cm">  nat.has_one</span>
<span class="cm">has type</span>
<span class="cm">  has_one ℕ</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  has_zero ℕ</span>
<span class="cm">-/</span>
</pre></div>


<p><em>d'oh</em> Lean -- don't change _that_ 1!</p>



<a name="172851813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172851813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172851813">(Aug 09 2019 at 13:38)</a>:</h4>
<p>This one has me stumped. The algorithm fails, and it is not unreasonable that it fail because how is Lean supposed to know which 1's to change to 0's and which ones not to change? We're proving x^1=x here and I want that translated into 1*x=x for the additive thing but the translation fails. So now I have to write <code>add_monoid.multiples.self_mem</code> myself, but if I don't do it now then maybe the next thing will fail, and if I do do it now then I have to close the namespace, open a new one, set up some variables, prove the lemma, close it and then open the old one. Thank goodness for <code>#where</code> ;-)</p>



<a name="172852264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172852264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172852264">(Aug 09 2019 at 13:44)</a>:</h4>
<p>See <code>group_power</code> for examples of this</p>



<a name="172852286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172852286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172852286">(Aug 09 2019 at 13:44)</a>:</h4>
<p>We just don't use <code>to_additive</code> to define the copy in this case</p>



<a name="172852352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172852352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172852352">(Aug 09 2019 at 13:45)</a>:</h4>
<p>Notice also that <code>x^1</code> and <code>1*x</code> are not even written in the same order, <code>to_additive</code> can't handle that kind of thing</p>



<a name="172852505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172852505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172852505">(Aug 09 2019 at 13:47)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">- x is in the submonoid generated by x. -/</span>
<span class="kn">lemma</span> <span class="n">powers</span><span class="bp">.</span><span class="n">self_mem</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">powers</span> <span class="n">x</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="n">pow_one</span> <span class="bp">_⟩</span>

<span class="kn">end</span> <span class="n">submonoid</span>

<span class="c">/-</span><span class="cm">- x is in the add_submonoid generated by x. -/</span>
<span class="kn">lemma</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">multiples</span><span class="bp">.</span><span class="n">self_mem</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">x</span> <span class="err">∈</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">multiples</span> <span class="n">x</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">one_smul</span> <span class="n">x</span><span class="bp">⟩</span>

<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_submonoid</span><span class="bp">.</span><span class="n">multiples</span><span class="bp">.</span><span class="n">self_mem</span><span class="o">]</span> <span class="n">submonoid</span><span class="bp">.</span><span class="n">powers</span><span class="bp">.</span><span class="n">self_mem</span>

<span class="kn">namespace</span> <span class="n">submonoid</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">submonoid</span> <span class="n">M</span><span class="o">)</span>
</pre></div>


<p>[grumble]</p>



<a name="172852945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172852945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172852945">(Aug 09 2019 at 13:53)</a>:</h4>
<blockquote>
<p>See <code>group_power</code> for examples of this</p>
</blockquote>
<p>Aah -- so it was you who didn't to_additive <code>monoid.has_pow</code>!</p>



<a name="172853047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/to_additive%20and%20tags/near/172853047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/to_additive.20and.20tags.html#172853047">(Aug 09 2019 at 13:54)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">pow_add</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span><span class="err">^</span><span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span><span class="err">^</span><span class="n">m</span> <span class="bp">*</span> <span class="n">a</span><span class="err">^</span><span class="n">n</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n</span> <span class="n">ih</span><span class="bp">;</span> <span class="o">[</span><span class="n">rw</span> <span class="o">[</span><span class="n">add_zero</span><span class="o">,</span> <span class="n">pow_zero</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">pow_succ</span><span class="o">,</span> <span class="err">←</span> <span class="n">pow_mul_comm&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="err">←</span> <span class="n">ih</span><span class="o">,</span> <span class="err">←</span> <span class="n">pow_succ&#39;</span><span class="o">]]</span><span class="bp">;</span> <span class="n">refl</span>
<span class="kn">theorem</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">add_smul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">)</span><span class="err">•</span><span class="n">a</span> <span class="bp">=</span> <span class="n">m</span><span class="err">•</span><span class="n">a</span> <span class="bp">+</span> <span class="n">n</span><span class="err">•</span><span class="n">a</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">pow_add</span> <span class="o">(</span><span class="n">multiplicative</span> <span class="n">β</span><span class="o">)</span> <span class="bp">_</span>
<span class="n">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">add_smul</span><span class="o">]</span> <span class="n">pow_add</span>
</pre></div>


<p>Aah I see. So the point is that you just try and port the proofs using <code>multiplicative</code> in this case.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>