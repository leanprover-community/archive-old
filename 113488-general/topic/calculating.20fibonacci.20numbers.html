---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/calculating.20fibonacci.20numbers.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html">calculating fibonacci numbers</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="194541085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541085">(Apr 18 2020 at 12:05)</a>:</h4>
<p>What is the correct way to calculate fibonacci numbers in Lean?</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">fib</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fib</span> <span class="mi">12</span> <span class="bp">=</span> <span class="mi">144</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">norm_num</span> <span class="c1">-- doesn&#39;t work</span>
</pre></div>



<a name="194541324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541324">(Apr 18 2020 at 12:11)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">eval</span> <span class="n">fib</span> <span class="mi">12</span>
</pre></div>


<p>is instantaneous, but <code>rfl</code> doesn't work as proof of the above</p>



<a name="194541645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541645">(Apr 18 2020 at 12:18)</a>:</h4>
<p>This is the archetypical example where the standard recursive definition is going to do a lot of extra computation (unless the lean compiler does something fancy).  My guess is that if you need a fast version of <code>fib</code>, you can write your own (it’s pretty easy with some googling) and prove it is equal to <code>fib</code>.  (But I’m not an expert.)</p>



<a name="194541854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541854">(Apr 18 2020 at 12:23)</a>:</h4>
<p>Is this the bad way? <a href="https://leanprover.github.io/theorem_proving_in_lean/induction_and_recursion.html?highlight=fibonacci#structural-recursion-and-induction" title="https://leanprover.github.io/theorem_proving_in_lean/induction_and_recursion.html?highlight=fibonacci#structural-recursion-and-induction">https://leanprover.github.io/theorem_proving_in_lean/induction_and_recursion.html?highlight=fibonacci#structural-recursion-and-induction</a></p>



<a name="194541916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541916">(Apr 18 2020 at 12:24)</a>:</h4>
<p>I clicked "try it online" and <code>rfl</code> failed to prove <code>fib 12 = 144</code>, but after staring at the definition I realised that -- oops -- it did prove <code>fib 11 = 144</code> :-)</p>



<a name="194541929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541929">(Apr 18 2020 at 12:24)</a>:</h4>
<p>The canonical normalisation is the one Johan is using.</p>



<a name="194541994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194541994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194541994">(Apr 18 2020 at 12:26)</a>:</h4>
<p>Wait, I get <code>#eval fib 11 -- 89</code> in my Lean</p>



<a name="194542009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542009">(Apr 18 2020 at 12:27)</a>:</h4>
<p>But <code>rfl</code> is way too slow for these facts, it doesn't memoize</p>



<a name="194542069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542069">(Apr 18 2020 at 12:28)</a>:</h4>
<p>In TPIL they define their own Fibonacci numbers and I'm observing that rfl works for them</p>



<a name="194542079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542079">(Apr 18 2020 at 12:28)</a>:</h4>
<p>(or at least it did for me with "try it online")</p>



<a name="194542093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542093">(Apr 18 2020 at 12:29)</a>:</h4>
<p>Hmmm, weird... I think the definition in mathlib should actually memoize enough</p>



<a name="194542395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542395">(Apr 18 2020 at 12:37)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> wrote   </p>
<blockquote>
<p>Is this the bad way? <a href="https://leanprover.github.io/theorem_proving_in_lean/induction_and_recursion.html?highlight=fibonacci#structural-recursion-and-induction" title="https://leanprover.github.io/theorem_proving_in_lean/induction_and_recursion.html?highlight=fibonacci#structural-recursion-and-induction">https://leanprover.github.io/theorem_proving_in_lean/induction_and_recursion.html?highlight=fibonacci#structural-recursion-and-induction</a></p>
</blockquote>
<p>Generally speaking, from a computation standpoint, yes.  From a math standpoint, that is the natural definition.  I'll write some code showing the difference.</p>



<a name="194542462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542462">(Apr 18 2020 at 12:39)</a>:</h4>
<p>This is CS 101 coming up, isn't it :-) This is like the difference between foldl and foldr or something -- mathematically they are the same but computationally they couldn't be more different.</p>



<a name="194542531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542531">(Apr 18 2020 at 12:41)</a>:</h4>
<p>My problem is that even though I understand the basic principle that there are lots of mathematically equivalent ways to do something and they might have vastly different computational behaviour, when I see the definition like the one in TPIL I have so little understanding of what is happening under the hood that I am not capable of working out whether the definition is computationally good or not.</p>



<a name="194542579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542579">(Apr 18 2020 at 12:42)</a>:</h4>
<p>For all I know the equation compiler is cunningly storing all the auxiliary <code>fib a</code> computations on the way.</p>



<a name="194542923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542923">(Apr 18 2020 at 12:50)</a>:</h4>
<p>I might be answering the wrong question.  Johan isn't asking how does one compute with fib, but how does one prove fib 12 = 144.  This works for me:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">fib</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">fib</span> <span class="n">n</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fib</span> <span class="mi">12</span> <span class="bp">=</span> <span class="mi">144</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>



<a name="194542995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194542995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194542995">(Apr 18 2020 at 12:51)</a>:</h4>
<p><span class="user-mention" data-user-id="115715">@Jason Rute</span> But that one is slow, right?<br>
Also, to be precise, I want to work with mathlib's <code>fib</code>...</p>



<a name="194543002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543002">(Apr 18 2020 at 12:51)</a>:</h4>
<p>According to TPiL "[The implementation of structural recursion] provides an efficient implementation of fib, avoiding the exponential blowup that would arise from evaluating each recursive call independently.", so it should not be slow.</p>



<a name="194543005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543005">(Apr 18 2020 at 12:51)</a>:</h4>
<p>What? Your <code>fib</code> is way faster than the one in mathlib... I'm really confused now</p>



<a name="194543050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543050">(Apr 18 2020 at 12:52)</a>:</h4>
<p>This works (I don't know why).</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">fib</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fib</span> <span class="mi">12</span> <span class="bp">=</span> <span class="mi">144</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refl</span>
</pre></div>



<a name="194543119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543119">(Apr 18 2020 at 12:53)</a>:</h4>
<p>I'm more confused now too.  I just looked at the mathlib implementation.  It should be similar to this <code>fast_fib</code> which is much faster than the naive one:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">fast_fib_aux</span><span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="mi">1</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fast_fib_aux</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="k">in</span> <span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fast_fib</span> <span class="o">(</span><span class="n">n</span><span class="o">:</span> <span class="bp">ℕ</span><span class="o">):</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="o">(</span><span class="n">fast_fib_aux</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">fast_fib</span> <span class="mi">12</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">144</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>



<a name="194543197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543197">(Apr 18 2020 at 12:54)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">eval</span> <span class="n">fib</span> <span class="mi">30</span> <span class="c1">-- 832040 ... fast!</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fib</span> <span class="mi">30</span> <span class="bp">=</span> <span class="mi">832040</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">refl</span> <span class="c1">-- slow</span>
</pre></div>



<a name="194543238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543238">(Apr 18 2020 at 12:55)</a>:</h4>
<p>I thought I remember seeing that #eval takes shortcuts with interger computation that rfl can't take.</p>



<a name="194543330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543330">(Apr 18 2020 at 12:57)</a>:</h4>
<p>Sure, that might be the case. I also don't care whether the proof is by <code>rfl</code>. I just want some way to prove this, that doesn't involve manually apply <code>fib_succ_succ</code> and computing all the 30 fibonacci numbers before it.</p>



<a name="194543398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543398">(Apr 18 2020 at 12:58)</a>:</h4>
<p>Does the <code>by refl</code> trick work for you?  (Why does <code>by refl</code> work and not <code>rfl</code>?)</p>



<a name="194543405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543405">(Apr 18 2020 at 12:59)</a>:</h4>
<p>It works for <code>fib 12</code>, but not for <code>fib 30</code></p>



<a name="194543499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543499">(Apr 18 2020 at 13:01)</a>:</h4>
<p>You can use my fast_fib above (it works for 30) and prove it is equivalent to fib.)  Maybe that needs to be the definition in mathlib.</p>



<a name="194543551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194543551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194543551">(Apr 18 2020 at 13:02)</a>:</h4>
<p>Sorry, I thought it was working for 30, but it doesn't.  My bad.</p>



<a name="194544242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544242">(Apr 18 2020 at 13:18)</a>:</h4>
<p>The equation compiler uses a version of memoization automatically.</p>
<blockquote>
<p><code>fib 30</code></p>
</blockquote>
<p>Even adding two numbers of around this size by <code>rfl</code> is too slow, so this can't work.</p>



<a name="194544245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544245">(Apr 18 2020 at 13:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194543330" title="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194543330">said</a>:</p>
<blockquote>
<p>Sure, that might be the case. I also don't care whether the proof is by <code>rfl</code>. I just want some way to prove this, that doesn't involve manually apply <code>fib_succ_succ</code> and computing all the 30 fibonacci numbers before it.</p>
</blockquote>
<p>I thought the problem was that with some naive implementations you compute all the 30 fibonacci numbers before it many many times.</p>



<a name="194544264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544264">(Apr 18 2020 at 13:19)</a>:</h4>
<p>There's a way of computing <code>fib n</code> involving induction on binary expansion of n, because <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">F_{2n}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>  and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">F_{2n+1}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> are closely related to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">F_n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> by Binet.</p>



<a name="194544275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544275">(Apr 18 2020 at 13:19)</a>:</h4>
<p>That would be super-efficient, but I'm assuming that this isn't the question. Or is it?</p>



<a name="194544276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544276">(Apr 18 2020 at 13:19)</a>:</h4>
<p>So we turn that into <code>simp</code>-lemmas?</p>



<a name="194544598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544598">(Apr 18 2020 at 13:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194544275" title="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194544275">said</a>:</p>
<blockquote>
<p>That would be super-efficient, but I'm assuming that this isn't the question. Or is it?</p>
</blockquote>
<p>until you realize that dividing by 2 isn't O(1), but rather O(n)</p>



<a name="194544697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544697">(Apr 18 2020 at 13:29)</a>:</h4>
<p>To be clear, I was originally mistaken on the definition used in mathlib.  It is (what should be on paper) a fast definition.  My first comment led us down the wrong track.  As <span class="user-mention" data-user-id="110032">@Reid Barton</span> said, apparently rfl isn't even good at adding large numbers (which is what exactly what any computation of fibonacci does).  So I think this is still an open question how to prover stuff like this if rfl (and refl) are unusable.</p>



<a name="194544729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544729">(Apr 18 2020 at 13:30)</a>:</h4>
<p>But Kevin is talking about</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>&lt;</mo><mi>n</mi></mrow></munder><msub><mi>F</mi><mrow><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mspace width="2em"/><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><mo fence="true">(</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>&lt;</mo><mi>n</mi></mrow></munder><msub><mi>F</mi><mrow><mn>2</mn><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo fence="true">)</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">F_{2n} = \sum_{i &lt; n} F_{2i+1}, \qquad F_{2n+1} = \left(\sum_{i &lt; n} F_{2(i+1)} \right) + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3550440000000004em;vertical-align:-1.305039em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8723309999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">&lt;</span><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.305039em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:2em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.055039em;vertical-align:-1.305039em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8723309999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">&lt;</span><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.305039em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<p>Am I stupid, or is there no division by two there?</p>



<a name="194544953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194544953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194544953">(Apr 18 2020 at 13:34)</a>:</h4>
<p>I'm talking about <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub><mo>=</mo></mrow><annotation encoding="application/x-tex">F_{2n}=</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span> something like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>F</mi><mi>n</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">F_n^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.061108em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>, the same trick that one uses when computing <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">a^b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span></span></span></span> if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> is large, by repeated squaring.</p>



<a name="194545028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545028">(Apr 18 2020 at 13:36)</a>:</h4>
<p><a href="/user_uploads/3121/sFIYlZy5BuHHqPsVs6KvY_aB/image.png" title="image.png">image.png</a> ??</p>
<div class="message_inline_image"><a href="/user_uploads/3121/sFIYlZy5BuHHqPsVs6KvY_aB/image.png" title="image.png"><img src="/user_uploads/3121/sFIYlZy5BuHHqPsVs6KvY_aB/image.png"></a></div>



<a name="194545032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545032">(Apr 18 2020 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> That one <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span> ?</p>



<a name="194545122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545122">(Apr 18 2020 at 13:39)</a>:</h4>
<p>Right.</p>



<a name="194545135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545135">(Apr 18 2020 at 13:39)</a>:</h4>
<p>If <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n&gt;&gt;0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> and one can do the arithmetic efficiently then this is a far quicker way of computing Fibonacci numbers.</p>



<a name="194545184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545184">(Apr 18 2020 at 13:40)</a>:</h4>
<p>But I suspect that this has nothing to do with your original question.</p>



<a name="194545210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545210">(Apr 18 2020 at 13:40)</a>:</h4>
<p>Well, I want to show e.g. that <code>fib 34</code> is &gt; 4 million</p>



<a name="194545298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545298">(Apr 18 2020 at 13:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194544242" title="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194544242">said</a>:</p>
<blockquote>
<p>Even adding two numbers of around this size by <code>rfl</code> is too slow, so this can't work.</p>
</blockquote>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> <br>
I once found a counterexample to this in front of a room full of schoolchildren and it took me a while to realise what the heck was going on:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="mi">1000000000000</span> <span class="bp">+</span> <span class="mi">1000000000000</span> <span class="bp">=</span> <span class="mi">2000000000000</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- works fine</span>
</pre></div>



<a name="194545311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194545311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194545311">(Apr 18 2020 at 13:43)</a>:</h4>
<p>I had just coherently argued that this would fail miserably.</p>



<a name="194546816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194546816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194546816">(Apr 18 2020 at 14:17)</a>:</h4>
<p>So I think the prerequisite question is how does one prove this in Lean?</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="mi">317811</span> <span class="bp">+</span> <span class="mi">514229</span> <span class="bp">=</span> <span class="mi">832040</span>
</pre></div>



<a name="194546973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194546973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194546973">(Apr 18 2020 at 14:20)</a>:</h4>
<p><code>by norm_num</code></p>



<a name="194546987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194546987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194546987">(Apr 18 2020 at 14:21)</a>:</h4>
<p>This one is <code>by norm_num</code>. The question is really how to make <code>norm_num</code> aware of <code>fib</code>, or <code>fib</code> aware of <code>norm_num</code>, or something which can do both definitional unfolding and <code>norm_num</code> where appropriate.</p>



<a name="194547322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194547322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194547322">(Apr 18 2020 at 14:29)</a>:</h4>
<p>maybe if <code>norm_num</code> accepts tags then we can tag <code>fib_bit0</code> and <code>fib_bit1</code> as <code>norm_num</code></p>



<a name="194547334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194547334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194547334">(Apr 18 2020 at 14:29)</a>:</h4>
<p>this still wouldn't make it memoize though</p>



<a name="194547390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194547390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194547390">(Apr 18 2020 at 14:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194545028" title="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194545028">said</a>:</p>
<blockquote>
<p><a href="/user_uploads/3121/sFIYlZy5BuHHqPsVs6KvY_aB/image.png" title="image.png">image.png</a> ??</p>
</blockquote>
<p>there must be a formula without minus</p>



<a name="194547419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194547419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194547419">(Apr 18 2020 at 14:31)</a>:</h4>
<p>Well, <code>F n * L n</code> doesn't contain a minus... maybe there are fast formulas for <code>L n</code> as well??</p>



<a name="194548141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548141">(Apr 18 2020 at 14:48)</a>:</h4>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable columnspacing="1em" rowspacing="0.15999999999999992em"><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mrow><mn>2</mn><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable columnspacing="1em" rowspacing="0.15999999999999992em"><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mi>n</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>F</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\begin{bmatrix} F_{2n+1} &amp; F_{2n} \\ F_{2n} &amp; F_{2n-1} \end{bmatrix} = \begin{bmatrix} F_{n+1} &amp; F_{n} \\ F_{n} &amp; F_{n-1} \end{bmatrix}^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.604038em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></p>
<div class="codehilite"><pre><span></span>20 = 2 * 10 = 2 * (2 * 5) = 2 * (2 * (2 * 2 + 1))
(F(0), F(1)) = (0, 1)
(F(1), F(2)) = (0*0+1*1, 1*(2*0+1)) = (1, 1)
(F(3), F(4)) = (1*1+1*1, 1*(2*1+1)) = (2, 3)
(F(4), F(5)) = (3, 2+3) = (3, 5)
(F(9), F(10)) = (3*3+5*5, 5*(2*3+5)) = (34, 55)
(F(19), F(20)) = (34*34+55*55, 55*(2*34+55)) = (4181, 6765)
</pre></div>


<p>proposed algorithm:</p>
<div class="codehilite"><pre><span></span><span class="n">fib</span> <span class="mi">20</span>
<span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">bit0</span> <span class="mi">10</span><span class="o">)</span>
<span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">bit0</span> <span class="err">$</span> <span class="n">bit0</span> <span class="mi">5</span><span class="o">)</span>
<span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">bit0</span> <span class="err">$</span> <span class="n">bit0</span> <span class="err">$</span> <span class="n">bit1</span> <span class="mi">2</span><span class="o">)</span>
<span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">bit0</span> <span class="err">$</span> <span class="n">bit0</span> <span class="err">$</span> <span class="n">bit1</span> <span class="err">$</span> <span class="n">bit0</span> <span class="mi">1</span><span class="o">)</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">fib_aux</span> <span class="err">$</span> <span class="n">bit0</span> <span class="err">$</span> <span class="n">bit0</span> <span class="err">$</span> <span class="n">bit1</span> <span class="err">$</span> <span class="n">bit0</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">fib_aux</span> <span class="err">$</span> <span class="n">bit0</span> <span class="err">$</span> <span class="n">bit1</span> <span class="err">$</span> <span class="n">bit0</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fib_aux</span> <span class="err">$</span> <span class="n">bit1</span> <span class="err">$</span> <span class="n">bit0</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fib_aux</span> <span class="err">$</span> <span class="n">bit0</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fib_aux</span> <span class="mi">1</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="err">$</span> <span class="n">f0</span> <span class="o">(</span><span class="mi">0</span><span class="bp">*</span><span class="mi">0</span><span class="bp">+</span><span class="mi">1</span><span class="bp">*</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="bp">*</span><span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="mi">0</span><span class="bp">+</span><span class="mi">1</span><span class="o">)))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="err">$</span> <span class="n">f0</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="o">(</span><span class="mi">1</span><span class="bp">*</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span><span class="bp">*</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="bp">*</span><span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="mi">1</span><span class="bp">+</span><span class="mi">1</span><span class="o">)))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="err">$</span> <span class="n">fs</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="bp">+</span><span class="mi">3</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="err">$</span> <span class="n">f0</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="o">(</span><span class="mi">3</span><span class="bp">*</span><span class="mi">3</span><span class="bp">+</span><span class="mi">5</span><span class="bp">*</span><span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="bp">*</span><span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="mi">3</span><span class="bp">+</span><span class="mi">5</span><span class="o">)))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="n">f0</span> <span class="o">(</span><span class="mi">34</span><span class="o">,</span> <span class="mi">55</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="mi">34</span><span class="bp">*</span><span class="mi">34</span><span class="bp">+</span><span class="mi">55</span><span class="bp">*</span><span class="mi">55</span><span class="o">,</span> <span class="mi">55</span><span class="bp">*</span><span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="mi">34</span><span class="bp">+</span><span class="mi">55</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="o">(</span><span class="mi">4181</span><span class="o">,</span> <span class="mi">6765</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
<span class="bp">→</span> <span class="mi">6765</span>
</pre></div>



<a name="194548256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548256">(Apr 18 2020 at 14:51)</a>:</h4>
<p>That is much better than the foldl/foldr issue</p>



<a name="194548269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548269">(Apr 18 2020 at 14:51)</a>:</h4>
<p>foldl/foldr?</p>



<a name="194548317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548317">(Apr 18 2020 at 14:52)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;(</span><span class="si">{0}</span><span class="s2">*</span><span class="si">{0}</span><span class="s2">+</span><span class="si">{1}</span><span class="s2">*</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">{1}</span><span class="s2">*(2*</span><span class="si">{0}</span><span class="s2">+</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">fs</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;(</span><span class="si">{0}</span><span class="s2">+</span><span class="si">{1}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">))</span>

<span class="n">f20</span> <span class="o">=</span> <span class="n">f0</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">fs</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">f0</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))))))[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">f20</span><span class="p">))</span>
</pre></div>


<p>output:</p>
<div class="codehilite"><pre><span></span>(((0*0+1*1)*(0*0+1*1)+1*(2*0+1)*1*(2*0+1))+1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1)))*(2*1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1))+(((0*0+1*1)*(0*0+1*1)+1*(2*0+1)*1*(2*0+1))+1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1))))*(2*(1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1))*1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1))+(((0*0+1*1)*(0*0+1*1)+1*(2*0+1)*1*(2*0+1))+1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1)))*(((0*0+1*1)*(0*0+1*1)+1*(2*0+1)*1*(2*0+1))+1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1))))+(((0*0+1*1)*(0*0+1*1)+1*(2*0+1)*1*(2*0+1))+1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1)))*(2*1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1))+(((0*0+1*1)*(0*0+1*1)+1*(2*0+1)*1*(2*0+1))+1*(2*0+1)*(2*(0*0+1*1)+1*(2*0+1)))))

6765
</pre></div>



<a name="194548319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548319">(Apr 18 2020 at 14:52)</a>:</h4>
<p>I just mean asking a functional language to compute Fibonacci numbers might naively involve computing <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mrow><mi>n</mi><mo>−</mo><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">F_{n-d}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> about <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> times. It's not foldl/foldr but it's the same sort of thing.</p>



<a name="194548330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548330">(Apr 18 2020 at 14:53)</a>:</h4>
<p>I don't know whether it will cause problem if the intermediate expressions are not immediately evaluated</p>



<a name="194548339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548339">(Apr 18 2020 at 14:53)</a>:</h4>
<p>it might undo our optimization by having exponential complexity (on top of logarithmic complexity)</p>



<a name="194548342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548342">(Apr 18 2020 at 14:53)</a>:</h4>
<p>then the overall complexity would just be O(n)</p>



<a name="194548389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548389">(Apr 18 2020 at 14:54)</a>:</h4>
<p>None of this is really relevant if you can't compute these additions in subexponential time</p>



<a name="194548394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548394">(Apr 18 2020 at 14:54)</a>:</h4>
<p>Yes, you are evaluating <code>0*0+1*1</code> a lot of times there</p>



<a name="194548399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548399">(Apr 18 2020 at 14:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194548389" title="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194548389">said</a>:</p>
<blockquote>
<p>None of this is really relevant if you can't compute these additions in subexponential time</p>
</blockquote>
<p><code>norm_num</code> can</p>



<a name="194548412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548412">(Apr 18 2020 at 14:54)</a>:</h4>
<p>But you can't solve the original problem using <code>norm_num</code></p>



<a name="194548465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548465">(Apr 18 2020 at 14:55)</a>:</h4>
<p>You are solving the second problem before solving the first problem.</p>



<a name="194548468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548468">(Apr 18 2020 at 14:55)</a>:</h4>
<p>if you're referring to writing a tactic that will calculate <code>fib 20</code>, then my algorithm can call <code>norm_num</code> in each intermediate step</p>



<a name="194548472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548472">(Apr 18 2020 at 14:55)</a>:</h4>
<p>what's the first problem?</p>



<a name="194548514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548514">(Apr 18 2020 at 14:56)</a>:</h4>
<p>I don't want to write a new tactic to compute every function I write.</p>



<a name="194548529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548529">(Apr 18 2020 at 14:56)</a>:</h4>
<p>so I also proposed having a <code>norm_num</code> tag that you can tag my lemmas with, which include <code>fib n = (fib_aux n).2</code> and <code>fib_aux (bit0 n) = f0 (fib_aux n)</code> and <code>fib_aux(bit1 n) = fs (f0 (fib_aux n))</code>, and my algorithm demonstrated how you can use these three lemmas to calculate <code>fib 20</code> in logarithmic time</p>



<a name="194548546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548546">(Apr 18 2020 at 14:57)</a>:</h4>
<p>One could imagine a general "multiply these two matrices together using norm_num and also other tricks" function.</p>



<a name="194548550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548550">(Apr 18 2020 at 14:57)</a>:</h4>
<p>(removed)</p>



<a name="194548554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548554">(Apr 18 2020 at 14:57)</a>:</h4>
<p>Such a function will I think be hard coded into any decent computer algebra system</p>



<a name="194548558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194548558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194548558">(Apr 18 2020 at 14:57)</a>:</h4>
<p>(removed)</p>



<a name="194554179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194554179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194554179">(Apr 18 2020 at 17:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> has mentioned that we need Coq's <code>cbv</code> tactic a few times now for similar questions I believe, but I don't know enough about coq to know what needs doing here (can we get a formal roadmap for a tactic)!</p>



<a name="194561671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194561671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194561671">(Apr 18 2020 at 20:13)</a>:</h4>
<p>As Reid suggests, the "right" answer here is to extend <code>norm_num</code>, and I've been meaning to use <code>def_replacer</code> for this purpose so that <code>norm_num</code> doesn't have to import every number theoretic function it will ever use</p>



<a name="194561738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194561738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194561738">(Apr 18 2020 at 20:15)</a>:</h4>
<p>There is nothing wrong with using <code>-</code> inside <code>norm_num</code>, because <code>norm_num</code> doesn't prove <code>a - b = c</code>, it proves <code>b + c = a</code> where <code>a</code> and <code>b</code> are the inputs and <code>c</code> is the output</p>



<a name="194561923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194561923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194561923">(Apr 18 2020 at 20:20)</a>:</h4>
<p>Extending <code>norm_num</code> is a bit more complicated than just marking <code>fib_bit0</code> and <code>fib_bit1</code>, because it's not a simp set, it requires some carefully stated custom theorems and goes by recursion, which is <em>much</em> faster than <code>simp</code></p>



<a name="194561970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194561970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194561970">(Apr 18 2020 at 20:22)</a>:</h4>
<p>But it also means that it is not difficult to get it to evaluate subterms as required to get the O(n log n) algorithm</p>



<a name="194562039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194562039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194562039">(Apr 18 2020 at 20:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194545210" title="#narrow/stream/113488-general/topic/calculating.20fibonacci.20numbers/near/194545210">said</a>:</p>
<blockquote>
<p>Well, I want to show e.g. that <code>fib 34</code> is &gt; 4 million</p>
</blockquote>
<p>If that's all you want, you don't need to evaluate <code>fib</code> at all, unless that bound is particularly close. A quick estimation method would say that <code>fib n</code> is close to <code>phi^n / sqrt 5</code> or something like that, and you can easily get proven bounds on phi using continued fractions</p>



<a name="194562437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194562437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194562437">(Apr 18 2020 at 20:36)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">fib</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fib</span> <span class="mi">12</span> <span class="bp">=</span> <span class="mi">144</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">rw</span> <span class="n">fib_succ_succ</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">9</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">8</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">7</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">6</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">5</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">4</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">2</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>



<a name="194562447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/calculating%20fibonacci%20numbers/near/194562447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/calculating.20fibonacci.20numbers.html#194562447">(Apr 18 2020 at 20:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="n">fib</span> <span class="mi">12</span> <span class="bp">=</span> <span class="mi">144</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="c1">-- start the countdown</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">10</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">9</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">8</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">7</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">6</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">5</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">4</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">2</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_succ_succ</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_one</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">fib_zero</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>