---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/ancestor.20attribute.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html">ancestor attribute</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198882722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198882722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198882722">(May 27 2020 at 12:20)</a>:</h4>
<p>I'm trying to remove the unnecessary axioms for a group, ring etc. I'm seeing the ancestor attribute everywhere. What does it do, and how should I use it?</p>



<a name="198883309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883309">(May 27 2020 at 12:27)</a>:</h4>
<p>it records the content of the <code>extends</code> clause of an <code>old_structure_cmd</code> for posterity</p>



<a name="198883409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883409">(May 27 2020 at 12:28)</a>:</h4>
<p>There is no more old structure command?</p>



<a name="198883420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883420">(May 27 2020 at 12:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> By now, we could hack lean to do this for us, right?</p>



<a name="198883431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883431">(May 27 2020 at 12:28)</a>:</h4>
<p>sure</p>



<a name="198883447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883447">(May 27 2020 at 12:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/ancestor.20attribute/near/198883409">said</a>:</p>
<blockquote>
<p>There is no more old structure command?</p>
</blockquote>
<p>There is... we're just logging what it does. For tactics.</p>



<a name="198883480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883480">(May 27 2020 at 12:29)</a>:</h4>
<p>If I'm changing the attributes, then for example <code>monoid</code> will be an ancestor of <code>comm_monoid</code>, but will have some extra axioms. So should ancestors that don't come from <code>extends</code> be marked as ancestors?</p>



<a name="198883508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883508">(May 27 2020 at 12:29)</a>:</h4>
<p>no</p>



<a name="198883568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883568">(May 27 2020 at 12:30)</a>:</h4>
<p>Will I break all the tactics?</p>



<a name="198883580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883580">(May 27 2020 at 12:30)</a>:</h4>
<p>I don't think so</p>



<a name="198883598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883598">(May 27 2020 at 12:30)</a>:</h4>
<p>What we really want here is a way of inserting into the constructor a way of saying "I'm making a group and the user supplied only some of the fields, so make the rest using this construction" rather than redefining the type</p>



<a name="198883634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883634">(May 27 2020 at 12:31)</a>:</h4>
<p>in any case, the main consumer is <code>to_additive</code> and so you will know right away if it breaks</p>



<a name="198883763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883763">(May 27 2020 at 12:32)</a>:</h4>
<p>this exists, it is called auto params</p>



<a name="198883907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883907">(May 27 2020 at 12:33)</a>:</h4>
<p>It doesn't exist</p>



<a name="198883980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198883980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198883980">(May 27 2020 at 12:34)</a>:</h4>
<p>Let's take comm_group as an example</p>



<a name="198884037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198884037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198884037">(May 27 2020 at 12:35)</a>:</h4>
<p>It probably extends group, but now you don't want to ask for mul_one and one_mul, however because it's extending group there's no way of retrofitting the autoparam</p>



<a name="198884153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198884153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198884153">(May 27 2020 at 12:36)</a>:</h4>
<p>What we want is the ability not only to retrofit but also to ensure that when a hole command is used that we don't even show the autoparamed fields</p>



<a name="198884220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198884220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198884220">(May 27 2020 at 12:37)</a>:</h4>
<p>I know, I thought Chris already had a PR that does this</p>



<a name="198884345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198884345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198884345">(May 27 2020 at 12:38)</a>:</h4>
<p>you don't have to convince me that this is a good idea. Ideally this would get some lean support but as it is you just have to make a separate structure with an instance</p>



<a name="198884618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198884618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198884618">(May 27 2020 at 12:41)</a>:</h4>
<p>I will certainly grant that autoparams only solve some of the issues, and there are a lot more elaborate mechanisms I would like than what autoparams will give you. For example, defining a complete lattice where you only give the Sup, or only give the Inf, or only give the le</p>



<a name="198884649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198884649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198884649">(May 27 2020 at 12:41)</a>:</h4>
<p>or a group with left inverse and left unit, or right inverse and right unit</p>



<a name="198885083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885083">(May 27 2020 at 12:45)</a>:</h4>
<p>It would be (relatively) easy to write a tactic that gets all these fields and has a store of constructor candidates containing a subset of all the fields and constructing the rest, and applies the first one where the input subset matches</p>



<a name="198885154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885154">(May 27 2020 at 12:46)</a>:</h4>
<p>but since structure literals are implemented in C++ inextensibly it's tricky to do something like this</p>



<a name="198885384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885384">(May 27 2020 at 12:48)</a>:</h4>
<p>and it would be nice as a library author to be able to provide all these constructor candidates</p>



<a name="198885425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885425">(May 27 2020 at 12:49)</a>:</h4>
<p>right now they are these terrible <code>mk'</code> theorems with 14 hypotheses and no syntax support</p>



<a name="198885597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885597">(May 27 2020 at 12:51)</a>:</h4>
<p>Right, it would be lovely to see the back of those. It's embarrassing showing undergraduates the official definition of a comm_group in Lean but at least syntax support would help</p>



<a name="198885660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885660">(May 27 2020 at 12:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113488-general/topic/ancestor.20attribute/near/198884037">said</a>:</p>
<blockquote>
<p>It probably extends group, but now you don't want to ask for mul_one and one_mul, however because it's extending group there's no way of retrofitting the autoparam</p>
</blockquote>
<p>Actually you can retrofit autoparams. You just add the field in the child structure a second time with the same name and a default definition</p>



<a name="198885885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885885">(May 27 2020 at 12:53)</a>:</h4>
<p>Ha! Does this really work? With old structure command on?</p>



<a name="198885942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885942">(May 27 2020 at 12:54)</a>:</h4>
<p>yeah, I think it is used in <code>monad</code> for example</p>



<a name="198885971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885971">(May 27 2020 at 12:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> Are you aware of this <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="198885978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885978">(May 27 2020 at 12:54)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">monad</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">applicative</span> <span class="n">m</span><span class="o">,</span> <span class="n">has_bind</span> <span class="n">m</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">α</span> <span class="n">β</span> <span class="n">f</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">&gt;&gt;=</span> <span class="n">pure</span> <span class="err">∘</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">seq</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">α</span> <span class="n">β</span> <span class="n">f</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span> <span class="bp">&gt;&gt;=</span> <span class="o">(</span><span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">x</span><span class="o">))</span>
</code></pre></div>



<a name="198885994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885994">(May 27 2020 at 12:54)</a>:</h4>
<p>These are default values, not auto params.</p>



<a name="198885996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198885996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198885996">(May 27 2020 at 12:54)</a>:</h4>
<p>both <code>map</code> and <code>seq</code> are coming from superclasses</p>



<a name="198886032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886032">(May 27 2020 at 12:55)</a>:</h4>
<p>true, I think I mean opt param not auto param</p>



<a name="198886070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886070">(May 27 2020 at 12:55)</a>:</h4>
<p>And the fact that you can declare the default values afterwards requires workarounds which then cause <a href="https://github.com/leanprover-community/lean/issues/197">lean#197</a>. (EDIT: wrong issue number, thanks <span class="user-mention" data-user-id="110087">@Scott Morrison</span>)</p>



<a name="198886162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886162">(May 27 2020 at 12:56)</a>:</h4>
<p>Oh, I had no idea that was related</p>



<a name="198886186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886186">(May 27 2020 at 12:56)</a>:</h4>
<p>have you diagnosed that issue?</p>



<a name="198886433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886433">(May 27 2020 at 12:59)</a>:</h4>
<p>Yes, it goes as follows: since default values may be declared at any point, we can't elaborate the fields from left to right.  Instead, they are elaborated in some sort of dependency order: a field may only be elaborated when its type no longer contains any metavariables.  In order to reduce the metavariables (this is crucial for new-style structures), projections are reduced.  And this is why typeclass notation vanishes.</p>



<a name="198886687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886687">(May 27 2020 at 13:01)</a>:</h4>
<p>Oh, this sounds like it could also be related to <a href="https://github.com/leanprover-community/lean/issues/197">lean#197</a>.</p>



<a name="198886841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198886841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198886841">(May 27 2020 at 13:02)</a>:</h4>
<p>This is not at all how I expected opt params to be handled</p>



<a name="198887053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887053">(May 27 2020 at 13:03)</a>:</h4>
<p>Why not eagerly remove <code>auto_param</code> and <code>opt_param</code> markers from the types first (and store them in an internal data structure)? They aren't supposed to be part of the type system proper, they are just annotations that live in expr because everything does</p>



<a name="198887191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887191">(May 27 2020 at 13:04)</a>:</h4>
<p>Oh, they are stored in an internal data structure. (Check out <code>#print prefix monad.map</code>)</p>



<a name="198887332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887332">(May 27 2020 at 13:05)</a>:</h4>
<p>To be clear, default values for structures are stored as separate declations.  auto params are not, and optional arguments of definitions are not either.</p>



<a name="198887521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887521">(May 27 2020 at 13:07)</a>:</h4>
<p>Here's an idea: always elaborate elements of a structure in left to right order of use in the literal</p>



<a name="198887624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887624">(May 27 2020 at 13:08)</a>:</h4>
<p>no this is not backward compatible, but it is simple and easy to reason about</p>



<a name="198887625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887625">(May 27 2020 at 13:08)</a>:</h4>
<p>When should default values and auto param fields be elaborated?</p>



<a name="198887808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887808">(May 27 2020 at 13:10)</a>:</h4>
<p>default values don't need to be elaborated, auto params go at the end</p>



<a name="198887913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198887913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198887913">(May 27 2020 at 13:11)</a>:</h4>
<p>I don't think it would be a good idea to have an invisible auto param providing data that is later referenced by a user-provided dependent argument</p>



<a name="198888089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198888089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198888089">(May 27 2020 at 13:12)</a>:</h4>
<blockquote>
<p>default values don't need to be elaborated</p>
</blockquote>
<p>I'm not sure if that's how it's implemented.</p>



<a name="198888200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198888200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198888200">(May 27 2020 at 13:13)</a>:</h4>
<p>I mean you already have an elaborated expr corresponding to the default value. You just need to substitute the values of the other fields in it</p>



<a name="198888304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198888304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198888304">(May 27 2020 at 13:14)</a>:</h4>
<p>but it can be used by later fields, so its effective elaboration order would be just before first use in a dependent arg</p>



<a name="198888385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198888385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198888385">(May 27 2020 at 13:15)</a>:</h4>
<p>I had something like this implemented already (elaborating fields left-to-right), and it choked on default arguments in <code>monad</code>.  Let me see again what's going wrong.</p>



<a name="198888521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198888521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198888521">(May 27 2020 at 13:16)</a>:</h4>
<p>In particular that means that if you have a monad instance with <code>map_comp</code> and <code>map := x &gt;&gt;= pure ∘ f</code> then you can't write <code>map_comp := ...</code> before <code> pure := ...</code> and <code>bind := ...</code> unless you have also provided <code>map := ...</code></p>



<a name="198890136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198890136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198890136">(May 27 2020 at 13:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/ancestor.20attribute/near/198886032">said</a>:</p>
<blockquote>
<p>true, I think I mean opt param not auto param</p>
</blockquote>
<p>in which case, so did I</p>



<a name="198906723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ancestor%20attribute/near/198906723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/ancestor.20attribute.html#198906723">(May 27 2020 at 15:15)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/282">lean#282</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>