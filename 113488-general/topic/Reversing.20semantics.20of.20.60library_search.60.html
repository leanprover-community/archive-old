---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html">Reversing semantics of `library_search`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204420734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204420734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204420734">(Jul 20 2020 at 13:18)</a>:</h4>
<p>Currently <code>library_search</code> only unfolds <code>reducible</code> definitions when trying to apply lemmas (or local facts), while <code>library_search!</code> uses the default behaviour of <code>apply</code>, that is, it will look through normal definitions.</p>



<a name="204420781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204420781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204420781">(Jul 20 2020 at 13:19)</a>:</h4>
<p>The reason for this is that often you're looking for a suitable rewriting lemma, and being told <code>rfl</code> isn't very helpful.</p>



<a name="204420814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204420814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204420814">(Jul 20 2020 at 13:19)</a>:</h4>
<p>Also, with the default behaviour of apply you're more likely to get "weird" answers...</p>



<a name="204420840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204420840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204420840">(Jul 20 2020 at 13:19)</a>:</h4>
<p>However <code>library_search</code> is definitely weaker than <code>library_search!</code>, if all you want is an answer.</p>



<a name="204420920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204420920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204420920">(Jul 20 2020 at 13:20)</a>:</h4>
<p>I am tempted to reverse the semantics, and have <code>library_search</code> be the "by all any means necessary" tactic, and <code>library_search!</code> be the more refined option.</p>



<a name="204420993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204420993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204420993">(Jul 20 2020 at 13:21)</a>:</h4>
<p>In my experience from last week, beginners want the brute force option, while experts want the subtler one, so we should make the experts work harder to get what they want.</p>



<a name="204426617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204426617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204426617">(Jul 20 2020 at 14:10)</a>:</h4>
<p>Makes sense to me..., except that <code>!</code> seems to a mnemonic for "apply more force". How about <code>'</code>? Or is that too generic a suffix?</p>



<a name="204446292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204446292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204446292">(Jul 20 2020 at 16:47)</a>:</h4>
<p>It seems reasonable to make the current <code>library_search!</code> the default one.<br>
As Johan said, I don't think <code>library_search!</code> is a good name for the current <code>library_search</code>. We could just use a different name, like <code>quick_search</code>? Or if we want the same name, maybe <code>library_search-</code>?</p>



<a name="204446478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204446478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204446478">(Jul 20 2020 at 16:49)</a>:</h4>
<p><code>library_search♭</code> — the joys of unicode</p>



<a name="204446809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204446809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204446809">(Jul 20 2020 at 16:52)</a>:</h4>
<p>We could have <code>set_option old_library_search true</code></p>



<a name="204446827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204446827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204446827">(Jul 20 2020 at 16:52)</a>:</h4>
<p>That seemed to work well for structures :P</p>



<a name="204475396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204475396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204475396">(Jul 20 2020 at 21:00)</a>:</h4>
<p>I think that matches that abuse defeq should be discouraged to newcomers</p>



<a name="204475478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204475478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204475478">(Jul 20 2020 at 21:01)</a>:</h4>
<p>for the exact reason that they shouldn't need to know the defeqs to make sense of the lemma and why it works</p>



<a name="204475598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204475598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204475598">(Jul 20 2020 at 21:02)</a>:</h4>
<p>so I don't think that we should make <code>library_search!</code> the default. It could possibly be a fallback if the usual search fails</p>



<a name="204502698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204502698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204502698">(Jul 21 2020 at 00:57)</a>:</h4>
<p>Yes --- Mario makes a good point too. I'm conflicted.</p>



<a name="204502771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204502771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204502771">(Jul 21 2020 at 00:58)</a>:</h4>
<p>Regarding the "matches that abuse defeq should be discouraged to newcomers" --- if the _only_ match requires unfolding something semireducible, is it better to fail, or return that match?</p>



<a name="204502772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204502772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204502772">(Jul 21 2020 at 00:58)</a>:</h4>
<p>That's the essential question I'm unsure of.</p>



<a name="204502924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204502924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204502924">(Jul 21 2020 at 01:01)</a>:</h4>
<p>If we think it's better to return that match, there are three options:</p>
<ol>
<li>swap the semantics</li>
<li>have <code>library_search</code> do two passes, the first time with current <code>library_search</code> behaviour, the second time with current <code>library_search!</code> behaviour</li>
<li>just do one pass, looking for lemmas that apply with standard <code>apply</code> settings. If one is found, try again with the same lemma, with <code>apply { md := reducible }</code>. If it matches with <code>reducible</code>, return that solution immediately. If it doesn't, stash this lemma away, and continue through the rest of the library. If the rest of the library fails, return the lemma that we found that works with standard <code>apply</code> settings.</li>
</ol>



<a name="204502978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204502978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204502978">(Jul 21 2020 at 01:02)</a>:</h4>
<p>All three options are bad:</p>
<ol>
<li>we'll be returning many more up-to-defeq solutions, like we did until a month ago</li>
<li>it will take twice as long to run anytime it fails</li>
<li>it involves a substantial rewrite :-)</li>
</ol>



<a name="204511670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204511670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204511670">(Jul 21 2020 at 04:33)</a>:</h4>
<p><span class="user-mention" data-user-id="130491">@Scott Olson</span> I'm sure that you realise that the badness of (3) is categorically different from the badness in (1) and (2).<br>
But of course I understand your point completely. <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="204511676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204511676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204511676">(Jul 21 2020 at 04:33)</a>:</h4>
<p>So, let's at least not forget about (3), even if we don't choose it immediately. It might be a good limit point that we want to converge to.</p>



<a name="204512273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204512273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204512273">(Jul 21 2020 at 04:51)</a>:</h4>
<p>I think you meant to ping a different Scott?</p>



<a name="204512512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reversing%20semantics%20of%20%60library_search%60/near/204512512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reversing.20semantics.20of.20.60library_search.60.html#204512512">(Jul 21 2020 at 04:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span> <br>
Scott Olson: Oops, sorry for the bad ping.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>