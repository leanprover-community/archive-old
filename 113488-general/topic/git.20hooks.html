---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/git.20hooks.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html">git hooks</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="210958859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210958859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210958859">(Sep 23 2020 at 04:40)</a>:</h4>
<p>How to loose a file with the (possibly, outdated) git hooks suggested by the installation instructions:</p>
<ol>
<li>While on branch <code>A</code>, create a new file, don't add it to <code>git</code>.</li>
<li>Make a commit.</li>
<li>Switch to branch <code>B</code>.</li>
<li>(optional) work on branch <code>B</code>.</li>
<li>Add some text to the new file.</li>
<li>Do not make a commit.</li>
<li>Switch to branch <code>A</code>.</li>
</ol>
<p>On step <code>2</code> the file is added to the cache, on step <code>7</code> it is overridden with an older version from cache. I've just lost Jensen's inequality for integrals this way.</p>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> What do you think about ignoring files which are not in <code>git</code> in <code>leanproject mk-cache</code>?</p>



<a name="210958878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210958878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210958878">(Sep 23 2020 at 04:41)</a>:</h4>
<p>Do the caches touch lean files?</p>



<a name="210958881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210958881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210958881">(Sep 23 2020 at 04:41)</a>:</h4>
<p>They should only do things with olean files, right?</p>



<a name="210958893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210958893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210958893">(Sep 23 2020 at 04:41)</a>:</h4>
<p>I'm sorry to hear that you lost some exciting code.</p>



<a name="210959315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210959315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210959315">(Sep 23 2020 at 04:53)</a>:</h4>
<p>I lost a _lot_ of stuff to (probably) exactly this a month ago, but didn't know what it was <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span> thanks for diagnosing it, Yury.</p>



<a name="210960310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210960310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210960310">(Sep 23 2020 at 05:18)</a>:</h4>
<p>Yes, caches touch lean files, probably to ensure that the unpacked <code>.olean</code>s match <code>.lean</code>s.</p>



<a name="210964782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210964782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210964782">(Sep 23 2020 at 06:56)</a>:</h4>
<p>I'm sorry to read that. I never used those commit hooks. In principle there is no obstruction to archive only files that git knows about. The archiving function is <a href="https://github.com/leanprover-community/mathlib-tools/blob/master/mathlibtools/lib.py#L101-L115">https://github.com/leanprover-community/mathlib-tools/blob/master/mathlibtools/lib.py#L101-L115</a></p>



<a name="210964808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210964808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210964808">(Sep 23 2020 at 06:56)</a>:</h4>
<p>You can open an issue in the mathlibtools repo and I'll try to find time to work on it (or you can open a PR!).</p>



<a name="210965100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210965100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210965100">(Sep 23 2020 at 07:00)</a>:</h4>
<p>I'll try to make a PR.</p>



<a name="210983720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/git%20hooks/near/210983720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/git.20hooks.html#210983720">(Sep 23 2020 at 10:23)</a>:</h4>
<p>I have used the hooks up until now, but have recently decided that they actually make life slower rather than faster (because my computer finds local caches and unpacks them, after which I discover they are not what I wanted, and then have to go looking for a cache with <code>leanproject -f up</code>).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>