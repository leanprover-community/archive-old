---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Reordering.20ext.20lemmas.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html">Reordering ext lemmas</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261581547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261581547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261581547">(Nov 16 2021 at 00:27)</a>:</h4>
<p>It seems the ext tactic is sensitive to the order in which lemmas are stated and/or tagged as ext (this is what I think is happening but frankly I'm a bit confused still).<br>
In a PR me and <span class="user-mention" data-user-id="112680">@Johan Commelin</span> are working on we reorder some a bunch of imports and correspondingly the proof at <a href="https://github.com/leanprover-community/mathlib/blob/master/src/algebraic_geometry/presheafed_space/has_colimits.lean#L253">https://github.com/leanprover-community/mathlib/blob/master/src/algebraic_geometry/presheafed_space/has_colimits.lean#L253</a> breaks.<br>
You can simulate this locally by adding the line <code>attribute [ext] continuous_map.ext</code> before that theorem, even though this is already an ext lemma, applying the ext attribute seems to cause this to fire first and leave the proof in a different state.</p>
<p>The specific question is what if anything should we do about this sort of behaviour when we observe it? If this was about simp-lemmas I'd look for more lemmas to add to make the simp-set confluent again, should something analogous be done here? <br>
In this (or indeed any) specific example I can use <code>ext?</code> to replace the <code>ext</code> proof with some explicit <code>apply</code> statements, but I'd like to avoid that if possible.<br>
<span class="user-mention" data-user-id="110087">@Scott Morrison</span> I guess you know the design of this area the best?</p>



<a name="261583234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583234">(Nov 16 2021 at 00:46)</a>:</h4>
<p>What's the other ext lemma involved here that isn't <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous_map.ext">docs#continuous_map.ext</a>?</p>



<a name="261583267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583267">(Nov 16 2021 at 00:46)</a>:</h4>
<p>Yes, <code>ext</code> applies lemmas tagged <code>@[ext]</code> (or automatically generated by putting the <code>@[ext]</code> attribute on a structure in reverse order as they have been added to the environment.</p>



<a name="261583282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583282">(Nov 16 2021 at 00:47)</a>:</h4>
<p>(i.e. most recent has priority)</p>



<a name="261583325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583325" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583325">(Nov 16 2021 at 00:47)</a>:</h4>
<p>I'm not sure there is a general purpose solution to this sort of problem.</p>



<a name="261583399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583399">(Nov 16 2021 at 00:48)</a>:</h4>
<p>Which is usually a feature, since things like <a href="https://leanprover-community.github.io/mathlib_docs/find/linear_map.ext">docs#linear_map.ext</a> should be in the same file as linear_map, making them the lowest priority by default compared to something like <a href="https://leanprover-community.github.io/mathlib_docs/find/dfinsupp.lhom_ext">docs#dfinsupp.lhom_ext</a></p>



<a name="261583403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583403">(Nov 16 2021 at 00:48)</a>:</h4>
<p><code>ext</code> lemmas mean "you can prove this identity by working 'componentwise' in some sense", but there are situations where there are different valid interpretations of "in some sense".</p>



<a name="261583491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583491">(Nov 16 2021 at 00:49)</a>:</h4>
<p>Sometimes using <code>ext1</code> is helpful. Other times I guess you'll have to resort to using <code>apply</code>.</p>



<a name="261583575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583575">(Nov 16 2021 at 00:50)</a>:</h4>
<p>The <code>ext</code> tactic itself can't be expected to be clever when you have defined multiple applicable <code>ext</code> lemmas.</p>



<a name="261583670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261583670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261583670">(Nov 16 2021 at 00:51)</a>:</h4>
<p>It looks like it will apply a specific <code>ext</code> lemma for a given type if you've registered one with <code>@[ext my_type]</code> before trying general <code>ext</code> lemmas, if I understand <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.ext1_core">docs#tactic.ext1_core</a> correctly.  It seems like there can be exactly one registered. (Just mentioning this because I hadn't seen this feature before.)</p>



<a name="261584164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261584164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261584164">(Nov 16 2021 at 00:56)</a>:</h4>
<p>I think to usefully diagnose this we need to know which two ext lemmas are fighting for priority here, which one is "right", and why we think it is "right"</p>



<a name="261587184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261587184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261587184">(Nov 16 2021 at 01:38)</a>:</h4>
<p>I shut my lean down for the night, but ext? should tell you the other one. I was wondering if giving ext lemmas priorities would help (currently it didn't do anything as far as I can tell)</p>



<a name="261587428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261587428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261587428">(Nov 16 2021 at 01:42)</a>:</h4>
<p>As in I was wondering if we should add some knowledge of priorities to the ext tactic</p>



<a name="261612132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261612132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261612132">(Nov 16 2021 at 08:55)</a>:</h4>
<p>They already can have priorities</p>



<a name="261638610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261638610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261638610">(Nov 16 2021 at 13:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Reordering.20ext.20lemmas/near/261612132">said</a>:</p>
<blockquote>
<p>They already can have priorities</p>
</blockquote>
<p>How do they work?<br>
Explicitly I want the following to apply <code>a</code> instead of <code>b</code>:<br>
import tactic.ext</p>
<p>@[ext, priority 10000]<br>
lemma a (f g : ℕ → ℕ) (h : f 1 = g 1) : f = g :=<br>
sorry</p>
<p>@[ext]<br>
lemma b (f g : ℕ → ℕ) (h : f 2 = g 2) : f = g :=<br>
sorry</p>
<p>lemma c (f g : ℕ → ℕ) : f = g :=<br>
begin<br>
  ext, -- want  <code>f 1 = g 1</code><br>
end</p>



<a name="261638943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261638943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261638943">(Nov 16 2021 at 13:21)</a>:</h4>
<blockquote>
<p>What's the other ext lemma involved here that isn't <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous_map.ext">docs#continuous_map.ext</a>?</p>
</blockquote>
<p>Did somebody already answer this question?  The mathlib4 ext tactic uses term indexing for the extensionality lemmas, and I'd like to figure out if there's going to be a problem.</p>



<a name="261639145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261639145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261639145">(Nov 16 2021 at 13:23)</a>:</h4>
<p>Nope I never answered sorry:<br>
The ext as it currently stands does:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>      <span class="n">apply</span> <span class="n">category_theory.limits.colimit.hom_ext</span><span class="o">,</span> <span class="n">intros</span> <span class="n">j</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">continuous_map.ext</span><span class="o">,</span> <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
</code></pre></div>
<p>if <code>continuous_map.ext</code> applies first then <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.limits.colimit.hom_ext">docs#category_theory.limits.colimit.hom_ext</a> doesn't apply</p>



<a name="261640894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261640894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261640894">(Nov 16 2021 at 13:36)</a>:</h4>
<p>This should be fine as long as the hom doesn't reducible reduce to <code>continuous_map</code>.</p>



<a name="261643483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261643483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261643483">(Nov 16 2021 at 13:55)</a>:</h4>
<p>It probably only instance reduces</p>



<a name="261644998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261644998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261644998">(Nov 16 2021 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113488-general/topic/Reordering.20ext.20lemmas/near/261583670">said</a>:</p>
<blockquote>
<p>It looks like it will apply a specific <code>ext</code> lemma for a given type if you've registered one with <code>@[ext my_type]</code> before trying general <code>ext</code> lemmas, if I understand <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.ext1_core">docs#tactic.ext1_core</a> correctly.  It seems like there can be exactly one registered. (Just mentioning this because I hadn't seen this feature before.)</p>
</blockquote>
<p>It is true that for every type it has one "preferred" <code>ext</code> lemma that it tries first. However, this <code>ext</code>attribute need not to have an explicit argument: it is the last <code>ext</code> lemma that proves an equality between objects of a specific type.</p>
<p>Currently, <code>ext</code> completely ignores priorities. I think I can fix that, but I'm not sure if that is worth doing in Lean 3.</p>



<a name="261646226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Reordering%20ext%20lemmas/near/261646226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Reordering.20ext.20lemmas.html#261646226">(Nov 16 2021 at 14:14)</a>:</h4>
<p>There was a long discussion in a previous PR about adding <code>priority</code> attributes to some <code>ext</code> lemmas (in the end we didn't). Was it really a no-op the whole time?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>