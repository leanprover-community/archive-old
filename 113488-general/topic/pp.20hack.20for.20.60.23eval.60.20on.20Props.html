---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html">pp hack for `#eval` on Props</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="243767574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243767574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243767574">(Jun 24 2021 at 10:46)</a>:</h4>
<p>I understand that <code>Prop</code> can't have <code>is_repr</code>, because it's a <code>Type</code> typeclass. However, it's slowly getting frustrating to have to write <code>#eval if (prop) then 123 else 0</code>; is there some chance that there could be a hack built-into the pretty-printer itself? or is it a lot of work?</p>



<a name="243767803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243767803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243767803">(Jun 24 2021 at 10:49)</a>:</h4>
<p>Is there a reason that <a href="https://leanprover-community.github.io/mathlib_docs/find/has_repr">docs#has_repr</a> (EDIT: that's the correct name, right?) can't be generalized to <code>Sort</code>?</p>



<a name="243767905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243767905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243767905">(Jun 24 2021 at 10:50)</a>:</h4>
<p>(yep, oopsie!)</p>



<a name="243767920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243767920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243767920">(Jun 24 2021 at 10:50)</a>:</h4>
<p>I assume there's a good reason, because there seems to always be a good reason to avoid <code>Sort</code>...</p>



<a name="243767995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243767995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243767995">(Jun 24 2021 at 10:51)</a>:</h4>
<p>oh although reading more, it seems to be <a href="https://leanprover-community.github.io/mathlib_docs/find/has_to_string">docs#has_to_string</a> instead of <a href="https://leanprover-community.github.io/mathlib_docs/find/has_repr">docs#has_repr</a>, but that's still <code>Type</code>-only</p>



<a name="243768133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768133">(Jun 24 2021 at 10:53)</a>:</h4>
<p>I'm not sure I understand: do you want an instance along the lines of:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">has_to_string</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="k">if</span> <span class="n">p</span> <span class="k">then</span> <span class="s2">"true"</span> <span class="k">else</span> <span class="s2">"false"</span><span class="o">⟩</span>
</code></pre></div>



<a name="243768146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768146">(Jun 24 2021 at 10:53)</a>:</h4>
<p>yeah essentially</p>



<a name="243768153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768153">(Jun 24 2021 at 10:53)</a>:</h4>
<p>Because this typechecks, apart from the issue that <code>p</code> does not have <code>[decidable p]</code></p>



<a name="243768224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768224">(Jun 24 2021 at 10:54)</a>:</h4>
<p><code>Prop : Type</code> after all</p>



<a name="243768376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768376">(Jun 24 2021 at 10:56)</a>:</h4>
<p>hmph yes; essentially my issue is that when I do something like <code>#eval 23121 \| 2342345235</code>, the output is <code>#0</code> (and a warning)</p>



<a name="243768394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768394">(Jun 24 2021 at 10:56)</a>:</h4>
<p>Now that you say this though, I'm not sure how to fix that though</p>



<a name="243768489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768489">(Jun 24 2021 at 10:57)</a>:</h4>
<p>Well, the real issue here is that there is no definable map <code>f : Prop → string</code> that is not constant! Let's say WLOG that <code>f true = "true"</code> and <code>f false = "false</code>", then <code>propext</code> implies that <code>f p = "true"</code> iff <code>p</code> is true and <code>f p = "false"</code> otherwise. So <code>f</code> decides propositions correctly.</p>



<a name="243768756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768756">(Jun 24 2021 at 11:00)</a>:</h4>
<p>So the only way you can define a <code>has_repr</code> instance like you want is using partial maps, i.e. </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">instance</span> <span class="o">:</span> <span class="n">has_repr</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩</span>
</code></pre></div>



<a name="243768906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243768906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243768906">(Jun 24 2021 at 11:02)</a>:</h4>
<p>You realize that every proposition is represented as <code>0</code> in the VM, no matter whether it is true or false?  meta doesn't let you get around that.</p>



<a name="243769057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243769057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243769057">(Jun 24 2021 at 11:04)</a>:</h4>
<p>I understand why it outputs what it does, but if there's some non-classical <code>decidable</code> instance it could be a lot more helpful to just use that implicitly, is my point. But it seems a lot harder than I envisioned it when I first posted this, with what you guys are saying</p>



<a name="243769241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243769241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243769241">(Jun 24 2021 at 11:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props/near/243768906">said</a>:</p>
<blockquote>
<p>You realize that every proposition is represented as <code>0</code> in the VM, no matter whether it is true or false?  meta doesn't let you get around that.</p>
</blockquote>
<p>I was just about to argue that Lean should not allow you to pattern-match on <code>Prop</code>s, so I am not surprised that all Props have the same representation :)</p>



<a name="243769496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243769496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243769496">(Jun 24 2021 at 11:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props/near/243769057">said</a>:</p>
<blockquote>
<p>I understand why it outputs what it does, but if there's some non-classical <code>decidable</code> instance it could be a lot more helpful to just use that implicitly, is my point. But it seems a lot harder than I envisioned it when I first posted this, with what you guys are saying</p>
</blockquote>
<p>The proper hack is to check whether the term is a Prop in eval_cmd, and then add <code>to_bool</code> in that case.</p>



<a name="243770451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243770451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243770451">(Jun 24 2021 at 11:20)</a>:</h4>
<p>(If I understand the source correctly, all <code>Sort</code>s have the same representation in the VM, right? Which makes sense for the same reason that all <code>Prop</code>s are the same.)</p>



<a name="243777408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777408">(Jun 24 2021 at 12:30)</a>:</h4>
<p>Eric, what would you want #eval to show?</p>



<a name="243777536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777536">(Jun 24 2021 at 12:30)</a>:</h4>
<p>some form of  true/false, I'm currently trying to learn some meta-code so I can code up the fix that Gabriel suggestsed</p>



<a name="243777634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777634">(Jun 24 2021 at 12:31)</a>:</h4>
<p>Then I would do example : 5 \mid 25 := dec_trivial, and check if it compiles</p>



<a name="243777693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777693">(Jun 24 2021 at 12:32)</a>:</h4>
<p>Or, for some other Props, by slim_check</p>



<a name="243777800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777800">(Jun 24 2021 at 12:33)</a>:</h4>
<p>kernel computation is way slower though</p>



<a name="243777803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777803">(Jun 24 2021 at 12:33)</a>:</h4>
<p>The first would use the decidable instance available, or if it can't, one can write a norm_num plugin to do so</p>



<a name="243777922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/pp%20hack%20for%20%60%23eval%60%20on%20Props/near/243777922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/pp.20hack.20for.20.60.23eval.60.20on.20Props.html#243777922">(Jun 24 2021 at 12:34)</a>:</h4>
<p>You can take a look at Mario's recent gcd, lcm, and coprime norm_num plugin PR, to see how to use VM computation to speed up proof construction</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>