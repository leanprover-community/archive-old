---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html">Local notation in a lemma not working</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204060364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204060364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204060364">(Jul 16 2020 at 09:03)</a>:</h4>
<p>Could anyone tell me why this doesn't work?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>



<a name="204060435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204060435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204060435">(Jul 16 2020 at 09:04)</a>:</h4>
<p>It fails because it cannot find <code>has_mul T</code>, but my hope was it would use the local infix instead.</p>



<a name="204060688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204060688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204060688">(Jul 16 2020 at 09:07)</a>:</h4>
<p>I've never seen local notation introduced in a lemma like this before. I think it's out of scope to the right of the <code>:</code> already.</p>



<a name="204061002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061002">(Jul 16 2020 at 09:11)</a>:</h4>
<p>I'm looking at this and there seem to be 3 problems:</p>



<a name="204061226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061226">(Jul 16 2020 at 09:14)</a>:</h4>
<ol>
<li><code>op</code> should be <code>op : T → T → T</code></li>
<li><code>*</code> will refer to the global <code>has_mul</code> and might not have been shadowed by the local one, to rule out this factor, better try another unicode</li>
<li>when 1&amp;2 is fixed, Lean seems to be confused by the syntax and give another error</li>
</ol>



<a name="204061370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061370">(Jul 16 2020 at 09:16)</a>:</h4>
<p>Nice catch</p>



<a name="204061389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061389">(Jul 16 2020 at 09:17)</a>:</h4>
<p>Lean is happy with</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span>  <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span>  <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">),</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>



<a name="204061392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061392">(Jul 16 2020 at 09:17)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">⬝</span> <span class="o">:=</span> <span class="n">op</span><span class="o">)</span> <span class="o">:</span>
<span class="n">a</span> <span class="bp">⬝</span> <span class="n">b</span> <span class="bp">⬝</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">⬝</span> <span class="o">(</span><span class="n">b</span> <span class="bp">⬝</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>gives</p>
<div class="codehilite"><pre><span></span><code><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span> <span class="n">goal</span>
<span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span>
<span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span>
<span class="err">⊢</span> <span class="err">⁇</span>

<span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span>
<span class="n">invalid</span> <span class="kn">definition</span><span class="o">,</span> <span class="err">&#39;</span><span class="bp">|</span><span class="err">&#39;</span> <span class="n">or</span> <span class="err">&#39;</span><span class="o">:=</span><span class="err">&#39;</span> <span class="n">expected</span>
<span class="mi">2</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span>
<span class="n">type</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">a</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="n">T</span>
<span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span>
<span class="n">command</span> <span class="n">expected</span>
</code></pre></div>



<a name="204061538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061538">(Jul 16 2020 at 09:19)</a>:</h4>
<p>It would be nice if I could push <code>op</code> back to the LHS of the colon, but this syntax isn't valid:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span>  <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">),</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>Is there a way to create a binder of no variables, as I attempt to do here?</p>



<a name="204061545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204061545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204061545">(Jul 16 2020 at 09:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working/near/204061389">said</a>:</p>
<blockquote>
<p>Lean is happy with</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span>  <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span>  <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">),</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


</blockquote>
<p>Oh, something might not survive moving from the right side of <code>:</code>/<code>∀</code> to the left side</p>



<a name="204064140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204064140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204064140">(Jul 16 2020 at 09:51)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>  <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span>
 <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">),</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>The above works. It seems that Lean need something that's not a definition to be after <code>∀</code> and it makes sense since without that, Lean can't form a pi type here.</p>



<a name="204066059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066059">(Jul 16 2020 at 10:16)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">⬝</span> <span class="o">:=</span> <span class="n">op</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span>
<span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span> <span class="k">begin</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">T : Type,</span>
<span class="cm">a b c : T,</span>
<span class="cm">op : T → T → T,</span>
<span class="cm">n : opt_param ℕ 1</span>
<span class="cm">⊢ a = a</span>

<span class="cm">-/</span>
</code></pre></div>



<a name="204066137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066137">(Jul 16 2020 at 10:18)</a>:</h4>
<p>The case above reveal the truth. Lean parser accepts such syntax for specifying optional parameter, but semantically it didn't register the infix under such syntax.</p>



<a name="204066363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066363">(Jul 16 2020 at 10:20)</a>:</h4>
<p>This would be even more obvious in the following example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">reserve</span> <span class="kn">infix</span> <span class="bp">⬝</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">a</span> <span class="bp">⬝</span> <span class="n">b</span> <span class="c1">-- Lean chokes as \cdot is not defined</span>

<span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">⬝</span> <span class="o">:=</span> <span class="n">op</span><span class="o">)</span> <span class="o">:</span>
<span class="n">a</span> <span class="bp">⬝</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">⬝</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="c1">-- Lean chokes with the same error message</span>
</code></pre></div>



<a name="204066443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066443">(Jul 16 2020 at 10:21)</a>:</h4>
<p><code>infix</code> binders are primarily used for structures. I've never seen them used in lemmas or in foralls</p>



<a name="204066501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066501">(Jul 16 2020 at 10:22)</a>:</h4>
<p>I suspect this is an accident of the grammar</p>



<a name="204066530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066530">(Jul 16 2020 at 10:22)</a>:</h4>
<p>In forall, it works:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span>  <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span>  <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">),</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">T : Type,</span>
<span class="cm">a b c : T</span>
<span class="cm">⊢ ∀ (op : T → T → T), op (op a b) c = op a (op b c)</span>
<span class="cm">-/</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204066544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066544">(Jul 16 2020 at 10:22)</a>:</h4>
<p>They have no actual impact on the shape of the term, they are not really foralls at all</p>



<a name="204066668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066668">(Jul 16 2020 at 10:24)</a>:</h4>
<p>plus lean doesn't even really have a concept of locally scoped notations, and the implementation here is kind of a hack</p>



<a name="204066673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066673">(Jul 16 2020 at 10:24)</a>:</h4>
<p>It may be just an unintentional side effect of some Lean C++ code for the one in forall to work while lhs of <code>:</code> doesn't</p>



<a name="204066767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066767">(Jul 16 2020 at 10:25)</a>:</h4>
<p>I'm curious to see what <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> thinks about these sort of local local notations</p>



<a name="204066833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066833">(Jul 16 2020 at 10:26)</a>:</h4>
<p>I can push all the binders out of the forall with a dummy unit argument:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">op_comm</span> <span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">T</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">T</span><span class="o">)</span> <span class="o">:</span>
    <span class="bp">∀</span> <span class="o">{</span><span class="bp">_</span> <span class="o">:</span> <span class="n">unit</span><span class="o">}</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">op</span><span class="o">),</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>which feels like a nasty hack</p>



<a name="204066885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204066885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204066885">(Jul 16 2020 at 10:27)</a>:</h4>
<p>It seems to be the same mechanism why the following works:</p>
<div class="codehilite"><pre><span></span><code><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="n">class</span> <span class="n">functor&#39;&#39;</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">},</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">β</span><span class="o">)</span>
<span class="o">(</span><span class="kn">infixr</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">:=</span> <span class="n">map</span><span class="o">)</span>
</code></pre></div>


<p>(from <a href="https://github.com/leanprover/lean/wiki/Refactoring-structures#other-goodies">https://github.com/leanprover/lean/wiki/Refactoring-structures#other-goodies</a> ) </p>
<p>Lean seems to be able to pick the notation up in general.</p>



<a name="204067044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067044">(Jul 16 2020 at 10:29)</a>:</h4>
<p>yes, that's what I mean</p>



<a name="204067067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067067">(Jul 16 2020 at 10:29)</a>:</h4>
<p>That's just a "binder sequence", and binder sequences appear elsewhere in the grammar as well</p>



<a name="204067078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067078">(Jul 16 2020 at 10:29)</a>:</h4>
<p>Yeah, I saw the notation for classes and wondered if I could get away with it for lemmas</p>



<a name="204067146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067146">(Jul 16 2020 at 10:30)</a>:</h4>
<p>Is there such a thing as an empty binder sequence in the grammar?</p>



<a name="204067177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067177">(Jul 16 2020 at 10:30)</a>:</h4>
<p>Not directly. You can't write <code>\forall, 2 = 2</code> for example</p>



<a name="204067198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067198">(Jul 16 2020 at 10:31)</a>:</h4>
<p>But you can write structures with no fields</p>



<a name="204067307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067307">(Jul 16 2020 at 10:32)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">unit&#39;</span> <span class="o">:=</span> <span class="n">mk</span>
<span class="kn">structure</span> <span class="n">unit&#39;&#39;</span> <span class="o">:=</span> <span class="n">mk</span> <span class="bp">::</span>
</code></pre></div>



<a name="204067344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067344">(Jul 16 2020 at 10:33)</a>:</h4>
<p>you would think that <code>structure unit''' := </code> or <code>structure unit''' := .</code> or <code>structure unit'''.</code> would work but no</p>



<a name="204067445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067445">(Jul 16 2020 at 10:34)</a>:</h4>
<p>bizarrely, <code>structure unit'''' (x : ℕ)</code> <em>does</em> work</p>



<a name="204067512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067512">(Jul 16 2020 at 10:35)</a>:</h4>
<p>which means that</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">unit&#39;&#39;&#39;&#39;</span> <span class="o">(</span><span class="kn">infix</span> <span class="bp">`*`</span> <span class="o">:=</span> <span class="bp">ℕ</span><span class="o">)</span>
</code></pre></div>


<p>also works</p>



<a name="204067525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067525">(Jul 16 2020 at 10:35)</a>:</h4>
<p>These are all interesting parsing edge cases that may or may not survive when Lean 4 comes.</p>



<a name="204067571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067571">(Jul 16 2020 at 10:36)</a>:</h4>
<p>I sure hope they die</p>



<a name="204067583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067583">(Jul 16 2020 at 10:36)</a>:</h4>
<p>But it's interesting to read the related C++ code</p>



<a name="204067605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067605">(Jul 16 2020 at 10:36)</a>:</h4>
<p>I can tell it's a ball of hacks and I don't even need to read the code</p>



<a name="204067655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067655">(Jul 16 2020 at 10:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="296911">Utensil Song</span> <a href="#narrow/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working/near/204066885">said</a>:</p>
<blockquote>
<p>It seems to be the same mechanism why the following works:</p>
<div class="codehilite"><pre><span></span><code><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="n">class</span> <span class="n">functor&#39;&#39;</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">},</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">β</span><span class="o">)</span>
<span class="o">(</span><span class="kn">infixr</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="o">:=</span> <span class="n">map</span><span class="o">)</span>
</code></pre></div>


<p>(from <a href="https://github.com/leanprover/lean/wiki/Refactoring-structures#other-goodies">https://github.com/leanprover/lean/wiki/Refactoring-structures#other-goodies</a> ) </p>
<p>Lean seems to be able to pick the notation up in general.</p>
</blockquote>
<p>But I do wish this one to survive</p>



<a name="204067705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067705">(Jul 16 2020 at 10:38)</a>:</h4>
<p>It's very useful</p>



<a name="204067713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067713">(Jul 16 2020 at 10:38)</a>:</h4>
<p>I would prefer to see it replaced by a proper notation scoping system</p>



<a name="204067748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067748">(Jul 16 2020 at 10:38)</a>:</h4>
<p>Otherwise, I don't know how to express this: <a href="#narrow/stream/113488-general/topic/unbundled.20v.2Es.2E.20%28semi-%29bundled/near/204051388">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/unbundled.20v.2Es.2E.20%28semi-%29bundled/near/204051388</a></p>



<a name="204067784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067784">(Jul 16 2020 at 10:39)</a>:</h4>
<p>fields with <code>:=</code> are nothing special</p>



<a name="204067798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067798">(Jul 16 2020 at 10:39)</a>:</h4>
<p>those are just sugar for <code>opt_param</code></p>



<a name="204067939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067939">(Jul 16 2020 at 10:41)</a>:</h4>
<p>What's the un-sugared syntax, and where can I read about it?</p>



<a name="204067947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204067947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204067947">(Jul 16 2020 at 10:41)</a>:</h4>
<p>Unable to define notations in the process of defining a new structure/class, will make me break a structure/class into a few classes, with notations defined between them.</p>



<a name="204068037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068037">(Jul 16 2020 at 10:42)</a>:</h4>
<p>Or I can't use notations to express Props using the operations defined for the class</p>



<a name="204068148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068148">(Jul 16 2020 at 10:44)</a>:</h4>
<p><code>(x : A := a)</code> is sugar for <code>(x : opt_param A a)</code></p>



<a name="204068187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068187">(Jul 16 2020 at 10:45)</a>:</h4>
<p>note that <code>opt_param A a</code> is defeq to <code>A</code> so this doesn't cause any typing problems, but the tag is used by lean as an elaboration hint</p>



<a name="204068234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068234">(Jul 16 2020 at 10:45)</a>:</h4>
<p>Think</p>
<div class="codehilite"><pre><span></span><code><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="n">class</span> <span class="n">semigroup</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="o">:=</span>
<span class="o">(</span><span class="n">mul</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">→</span> <span class="n">G</span> <span class="bp">→</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="kn">infix</span> <span class="bp">⬝</span> <span class="o">:=</span> <span class="n">mul</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_assoc</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">a</span> <span class="bp">⬝</span> <span class="n">b</span> <span class="bp">⬝</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">⬝</span> <span class="o">(</span><span class="n">b</span> <span class="bp">⬝</span> <span class="n">c</span><span class="o">))</span>
</code></pre></div>


<p>for more complicated cases.</p>



<a name="204068326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068326">(Jul 16 2020 at 10:46)</a>:</h4>
<p>I don't object to notations local to a structure at all (although I think that the gain is largely illusory since it doesn't survive parsing)</p>



<a name="204068362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068362">(Jul 16 2020 at 10:47)</a>:</h4>
<p>I think that it should be part of an actual scoping system though</p>



<a name="204068373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068373">(Jul 16 2020 at 10:47)</a>:</h4>
<p>rather than just something specific to binder sequences</p>



<a name="204068440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068440">(Jul 16 2020 at 10:48)</a>:</h4>
<p>like there should be a <code>let infix</code> term constructor</p>



<a name="204068486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068486">(Jul 16 2020 at 10:48)</a>:</h4>
<blockquote>
<p>it doesn't survive parsing</p>
</blockquote>
<p>Oh, that's true. I was already using the break-into-a-few-classes-and-define-notations-in-between way before I learned the existence of such a syntax. So I didn't notice it.</p>



<a name="204068626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068626">(Jul 16 2020 at 10:50)</a>:</h4>
<p>if you just write one mega structure with 50 fields and several notation-worthy fields, and don't try to prove anything about the structure, then you will think this trick is great</p>



<a name="204068649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068649">(Jul 16 2020 at 10:50)</a>:</h4>
<p>but once you try to inhabit the structure you will find it isn't very easy to work with the resulting structure definition</p>



<a name="204068893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068893">(Jul 16 2020 at 10:54)</a>:</h4>
<p>Yes, for one, I noticed I still have to add</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span><span class="n">f</span><span class="err">ᵣ</span><span class="bp">_</span><span class="n">defeq</span><span class="o">:</span> <span class="n">f</span><span class="err">ᵣ</span> <span class="bp">=</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">G</span><span class="o">)</span>
</code></pre></div>


<p>even after I have</p>
<div class="codehilite"><pre><span></span><code><span class="o">(</span><span class="n">f</span><span class="err">ᵣ</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→+*</span> <span class="n">G</span> <span class="o">:=</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">G</span><span class="o">)</span>
</code></pre></div>



<a name="204068967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068967">(Jul 16 2020 at 10:55)</a>:</h4>
<p>because the equality implied by <code>:=</code> is only optional</p>



<a name="204068986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204068986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204068986">(Jul 16 2020 at 10:55)</a>:</h4>
<p>yep, the <code>:=</code> is just a guideline</p>



<a name="204069087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204069087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204069087">(Jul 16 2020 at 10:56)</a>:</h4>
<p>it would be nice if structures actually supported let binders in the constructor. I think Coq does</p>



<a name="204070096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204070096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204070096">(Jul 16 2020 at 11:10)</a>:</h4>
<p>Do you want <code>(notation `fᵣ`  := (algebra_map R G : R →+* G))</code>?</p>



<a name="204093787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/204093787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#204093787">(Jul 16 2020 at 14:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working/near/204068440">said</a>:</p>
<blockquote>
<p>like there should be a <code>let infix</code> term constructor</p>
</blockquote>
<p>But there is.</p>
<div class="codehilite"><pre><span></span><code><span class="bp">#</span><span class="kn">check</span> <span class="k">let</span> <span class="kn">infix</span> <span class="bp">*</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul</span> <span class="k">in</span> <span class="mi">1</span> <span class="bp">*</span> <span class="mi">2</span>
</code></pre></div>


<p>Don't get too attached to it, however; since no-one has ever used - or apparently needed - it as far as we know, we will drop that one in Lean 4 since it complicates hygiene quite a bit. I think the introduction of proper namespace-scoped notations should more than offset that.</p>



<a name="205577830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205577830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205577830">(Jul 31 2020 at 10:38)</a>:</h4>
<p>I've found that syntax quite useful for introducing notation in a recursive definition like</p>
<div class="codehilite"><pre><span></span><code><span class="n">reserve</span> <span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span><span class="o">:</span><span class="mi">70</span>
<span class="n">def</span> <span class="n">wedge</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">n</span><span class="o">},</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">⟨</span><span class="n">x₁</span><span class="o">,</span> <span class="n">x₂</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y₁</span><span class="o">,</span> <span class="n">y₂</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="k">let</span> <span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">wedge</span> <span class="k">in</span>
    <span class="o">(</span><span class="n">x₂</span> <span class="err">⋏</span> <span class="n">y₂</span><span class="o">,</span> <span class="n">x₁</span> <span class="err">⋏</span> <span class="n">y₂</span> <span class="bp">+</span> <span class="n">x₂</span> <span class="err">⋏</span> <span class="err">̅</span><span class="n">y₁</span><span class="err">ᵈ</span><span class="o">)</span>
<span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">wedge</span>
</code></pre></div>


<p>It still feels clumsy, but it would be great if whatever replaces <code>let infix</code> enables a similar approach</p>



<a name="205580136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205580136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205580136">(Jul 31 2020 at 11:16)</a>:</h4>
<p>What about declaring <code>has_wedge.wedge</code> first, then notation, then make an instance and implement wedge in it? This way would survive Lean 4 and the storyline is still clear?</p>



<a name="205580798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205580798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205580798">(Jul 31 2020 at 11:27)</a>:</h4>
<p>That issue is quite similar to the common pattern of declaring a structure/class with a notation, which is a bit awkward as well (having to redeclare the notation outside). I'd like to improve that one in Lean 4, so it would make sense to find a general solution that also works for <code>def</code> etc.</p>



<a name="205581735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205581735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205581735">(Jul 31 2020 at 11:42)</a>:</h4>
<p>Ah, my idea doesn't seem to work, Lean doesn't accept equation compiler in structure (not an <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> , a sketch of the syntax idea):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">universe</span> <span class="n">u</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span>

<span class="c1">-- multivectors</span>
<span class="n">def</span> <span class="n">Gₙ</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Gₙ</span> <span class="n">n</span> <span class="bp">×</span> <span class="n">Gₙ</span> <span class="n">n</span>

<span class="n">class</span> <span class="n">has_wedge</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">wedge</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span>
<span class="n">class</span> <span class="n">has_vee</span>   <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">vee</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span>

<span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span><span class="o">:</span><span class="mi">70</span> <span class="o">:=</span> <span class="n">has_wedge</span><span class="bp">.</span><span class="n">wedge</span>
<span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋎</span> <span class="bp">`</span><span class="o">:</span><span class="mi">70</span> <span class="o">:=</span> <span class="n">has_vee</span><span class="bp">.</span><span class="n">vee</span>

<span class="n">class</span> <span class="n">has_ga_ops</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">has_wedge</span> <span class="n">α</span><span class="o">,</span> <span class="n">has_vee</span> <span class="n">α</span>

<span class="kn">instance</span> <span class="n">ga_ops</span> <span class="o">:</span> <span class="n">has_ga_ops</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">{</span><span class="n">n</span><span class="o">},</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
    <span class="n">wedge</span>
    <span class="bp">|</span> <span class="mi">0</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
    <span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">⟨</span><span class="n">x₁</span><span class="o">,</span> <span class="n">x₂</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y₁</span><span class="o">,</span> <span class="n">y₂</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="o">(</span><span class="n">x₂</span> <span class="err">⋏</span> <span class="n">y₂</span><span class="o">,</span> <span class="n">x₁</span> <span class="err">⋏</span> <span class="n">y₂</span> <span class="bp">+</span> <span class="n">x₂</span> <span class="err">⋏</span> <span class="err">̅</span><span class="n">y₁</span><span class="err">ᵈ</span><span class="o">),</span>
    <span class="n">vee</span>
    <span class="bp">|</span> <span class="mi">0</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
    <span class="bp">|</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">⟨</span><span class="n">x₁</span><span class="o">,</span> <span class="n">x₂</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y₁</span><span class="o">,</span> <span class="n">y₂</span><span class="bp">⟩</span> <span class="o">:=</span>  <span class="o">(</span><span class="n">x₁</span> <span class="err">⋎</span> <span class="n">y₂</span> <span class="bp">+</span> <span class="err">̅</span><span class="n">x₂</span> <span class="err">⋎</span> <span class="n">y₁</span><span class="o">,</span> <span class="n">x₂</span> <span class="err">⋎</span> <span class="n">y₂</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div>



<a name="205581889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205581889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205581889">(Jul 31 2020 at 11:45)</a>:</h4>
<p>oh wow that seems really hard to support</p>



<a name="205582498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205582498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205582498">(Jul 31 2020 at 11:55)</a>:</h4>
<p>Is the solution to allow forward declarations? If I could forward declare <code>def wedge : the_type := by patience</code>, I could then associate a notation with it, and then fill out the definition later. Of course, this is still difficult in the equation compiler, where the local <code>wedge</code> isn't quite the global one.</p>



<a name="205582584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205582584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205582584">(Jul 31 2020 at 11:56)</a>:</h4>
<p>It really should be</p>
<div class="codehilite"><pre><span></span><code><span class="n">mutual</span>
  <span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span><span class="o">:</span><span class="mi">70</span> <span class="bp">=&gt;</span> <span class="n">wedge</span>
  <span class="n">def</span> <span class="n">wedge</span> <span class="o">:</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">_</span><span class="o">}</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span>
  <span class="bp">|</span> <span class="mi">0</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x₁</span><span class="o">,</span> <span class="n">x₂</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y₁</span><span class="o">,</span> <span class="n">y₂</span><span class="bp">⟩</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">x₂</span> <span class="err">⋏</span> <span class="n">y₂</span><span class="o">,</span> <span class="n">x₁</span> <span class="err">⋏</span> <span class="n">y₂</span> <span class="bp">+</span> <span class="n">x₂</span> <span class="err">⋏</span> <span class="err">̅</span><span class="n">y₁</span><span class="err">ᵈ</span><span class="o">)</span>
<span class="kn">end</span>
</code></pre></div>


<p>Just have to implement that somehow...</p>



<a name="205582977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205582977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205582977">(Jul 31 2020 at 12:01)</a>:</h4>
<p>The current syntax would make that more like the following, wouldn't it?</p>
<div class="codehilite"><pre><span></span><code><span class="n">mutual</span> <span class="n">def</span> <span class="n">wedge</span><span class="o">,</span> <span class="kn">infix</span> <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span><span class="o">:</span><span class="mi">70</span>
<span class="k">with</span>  <span class="bp">`</span> <span class="err">⋏</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">wedge</span>
<span class="k">with</span> <span class="n">wedge</span> <span class="o">:</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">_</span><span class="o">}</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">Gₙ</span> <span class="n">α</span> <span class="n">n</span>
<span class="bp">|</span> <span class="mi">0</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x₁</span><span class="o">,</span> <span class="n">x₂</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">y₁</span><span class="o">,</span> <span class="n">y₂</span><span class="bp">⟩</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">x₂</span> <span class="err">⋏</span> <span class="n">y₂</span><span class="o">,</span> <span class="n">x₁</span> <span class="err">⋏</span> <span class="n">y₂</span> <span class="bp">+</span> <span class="n">x₂</span> <span class="err">⋏</span> <span class="err">̅</span><span class="n">y₁</span><span class="err">ᵈ</span><span class="o">)</span>
</code></pre></div>



<a name="205583064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205583064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205583064">(Jul 31 2020 at 12:03)</a>:</h4>
<p>Well, I only know that I won't implement that one!</p>



<a name="205583971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Local%20notation%20in%20a%20lemma%20not%20working/near/205583971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Local.20notation.20in.20a.20lemma.20not.20working.html#205583971">(Jul 31 2020 at 12:17)</a>:</h4>
<p><code>mutual ... end</code> certainly seems a lot nicer!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>