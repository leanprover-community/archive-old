---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html">Diamond problem in mv_polynomial</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="221022295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221022295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221022295">(Dec 27 2020 at 20:35)</a>:</h4>
<p>I'm running into problems trying to use theorems about <code>polynomial (mv_polynomial (fin n) R)</code> when <code>R</code> is a <code>comm_ring</code> instead of just a <code>comm_semiring</code>. The issue seems to be that the semiring instance inferred on <code>mv_polynomial (fin n) R</code> is different depending on the context of the terms, and these instances aren't definitionally equal. This should be a mwe of the type of thing I'm running into:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.mv_polynomial.equiv</span>
<span class="c1">-- The issue only appears if `ring_theory.polynomial.basic` has been imported</span>
<span class="kn">import</span> <span class="n">ring_theory.polynomial.basic</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">hR</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">polynomial</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- This instance is what is synthesized in the polynomial in the goal</span>
  <span class="c1">-- let sr2 : semiring (mv_polynomial (fin n) R) := ring.to_semiring,</span>

  <span class="k">have</span> <span class="o">:=</span> <span class="n">mv_polynomial.option_equiv_left</span> <span class="n">R</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">),</span>
  <span class="c1">-- This instance is what is synthesized in the above expression</span>
  <span class="c1">-- let sr1 : semiring (mv_polynomial (fin n) R) := comm_semiring.to_semiring,</span>

  <span class="c1">-- the below expression times out, unless `hR` is replaced with `comm_semiring R`</span>
  <span class="n">exact</span> <span class="n">this</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>I've found a couple work-arounds for the specific use cases I have, but they seem like hacks and I feel there should probably be a better solution for this.</p>



<a name="221023651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221023651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221023651">(Dec 27 2020 at 21:17)</a>:</h4>
<p>Is something marked <code>irreducible</code> here? Perhaps <code>mv_polynomial</code> or <code>polynomial</code>?</p>



<a name="221024329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024329">(Dec 27 2020 at 21:36)</a>:</h4>
<p>It doesn't seem like anything is irreducible as far as I can tell, both definitions are just in terms of <code>finsupp</code>, but I'm not sure how to check for sure</p>



<a name="221024391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024391">(Dec 27 2020 at 21:39)</a>:</h4>
<p>So the code runs without error without the second import?</p>



<a name="221024493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024493">(Dec 27 2020 at 21:42)</a>:</h4>
<p>Yes, I think you can go a step further and only import <code>data.mv_polynomial.comm_ring</code> and get the same error, since that is what gives the <code>comm_ring</code> instance on <code>mv_polynomial</code>, which I think is what gives the distinct <code>semiring</code> structure on the <code>mv_polynomial</code></p>



<a name="221024553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024553">(Dec 27 2020 at 21:44)</a>:</h4>
<p>I would guess this line causes the trouble: <a href="https://github.com/leanprover-community/mathlib/blob/5c8c122226776201eba48f45a991e86084d77375/src/ring_theory/polynomial/basic.lean#L32">https://github.com/leanprover-community/mathlib/blob/5c8c122226776201eba48f45a991e86084d77375/src/ring_theory/polynomial/basic.lean#L32</a></p>



<a name="221024556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024556">(Dec 27 2020 at 21:44)</a>:</h4>
<p>But yes if <code>data.mv_polynomial.equiv</code> is the only import then there isn't any issue</p>



<a name="221024577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024577">(Dec 27 2020 at 21:45)</a>:</h4>
<p>I would guess this line causes the trouble: <del>https://github.com/leanprover-community/mathlib/blob/5c8c122226776201eba48f45a991e86084d77375/src/ring_theory/polynomial/basic.lean#L32</del></p>



<a name="221024622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024622">(Dec 27 2020 at 21:46)</a>:</h4>
<p>Where's the <a href="https://leanprover-community.github.io/mathlib_docs/find/mv_polynomial.comm_semiring">docs#mv_polynomial.comm_semiring</a> instance?</p>



<a name="221024624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024624">(Dec 27 2020 at 21:46)</a>:</h4>
<p>I think that is too high in the dependency tree to be the culprit, since just <code>data.mv_polynomial.comm_ring</code> causes the timeout without importing anything from <code>ring_theory/*</code></p>



<a name="221024681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024681">(Dec 27 2020 at 21:48)</a>:</h4>
<p>Somehow my clipboard had the wrong thing in it. I meant to link to the file you mentioned...</p>



<a name="221024766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024766">(Dec 27 2020 at 21:50)</a>:</h4>
<p>I don't think there is just a <code>ring</code> instance on <code>mv_polynomial</code>, the derived <code>ring</code> instance just seems to come from the <code>comm_ring</code> instance</p>



<a name="221024777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024777">(Dec 27 2020 at 21:51)</a>:</h4>
<p>Oh sorry, I see your edit, the <code>comm_semiring</code> comes from <code>data.mv_polynomial.basic</code></p>



<a name="221024883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024883">(Dec 27 2020 at 21:54)</a>:</h4>
<p>Seems odd that they'd form a diamond</p>



<a name="221024895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024895">(Dec 27 2020 at 21:55)</a>:</h4>
<p>Does <code>convert this</code> give any more helpful output than <code>exact this</code>? Or perhaps <code>convert this using 1</code></p>



<a name="221024954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221024954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221024954">(Dec 27 2020 at 21:57)</a>:</h4>
<p>Both still just timeout (although they take much longer to timeout than <code>exact</code>)</p>



<a name="221025005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025005">(Dec 27 2020 at 21:58)</a>:</h4>
<p>I'm not 100% sure it is a diamond problem but the different <code>semiring</code> instances were the only differences I could find between the terms.</p>



<a name="221025277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025277">(Dec 27 2020 at 22:06)</a>:</h4>
<p>If you change <code>{R : Type*}</code> to <code>{R : Type u}</code> then it works fine.</p>



<a name="221025324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025324">(Dec 27 2020 at 22:08)</a>:</h4>
<p>There are other times when this sort of thing has happened and I'm not entirely sure that people have got to the bottom of it. <code>Type*</code> means "Lean, solve this universe problem for me in the most general way possible automatically"; <code>Type u</code> means "Lean, I claim this choice works".</p>



<a name="221025425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025425">(Dec 27 2020 at 22:11)</a>:</h4>
<p>Ah, thank you, I hadn't even thought to try changing that, I didn't realize <code>Type*</code> could be dangerous to use.</p>



<a name="221025486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025486">(Dec 27 2020 at 22:12)</a>:</h4>
<p>It's just one of those things you pick up if you hang around here. I don't know why it's dangerous but you've got a pretty neat example here, I'm trying to minimise. Reid once told me he never used <code>Type*</code>. Right now I don't know whether the issue was that you just asked Lean to solve a super-hard universe unification question or whether it's something else.</p>



<a name="221025493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025493">(Dec 27 2020 at 22:13)</a>:</h4>
<p>Is this a problem that goes away if you use <code>lemma</code> instead of <code>example</code>?</p>



<a name="221025523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025523">(Dec 27 2020 at 22:14)</a>:</h4>
<p>Since I've seen <code>def</code> look at the body to determine it's type, but I haven't seen <code>lemma</code> do that</p>



<a name="221025555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025555">(Dec 27 2020 at 22:14)</a>:</h4>
<p>Yes</p>



<a name="221025574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025574">(Dec 27 2020 at 22:15)</a>:</h4>
<p>Although I can replicate it inside of a lemma in a much less minimized version (since I came across this while trying to prove a lemma)</p>



<a name="221025765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025765">(Dec 27 2020 at 22:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.mv_polynomial.equiv</span>

<span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="c1">-- uncomment this and the first example times out and the second two take much longer to compile</span>

<span class="c1">--noncomputable instance {R : Type u} [comm_ring R] {σ : Type v} : comm_ring (mv_polynomial σ R) :=</span>
<span class="c1">--add_monoid_algebra.comm_ring</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">polynomial</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">mv_polynomial.option_equiv_left</span> <span class="n">R</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">foo</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">polynomial</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">mv_polynomial.option_equiv_left</span> <span class="n">R</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">option</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">polynomial</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">mv_polynomial.option_equiv_left</span> <span class="n">R</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span>
</code></pre></div>



<a name="221025993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221025993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221025993">(Dec 27 2020 at 22:28)</a>:</h4>
<p>I still get a timeout when I'm trying to use some of these things internally to a lemma though:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.mv_polynomial.equiv</span>
<span class="c1">-- The issue only appears if `ring_theory.polynomial.basic` has been imported</span>
<span class="kn">import</span> <span class="n">data.mv_polynomial.comm_ring</span>

<span class="kd">universe</span> <span class="n">u</span>

<span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">ex</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">hR</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- This times out unless `hR` is switched to `comm_semiring`</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">polynomial</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
    <span class="n">mv_polynomial.fin_succ_equiv</span> <span class="n">R</span> <span class="n">n</span><span class="o">,</span>

  <span class="n">exact</span> <span class="mi">0</span>
<span class="kd">end</span>
</code></pre></div>



<a name="221026952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221026952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221026952">(Dec 27 2020 at 22:57)</a>:</h4>
<p>I think this might be a <del>bug</del> <em>feature I don't understand</em> in <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#have">tactic#have</a>?</p>



<a name="221026955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221026955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221026955">(Dec 27 2020 at 22:57)</a>:</h4>
<p>The problem doesn't exist in term-mode have</p>



<a name="221026969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221026969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221026969">(Dec 27 2020 at 22:58)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">lemma</span> <span class="n">ex</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">hR</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span>
<span class="k">have</span> <span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="n">R</span> <span class="bp">≃+*</span> <span class="n">polynomial</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
    <span class="n">mv_polynomial.fin_succ_equiv</span> <span class="n">R</span> <span class="n">n</span><span class="o">,</span>
<span class="kd">begin</span>
  <span class="n">exact</span> <span class="mi">0</span>
<span class="kd">end</span>
</code></pre></div>



<a name="221028451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221028451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221028451">(Dec 27 2020 at 23:37)</a>:</h4>
<p>Thanks, jumping in and out of term-mode seems to solve all the time-outs I was getting with <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#have">tactic#have</a> and <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#let">tactic#let</a>, although it does make the proofs look a bit strange</p>



<a name="221029175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221029175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221029175">(Dec 27 2020 at 23:57)</a>:</h4>
<p>Does making universes explicit solve any problems?</p>



<a name="221029587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221029587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Devon Tuma <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221029587">(Dec 28 2020 at 00:10)</a>:</h4>
<p>I've made all the proofs I'm writing explicit about universes and still have the issue. And <code>data.mv_polynomial.equiv</code> already uses explicit universes. I'll have to do some digging to see if any of the definitions I'm importing might still have implicit universes though, and see if modifying those helps.</p>



<a name="221029770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221029770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221029770">(Dec 28 2020 at 00:14)</a>:</h4>
<p>I think the universe thing all happens at compile time, I don't think changing <code>*</code>s to <code>u</code>s in other theorems will change anything -- it might change what happens when it compiles, but it won't change the type of the term at all I don't think.</p>



<a name="221029834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221029834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221029834">(Dec 28 2020 at 00:16)</a>:</h4>
<p>I don't think using <code>*</code> instead of <code>u</code> has any detrimental effects unless you can see the type of the theorem change</p>



<a name="221029847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221029847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221029847">(Dec 28 2020 at 00:16)</a>:</h4>
<p>I still think it is best to prefer <code>*</code> when possible, because lean's automatic universe handling is generally the right thing to do</p>



<a name="221030093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030093">(Dec 28 2020 at 00:23)</a>:</h4>
<p>We have here an explicit example of where lean's automatic universe handling is timing out and telling it "Type u works fine" doesn't time out :-/</p>



<a name="221030141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030141">(Dec 28 2020 at 00:25)</a>:</h4>
<p>It's not clear to me that universe handling is the problem though, it seems typeclass inference is to blame here</p>



<a name="221030154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030154">(Dec 28 2020 at 00:25)</a>:</h4>
<p>you are saying it works better if you are more explicit about things and yes that's probably true but it doesn't mean we shouldn't make the normal inference work</p>



<a name="221030155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030155">(Dec 28 2020 at 00:26)</a>:</h4>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>@ring_equiv.{u_1 u_1} (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
  (@polynomial.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
     (@ring.to_semiring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
        (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n)))))
  (@distrib.to_has_mul.{u_1}
     (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
     (@ring.to_distrib.{u_1}
        (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
        (@comm_ring.to_ring.{u_1}
           (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (option.{0} (fin n))))))
  (@distrib.to_has_add.{u_1}
     (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
     (@ring.to_distrib.{u_1}
        (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
        (@comm_ring.to_ring.{u_1}
           (@mv_polynomial.{0 u_1} (option.{0} (fin n)) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (option.{0} (fin n))))))
  (@distrib.to_has_mul.{u_1}
     (@polynomial.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
        (@ring.to_semiring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
              (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n)))))
     (@ring.to_distrib.{u_1}
        (@polynomial.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@ring.to_semiring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
              (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
                 (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n)))))
        (@polynomial.ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
              (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n))))))
  (@distrib.to_has_add.{u_1}
     (@polynomial.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
        (@ring.to_semiring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
              (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n)))))
     (@ring.to_distrib.{u_1}
        (@polynomial.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@ring.to_semiring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
              (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
                 (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n)))))
        (@polynomial.ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
           (@comm_ring.to_ring.{u_1} (@mv_polynomial.{0 u_1} (fin n) R (@comm_ring.to_comm_semiring.{u_1} R _inst_2))
              (@mv_polynomial.comm_ring.{u_1 0} R _inst_2 (fin n))))))
</code></pre></div>
<p>is the problem, I suspect.</p>



<a name="221030195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030195">(Dec 28 2020 at 00:26)</a>:</h4>
<p>Why do these goals always make me weep</p>



<a name="221030198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030198">(Dec 28 2020 at 00:26)</a>:</h4>
<p>That's what maths actually looks like when you do it this way</p>



<a name="221030220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030220">(Dec 28 2020 at 00:27)</a>:</h4>
<p>This is not something that ever happens in metamath, and the problems that are dealt with are around the same level of complexity</p>



<a name="221030224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030224">(Dec 28 2020 at 00:27)</a>:</h4>
<p>so I don't buy the "this is reality" argument</p>



<a name="221030225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030225">(Dec 28 2020 at 00:27)</a>:</h4>
<p>right, I'm not saying maths is wrong, I'm saying the way this is all set up in Lean 3 is somehow wrong</p>



<a name="221030270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030270">(Dec 28 2020 at 00:28)</a>:</h4>
<p>Isn't there an issue here that we train people to use <code>example</code> instead of <code>lemma</code>, but <code>example</code> fails above and lemma doesn't?</p>



<a name="221030272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030272">(Dec 28 2020 at 00:28)</a>:</h4>
<p>Do we need a <code>lemma_example</code>?</p>



<a name="221030275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030275">(Dec 28 2020 at 00:29)</a>:</h4>
<p>The reason that makes a difference is that <code>example</code> is like <code>def</code> in that the value of the definition affects the inference of the statement</p>



<a name="221030277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030277">(Dec 28 2020 at 00:29)</a>:</h4>
<p><code>lemma example</code> does that, I think</p>



<a name="221030282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030282">(Dec 28 2020 at 00:29)</a>:</h4>
<p>wait what?</p>



<a name="221030288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030288">(Dec 28 2020 at 00:29)</a>:</h4>
<p>I mean just call the lemma <code>example</code></p>



<a name="221030294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030294">(Dec 28 2020 at 00:29)</a>:</h4>
<p>Well, right now I assume <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> tells people to use <code>example</code></p>



<a name="221030336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030336">(Dec 28 2020 at 00:30)</a>:</h4>
<p>oh, I thought you had discovered some long lost keyword combination</p>



<a name="221030346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030346">(Dec 28 2020 at 00:30)</a>:</h4>
<p>incidentally, you can't name a lemma <code>example</code> because it's a keyword</p>



<a name="221030347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030347">(Dec 28 2020 at 00:30)</a>:</h4>
<p>Huh, it doesn't actually recommend <code>example</code></p>



<a name="221030363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030363">(Dec 28 2020 at 00:31)</a>:</h4>
<p>There is nothing wrong with <code>example</code> per se, it's just one part of the confluence that leads to the bug here</p>



<a name="221030382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030382">(Dec 28 2020 at 00:31)</a>:</h4>
<p>It's useful to have <code>example</code> perform inference of the statement from the value because otherwise you wouldn't be able to do e.g. <code>example := 1</code></p>



<a name="221030427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030427">(Dec 28 2020 at 00:32)</a>:</h4>
<p>with a lemma that would have to be <code>lemma foo : nat := 1</code> where <code>nat</code> is required</p>



<a name="221030440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030440">(Dec 28 2020 at 00:32)</a>:</h4>
<p>So somehow <code>mv_polynomial.option_equiv_left</code> is implicated in this issue</p>



<a name="221030512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030512">(Dec 28 2020 at 00:34)</a>:</h4>
<p>Sure, I'm not saying <code>example</code> is broken - just that encouraging people to use <code>example : some_prop := sorry</code> in zulip is setting an unnecessary trap that would be resolved if we had the hypothetical <code>lemma example</code></p>



<a name="221030529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030529">(Dec 28 2020 at 00:35)</a>:</h4>
<p>Do you know where the part of lean is that defines <code>theorem</code> / <code>lemma</code> etc?</p>



<a name="221030532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030532">(Dec 28 2020 at 00:35)</a>:</h4>
<p>I don't think it's a trap either</p>



<a name="221030575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030575">(Dec 28 2020 at 00:36)</a>:</h4>
<p>I think Kevin found a bug that involves <code>example</code> and <code>Type*</code></p>



<a name="221030579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030579">(Dec 28 2020 at 00:36)</a>:</h4>
<p>and it doesn't on its own mean that <code>example</code> and/or <code>Type*</code> should be avoided</p>



<a name="221030582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030582">(Dec 28 2020 at 00:36)</a>:</h4>
<p>Where is that list of useful <code>option</code>s? I want to see what typeclass stuff is happening</p>



<a name="221030592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030592">(Dec 28 2020 at 00:37)</a>:</h4>
<p><code>set_option trace.class_instances true</code></p>



<a name="221030666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030666">(Dec 28 2020 at 00:39)</a>:</h4>
<p>First we get lots of these:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @submodule.quotient.has_add ?x_1 ?x_2 ?x_3 ?x_4 ?x_5 ?x_6
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @linear_map.has_add ?x_7 ?x_8 ?x_9 ?x_10 ?x_11 ?x_12 ?x_13 ?x_14
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @finsupp.has_add ?x_15 ?x_16 ?x_17
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @finset.has_add ?x_18 ?x_19 ?x_20
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @set.has_add ?x_21 ?x_22
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := enat.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := ?x_28.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := ?x_31.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @matrix.has_add ?x_32 ?x_33 ?x_34 ?x_35 ?x_36 ?x_37
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := ?x_40.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := ?x_43.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @multiset.has_add ?x_44
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @opposite.has_add ?x_45 ?x_46
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := rat.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @with_top.has_add ?x_47 ?x_48
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @prod.has_add ?x_49 ?x_50 ?x_51 ?x_52
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @additive.has_add ?x_53 ?x_54
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @with_zero.has_add ?x_55 ?x_56
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @add_monoid_hom.has_add ?x_57 ?x_58 ?x_59 ?x_60
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @pi.has_add ?x_61 ?x_62 ?x_63
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := native.float.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := unsigned.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := @fin.has_add ?x_64
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := int.has_add
failed is_def_eq
[class_instances] (0) ?x_0 : has_add
  (@polynomial (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
     (@ring.to_semiring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
        (@comm_ring.to_ring (@mv_polynomial (fin n) R (@comm_ring.to_comm_semiring R _inst_2))
           (@baz R _inst_2 (fin n))))) := options.has_add
</code></pre></div>



<a name="221030714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030714">(Dec 28 2020 at 00:40)</a>:</h4>
<p>Then all of a sudden, the breakthrough:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">has_add</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">polynomial</span> <span class="o">(</span><span class="bp">@</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">R</span> <span class="n">_inst_2</span><span class="o">))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="o">(</span><span class="bp">@</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">R</span> <span class="n">_inst_2</span><span class="o">))</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_ring</span> <span class="o">(</span><span class="bp">@</span><span class="n">mv_polynomial</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">R</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">R</span> <span class="n">_inst_2</span><span class="o">))</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">baz</span> <span class="n">R</span> <span class="n">_inst_2</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)))))</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">distrib.to_has_add</span> <span class="bp">?</span><span class="n">x_65</span> <span class="bp">?</span><span class="n">x_66</span>
</code></pre></div>
<p>Could polynomials be a distrib?</p>



<a name="221030891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030891">(Dec 28 2020 at 00:45)</a>:</h4>
<p>I think this is the core problem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">comm_semiring.to_semiring</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">mv_polynomial.comm_semiring</span> <span class="n">R</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_comm_semiring</span> <span class="n">R</span> <span class="n">_inst_1</span><span class="o">))</span> <span class="bp">=</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">comm_ring.to_ring</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">mv_polynomial.comm_ring</span> <span class="n">R</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="o">))))</span> <span class="o">:=</span>
<span class="n">rfl</span>
</code></pre></div>
<p>this is slow exactly in the same cases as the original</p>



<a name="221030989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221030989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221030989">(Dec 28 2020 at 00:47)</a>:</h4>
<p>I think that this sums up the problems with the diamond problems in lean 3. This <code>rfl</code> is true but lean has to do a stupid amount of work to prove it</p>



<a name="221031041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221031041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221031041">(Dec 28 2020 at 00:48)</a>:</h4>
<p>because it basically has to completely unfold the definition of mv_polynomials, look at all of the fields and note that they are the same</p>



<a name="221031068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221031068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221031068">(Dec 28 2020 at 00:49)</a>:</h4>
<p>If only we could prove these definitional equalities and maybe <em>hint</em> to the <em>unifier</em> to use them</p>



<a name="221031077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221031077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221031077">(Dec 28 2020 at 00:49)</a>:</h4>
<p>Lean 4 has unification hints! As does Lean 3, right?</p>



<a name="221031200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diamond%20problem%20in%20mv_polynomial/near/221031200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diamond.20problem.20in.20mv_polynomial.html#221031200">(Dec 28 2020 at 00:52)</a>:</h4>
<p>I don't know how well lean (or even DTT in general) can handle "proofs of defeq" though. Especially hypothetical defeq theorems, i.e. "if A = B is defeq then C = D is defeq" don't exist in DTT proper, even though they are as important as lemmas in regular mathematics in theory, providing super-exponential speedups in some problems</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>