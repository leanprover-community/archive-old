---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/norm_num.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html">norm_num</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="150797276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150797276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150797276">(Dec 03 2018 at 20:19)</a>:</h4>
<p>I was under the impression that <code>norm_num</code> was always successful in its range of expertise. Here is a real-life counterexample:</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">crazy</span> <span class="o">(</span><span class="n">k</span> <span class="n">l</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">l</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">):</span> <span class="o">((</span><span class="mi">2</span><span class="o">:</span><span class="n">real</span><span class="o">)</span><span class="bp">⁻¹</span><span class="o">)</span><span class="err">^</span><span class="n">k</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">2</span><span class="bp">⁻¹</span><span class="o">)</span><span class="err">^</span><span class="n">l</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">pow_le_pow_of_le_one</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="c1">-- goal is 2⁻¹ ≤ 1</span>
  <span class="n">norm_num</span>
<span class="kn">end</span>
</pre></div>


<p>The last <code>norm_num</code> call gives rise to a deterministic timeout. Replacing it with <code>show 2⁻¹ ≤ (1 : real), by norm_num</code> works fine, so this is not really a problem for me, but still surprising.</p>



<a name="150797777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150797777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150797777">(Dec 03 2018 at 20:27)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">norm_num</span>

<span class="kn">lemma</span> <span class="n">crazy</span> <span class="o">(</span><span class="n">k</span> <span class="n">l</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">l</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">):</span> <span class="o">((</span><span class="mi">2</span><span class="o">:</span><span class="n">real</span><span class="o">)</span><span class="bp">⁻¹</span><span class="o">)</span><span class="err">^</span><span class="n">k</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">2</span><span class="bp">⁻¹</span><span class="o">)</span><span class="err">^</span><span class="n">l</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">pow_le_pow_of_le_one</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">norm_num</span><span class="o">,</span>
  <span class="c1">-- goal is 2⁻¹ ≤ 1</span>
  <span class="k">show</span> <span class="o">(</span><span class="mi">2</span><span class="bp">⁻¹</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<p>I've seen this before, but don't remember why it's happening.</p>



<a name="150797846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150797846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150797846">(Dec 03 2018 at 20:28)</a>:</h4>
<p><code>norm_num</code> is fighting with <code>simp</code>. Compare with <code>norm_num1, simp, norm_num1, simp,</code></p>



<a name="150797854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150797854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150797854">(Dec 03 2018 at 20:28)</a>:</h4>
<p>which is basically what <code>norm_num</code> does</p>



<a name="150798112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798112">(Dec 03 2018 at 20:33)</a>:</h4>
<p>Does it mean that it would be more safe for <code>norm_num</code> to call <code>simp [-one_div_eq_inv]</code>? By the way, I am not convinced that <code>one_div_eq_inv</code> is a good simp rule, what do you think?</p>



<a name="150798174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798174">(Dec 03 2018 at 20:34)</a>:</h4>
<p>It's the same family that turns every <code>a-b</code> into <code>a+-b</code> that I hate</p>



<a name="150798199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798199">(Dec 03 2018 at 20:34)</a>:</h4>
<p>and it's in core lib <span class="emoji emoji-2639" title="sad">:sad:</span></p>



<a name="150798795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798795">(Dec 03 2018 at 20:43)</a>:</h4>
<p>a better question is why <code>norm_num1</code> isn't solving the goal</p>



<a name="150798811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798811">(Dec 03 2018 at 20:43)</a>:</h4>
<p>since it does solve the goal if you canonize the instances by restating the goal as you did</p>



<a name="150798908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798908">(Dec 03 2018 at 20:44)</a>:</h4>
<p>I think this one is a result of my relying on the C++ <code>norm_num</code> implementation, which lags behind the mathlib implementation quite a bit</p>



<a name="150798941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150798941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150798941">(Dec 03 2018 at 20:45)</a>:</h4>
<p>I use it for doing <code>+</code> <code>-</code> <code>*</code> <code>/</code> on rings and fields, and do everything else in lean</p>



<a name="150799067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150799067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150799067">(Dec 03 2018 at 20:46)</a>:</h4>
<p>but I have seen it get confused with weird instances before (i.e. <code>simp</code> wants to prove that <code>(0 : int) != (1 : multiplicative int)</code> even though it's false)</p>



<a name="150799423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150799423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150799423">(Dec 03 2018 at 20:52)</a>:</h4>
<p>It is definitely confused by the instances. With <code>pp.all</code>, the goal it can not solve is</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">preorder</span><span class="bp">.</span><span class="n">to_has_le</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">partial_order</span><span class="bp">.</span><span class="n">to_preorder</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">ordered_comm_monoid</span><span class="bp">.</span><span class="n">to_partial_order</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ordered_cancel_comm_monoid</span><span class="bp">.</span><span class="n">to_ordered_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_cancel_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_semiring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">linear_ordered_semiring</span><span class="o">))))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_inv</span><span class="bp">.</span><span class="n">inv</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring</span><span class="bp">.</span><span class="n">to_has_inv</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">division_ring</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">bit0</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">distrib</span><span class="bp">.</span><span class="n">to_has_add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_distrib</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">normed_ring</span><span class="bp">.</span><span class="n">to_ring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_field</span><span class="bp">.</span><span class="n">to_normed_ring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">normed_field</span><span class="o">))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">has_one</span><span class="bp">.</span><span class="n">one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">zero_ne_one_class</span><span class="bp">.</span><span class="n">to_has_one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">domain</span><span class="bp">.</span><span class="n">to_zero_ne_one_class</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">domain</span><span class="o">)))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_one</span><span class="bp">.</span><span class="n">one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">monoid</span><span class="bp">.</span><span class="n">to_has_one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">semiring</span><span class="bp">.</span><span class="n">to_monoid</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ordered_semiring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_semiring</span><span class="bp">.</span><span class="n">to_ordered_semiring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">linear_ordered_semiring</span><span class="o">)))))</span>
</pre></div>


<p>while the "right" instance is the much nicer </p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">has_le</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_inv</span><span class="bp">.</span><span class="n">inv</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring</span><span class="bp">.</span><span class="n">to_has_inv</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">division_ring</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">bit0</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">distrib</span><span class="bp">.</span><span class="n">to_has_add</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_distrib</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">normed_ring</span><span class="bp">.</span><span class="n">to_ring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_field</span><span class="bp">.</span><span class="n">to_normed_ring</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">normed_field</span><span class="o">))))</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">has_one</span><span class="bp">.</span><span class="n">one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">zero_ne_one_class</span><span class="bp">.</span><span class="n">to_has_one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">domain</span><span class="bp">.</span><span class="n">to_zero_ne_one_class</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">domain</span><span class="o">)))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_one</span><span class="bp">.</span><span class="n">one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">zero_ne_one_class</span><span class="bp">.</span><span class="n">to_has_one</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">domain</span><span class="bp">.</span><span class="n">to_zero_ne_one_class</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">real</span> <span class="n">real</span><span class="bp">.</span><span class="n">domain</span><span class="o">)))</span>
</pre></div>



<a name="150800863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150800863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150800863">(Dec 03 2018 at 21:14)</a>:</h4>
<p>Something in <code>norm_num</code>, either in C++ or in mathlib, is creating some metavars and leaving them uninstantiated. Adding <code>e₂ ← instantiate_mvars e₂,</code> before the <code>guard</code> at <a href="https://github.com/leanprover/mathlib/blob/master/tactic/norm_num.lean#L162" target="_blank" title="https://github.com/leanprover/mathlib/blob/master/tactic/norm_num.lean#L162">https://github.com/leanprover/mathlib/blob/master/tactic/norm_num.lean#L162</a> allows <code>norm_num1</code> to kill the goal.</p>



<a name="150800903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150800903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150800903">(Dec 03 2018 at 21:15)</a>:</h4>
<p>I haven't tracked down where the uninstantiated metavar is coming from yet.</p>



<a name="150802454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150802454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Luca Gerolla <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150802454">(Dec 03 2018 at 21:36)</a>:</h4>
<p><a href="/user_uploads/3121/ux1kBLQGexv8qc9xmddMHxrJ/20180814_193304.jpg" target="_blank" title="20180814_193304.jpg">20180814_193304.jpg</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/ux1kBLQGexv8qc9xmddMHxrJ/20180814_193304.jpg" target="_blank" title="20180814_193304.jpg"><img src="/user_uploads/3121/ux1kBLQGexv8qc9xmddMHxrJ/20180814_193304.jpg"></a></div>



<a name="150802460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150802460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Luca Gerolla <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150802460">(Dec 03 2018 at 21:36)</a>:</h4>
<p>I also  bumped into deterministic timeout few times when solving various inequality; the common situation was that I had goals involving some "variable" real number (i.e. not explicit - like the 'k' and 'l' in the example) and norm_num got in a loop (often involving 'one_div_eq_inv')</p>



<a name="150802866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150802866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150802866">(Dec 03 2018 at 21:42)</a>:</h4>
<p>Hmm. I think the C++ <code>norm_num</code> instantiates mvars as a side effect, but only sometimes. It doesn't do it when it when the term is already in normal form.</p>



<a name="150802905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150802905" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150802905">(Dec 03 2018 at 21:43)</a>:</h4>
<p>Simple fix: <code>e ← instantiate_mvars e,</code> at <code>norm_num.lean:468</code></p>



<a name="150804050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804050">(Dec 03 2018 at 22:01)</a>:</h4>
<p>468?</p>



<a name="150804058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804058">(Dec 03 2018 at 22:01)</a>:</h4>
<p><a href="https://github.com/leanprover/mathlib/blob/master/tactic/norm_num.lean#L468" target="_blank" title="https://github.com/leanprover/mathlib/blob/master/tactic/norm_num.lean#L468">https://github.com/leanprover/mathlib/blob/master/tactic/norm_num.lean#L468</a></p>



<a name="150804070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804070">(Dec 03 2018 at 22:02)</a>:</h4>
<p>you mean before the <code>ext_simplify_core</code>?</p>



<a name="150804122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804122">(Dec 03 2018 at 22:02)</a>:</h4>
<p>Booooo! Rob is not running up to date mathlib</p>



<a name="150804158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804158">(Dec 03 2018 at 22:03)</a>:</h4>
<p>lol, you don't want to know what I'm running</p>



<a name="150804210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804210">(Dec 03 2018 at 22:04)</a>:</h4>
<p>Nope, the argument to <code>derive</code> should be instantiated before you do anything with it.</p>



<a name="150804221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804221">(Dec 03 2018 at 22:04)</a>:</h4>
<p>So make that the first line of the <code>do</code> block.</p>



<a name="150804240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804240">(Dec 03 2018 at 22:05)</a>:</h4>
<p>why not 471/472? that's the first place after calling C <code>norm_num</code></p>



<a name="150804287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804287">(Dec 03 2018 at 22:06)</a>:</h4>
<p>or is the problem uninstantiated metavars in the user input</p>



<a name="150804363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804363">(Dec 03 2018 at 22:06)</a>:</h4>
<p>Yeah, exactly. At some point you compare the input with something that went through the C++ <code>norm_num</code>. The former has mvars, the latter doesn't.</p>



<a name="150804500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804500">(Dec 03 2018 at 22:09)</a>:</h4>
<p>we could just check for unify instead of alpha equivalent</p>



<a name="150804591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804591">(Dec 03 2018 at 22:10)</a>:</h4>
<p>eh, I guess that doesn't make sense here</p>



<a name="150804644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150804644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150804644">(Dec 03 2018 at 22:11)</a>:</h4>
<p>yeah okay, ship it</p>



<a name="150805046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150805046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150805046">(Dec 03 2018 at 22:17)</a>:</h4>
<p>ship who?</p>



<a name="150809032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/150809032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#150809032">(Dec 03 2018 at 23:22)</a>:</h4>
<p>Not sure if this is a serious question, but this is an international forum, so... <a href="https://english.stackexchange.com/questions/48443/meaning-of-ship-it" target="_blank" title="https://english.stackexchange.com/questions/48443/meaning-of-ship-it">ship it</a></p>



<a name="191656673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191656673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191656673">(Mar 24 2020 at 18:53)</a>:</h4>
<p>What is the purpose of <code>algebra/norm_num</code> in the Lean core library? Is it used for some tactic?</p>



<a name="191657016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191657016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191657016">(Mar 24 2020 at 18:56)</a>:</h4>
<p>It is used for the  <code>norm_num</code> tactic</p>



<a name="191657943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191657943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191657943">(Mar 24 2020 at 19:02)</a>:</h4>
<p>The <code>norm_num</code> tactic in <code>mathlib</code>?</p>



<a name="191657982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191657982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191657982">(Mar 24 2020 at 19:02)</a>:</h4>
<p>I mean, can we move all these lemmas to <code>mathlib</code>?</p>



<a name="191658006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658006">(Mar 24 2020 at 19:03)</a>:</h4>
<p><code>tactic.norm_num</code> is in core, and <code>norm_num</code> in mathlib uses it</p>



<a name="191658158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658158">(Mar 24 2020 at 19:04)</a>:</h4>
<p>we recently discussed having mathlib <code>norm_num</code> be implemented as standalone so that <code>tactic.norm_num</code> can be deleted</p>



<a name="191658437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658437">(Mar 24 2020 at 19:06)</a>:</h4>
<p><code>tactic.norm_num</code> is a <code>meta constant</code>. Will it work if supporting lemmas will be in <code>mathlib</code> instead of stdlib?</p>



<a name="191658483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658483">(Mar 24 2020 at 19:07)</a>:</h4>
<p>no, there are tests in the lean repo that would fail if you did that</p>



<a name="191658639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658639">(Mar 24 2020 at 19:08)</a>:</h4>
<p>move the tests to the mathlib repo?</p>



<a name="191658757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658757">(Mar 24 2020 at 19:09)</a>:</h4>
<p>that's just breaking lean and pretending we didn't</p>



<a name="191658873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191658873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191658873">(Mar 24 2020 at 19:10)</a>:</h4>
<p>move all of Lean into mathlib?</p>



<a name="191690434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191690434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191690434">(Mar 25 2020 at 00:35)</a>:</h4>
<p>It's not really practical to move <code>constants</code> backed by C++ code outside of core. For now. In Lean 4 we could do something like that but not in Lean 3.</p>



<a name="191690687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/191690687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#191690687">(Mar 25 2020 at 00:40)</a>:</h4>
<p><del>Out of curiosity, was the issue discussed at the start of this thread in Dec 2018 ever fixed?</del> Yep, <a href="#narrow/stream/113488-general/topic/norm_num/near/150797777" title="#narrow/stream/113488-general/topic/norm_num/near/150797777">the example</a> works in 3.7.2c and a recent mathlib.</p>



<a name="202259591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202259591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202259591">(Jun 28 2020 at 23:02)</a>:</h4>
<p>Do we need <code>init_/algebra/norm_num</code> for some reason?</p>



<a name="202259602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202259602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202259602">(Jun 28 2020 at 23:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="202267184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202267184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202267184">(Jun 29 2020 at 02:38)</a>:</h4>
<p>I think it is not imported by anything right now</p>



<a name="202311712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202311712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202311712">(Jun 29 2020 at 13:54)</a>:</h4>
<p>I meant "it is not imported, may I remove it"?</p>



<a name="202312338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202312338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202312338">(Jun 29 2020 at 13:58)</a>:</h4>
<p>Yup, I think it can go. I didn't pay close attention to what stuff was dead code when I ripped algebra out of core.</p>



<a name="202312373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202312373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202312373">(Jun 29 2020 at 13:58)</a>:</h4>
<p>But since Mario rewrote norm_num, I think this is now a leaf and can be safely deleted.</p>



<a name="202312416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202312416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202312416">(Jun 29 2020 at 13:59)</a>:</h4>
<p>(Unless you think there is something in there that is worth merging into the main tree.)</p>



<a name="202314530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/202314530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#202314530">(Jun 29 2020 at 14:14)</a>:</h4>
<p>When I did my second pass on Johan's import I specifically attended to making sure that everything in <code>init_.algebra.norm_num</code> that is needed by the new <code>norm_num</code> got moved where it needs to be, without importing it, exactly so that it could be deleted</p>



<a name="286792384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/286792384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#286792384">(Jun 20 2022 at 13:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, I broke <code>norm_num</code> in <a href="https://github.com/leanprover-community/mathlib/pull/14683">#14683</a>. It does not infer the <code>0 &lt; b</code> argument to <a href="https://leanprover-community.github.io/mathlib_docs/find/norm_num.zpow_neg">docs#norm_num.zpow_neg</a> anymore. Do you think you could investigate?</p>



<a name="286808000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/286808000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#286808000">(Jun 20 2022 at 15:06)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> fixed in <a href="https://github.com/leanprover-community/mathlib/pull/14852">#14852</a>. The bug was there all along but it was causing a non-fatal error and <code>simp</code> used to find an alternative proof if you use <code>norm_num</code> instead of <code>norm_num1</code>.</p>



<a name="286810363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/286810363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#286810363">(Jun 20 2022 at 15:27)</a>:</h4>
<p>It appears the way this interacted with your PR is that <code>simp</code> would previously rewrite</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="o">(</span><span class="bp">@</span><span class="n">has_div.div</span> <span class="n">real</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">div_inv_monoid.to_has_div</span> <span class="n">real</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_div_inv_monoid</span> <span class="n">real</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field.to_field</span> <span class="n">real</span> <span class="n">real.linear_ordered_ring</span><span class="o">))))</span>
     <span class="mi">1</span>
     <span class="mi">9</span><span class="o">)</span>
<span class="bp">==&gt;</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">has_div.div</span> <span class="n">real</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">div_inv_monoid.to_has_div</span> <span class="n">real</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">field.to_div_inv_monoid</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field.to_field</span> <span class="n">real</span> <span class="n">real.linear_ordered_ring</span><span class="o">)))</span>
     <span class="mi">1</span>
     <span class="mi">9</span><span class="o">)</span>
</code></pre></div>
<p>which would cause a failure in <code>simp</code> when applying transitivity with the bad proof in a place that would get ignored, and on your branch the term is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>       <span class="o">(</span><span class="bp">@</span><span class="n">has_div.div</span> <span class="n">real</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">div_inv_monoid.to_has_div</span> <span class="n">real</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_div_inv_monoid</span> <span class="n">real</span>
                 <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring</span> <span class="n">real</span> <span class="o">(</span><span class="bp">@</span><span class="n">linear_ordered_field.to_field</span> <span class="n">real</span> <span class="n">real.linear_ordered_ring</span><span class="o">))))</span>
           <span class="mi">1</span>
           <span class="mi">9</span><span class="o">)</span>
</code></pre></div>
<p>and <code>simp</code> is no longer interested in rewriting it, so the bad proof makes it to the top level and causes the failure. I guess you changed the instance search around division rings in some way?</p>



<a name="286812036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/norm_num/near/286812036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/norm_num.html#286812036">(Jun 20 2022 at 15:40)</a>:</h4>
<p>I added <code>semifield</code> and <code>division_semiring</code> under <code>field</code> and <code>division_ring</code>, so I had to change the inheritance around those parts.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>