---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/finsupp.2Ehas_scalar.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html">finsupp.has_scalar</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="230573010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230573010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230573010">(Mar 16 2021 at 19:11)</a>:</h4>
<p>In LTE I'm hitting goals of the form</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">smul_with_zero.to_has_scalar</span> <span class="bp">=</span> <span class="n">finsupp.has_scalar</span>
</code></pre></div>
<p>Should <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp.has_scalar">docs#finsupp.has_scalar</a> be removed, now that we have <code>smul_with_zero</code>?</p>



<a name="230574795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230574795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230574795">(Mar 16 2021 at 19:22)</a>:</h4>
<p>Those don't really sound interchangable to me</p>



<a name="230574810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230574810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230574810">(Mar 16 2021 at 19:23)</a>:</h4>
<p>Does refl not close that?</p>



<a name="230574894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230574894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230574894">(Mar 16 2021 at 19:23)</a>:</h4>
<p>Ah, but the typeclass argument on that instance should now be relaxed from semimodule to smul_with_zero</p>



<a name="230575510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230575510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230575510">(Mar 16 2021 at 19:27)</a>:</h4>
<p><code>refl</code> doesn't have the slightest intention of closing this goal <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="230575792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230575792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230575792">(Mar 16 2021 at 19:29)</a>:</h4>
<p>If you are interested in seeing where these come from, see <code>polyhedral_lattice/finsupp.lean</code> in the <code>polyhedral-basis</code> branch of LTE</p>



<a name="230576708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230576708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230576708">(Mar 16 2021 at 19:34)</a>:</h4>
<p>Would you mind showing it with pp.all?</p>



<a name="230576753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230576753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230576753">(Mar 16 2021 at 19:34)</a>:</h4>
<p>Sorry, just pp.implicit is enough</p>



<a name="230577682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230577682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230577682">(Mar 16 2021 at 19:40)</a>:</h4>
<p>Voila:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">smul_with_zero.to_has_scalar</span> <span class="n">ℕ</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_has_zero</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">finsupp.normed_group</span> <span class="n">ι</span> <span class="bp">Λ</span> <span class="n">_inst_3</span> <span class="n">_inst_2</span><span class="o">)))))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">mul_zero_class.to_has_zero</span> <span class="n">ℕ</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">monoid_with_zero.to_mul_zero_class</span> <span class="n">ℕ</span> <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℕ</span> <span class="n">nat.semiring</span><span class="o">)))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">mul_action_with_zero.to_smul_with_zero</span> <span class="n">ℕ</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_has_zero</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.to_add_monoid</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">finsupp.normed_group</span> <span class="n">ι</span> <span class="bp">Λ</span> <span class="n">_inst_3</span> <span class="n">_inst_2</span><span class="o">)))))</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero</span> <span class="n">ℕ</span> <span class="n">nat.semiring</span><span class="o">)</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">semimodule.to_mul_action_with_zero</span> <span class="n">ℕ</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span> <span class="n">nat.semiring</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">finsupp.normed_group</span> <span class="n">ι</span> <span class="bp">Λ</span> <span class="n">_inst_3</span> <span class="n">_inst_2</span><span class="o">)))</span>
            <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.nat_semimodule</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
               <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span>
                  <span class="o">(</span><span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→₀</span> <span class="bp">Λ</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">finsupp.normed_group</span> <span class="n">ι</span> <span class="bp">Λ</span> <span class="n">_inst_3</span> <span class="n">_inst_2</span><span class="o">))))))</span> <span class="bp">=</span>
    <span class="bp">@</span><span class="n">finsupp.has_scalar</span> <span class="n">ι</span> <span class="bp">Λ</span> <span class="n">ℕ</span> <span class="n">nat.semiring</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="bp">Λ</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="bp">Λ</span> <span class="o">(</span><span class="bp">@</span><span class="n">to_normed_group</span> <span class="bp">Λ</span> <span class="n">_inst_2</span><span class="o">)))</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid.nat_semimodule</span> <span class="bp">Λ</span>
         <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_comm_monoid</span> <span class="bp">Λ</span> <span class="o">(</span><span class="bp">@</span><span class="n">normed_group.to_add_comm_group</span> <span class="bp">Λ</span> <span class="o">(</span><span class="bp">@</span><span class="n">to_normed_group</span> <span class="bp">Λ</span> <span class="n">_inst_2</span><span class="o">))))</span>
</code></pre></div>



<a name="230577749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230577749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230577749">(Mar 16 2021 at 19:40)</a>:</h4>
<p><del>ouch... lean could do a better job at linebreaks )-;</del> there, that looks better</p>



<a name="230578667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230578667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230578667">(Mar 16 2021 at 19:46)</a>:</h4>
<p>nat_semimodule is the culprit here</p>



<a name="230579154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579154">(Mar 16 2021 at 19:49)</a>:</h4>
<p>Every "compound" type built out of additive monoids gets two nat-module structures; one elementwise (as this is how all other semimodule structures are inherited), and one derived from addition (which itself is elementwise)</p>



<a name="230579188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579188">(Mar 16 2021 at 19:49)</a>:</h4>
<p>These are rarely defeq</p>



<a name="230579612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579612">(Mar 16 2021 at 19:51)</a>:</h4>
<p>So we should kill the one coming from addition, right?</p>



<a name="230579680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579680">(Mar 16 2021 at 19:52)</a>:</h4>
<p>I'm beginning to think so</p>



<a name="230579711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579711">(Mar 16 2021 at 19:52)</a>:</h4>
<p>Or put it in a locale at least</p>



<a name="230579724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579724">(Mar 16 2021 at 19:52)</a>:</h4>
<p>Maybe that just shouldn't be a global instance</p>



<a name="230579728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579728">(Mar 16 2021 at 19:52)</a>:</h4>
<p>exactly</p>



<a name="230579736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579736">(Mar 16 2021 at 19:52)</a>:</h4>
<p>Along with the one for int and rat</p>



<a name="230579748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579748">(Mar 16 2021 at 19:52)</a>:</h4>
<p>And the algebras for the same</p>



<a name="230579862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579862">(Mar 16 2021 at 19:53)</a>:</h4>
<p>But a lot of lemmas will then need to assume <code>[semimodule \N M]</code>, which you could argue is mathematically redundant</p>



<a name="230579899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230579899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230579899">(Mar 16 2021 at 19:53)</a>:</h4>
<p>Well... will it really be a lot?</p>



<a name="230580142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230580142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230580142">(Mar 16 2021 at 19:55)</a>:</h4>
<p>I'm less concerned about the cost of changing them, and more concerned about mathematicians thinking "this is stupid, why am I telling lean my additive monoid had a nat-module structure" and being told "it's an implementation detail"</p>



<a name="230580510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230580510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230580510">(Mar 16 2021 at 19:57)</a>:</h4>
<p>It's all a bit annoying, because we have a proof that all these structures are equivalent, but it's not enough unless they're also defeq</p>



<a name="230582030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230582030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230582030">(Mar 16 2021 at 20:06)</a>:</h4>
<p>Well, at least for <code>semimodule nat M</code> we know it's a subsingleton.</p>



<a name="230582055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230582055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230582055">(Mar 16 2021 at 20:07)</a>:</h4>
<p>But for <code>has_scalar nat M</code> that's obviously not true.</p>



<a name="230582270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230582270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230582270">(Mar 16 2021 at 20:08)</a>:</h4>
<p>Right, but I think in this case both instances are derived from semimodules, and somehow lean can't see that?</p>



<a name="230582799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230582799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230582799">(Mar 16 2021 at 20:11)</a>:</h4>
<p><code>finsupp.has_scalar</code> is not projecting out of a semimodule instance on <code>finsupp</code>, right?</p>



<a name="230583643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230583643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230583643">(Mar 16 2021 at 20:16)</a>:</h4>
<p>Hmm, good point; the "project out of  semimodule" path is lower priority</p>



<a name="230584650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230584650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230584650">(Mar 16 2021 at 20:22)</a>:</h4>
<p>What happens if you lower a lot the piority of the bad nat semimodule instance (setting it to 10 or whatever)?</p>



<a name="230586014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230586014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230586014">(Mar 16 2021 at 20:31)</a>:</h4>
<p>I suspect there are few if any situations where that would actually help</p>



<a name="230586275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230586275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230586275">(Mar 16 2021 at 20:32)</a>:</h4>
<p>But it wouldn't do any harm</p>



<a name="230586315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230586315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230586315">(Mar 16 2021 at 20:33)</a>:</h4>
<p>Normally, it means that the other instances should be found before, so I am curious what this gives in Johan's specific situation.</p>



<a name="230589777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230589777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230589777">(Mar 16 2021 at 20:56)</a>:</h4>
<p>In my experience the usual cause is using nat's smul in a lemma statement about a general M, which has no other instances so chooses <code>nat.semimodule</code>, but then applying it to a compound type like <code>M := prod N P</code> which has a different instance.</p>



<a name="230592621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230592621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230592621">(Mar 16 2021 at 21:15)</a>:</h4>
<p>Does this mean that, just like for <code>[decidable ...]</code>, we should just assume <code>[semimodule \N E]</code>in the lemmas that mention some nat multiplication. But the user is still free to use the nsmul multiplication if he likes.</p>



<a name="230593596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230593596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230593596">(Mar 16 2021 at 21:23)</a>:</h4>
<p>Yes, that's what I'm thinking</p>



<a name="230593642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230593642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230593642">(Mar 16 2021 at 21:23)</a>:</h4>
<p>At which point, we may as well just hide the global instance behind a locale</p>



<a name="230645931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230645931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230645931">(Mar 17 2021 at 06:57)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">add_comm_monoid.nat_semimodule</span> <span class="n">add_comm_group.int_module</span>
</code></pre></div>
<p>solves all the issues</p>



<a name="230645946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230645946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230645946">(Mar 17 2021 at 06:58)</a>:</h4>
<p>But now I do use the following definition:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">polyhedral_lattice</span> <span class="o">(</span><span class="bp">Λ</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">normed_group</span> <span class="bp">Λ</span> <span class="o">:=</span>
<span class="c1">-- unfortunately, we need the following assumptions, for technical reasons</span>
<span class="o">[</span><span class="n">nat_semimodule</span> <span class="o">:</span> <span class="n">semimodule</span> <span class="n">ℕ</span> <span class="bp">Λ</span><span class="o">]</span>
<span class="o">[</span><span class="n">int_semimodule</span> <span class="o">:</span> <span class="n">semimodule</span> <span class="n">ℤ</span> <span class="bp">Λ</span><span class="o">]</span>
<span class="o">[</span><span class="n">is_scalar_tower</span> <span class="o">:</span> <span class="n">is_scalar_tower</span> <span class="n">ℕ</span> <span class="n">ℤ</span> <span class="bp">Λ</span><span class="o">]</span>
<span class="c1">-- now we get to the actual definition</span>
<span class="o">(</span><span class="n">finite_free</span> <span class="o">:</span> <span class="n">finite_free</span> <span class="bp">Λ</span><span class="o">)</span>
<span class="o">(</span><span class="n">polyhedral</span> <span class="o">[]</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="bp">Λ</span><span class="o">),</span> <span class="n">generates_norm</span> <span class="n">l</span><span class="o">)</span>
</code></pre></div>



<a name="230645984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230645984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230645984">(Mar 17 2021 at 06:58)</a>:</h4>
<p>Which seems slightly awkward</p>



<a name="230647001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230647001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230647001">(Mar 17 2021 at 07:13)</a>:</h4>
<p>There is now just one place at the API boundary where I need</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">have</span> <span class="n">ff</span><span class="bp">Λ</span> <span class="o">:</span> <span class="n">finite_free</span> <span class="bp">Λ</span> <span class="o">:=</span> <span class="n">polyhedral_lattice.finite_free</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">oops</span> <span class="o">:</span> <span class="bp">@</span><span class="n">polyhedral_lattice.int_semimodule</span> <span class="bp">Λ</span> <span class="n">_</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">add_comm_group.int_module</span> <span class="bp">Λ</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">subsingleton.elim</span> <span class="n">_</span> <span class="n">_</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="n">oops</span> <span class="n">at</span> <span class="n">ff</span><span class="bp">Λ</span><span class="o">,</span>
</code></pre></div>



<a name="230647014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230647014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230647014">(Mar 17 2021 at 07:13)</a>:</h4>
<p>So with a more principled refactor, I guess those could also be removed</p>



<a name="230647986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230647986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230647986">(Mar 17 2021 at 07:25)</a>:</h4>
<p>Shouldn't those be arguments not fields?</p>



<a name="230648130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230648130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230648130">(Mar 17 2021 at 07:27)</a>:</h4>
<p>Then I can't use <code>bundled</code> to build the category</p>



<a name="230648202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230648202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230648202">(Mar 17 2021 at 07:27)</a>:</h4>
<p>How do we bundle things like modules and algebras today, which also take multiple arguments?</p>



<a name="230648326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230648326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230648326">(Mar 17 2021 at 07:28)</a>:</h4>
<p>By hand: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/algebra/category/Algebra/basic.lean#L28">https://github.com/leanprover-community/mathlib/blob/master/src/algebra/category/Algebra/basic.lean#L28</a></p>



<a name="230648581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230648581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230648581">(Mar 17 2021 at 07:31)</a>:</h4>
<p>I feel like that's probably the better approach</p>



<a name="230648626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/finsupp.has_scalar/near/230648626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/finsupp.2Ehas_scalar.html#230648626">(Mar 17 2021 at 07:32)</a>:</h4>
<p>But admittedly more work</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>