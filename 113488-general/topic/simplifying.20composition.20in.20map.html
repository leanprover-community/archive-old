---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/simplifying.20composition.20in.20map.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html">simplifying composition in map</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="266380477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266380477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266380477">(Dec 29 2021 at 21:31)</a>:</h4>
<p>I have the following context:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">h''</span> <span class="o">:</span> <span class="n">r.converges</span> <span class="o">(</span><span class="n">map</span> <span class="n">g</span> <span class="o">(</span><span class="n">map</span> <span class="n">f</span> <span class="n">ℱ</span><span class="o">))</span> <span class="o">(</span><span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">))</span>
<span class="bp">⊢</span> <span class="n">r.converges</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">g</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="n">ℱ</span><span class="o">)</span> <span class="o">((</span><span class="n">g</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
</code></pre></div>
<p>I'm not sure how to turn <code>h''</code> into the goal. I tried <code>rw is_lawful_functor.comp_map</code>, but that didn't help since <code>comp_map</code> uses <code>&lt;$&gt;</code> and not <code>map</code>.</p>



<a name="266381589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266381589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266381589">(Dec 29 2021 at 21:49)</a>:</h4>
<p>Try <code>dsimp</code>?</p>



<a name="266381660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266381660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266381660">(Dec 29 2021 at 21:50)</a>:</h4>
<p>Or <code>convert h''</code></p>



<a name="266406956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266406956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266406956">(Dec 30 2021 at 06:40)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/filter.map_map">docs#filter.map_map</a>?</p>



<a name="266406973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266406973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266406973">(Dec 30 2021 at 06:41)</a>:</h4>
<p>Which <code>map</code> are you looking at? There is no <a href="https://leanprover-community.github.io/mathlib_docs/find/map">docs#map</a></p>



<a name="266412738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266412738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266412738">(Dec 30 2021 at 08:48)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a> ?</p>



<a name="266416845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266416845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266416845">(Dec 30 2021 at 10:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/simplifying.20composition.20in.20map/near/266406956">said</a>:</p>
<blockquote>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/filter.map_map">docs#filter.map_map</a>?</p>
</blockquote>
<p>Ah, <code>filter.map_map</code> worked. Thanks a lot.</p>



<a name="266417220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266417220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266417220">(Dec 30 2021 at 10:08)</a>:</h4>
<blockquote>
<p>convert h''</p>
</blockquote>
<p>This also magically works.</p>



<a name="266417398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266417398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266417398">(Dec 30 2021 at 10:12)</a>:</h4>
<p>"Lean doesn't do magic" -- Kenny Lau</p>



<a name="266417455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266417455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266417455">(Dec 30 2021 at 10:13)</a>:</h4>
<p>"Any sufficiently advanced technology is indistinguishable from magic." -- Arthur C. Clarke</p>



<a name="266417614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266417614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266417614">(Dec 30 2021 at 10:16)</a>:</h4>
<p>I've noticed that filter has certain theorems have are basically specializations of more general theorems (e.g. <code>filter.map_map</code> vs.  <code>is_lawful_functor.comp_map</code>). I suppose the reason for this is because Lean can't figure out how to instantiate very general theorems in certain cases, so having a specific one is better.</p>



<a name="266417920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266417920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266417920">(Dec 30 2021 at 10:21)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/is_lawful_functor.comp_map">docs#is_lawful_functor.comp_map</a> isn't universe polymorphic</p>



<a name="266417982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266417982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266417982">(Dec 30 2021 at 10:22)</a>:</h4>
<p>It requires <code>α β γ : Type u</code></p>



<a name="266418020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418020">(Dec 30 2021 at 10:23)</a>:</h4>
<p><code>filter.map_map</code> is, it requires <code>{α : Type u} {β : Type v} {γ : Type w}</code></p>



<a name="266418129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418129">(Dec 30 2021 at 10:24)</a>:</h4>
<p>I thought the ? in <code>Type ?</code> means any universe. I didn't realize it was a name for a universe variable.</p>



<a name="266418496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418496">(Dec 30 2021 at 10:30)</a>:</h4>
<p>Have a look at <a href="https://leanprover-community.github.io/mathlib_docs/find/is_lawful_functor/src">src#is_lawful_functor</a></p>



<a name="266418518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418518">(Dec 30 2021 at 10:31)</a>:</h4>
<p>Is there any reason why functors aren't universe-polymorphic btw? I can't find the source of the restriction.</p>



<a name="266418614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418614">(Dec 30 2021 at 10:33)</a>:</h4>
<p>Try writing the <code>class</code> to be polymorphic, it doesn't work</p>



<a name="266418667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418667">(Dec 30 2021 at 10:34)</a>:</h4>
<p>Hmm... So that's a technical restriction, not a mathematical one?</p>



<a name="266418695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418695">(Dec 30 2021 at 10:35)</a>:</h4>
<p>The problem is that <code>(f : Type u → Type v)</code> is a quantification over types, and means that in the rest of the typeclass you can only talk about <code>f α</code> where <code>α : Type u</code></p>



<a name="266418708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418708">(Dec 30 2021 at 10:35)</a>:</h4>
<p>Yeah but this problem would go away if we did the refactor we talked about, right?</p>



<a name="266418710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418710">(Dec 30 2021 at 10:35)</a>:</h4>
<p>If you deal with <code>f</code> in the way I do in my thread about redesigning the functor typeclasses to use out_param, that problem goes away</p>



<a name="266418714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418714">(Dec 30 2021 at 10:35)</a>:</h4>
<p>If you deal with <code>f</code> in the way I do in my thread about redesigning the functor typeclasses to use out_param, that problem goes away</p>



<a name="266418715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418715">(Dec 30 2021 at 10:35)</a>:</h4>
<p>Yes</p>



<a name="266418716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418716">(Dec 30 2021 at 10:35)</a>:</h4>
<p>Ah yes!</p>



<a name="266418760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418760">(Dec 30 2021 at 10:36)</a>:</h4>
<p>How's this refactor going? Do you need a helping hand?</p>



<a name="266418771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418771">(Dec 30 2021 at 10:36)</a>:</h4>
<p>But the functor typeclasses are hard-coded in the lean3 do notation parser</p>



<a name="266418825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418825">(Dec 30 2021 at 10:37)</a>:</h4>
<p>Can Leo or Gabriel do anything about that?</p>



<a name="266418827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418827">(Dec 30 2021 at 10:38)</a>:</h4>
<p>What is that <code>out_param</code> thing? I see it every once-in-a-while in type classes.</p>



<a name="266418873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418873">(Dec 30 2021 at 10:38)</a>:</h4>
<p>It's a way to stop Lean from trying to infer metavariables.</p>



<a name="266418900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418900">(Dec 30 2021 at 10:39)</a>:</h4>
<p>Is that similar/analogous to the {| |} stuff?</p>



<a name="266418919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418919">(Dec 30 2021 at 10:39)</a>:</h4>
<p>Leo could try this refactor in lean 4, if we could convince him that a) it works, and b) it's worthwhile.</p>



<a name="266418922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418922">(Dec 30 2021 at 10:39)</a>:</h4>
<p>Any documentation about it I can read?</p>



<a name="266418954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266418954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266418954">(Dec 30 2021 at 10:40)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/out_param">docs#out_param</a> has one line of docs I think</p>



<a name="266419005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266419005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266419005">(Dec 30 2021 at 10:40)</a>:</h4>
<p>The point is when you have an instance <code>instance foo.to_bar [foo a b c] : bar a b</code> where one variable that appears in the hypotheses does not appear in the goal. Because of the way TC inference works, when Lean looks for <code>bar a b</code>, it will find <code>foo.to_bar</code> and then look for <code>foo a b ?c</code>, and it will timeout trying to unify that metavariable.</p>



<a name="266419015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266419015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266419015">(Dec 30 2021 at 10:40)</a>:</h4>
<blockquote>
<p>Do you need a helping hand</p>
</blockquote>
<p>Feel free to adopt my branch in the other thread. My goal there was simply to check that it's possible to state all the monad typeclasses in that style, not to actually replace all the old classes for new.</p>



<a name="266419020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266419020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266419020">(Dec 30 2021 at 10:40)</a>:</h4>
<p>So instead we make <code>c</code> an <code>out_param</code> to prevent Lean from trying to figure out what it is.</p>



<a name="266419109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266419109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bernd Losert <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266419109">(Dec 30 2021 at 10:42)</a>:</h4>
<p>I get it. Interesting.</p>



<a name="266434376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266434376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266434376">(Dec 30 2021 at 14:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/simplifying.20composition.20in.20map/near/266418771">said</a>:</p>
<blockquote>
<p>But the functor typeclasses are hard-coded in the lean3 do notation parser</p>
</blockquote>
<p>Actually I don't think this is true. It is hard-coded to make use of whatever <code>bind</code> resolves to, but not monads / functors specifically</p>



<a name="266434681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266434681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266434681">(Dec 30 2021 at 15:01)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">foo</span>
<span class="kd">def</span> <span class="n">bind</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">y</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="k">do</span> <span class="n">a</span> <span class="bp">←</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">a</span>
<span class="kd">end</span> <span class="n">foo</span>
<span class="k">#print</span> <span class="n">foo.bar</span>
<span class="c1">-- def foo.bar : ℕ :=</span>
<span class="c1">-- foo.bind 1 (λ (a : ℕ), 2 + a)</span>
</code></pre></div>



<a name="266501169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simplifying%20composition%20in%20map/near/266501169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/simplifying.20composition.20in.20map.html#266501169">(Dec 31 2021 at 12:32)</a>:</h4>
<p>I thought tactic mode <code>begin end</code> used more than just bind, but perhaps I'm mistaken</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>