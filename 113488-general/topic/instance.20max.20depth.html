---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/instance.20max.20depth.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html">instance max depth</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="196341633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196341633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196341633">(May 05 2020 at 17:46)</a>:</h4>
<p>What has happened to mathlib? I am revisiting an old file (on smooth functions between smooth manifolds, with normed spaces and smooth functions and a bunch of complicated stuff). In this file, written a few months ago, there was a line <code>set_option class.instance_max_depth 150</code> (and this was really needed, 100 was not enough since earlier in the file it was set to 100 and I had to increase it). It turns out that this line can now be removed and, even better, setting the max depth to 10 works fine! (9 is not enough, though :-)</p>



<a name="196342084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196342084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196342084">(May 05 2020 at 17:50)</a>:</h4>
<p>Just for fun, I started commenting the <code>set_option class.instance_max_depth</code> in random files, and it seems to work all the time!</p>



<a name="196343217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196343217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196343217">(May 05 2020 at 18:00)</a>:</h4>
<p>Open a bug report!</p>



<a name="196344124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196344124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196344124">(May 05 2020 at 18:07)</a>:</h4>
<p>I have commented all of them and mathlib builds without one single error!</p>



<a name="196345610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196345610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196345610">(May 05 2020 at 18:19)</a>:</h4>
<p>what changed? I remember doing stuff with tensor products and having to set it to 37</p>



<a name="196348075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196348075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196348075">(May 05 2020 at 18:40)</a>:</h4>
<p>I had to set it to <code>360</code> in a file on multilinear maps. Now <code>11</code> is enough... In between, there was <a href="https://github.com/leanprover-community/mathlib/issues/1724" title="https://github.com/leanprover-community/mathlib/issues/1724">#1724</a> and related work on a priority linter for instances (and possibly other stuff that had some influence on this and that I didn't notice).</p>



<a name="196348351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196348351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196348351">(May 05 2020 at 18:43)</a>:</h4>
<p>Can you also prove false?</p>



<a name="196348599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196348599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196348599">(May 05 2020 at 18:45)</a>:</h4>
<p>The default is something like 20, right?</p>



<a name="196348824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196348824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196348824">(May 05 2020 at 18:46)</a>:</h4>
<p>This is nice to hear because that <a href="https://github.com/leanprover-community/mathlib/issues/1724" title="https://github.com/leanprover-community/mathlib/issues/1724">#1724</a> also needed to raise some other <code>instance_max_depth</code>s, I think</p>



<a name="196348891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196348891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196348891">(May 05 2020 at 18:47)</a>:</h4>
<p>because of the perhaps counterintuitive definition of "depth" in this context</p>



<a name="196348896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196348896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196348896">(May 05 2020 at 18:47)</a>:</h4>
<p>The default is 32.</p>



<a name="196352945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196352945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196352945">(May 05 2020 at 19:14)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/2608" title="https://github.com/leanprover-community/mathlib/issues/2608">#2608</a></p>



<a name="196355436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196355436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196355436">(May 05 2020 at 19:33)</a>:</h4>
<p>Amazing...</p>



<a name="196355596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196355596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196355596">(May 05 2020 at 19:34)</a>:</h4>
<p>Recently I was worried by all those changes without any performance impact study. But that PR makes me feel much better. Surely this max_depth improvement should come with a speed improvement.</p>



<a name="196356664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196356664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196356664">(May 05 2020 at 19:41)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/1724" title="https://github.com/leanprover-community/mathlib/issues/1724">#1724</a> was supposed to make instance lookup faster... which apparently means it would actually have made it a bit slower.</p>



<a name="196357468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196357468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196357468">(May 05 2020 at 19:47)</a>:</h4>
<p>What do you mean?</p>



<a name="196357492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196357492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196357492">(May 05 2020 at 19:47)</a>:</h4>
<p>Why is it actually slower?</p>



<a name="196357574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/instance%20max%20depth/near/196357574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/instance.20max.20depth.html#196357574">(May 05 2020 at 19:48)</a>:</h4>
<p>I think he simply refer to the general trend of effect inversion</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>