---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Backporting.20coercions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html">Backporting coercions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="230907604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230907604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230907604">(Mar 18 2021 at 17:38)</a>:</h4>
<p>Yury is currently busy backporting the coercion type classes from Lean 4.  I'm wondering if it makes sense to backport the coercion unfolding as well.  This will break a <em>lot</em> of stuff in mathlib.  Therefore it could make sense to do this refactoring before the port.  I am just bringing it up as an option.  Making the change in core is not too involved, but I don't think I'll be able to take on the mathlib refactoring.</p>



<a name="230910382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230910382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230910382">(Mar 18 2021 at 17:56)</a>:</h4>
<p>What changed about the coercion unfolding in Lean 4?</p>



<a name="230910643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230910643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230910643">(Mar 18 2021 at 17:58)</a>:</h4>
<p>About <code>coe_fn</code>, could you please fix the pretty printer? I guess the broken function is <code>pp_hide_coercion_fn</code>but I'm not sure. The broken test is <code>tests/lean/coe4</code>.</p>



<a name="230911815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230911815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230911815">(Mar 18 2021 at 18:04)</a>:</h4>
<p>One more issue: now Lean fails to generate instance names for <code>has_coe_to_fun</code> instances.</p>



<a name="230913516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230913516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230913516">(Mar 18 2021 at 18:14)</a>:</h4>
<blockquote>
<p>I'm not sure if everybody realizes this, but Lean 4 doesn't have <code>⇑</code> or <code>↑</code>.  The coercion is immediately eliminated after/during elaboration:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">CoeFun</span> <span class="n">Nat</span> <span class="o">(</span><span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="n">Nat</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">coe</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span>

<span class="k">#check</span> <span class="o">(</span><span class="mi">4</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="mi">8</span>
<span class="c1">-- (fun (b : Nat) =&gt; 4 + b) 8 : Nat</span>
</code></pre></div><br>
</p>
</blockquote>



<a name="230915792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230915792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230915792">(Mar 18 2021 at 18:29)</a>:</h4>
<p>So, we'll see explicit <code>(e : E →L[R] F).to_linear_map</code>, <code>subtype.val</code> etc?</p>



<a name="230915975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230915975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230915975">(Mar 18 2021 at 18:30)</a>:</h4>
<p>I mean, in the proof state.</p>



<a name="230916034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230916034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230916034">(Mar 18 2021 at 18:31)</a>:</h4>
<p>Yes.</p>



<a name="230916257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230916257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230916257">(Mar 18 2021 at 18:32)</a>:</h4>
<p>:(</p>



<a name="230916522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230916522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230916522">(Mar 18 2021 at 18:34)</a>:</h4>
<p>But we won't need <code>coe_mk</code> etc. :-)</p>



<a name="230918081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230918081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230918081">(Mar 18 2021 at 18:46)</a>:</h4>
<p>But we'll need a new <code>norm_cast</code> that tracks all functions used as coercions, not only <code>coe</code>/<code>coe_fn</code>.</p>



<a name="230924977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230924977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230924977">(Mar 18 2021 at 19:34)</a>:</h4>
<p>One will need some pretty-printer tweaking so that <code>subtype.val</code> shows up as a little arrow, as well as all the other functions we are used to as coercions. Then the situation should not be really different from what we are used to.</p>



<a name="230929439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230929439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230929439">(Mar 18 2021 at 20:07)</a>:</h4>
<p>No way to have <code>@[simp] lemma [is_monoid_hom (coe : M → N)] (x y : M) : ((x * y : M) : N) = x * y := ...</code> (though we want to have it as a <code>rfl</code> simp lemma in many cases anyway)</p>



<a name="230930167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230930167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230930167">(Mar 18 2021 at 20:13)</a>:</h4>
<p>How does this unfolding work? Is <code>CoeFun</code> special cased in the elaborator?</p>



<a name="230930194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/230930194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#230930194">(Mar 18 2021 at 20:13)</a>:</h4>
<p>Do subclasses of it get unfolded in the same way?</p>



<a name="231089462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231089462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231089462">(Mar 19 2021 at 21:01)</a>:</h4>
<p>I don't think we should bother backporting this. We can eliminate coercions in mathport, but this is going to need a lot of manual work to make it work well and I'd rather do that work in a context where the rest of lean 4 is available</p>



<a name="231872531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231872531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231872531">(Mar 25 2021 at 20:40)</a>:</h4>
<p>Thanks to <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>, Lean core builds with the new <code>has_coe_to_fun</code> and <code>has_coe_to_sort</code>. I've started porting <code>mathlib</code> and found out that <code>has_coe_to_sort</code> doesn't work as expected (by me):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universe</span> <span class="n">u</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_coe_to_sort</span> <span class="o">(</span><span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span><span class="o">}⟩</span>

<span class="kd">example</span> <span class="o">:</span> <span class="bp">↥</span><span class="o">({</span><span class="mi">0</span><span class="o">}</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="mi">0</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩</span>
</code></pre></div>
<p>now fails with message "5:29: invalid constructor ⟨...⟩, 'has_coe_to_sort.coe' is not an inductive type"</p>



<a name="231872635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231872635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231872635">(Mar 25 2021 at 20:40)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/tree/coe-fn-backport">branch#coe-fn-backport</a></p>



<a name="231879054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231879054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231879054">(Mar 25 2021 at 21:29)</a>:</h4>
<p>This sounds like something that <a href="https://github.com/leanprover-community/mathlib/issues/6768">#6768</a> might make worse</p>



<a name="231879143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231879143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231879143">(Mar 25 2021 at 21:29)</a>:</h4>
<p>Did the elaborator have special support for this before that we forgot to patch?</p>



<a name="231931787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231931787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231931787">(Mar 26 2021 at 08:52)</a>:</h4>
<p>This works just fine if you remove the ↥.</p>



<a name="231932183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231932183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231932183">(Mar 26 2021 at 08:56)</a>:</h4>
<p>So this is like the opposite of the <code>let</code> bug I found recently that required the arrow?</p>



<a name="231932475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/231932475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#231932475">(Mar 26 2021 at 08:59)</a>:</h4>
<p>If you will.  I'm not completely sure why it worked before, but I've pushed a fix to the branch.</p>



<a name="232029569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232029569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232029569">(Mar 26 2021 at 20:48)</a>:</h4>
<p>I'm trying to adjust <code>simps</code>. Currently it uses this code</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>        <span class="n">e_inst_type</span> <span class="bp">←</span> <span class="n">to_expr</span> <span class="o">((</span><span class="n">expr.const</span> <span class="n">class_nm</span> <span class="o">[])</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">pexpr.of_expr</span> <span class="n">e_str</span><span class="o">)),</span>
        <span class="n">e_inst</span> <span class="bp">←</span> <span class="n">try_for</span> <span class="mi">1000</span> <span class="o">(</span><span class="n">mk_instance</span> <span class="n">e_inst_type</span><span class="o">),</span>
</code></pre></div>
<p>to find an instance of <code>has_coe_to_fun</code>/<code>has_coe_to_sort</code>. This no longer works because these classes now take one more argument. How do I fix this?</p>



<a name="232108551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232108551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232108551">(Mar 27 2021 at 18:28)</a>:</h4>
<p>Ping <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> and <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> here</p>



<a name="232145327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232145327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232145327">(Mar 28 2021 at 06:04)</a>:</h4>
<p>Fixed <code>simps</code>. The next expression that used to work with the old <code>coe_fn</code> but fails now:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">universe</span> <span class="n">u</span>

<span class="kd">structure</span> <span class="n">End</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">End</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">End.to_fun</span><span class="o">⟩</span>

<span class="c1">-- This works fine</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">End</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">g</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h</span><span class="bp">;</span> <span class="n">refl</span>

<span class="c1">-- This fails with error</span>
<span class="c1">-- failed to synthesize type class instance for</span>
<span class="c1">-- f g : End ℕ</span>
<span class="c1">-- ⊢ has_coe_to_fun (End ℕ) (λ {f : End ℕ}, End ℕ)"</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">End</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">⇑</span><span class="n">f</span> <span class="bp">=</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">g</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h</span><span class="bp">;</span> <span class="n">refl</span>
</code></pre></div>



<a name="232176606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232176606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232176606">(Mar 28 2021 at 16:21)</a>:</h4>
<p>One more problem: <code>derive has_coe_to_sort</code> no longer works because <code>has_coe_to_sort new_def</code> is not a <code>Sort*</code></p>



<a name="232176979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232176979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232176979">(Mar 28 2021 at 16:27)</a>:</h4>
<p>Does <code>derive [\lam T, has_coe_to_sort T (A \to B)]</code>?</p>



<a name="232177497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232177497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232177497">(Mar 28 2021 at 16:35)</a>:</h4>
<p>I'll try tonight (or you can try on <a href="https://github.com/leanprover-community/mathlib/tree/coe-fn-backport">branch#coe-fn-backport</a>)</p>



<a name="232177587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232177587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232177587">(Mar 28 2021 at 16:36)</a>:</h4>
<p>Also, I can't understand why Lean fails to simplify using <code>swap_apply_left</code> in <code>group_theory/perm/sign</code>, line 439</p>



<a name="232177903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232177903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232177903">(Mar 28 2021 at 16:43)</a>:</h4>
<p>Oh, I bet in the context of the derive handler <code>A</code> and <code>B</code> aren't available yet</p>



<a name="232177966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232177966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232177966">(Mar 28 2021 at 16:44)</a>:</h4>
<p>So far I was replacing <code>derive</code> with explicit <code>instance</code>s.</p>



<a name="232177991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232177991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232177991">(Mar 28 2021 at 16:44)</a>:</h4>
<p>I think that's probably fine</p>



<a name="232178108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232178108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232178108">(Mar 28 2021 at 16:46)</a>:</h4>
<p>I have no idea why it fails in <code>perm/sign</code>.</p>



<a name="232684385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232684385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232684385">(Apr 01 2021 at 00:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Could you please fix <code>elementwise</code> in <a href="https://github.com/leanprover-community/mathlib/tree/coe-fn-backport">branch#coe-fn-backport</a>? In this branch we moved <code>F</code>/<code>S</code> in <code>has_coe_to_fun</code>/<code>has_coe_to_sort</code> from output to an <code>out_params</code> argument.</p>



<a name="232684488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232684488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232684488">(Apr 01 2021 at 00:04)</a>:</h4>
<p>Certainly I can try, but unfortunately I won't really have time until next Tuesday. I've already exceeded my Lean budget today and should start packing for the weekend! I've starred this message.</p>



<a name="232692978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232692978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232692978">(Apr 01 2021 at 02:01)</a>:</h4>
<p>I had a go at fixing this in <a href="https://github.com/leanprover-community/mathlib/tree/coe-fn-backport-bmehta-test">branch#coe-fn-backport-bmehta-test</a> (so as not to mess up anyone else's work), I think it worked? The CI error is in a different file now at least</p>



<a name="232699920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/232699920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#232699920">(Apr 01 2021 at 03:50)</a>:</h4>
<p>Thank you! Merged back to my branch, fixing other errors.</p>



<a name="233715815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/233715815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#233715815">(Apr 08 2021 at 19:39)</a>:</h4>
<p>I fixed all compile errors in <code>src/</code>, see <a href="https://github.com/leanprover-community/mathlib/issues/7033">#7033</a>, but there are a few regressions that may be related to the changes in C++ code. I'll try to make <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>'s tonight.</p>
<ul>
<li>sometimes <code>exact ⟨_, by simp, a + b⟩</code> fails to deduce the value of <code>_</code> from <code>a + b</code> before evaluating <code>by simp</code>, see <a href="https://github.com/leanprover-community/mathlib/pull/7033/files#diff-974198b01e68e2f07fa52ee6391a9234237738fa4009a5565e3754dae15ba7dfL630">these lines</a> of the diff.</li>
<li>sometimes Lean needs more type annotations, may be related to the previous item, see <a href="https://github.com/leanprover-community/mathlib/pull/7033/files#diff-21c4e0febee1d0ac977944b0ba0d0ae83e8c4b3a2a5cfaff2f60eec313ec6449">here</a>;</li>
<li><code>@[derive has_coe_to_fun]</code> no longer works because <code>has_coe_to_fun my_type</code> is not a <code>Sort*</code>. Is it hard to make <code>derive</code> work when <code>myclass mytype</code> is <code>Π (arg : Type . out_param), Sort*</code>?</li>
<li><code>simp</code> can't use <code>coe_fn_coe_base</code>, see <a href="https://github.com/leanprover-community/mathlib/pull/7033/files#diff-21c4e0febee1d0ac977944b0ba0d0ae83e8c4b3a2a5cfaff2f60eec313ec6449">here</a> and <a href="https://github.com/leanprover-community/mathlib/pull/7033/files#diff-29a16c03884a7a902d4ae9eaed0b63eaf7cb329734950ecc58618a155fe80bc4L1276">here</a>;</li>
<li><code>lemma coe_inj {e₁ e₂ : α ≃ β} : ⇑e₁ = e₂ ↔ e₁ = e₂ :=</code> no longer works, now we need <code>lemma coe_inj {e₁ e₂ : α ≃ β} : (e₁ : α → β) = e₂ ↔ e₁ = e₂ :=</code>;</li>
<li><code>change ... with ...</code> causes timeout <a href="https://github.com/leanprover-community/mathlib/pull/7033/files#diff-0100cf1cb979093e120d1b72c06e27a069fbe492f5d8eabec094dbe9b3ce80dd">here</a>;</li>
<li>in <a href="https://github.com/leanprover-community/mathlib/pull/7033/files#diff-126733ed2b8b67441355f6f20dbb566366f0dd0844a7d7b6ee5e7c6671c46e68">one proof</a> <code>simp</code> fails to use <code>swap_apply_left</code> and <code>swap_apply_right</code></li>
</ul>



<a name="233715898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/233715898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#233715898">(Apr 08 2021 at 19:40)</a>:</h4>
<p>And tests still fail. Some of them indicate that we need to fix linters about <code>coe_fn</code>.</p>



<a name="233888943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/233888943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#233888943">(Apr 09 2021 at 20:58)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Ping here</p>



<a name="253682323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253682323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253682323">(Sep 17 2021 at 03:00)</a>:</h4>
<p>I've updated both Lean branch and mathlib branch.</p>



<a name="253682354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253682354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253682354">(Sep 17 2021 at 03:01)</a>:</h4>
<p>Pushed to <a href="https://github.com/leanprover-community/mathlib/issues/7033">#7033</a>, waiting for CI. Probably there will be some new failures.</p>



<a name="253682702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253682702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253682702">(Sep 17 2021 at 03:06)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> <span class="user-mention" data-user-id="238446">@Anne Baanen</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="253682736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253682736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253682736">(Sep 17 2021 at 03:06)</a>:</h4>
<p>See also the list of regressions from April. I guess, it's still the same.</p>



<a name="253705308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253705308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253705308">(Sep 17 2021 at 08:02)</a>:</h4>
<p>Thanks for the update! I'll take a look in about 1 hour.</p>



<a name="253736328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253736328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253736328">(Sep 17 2021 at 12:48)</a>:</h4>
<p>Pushed some fixes</p>



<a name="253877618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253877618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253877618">(Sep 18 2021 at 16:05)</a>:</h4>
<p>I don't know how to fix the deterministic timeout (see CI).</p>



<a name="253992012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/253992012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#253992012">(Sep 20 2021 at 03:06)</a>:</h4>
<p><span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span> I've pushed a fix for this timeout.</p>



<a name="255201429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/255201429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#255201429">(Sep 28 2021 at 11:34)</a>:</h4>
<p>Fixed everything in <code>src/</code> and some things in <code>test/</code>, now merging master and seeing what broke in the meantime.</p>



<a name="257350780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/257350780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#257350780">(Oct 13 2021 at 11:45)</a>:</h4>
<p>Another bump, fixed <code>src</code> and some more files in <code>test</code>. We're nearly there now...</p>



<a name="257366769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/257366769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#257366769">(Oct 13 2021 at 13:40)</a>:</h4>
<p><code>src</code> and <code>test</code> now fully build on my machine. Let's hope the CI runner doesn't crash this time.</p>



<a name="258216568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258216568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258216568">(Oct 19 2021 at 15:36)</a>:</h4>
<p>Another week, another bump. All tests passed on my machine before the merge, let's see what they do now.</p>



<a name="258216961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258216961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258216961">(Oct 19 2021 at 15:38)</a>:</h4>
<p>Should we freeze the queue and prioritize this?</p>



<a name="258218493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258218493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258218493">(Oct 19 2021 at 15:46)</a>:</h4>
<p>What is the state with mathlib?  Can we expect to port mathlib to the change in a timely manner?</p>



<a name="258229077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258229077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258229077">(Oct 19 2021 at 16:43)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> I think that's what <a href="https://github.com/leanprover-community/mathlib/issues/7033">#7033</a> is doing.</p>



<a name="258229200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258229200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258229200">(Oct 19 2021 at 16:43)</a>:</h4>
<p>Ah ok, that one only has failures in the tests.</p>



<a name="258229535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258229535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258229535">(Oct 19 2021 at 16:45)</a>:</h4>
<p>I'm happy with merging <a href="https://github.com/leanprover-community/lean/issues/557">lean#557</a></p>



<a name="258230745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258230745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258230745">(Oct 19 2021 at 16:51)</a>:</h4>
<p>Let's go for it.</p>



<a name="258251587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258251587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258251587">(Oct 19 2021 at 18:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/113488-general/topic/Backporting.20coercions/near/258229200">said</a>:</p>
<blockquote>
<p>Ah ok, that one only has failures in the tests.</p>
</blockquote>
<p>It even built completely once on my machine, except mathlib got some new <code>has_coe_to_fun</code> definitions :P</p>



<a name="258257330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258257330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258257330">(Oct 19 2021 at 19:27)</a>:</h4>
<p>Seems like bors is having trouble to find time for <a href="https://github.com/leanprover-community/lean/issues/557">lean#557</a></p>



<a name="258257527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258257527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258257527">(Oct 19 2021 at 19:28)</a>:</h4>
<p>But I don't think it's waiting for a runner, right?</p>



<a name="258257947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258257947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258257947">(Oct 19 2021 at 19:31)</a>:</h4>
<p>The <code>staging</code> build has a job which appears to be stuck: <a href="https://github.com/leanprover-community/lean/runs/3941583934?check_suite_focus=true">https://github.com/leanprover-community/lean/runs/3941583934?check_suite_focus=true</a></p>



<a name="258317752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258317752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258317752">(Oct 20 2021 at 06:16)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/557">lean#557</a> is now merged. So <a href="https://github.com/leanprover-community/mathlib/issues/7033">#7033</a> should become the corresponding "bump lean" PR, I guess.</p>



<a name="258320564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258320564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258320564">(Oct 20 2021 at 06:54)</a>:</h4>
<p>Ooh never mind, I guess we first need a lean release.</p>



<a name="258323025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258323025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258323025">(Oct 20 2021 at 07:18)</a>:</h4>
<p>Yeah, the previous PR (not even <a href="https://github.com/leanprover-community/mathlib/issues/557">#557</a>) was stuck in the "Build sanitized" steps for an unknown reason.  I've put the other one back one queue again as well.</p>



<a name="258443240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258443240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258443240">(Oct 20 2021 at 20:58)</a>:</h4>
<p>Could somebody please adjust the types of the coercion inductives to match Lean4?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Coe.</span><span class="o">{</span><span class="n">u_1</span><span class="o">,</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u_1</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u_2</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="n">max</span> <span class="mi">1</span> <span class="n">u_1</span><span class="o">)</span> <span class="n">u_2</span><span class="o">)</span>
<span class="n">Coeₓ.</span><span class="o">{</span><span class="n">u_1</span><span class="o">,</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u_1</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u_2</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">max</span> <span class="mi">1</span> <span class="o">(</span><span class="n">imax</span> <span class="n">u_1</span> <span class="n">u_2</span><span class="o">))</span>
<span class="n">CoeFun.</span><span class="o">{</span><span class="n">u_1</span><span class="o">,</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">outParam.</span><span class="o">{</span><span class="n">max</span> <span class="n">u_1</span> <span class="o">(</span><span class="n">u_2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)}</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u_2</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="n">max</span> <span class="mi">1</span> <span class="n">u_1</span><span class="o">)</span> <span class="n">u_2</span><span class="o">)</span>
<span class="n">CoeFunₓ.</span><span class="o">{</span><span class="n">u_1</span><span class="o">,</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">outParam.</span><span class="o">{</span><span class="n">max</span> <span class="n">u_1</span> <span class="o">(</span><span class="n">u_2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)}</span> <span class="o">(</span><span class="n">a</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u_2</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">max</span> <span class="n">u_1</span> <span class="o">(</span><span class="n">u_2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span>
<span class="n">CoeSort.</span><span class="o">{</span><span class="n">u_1</span><span class="o">,</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u_1</span> <span class="bp">→</span> <span class="n">outParam.</span><span class="o">{</span><span class="n">u_2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="kt">Sort</span> <span class="n">u_2</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="n">max</span> <span class="mi">1</span> <span class="n">u_1</span><span class="o">)</span> <span class="n">u_2</span><span class="o">)</span>
<span class="n">CoeSortₓ.</span><span class="o">{</span><span class="n">u_1</span><span class="o">,</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u_1</span> <span class="bp">→</span> <span class="n">outParam.</span><span class="o">{</span><span class="n">u_2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="kt">Sort</span> <span class="n">u_2</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u_1</span> <span class="o">(</span><span class="n">u_2</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span>
</code></pre></div>



<a name="258460219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258460219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258460219">(Oct 20 2021 at 23:23)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/pull/632">https://github.com/leanprover-community/lean/pull/632</a></p>



<a name="258460921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258460921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258460921">(Oct 20 2021 at 23:31)</a>:</h4>
<p>I haven't done any testing, just handed it off to CI for now.</p>



<a name="258464299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258464299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258464299">(Oct 21 2021 at 00:06)</a>:</h4>
<p>Thanks! I forgot that the mathlib-propagation happens later.</p>



<a name="258464641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258464641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258464641">(Oct 21 2021 at 00:09)</a>:</h4>
<p>It seems plausible that there may not be any changes required in mathlib. Later today I'll make a mathlib branch to test.</p>



<a name="258470858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258470858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258470858">(Oct 21 2021 at 01:09)</a>:</h4>
<p>I suggest that we merge <a href="https://github.com/leanprover-community/mathlib/issues/9824">#9824</a> without waiting for this.</p>



<a name="258470956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258470956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258470956">(Oct 21 2021 at 01:10)</a>:</h4>
<p>Once <a href="https://github.com/leanprover-community/lean/issues/632">lean#632</a> (and its <code>mathlib</code> part) are ready, we can release a new Lean and merge again.</p>



<a name="258475801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258475801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258475801">(Oct 21 2021 at 02:05)</a>:</h4>
<p><span class="user-group-mention" data-user-group-id="2494">@maintainers</span> Should I merge <a href="https://github.com/leanprover-community/mathlib/issues/9824">#9824</a> once CI is happy? It was happy with the previous commit, and the last commit just removes a duplicate import, so I'm pretty sure that CI will be happy.</p>



<a name="258476181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258476181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258476181">(Oct 21 2021 at 02:09)</a>:</h4>
<p>Can we edit Scott's post so the commit message says something about the coercion changes?</p>



<a name="258476275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258476275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258476275">(Oct 21 2021 at 02:10)</a>:</h4>
<p>Nothing long, but this is a big breaking change, it doesn't hurt to have it in the permanent record</p>



<a name="258476285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258476285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258476285">(Oct 21 2021 at 02:11)</a>:</h4>
<p>Otherwise I'm fine with merging</p>



<a name="258477059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258477059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258477059">(Oct 21 2021 at 02:21)</a>:</h4>
<p>I added a short commit message. Did I forget something?</p>



<a name="258478103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258478103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258478103">(Oct 21 2021 at 02:35)</a>:</h4>
<p>I also see a new command <code>setup_tactic_parser</code>. <span class="user-mention" data-user-id="110596">@Rob Lewis</span> could you please add its description to the commit message?</p>



<a name="258478656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258478656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258478656">(Oct 21 2021 at 02:42)</a>:</h4>
<p><code>setup_tactic_parser</code> has been around for ages, looks like it just got a minor update because of the namespacing changes. <a href="https://github.com/leanprover-community/mathlib/pull/9824/files#diff-41e4d36d845844e40ede47bd45f062b5f9293b9517112eb65dcfed9f25ce17cfL1886">https://github.com/leanprover-community/mathlib/pull/9824/files#diff-41e4d36d845844e40ede47bd45f062b5f9293b9517112eb65dcfed9f25ce17cfL1886</a></p>



<a name="258480729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Backporting%20coercions/near/258480729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Backporting.20coercions.html#258480729">(Oct 21 2021 at 03:10)</a>:</h4>
<p>We use <code>setup_tactic_parser</code> a lot more now, both because we should, and a lot of the <code>open</code> statements that it can replace needed fixing anyway.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>