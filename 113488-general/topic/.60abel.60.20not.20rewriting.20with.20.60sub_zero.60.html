---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html">`abel` not rewriting with `sub_zero`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="266645648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266645648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266645648">(Jan 03 2022 at 02:17)</a>:</h4>
<p>Is this a bug in <code>abel</code>?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.basic</span>
<span class="kn">import</span> <span class="n">tactic.abel</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">{</span><span class="n">v</span> <span class="n">w</span> <span class="o">:</span> <span class="n">V</span><span class="o">}</span> <span class="o">:</span> <span class="n">v</span> <span class="bp">-</span> <span class="mi">0</span> <span class="bp">-</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">w</span> <span class="bp">=</span> <span class="n">v</span> <span class="bp">-</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">w</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">abel</span><span class="o">,</span>
  <span class="gr">sorry</span> <span class="c1">-- goal `v + (0 + (-1) • a • w) = v + (-1) • a • w`</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">{</span><span class="n">v</span> <span class="n">w</span> <span class="o">:</span> <span class="n">V</span><span class="o">}</span> <span class="o">:</span> <span class="n">v</span> <span class="bp">-</span> <span class="mi">0</span> <span class="bp">-</span> <span class="n">w</span> <span class="bp">=</span> <span class="n">v</span> <span class="bp">-</span> <span class="n">w</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">abel</span> <span class="c1">-- works</span>
</code></pre></div>



<a name="266648574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266648574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266648574">(Jan 03 2022 at 03:36)</a>:</h4>
<p>Simplified:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">{</span><span class="n">w</span> <span class="o">:</span> <span class="n">V</span><span class="o">}</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">w</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">w</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">abel</span><span class="o">,</span> <span class="c1">-- "abel failed to simplify"</span>
<span class="kd">end</span>
</code></pre></div>



<a name="266656872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266656872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266656872">(Jan 03 2022 at 07:11)</a>:</h4>
<p>Further simplified:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.abel</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">{</span><span class="n">w</span> <span class="o">:</span> <span class="n">V</span><span class="o">}</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">w</span> <span class="bp">=</span> <span class="n">w</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">abel1</span> <span class="c1">-- fails</span>
</code></pre></div>



<a name="266656934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266656934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266656934">(Jan 03 2022 at 07:12)</a>:</h4>
<p>The error message indicates that the problem is that the LHS, RHS normal forms under <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.abel.eval">docs#tactic.abel.eval</a> are not the same: respectively</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>  tactic.abel.termg 1 w (tactic.abel.termg 1 0 0) : V
  tactic.abel.termg 1 w 0 : V
</code></pre></div>



<a name="266657006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657006">(Jan 03 2022 at 07:14)</a>:</h4>
<p>I think the answer to </p>
<blockquote>
<p>Is this a bug in <code>abel</code>?</p>
</blockquote>
<p>is definitely yes <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="266657014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657014">(Jan 03 2022 at 07:14)</a>:</h4>
<p>Feel free to open an issue, I'll find time to look into it</p>



<a name="266657025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657025">(Jan 03 2022 at 07:15)</a>:</h4>
<p>Or cc <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> if you have ideas</p>



<a name="266657096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657096">(Jan 03 2022 at 07:16)</a>:</h4>
<p>It looks like <code>0</code> has been interpreted as an atom there. What does it look like as <code>pp.all</code>?</p>



<a name="266657146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657146">(Jan 03 2022 at 07:17)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">is_def_eq</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">the</span> <span class="n">following</span> <span class="n">expressions</span> <span class="n">are</span> <span class="n">not</span> <span class="n">definitionally</span> <span class="n">equal</span> <span class="o">(</span><span class="n">remark</span><span class="o">:</span> <span class="n">is_def_eq</span> <span class="n">tactic</span> <span class="n">does</span> <span class="n">modify</span> <span class="n">the</span> <span class="n">metavariable</span> <span class="n">assignment</span><span class="o">)</span>
  <span class="bp">@</span><span class="n">tactic.abel.termg.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_one.one.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">int</span> <span class="n">int.has_one</span><span class="o">)</span> <span class="n">w</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">tactic.abel.termg.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_one.one.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">int</span> <span class="n">int.has_one</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.to_add_monoid.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="n">_inst_1</span><span class="o">))))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.to_add_monoid.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
                   <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="n">_inst_1</span><span class="o">)))))))</span>
  <span class="o">:</span> <span class="n">V</span>
<span class="n">and</span>
  <span class="bp">@</span><span class="n">tactic.abel.termg.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="n">_inst_1</span> <span class="o">(</span><span class="bp">@</span><span class="n">has_one.one.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">int</span> <span class="n">int.has_one</span><span class="o">)</span> <span class="n">w</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">has_zero.zero.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_zero_class.to_has_zero.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_monoid.to_add_zero_class.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">sub_neg_monoid.to_add_monoid.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span>
                <span class="o">(</span><span class="bp">@</span><span class="n">add_group.to_sub_neg_monoid.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group.to_add_group.</span><span class="o">{</span><span class="bp">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">V</span> <span class="n">_inst_1</span><span class="o">))))))</span>
  <span class="o">:</span> <span class="n">V</span>
</code></pre></div>



<a name="266657241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657241">(Jan 03 2022 at 07:19)</a>:</h4>
<p>Does it work if you use a concrete universe?</p>



<a name="266657264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657264">(Jan 03 2022 at 07:19)</a>:</h4>
<p>No (switched from Type* to Type)</p>



<a name="266657367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657367">(Jan 03 2022 at 07:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60/near/266657014">said</a>:</p>
<blockquote>
<p>Feel free to open an issue, I'll find time to look into it</p>
</blockquote>
<p>Thanks! <a href="https://github.com/leanprover-community/mathlib/pull/11200">#11200</a></p>



<a name="266657515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657515">(Jan 03 2022 at 07:24)</a>:</h4>
<p>Oh! <code>abel</code> doesn't support numeric literals at all</p>



<a name="266657641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657641">(Jan 03 2022 at 07:26)</a>:</h4>
<p>I suppose there is no relevant numeric literal other than 0, in an add_comm_group.</p>



<a name="266657656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657656">(Jan 03 2022 at 07:26)</a>:</h4>
<p>Well, other numeric literals should probably evaluate to <code>smul(g) n 1</code></p>



<a name="266657672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657672">(Jan 03 2022 at 07:27)</a>:</h4>
<p>What is the 1?</p>



<a name="266657699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657699">(Jan 03 2022 at 07:27)</a>:</h4>
<p>Dunno, depends on the type</p>



<a name="266657746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657746">(Jan 03 2022 at 07:28)</a>:</h4>
<p>but if <code>3</code> typechecks then presumably <code>1</code> does too</p>



<a name="266657763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266657763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266657763">(Jan 03 2022 at 07:28)</a>:</h4>
<p>but there are a bunch of cases there and maybe it's best just to ignore it</p>



<a name="266658048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266658048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266658048">(Jan 03 2022 at 07:35)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/11201">#11201</a></p>



<a name="266658543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266658543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266658543">(Jan 03 2022 at 07:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> If I am trying out your code correctly, the following example still fails:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">•</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">•</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">abel1</span>
</code></pre></div>



<a name="266658720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266658720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266658720">(Jan 03 2022 at 07:48)</a>:</h4>
<p>That looks like an independent bug :) <code>n • a = n • a</code> fails too</p>



<a name="266658872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266658872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266658872">(Jan 03 2022 at 07:51)</a>:</h4>
<p>In some sense this is expected, <code>abel</code> wants <code>n</code> to be a numeral, but it should have some kind of fallback to treat <code>n • a</code> as an atom</p>



<a name="266659174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659174">(Jan 03 2022 at 07:57)</a>:</h4>
<p>also fixed in <a href="https://github.com/leanprover-community/mathlib/pull/11201">#11201</a></p>



<a name="266659208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659208">(Jan 03 2022 at 07:57)</a>:</h4>
<p>I see.  In fact the example I initially asked about seems to fixed by (the first version of <a href="https://github.com/leanprover-community/mathlib/pull/11201">#11201</a>, before the additional fix):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">has_scalar</span> <span class="n">R</span> <span class="n">V</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">•</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">•</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">abel</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>so it's just that it can't deal with <code>R = ℤ</code> because <code>ℤ</code>-multiplication is exploited in the <code>abel</code> code.</p>



<a name="266659225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659225">(Jan 03 2022 at 07:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60/near/266659174">said</a>:</p>
<blockquote>
<p>also fixed in <a href="https://github.com/leanprover-community/mathlib/pull/11201">#11201</a></p>
</blockquote>
<p>Thanks!</p>



<a name="266659301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659301">(Jan 03 2022 at 07:59)</a>:</h4>
<p>Conceivably we could have the analogue of <code>ring_exp</code> here, where the scalar multiplies are handled using <code>ring</code> instead of <code>norm_num</code></p>



<a name="266659478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659478">(Jan 03 2022 at 08:01)</a>:</h4>
<p>Do you mean things like this?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra.basic</span>
<span class="kn">import</span> <span class="n">tactic.abel</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">e</span> <span class="n">f</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">V</span><span class="o">}</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">f</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">e</span><span class="o">)</span> <span class="bp">•</span> <span class="n">c</span> <span class="bp">-</span> <span class="o">(</span><span class="mi">0</span><span class="o">:</span><span class="n">V</span><span class="o">)</span> <span class="bp">=</span> <span class="n">e</span> <span class="bp">•</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">•</span> <span class="n">c</span><span class="o">)</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">•</span> <span class="o">(</span><span class="n">f</span> <span class="bp">•</span> <span class="n">c</span> <span class="bp">-</span> <span class="n">e</span> <span class="bp">•</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> and I were just discussing this earlier today.</p>



<a name="266659529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659529">(Jan 03 2022 at 08:02)</a>:</h4>
<p>Yes. I guess that would be a <code>module</code> tactic</p>



<a name="266659893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659893">(Jan 03 2022 at 08:08)</a>:</h4>
<p>Couple of other tests for such a tactic:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">2</span><span class="o">:</span><span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">x</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="266659908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60abel%60%20not%20rewriting%20with%20%60sub_zero%60/near/266659908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60abel.60.20not.20rewriting.20with.20.60sub_zero.60.html#266659908">(Jan 03 2022 at 08:08)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">char_zero</span> <span class="n">R</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">V</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">z</span> <span class="bp">-</span> <span class="o">((</span><span class="mi">5</span><span class="bp">/</span><span class="mi">3</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">x</span><span class="o">)</span>
  <span class="bp">=</span> <span class="bp">-</span><span class="o">((</span><span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">•</span> <span class="n">y</span><span class="o">)</span> <span class="bp">-</span> <span class="n">z</span><span class="o">)</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">-</span> <span class="o">((</span><span class="mi">2</span><span class="bp">/</span><span class="mi">3</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">•</span> <span class="n">x</span> <span class="bp">-</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">•</span> <span class="n">y</span><span class="o">)</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>