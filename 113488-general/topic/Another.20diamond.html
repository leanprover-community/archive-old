---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Another.20diamond.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html">Another diamond</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261766146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261766146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261766146">(Nov 17 2021 at 10:26)</a>:</h4>
<p>Working on FLT-regular, I found another diamond that I am not sure how to correct. Here is a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.fixed</span>
<span class="kn">import</span> <span class="n">field_theory.primitive_element</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="n">F</span> <span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">K</span> <span class="n">E</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">finite_dimensional</span> <span class="n">K</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">is_separable</span> <span class="n">K</span> <span class="n">F</span><span class="o">]</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">fintype</span> <span class="o">(</span><span class="n">F</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span> <span class="n">field.alg_hom.fintype</span> <span class="n">K</span> <span class="n">F</span>

<span class="kd">noncomputable</span> <span class="kd">example</span> <span class="o">:</span> <span class="n">fintype</span> <span class="o">(</span><span class="n">F</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span> <span class="n">alg_hom.fintype</span> <span class="n">K</span> <span class="n">F</span> <span class="n">E</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">field.alg_hom.fintype</span> <span class="n">K</span> <span class="n">F</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">alg_hom.fintype</span> <span class="n">K</span> <span class="n">F</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">--fails</span>
</code></pre></div>
<p>Note that both <code>field.alg_hom.fintype</code> and <code>alg_hom.fintype</code> are instances, so this can causes problems (and indeed it did for me, I had to manually disable one instance).</p>
<p>What should we do?</p>



<a name="261766532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261766532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261766532">(Nov 17 2021 at 10:30)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/field.alg_hom.fintype">docs#field.alg_hom.fintype</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/alg_hom.fintype">docs#alg_hom.fintype</a> for the lazy (like me)</p>



<a name="261767086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767086">(Nov 17 2021 at 10:36)</a>:</h4>
<p>Does one instance imply the other?</p>



<a name="261767125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767125">(Nov 17 2021 at 10:37)</a>:</h4>
<p>Hmm, both seem reasonable enough, one is not a specialization of the other, and I don't really have the idea that one would be more useful than the other. So my suggestion would be to just add a note to the docstring saying "use <code>local attribute [-instance]</code> if you get conflicts with the other"</p>



<a name="261767160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767160">(Nov 17 2021 at 10:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Another.20diamond/near/261767086">said</a>:</p>
<blockquote>
<p>Does one instance imply the other?</p>
</blockquote>
<p>No, one uses assumptions on the extension <code>F/E</code> and the other assumptions on <code>K/E</code>.</p>



<a name="261767171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767171">(Nov 17 2021 at 10:37)</a>:</h4>
<p>Where does the diamond actually cause you trouble <span class="user-mention" data-user-id="130384">@Riccardo Brasca</span>?</p>



<a name="261767230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767230">(Nov 17 2021 at 10:38)</a>:</h4>
<p>One way to solve this type of thing is to change lemmas to take dumber <code>[fintype _]</code> arguments</p>



<a name="261767239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767239">(Nov 17 2021 at 10:38)</a>:</h4>
<p>Evil answer: make <code>fintype</code> a <code>Prop</code> so there can be no defeq diamonds</p>



<a name="261767292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767292">(Nov 17 2021 at 10:39)</a>:</h4>
<p><a href="https://github.com/leanprover-community/flt-regular/blob/9edcdd4682c0ab2df4eec72e7097039beec41dd0/src/ready_for_mathlib/discriminant/cyclotomic.lean#L48">This</a> line doesn't work without</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kn">attribute</span> <span class="o">[</span><span class="bp">-</span><span class="kd">instance</span><span class="o">]</span> <span class="n">alg_hom.fintype</span>
</code></pre></div>



<a name="261767442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767442">(Nov 17 2021 at 10:41)</a>:</h4>
<p>The problem is <code>rw [this]</code>, so maybe stating <code>this</code> differently it's enough.</p>



<a name="261767858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261767858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261767858">(Nov 17 2021 at 10:45)</a>:</h4>
<p>Let me check the code...</p>



<a name="261768434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261768434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261768434">(Nov 17 2021 at 10:51)</a>:</h4>
<p>Another solution is to add <code>letI : fintype (K →ₐ[ℚ] E) := ...</code> before you create <code>this</code>, and replace <code>...</code> with the instance you actually want</p>



<a name="261768443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261768443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261768443">(Nov 17 2021 at 10:52)</a>:</h4>
<p>Lean will use that one before doing a full search</p>



<a name="261769884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261769884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261769884">(Nov 17 2021 at 11:06)</a>:</h4>
<p>Wait hang on, why does Lean think <code>finite_dimensional ℚ (algebraic_closure ℚ)</code> is true anyway?</p>



<a name="261769967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261769967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261769967">(Nov 17 2021 at 11:07)</a>:</h4>
<p>Pretty sure <code>algebraic_closure ℚ</code> is not generated by a single element, right?</p>



<a name="261770023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261770023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261770023">(Nov 17 2021 at 11:07)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="n">is_cyclotomic_extension.finite_dimensional</span>
<span class="c1">-- is_cyclotomic_extension.finite_dimensional : ∀ (K L : Type*) [field K] [field L] [algebra K L], finite_dimensional K L</span>
</code></pre></div>
<p><span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="261770544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261770544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261770544">(Nov 17 2021 at 11:13)</a>:</h4>
<p><code>pp.implicit</code>?</p>



<a name="261770704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261770704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261770704">(Nov 17 2021 at 11:15)</a>:</h4>
<p>Indeed, <code>pp.implicit</code> shows the term with <code>alg_hom.fintype</code> uses <code>is_cyclotomic_extension.finite_dimensional</code>, a lemma which is in fact, not true.</p>



<a name="261770786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261770786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261770786">(Nov 17 2021 at 11:16)</a>:</h4>
<p>Oh, I assumed that <code>is_cyclotomic_extension.finite_dimensional</code> was true but was stated about some weird algebra/ring instance. Clearly there's a danger to sorrying lemmas!</p>



<a name="261770855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261770855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261770855">(Nov 17 2021 at 11:17)</a>:</h4>
<p>Fixing that instance to be actually true should fix this specific issue, but the generic one remains.</p>



<a name="261771635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261771635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261771635">(Nov 17 2021 at 11:27)</a>:</h4>
<p>Another approach in this specific case is to replace the <code>have</code> line with <code>calc</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">norm_zeta'_sub_one</span> <span class="o">[</span><span class="n">hp</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span><span class="bp">.</span><span class="n">prime</span><span class="o">]</span> <span class="o">(</span><span class="n">hodd</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">≠</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">norm</span> <span class="n">ℚ</span> <span class="o">((</span><span class="n">zeta'</span> <span class="n">p</span> <span class="n">ℚ</span> <span class="n">K</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">p</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">E</span> <span class="o">:=</span> <span class="n">algebraic_closure</span> <span class="n">ℚ</span><span class="o">,</span>
  <span class="n">letI</span> <span class="o">:=</span> <span class="n">char_zero_of_injective_algebra_map</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">ℚ</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">injective</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hpE</span> <span class="o">:</span> <span class="o">((</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">p.pos.ne</span> <span class="o">(</span><span class="n">cast_eq_zero.1</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
  <span class="n">obtain</span> <span class="o">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">hz</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">is_alg_closed.exists_root</span> <span class="n">_</span> <span class="o">(</span><span class="n">degree_cyclotomic_pos</span> <span class="n">p</span> <span class="n">E</span> <span class="n">p.pos</span><span class="o">)</span><span class="bp">.</span><span class="n">ne.symm</span><span class="o">,</span>

  <span class="n">apply</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">ℚ</span> <span class="n">E</span><span class="o">)</span><span class="bp">.</span><span class="n">injective</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">norm_eq_prod_embeddings</span><span class="o">,</span>
  <span class="n">conv_lhs</span> <span class="o">{</span> <span class="n">congr</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">funext</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">neg_sub</span><span class="o">,</span> <span class="n">alg_hom.map_neg</span><span class="o">,</span> <span class="n">alg_hom.map_sub</span><span class="o">,</span> <span class="n">alg_hom.map_one</span><span class="o">,</span> <span class="n">neg_eq_neg_one_mul</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">replace</span> <span class="n">hodd</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">2</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">hn</span><span class="o">,</span> <span class="kd">by</span> <span class="n">exact</span> <span class="n">hodd.symm</span> <span class="o">(</span><span class="n">pnat.coe_inj.1</span> <span class="n">hn.symm</span><span class="o">),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">prod_mul_distrib</span><span class="o">,</span> <span class="n">prod_const</span><span class="o">,</span> <span class="n">card_univ</span><span class="o">,</span> <span class="n">alg_hom.card</span><span class="o">,</span> <span class="n">finrank</span> <span class="n">p</span><span class="o">,</span>
    <span class="n">totient_prime</span> <span class="n">hp.out</span><span class="o">,</span> <span class="n">neg_one_pow_of_even</span> <span class="o">(</span><span class="n">even_of_prime_neq_two_sub_one</span> <span class="n">hp.out</span> <span class="n">hodd</span><span class="o">),</span> <span class="n">one_mul</span><span class="o">],</span>
  <span class="k">calc</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">eval</span> <span class="mi">1</span> <span class="o">(</span><span class="n">cyclotomic'</span> <span class="n">p</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">_</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">_</span> <span class="o">:</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">cyclotomic'</span><span class="o">,</span> <span class="n">eval_prod</span><span class="o">,</span> <span class="bp">←</span> <span class="bp">@</span><span class="n">finset.prod_attach</span> <span class="n">E</span> <span class="n">E</span><span class="o">,</span> <span class="bp">←</span> <span class="n">univ_eq_attach</span><span class="o">],</span>
    <span class="c1">-- The following line would still fail if we write `_` instead of the `(id _)` (or with no `@` at all).</span>
    <span class="c1">-- `(id _)` is a trick to disable instance search.</span>
    <span class="n">refine</span> <span class="bp">@</span><span class="n">fintype.prod_equiv</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">id</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="n">id</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">exact</span> <span class="n">zeta'.embeddings_equiv_primitive_roots</span> <span class="n">p</span> <span class="n">ℚ</span> <span class="n">K</span> <span class="n">E</span> <span class="o">},</span>
    <span class="n">intro</span> <span class="n">σ</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">eval_sub</span><span class="o">,</span> <span class="n">eval_X</span><span class="o">,</span> <span class="n">eval_C</span><span class="o">,</span> <span class="n">zeta'.embeddings_equiv_primitive_roots_apply</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">cyclotomic'</span><span class="o">,</span> <span class="bp">←</span> <span class="n">cyclotomic_eq_prod_X_sub_primitive_roots</span>
    <span class="o">((</span><span class="n">is_root_cyclotomic_iff</span> <span class="n">hpE</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="n">hz</span><span class="o">),</span> <span class="n">eval_one_cyclotomic_prime</span><span class="o">],</span>
  <span class="n">simp</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="261771952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261771952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261771952">(Nov 17 2021 at 11:30)</a>:</h4>
<p>Ops, I thought <code>is_cyclotomic_extension.finite_dimensional</code> automatically included <code>[fintype S]</code>, thank's!</p>



<a name="261772045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261772045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261772045">(Nov 17 2021 at 11:31)</a>:</h4>
<p>But I don't understand why Lean thinks  that<code>ℚ (algebraic_closure ℚ)</code> is a cyclotomic extension.</p>



<a name="261772321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261772321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261772321">(Nov 17 2021 at 11:34)</a>:</h4>
<p>Look carefully, <code>is_cyclotomic_extension.finite_dimensional</code> doesn't include any <code>is_cyclotomic_extension</code> assumptions!</p>



<a name="261772401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261772401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261772401">(Nov 17 2021 at 11:35)</a>:</h4>
<p><span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="261772497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261772497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261772497">(Nov 17 2021 at 11:36)</a>:</h4>
<p>So in <code>cyclotomic/basic.lean</code> you probably want to replace the start of <code>section fintype</code> with:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">S</span><span class="o">]</span> <span class="o">[</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">is_cyclotomic_extension</span> <span class="n">S</span> <span class="n">K</span> <span class="n">L</span><span class="o">]</span>
<span class="kn">include</span> <span class="n">h₁</span> <span class="n">h₂</span>
</code></pre></div>



<a name="261779417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261779417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261779417">(Nov 17 2021 at 12:51)</a>:</h4>
<p>I really like the idea of making <code>fintype</code> a Prop BTW, or, more precisely, making a Proppy <code>fintype</code> like we have <code>set.finite</code> (a Proppy <code>finset</code>).</p>



<a name="261782144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261782144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261782144">(Nov 17 2021 at 13:17)</a>:</h4>
<p>I think this is a very good idea!</p>



<a name="261782349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261782349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261782349">(Nov 17 2021 at 13:19)</a>:</h4>
<p>I suspect if we had such a <code>finite</code> typeclass, then <a href="https://leanprover-community.github.io/mathlib_docs/find/set.finite/src">src#set.finite</a> could probably be defined in terms of it</p>



<a name="261782457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261782457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261782457">(Nov 17 2021 at 13:20)</a>:</h4>
<p>That is, replace:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">set.finite</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="n">intro</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">set.finite</span>
</code></pre></div>
<p>with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">finite</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="n">intro</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">finite</span>

<span class="kd">def</span> <span class="n">set.finite</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">finite</span> <span class="n">s</span>
</code></pre></div>



<a name="261850681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261850681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261850681">(Nov 17 2021 at 21:18)</a>:</h4>
<p>One thing to note: <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#fin_cases">tactic#fin_cases</a> works if it can find a <code>fintype</code> instance, but would not be able to do anything with <code>finite</code>.</p>



<a name="261851365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Another%20diamond/near/261851365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Another.20diamond.html#261851365">(Nov 17 2021 at 21:23)</a>:</h4>
<p>How does that work? It seems like the <code>fintype</code> instance is at the wrong "level"</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>