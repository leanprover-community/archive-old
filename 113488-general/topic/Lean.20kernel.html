---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Lean.20kernel.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html">Lean kernel</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202983412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202983412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Albert ten Napel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202983412">(Jul 06 2020 at 12:45)</a>:</h4>
<p>Hi everyone, where can I read up on the exact details of the Lean kernel?</p>



<a name="202983974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202983974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202983974">(Jul 06 2020 at 12:51)</a>:</h4>
<p>Mario's master thesis is a good read. After that: the source code.</p>



<a name="202984013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202984013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202984013">(Jul 06 2020 at 12:51)</a>:</h4>
<p><a href="https://github.com/digama0/lean-type-theory/tags">https://github.com/digama0/lean-type-theory/tags</a></p>



<a name="202984088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202984088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202984088">(Jul 06 2020 at 12:52)</a>:</h4>
<p>Note that Mario's thesis is really about the type theory, not about nitty gritty implementation details. Not sure what you're after.</p>



<a name="202984216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202984216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Albert ten Napel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202984216">(Jul 06 2020 at 12:53)</a>:</h4>
<p>Thanks! This thesis is exactly what I was looking for :)</p>



<a name="202989396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202989396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Carl Friedrich Bolz-Tereick <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202989396">(Jul 06 2020 at 13:38)</a>:</h4>
<p>Out of curiosity, <em>is</em> there something about the nitty gritty implementation details?</p>



<a name="202991356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202991356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202991356">(Jul 06 2020 at 13:44)</a>:</h4>
<p>If you look at the code, there are comments and references to papers that different parts are based on but that's pretty much it</p>



<a name="202991610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202991610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Carl Friedrich Bolz-Tereick <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202991610">(Jul 06 2020 at 13:46)</a>:</h4>
<p>Thanks</p>



<a name="202991651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202991651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Carl Friedrich Bolz-Tereick <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202991651">(Jul 06 2020 at 13:46)</a>:</h4>
<p>I suppose I should just start reading the C++ code</p>



<a name="202991870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202991870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202991870">(Jul 06 2020 at 13:48)</a>:</h4>
<p>Are you looking for any particular information?</p>



<a name="202991972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202991972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Carl Friedrich Bolz-Tereick <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202991972">(Jul 06 2020 at 13:49)</a>:</h4>
<p>No, mostly curious (I've worked on various more traditional VMs)</p>



<a name="202993018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/202993018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#202993018">(Jul 06 2020 at 13:58)</a>:</h4>
<p>But the kernel and the VM are not the same things</p>



<a name="203094401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/203094401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#203094401">(Jul 07 2020 at 12:16)</a>:</h4>
<p><span class="user-mention" data-user-id="306293">@Carl Friedrich Bolz-Tereick</span> <br>
There are also implementations of the kernel in Haskell, Scala, and Rust in the form of reference type checkers if you're more familiar with any of those. The Scala one is the most concise, but AFAIK the Rust one is the only one that's been updated to match the kernel changes from Lean 3 to Lean 4. I'm almost done with a specification of the kernel that was written in Lean just for the sake of convenience; I'll post it in the program verification channel probably at the end of the week. IIRC the only thing that isn't in the Rust one yet from Lean 4 is the new reduction procedure for mutual inductives.</p>



<a name="203094633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/203094633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#203094633">(Jul 07 2020 at 12:20)</a>:</h4>
<p>If this is useful information for people interested in what the Lean kernel actually does then I don't understand why you want to post it to an obscure stream instead of here.</p>



<a name="203094907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/203094907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#203094907">(Jul 07 2020 at 12:23)</a>:</h4>
<p>I didn't know that nanoda already supports the mutual inductives.  (Are there other relevant changes?  At some point there was talk about number literals in the kernel.)  Is there an export tool for Lean 4?</p>



<a name="203094959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/203094959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#203094959">(Jul 07 2020 at 12:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>  I dunno man it just seemed to fit. I'll put it in general if that's more agreeable.</p>



<a name="203095399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/203095399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#203095399">(Jul 07 2020 at 12:29)</a>:</h4>
<p>There's no export tool yet no, but the changes are backwards compatible with a couple of small adjustments like keeping the distinction between dependent/non-dependent recursors and adding the new reduction procedure for recursors and quotients. The C++ one has support for number literals and I think now string literals last time I checked, there are two new declaration types (Theorem and Opaque), a couple of other changes. I can put a summary of the changes in a gist or something if you'd like.</p>



<a name="233923454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233923454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gun Pinyo <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233923454">(Apr 10 2021 at 04:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="228466">Chris B</span> <a href="#narrow/stream/113488-general/topic/Lean.20kernel/near/203094401">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="306293">Carl Friedrich Bolz-Tereick</span> <br>
There are also implementations of the kernel in Haskell, Scala, and Rust in the form of reference type checkers if you're more familiar with any of those. The Scala one is the most concise, but AFAIK the Rust one is the only one that's been updated to match the kernel changes from Lean 3 to Lean 4. I'm almost done with a specification of the kernel that was written in Lean just for the sake of convenience; I'll post it in the program verification channel probably at the end of the week. IIRC the only thing that isn't in the Rust one yet from Lean 4 is the new reduction procedure for mutual inductives.</p>
</blockquote>
<p><span class="user-mention" data-user-id="228466">@Chris B</span> Could you give me some reference to the source code of the rust implementation of Lean 4?</p>
<p>Sorry for digging the old post. But I start to curious about the kernel of Lean 4, in particular, using Rust instead of C++ to implement the kernel. I try not to duplicate any topic by searching old topics then found out that you said there is indeed a Rust version of Lean4.</p>



<a name="233929883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233929883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233929883">(Apr 10 2021 at 06:06)</a>:</h4>
<p><span class="user-mention" data-user-id="144193">@Gun Pinyo</span> <a href="https://github.com/ammkrn/nanoda_lib">https://github.com/ammkrn/nanoda_lib</a></p>



<a name="233930022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233930022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233930022">(Apr 10 2021 at 06:08)</a>:</h4>
<p>I don't know that you could call it a "Rust version of lean 4" so much as an external typechecker for lean 4 kernel terms, similar to the external typecheckers trepplein, tc, and leanchecker for lean 3. These programs don't read lean source files, they read the "export format" which consists of pre-digested proof terms</p>



<a name="233941252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233941252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233941252">(Apr 10 2021 at 09:24)</a>:</h4>
<p><span class="user-mention" data-user-id="144193">@Gun Pinyo</span>  <br>
It's sort of in limbo right now since I'd like it to be able to work with Lean 3 export files and Lean 4 is still rapidly evolving. </p>
<p>The changes from 3 to 4 that I can think of off the top of my head are as follows; the items that have been realized in the one Mario linked are starred:</p>
<ul>
<li>
<p>support for mutual inductives<br>
support for nested inductive reduction</p>
</li>
<li>
<p>support for mutual definitions</p>
</li>
<li>removal of reduction rules</li>
<li>direct inductive reduction</li>
<li>direct quotient reduction</li>
<li>theorem/opaque declaration types</li>
<li>abbrev/opaque transparency levels<br>
Proj exprs<br>
convert local to fvar (I may or may not end up doing this one)</li>
</ul>
<p>There's also the native bool/nat/string reduction which I is a more nuanced issue but isn't breaking with respect to basic functionality. The Rust one that uses arenas isn't the most pleasant to read, but feel free to reach out if you have any questions. The spec I mentioned in that post exists in the <code>trace</code> branch, but it models the Rust executable with inductive relations so isn't much better to read. For what it's worth I am very serious about doing a Lean in Lean executable as soon as well-founded recursion lands in Lean 4. If the experts in the community help refine it I think we'll end up with a really nice learning resource.</p>



<a name="233955871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233955871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233955871">(Apr 10 2021 at 13:37)</a>:</h4>
<p>As far as the Lean in Lean executable, I'm curious how realistic it would be to write a verified Lean kernel checker in Lean.  And by verified, I guess I mean there is a theorem which says that this Lean kernel checker is sound and complete for Lean's logic.  (Although, I guess it depends how we encode "Lean's logic" here.  If we just encode it as the implementation of our kernel checker, then the proof is trivial. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span>)  (Of course for an added bonus, one could prove that Lean's logic, as we encode it, is consistent so that our checker never accepts a proof of false.  For this I assume one would need to assume a certain number of inaccessible cardinals or some such construct to get around Gödel's 2nd incompleteness theorem.)</p>



<a name="233955996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233955996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233955996">(Apr 10 2021 at 13:39)</a>:</h4>
<p>Oh, if we want to prove something about the implementation it must be implemented with total functions which probably means at least for definitional equality that we need some proof of normalization (or whatever the correct term is).  I wonder how hard that is to prove (and if it requires a proof that Lean is consistent or not).</p>



<a name="233957806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%20kernel/near/233957806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Lean.20kernel.html#233957806">(Apr 10 2021 at 14:07)</a>:</h4>
<p>I probably should have clarified (and I'm not suggesting you read this in what I wrote, only that your comment made me think of it) that the idea would just be to have an interesting thing people can play around with rather than trying to do any verification or demonstrate any particular result.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>