---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html">where does the @[simp] on add_comm come from?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="176357776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176357776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176357776">(Sep 23 2019 at 10:55)</a>:</h4>
<p>Can anyone find where <code>add_comm</code> acquires <code>simp</code>?</p>



<a name="176358088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176358088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176358088">(Sep 23 2019 at 11:01)</a>:</h4>
<p>I do find</p>
<div class="codehilite"><pre><span></span>git grep <span class="s2">&quot;attri.*simp.*add_comm&quot;</span>
src/set_theory/lists.lean:local attribute <span class="o">[</span>-simp<span class="o">]</span> add_comm add_assoc
</pre></div>



<a name="176358108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176358108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176358108">(Sep 23 2019 at 11:01)</a>:</h4>
<p>Maybe it's in core?</p>



<a name="176358111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176358111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176358111">(Sep 23 2019 at 11:01)</a>:</h4>
<p><code>mul_comm</code> is locally <code>simp</code> when the <code>run_cmd transport_multiplicative_to_additive</code> defining <code>add_comm</code> is defined, so I guess that's where it gets the attribute.</p>



<a name="176358130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176358130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176358130">(Sep 23 2019 at 11:01)</a>:</h4>
<p>in <code>init.algebra.group</code></p>



<a name="176358198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176358198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176358198">(Sep 23 2019 at 11:02)</a>:</h4>
<p>Maybe that line from <code>set_theory.lists</code> should move to <code>logic.basic</code> and become global?</p>



<a name="176362826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176362826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176362826">(Sep 23 2019 at 12:20)</a>:</h4>
<p>I quite like having it as a simp lemma.</p>



<a name="176362910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176362910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176362910">(Sep 23 2019 at 12:22)</a>:</h4>
<p>It frustrates me to no end. I get everything all lined up so <code>simp</code> will work, but then <code>simp</code> uses <code>add_comm</code> and arbitrarily jumbles up terms.</p>



<a name="176362958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176362958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176362958">(Sep 23 2019 at 12:22)</a>:</h4>
<p>I think you can't globally remove an attribute anyway.</p>



<a name="176365218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176365218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176365218">(Sep 23 2019 at 12:54)</a>:</h4>
<p>To me it sounds like automatic invocations of <code>add_comm</code> should be done by <code>ring</code>, <code>abel</code>Â and similar tactics.</p>



<a name="176377075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176377075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176377075">(Sep 23 2019 at 15:06)</a>:</h4>
<p>I think <code>add_comm</code> is the declaration that I most often have to remove from a simp set (<code>simp [-add_comm]</code>). I would also have preferred it to not have <code>simp</code> by default.</p>



<a name="176377377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176377377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176377377">(Sep 23 2019 at 15:09)</a>:</h4>
<p>We should remove it from core. I don't know where the attribute is added. I'm wondering if it's through meta programming</p>



<a name="176377976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176377976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176377976">(Sep 23 2019 at 15:15)</a>:</h4>
<p>Chris proposed a diagnosis several posts upstairs</p>



<a name="176379098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176379098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176379098">(Sep 23 2019 at 15:26)</a>:</h4>
<p>A theory: I think it's in <code>group.lean</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">mul_comm</span> <span class="n">mul_assoc</span> <span class="n">mul_left_comm</span>
<span class="c1">-- ... later</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">transport_with_dict</span> <span class="o">(</span><span class="n">dict</span> <span class="o">:</span> <span class="n">name_map</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">src</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">tgt</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">command</span> <span class="o">:=</span>
<span class="n">copy_decl_using</span> <span class="n">dict</span> <span class="n">src</span> <span class="n">tgt</span>
<span class="bp">&gt;&gt;</span> <span class="n">copy_attribute</span> <span class="bp">`</span><span class="kn">reducible</span> <span class="n">src</span> <span class="n">tt</span> <span class="n">tgt</span>
<span class="bp">&gt;&gt;</span> <span class="n">copy_attribute</span> <span class="bp">`</span><span class="n">simp</span> <span class="n">src</span> <span class="n">tt</span> <span class="n">tgt</span>
<span class="bp">&gt;&gt;</span> <span class="n">copy_attribute</span> <span class="bp">`</span><span class="kn">instance</span> <span class="n">src</span> <span class="n">tt</span> <span class="n">tgt</span>
</pre></div>


<p>The <code>local</code> on <code>local attribute</code> means that the attribute is only present inside the section right? But maybe this localness gets clobbered when it does the <code>copy_attribute</code>.</p>



<a name="176379106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176379106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176379106">(Sep 23 2019 at 15:26)</a>:</h4>
<p>I have <code>simp [-sub_eq_add_neg]</code> much more often than <code>simp [-add_comm]</code></p>



<a name="176379266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176379266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176379266">(Sep 23 2019 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="121918">@Edward Ayers</span>  Isn't that what Chris also said?</p>



<a name="176379315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176379315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176379315">(Sep 23 2019 at 15:29)</a>:</h4>
<p>yep</p>



<a name="176379522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176379522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176379522">(Sep 23 2019 at 15:31)</a>:</h4>
<p>But mul_comm isn't a simp lemma I think. So this is a bug in <code>transport_with_dict</code>?</p>



<a name="176380470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176380470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176380470">(Sep 23 2019 at 15:40)</a>:</h4>
<p>I'm wondering if setting that <code>tt</code> flag on <code>copy_attribute</code> will cause it to be local</p>



<a name="176381182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176381182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176381182">(Sep 23 2019 at 15:48)</a>:</h4>
<p>Ok so <code>copy_attribute `simp src ff tgt</code> will set it as a local attribute. But I can't see a tactic that tells you whether an attribute is local or not so I think the best fix is to just unset the attribute in the <code>group.lean</code> file.</p>



<a name="176381857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176381857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176381857">(Sep 23 2019 at 15:56)</a>:</h4>
<blockquote>
<p>I think you can't globally remove an attribute anyway.</p>
</blockquote>
<p>Aw damn.</p>



<a name="176383481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176383481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176383481">(Sep 23 2019 at 16:13)</a>:</h4>
<p>You can actually remove <code>mul_comm</code> as a local simp attr and the<code>group.lean</code> file still checks, so that might be the best way to fix it.</p>



<a name="176414536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176414536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176414536">(Sep 23 2019 at 22:15)</a>:</h4>
<p>PRed a change to remove add_comm and add_left_comm from simp lemmas. <a href="https://github.com/leanprover-community/lean/pull/65" target="_blank" title="https://github.com/leanprover-community/lean/pull/65">https://github.com/leanprover-community/lean/pull/65</a></p>



<a name="176419746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176419746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176419746">(Sep 23 2019 at 23:46)</a>:</h4>
<p>I suspect this might be a change that makes it hard to keep mathlib in sync with both 3.4.2 and 3.5c?</p>



<a name="176420165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176420165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176420165">(Sep 23 2019 at 23:55)</a>:</h4>
<p>Yeah, I think so</p>



<a name="176891069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/where%20does%20the%20%40%5Bsimp%5D%20on%20add_comm%20come%20from%3F/near/176891069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/where.20does.20the.20.40.5Bsimp.5D.20on.20add_comm.20come.20from.3F.html#176891069">(Sep 29 2019 at 22:39)</a>:</h4>
<p><code>ne.def</code> is another simp lemma that i frequently remove from my simp only set</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>