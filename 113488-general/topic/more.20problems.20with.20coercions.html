---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/more.20problems.20with.20coercions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html">more problems with coercions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="130958740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958740">(Aug 06 2018 at 05:14)</a>:</h4>
<p>So... I've been trying to implement <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>'s suggestion that I define the coercion allowing <code>F X</code> for a functor <code>F</code> on an object <code>X</code>, and define a @[simp] lemma unfolding the coercion.</p>



<a name="130958750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958750">(Aug 06 2018 at 05:15)</a>:</h4>
<p>I immediately run into trouble, however, where <code>simp</code> fails to apply the simp lemma, because a <code>motive is not correct</code>:</p>



<a name="130958756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958756">(Aug 06 2018 at 05:15)</a>:</h4>
<p>Here's my slightly minimised example:</p>



<a name="130958758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958758">(Aug 06 2018 at 05:15)</a>:</h4>
<div class="codehilite"><pre><span></span>namespace category_theory

universes u v

meta def obviously := `[skip]

class category (Obj : Type u) : Type (max u (v+1)) :=
(Hom     : Obj ‚Üí Obj ‚Üí Type v)
(id      : Œ† X : Obj, Hom X X)
(comp    : Œ† {X Y Z : Obj}, Hom X Y ‚Üí Hom Y Z ‚Üí Hom X Z)
(id_comp : ‚àÄ {X Y : Obj} (f : Hom X Y), comp (id X) f = f . obviously)
(comp_id : ‚àÄ {X Y : Obj} (f : Hom X Y), comp f (id Y) = f . obviously)
(assoc   : ‚àÄ {W X Y Z : Obj} (f : Hom W X) (g : Hom X Y) (h : Hom Y Z), comp (comp f g) h = comp f (comp g h) . obviously)

notation `ùüô` := category.id -- type as \b1
infixr ` ‚â´ `:80 := category.comp -- type as \gg
infixr ` ‚ü∂ `:10 := category.Hom -- type as \h

attribute [simp] category.id_comp category.comp_id category.assoc

universes u‚ÇÅ v‚ÇÅ u‚ÇÇ v‚ÇÇ u‚ÇÉ v‚ÇÉ

structure Functor (C : Type u‚ÇÅ) [category.{u‚ÇÅ v‚ÇÅ} C] (D : Type u‚ÇÇ) [category.{u‚ÇÇ v‚ÇÇ} D] : Type (max u‚ÇÅ v‚ÇÅ u‚ÇÇ v‚ÇÇ) :=
(obj           : C ‚Üí D)
(map           : Œ† {X Y : C}, (X ‚ü∂ Y) ‚Üí ((obj X) ‚ü∂ (obj Y)))
(map_id        : ‚àÄ (X : C), map (ùüô X) = ùüô (obj X) . obviously)
(functoriality : ‚àÄ {X Y Z : C} (f : X ‚ü∂ Y) (g : Y ‚ü∂ Z), map (f ‚â´ g) = (map f) ‚â´ (map g) . obviously)

attribute [simp] Functor.map_id Functor.functoriality

infixr ` ‚Üù `:70 := Functor       -- type as \lea -- unfortunately ‚áí (`\functor`) is taken by core.

namespace Functor

section
variables {C : Type u‚ÇÅ} [ùíû : category.{u‚ÇÅ v‚ÇÅ} C] {D : Type u‚ÇÇ} [ùíü : category.{u‚ÇÇ v‚ÇÇ} D]
include ùíû ùíü

instance : has_coe_to_fun (C ‚Üù D) :=
{ F   := Œª F, C ‚Üí D,
  coe := Œª F, F.obj }

@[simp] lemma unfold_obj_coercion (F : C ‚Üù D) (X : C) : F X = F.obj X := by refl
end

section
variables {C : Type u‚ÇÅ} [ùíû : category.{u‚ÇÅ v‚ÇÅ} C] {D : Type u‚ÇÇ} [ùíü : category.{u‚ÇÇ v‚ÇÇ} D] {E : Type u‚ÇÉ} [‚Ñ∞ : category.{u‚ÇÉ v‚ÇÉ} E]
include ùíû ùíü ‚Ñ∞

set_option trace.check true

definition comp (F : C ‚Üù D) (G : D ‚Üù E) : C ‚Üù E :=
{ obj    := Œª X, G (F X),
  map    := Œª _ _ f, G.map (F.map f),
  map_id := begin
             intros,
             simp, /- why didn&#39;t that unfold the coercion? -/
             rw unfold_obj_coercion F X /- oh. -/
            end,
  functoriality := begin intros, simp end }
end

end Functor

end category_theory
</pre></div>



<a name="130958801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958801">(Aug 06 2018 at 05:16)</a>:</h4>
<p>(Being told my motive is not correct always makes me feel very guilty.)</p>



<a name="130958803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958803">(Aug 06 2018 at 05:16)</a>:</h4>
<p>Hopefully I'm just doing something dumb here...</p>



<a name="130958904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958904">(Aug 06 2018 at 05:20)</a>:</h4>
<hr>



<a name="130958979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958979">(Aug 06 2018 at 05:23)</a>:</h4>
<p>You have to use <code>dsimp</code></p>



<a name="130958983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958983">(Aug 06 2018 at 05:23)</a>:</h4>
<p>is there a reason you use <code>by refl</code> instead of <code>rfl</code> to prove rfl-lemmas?</p>



<a name="130958989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130958989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130958989">(Aug 06 2018 at 05:24)</a>:</h4>
<p>this messes up dsimp</p>



<a name="130959028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959028">(Aug 06 2018 at 05:24)</a>:</h4>
<p>ah..</p>



<a name="130959029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959029">(Aug 06 2018 at 05:24)</a>:</h4>
<p>I never knew that.</p>



<a name="130959043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959043">(Aug 06 2018 at 05:25)</a>:</h4>
<p>Okay. That should fix my problems, but wow, gross! :-)</p>



<a name="130959047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959047">(Aug 06 2018 at 05:25)</a>:</h4>
<p>You should always prove definitional theorems by <code>rfl</code></p>



<a name="130959096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959096">(Aug 06 2018 at 05:26)</a>:</h4>
<p>because lean reads that specially: <code>A = B := rfl</code> means <code>A === B</code></p>



<a name="130959098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959098" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959098">(Aug 06 2018 at 05:26)</a>:</h4>
<p>what does <code>by refl</code> do?</p>



<a name="130959100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959100">(Aug 06 2018 at 05:26)</a>:</h4>
<p>It proves the theorem normally, so you just end up learning <code>A = B</code></p>



<a name="130959101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959101">(Aug 06 2018 at 05:26)</a>:</h4>
<p>surely that's the same thing</p>



<a name="130959109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959109">(Aug 06 2018 at 05:27)</a>:</h4>
<p>but isn't the proof term the same either way?</p>



<a name="130959111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959111">(Aug 06 2018 at 05:27)</a>:</h4>
<p>I guess I can check.</p>



<a name="130959112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959112">(Aug 06 2018 at 05:27)</a>:</h4>
<p>it is, but the literal token <code>rfl</code> is used by the lean parser to add the <code>@[_refl_lemma]</code> attribute</p>



<a name="130959361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959361">(Aug 06 2018 at 05:34)</a>:</h4>
<p>It really is a pity that <code>refl</code> and <code>rfl</code> have such important but subtle distinctions, while only differing by one letter.</p>



<a name="130959364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130959364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130959364">(Aug 06 2018 at 05:34)</a>:</h4>
<p>And then <code>rfl</code> (without <code>e</code>) adds <code>@[_refl_lemma]</code> (with <code>e</code>)!</p>



<a name="130960266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130960266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130960266">(Aug 06 2018 at 06:05)</a>:</h4>
<p>to be fair, one is a tactic and one is a term, so they differ by more than one letter</p>



<a name="130960280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130960280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130960280">(Aug 06 2018 at 06:05)</a>:</h4>
<p>although you shouldn't confuse <code>rfl</code> with <code>eq.refl</code> either</p>



<a name="130960327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130960327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130960327">(Aug 06 2018 at 06:06)</a>:</h4>
<p>similarly there is <code>iff.rfl</code> and <code>iff.refl</code>, etc. The naming convention has <code>rfl</code> have an implicit argument and <code>refl</code> has an explicit arg</p>



<a name="130961287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/more%20problems%20with%20coercions/near/130961287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/more.20problems.20with.20coercions.html#130961287">(Aug 06 2018 at 06:31)</a>:</h4>
<p>Thanks for explaining this <code>rfl</code> vs <code>refl</code> thing. Switching to <code>rfl</code> really helps, both here and elsewhere. :-)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>