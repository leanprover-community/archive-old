---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html">VScode color formatting messed up by ]"]</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="238446231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446231">(May 12 2021 at 09:32)</a>:</h4>
<p>Line 120 of <code>group_theory/subgroup.lean</code>is <code>@[to_additive "See Note [custom simps projection]"]</code> and the parser doesn't like that. It picks up the inner <code>]</code> as closing the outer <code>[</code> and then proceeds to color everything red until line 262, which is funnily enough another tag with weird mixup of quotes and square brackets: <code>@[to_additive "Sum of a list of elements in an </code>add_subgroup<code> is in the </code>add_subgroup<code>."]</code>.<br>
Anyway we can solve this (minor) issue?</p>



<a name="238446460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446460">(May 12 2021 at 09:34)</a>:</h4>
<p>Ugh, even Zulip pukes on this one.</p>



<a name="238446480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446480">(May 12 2021 at 09:34)</a>:</h4>
<p>Here's the vscode syntax definition: <a href="https://github.com/leanprover/vscode-lean/blob/master/syntaxes/lean.json">https://github.com/leanprover/vscode-lean/blob/master/syntaxes/lean.json</a></p>



<a name="238446554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446554">(May 12 2021 at 09:35)</a>:</h4>
<p>I've written this style of syntax highlighter before (for other tmLanguage derivatives), so should be able to take a look; can anyone recommend a workflow for iterating on it in vscode?</p>



<a name="238446709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446709">(May 12 2021 at 09:37)</a>:</h4>
<p>Oh thanks! because my biggest experience with regexp is parsing the list of Caius rooms to prepare for the ballot.</p>



<a name="238446830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446830">(May 12 2021 at 09:38)</a>:</h4>
<p>I suspect it's the match on l.22 that should be made less greedy: <code>{ "match": "@\\[[^\\]]*\\]", "name": "storage.modifier.lean" },</code></p>



<a name="238446902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446902">(May 12 2021 at 09:38)</a>:</h4>
<p>It ought to be recursing into the grammar I think</p>



<a name="238446912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446912">(May 12 2021 at 09:38)</a>:</h4>
<p>This also fails: <code>/-"test" -/</code></p>



<a name="238446979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238446979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238446979">(May 12 2021 at 09:39)</a>:</h4>
<p>Yeah, and isn't it already, at least partially?</p>



<a name="238447021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238447021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238447021">(May 12 2021 at 09:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>, what is <code>comment.block.string.lean</code> for? You added it in <a href="https://github.com/leanprover/vscode-lean/commit/48ad01824958992fdc05f039435480a0e111cb4e">https://github.com/leanprover/vscode-lean/commit/48ad01824958992fdc05f039435480a0e111cb4e</a></p>



<a name="238447136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238447136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238447136">(May 12 2021 at 09:40)</a>:</h4>
<p>I think it should be recursive, but apply the outermost color format.</p>



<a name="238447160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238447160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238447160">(May 12 2021 at 09:41)</a>:</h4>
<p>Huh, didn't know this existed: <a href="https://github.com/leanprover-community/lean/pull/352">https://github.com/leanprover-community/lean/pull/352</a></p>



<a name="238447180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238447180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238447180">(May 12 2021 at 09:41)</a>:</h4>
<p>This is an alternative way to write string literals:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="c">/-</span><span class="cm">"</span>
<span class="cm">Hello, world!</span>
<span class="cm">"-/</span>
</code></pre></div>



<a name="238447460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238447460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238447460">(May 12 2021 at 09:44)</a>:</h4>
<p>Does that also mean it's a choice that some keywords are put in blue and other aren't?</p>



<a name="238447498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238447498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238447498">(May 12 2021 at 09:44)</a>:</h4>
<p>Tactic names, to be more precise.</p>



<a name="238448607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238448607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238448607">(May 12 2021 at 09:55)</a>:</h4>
<p>Ok, I have a fix</p>



<a name="238449080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238449080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238449080">(May 12 2021 at 10:00)</a>:</h4>
<p><a href="https://github.com/leanprover/vscode-lean/pull/265">https://github.com/leanprover/vscode-lean/pull/265</a></p>



<a name="238450338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238450338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238450338">(May 12 2021 at 10:11)</a>:</h4>
<p>I love it how you can just report something on Zulip and someone will fix it in the minute.</p>



<a name="238453528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238453528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238453528">(May 12 2021 at 10:44)</a>:</h4>
<p>I was actually looking at this yesterday and thought that the only way was "manually" creating a couple of extra levels (as properly nested brackets isn't a regular language). Does VSCode let you have more flexibility in this?</p>



<a name="238454164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238454164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238454164">(May 12 2021 at 10:51)</a>:</h4>
<p>Have a look at the PR</p>



<a name="238454197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238454197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238454197">(May 12 2021 at 10:51)</a>:</h4>
<p>the tmLanguage highlighting system allows <code>{"#include": "a previous bit of grammar"}</code></p>



<a name="238454245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238454245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238454245">(May 12 2021 at 10:52)</a>:</h4>
<p>So in this case, I just told it to parse expressions within the <code>[]</code></p>



<a name="238454266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238454266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238454266">(May 12 2021 at 10:52)</a>:</h4>
<p>If it's in the middle of parsing a string it won't parse the closing <code>]</code>, which is what we want</p>



<a name="238454316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238454316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238454316">(May 12 2021 at 10:53)</a>:</h4>
<p>I made a small follow-up PR at <a href="https://github.com/leanprover/vscode-lean/pull/266">https://github.com/leanprover/vscode-lean/pull/266</a>, since I didn't quite finish the job the first time, and vscode crashed before I could beat <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> to the merge!</p>



<a name="238525154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238525154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238525154">(May 12 2021 at 18:49)</a>:</h4>
<p>Here is an issue I noticed that might be related, and can potentially be closed now <a href="https://github.com/leanprover/vscode-lean/issues/260">https://github.com/leanprover/vscode-lean/issues/260</a></p>



<a name="238542400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238542400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238542400">(May 12 2021 at 20:51)</a>:</h4>
<p>Would you mind trying to reproduce it and producing a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>?</p>



<a name="238542969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238542969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238542969">(May 12 2021 at 20:55)</a>:</h4>
<p>if I type exactly what's on the video, <code>`nat</code> isn't that colour anymore regardless:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">open</span> <span class="n">expr</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">is_constant_of</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">const</span> <span class="n">a</span> <span class="n">a_1</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">∈</span> <span class="n">l</span>
<span class="bp">|</span> <span class="n">_</span>  <span class="o">:=</span> <span class="n">ff</span>

<span class="k">#eval</span> <span class="n">is_constant_of</span> <span class="o">[</span><span class="bp">`</span><span class="n">nat</span><span class="o">,</span> <span class="bp">`</span><span class="n">int</span><span class="o">]</span> <span class="n">ℕ</span>
</code></pre></div>



<a name="238543823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238543823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238543823">(May 12 2021 at 21:01)</a>:</h4>
<p>Does the syntax highlighter know about <code> `name </code>s at all?</p>



<a name="238560927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238560927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238560927">(May 12 2021 at 23:51)</a>:</h4>
<p>Did these PRs also fix the tiny highlighting issue of </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[derive [has_reflect, inhabited]</span><span class="o">]</span>
</code></pre></div>
<p>where the last <code>]</code> is not highlighted?</p>



<a name="238578528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/238578528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#238578528">(May 13 2021 at 04:07)</a>:</h4>
<p>Yes</p>



<a name="240217930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/VScode%20color%20formatting%20messed%20up%20by%20%5D%22%5D/near/240217930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/VScode.20color.20formatting.20messed.20up.20by.20.5D.22.5D.html#240217930">(May 25 2021 at 16:55)</a>:</h4>
<p>I've pushed a fix for this bug to <code>pygments</code> too, meaning it will eventually end up back on zulip: <a href="https://github.com/pygments/pygments/pull/1817">https://github.com/pygments/pygments/pull/1817</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>