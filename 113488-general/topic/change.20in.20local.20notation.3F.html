---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/change.20in.20local.20notation.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html">change in local notation?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="307197523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307197523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307197523">(Oct 31 2022 at 20:39)</a>:</h4>
<p>Sorry I am still using lean 3 but it seems that there are different versions which differ in how they treat "local notation" (Actually how can I find out which version I am using?).<br>
For my course I redefined the boolean connectives <code>band</code> and <code>bor</code>, because I don't like the braindead way they are defined in the core library. I introduced a namespace and defined:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kd">notation</span> <span class="n">x</span> <span class="bp">&amp;&amp;</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">band</span> <span class="n">x</span> <span class="n">y</span>
<span class="kn">local</span> <span class="kd">notation</span> <span class="n">x</span> <span class="bp">||</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">bor</span> <span class="n">x</span> <span class="n">y</span>
</code></pre></div>
<p>This worked but now on some installations it returns an error. :-( <br>
Is there a way to fix this?</p>



<a name="307197660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307197660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307197660">(Oct 31 2022 at 20:40)</a>:</h4>
<p><code>#eval lean.version</code> should tell you the version you are using</p>



<a name="307197730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307197730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307197730">(Oct 31 2022 at 20:41)</a>:</h4>
<p>Which error do you get?</p>



<a name="307197737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307197737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307197737">(Oct 31 2022 at 20:41)</a>:</h4>
<p>I actually stupidly used my desktop to prepare the lecture and then my laptop for life proving and got caught by this issue in class? :-(</p>



<a name="307197772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307197772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307197772">(Oct 31 2022 at 20:41)</a>:</h4>
<p>invalid notation: notation already declared. Consider using 'notation (name := ...)'</p>



<a name="307197845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307197845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307197845">(Oct 31 2022 at 20:41)</a>:</h4>
<p>Ok it doesn't work on:<br>
(3, (48, 0))</p>



<a name="307198057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307198057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307198057">(Oct 31 2022 at 20:43)</a>:</h4>
<p><a href="#narrow/stream/116290-rss/topic/Recent.20Commits.20to.20mathlib.3Amaster/near/296106859">https://leanprover.zulipchat.com/#narrow/stream/116290-rss/topic/Recent.20Commits.20to.20mathlib.3Amaster/near/296106859</a> is biting you.</p>



<a name="307198243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307198243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307198243">(Oct 31 2022 at 20:44)</a>:</h4>
<p>This is a backport from Lean 4 afaict.</p>



<a name="307199556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307199556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307199556">(Oct 31 2022 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112165">rss-bot</span> <a href="#narrow/stream/116290-rss/topic/Recent.20Commits.20to.20mathlib.3Amaster/near/296106859">said</a>:</p>
<blockquote>
<p><strong><a href="https://github.com/leanprover-community/mathlib/commit/3d7987cda72abc473c7cdbbb075170e9ac620042">chore(*): bump to lean 3.47.0</a></strong> (<a href="https://github.com/leanprover-community/mathlib/pull/16252">mathlib#16252</a>)</p>
<p>A major change is that notations now require names when they are shadowing another identical notation, even if it is a local notation. Also, because localized notations can be imported in a variety of contexts, there are some new best practices for them:</p>
<ul>
<li>localized notations should always have a <code>(name := ...)</code>. Notation names are unrelated to declaration names, but the declaration name is a reasonable base for the notation name.</li>
<li>localized notations should never use <code>_</code> in the notation, because this gets desugared to a unique metavariable index, meaning that the notation will not be recognized as a duplicate of itself if <code>open_locale</code> is used when the notation is already available. Instead, you should use the <code>hole!</code> notation, which unfolds to <code>_</code>.</li>
</ul>
<p>Another major change is that projection notation (<code>x.foo</code>) now always instantiates implicit arguments with metavariables, which is consistent with Lean 4. To simulate the older behavior, one can use either strict implicit arguments for the structure field (e.g. <code>∀ {{n}}, p n</code> instead of <code>∀ {n}, p n</code>) or, depending on specifics, writing <code>λ _, x.foo</code> to ensure the implicit argument is preserved as an argument.</p>
<p>Co-authored-by: Kyle Miller &lt;<a href="mailto:kmill31415@gmail.com">kmill31415@gmail.com</a>&gt;</p>
<p>Authored-by: <a href="https://github.com/digama0">digama0</a> <a href="https://github.com/leanprover-community/mathlib/commit/3d7987cda72abc473c7cdbbb075170e9ac620042">(commit)</a></p>
</blockquote>



<a name="307199746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307199746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307199746">(Oct 31 2022 at 20:52)</a>:</h4>
<p>How do I fix the error I get when declaring:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kd">notation</span> <span class="n">x</span> <span class="bp">&amp;&amp;</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">band</span> <span class="n">x</span> <span class="n">y</span>
<span class="kn">local</span> <span class="kd">notation</span> <span class="n">x</span> <span class="bp">||</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">bor</span> <span class="n">x</span> <span class="n">y</span>
</code></pre></div>
<p>to locally redefine &amp;&amp; and || ?</p>
<p><span class="user-mention silent" data-user-id="112165">rss-bot</span> <a href="#narrow/stream/116290-rss/topic/Recent.20Commits.20to.20mathlib.3Amaster/near/296106859">said</a>:</p>
<blockquote>
<p><strong><a href="https://github.com/leanprover-community/mathlib/commit/3d7987cda72abc473c7cdbbb075170e9ac620042">chore(*): bump to lean 3.47.0</a></strong> (<a href="https://github.com/leanprover-community/mathlib/pull/16252">mathlib#16252</a>)</p>
<p>A major change is that notations now require names when they are shadowing another identical notation, even if it is a local notation. Also, because localized notations can be imported in a variety of contexts, there are some new best practices for them:</p>
<ul>
<li>localized notations should always have a <code>(name := ...)</code>. Notation names are unrelated to declaration names, but the declaration name is a reasonable base for the notation name.</li>
<li>localized notations should never use <code>_</code> in the notation, because this gets desugared to a unique metavariable index, meaning that the notation will not be recognized as a duplicate of itself if <code>open_locale</code> is used when the notation is already available. Instead, you should use the <code>hole!</code> notation, which unfolds to <code>_</code>.</li>
</ul>
<p>Another major change is that projection notation (<code>x.foo</code>) now always instantiates implicit arguments with metavariables, which is consistent with Lean 4. To simulate the older behavior, one can use either strict implicit arguments for the structure field (e.g. <code>∀ {{n}}, p n</code> instead of <code>∀ {n}, p n</code>) or, depending on specifics, writing <code>λ _, x.foo</code> to ensure the implicit argument is preserved as an argument.</p>
<p>Co-authored-by: Kyle Miller &lt;<a href="mailto:kmill31415@gmail.com">kmill31415@gmail.com</a>&gt;</p>
<p>Authored-by: <a href="https://github.com/digama0">digama0</a> <a href="https://github.com/leanprover-community/mathlib/commit/3d7987cda72abc473c7cdbbb075170e9ac620042">(commit)</a></p>
</blockquote>



<a name="307199854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307199854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307199854">(Oct 31 2022 at 20:53)</a>:</h4>
<p>So is there a workaround?</p>



<a name="307200062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307200062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307200062">(Oct 31 2022 at 20:54)</a>:</h4>
<p>Can't you just do what the error suggests?</p>



<a name="307200107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307200107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307200107">(Oct 31 2022 at 20:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271218">Thorsten Altenkirch</span> <a href="#narrow/stream/113488-general/topic/change.20in.20local.20notation.3F/near/307197737">said</a>:</p>
<blockquote>
<p>I actually stupidly used my desktop to prepare the lecture and then my laptop for life proving and got caught by this issue in class? :-(</p>
</blockquote>
<p>To me using a different version of Lean when preparing and when lecturing seems more "braindead" than the definition of <code>band</code> and <code>bor</code> in core Lean.</p>



<a name="307204203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/change%20in%20local%20notation%3F/near/307204203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/change.20in.20local.20notation.3F.html#307204203">(Oct 31 2022 at 21:19)</a>:</h4>
<p>Like johan and the error message say, the fix is to declare a name for the notation, it can be anything you like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">local</span> <span class="kd">notation</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">foo</span><span class="o">)</span> <span class="n">x</span> <span class="bp">&amp;&amp;</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">band</span> <span class="n">x</span> <span class="n">y</span>
<span class="kn">local</span> <span class="kd">notation</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">bar</span><span class="o">)</span> <span class="n">x</span> <span class="bp">||</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">bor</span> <span class="n">x</span> <span class="n">y</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>