---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Travis.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html">Travis</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="162769598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/162769598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#162769598">(Apr 07 2019 at 19:35)</a>:</h4>
<p>Travis is complaining on my PRs <a href="https://github.com/leanprover-community/mathlib/issues/883" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/883">#883</a> and <a href="https://github.com/leanprover-community/mathlib/issues/897" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/897">#897</a>, but I am not sure this is my fault: what is failing is the shell tests "check install scripts" and "check dev scripts". Is there anything I can do about it?</p>



<a name="162770446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/162770446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#162770446">(Apr 07 2019 at 19:59)</a>:</h4>
<p>I conjecture it's something to do with pushing from your own fork instead of a branch of leanprover-community. <span class="user-mention" data-user-id="110026">@Simon Hudon</span> 's working on fixing it. I guess <a href="https://github.com/leanprover-community/mathlib/issues/883" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/883">#883</a> can probably safely be merged, and it will build once it's on master.</p>



<a name="162772006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/162772006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#162772006">(Apr 07 2019 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> can you push your branches to <code>leanprover-community/mathlib</code>? It makes it easier to test the installation scripts that way because GitHub rejects requests when you make more than a few without authentication.</p>



<a name="175361313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175361313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175361313">(Sep 10 2019 at 17:49)</a>:</h4>
<p>Travis is timing out on completely innocent pull requests, like <a href="https://github.com/leanprover-community/mathlib/issues/1423" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1423">#1423</a>. <br>
Does anyone know which commit caused this regressed behavior?</p>
<p>I saw that other Github repo's automatically got a reply with compilation performance. Maybe we can make a bot that automatically replies to a PR if the compilation time is increased by more than 5% or something?</p>



<a name="175361861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175361861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175361861">(Sep 10 2019 at 17:55)</a>:</h4>
<p>I assumed in my previous message that there was a merged commit that caused performance issues, but they all seem fine. Maybe this was a cache-related issue (I merged the PR into master, maybe that fixes it)</p>



<a name="175363359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175363359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175363359">(Sep 10 2019 at 18:11)</a>:</h4>
<p>Regardless of what caused it here, regression testing for compilation time would be a good idea.</p>



<a name="175363403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175363403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175363403">(Sep 10 2019 at 18:11)</a>:</h4>
<p>I don't know if Travis is reliable enough to do this.</p>



<a name="175363427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175363427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175363427">(Sep 10 2019 at 18:11)</a>:</h4>
<p>But maybe we could run something once a day on Scott's server?</p>



<a name="175363495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175363495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175363495">(Sep 10 2019 at 18:12)</a>:</h4>
<p>I guess that would more reliably throw the same processing power at it.</p>



<a name="175363544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175363544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175363544">(Sep 10 2019 at 18:12)</a>:</h4>
<p>Last three pushes to master built in around 107 (most recent), 100, 110 minutes. I didn't look at the changes, but I assume they were not responsible for this variance.</p>



<a name="175363759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175363759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175363759">(Sep 10 2019 at 18:14)</a>:</h4>
<p>Interestingly <a href="https://travis-ci.org/leanprover-community/mathlib/builds/583109848?utm_source=github_status&amp;utm_medium=notification" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib/builds/583109848?utm_source=github_status&amp;utm_medium=notification">this build</a> of PR <a href="https://github.com/leanprover-community/mathlib/issues/1428" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1428">#1428</a> timed out, but <code>leanpkg build</code> actually finished, it just took so much longer than usual that there wasn't enough time left to run <code>leanchecker</code>.</p>



<a name="175364067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175364067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175364067">(Sep 10 2019 at 18:17)</a>:</h4>
<p>I'm sure a dedicated machine would be more consistent, I'm not sure how much more consistent.<br>
Doesn't Scott already build everything anyways? Or did I imagine that?</p>



<a name="175364221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175364221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175364221">(Sep 10 2019 at 18:19)</a>:</h4>
<p>I think the mathlib nightlies get pushed to Scott from Travis. Would he be building for another reason?</p>



<a name="175364308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175364308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175364308">(Sep 10 2019 at 18:20)</a>:</h4>
<p>I could be wrong about that though.</p>



<a name="175380528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175380528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175380528">(Sep 10 2019 at 21:35)</a>:</h4>
<p>No, at present I'm still building nothing. That project fell through, for lack of anyone who had the time/expertise combination to script things. I <em>think</em> the idea had been to push from travis to my account on S3, and then for my computer to poll that S3 account, but the pushing-to-S3 step never happened.</p>



<a name="175380624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175380624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175380624">(Sep 10 2019 at 21:36)</a>:</h4>
<p>I would love to have the infrastructure in place so that every commit received an olean cache. I can provide the CPU time, I think.</p>



<a name="175380791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175380791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175380791">(Sep 10 2019 at 21:38)</a>:</h4>
<p>I think that's <span class="user-mention" data-user-id="110026">@Simon Hudon</span> 's territory. Checking build times once a day would be a lot simpler. Do you think your server has a consistent enough load to do this with enough precision?</p>



<a name="175381239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175381239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175381239">(Sep 10 2019 at 21:45)</a>:</h4>
<p>Probably. It has 18 physical cores. I routinely leave some single-threaded calculations running, but it's never more than 6. It's been a while since I've had anything multithreaded that I want left running. So if I limit the build to say 6 or 8 cores, and run it in the middle of my night, it shouldn't have any competition.</p>



<a name="175381306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175381306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175381306">(Sep 10 2019 at 21:46)</a>:</h4>
<p>The idea is that I would just pull a fresh copy of master, build, and have a script post the time here?</p>



<a name="175381416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175381416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175381416">(Sep 10 2019 at 21:48)</a>:</h4>
<p>Yeah, something like that. We just want to see an alert if there's an unexpected jump in compile time. Posting here would be enough.</p>



<a name="175381554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175381554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175381554">(Sep 10 2019 at 21:50)</a>:</h4>
<p>Ideally, if it noticed a spike it would try to find the responsible commit.</p>



<a name="175381574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175381574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175381574">(Sep 10 2019 at 21:50)</a>:</h4>
<p>That could use a bunch more cycles.</p>



<a name="175381962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175381962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175381962">(Sep 10 2019 at 21:52)</a>:</h4>
<p>I think our limiting factor is scripting and testing, not available cycles.</p>



<a name="175382070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175382070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175382070">(Sep 10 2019 at 21:54)</a>:</h4>
<p>I am just capable enough at writing bash scripts to do a bad job of this, so help would definitely be appreciated. It might require jumping through some hoops, but I could probably work out how to give someone ssh access.</p>



<a name="175402790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175402790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175402790">(Sep 11 2019 at 05:36)</a>:</h4>
<p>Feel free to put that code up on <code>mathlib-tools</code> and I'll see if I can contribute something</p>



<a name="175403885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175403885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175403885">(Sep 11 2019 at 06:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>, I'm helpless at this, it seems. I downloaded zulip's sample python file for posting a message from <a href="api/send-message" target="_blank" title="api/send-message">https://leanprover.zulipchat.com/api/send-message</a>, as <code>scripts/zulip.py</code>. I ran <code>pip install zulip</code>, which seemed to work. However running <code>./zulip.py</code> just says:</p>
<div class="codehilite"><pre><span></span>idaeus:scripts scott$ python zulip.py
Traceback (most recent call last):
  File &quot;zulip.py&quot;, line 1, in &lt;module&gt;
    import zulip
  File &quot;/Users/scott/projects/lean/mathlib-tools/scripts/zulip.py&quot;, line 4, in &lt;module&gt;
    client = zulip.Client(config_file=&quot;~/.zuliprc&quot;)
AttributeError: &#39;module&#39; object has no attribute &#39;Client&#39;
</pre></div>


<p>which suggests to me that python is not correctly finding the zulip library.</p>



<a name="175403888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175403888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175403888">(Sep 11 2019 at 06:05)</a>:</h4>
<p>(I've committed the sample script to <code>mathlib-tools</code>, so you can see what I'm trying to do.)</p>



<a name="175403891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175403891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175403891">(Sep 11 2019 at 06:05)</a>:</h4>
<p>I tried some variations, e.g. <code>pip3 install zulip</code>, and it reports success too. :-)</p>



<a name="175404150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175404150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175404150">(Sep 11 2019 at 06:12)</a>:</h4>
<p>(If my computer can't even work out how to run a little shell script, how on earth is it going to get a gold medal at the IMO...?!)</p>



<a name="175404253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175404253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175404253">(Sep 11 2019 at 06:15)</a>:</h4>
<p>I'm sure there are a lot of IMO gold medalists that down know what a bash script is...</p>



<a name="175408797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175408797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175408797">(Sep 11 2019 at 07:53)</a>:</h4>
<p>Cancel this request for help, I found <code>zulip-send</code>, which just works from the command line.</p>



<a name="175426403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175426403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175426403">(Sep 11 2019 at 12:36)</a>:</h4>
<p>I can also put together some shell scripts, especially if you can figure out a way to grant me access to your machine</p>



<a name="175452421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175452421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175452421">(Sep 11 2019 at 16:56)</a>:</h4>
<p>I was thinking it might be nice to run <code>lean --profile</code> with these regular builds of mathlib to get more detailed diagnostics. However, I tried running <code>lean --make --profile src/ &gt; profile.log</code> in my mathlib directory and it keeps segfaulting after a while. Has anyone tried anything like this?</p>



<a name="175452489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175452489" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175452489">(Sep 11 2019 at 16:57)</a>:</h4>
<p>I also meant to ask whether there are statistics (<code>lean --profile</code> or anything else like it) which would be good to record and don't affect compile time too much</p>



<a name="175490289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175490289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175490289">(Sep 12 2019 at 01:06)</a>:</h4>
<p>I managed to profile mathlib with <code>lean -j1 --make --profile src/ &gt; profile.log</code>. It took maybe 2 hours on my machine, so it's probably not something we could run more than once a day:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
    compilation 12.8s
    decl post-processing 2.56e+03s
    elaboration 3.87e+03s
    elaboration: tactic compilation 70.9s
    elaboration: tactic execution 2.67e+03s
    parsing 122s
    type checking 17.2s
</pre></div>


<p>I've attached the (compressed) <code>profile.log</code> if anyone else wants to have a go at extracting useful statistics from it: <a href="user_uploads/3121/PLD-jhGvJwY0mtkFerySJ6zd/profile_140a606.log.zip" target="_blank" title="user_uploads/3121/PLD-jhGvJwY0mtkFerySJ6zd/profile_140a606.log.zip">profile_140a606.log.zip</a> (3.1MB)</p>



<a name="175490477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175490477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175490477">(Sep 12 2019 at 01:11)</a>:</h4>
<p>Couldn't we run it 12*N times per day, if we have N processors?</p>



<a name="175490497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175490497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175490497">(Sep 12 2019 at 01:11)</a>:</h4>
<p>(Assuming we believe in isolation between processors which is definitely false, but hey)</p>



<a name="175490555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175490555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175490555">(Sep 12 2019 at 01:12)</a>:</h4>
<p>It also used a fairly large amount of memory too (~2 GB by the end).</p>



<a name="175496464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496464">(Sep 12 2019 at 03:46)</a>:</h4>
<p>I have 128gb on this machine, so memory shouldn't be a problem.</p>



<a name="175496472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496472">(Sep 12 2019 at 03:46)</a>:</h4>
<p>Unfortunately my computer has rebooted itself several times in the last few days, and I can't work out why.</p>



<a name="175496487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496487">(Sep 12 2019 at 03:47)</a>:</h4>
<p>A student has been running calculations in GAP that use lots of RAM, but simultaneously I started experimenting with building Lean regularly via cron, so I don't really know which is at fault.</p>



<a name="175496567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496567">(Sep 12 2019 at 03:49)</a>:</h4>
<p>I've also been having trouble getting my build script to run multithreaded.... Usually Lean uses lots of cores, but somehow when it runs in the cron job, it uses 2 cores for a few minutes, then drops to 1, and I'm completely bamboozled as to why.</p>



<a name="175496700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496700">(Sep 12 2019 at 03:52)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span>, in terms of giving you (or <span class="user-mention" data-user-id="110026">@Simon Hudon</span>) access to this computer, I think the options are:</p>
<p>1. We fill out the "campus visitor" form, which would give you an ANU id number. I then get our IT people to add that id number to our VPN configuration. To ssh in, you'd then need to connect to the relevant VPN, then ssh.<br>
2. I make a persistent outbound ssh tunnel to some other server (e.g. the one hosting my website), that forwards traffic back to port 22 here. Dodgy as anything, but that's what they invented ssh tunnelling for, I guess.<br>
It's a bit of a hassle either way.</p>



<a name="175496721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496721">(Sep 12 2019 at 03:53)</a>:</h4>
<p>1. looks simpler to me. It also looks less likely you'll get reprimanded for it.</p>



<a name="175496984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496984">(Sep 12 2019 at 04:00)</a>:</h4>
<p>Okay, I have just initiated our process to give both you and Reid university id's here. You'll receive an email with a link to a form, but feel free to fill out the barest minimum of information it will let you submit with. :-)</p>



<a name="175496997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175496997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175496997">(Sep 12 2019 at 04:01)</a>:</h4>
<p>Cool :)</p>



<a name="175497005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175497005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175497005">(Sep 12 2019 at 04:01)</a>:</h4>
<p>Sorry I'm not too verbose today. I'm exhausted</p>



<a name="175524836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175524836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175524836">(Sep 12 2019 at 12:46)</a>:</h4>
<p>Is "suburb" what you call a city?</p>



<a name="175525467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175525467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175525467">(Sep 12 2019 at 12:54)</a>:</h4>
<p>I guess. :-)</p>



<a name="175525552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175525552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175525552">(Sep 12 2019 at 12:55)</a>:</h4>
<p>By Australian standards, clearly Berkeley is part of San Francisco, and thus we have very few "cities", so apparently "suburb" is the next division down.</p>



<a name="175568606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175568606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175568606">(Sep 12 2019 at 20:34)</a>:</h4>
<blockquote>
<p>Couldn't we run it 12*N times per day, if we have N processors?<br>
(Assuming we believe in isolation between processors which is definitely false, but hey)</p>
</blockquote>
<p>I tried this once, and the conclusion was that sadly if you want to get reliable benchmark results, you need to run your program with pretty much exclusive access to the machine (and on real hardware as opposed to a cloud vCPU). Running one benchmark per physical CPU core skews the timings to the point of uselessness, probably due to contention on memory, on I/O, and whatever else is shared between CPUs. Anyway in case of mathlib, because the build times are so long, maybe random noise is not that much of an issue - unless it's possible for a single run of <code>lean --make</code> to somehow get in a failure mode which makes the entire build proceed slower than usual, but that seems unlikely.</p>



<a name="175575761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175575761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175575761">(Sep 12 2019 at 22:06)</a>:</h4>
<p>Yeah, I'm pretty disappointed by the results <a href="#narrow/stream/113538-travis/topic/build.20time.20bot" title="#narrow/stream/113538-travis/topic/build.20time.20bot">from overnight</a>. </p>
<p>113m51.476s<br>
113m18.228s<br>
114m49.561s<br>
110m48.239s<br>
105m30.344s<br>
101m58.073s</p>
<p>I would guess that's too much random variability to be useful.</p>



<a name="175576037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175576037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175576037">(Sep 12 2019 at 22:10)</a>:</h4>
<p>What conditions is that under?</p>



<a name="175576042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175576042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175576042">(Sep 12 2019 at 22:11)</a>:</h4>
<p>Travis or your own machine?</p>



<a name="175576045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175576045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175576045">(Sep 12 2019 at 22:11)</a>:</h4>
<p>1 core?</p>



<a name="175576386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175576386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175576386">(Sep 12 2019 at 22:17)</a>:</h4>
<p>This is on my own machine, running with <code>-j1</code>.</p>



<a name="175576647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175576647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175576647">(Sep 12 2019 at 22:21)</a>:</h4>
<p>I realise now that I left it running every hour, so builds were overlapping. I've slowed down cron and will see if that improves things.</p>



<a name="175576894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175576894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175576894">(Sep 12 2019 at 22:25)</a>:</h4>
<p>If no one else is already working on it I'll take a stab at writing a Python script to parse the profile output into JSON (or some other format?) later tonight.</p>



<a name="175724174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724174">(Sep 15 2019 at 00:07)</a>:</h4>
<p>Now that the builds are not overlapping, the timing is quite uniform ---</p>
<p>98m31.200s<br>
98m52.938s<br>
99m3.707s<br>
99m7.776s<br>
98m57.582s<br>
98m42.635s<br>
98m45.471s</p>



<a name="175724280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724280">(Sep 15 2019 at 00:10)</a>:</h4>
<p>However this has been running over the weekend, without anything else running on this machine. We'll have to see if it stays uniform tomorrow once I'm in the office.</p>



<a name="175724344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724344">(Sep 15 2019 at 00:12)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> if you feel like parsing the profile output into something useful that might be fun. :-)</p>



<a name="175724348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724348">(Sep 15 2019 at 00:12)</a>:</h4>
<p>My script keeps uploading the logs.</p>



<a name="175724914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724914">(Sep 15 2019 at 00:30)</a>:</h4>
<p>top 100 items:</p>
<div class="codehilite"><pre><span></span>62.4 decl post-processing of lattice.semilattice_sup_top took 62.4s
61.2 decl post-processing of subtype.comm_group took 61.2s
59.3 decl post-processing of is_subgroup.of_div took 59.3s
46.6 decl post-processing of to_monoid_hom took 46.6s
34.8 decl post-processing of image_subgroup took 34.8s
27.8 decl post-processing of list_prod_apply took 27.8s
25.7 decl post-processing of subset_closure took 25.7s
25.4 decl post-processing of closure_subset took 25.4s
24.6 elaboration of monoidal_of_has_finite_coproducts took 24.6s
23.3 decl post-processing of group took 23.3s
23.2 decl post-processing of subtype.group took 23.2s
22.4 decl post-processing of open_subgroup.has_coe took 22.4s
22.1 decl post-processing of continuous_multiset_prod took 22.1s
21.9 decl post-processing of exists_list_of_mem_closure took 21.9s
21.8 elaboration of monoidal_of_has_finite_products took 21.8s
18.9 decl post-processing of image_pointwise_mul took 18.9s
18.8 decl post-processing of image_closure took 18.8s
18.6 decl post-processing of pointwise_mul_monoid took 18.6s
18.1 decl post-processing of inv_ker_one took 18.1s
16.8 decl post-processing of subtype.monoid took 16.8s
16.7 elaboration of functoriality_is_right_adjoint took 16.7s
16.6 decl post-processing of ker_lift_mk&#39; took 16.6s
16.3 elaboration of functoriality_is_left_adjoint took 16.3s
16.1 decl post-processing of ker_lift took 16.1s
15.9 decl post-processing of map took 15.9s
15.5 decl post-processing of is_subgroup.coe_inv took 15.5s
15.5 decl post-processing of preimage_pointwise_mul_preimage_subset took 15.5s
15.4 decl post-processing of closure_subgroup took 15.4s
15.2 elaboration of prod_filter_range_p_mul_q_div_two_eq_prod_product took 15.2s
15.1 decl post-processing of mem_pointwise_one took 15.1s
14.8 elaboration of quadratic_reciprocity took 14.8s
14.6 decl post-processing of ext took 14.6s
14.4 decl post-processing of multiset_prod_apply took 14.4s
14.3 elaboration of simple_func_sequence_tendsto took 14.3s
14.2 decl post-processing of normal_in_normalizer took 14.2s
14.1 elaboration of has_sum_sigma took 14.1s
13.9 decl post-processing of continuous_on.mul took 13.9s
13.9 decl post-processing of prod took 13.9s
13.7 decl post-processing of tendsto_multiset_prod took 13.7s
13.7 elaboration of exists_preimage_norm_le took 13.7s
13.7 decl post-processing of exists_list_of_mem_closure took 13.7s
13.6 decl post-processing of lift_mk took 13.6s
13.6 decl post-processing of closure.is_submonoid took 13.6s
13.6 decl post-processing of pointwise_mul_eq_Union_mul_left took 13.6s
13.6 decl post-processing of refl took 13.6s
13.6 decl post-processing of inj_of_trivial_ker took 13.6s
13.4 elaboration of CommRing_yoneda took 13.4s
13.4 decl post-processing of normal_iff_eq_cosets took 13.4s
13.3 decl post-processing of subtype_val.is_group_hom took 13.3s
13.3 decl post-processing of finset_prod_apply took 13.3s
13.2 decl post-processing of closure_singleton took 13.2s
12.9 elaboration of cocones_iso took 12.9s
12.8 decl post-processing of pointwise_mul_semigroup took 12.8s
12.7 decl post-processing of closure took 12.7s
12.2 decl post-processing of coe.is_group_hom took 12.2s
11.9 decl post-processing of coe_inf took 11.9s
11.8 decl post-processing of mem_closure took 11.8s
11.8 decl post-processing of le_iff took 11.8s
11.7 decl post-processing of pointwise_mul_eq_Union_mul_right took 11.7s
11.5 decl post-processing of mem_closure_union_iff took 11.5s
11.4 elaboration: tactic execution took 11.4s
11.3 decl post-processing of empty_pointwise_mul took 11.3s
11.3 decl post-processing of symm took 11.3s
11.3 elaboration: tactic execution took 11.3s
11.2 decl post-processing of pointwise_mul_empty took 11.2s
11.2 decl post-processing of inhabited took 11.2s
11.1 decl post-processing of eq_trivial_iff took 11.1s
11.1 decl post-processing of continuous_subgroup took 11.1s
11.1 elaboration of map_integral took 11.1s
11.1 decl post-processing of mul_left took 11.1s
11.1 decl post-processing of pointwise_mul took 11.1s
11.1 decl post-processing of ext&#39; took 11.1s
10.9 decl post-processing of mem_norm_comm took 10.9s
10.8 decl post-processing of comm_monoid took 10.8s
10.8 decl post-processing of map_one took 10.8s
10.5 elaboration of cones_iso took 10.5s
10.2 elaboration of exists_subgroup_card_pow_prime took 10.2s
10.2 elaboration of lintegral_eq_nnreal took 10.2s
10.1 decl post-processing of inv_ker_one&#39; took 10.1s
10.1 decl post-processing of singleton.is_mul_hom took 10.1s
10.1 decl post-processing of closure_mono took 10.1s
9.91 decl post-processing of injective_ker_lift took 9.91s
9.86 decl post-processing of continuous_monoid took 9.86s
9.74 decl post-processing of prod_map_range_index took 9.74s
9.71 decl post-processing of tendsto_list_prod took 9.71s
9.58 decl post-processing of one_ker_inv&#39; took 9.58s
9.56 elaboration of unique_diff_within_at.eq took 9.56s
9.5 decl post-processing of open_subgroup took 9.5s
9.49 decl post-processing of inv_iff_ker&#39; took 9.49s
9.47 decl post-processing of inj_iff_trivial_ker took 9.47s
9.44 decl post-processing of prod_zero_index took 9.44s
9.38 decl post-processing of image_closure took 9.38s
9.38 elaboration: tactic execution took 9.38s
9.37 decl post-processing of subtype_mk.is_monoid_hom took 9.37s
9.2 elaboration: tactic execution took 9.2s
9.15 decl post-processing of lift took 9.15s
9.07 elaboration of glue_dist_triangle took 9.07s
9.06 decl post-processing of continuous_group took 9.06s
9.06 elaboration: tactic execution took 9.06s
9.03 decl post-processing of closure_subset_iff took 9.03s
</pre></div>



<a name="175724921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724921">(Sep 15 2019 at 00:31)</a>:</h4>
<p>but there is a bit fishy going on; I suspect the times there do not actually reflect the time</p>



<a name="175724927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175724927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175724927">(Sep 15 2019 at 00:31)</a>:</h4>
<p>On Lines 267140-267142 we have:</p>
<div class="codehilite"><pre><span></span>elaboration of subtype.comm_group took 670ms
type checking of subtype.comm_group took 0.786ms
compilation of subtype.comm_group took 2.67ms
</pre></div>


<p>and then suddenly on Line 271385:</p>
<div class="codehilite"><pre><span></span>decl post-processing of subtype.comm_group took 61.7s
</pre></div>



<a name="175727843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175727843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175727843">(Sep 15 2019 at 02:01)</a>:</h4>
<p>How long did everything in the lines in between take? Is the <code>decl post-processing</code> for some reason being deferred, and the report time is wall time, including all the work on other things that happened in between?</p>



<a name="175746725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175746725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175746725">(Sep 15 2019 at 12:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> I have looked into this a few weeks ago, and I'm almost certain that "type checking .. took" is incorrect - see <a href="https://github.com/leanprover-community/lean/issues/58" target="_blank" title="https://github.com/leanprover-community/lean/issues/58">#58</a>. I'm not sure about the other timings (elaboration, compilation) though.</p>



<a name="175770899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/175770899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#175770899">(Sep 15 2019 at 23:16)</a>:</h4>
<p>Here's a python script that does some minimal parsing of these log files into JSON format: <a href="https://gist.github.com/bryangingechen/005e51814e698f889a76b59da0e58852" target="_blank" title="https://gist.github.com/bryangingechen/005e51814e698f889a76b59da0e58852">https://gist.github.com/bryangingechen/005e51814e698f889a76b59da0e58852</a></p>
<p>The JSON files consist of an array of key-value pairs, which mostly correspond to individual lines of the log files (except for elaboration / tactics, which I tried to group together). As a simple example, the following lines:</p>
<div class="codehilite"><pre><span></span>parsing took 0.117ms
elaboration of integral took 63.5ms
type checking of integral took 0.289ms
compilation of measure_theory.integral took 0.00211ms
decl post-processing of integral took 0.932ms
</pre></div>


<p>become:</p>
<div class="codehilite"><pre><span></span><span class="p">[{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;pars&quot;</span><span class="p">,</span>
<span class="nt">&quot;t&quot;</span><span class="p">:</span> <span class="mf">0.117</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;elab&quot;</span><span class="p">,</span>
<span class="nt">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="nt">&quot;t&quot;</span><span class="p">:</span> <span class="mf">63.5</span><span class="p">,</span>
<span class="nt">&quot;decl&quot;</span><span class="p">:</span> <span class="s2">&quot;integral&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tc&quot;</span><span class="p">,</span>
<span class="nt">&quot;t&quot;</span><span class="p">:</span> <span class="mf">0.289</span><span class="p">,</span>
<span class="nt">&quot;decl&quot;</span><span class="p">:</span> <span class="s2">&quot;integral&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;comp&quot;</span><span class="p">,</span>
<span class="nt">&quot;t&quot;</span><span class="p">:</span> <span class="mf">0.00211</span><span class="p">,</span>
<span class="nt">&quot;decl&quot;</span><span class="p">:</span> <span class="s2">&quot;measure_theory.integral&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;decl&quot;</span><span class="p">,</span>
<span class="nt">&quot;t&quot;</span><span class="p">:</span> <span class="mf">0.932</span><span class="p">,</span>
<span class="nt">&quot;decl&quot;</span><span class="p">:</span> <span class="s2">&quot;integral&quot;</span>
<span class="p">}]</span>
</pre></div>


<p>I didn't try too hard to group things together further – if there are other things I should do please let me know.</p>
<p>The JSON files turn out to be ~35MB compared to the ~25MB of the logs. Here's one corresponding to <a href="#narrow/stream/113538-travis/topic/build.20time.20bot/near/175769199" title="#narrow/stream/113538-travis/topic/build.20time.20bot/near/175769199">this log</a> in the Travis stream. <a href="/user_uploads/3121/2_2PjNAJ8GWayo_KcbQQ4_gq/profile_81a31ca.json.zip" target="_blank" title="profile_81a31ca.json.zip">profile_81a31ca.json.zip</a> (3.1MB)</p>



<a name="178966978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178966978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178966978">(Oct 24 2019 at 15:57)</a>:</h4>
<p>Based on <a href="https://travis-ci.org/leanprover-community/mathlib/jobs/602292786?utm_medium=notification&amp;utm_source=github_status" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib/jobs/602292786?utm_medium=notification&amp;utm_source=github_status">https://travis-ci.org/leanprover-community/mathlib/jobs/602292786?utm_medium=notification&amp;utm_source=github_status</a>, I'm guessing the Travis config in <a href="https://github.com/leanprover-community/mathlib/issues/1606" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1606">#1606</a> isn't right. I wanted to reuse the olean files from the build to run a final test. That test takes ~45 seconds on my laptop and has been going for 20 min on Travis, so I'm guessing it's recompiling everything. I tried to copy the setup for archive and test, which do use the oleans -- any ideas?</p>



<a name="178968348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178968348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178968348">(Oct 24 2019 at 16:09)</a>:</h4>
<p>My guess is that this is because the master branch was updated after the travis build started. My understanding is that each build stage does a merge with master when it starts, so this can lead to later stages having to do rebuilds.</p>



<a name="178968484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178968484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178968484">(Oct 24 2019 at 16:11)</a>:</h4>
<p>What? Every build stage does a merge with master? That can't be right. It's testing the PR, not the PR's compatibility with master.</p>



<a name="178968592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178968592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178968592">(Oct 24 2019 at 16:12)</a>:</h4>
<p>Yes, this surprised me at first too. But see <a href="https://travis-ci.org/leanprover-community/mathlib/jobs/602292786#L164" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib/jobs/602292786#L164">https://travis-ci.org/leanprover-community/mathlib/jobs/602292786#L164</a> and <a href="https://docs.travis-ci.com/user/pull-requests/#my-pull-request-isnt-being-built" target="_blank" title="https://docs.travis-ci.com/user/pull-requests/#my-pull-request-isnt-being-built">https://docs.travis-ci.com/user/pull-requests/#my-pull-request-isnt-being-built</a></p>



<a name="178968596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178968596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178968596">(Oct 24 2019 at 16:12)</a>:</h4>
<p>If that's what it's doing, I'm very confused about our CI, heh.</p>



<a name="178969425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178969425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178969425">(Oct 24 2019 at 16:22)</a>:</h4>
<p>But the archive task ran the same command, and finished in a minute. I don't think <a href="https://github.com/leanprover-community/mathlib/commit/3f8a492bfa4ba2ad0ff26c3bff298e3afb05f861" target="_blank" title="https://github.com/leanprover-community/mathlib/commit/3f8a492bfa4ba2ad0ff26c3bff298e3afb05f861">https://github.com/leanprover-community/mathlib/commit/3f8a492bfa4ba2ad0ff26c3bff298e3afb05f861</a> landed in between the two.</p>



<a name="178970709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178970709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178970709">(Oct 24 2019 at 16:35)</a>:</h4>
<p>You're right that the commit happened earlier, so I'm not sure why the docs and archive stages didn't require a rebuild.</p>



<a name="178972289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178972289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178972289">(Oct 24 2019 at 16:51)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Do you know what's up here?</p>



<a name="178972476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178972476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178972476">(Oct 24 2019 at 16:53)</a>:</h4>
<p>I do see wildly different build times for the archive in the PR history, which is consistent with oleans from the first step being invalidated by a merge.</p>



<a name="178972510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178972510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178972510">(Oct 24 2019 at 16:54)</a>:</h4>
<p>If this is what's happening, it sounds both inefficient and unreliable.</p>



<a name="178972562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178972562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178972562">(Oct 24 2019 at 16:54)</a>:</h4>
<blockquote>
<p>My understanding is that each build stage does a merge with master when it starts, so this can lead to later stages having to do rebuilds.</p>
</blockquote>
<p>Where's my upside-down light bulb emoji</p>



<a name="178972728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178972728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178972728">(Oct 24 2019 at 16:56)</a>:</h4>
<p>Ah. Perhaps one relevant line is this? <a href="https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L14" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L14">https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L14</a><br>
Edit - never mind, everything in the last step is happening in <code>src</code>.</p>



<a name="178973016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973016">(Oct 24 2019 at 16:59)</a>:</h4>
<p>Sometimes, it's enough to just restart the travis build</p>



<a name="178973056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973056">(Oct 24 2019 at 16:59)</a>:</h4>
<p>we might also want to try the build of test and archive with touching all the <code>olean</code> files in <code>src</code></p>



<a name="178973170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973170">(Oct 24 2019 at 17:00)</a>:</h4>
<p>Because each stage is a whole new build, you restore the cache and clone the git repo and there the time stamps can be unreliable.</p>



<a name="178973548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973548">(Oct 24 2019 at 17:04)</a>:</h4>
<p>Okay, I restarted the build. <a href="https://github.com/leanprover-community/mathlib/issues/1565" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1565">#1565</a> should hit master while this is going, so let's see if the same issue comes up.</p>



<a name="178973602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973602">(Oct 24 2019 at 17:05)</a>:</h4>
<p>Should we just add the command to touch all oleans in src? It can't hurt.</p>



<a name="178973667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973667">(Oct 24 2019 at 17:05)</a>:</h4>
<p>It also wouldn't hurt to remove <code>--make</code> when we build the archive and tests.</p>



<a name="178973913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178973913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178973913">(Oct 24 2019 at 17:08)</a>:</h4>
<p>If each stage does a fresh merge with master, how do the first stages even work? What if a commit lands during pre-build 2? Doesn't that mean all the work has to be redone in the test stage?</p>



<a name="178975645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178975645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178975645">(Oct 24 2019 at 17:24)</a>:</h4>
<blockquote>
<p>Doesn't that mean all the work has to be redone in the test stage?</p>
</blockquote>
<p>I think so, doesn't it explain the spread in run times for the test stages?</p>



<a name="178976043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178976043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178976043">(Oct 24 2019 at 17:28)</a>:</h4>
<p>I thought the reason we had the pre-build stages was because we were hitting time limits when we built the whole thing in one stage. If we were doing that in the test stage, shouldn't we hit the same limits?</p>



<a name="178976784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178976784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178976784">(Oct 24 2019 at 17:35)</a>:</h4>
<p>I think we do sometimes, but people often restart the jobs when they fail.</p>



<a name="178978287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178978287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178978287">(Oct 24 2019 at 17:50)</a>:</h4>
<p>It feels like that should be way more common. I guess commits near the leafs of the import hierarchy would have less of an effect, maybe that limits it.</p>



<a name="178978312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178978312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178978312">(Oct 24 2019 at 17:51)</a>:</h4>
<p>My mind is blown, and not in a good way, heh.</p>



<a name="178978406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178978406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178978406">(Oct 24 2019 at 17:52)</a>:</h4>
<p>We could move the linting test to the test stage. That would create less potential duplication of work.</p>



<a name="178978578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178978578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178978578">(Oct 24 2019 at 17:54)</a>:</h4>
<p>But then maybe we should move archive and docs too? Neither is slow, unless the oleans are outdated.</p>



<a name="178979508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178979508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178979508">(Oct 24 2019 at 18:03)</a>:</h4>
<p>What do you mean by move docs and archive?</p>



<a name="178979883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178979883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178979883">(Oct 24 2019 at 18:07)</a>:</h4>
<p>The docs and archive stages of the Travis build. If we build those directories as part of the test stage, instead of as separate stages, there's no chance that updates to master will invalidate the oleans.</p>



<a name="178979925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178979925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178979925">(Oct 24 2019 at 18:07)</a>:</h4>
<p>Updates to master has no effect on the build. That's not what the issues are</p>



<a name="178979997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178979997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178979997">(Oct 24 2019 at 18:08)</a>:</h4>
<p>The state of the cache and the timestamps on the files is where you should look for the issues.</p>



<a name="178980180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178980180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178980180">(Oct 24 2019 at 18:10)</a>:</h4>
<p>This does sound more plausible, though I'm having trouble constructing a mechanism under which recompilation sometimes happens, but usually not.<br>
Could it have to do with the cache being shared between concurrent builds?</p>



<a name="178980290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178980290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178980290">(Oct 24 2019 at 18:11)</a>:</h4>
<blockquote>
<p>Updates to master has no effect on the build. </p>
</blockquote>
<p>Are you sure about this? I thought <a href="https://travis-ci.org/leanprover-community/mathlib/jobs/602292783#L164" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib/jobs/602292783#L164">this line</a> would mean that a merge happens at the start of each stage, but maybe my git / github understanding is wrong.</p>



<a name="178980436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178980436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178980436">(Oct 24 2019 at 18:12)</a>:</h4>
<p>Which line do you mean?</p>



<a name="178980485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178980485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178980485">(Oct 24 2019 at 18:13)</a>:</h4>
<p><code>$ git fetch origin +refs/pull/1606/merge:</code></p>



<a name="178980527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178980527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178980527">(Oct 24 2019 at 18:13)</a>:</h4>
<p>line 164, it should be highlighted</p>



<a name="178980588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178980588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178980588">(Oct 24 2019 at 18:14)</a>:</h4>
<p>In particular I thought the suffix <code>/merge</code> retrieves a merge commit from the PR branch to master.</p>



<a name="178981120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981120">(Oct 24 2019 at 18:19)</a>:</h4>
<p>I can't find any official documentation about the <code>/merge</code> ref, but I did find <a href="https://discourse.drone.io/t/github-claims-that-merge-refs-are-undocumented-feature/1100" target="_blank" title="https://discourse.drone.io/t/github-claims-that-merge-refs-are-undocumented-feature/1100">this forum post</a> in which someone quotes Github support as saying:</p>
<blockquote>
<p>The /merge refs that are being used here are an undocumented feature and you shouldn’t be relying on them. That feature was build to power Pull Requests in the Web UI, it was not built to be used by 3rd party services. Because it’s undocumented – you should not have any expectations about behavior, the behavior might change at any time and those refs might completely go away without warning.</p>
</blockquote>



<a name="178981196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981196">(Oct 24 2019 at 18:20)</a>:</h4>
<p>After some testing on my own fork... maybe the <code>+refs/pull/*/merge</code> branches are fixed to merge with whatever master was at the time of the last commit on the PR branch?</p>



<a name="178981220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981220">(Oct 24 2019 at 18:20)</a>:</h4>
<p>It makes a merge with something, but it doesn't seem to be current master, yeah.</p>



<a name="178981430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981430">(Oct 24 2019 at 18:22)</a>:</h4>
<p>I tried with <a href="https://github.com/leanprover-community/mathlib/issues/1540" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1540">#1540</a> and it gave me a merge with the commit containing <a href="https://github.com/leanprover-community/mathlib/issues/1584" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1584">#1584</a>. I don't see how these are related yet.</p>



<a name="178981562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981562">(Oct 24 2019 at 18:22)</a>:</h4>
<p>If I'm reading the forum post correctly, it seems that the <code>/merge</code> ref gets updated only when needed by the web UI? Disturbing.</p>
<blockquote>
<p>Instead, the mergeability is triggered when it’s needed: when a user visits the page for the pull request via the UI or requests the pull request via the API. In order to determine the mergeability of a pull request, GitHub actually performs a merge between the head and the base ref, and the result of that merge is stored in the /merge ref (the ref you’re using).</p>
</blockquote>



<a name="178981574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981574">(Oct 24 2019 at 18:23)</a>:</h4>
<p>git tells me the latter commit is also <code>sgouezel/master</code> but I'm assuming that's not relevant :)</p>



<a name="178981661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981661">(Oct 24 2019 at 18:23)</a>:</h4>
<p>Oh hey, it gave me a merge with current master this time.</p>



<a name="178981746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981746">(Oct 24 2019 at 18:24)</a>:</h4>
<p>Possibly because you or I clicked on the PR page for <a href="https://github.com/leanprover-community/mathlib/issues/1540" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1540">#1540</a> and that triggered an update?</p>



<a name="178981789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981789">(Oct 24 2019 at 18:24)</a>:</h4>
<p>Presumably</p>



<a name="178981813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981813">(Oct 24 2019 at 18:25)</a>:</h4>
<p>And it seems plausible that the last time anyone looked at that page was 2 days ago</p>



<a name="178981831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981831">(Oct 24 2019 at 18:25)</a>:</h4>
<p>So, that's pretty terrible</p>



<a name="178981845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981845">(Oct 24 2019 at 18:25)</a>:</h4>
<p>So basically, Travis is choosing at random what to build every time.</p>



<a name="178981883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981883">(Oct 24 2019 at 18:25)</a>:</h4>
<p>Is this <code>/merge</code> stuff built in to Travis or something we configured?</p>



<a name="178981890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981890">(Oct 24 2019 at 18:25)</a>:</h4>
<p>Including on the final builds for Mergify.</p>



<a name="178981997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178981997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178981997">(Oct 24 2019 at 18:26)</a>:</h4>
<p>mergify doesn't build the same commit it will push? I thought that was part of the point</p>



<a name="178982105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982105">(Oct 24 2019 at 18:27)</a>:</h4>
<p>I think it's built into travis. Maybe we will have to look into other CI services?</p>



<a name="178982113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982113">(Oct 24 2019 at 18:27)</a>:</h4>
<p>It's not in the .travis.yml  file. Maybe it's configured somewhere I don't have access to?</p>



<a name="178982229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982229">(Oct 24 2019 at 18:28)</a>:</h4>
<p>^ <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> (?)</p>



<a name="178982302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982302">(Oct 24 2019 at 18:29)</a>:</h4>
<p>Hmm, actually, I'm not sure about Mergify. It merges the PR into master and lets Travis build that. Travis is... maybe... checking the merge of that with something else? Does Mergify's merge commit force the <code>/merge</code> branch to update?</p>



<a name="178982457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982457">(Oct 24 2019 at 18:30)</a>:</h4>
<p>I'd hope that adding a commit to the PR would update <code>/merge</code> to merge with the current master.</p>



<a name="178982482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982482">(Oct 24 2019 at 18:30)</a>:</h4>
<p>Hopefully the commit mergify builds will be a descendant of current master anyways, right? Otherwise what would happen when it tries to push?</p>



<a name="178982500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982500">(Oct 24 2019 at 18:31)</a>:</h4>
<p>So the merge from <code>/merge</code> ought to be a no-op</p>



<a name="178982530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982530">(Oct 24 2019 at 18:31)</a>:</h4>
<p>Mergify doesn't build the squashed commit.</p>



<a name="178982560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982560">(Oct 24 2019 at 18:31)</a>:</h4>
<p>We could test it. Start the build with <code>git rev-parse HEAD</code></p>



<a name="178982664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982664">(Oct 24 2019 at 18:32)</a>:</h4>
<blockquote>
<p>Mergify doesn't build the squashed commit.</p>
</blockquote>
<p>I'm going to go cry in the corner</p>



<a name="178982940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982940">(Oct 24 2019 at 18:34)</a>:</h4>
<p>The file state in the commit that Mergify pushes is exactly the same as the PR branch that Mergify checks. But the git history is different.</p>



<a name="178982983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178982983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178982983">(Oct 24 2019 at 18:34)</a>:</h4>
<p>And now I don't trust that Travis is actually checking what's in the PR branch.</p>



<a name="178983055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178983055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178983055">(Oct 24 2019 at 18:35)</a>:</h4>
<p>Travis runs again once a commit is added to master. THAT one should be checked correctly.</p>



<a name="178983904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178983904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178983904">(Oct 24 2019 at 18:43)</a>:</h4>
<p>Sounds like it's time to look at alternatives</p>



<a name="178985517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178985517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178985517">(Oct 24 2019 at 19:00)</a>:</h4>
<p>I can potentially look into setting up a Jenkins server. As far as I can see, Jenkins is capable of distributing builds to different servers, so we could share the load if others also have some resources</p>



<a name="178989530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178989530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178989530">(Oct 24 2019 at 19:43)</a>:</h4>
<p>I guess the problem with moving away from Travis is that this also creates Mergify headaches</p>



<a name="178989923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178989923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178989923">(Oct 24 2019 at 19:47)</a>:</h4>
<p>So it reached the lint stage a little while ago and started recompiling again. There's no way anything could have changed between the archive and lint stages. The archive took a minute, no commits to master, etc.</p>



<a name="178990014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178990014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178990014">(Oct 24 2019 at 19:48)</a>:</h4>
<p>I added a line to touch the olean files before the lint stage. Not sure if it will help, but maybe.</p>



<a name="178990139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178990139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178990139">(Oct 24 2019 at 19:50)</a>:</h4>
<p>If our hypothesis is true and it is getting unpredictable info from the <code>/merge</code> branch: my impression is this is bizarre, and inefficient, but not fatal.</p>



<a name="178990293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178990293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178990293">(Oct 24 2019 at 19:51)</a>:</h4>
<p>There's no real connection between Mergify and Travis, any CI with proper GitHub support should work with Mergify.</p>



<a name="178990395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178990395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178990395">(Oct 24 2019 at 19:52)</a>:</h4>
<p>Yeah... but I don't know how hard it is to get Github support working for self-hosted CI's</p>



<a name="178990665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178990665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178990665">(Oct 24 2019 at 19:55)</a>:</h4>
<p>The costs of the Travis craziness are slower and occasionally broken PR builds, and <em>maybe</em> it's possible a broken PR could make it to master. The costs of switching to a CI with bad GitHub support are higher, I think.</p>



<a name="178990876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178990876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178990876">(Oct 24 2019 at 19:57)</a>:</h4>
<p>Git lab has a nice CI infrastructure and it supports github. If Travis is too much of a pain, it can be worth investigating. And the maximum timeout is 3 hours which goes most of the way to building mathlib completely</p>



<a name="178991040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178991040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Daly <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178991040">(Oct 24 2019 at 19:59)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Did you mean running a github server on a local machine? It is a pretty straightforward effort.</p>



<a name="178991520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178991520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178991520">(Oct 24 2019 at 20:04)</a>:</h4>
<p>A Jenkins server</p>



<a name="178991563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178991563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178991563">(Oct 24 2019 at 20:04)</a>:</h4>
<p>And it should integrate with the github repo</p>



<a name="178991605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178991605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178991605">(Oct 24 2019 at 20:04)</a>:</h4>
<p>You can't run github locally can you? I thought it was closed source. Or did they open source it?</p>



<a name="178991828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178991828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178991828">(Oct 24 2019 at 20:06)</a>:</h4>
<p>I think you can buy a license. Even if it were free, it would definitely not be worth it for us.</p>



<a name="178991980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178991980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178991980">(Oct 24 2019 at 20:08)</a>:</h4>
<p>There's also "github actions", which should definitely integrate well with github, although it's still in "limited public" beta. <a href="https://help.github.com/en/github/automating-your-workflow-with-github-actions/about-github-actions" target="_blank" title="https://help.github.com/en/github/automating-your-workflow-with-github-actions/about-github-actions">https://help.github.com/en/github/automating-your-workflow-with-github-actions/about-github-actions</a></p>



<a name="178992170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178992170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178992170">(Oct 24 2019 at 20:10)</a>:</h4>
<p>Each build is allowed to upload some <a href="https://help.github.com/en/github/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts" target="_blank" title="https://help.github.com/en/github/automating-your-workflow-with-github-actions/persisting-workflow-data-using-artifacts">"artifacts"</a>, so we might be able to set up olean caches for each PR?</p>



<a name="178995874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178995874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178995874">(Oct 24 2019 at 20:47)</a>:</h4>
<p>Argh. I'll let it go a bit longer to be sure, but it looks like <a href="https://github.com/leanprover-community/mathlib/issues/1606" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1606">#1606</a> is still rebuilding everything. <a href="https://travis-ci.org/leanprover-community/mathlib/builds/602507227?utm_source=github_status&amp;utm_medium=notification" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib/builds/602507227?utm_source=github_status&amp;utm_medium=notification">https://travis-ci.org/leanprover-community/mathlib/builds/602507227?utm_source=github_status&amp;utm_medium=notification</a></p>



<a name="178995914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178995914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178995914">(Oct 24 2019 at 20:47)</a>:</h4>
<p>I'd expect max 5 min if all the oleans are there already.</p>



<a name="178995995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178995995" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178995995">(Oct 24 2019 at 20:48)</a>:</h4>
<p>How is the linting step relevantly different from the archive step?</p>



<a name="178996012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178996012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178996012">(Oct 24 2019 at 20:48)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/3f1125af2a425123fc2535e59714c6a991b1cf7f/.travis.yml" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/3f1125af2a425123fc2535e59714c6a991b1cf7f/.travis.yml">https://github.com/leanprover-community/mathlib/blob/3f1125af2a425123fc2535e59714c6a991b1cf7f/.travis.yml</a></p>



<a name="178999946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/178999946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Daly <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#178999946">(Oct 24 2019 at 21:31)</a>:</h4>
<p>You can run a git server. Github is just a collection of servers with a user api.</p>



<a name="179000076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179000076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Daly <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179000076">(Oct 24 2019 at 21:33)</a>:</h4>
<p>I ran a private git server on my local net when I was doing security research</p>



<a name="179000389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179000389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179000389">(Oct 24 2019 at 21:36)</a>:</h4>
<p>I would advise against jumping to that solution. Once we setup our own servers, we have to keep them running, fix the configuration, etc. There are other CI services that we can investigate before we decide to run our own</p>



<a name="179000498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179000498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179000498">(Oct 24 2019 at 21:37)</a>:</h4>
<p>There is precisely 0% chance we are going to self-host the mathlib git repo.</p>



<a name="179000656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179000656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Daly <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179000656">(Oct 24 2019 at 21:38)</a>:</h4>
<p>Github does what lean needs and seems to do it best. I'm not suggesting that you use local servers. I do, but for public work like Axiom, I use github.</p>



<a name="179000790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179000790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Daly <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179000790">(Oct 24 2019 at 21:40)</a>:</h4>
<p>For my security work I needed jenkins and git but hosted on a secure subnet. I was just responding to the question of whether it was possible to run git-like services locally.</p>



<a name="179000943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179000943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Daly <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179000943">(Oct 24 2019 at 21:42)</a>:</h4>
<p>Nobody wants the extra burden of admin work on a server. I do it, but it is annoying and I don't recommend it unless you have the skills, patience, and nothing else worth doing. :-)</p>



<a name="179001124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179001124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179001124">(Oct 24 2019 at 21:46)</a>:</h4>
<p>Thanks for clarifying. I'm especially worried about the last one. I think there are plenty of skilled and dedicated people around but there's plenty of other stuff they can look into</p>



<a name="179010578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179010578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179010578">(Oct 25 2019 at 00:08)</a>:</h4>
<p>AFAICT I don't see any magic options in travis that adjust how it builds PRs. <a href="https://docs.travis-ci.com/user/pull-requests/" target="_blank" title="https://docs.travis-ci.com/user/pull-requests/">This page</a> mentions the <code>*/merge</code> ref</p>



<a name="179010660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179010660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179010660">(Oct 25 2019 at 00:10)</a>:</h4>
<p>the only thing I can do is turn different kinds of builds on or off (they are all on), or adjust the <code>.travis.yml</code></p>



<a name="179033798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179033798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179033798">(Oct 25 2019 at 09:12)</a>:</h4>
<p>Oh my god, this is so frustrating. I got the linting test to work (i.e., Travis failed due to linting errors) by moving it to the <code>test</code> stage. Then I changed the linting test to a weaker one that should pass. Now it's running the linting test in the pre-build. It's reusing cached oleans from the previous run, which is fine and expected. But the auto-generated <code>lint_mathlib.lean</code> shouldn't show up until the <code>test</code> stage. Is it somehow retrieving the file state from the previous run?</p>



<a name="179033813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179033813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179033813">(Oct 25 2019 at 09:12)</a>:</h4>
<p><code>lint_mathlib.lean</code> isn't part of the git repo. It failed to build in the last run, so there shouldn't be an olean, and even if there were, <code>purge_olean.sh</code> should delete it.</p>



<a name="179033825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179033825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179033825">(Oct 25 2019 at 09:13)</a>:</h4>
<p>Is there a way I can see the contents of the directory Travis is working in?</p>



<a name="179033906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179033906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179033906">(Oct 25 2019 at 09:14)</a>:</h4>
<p>I still have no idea why the separate linting stage was refusing to use the cached oleans.</p>



<a name="179034375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179034375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179034375">(Oct 25 2019 at 09:21)</a>:</h4>
<p>Hmm. I guess this is the meaning of this line: <a href="https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L17" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L17">https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L17</a></p>



<a name="179034505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179034505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179034505">(Oct 25 2019 at 09:23)</a>:</h4>
<p>But shouldn't <a href="https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L38" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L38">https://github.com/leanprover-community/mathlib/blob/master/.travis.yml#L38</a> delete <code>lint_mathlib.lean</code>?</p>



<a name="179045609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179045609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179045609">(Oct 25 2019 at 12:42)</a>:</h4>
<p>Which part runs the linting step?</p>



<a name="179046508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046508">(Oct 25 2019 at 12:56)</a>:</h4>
<p>What I would suggest is that you delete <code>lint_mathlib.lean</code> after you're done using it. This way, it won't make its way into the build cache</p>



<a name="179046545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046545">(Oct 25 2019 at 12:56)</a>:</h4>
<p>Right now, <a href="https://github.com/leanprover-community/mathlib/blob/d5b4664462e70132be1e6f0ef6cfbf2669b2ef77/.travis.yml#L89" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/d5b4664462e70132be1e6f0ef6cfbf2669b2ef77/.travis.yml#L89">https://github.com/leanprover-community/mathlib/blob/d5b4664462e70132be1e6f0ef6cfbf2669b2ef77/.travis.yml#L89</a></p>



<a name="179046570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046570">(Oct 25 2019 at 12:57)</a>:</h4>
<p>I'm solving issues locally. It turns out the file name <code>data/rat/meta.lean</code> causes issues.</p>



<a name="179046588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046588">(Oct 25 2019 at 12:57)</a>:</h4>
<p>The autogenerated <code>data/rat/all.lean</code> imports <code>.meta</code> which parses wrong.</p>



<a name="179046607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046607">(Oct 25 2019 at 12:57)</a>:</h4>
<p>ah! What if you quote it?</p>



<a name="179046609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046609">(Oct 25 2019 at 12:57)</a>:</h4>
<p>I'm going to push a commit renaming that in a sec, which <em>should</em> make the current setup work.</p>



<a name="179046671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046671">(Oct 25 2019 at 12:58)</a>:</h4>
<p>But it still doesn't explain why Travis wanted to build mathlib from scratch when I had the linting step in its own stage.</p>



<a name="179046721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046721">(Oct 25 2019 at 12:59)</a>:</h4>
<p>Did using <code>touch</code> help?</p>



<a name="179046740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046740">(Oct 25 2019 at 12:59)</a>:</h4>
<p>Nope.</p>



<a name="179046994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179046994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179046994">(Oct 25 2019 at 13:02)</a>:</h4>
<p>The whole thing is muddled by the fact that Travis actually builds merges with "master." <code>data.rat.meta</code> didn't even exist on the PR branch so I couldn't figure out locally what was happening.</p>



<a name="179047157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047157">(Oct 25 2019 at 13:04)</a>:</h4>
<p>Is it okay if I merge <a href="https://github.com/leanprover-community/mathlib/issues/1612" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1612">#1612</a> directly? I built locally with these changes.</p>



<a name="179047163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047163">(Oct 25 2019 at 13:04)</a>:</h4>
<p>That seems so non-sensical to me</p>



<a name="179047171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047171">(Oct 25 2019 at 13:04)</a>:</h4>
<p>It's absolutely insane.</p>



<a name="179047180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047180">(Oct 25 2019 at 13:04)</a>:</h4>
<p>go for it</p>



<a name="179047229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047229">(Oct 25 2019 at 13:05)</a>:</h4>
<p>I'm going to look into setting up a gitlab pipeline. Maybe that can make things better</p>



<a name="179047258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047258">(Oct 25 2019 at 13:05)</a>:</h4>
<p>Oh, actually, never mind. I don't need to merge that yet, we can let the check run just to be sure.</p>



<a name="179047476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047476">(Oct 25 2019 at 13:08)</a>:</h4>
<p><a href="https://travis-ci.org/leanprover-community/mathlib/builds/602804142?utm_source=github_status&amp;utm_medium=notification" target="_blank" title="https://travis-ci.org/leanprover-community/mathlib/builds/602804142?utm_source=github_status&amp;utm_medium=notification">https://travis-ci.org/leanprover-community/mathlib/builds/602804142?utm_source=github_status&amp;utm_medium=notification</a></p>



<a name="179047481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179047481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179047481">(Oct 25 2019 at 13:08)</a>:</h4>
<p>This has to pass.</p>



<a name="179061309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179061309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179061309">(Oct 25 2019 at 15:37)</a>:</h4>
<p>Unfortunately, it will fail soon because <a href="https://github.com/leanprover-community/mathlib/issues/1612" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1612">#1612</a> missed a <code>data.rat.meta</code> in <code>test/rat.lean</code>. I've fixed it in that PR, but not in the lint one yet.</p>



<a name="179061471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179061471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179061471">(Oct 25 2019 at 15:39)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span>  Do you want me to rebase travis_lint on rename_rat_meta?</p>



<a name="179061569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179061569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179061569">(Oct 25 2019 at 15:40)</a>:</h4>
<p>Gah.</p>



<a name="179061575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179061575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179061575">(Oct 25 2019 at 15:40)</a>:</h4>
<p>I just did, but thanks.</p>



<a name="179063547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179063547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179063547">(Oct 25 2019 at 16:00)</a>:</h4>
<p>It passed. Proof of concept, we can run a lint test in Travis.</p>



<a name="179063580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179063580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179063580">(Oct 25 2019 at 16:00)</a>:</h4>
<p>Of course, the script in that PR is a mess now from all my attempts to make it work. And I'm done with this for the weekend.</p>



<a name="179079725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/179079725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#179079725">(Oct 25 2019 at 19:07)</a>:</h4>
<p>I just finished an experiment with gitlab. Have a look: <a href="https://gitlab.com/simon.hudon/mathlib/commit/5b32a70e3f0006f3f6cc93f836aac533ce89c6ed/pipelines?ref=master" target="_blank" title="https://gitlab.com/simon.hudon/mathlib/commit/5b32a70e3f0006f3f6cc93f836aac533ce89c6ed/pipelines?ref=master">https://gitlab.com/simon.hudon/mathlib/commit/5b32a70e3f0006f3f6cc93f836aac533ce89c6ed/pipelines?ref=master</a></p>



<a name="180267018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180267018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180267018">(Nov 08 2019 at 20:10)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span>  I'm trying Azure for <code>lean-depot</code>. So far, it seems so much faster than Travis or GitLab. I think we might want to consider adopting it for mathlib</p>



<a name="180305313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180305313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180305313">(Nov 09 2019 at 09:41)</a>:</h4>
<p>Sounds good to me! The free or paid version?</p>



<a name="180672357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180672357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180672357">(Nov 13 2019 at 21:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> GitHub just popped a bunch of balloons in my face about this: <a href="https://github.com/features/actions" target="_blank" title="https://github.com/features/actions">https://github.com/features/actions</a></p>



<a name="180672463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180672463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180672463">(Nov 13 2019 at 21:04)</a>:</h4>
<p>I usually don't click annoying ads like that out of principle, but it's free for open projects and (presumably) well integrated with GitHub. At a glance, it looks like it could do what we want.</p>



<a name="180672474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180672474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180672474">(Nov 13 2019 at 21:04)</a>:</h4>
<p>Maybe worth investigating too.</p>



<a name="180672806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180672806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180672806">(Nov 13 2019 at 21:07)</a>:</h4>
<p>That looks like an exciting tool. Are you thinking of a specific use?</p>



<a name="180673121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180673121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180673121">(Nov 13 2019 at 21:10)</a>:</h4>
<p>Uh, as far as I can tell can do the same thing as Travis or Azure.</p>



<a name="180673156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180673156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180673156">(Nov 13 2019 at 21:11)</a>:</h4>
<p>I couldn't find any info about how much time or speed they give you.</p>



<a name="180673279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180673279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180673279">(Nov 13 2019 at 21:12)</a>:</h4>
<p>Here's a page with some more details on limits: <a href="https://help.github.com/en/github/automating-your-workflow-with-github-actions/about-github-actions" target="_blank" title="https://help.github.com/en/github/automating-your-workflow-with-github-actions/about-github-actions">https://help.github.com/en/github/automating-your-workflow-with-github-actions/about-github-actions</a></p>



<a name="180714101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180714101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180714101">(Nov 14 2019 at 09:40)</a>:</h4>
<p>Github Actions in fact run on Azure and they are quite similar to Azure Pipelines in most other aspects, but not completely. It is quite confusing.</p>



<a name="180740464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180740464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Hudon <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180740464">(Nov 14 2019 at 15:22)</a>:</h4>
<p>Are there things that Github Actions can do but Azure can't?</p>



<a name="180740777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Travis/near/180740777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Travis.html#180740777">(Nov 14 2019 at 15:25)</a>:</h4>
<p>I don't know, I have only looked at Pipelines in detail</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>