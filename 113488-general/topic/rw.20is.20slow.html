---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/rw.20is.20slow.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html">rw is slow</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="193702673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702673">(Apr 12 2020 at 09:07)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="kn">theorem</span> <span class="n">test_rw</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_add</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<div class="codehilite"><pre><span></span>parsing took 5.08s
elaboration of test_rw took 211ms
</pre></div>



<a name="193702675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702675">(Apr 12 2020 at 09:07)</a>:</h4>
<p>I think this is the most shocking of all my test results</p>



<a name="193702713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702713">(Apr 12 2020 at 09:08)</a>:</h4>
<p>because <code>rw</code> is in core</p>



<a name="193702719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702719">(Apr 12 2020 at 09:08)</a>:</h4>
<p>just because it's in core doesn't mean it's fast</p>



<a name="193702724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702724">(Apr 12 2020 at 09:08)</a>:</h4>
<p>in fact that mostly means it hasn't been touched in a long time</p>



<a name="193702725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702725">(Apr 12 2020 at 09:08)</a>:</h4>
<div class="codehilite"><pre><span></span>parsing took 142ms
</pre></div>


<p>???</p>



<a name="193702730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702730">(Apr 12 2020 at 09:09)</a>:</h4>
<p>but actually I think you are benchmarking <code>have</code> with these examples</p>



<a name="193702733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702733">(Apr 12 2020 at 09:09)</a>:</h4>
<p>yeah, kenny's computer is weird</p>



<a name="193702734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702734">(Apr 12 2020 at 09:09)</a>:</h4>
<p>I can't believe my desktop is 40 times faster than it though</p>



<a name="193702737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702737">(Apr 12 2020 at 09:09)</a>:</h4>
<p>I get 1.17 s</p>



<a name="193702754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702754">(Apr 12 2020 at 09:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702730" title="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702730">said</a>:</p>
<blockquote>
<p>but actually I think you are benchmarking <code>have</code> with these examples</p>
</blockquote>
<p>this reminds me of the story of the man on the bike</p>



<a name="193702760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702760">(Apr 12 2020 at 09:09)</a>:</h4>
<p>Which version of Lean are you using?</p>



<a name="193702806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702806">(Apr 12 2020 at 09:10)</a>:</h4>
<p>3.7.2</p>



<a name="193702807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702807">(Apr 12 2020 at 09:10)</a>:</h4>
<p>I'm on 3.8.0</p>



<a name="193702816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702816">(Apr 12 2020 at 09:10)</a>:</h4>
<p>a man on a bike would pass through a security guard on the border every week with a big bag of sand; every time the security would check the bag very carefully, but every time the security would find nothing; 2 years after the guard retired, he met the man by chance, and finally asks him: what were you smuggling the whole time?</p>
<p>it was the bikes</p>



<a name="193702865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702865">(Apr 12 2020 at 09:12)</a>:</h4>
<p>Okay, updating to 3.8 really made parsing 5 times faster on my machine</p>



<a name="193702869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702869">(Apr 12 2020 at 09:12)</a>:</h4>
<p>control:</p>
<div class="codehilite"><pre><span></span><span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="kn">theorem</span> <span class="n">test_have</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">7</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">+</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">8</span> <span class="bp">+</span> <span class="mi">7</span> <span class="bp">*</span> <span class="mi">9</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">trivial</span>
<span class="kn">end</span>
</pre></div>


<div class="codehilite"><pre><span></span>parsing took 445ms
elaboration of test_rw took 176ms
</pre></div>



<a name="193702870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702870">(Apr 12 2020 at 09:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260921">Markus Himmel</span> <a href="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702865" title="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702865">said</a>:</p>
<blockquote>
<p>Okay, updating to 3.8 really made parsing 5 times faster on my machine</p>
</blockquote>
<p>the problem is that codewars doesn't use 3.8</p>



<a name="193702885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702885">(Apr 12 2020 at 09:13)</a>:</h4>
<p>Yep, I just updated and the test is much faster</p>



<a name="193702933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702933">(Apr 12 2020 at 09:14)</a>:</h4>
<p>codewars uses Lean 3.7.2</p>



<a name="193702936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702936">(Apr 12 2020 at 09:14)</a>:</h4>
<p>and <span class="user-mention" data-user-id="260921">@Markus Himmel</span> managed to stay below the time limit</p>



<a name="193702938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702938">(Apr 12 2020 at 09:14)</a>:</h4>
<p>in Lean 3.7.2</p>



<a name="193702939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702939">(Apr 12 2020 at 09:14)</a>:</h4>
<p>Great! Could you please use all that speed to unstuck me on <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Bolzano-Weirstrass/near/193682245" title="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Bolzano-Weirstrass/near/193682245">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Bolzano-Weirstrass/near/193682245</a>?</p>



<a name="193702948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193702948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193702948">(Apr 12 2020 at 09:15)</a>:</h4>
<p>I haven't been watching the changes carefully, <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> any idea what the culprit is?</p>



<a name="193703016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703016">(Apr 12 2020 at 09:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702939" title="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702939">said</a>:</p>
<blockquote>
<p>Great! Could you please use all that speed to unstuck me on <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Bolzano-Weirstrass/near/193682245" title="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Bolzano-Weirstrass/near/193682245">https://leanprover.zulipchat.com/#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/Bolzano-Weirstrass/near/193682245</a>?</p>
</blockquote>
<p>?? I never even saw this!</p>
<div class="codehilite"><pre><span></span>You are not subscribed to stream Is there code for X?
</pre></div>



<a name="193703029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703029">(Apr 12 2020 at 09:17)</a>:</h4>
<p>and on codewars, which is the only benchmark that matters:</p>
<div class="codehilite"><pre><span></span>/workspace/src/Solution.lean:2:8
parsing took 1.18s

/workspace/src/Solution.lean:2:8
elaboration of test_rw took 87.7ms
</pre></div>



<a name="193703036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703036">(Apr 12 2020 at 09:17)</a>:</h4>
<p>so maybe I can still use <code>rw</code> in my solution</p>



<a name="193703042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703042">(Apr 12 2020 at 09:17)</a>:</h4>
<p>Oh wow and the coolest corollary of not being subscribed to the stream is that every time I reload it it comes up in a different colour!</p>



<a name="193703316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703316">(Apr 12 2020 at 09:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702948" title="#narrow/stream/113488-general/topic/rw.20is.20slow/near/193702948">said</a>:</p>
<blockquote>
<p>any idea what the culprit is?</p>
</blockquote>
<p>What's the problem?  I thought it is faster in Lean 3.8?  (It should be even faster in Lean 3.9.)</p>



<a name="193703330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703330">(Apr 12 2020 at 09:27)</a>:</h4>
<p>what changed?</p>



<a name="193703335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703335">(Apr 12 2020 at 09:27)</a>:</h4>
<p>not a problem per se, I just don't like when things mysteriously get better</p>



<a name="193703336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703336">(Apr 12 2020 at 09:27)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/issues/180" title="https://github.com/leanprover-community/lean/issues/180">lean#180</a></p>



<a name="193703337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703337">(Apr 12 2020 at 09:28)</a>:</h4>
<p>Kenny complained, and I pushed a fix.</p>



<a name="193703378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703378">(Apr 12 2020 at 09:28)</a>:</h4>
<p>oh right</p>



<a name="193703381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703381">(Apr 12 2020 at 09:28)</a>:</h4>
<p>so this is used in the parsers for various tactics?</p>



<a name="193703391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703391">(Apr 12 2020 at 09:29)</a>:</h4>
<p>Mario did you see <a href="https://github.com/leanprover-community/lean/issues/186" title="https://github.com/leanprover-community/lean/issues/186">lean#186</a>?</p>



<a name="193703449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/193703449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#193703449">(Apr 12 2020 at 09:30)</a>:</h4>
<p>I guess this affects various things.  All tactic parsers use <code>reflect</code>, and when the <code>has_reflect</code> instance is implemented using <code>subst</code> or expression quotations, then it will be magically faster now.</p>



<a name="205312696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205312696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205312696">(Jul 29 2020 at 02:37)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="c1">-- parsing took 2.07s</span>
<span class="kn">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span> <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="205312783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205312783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205312783">(Jul 29 2020 at 02:39)</a>:</h4>
<p>control:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="c1">-- parsing took 1.24ms</span>
<span class="kn">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span> <span class="o">:=</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">H</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span> <span class="n">rfl</span>
</code></pre></div>



<a name="205312786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205312786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205312786">(Jul 29 2020 at 02:39)</a>:</h4>
<p>so a difference of 2000x</p>



<a name="205312951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205312951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205312951">(Jul 29 2020 at 02:43)</a>:</h4>
<p>faster when chained:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="c1">-- parsing took 38.9ms</span>
<span class="kn">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">],</span>
<span class="kn">end</span>
</code></pre></div>



<a name="205314514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205314514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205314514">(Jul 29 2020 at 03:16)</a>:</h4>
<p>Shouldn't the control be repeating some other tactic  a bunch?</p>



<a name="205317370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205317370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205317370">(Jul 29 2020 at 04:30)</a>:</h4>
<p>Of course <code>rw</code> is not exactly <code>.trans</code>. Maybe write a term-mode proof of</p>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="bp">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">true</span> <span class="o">:=</span>
</code></pre></div>


<p>instead</p>



<a name="205317411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205317411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205317411">(Jul 29 2020 at 04:30)</a>:</h4>
<p>What I'm mostly surprised by is the massive difference between the chained and unchained <code>rw</code>'s</p>



<a name="205324589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205324589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205324589">(Jul 29 2020 at 07:12)</a>:</h4>
<p>I've noticed this before. I tended not to chain rewrites until I realised it gave a speedup</p>



<a name="205326215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205326215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205326215">(Jul 29 2020 at 07:36)</a>:</h4>
<p>brilliant</p>



<a name="205326951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205326951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205326951">(Jul 29 2020 at 07:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> is there some hidden bug in the parsing of <code>rw</code> that makes it slow? I remember <span class="user-mention" data-user-id="260921">@Markus Himmel</span> telling me that <code>split</code> has a hidden bug</p>



<a name="205327498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205327498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205327498">(Jul 29 2020 at 07:55)</a>:</h4>
<p>As Alex says, try a control which uses lots of tactics, particularly ones without arguments like <code>skip</code></p>



<a name="205328289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205328289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205328289">(Jul 29 2020 at 08:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="c1">-- parsing took 4.33ms</span>
<span class="kn">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
  <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span> <span class="n">skip</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="205328401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205328401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205328401">(Jul 29 2020 at 08:06)</a>:</h4>
<p>It's all argument parsing. Your first test is about 520 ms for me, and with</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>
<span class="n">setup_tactic_parser</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">rw_rules</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">location</span><span class="o">)</span> <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">rewrite_cfg</span> <span class="o">:=</span> <span class="o">{})</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">skip</span>
<span class="kn">end</span> <span class="n">interactive</span>
<span class="kn">end</span> <span class="n">tactic</span>

<span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="kn">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">true</span> <span class="bp">=</span> <span class="n">true</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span> <span class="n">foo</span> <span class="n">H</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>it's about the same, while deleting the <code>cfg</code> argument drops it to 420 ms, deleting <code>l</code> drops to 300 ms, changing the <code>q</code> parser to <code>(q : parse (rw_rule_p texpr)) </code> drops to 240 ms, and <code>(q : parse texpr)</code> drops to 60 ms. As I said in another thread, parser combinators in lean are expensive because inlining sucks</p>



<a name="205330100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20is%20slow/near/205330100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/rw.20is.20slow.html#205330100">(Jul 29 2020 at 08:33)</a>:</h4>
<p>thanks</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>