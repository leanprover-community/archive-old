---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/data-driven.20unit.20tests.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html">data-driven unit tests</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322862391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862391">(Jan 22 2023 at 13:57)</a>:</h4>
<p>Hi, I'm working through the "Logical Verification" course materials from VU. I'm working on the first exercises and came upon this section: <a href="https://github.com/blanchette/logical_verification_2022/blob/main/lean/love01_definitions_and_statements_exercise_sheet.lean#L29">https://github.com/blanchette/logical_verification_2022/blob/main/lean/love01_definitions_and_statements_exercise_sheet.lean#L29</a><br>
11 <code>#check</code> statements with instructions to mouse over each and check that the value is correct. Shopping around for other examples, I found the idea of changing each of the <code>#check</code> statements to a <code>lemma</code> proven using <code>refl</code>. So I can test the first line automatically like so:<br>
<code>lemma test_sub00: sub 0 0 = 0 := rfl</code></p>



<a name="322862505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862505">(Jan 22 2023 at 13:58)</a>:</h4>
<p>Programmer that I am, I want to be able to put all of the test data into its own structure.</p>



<a name="322862666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862666">(Jan 22 2023 at 13:59)</a>:</h4>
<p>The idea behind data-driven testing is that you have one piece of testing logic that gets repeatedly applied to some list of cases. This gives you fewer points of potential bugs because you're not copy-pasting logic around.</p>



<a name="322862792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862792">(Jan 22 2023 at 14:00)</a>:</h4>
<p>I'm not sure how to proceed here, though; I moved all of the test cases into a list like so:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">test_data</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">list</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">[[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">],</span>
 <span class="o">[</span><span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">]]</span>
</code></pre></div>



<a name="322862810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862810">(Jan 22 2023 at 14:00)</a>:</h4>
<p>Note that those two are not the same. a lemma proved by <code>rfl</code> is evaluated by the kernel, while <code>#eval</code> evaluates in the interpreter/compiler. The latter is unverified but often much faster or even may succeed where the other fails</p>



<a name="322862928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862928">(Jan 22 2023 at 14:01)</a>:</h4>
<p>There isn't any particular reason to organize the tests beyond having a bunch of lemmas because lemma correctness is evaluated at compile time</p>



<a name="322862957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862957">(Jan 22 2023 at 14:01)</a>:</h4>
<p>Interesting. I guess that makes <code>#eval</code> doubly dangerous as a unit-test drop-in then, right?</p>



<a name="322862977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322862977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322862977">(Jan 22 2023 at 14:01)</a>:</h4>
<p>it depends on what you want to test</p>



<a name="322863082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863082">(Jan 22 2023 at 14:02)</a>:</h4>
<p>you can turn the eval into a test by evaluating something like <code>#eval guard (sub 0 0 = 0)</code></p>



<a name="322863202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863202">(Jan 22 2023 at 14:03)</a>:</h4>
<p>I forget the exact syntax but there are ways to set it up so that the eval line itself fails if the test is wrong, and this is still being evaluated at compile time</p>



<a name="322863215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863215">(Jan 22 2023 at 14:03)</a>:</h4>
<p>I don't see guard in the manual</p>



<a name="322863392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863392">(Jan 22 2023 at 14:04)</a>:</h4>
<p>and it's giving me <code>don't know how to synthesize placeholder
context:
⊢ Type → Type ?</code></p>



<a name="322863433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863433">(Jan 22 2023 at 14:04)</a>:</h4>
<p>for <code>#eval guard (sub 0 0 = 0)</code></p>



<a name="322863449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863449">(Jan 22 2023 at 14:04)</a>:</h4>
<p>try <code>(guard ... : tactic unit)</code></p>



<a name="322863486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863486">(Jan 22 2023 at 14:04)</a>:</h4>
<p>I don't think the manual has an exhaustive list of functions, you are more likely to find it in <a href="https://leanprover-community.github.io/mathlib_docs/find/guard">docs#guard</a></p>



<a name="322863607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863607">(Jan 22 2023 at 14:05)</a>:</h4>
<p><code>#eval (guard (sub 0 0 = 0): tactic unit)</code> works :) Thanks. So guard is like an assert statement.</p>



<a name="322863626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863626">(Jan 22 2023 at 14:06)</a>:</h4>
<p>yeah</p>



<a name="322863692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863692">(Jan 22 2023 at 14:06)</a>:</h4>
<p>Okay, so back to the list-based one...</p>



<a name="322863700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863700">(Jan 22 2023 at 14:06)</a>:</h4>
<p>this is like <code>static_assert</code> in C++, not sure what your background is</p>



<a name="322863745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863745">(Jan 22 2023 at 14:06)</a>:</h4>
<p>Cool, makes sense</p>



<a name="322863777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863777">(Jan 22 2023 at 14:06)</a>:</h4>
<p>I'm not sure what the numbers represent</p>



<a name="322863787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863787">(Jan 22 2023 at 14:06)</a>:</h4>
<p>I'm really brand new at lean</p>



<a name="322863840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863840">(Jan 22 2023 at 14:07)</a>:</h4>
<p>Right, so the idea is that I want to take the arguments and expected output for each test case and put them together ina collection</p>



<a name="322863923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322863923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322863923">(Jan 22 2023 at 14:07)</a>:</h4>
<p>I don't really like list for this, but it was the only thing I could get to compile</p>



<a name="322864057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864057">(Jan 22 2023 at 14:08)</a>:</h4>
<p>I would rather have tuples of a pre-defined length, or an object/struct with named fields</p>



<a name="322864167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864167">(Jan 22 2023 at 14:09)</a>:</h4>
<p>But the idea here is that I want to do something like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">for</span> <span class="n">case</span> <span class="k">in</span> <span class="n">test_data</span>
    <span class="n">assert</span> <span class="n">sub</span> <span class="n">case</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">case</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="bp">=</span> <span class="n">case</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
</code></pre></div>



<a name="322864358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864358">(Jan 22 2023 at 14:10)</a>:</h4>
<p>I think this would work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">test_data</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
 <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">)]</span>

<span class="k">#eval</span> <span class="k">show</span> <span class="n">tactic</span> <span class="n">unit</span><span class="o">,</span> <span class="k">from</span>
  <span class="n">test_data.mmap'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩,</span> <span class="n">guard</span> <span class="o">(</span><span class="n">sub</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span><span class="o">))</span>
</code></pre></div>



<a name="322864400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864400">(Jan 22 2023 at 14:10)</a>:</h4>
<p>untested as I don't have a lean 3 on hand</p>



<a name="322864439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864439">(Jan 22 2023 at 14:11)</a>:</h4>
<p>Ah, that's how you make tuples!</p>



<a name="322864471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864471">(Jan 22 2023 at 14:11)</a>:</h4>
<p>intuitive. Just couldn't find it by searching</p>



<a name="322864498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864498">(Jan 22 2023 at 14:11)</a>:</h4>
<p>the underlying function this is notation for is <a href="https://leanprover-community.github.io/mathlib_docs/find/prod.mk">docs#prod.mk</a></p>



<a name="322864619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864619">(Jan 22 2023 at 14:12)</a>:</h4>
<p>Cool, this works. Thank you!</p>



<a name="322864628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864628">(Jan 22 2023 at 14:12)</a>:</h4>
<p>There is one issue...</p>



<a name="322864648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864648">(Jan 22 2023 at 14:12)</a>:</h4>
<p>Not sure if it can be fixed</p>



<a name="322864678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864678">(Jan 22 2023 at 14:12)</a>:</h4>
<p>but if you change one of the test cases so that it fails</p>



<a name="322864714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864714">(Jan 22 2023 at 14:13)</a>:</h4>
<p>Lean just underlines the <code>#eval</code> and says "fail". No info on which case failed or how it failed.</p>



<a name="322864781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322864781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322864781">(Jan 22 2023 at 14:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="k">show</span> <span class="n">tactic</span> <span class="n">unit</span><span class="o">,</span> <span class="k">from</span>
  <span class="n">test_data.mmap'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩,</span>
    <span class="n">guard</span> <span class="o">(</span><span class="n">sub</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">"sub {a} {b} wasn't {c}, it was {sub a b}"</span><span class="o">)</span>
</code></pre></div>



<a name="322865608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322865608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322865608">(Jan 22 2023 at 14:21)</a>:</h4>
<p>Do I need to import <code>fail</code> from somewhere?</p>



<a name="322865992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322865992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322865992">(Jan 22 2023 at 14:23)</a>:</h4>
<p>I get <code>unknown identifier 'fail'</code></p>



<a name="322866247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866247">(Jan 22 2023 at 14:25)</a>:</h4>
<p><code>tactic.fail</code> maybe</p>



<a name="322866396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866396">(Jan 22 2023 at 14:26)</a>:</h4>
<p>or <code>open tactic</code> beforehand</p>



<a name="322866416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866416">(Jan 22 2023 at 14:26)</a>:</h4>
<p><code>tactic.fail</code> works!</p>



<a name="322866444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866444">(Jan 22 2023 at 14:26)</a>:</h4>
<p><code>guard</code> uses <code>failure</code>, which doesn't take a message argument</p>



<a name="322866472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866472">(Jan 22 2023 at 14:27)</a>:</h4>
<p>Okay so one last question</p>



<a name="322866501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866501">(Jan 22 2023 at 14:27)</a>:</h4>
<p>If I want to re-use this logic</p>



<a name="322866659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866659">(Jan 22 2023 at 14:28)</a>:</h4>
<p>can I put this in a function that takes <code>sub</code> (or other binary function) as an argument?</p>



<a name="322866761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322866761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322866761">(Jan 22 2023 at 14:29)</a>:</h4>
<p>I'm just unsure about <code>#eval</code>, because it's compile time... will I hit a wall somewhere because some things cannot be computed at compile-time, or is everything computable at compile-time?</p>



<a name="322867041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322867041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322867041">(Jan 22 2023 at 14:31)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">tactic</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">test_binop</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="n">γ</span><span class="o">}</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">γ</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">γ</span><span class="o">]</span>
  <span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span> <span class="o">(</span><span class="n">test_data</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span> <span class="bp">×</span> <span class="n">γ</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">test_data.mmap'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩,</span>
  <span class="n">guard</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">"{name} {a} {b} wasn't {c}, it was {f a b}"</span><span class="o">)</span>

<span class="k">#eval</span> <span class="n">test_binop</span> <span class="s2">"sub"</span> <span class="n">sub</span>
  <span class="o">[(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
   <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span> <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">)]</span>
</code></pre></div>
<p>still untested</p>



<a name="322867129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322867129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322867129">(Jan 22 2023 at 14:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="311255">Nathan Glenn</span> <a href="#narrow/stream/113488-general/topic/data-driven.20unit.20tests/near/322866761">said</a>:</p>
<blockquote>
<p>I'm just unsure about <code>#eval</code>, because it's compile time... will I hit a wall somewhere because some things cannot be computed at compile-time, or is everything computable at compile-time?</p>
</blockquote>
<p>No, basically everything that lean can evaluate it can also run in the interpreter</p>



<a name="322867335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322867335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322867335">(Jan 22 2023 at 14:33)</a>:</h4>
<p>There are some things that cannot be evaluated, these are marked <code>noncomputable</code>, but you can't run them at run time either. (You can use them in <code>rfl</code> proofs however, although usually that won't work either, depending on how the function is defined.)</p>



<a name="322867467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322867467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322867467">(Jan 22 2023 at 14:34)</a>:</h4>
<p>stuff like "use the axiom of choice to pick an even number" is not computable</p>



<a name="322867876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322867876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322867876">(Jan 22 2023 at 14:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/data-driven.20unit.20tests/near/322867129">said</a>:</p>
<blockquote>
<p>No, basically everything that lean can evaluate it can also run in the interpreter</p>
</blockquote>
<p>This is something you will notice that is unusual about lean compared to other programming languages - almost everything is done at compile time, and in many cases compiling a lean file already extracts all the benefit we intend to get out of the file, for example if it contains a bunch of theorems then those theorems can't be run, their only purpose is to be compiled and typechecked in order to prove the theorem</p>



<a name="322868243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322868243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322868243">(Jan 22 2023 at 14:40)</a>:</h4>
<p>taking me a moment to parse this...</p>



<a name="322868384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322868384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322868384">(Jan 22 2023 at 14:41)</a>:</h4>
<p>I get <code>invalid definition, it uses untrusted declaration 'has_to_format'</code> for the code you pasted</p>



<a name="322868850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322868850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322868850">(Jan 22 2023 at 14:45)</a>:</h4>
<p>I also tried this less general version:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">test_binary</span> <span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">data</span><span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="n">data.mmap'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩,</span>
    <span class="n">guard</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">tactic.fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">"{name} {a} {b} wasn't {c}, it was {f a b}"</span><span class="o">)</span>
</code></pre></div>
<p>And it gives me <code>invalid definition, it uses untrusted declaration 'tactic'</code></p>



<a name="322869413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322869413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322869413">(Jan 22 2023 at 14:49)</a>:</h4>
<p>use <code>meta def</code> instead of <code>def</code></p>



<a name="322869768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322869768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322869768">(Jan 22 2023 at 14:51)</a>:</h4>
<p><span aria-label="magic" class="emoji emoji-1fa84" role="img" title="magic">:magic:</span></p>



<a name="322869783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322869783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322869783">(Jan 22 2023 at 14:51)</a>:</h4>
<p>Thanks :D</p>



<a name="322870139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322870139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322870139">(Jan 22 2023 at 14:54)</a>:</h4>
<p>I've found the programming_in_lean document, so I'll give that a read-through.</p>



<a name="322899605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899605">(Jan 22 2023 at 19:38)</a>:</h4>
<p>Follow-up question regarding abstracting over attributes in Lean</p>



<a name="322899642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899642">(Jan 22 2023 at 19:38)</a>:</h4>
<p>I'm on to the homework assignment, and this time I need to test that a <code>reverse</code> function works properly.</p>



<a name="322899668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899668">(Jan 22 2023 at 19:39)</a>:</h4>
<p>Reverse is defined like so:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">reverse</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>        <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">x</span> <span class="o">::</span> <span class="n">xs</span><span class="o">)</span> <span class="o">:=</span> <span class="n">reverse</span> <span class="n">xs</span> <span class="bp">++</span> <span class="o">[</span><span class="n">x</span><span class="o">]</span>
</code></pre></div>



<a name="322899713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899713">(Jan 22 2023 at 19:39)</a>:</h4>
<p>And I've adapted your test_binop code for a unary function like so:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">def</span> <span class="n">test_unary_op</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span><span class="o">}</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">β</span><span class="o">]</span>
  <span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">test_data</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">test_data.mmap'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩,</span>
  <span class="n">guard</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="bp">&lt;|&gt;</span> <span class="n">tactic.fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">"{name} {a} wasn't {b}, it was {f a}"</span><span class="o">)</span>
</code></pre></div>



<a name="322899796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899796">(Jan 22 2023 at 19:40)</a>:</h4>
<p>Now, I can test with a list containing one type, no problem: </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="n">test_unary_op</span> <span class="s2">"reverse"</span> <span class="n">reverse</span>
  <span class="o">[(([]</span> <span class="o">:</span> <span class="n">list</span> <span class="n">ℕ</span><span class="o">),</span> <span class="o">[]),</span> <span class="o">([</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">])]</span>
</code></pre></div>



<a name="322899832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899832">(Jan 22 2023 at 19:41)</a>:</h4>
<p>But I would love to be able to try this with multiple list types at once, like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="n">test_unary_op</span> <span class="s2">"reverse"</span> <span class="n">reverse</span>
  <span class="o">[(([</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">])),</span> <span class="o">([</span><span class="s2">"h"</span><span class="o">,</span><span class="s2">"e"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"o"</span><span class="o">],[</span><span class="s2">"o"</span><span class="o">,</span> <span class="s2">"l"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"e"</span><span class="o">,</span><span class="s2">"h"</span><span class="o">])]</span>
</code></pre></div>



<a name="322899973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322899973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322899973">(Jan 22 2023 at 19:42)</a>:</h4>
<p>This code gives me "failed to synthesize type class", because it can't tell what type of list I'm giving it (the tuples have multiple types). But for the purposes of testing, all that matters to me is that each tuple has a consistent type among its elements. For the entire list, all I care about is that all each of the tuples satisfies <code>decidable_eq</code>. Is it possible to model this?</p>



<a name="322905712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322905712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322905712">(Jan 22 2023 at 20:44)</a>:</h4>
<p>You can use a list of sigma types</p>



<a name="322906388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322906388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322906388">(Jan 22 2023 at 20:52)</a>:</h4>
<p>But that turns out to be really annoying to write, especially since you have decidability constraints to encode.</p>



<a name="322906413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322906413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322906413">(Jan 22 2023 at 20:52)</a>:</h4>
<p>Why do you need this? Why not just write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="k">do</span>
    <span class="n">test_unary_op</span> <span class="s2">"reverse"</span> <span class="n">reverse</span> <span class="o">(([</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">])),</span>
    <span class="n">test_unary_op</span> <span class="s2">"reverse"</span> <span class="n">reverse</span> <span class="o">([</span><span class="s2">"h"</span><span class="o">,</span><span class="s2">"e"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"o"</span><span class="o">],[</span><span class="s2">"o"</span><span class="o">,</span> <span class="s2">"l"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"e"</span><span class="o">,</span><span class="s2">"h"</span><span class="o">])</span>
</code></pre></div>



<a name="322906684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322906684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322906684">(Jan 22 2023 at 20:56)</a>:</h4>
<p>"need" not so much, "want" is more like it. It's just the way I'm used to programming. The requirement that I can only test one type of list at a time is just awkward to me. This particular application happens to be really simple, but I'm not so sure I won't find a larger impediment to me later, so this seemed like a good time to ask how this is done. But I can wait until I get to sigma types in the tutorials.</p>



<a name="322907513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322907513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322907513">(Jan 22 2023 at 21:07)</a>:</h4>
<p>I don't think sigma types are going to help you here</p>



<a name="322907677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322907677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322907677">(Jan 22 2023 at 21:09)</a>:</h4>
<p>You're trying to generalize over a lot of things at once:</p>
<ul>
<li>Elements of the list</li>
<li>Things which aren't lists at all</li>
<li>Algorithms for printing a family of types</li>
<li>Algorithms for deciding equality of a family of types</li>
</ul>



<a name="322908056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322908056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322908056">(Jan 22 2023 at 21:13)</a>:</h4>
<p>It can certainly be done:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Note: this only works if `f` places no requirements on the family of types</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">test_unary_op</span>  <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">i</span><span class="o">],</span> <span class="n">has_to_format</span> <span class="o">(</span><span class="n">α</span> <span class="n">i</span><span class="o">)]</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">i</span><span class="o">],</span> <span class="n">has_to_format</span> <span class="o">(</span><span class="n">β</span> <span class="n">i</span><span class="o">)]</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span>  <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">i</span><span class="o">],</span> <span class="n">decidable_eq</span> <span class="o">(</span><span class="n">β</span> <span class="n">i</span><span class="o">)]</span>
  <span class="o">(</span><span class="n">name</span> <span class="o">:</span> <span class="n">string</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">α</span> <span class="n">i</span> <span class="bp">→</span> <span class="n">β</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">test_data</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="bp">Σ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">i</span><span class="o">]</span> <span class="o">[</span><span class="n">has_to_format</span> <span class="n">i</span><span class="o">],</span> <span class="n">α</span> <span class="n">i</span> <span class="bp">×</span> <span class="n">β</span> <span class="n">i</span><span class="o">))</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">test_data.mmap'</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">⟩,</span>
  <span class="o">(</span><span class="kd">by</span> <span class="n">haveI</span> <span class="o">:=</span> <span class="n">h1</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">guard</span> <span class="o">(</span><span class="n">f</span> <span class="n">_</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">))</span> <span class="bp">&lt;|&gt;</span> <span class="n">tactic.fail</span> <span class="o">(</span><span class="kd">by</span> <span class="n">haveI</span> <span class="o">:=</span> <span class="n">h2</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">format</span><span class="bp">!</span><span class="s2">"{name} {a} wasn't {b}, it was {f _ a}"</span><span class="o">))</span>

<span class="k">#eval</span> <span class="bp">@</span><span class="n">test_unary_op</span> <span class="n">list</span> <span class="n">list</span>
  <span class="c1">-- typeclass inference can't handle this type of thing automatically</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="n">h</span><span class="o">,</span> <span class="kd">by</span> <span class="n">resetI</span><span class="bp">;</span> <span class="n">apply_instance</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="n">h</span><span class="o">,</span> <span class="kd">by</span> <span class="n">resetI</span><span class="bp">;</span> <span class="n">apply_instance</span><span class="o">)</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="n">h</span><span class="o">,</span> <span class="kd">by</span> <span class="n">resetI</span><span class="bp">;</span> <span class="n">apply_instance</span><span class="o">)</span>
  <span class="s2">"reverse"</span> <span class="o">(</span><span class="bp">@</span><span class="n">list.reverse</span><span class="o">)</span>
  <span class="o">[⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">infer_instance</span><span class="o">,</span> <span class="n">infer_instance</span><span class="o">,</span> <span class="o">([</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">],</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">])⟩,</span>
   <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">infer_instance</span><span class="o">,</span> <span class="n">infer_instance</span><span class="o">,</span> <span class="o">([</span><span class="s2">"h"</span><span class="o">,</span><span class="s2">"e"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"o"</span><span class="o">],[</span><span class="s2">"o"</span><span class="o">,</span> <span class="s2">"l"</span><span class="o">,</span><span class="s2">"l"</span><span class="o">,</span><span class="s2">"e"</span><span class="o">,</span><span class="s2">"h"</span><span class="o">])⟩]</span>
</code></pre></div>



<a name="322908116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322908116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322908116">(Jan 22 2023 at 21:14)</a>:</h4>
<p>But the amount of boilerplate you have to write to fight lean make it not worth it</p>



<a name="322908124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322908124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322908124">(Jan 22 2023 at 21:14)</a>:</h4>
<p>And even the above doesn't work if you want to test <code>reverse</code> on types in different universes</p>



<a name="322908269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322908269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322908269">(Jan 22 2023 at 21:16)</a>:</h4>
<p>Probably a more reasonable option is to write a metaprogram to generate the repeative code I linked above</p>



<a name="322908761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/322908761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tyler Josephson ⚛️ <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#322908761">(Jan 22 2023 at 21:23)</a>:</h4>
<p>As an engineering professor who teaches test-driven design to my students learning Python, I thought I’d chime in.</p>
<p>In Python, you write tests alongside your code to make sure it does what you want, to facilitate continuous integration, etc. A good programmer writes good, informative tests, but you’re limited to things like “check the output of this function is correct on inputs 5, 10, and 15.” What makes Lean unique is you can write proofs alongside your code, to essentially say “prove the output of this function is correct for all natural numbers, while also restricting the function to only accept natural numbers as input.” Lean checks all proofs at compile time, and in mathlib. I believe this paradigm is stronger than the old test-driven design paradigm.</p>
<p>But, one gap in the proofs approach is, “even if I’ve defined an object and proved something about it, how can I be sure I e defined the right thing?” Our current answer to this is to use examples, see this blog post: <a href="https://leanprover-community.github.io/blog/posts/lte-examples/">https://leanprover-community.github.io/blog/posts/lte-examples/</a> </p>
<p>I don’t know if anyone has consolidated examples in a structure before with the intent on checking them along the lines of test driven development.</p>



<a name="323141619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/data-driven%20unit%20tests/near/323141619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nathan Glenn <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/data-driven.20unit.20tests.html#323141619">(Jan 24 2023 at 00:10)</a>:</h4>
<p>I'm still brand-new to this, so it's really helpful to get your perspectives here. The code above is quite beyond my comprehension right now :D The point about constructing proofs being a better option than extensive tests is a good one. Thanks for the help!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>