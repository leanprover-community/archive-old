---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/IMO.201972.20B2.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html">IMO 1972 B2</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="208061183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208061183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208061183">(Aug 26 2020 at 07:41)</a>:</h4>
<p>Hi! I'm a beginner to Lean and want to prove <a href="http://www.cs.ru.nl/~freek/demos/exercise/exercise.pdf">IMO 1972 B2</a> (which was used  to compare various formal systems at <a href="https://www.cs.ru.nl/F.Wiedijk/demos/index.html">ICMS 2006 to compare various systems</a>). I formalized the statement as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">g</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="bp">|</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>


<p>I'm a bit stuck as I'd like to have a way to calculate/operate with the supremum of <code>f</code> or I can only find <code>is_sub</code> in mathlib. What would be a good way to have <code>k : ℝ</code> such that <code>k</code> is the supremum of <code>f</code> and prove that it's in  ℝ because f is bounded? Also is <code>is_lub (f ''  ℝ) k</code> the correct way to say that k is the supremum of a real function <code>f</code>?  Thanks for your help <span aria-label="thank you" class="emoji emoji-1f64f" role="img" title="thank you">:thank_you:</span></p>



<a name="208061508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208061508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208061508">(Aug 26 2020 at 07:45)</a>:</h4>
<p><span class="user-mention" data-user-id="249373">@Stanislas Polu</span> Hi, does your code typecheck in Lean? Which imports do you use?</p>



<a name="208061530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208061530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208061530">(Aug 26 2020 at 07:45)</a>:</h4>
<p>I don't know the analysis part too well, but for me the <code>| .. |</code> didn't work after importing <code>data.real.basic</code>.</p>



<a name="208061577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208061577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208061577">(Aug 26 2020 at 07:46)</a>:</h4>
<p>I believe that we always use <code>\|| .. \||</code> for norms</p>



<a name="208061589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208061589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208061589">(Aug 26 2020 at 07:46)</a>:</h4>
<p>Ah sorry yeah, I started working at the end of the tutorials, so this might not be totally legit in mathlib; there |..| is defined. I will definitely translate to mathlib <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="208062143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208062143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208062143">(Aug 26 2020 at 07:53)</a>:</h4>
<p>Here's a start:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">pi</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">∥</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">classical</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">hk</span> <span class="o">:=</span> <span class="n">real</span><span class="bp">.</span><span class="n">Sup_def</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">use</span> <span class="n">f</span> <span class="mi">0</span><span class="o">,</span> <span class="n">exact</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="mi">0</span><span class="o">,</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="o">,</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">sorry</span> <span class="o">},</span>
  <span class="c1">-- useful lemmas: real.Sup_le real.le_Sup, etc...</span>
<span class="kn">end</span>
</code></pre></div>



<a name="208062245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208062245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208062245">(Aug 26 2020 at 07:54)</a>:</h4>
<p>Thanks!!</p>



<a name="208062251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208062251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208062251">(Aug 26 2020 at 07:54)</a>:</h4>
<p>Awesome to get me started <span aria-label="thank you" class="emoji emoji-1f64f" role="img" title="thank you">:thank_you:</span></p>



<a name="208062599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208062599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208062599">(Aug 26 2020 at 07:58)</a>:</h4>
<p>I think there was a thread on this in the past</p>



<a name="208062781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208062781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208062781">(Aug 26 2020 at 08:00)</a>:</h4>
<p>I think I was thinking of another proof assistant ;)</p>



<a name="208062818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208062818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208062818">(Aug 26 2020 at 08:01)</a>:</h4>
<p>You have to start <a href="http://us.metamath.org/mpegif/imo72b2.html">somewhere</a> :)</p>



<a name="208063997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208063997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208063997">(Aug 26 2020 at 08:18)</a>:</h4>
<p>The absolute values bars in the tutorials project means <code>abs</code>: <a href="https://github.com/leanprover-community/tutorials/blob/master/src/solutions/tuto_lib.lean#L12">https://github.com/leanprover-community/tutorials/blob/master/src/solutions/tuto_lib.lean#L12</a> There is no other trick involved here.</p>



<a name="208068998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208068998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208068998">(Aug 26 2020 at 09:20)</a>:</h4>
<p>Might be easier to prove if you change <code>f(y)</code> to <code>g(y)</code> in <code>hf1</code></p>



<a name="208070171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208070171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208070171">(Aug 26 2020 at 09:33)</a>:</h4>
<p>Nice catch :)</p>



<a name="208085207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208085207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208085207">(Aug 26 2020 at 12:37)</a>:</h4>
<p>I wrote an awful proof:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">normed_space</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">∥</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">classical</span><span class="o">,</span>
  <span class="n">set</span> <span class="n">S</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span><span class="o">),</span>
  <span class="n">set</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">Sup</span> <span class="n">S</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">use</span> <span class="mi">1</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">fz</span> <span class="n">zs</span><span class="o">,</span>
    <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">zs</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">hf2</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">real</span><span class="bp">.</span><span class="n">le_Sup</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span><span class="o">,</span> <span class="o">},</span>
  <span class="o">},</span>
  <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hf3</span><span class="o">,</span>
    <span class="k">calc</span> <span class="mi">0</span>
        <span class="bp">&lt;</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="o">:</span> <span class="n">norm_pos_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hx</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k</span> <span class="o">:</span> <span class="n">h2</span> <span class="n">x</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="k">have</span> <span class="n">h4</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">use</span> <span class="err">∥</span><span class="n">f</span> <span class="mi">0</span><span class="err">∥</span><span class="o">,</span> <span class="n">exact</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="mi">0</span><span class="o">,</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h5</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="k">calc</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">*</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span><span class="o">)</span>
        <span class="bp">=</span> <span class="err">∥</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">g</span> <span class="n">y</span><span class="err">∥</span> <span class="o">:</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">real</span><span class="bp">.</span><span class="n">norm_eq_abs</span><span class="o">,</span> <span class="n">abs_mul</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">]</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hf1</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">+</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="o">:</span> <span class="n">norm_add_le</span> <span class="bp">_</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">+</span> <span class="n">k</span> <span class="o">:</span> <span class="n">add_le_add</span> <span class="o">(</span><span class="n">h2</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="bp">_</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span><span class="n">k</span> <span class="o">:</span> <span class="o">(</span><span class="n">two_mul</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="k">have</span> <span class="n">h5&#39;</span><span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">),</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">*</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">apply</span> <span class="o">(</span><span class="n">mul_le_mul_left</span> <span class="n">zero_lt_two</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="o">(</span><span class="n">h5</span> <span class="n">x</span><span class="o">),</span>
  <span class="o">},</span>

  <span class="n">by_contra</span><span class="o">,</span>
  <span class="n">push_neg</span> <span class="n">at</span> <span class="n">a</span><span class="o">,</span>

  <span class="n">set</span> <span class="n">k&#39;</span> <span class="o">:=</span> <span class="n">k</span> <span class="bp">/</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h6</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">≤</span> <span class="n">k&#39;</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">le_div_iff</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">h5&#39;</span><span class="o">,</span> <span class="o">},</span>
    <span class="n">exact</span> <span class="n">trans</span> <span class="n">zero_lt_one</span> <span class="n">a</span><span class="o">,</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h7</span> <span class="o">:</span> <span class="n">k&#39;</span> <span class="bp">&lt;</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">div_lt_iff</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">lt_mul_of_one_lt_right</span> <span class="err">‹</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">k</span><span class="err">›</span> <span class="n">a</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">trans</span> <span class="n">zero_lt_one</span> <span class="n">a</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h8</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">k&#39;</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">real</span><span class="bp">.</span><span class="n">Sup_le_ub</span> <span class="bp">_</span> <span class="n">h4</span><span class="o">,</span>
    <span class="n">rintros</span> <span class="n">y&#39;</span> <span class="bp">⟨</span><span class="n">yy</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">h6</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="n">apply</span> <span class="n">lt_irrefl</span> <span class="n">k&#39;</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">k&#39;</span>
      <span class="bp">&lt;</span> <span class="n">k</span> <span class="o">:</span> <span class="err">‹</span><span class="bp">_</span><span class="err">›</span>
  <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k&#39;</span> <span class="o">:</span> <span class="err">‹</span><span class="bp">_</span><span class="err">›</span>
<span class="kn">end</span>
</code></pre></div>



<a name="208224714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208224714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208224714">(Aug 27 2020 at 14:33)</a>:</h4>
<p>Slightly refactored proof but still structurally the same:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">normed_space</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">∥</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">classical</span><span class="o">,</span>
  <span class="n">set</span> <span class="n">S</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span><span class="o">),</span>
  <span class="k">let</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">S</span><span class="o">),</span>

  <span class="k">have</span> <span class="n">hk₁</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">≤</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">use</span> <span class="mi">1</span><span class="o">,</span>
      <span class="n">intros</span> <span class="bp">_</span> <span class="n">hy</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range</span> <span class="n">at</span> <span class="n">hy</span><span class="o">,</span>
      <span class="n">rcases</span> <span class="n">hy</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">hf2</span> <span class="n">z</span><span class="o">,</span>
    <span class="o">},</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">real</span><span class="bp">.</span><span class="n">le_Sup</span> <span class="n">S</span> <span class="n">h</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="n">x</span><span class="o">),</span>
  <span class="o">},</span>
  <span class="k">have</span> <span class="n">hk₂</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="k">calc</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">*</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span><span class="o">)</span>
        <span class="bp">=</span> <span class="err">∥</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">g</span> <span class="n">y</span><span class="err">∥</span> <span class="o">:</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">real</span><span class="bp">.</span><span class="n">norm_eq_abs</span><span class="o">,</span> <span class="n">abs_mul</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">]</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hf1</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">+</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="o">:</span> <span class="n">norm_add_le</span> <span class="bp">_</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">+</span> <span class="n">k</span> <span class="o">:</span> <span class="n">add_le_add</span> <span class="o">(</span><span class="n">hk₁</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">hk₁</span> <span class="bp">_</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="o">:</span> <span class="o">(</span><span class="n">two_mul</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
  <span class="o">},</span>

  <span class="n">by_contra</span> <span class="n">hneg</span><span class="o">,</span>
  <span class="n">push_neg</span> <span class="n">at</span> <span class="n">hneg</span><span class="o">,</span>
  <span class="n">set</span> <span class="n">k&#39;</span> <span class="o">:=</span> <span class="n">k</span> <span class="bp">/</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span><span class="o">,</span>

  <span class="k">have</span> <span class="n">H₁</span> <span class="o">:</span> <span class="n">k&#39;</span> <span class="bp">&lt;</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">{</span> <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hf3</span><span class="o">,</span>
      <span class="k">calc</span> <span class="mi">0</span>
          <span class="bp">&lt;</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="o">:</span> <span class="n">norm_pos_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hx</span>
     <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k</span> <span class="o">:</span> <span class="n">hk₁</span> <span class="n">x</span> <span class="o">},</span>
    <span class="n">rw</span> <span class="n">div_lt_iff</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">lt_mul_of_one_lt_right</span> <span class="n">h₁</span> <span class="n">hneg</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">trans</span> <span class="n">zero_lt_one</span> <span class="n">hneg</span> <span class="o">},</span>

  <span class="k">have</span> <span class="n">H₂</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">k&#39;</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">have</span> <span class="n">h₁</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">use</span> <span class="err">∥</span><span class="n">f</span> <span class="mi">0</span><span class="err">∥</span><span class="o">,</span> <span class="n">exact</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="mi">0</span><span class="o">,</span> <span class="o">},</span>
    <span class="k">have</span> <span class="n">h₂</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">≤</span> <span class="n">k&#39;</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">x</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">le_div_iff</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">apply</span> <span class="o">(</span><span class="n">mul_le_mul_left</span> <span class="n">zero_lt_two</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="o">(</span><span class="n">hk₂</span> <span class="n">x</span><span class="o">)</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">exact</span> <span class="n">trans</span> <span class="n">zero_lt_one</span> <span class="n">hneg</span> <span class="o">}</span> <span class="o">},</span>
    <span class="n">apply</span> <span class="n">real</span><span class="bp">.</span><span class="n">Sup_le_ub</span> <span class="bp">_</span> <span class="n">h₁</span><span class="o">,</span>
    <span class="n">rintros</span> <span class="n">y&#39;</span> <span class="bp">⟨</span><span class="n">yy</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">h₂</span> <span class="n">yy</span> <span class="o">},</span>

  <span class="n">apply</span> <span class="n">lt_irrefl</span> <span class="n">k&#39;</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">k&#39;</span>
      <span class="bp">&lt;</span> <span class="n">k</span> <span class="o">:</span> <span class="n">H₁</span>
  <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k&#39;</span> <span class="o">:</span> <span class="n">H₂</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="208224803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208224803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208224803">(Aug 27 2020 at 14:34)</a>:</h4>
<p>I'd be very curious to get feedback on how to make it more concise, if anybody has any.</p>



<a name="208231377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208231377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208231377">(Aug 27 2020 at 15:17)</a>:</h4>
<p>I played around with it some more, with more backwards reasoning:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">normed_space</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="err">∥</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">set</span> <span class="n">S</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span><span class="o">),</span>
  <span class="n">set</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="o">:=</span> <span class="n">Sup</span> <span class="n">S</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">≤</span> <span class="n">k</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">real</span><span class="bp">.</span><span class="n">le_Sup</span> <span class="n">S</span> <span class="bp">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">forall_range_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hf2</span><span class="bp">⟩</span> <span class="err">$</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="n">x</span><span class="o">,</span>

  <span class="n">by_contra</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">push_neg</span> <span class="n">at</span> <span class="n">a</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hgy</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span> <span class="o">:=</span> <span class="n">trans</span> <span class="n">zero_lt_one</span> <span class="n">a</span><span class="o">,</span>

  <span class="n">set</span> <span class="n">k&#39;</span> <span class="o">:=</span> <span class="n">k</span> <span class="bp">/</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">lt_irrefl</span> <span class="n">k&#39;</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">lt_of_lt_of_le</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">refine</span> <span class="o">(</span><span class="n">div_lt_iff</span> <span class="n">hgy</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">(</span><span class="n">lt_mul_of_one_lt_right</span> <span class="bp">_</span> <span class="n">a</span><span class="o">),</span>
    <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hf3</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">lt_of_lt_of_le</span> <span class="o">(</span><span class="n">norm_pos_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hx</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span><span class="o">)</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">real</span><span class="bp">.</span><span class="n">Sup_le_ub</span> <span class="n">S</span> <span class="bp">⟨</span><span class="err">∥</span><span class="n">f</span> <span class="mi">0</span><span class="err">∥</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="mi">0</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">set</span><span class="bp">.</span><span class="n">forall_range_iff</span><span class="o">,</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">le_div_iff</span> <span class="n">hgy</span><span class="o">,</span> <span class="err">←</span><span class="n">mul_le_mul_left</span> <span class="n">zero_lt_two</span><span class="o">],</span>
    <span class="k">calc</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="err">∥</span><span class="n">f</span> <span class="n">x</span><span class="err">∥</span> <span class="bp">*</span> <span class="err">∥</span><span class="n">g</span> <span class="n">y</span><span class="err">∥</span><span class="o">)</span>
        <span class="bp">=</span> <span class="err">∥</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">g</span> <span class="n">y</span><span class="err">∥</span> <span class="o">:</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">real</span><span class="bp">.</span><span class="n">norm_eq_abs</span><span class="o">,</span> <span class="n">abs_mul</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">]</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hf1</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="bp">+</span> <span class="err">∥</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="err">∥</span> <span class="o">:</span> <span class="n">norm_add_le</span> <span class="bp">_</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">+</span> <span class="n">k</span> <span class="o">:</span> <span class="n">add_le_add</span> <span class="o">(</span><span class="n">h</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="bp">_</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span> <span class="o">:</span> <span class="o">(</span><span class="n">two_mul</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="o">},</span>
<span class="kn">end</span>
</code></pre></div>



<a name="208232330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208232330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208232330">(Aug 27 2020 at 15:23)</a>:</h4>
<p>Btw, I was hoping <code>linarith</code> could solve <code>0 &lt; ∥g y∥</code> given <code>1 &lt; ∥g y∥</code>, but apparently not. Should it?</p>



<a name="208235063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208235063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208235063">(Aug 27 2020 at 15:41)</a>:</h4>
<p>To prove <code>hgy</code>? It does for me.</p>



<a name="208235302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208235302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208235302">(Aug 27 2020 at 15:42)</a>:</h4>
<p>Now it does for me too. I wonder what went wrong before</p>



<a name="208237400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208237400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stanislas Polu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208237400">(Aug 27 2020 at 15:57)</a>:</h4>
<p>Fantastic! Do people find the term proofs more readable with practice?</p>



<a name="208237657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208237657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208237657">(Aug 27 2020 at 15:59)</a>:</h4>
<p>In my case at least, "more readable", but still not really "readable".</p>



<a name="208244249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208244249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208244249">(Aug 27 2020 at 16:49)</a>:</h4>
<p>Ruben, when you hit something that looks like an API hole, it's even nicer if you try to fix it by opening a mathlib PR. It seems your desperately missed:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">real</span><span class="bp">.</span><span class="n">le_supr</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">supr</span> <span class="n">f</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">real</span><span class="bp">.</span><span class="n">le_Sup</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">use</span> <span class="n">b</span><span class="o">,</span>
    <span class="n">rintros</span> <span class="bp">-</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">h</span> <span class="bp">_</span> <span class="o">},</span>
  <span class="n">exact</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="n">i</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">real</span><span class="bp">.</span><span class="n">supr_le_ub</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">nonempty</span> <span class="n">ι</span><span class="o">]</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">supr</span> <span class="n">f</span> <span class="bp">≤</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">real</span><span class="bp">.</span><span class="n">Sup_le_ub</span><span class="o">,</span>
  <span class="n">inhabit</span> <span class="n">ι</span><span class="o">,</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">f</span> <span class="err">$</span> <span class="n">default</span> <span class="n">ι</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_range_self</span> <span class="bp">_</span><span class="o">],</span>
  <span class="n">rintros</span> <span class="bp">-</span> <span class="bp">⟨</span><span class="n">z</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">h</span>
<span class="kn">end</span>
</code></pre></div>


<p>Ideally a PR would of course also include the infi variants.</p>



<a name="208245125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208245125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208245125">(Aug 27 2020 at 16:55)</a>:</h4>
<p>Oh, I started from Johan's code and didn't think of using <code>supr</code> at all, I'll take a look at those</p>



<a name="208245219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208245219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208245219">(Aug 27 2020 at 16:56)</a>:</h4>
<p>I just tried to write a readable proof (using the above lemmas).</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">|</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hf3</span><span class="o">,</span>
  <span class="n">set</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">supr</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">real</span><span class="bp">.</span><span class="n">le_supr</span> <span class="n">hf2</span><span class="o">,</span>
  <span class="n">by_contradiction</span> <span class="n">H</span><span class="o">,</span> <span class="n">push_neg</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hgy</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">,</span>
    <span class="k">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">k_pos</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">lt_of_lt_of_le</span> <span class="o">(</span><span class="n">norm_pos_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hx</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span><span class="o">),</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">/</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span> <span class="bp">&lt;</span> <span class="n">k</span> <span class="o">:=</span> <span class="o">(</span><span class="n">div_lt_iff</span> <span class="n">hgy</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">(</span><span class="n">lt_mul_of_one_lt_right</span> <span class="n">k_pos</span> <span class="n">H</span><span class="o">),</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">/</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">suffices</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">/</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">,</span> <span class="k">from</span> <span class="n">real</span><span class="bp">.</span><span class="n">supr_le_ub</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">suffices</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">*</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span><span class="o">,</span>
      <span class="k">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">le_div_iff</span> <span class="n">hgy</span><span class="o">,</span> <span class="err">←</span><span class="n">mul_le_mul_left</span> <span class="n">zero_lt_two</span><span class="o">],</span>
    <span class="k">calc</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">*</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">)</span>
        <span class="bp">=</span> <span class="bp">|</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">g</span> <span class="n">y</span><span class="bp">|</span>           <span class="o">:</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">abs_mul</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">]</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">|</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="bp">|</span>   <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hf1</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="bp">|</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">+</span> <span class="bp">|</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="o">:</span> <span class="n">abs_add</span> <span class="bp">_</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span>                     <span class="o">:</span> <span class="k">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">h</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">),</span> <span class="n">h</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span><span class="n">y</span><span class="o">)]</span> <span class="o">},</span>
  <span class="n">linarith</span>
<span class="kn">end</span>
</code></pre></div>



<a name="208268021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208268021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208268021">(Aug 27 2020 at 19:58)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/3959">#3959</a></p>



<a name="208323089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/IMO%201972%20B2/near/208323089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/IMO.201972.20B2.html#208323089">(Aug 28 2020 at 09:42)</a>:</h4>
<p>I realized the <code>hf2</code> hypothesis is unnecessarily strong - we only need that <code>|f|</code> is bounded from above, and that formulation lets us use <code>le_csupr</code> directly:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">example</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hf1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">))</span>
  <span class="o">(</span><span class="n">hf2</span> <span class="o">:</span> <span class="n">bdd_above</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">hf3</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">|</span><span class="n">g</span><span class="o">(</span><span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hf3</span><span class="o">,</span>
  <span class="n">set</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">supr</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span><span class="o">),</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">le_csupr</span> <span class="n">hf2</span><span class="o">,</span>
  <span class="n">by_contradiction</span> <span class="n">H</span><span class="o">,</span> <span class="n">push_neg</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hgy</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">,</span>
    <span class="k">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">k_pos</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">lt_of_lt_of_le</span> <span class="o">(</span><span class="n">norm_pos_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hx</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span><span class="o">),</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">/</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span> <span class="bp">&lt;</span> <span class="n">k</span> <span class="o">:=</span> <span class="o">(</span><span class="n">div_lt_iff</span> <span class="n">hgy</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="o">(</span><span class="n">lt_mul_of_one_lt_right</span> <span class="n">k_pos</span> <span class="n">H</span><span class="o">),</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">/</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">suffices</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span><span class="o">,</span> <span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">k</span> <span class="bp">/</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">,</span> <span class="k">from</span> <span class="n">csupr_le</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">suffices</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">*</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span><span class="o">,</span>
      <span class="k">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">le_div_iff</span> <span class="n">hgy</span><span class="o">,</span> <span class="err">←</span><span class="n">mul_le_mul_left</span> <span class="n">zero_lt_two</span><span class="o">],</span>
    <span class="k">calc</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">|</span><span class="n">f</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">*</span> <span class="bp">|</span><span class="n">g</span> <span class="n">y</span><span class="bp">|</span><span class="o">)</span>
        <span class="bp">=</span> <span class="bp">|</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">g</span> <span class="n">y</span><span class="bp">|</span>           <span class="o">:</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">abs_mul</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">]</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="bp">|</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="bp">|</span>   <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hf1</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="bp">|</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="bp">+</span> <span class="bp">|</span><span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span><span class="bp">|</span> <span class="o">:</span> <span class="n">abs_add</span> <span class="bp">_</span> <span class="bp">_</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">k</span>                     <span class="o">:</span> <span class="k">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">h</span> <span class="o">(</span><span class="n">x</span><span class="bp">+</span><span class="n">y</span><span class="o">),</span> <span class="n">h</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span><span class="n">y</span><span class="o">)]</span> <span class="o">},</span>
  <span class="n">linarith</span>
<span class="kn">end</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>