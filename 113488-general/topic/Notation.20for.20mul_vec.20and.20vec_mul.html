---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html">Notation for mul_vec and vec_mul</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="285641653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285641653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285641653">(Jun 10 2022 at 07:44)</a>:</h4>
<p>What do you all think about introducing infix notations for <code>matrix.mul_vec</code> and <code>matrix.vec_mul</code>?</p>
<p>I am currently working on this lemma:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">schur_complement_eq'</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span><span class="o">}</span> <span class="o">(</span><span class="n">hA</span> <span class="o">:</span> <span class="n">A.is_symm</span><span class="o">)</span> <span class="o">[</span><span class="n">invertible</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span>
<span class="o">(</span><span class="n">vec_mul</span> <span class="o">(</span><span class="n">sum.elim</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">from_blocks</span> <span class="n">A</span> <span class="n">B</span> <span class="n">B</span><span class="bp">ᵀ</span> <span class="n">D</span><span class="o">))</span> <span class="bp">⬝ᵥ</span> <span class="o">(</span><span class="n">sum.elim</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">vec_mul</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="n">mul_vec</span> <span class="o">(</span><span class="n">A</span><span class="bp">⁻¹</span> <span class="bp">⬝</span> <span class="n">B</span><span class="o">)</span> <span class="n">y</span><span class="o">))</span> <span class="n">A</span> <span class="bp">⬝ᵥ</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">mul_vec</span> <span class="o">(</span><span class="n">A</span><span class="bp">⁻¹</span> <span class="bp">⬝</span> <span class="n">B</span><span class="o">)</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">vec_mul</span> <span class="n">y</span> <span class="o">(</span><span class="n">D</span> <span class="bp">-</span> <span class="n">B</span><span class="bp">ᵀ</span> <span class="bp">⬝</span> <span class="n">A</span><span class="bp">⁻¹</span> <span class="bp">⬝</span> <span class="n">B</span><span class="o">)</span> <span class="bp">⬝ᵥ</span> <span class="n">y</span> <span class="o">:=</span>
</code></pre></div>
<p>It is really hard to read without infix notation. I would propose something like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">localized</span> <span class="s2">"infix ` ⊕ᵥ `:65 := sum.elim"</span> <span class="k">in</span> <span class="n">matrix</span>
<span class="n">localized</span> <span class="s2">"infix ` ᵛ⬝ `:73 := vec_mul"</span> <span class="k">in</span> <span class="n">matrix</span>
<span class="n">localized</span> <span class="s2">"infix ` ⬝ᵛ `:74 := mul_vec"</span> <span class="k">in</span> <span class="n">matrix</span>

<span class="kd">lemma</span> <span class="n">schur_complement_eq</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">matrix</span> <span class="n">n</span> <span class="n">n</span> <span class="n">R</span><span class="o">}</span> <span class="o">(</span><span class="n">hA</span> <span class="o">:</span> <span class="n">A.is_symm</span><span class="o">)</span> <span class="o">[</span><span class="n">invertible</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span>
<span class="o">(</span><span class="n">x</span> <span class="bp">⊕ᵥ</span> <span class="n">y</span><span class="o">)</span> <span class="bp">ᵛ⬝</span> <span class="n">from_blocks</span> <span class="n">A</span> <span class="n">B</span> <span class="n">B</span><span class="bp">ᵀ</span> <span class="n">D</span> <span class="bp">⬝ᵥ</span> <span class="o">(</span><span class="n">x</span> <span class="bp">⊕ᵥ</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span>
  <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">A</span><span class="bp">⁻¹</span> <span class="bp">⬝</span> <span class="n">B</span> <span class="bp">⬝ᵛ</span> <span class="n">y</span><span class="o">)</span> <span class="bp">ᵛ⬝</span> <span class="n">A</span> <span class="bp">⬝ᵥ</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">A</span><span class="bp">⁻¹</span> <span class="bp">⬝</span> <span class="n">B</span> <span class="bp">⬝ᵛ</span> <span class="n">y</span><span class="o">)</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">ᵛ⬝</span> <span class="o">(</span><span class="n">D</span> <span class="bp">-</span> <span class="n">B</span><span class="bp">ᵀ</span> <span class="bp">⬝</span> <span class="n">A</span><span class="bp">⁻¹</span> <span class="bp">⬝</span> <span class="n">B</span><span class="o">)</span> <span class="bp">⬝ᵥ</span> <span class="n">y</span> <span class="o">:=</span>
</code></pre></div>



<a name="285642656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285642656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285642656">(Jun 10 2022 at 07:57)</a>:</h4>
<p>I feel like if we go down that route we should change <code>dot_product u v</code> to <code>u ᵛ⬝ᵛ v</code></p>



<a name="285642753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285642753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285642753">(Jun 10 2022 at 07:58)</a>:</h4>
<p>The other option would be a <code>has_mat_mul</code> class and use <code>⬝</code> for all four operations</p>



<a name="285644465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285644465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285644465">(Jun 10 2022 at 08:19)</a>:</h4>
<p><code>⬝</code> for all of them would be amazing. What would be the best way to approach such a big refactoring?</p>



<a name="285645722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285645722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285645722">(Jun 10 2022 at 08:33)</a>:</h4>
<p>I don't think the refactor will be all that big, although a danger with this change is that <code>![![1,2],![3,4]] ⬝ ![![1,2],![3,4]] = ![10, 20]</code></p>



<a name="285645845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285645845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285645845">(Jun 10 2022 at 08:34)</a>:</h4>
<p>(because <code>![![...]]</code> creates a vector of vectors not a matrix)</p>



<a name="285646151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646151">(Jun 10 2022 at 08:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul/near/285645722">said</a>:</p>
<blockquote>
<p>I don't think the refactor will be all that big, although a danger with this change is that <code>![![1,2],![3,4]] ⬝ ![![1,2],![3,4]] = ![10, 20]</code></p>
</blockquote>
<p>I believe it would not be a problem since we can require that the entries of the vector are <code>non_unital_non_assoc_semiring</code>, and now we're applying <code>has_mat_mul</code> to the entries</p>



<a name="285646575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646575">(Jun 10 2022 at 08:42)</a>:</h4>
<p>I don't understand that suggestion. The problem is that</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span> <span class="bp">⬝</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span>
  <span class="bp">=</span> <span class="n">dot_product</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span>
  <span class="bp">=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="bp">*</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="bp">+</span> <span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]</span> <span class="bp">*</span> <span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]</span>
  <span class="bp">=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">4</span><span class="o">]</span> <span class="bp">+</span> <span class="bp">!</span><span class="o">[</span><span class="mi">9</span><span class="o">,</span><span class="mi">16</span><span class="o">]</span>
  <span class="bp">=</span> <span class="bp">!</span><span class="o">[</span><span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">]</span>
</code></pre></div>



<a name="285646656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646656">(Jun 10 2022 at 08:42)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/pi.non_unital_non_assoc_semiring">docs#pi.non_unital_non_assoc_semiring</a></p>



<a name="285646727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646727">(Jun 10 2022 at 08:43)</a>:</h4>
<p>Arguably the real problem here is that we don't have notation that actually produces a matrix</p>



<a name="285646747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646747">(Jun 10 2022 at 08:43)</a>:</h4>
<p><code>![![1,2],![3,4]] * ![![1,2],![3,4]]</code> already fails to perform matrix multiplication</p>



<a name="285646830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646830">(Jun 10 2022 at 08:44)</a>:</h4>
<p>This has come up before, but I think the lean3 <code>notation</code> command isn't powerful enough to allow a special <code>!![1, 2; 3, 4]</code> notation</p>



<a name="285646900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646900">(Jun 10 2022 at 08:45)</a>:</h4>
<p>We could use a <code>user_notation</code>, but then it would print as something like <code>to_matrix ![![1,2],![3,4]]</code>.</p>



<a name="285646907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285646907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285646907">(Jun 10 2022 at 08:45)</a>:</h4>
<p>Maybe thats ok though</p>



<a name="285647363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285647363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285647363">(Jun 10 2022 at 08:50)</a>:</h4>
<p>Indeed, we can't put the notation on <code>matrix</code> currently, or the instance isn't picked up.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.matrix.notation</span>

<span class="kd">class</span> <span class="n">has_mat_mul</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">γ</span> <span class="o">:</span> <span class="n">out_param</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mat_mul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span>

<span class="k">#print</span> <span class="kd">notation</span>
<span class="kd">infix</span> <span class="bp">`⬝`</span><span class="o">:</span><span class="mi">75</span> <span class="o">:=</span> <span class="n">has_mat_mul.mat_mul</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="n">o</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="n">γ</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">-- Notation not found</span>
<span class="cm">instance matrix.has_mat_mul [non_unital_non_assoc_semiring α] [fintype n] :</span>
<span class="cm">  has_mat_mul (matrix m n α) (matrix n o α) (matrix m o α) :=</span>
<span class="cm">⟨matrix.mul⟩</span>
<span class="cm">-/</span>

<span class="kd">instance</span> <span class="n">matrix.has_mat_mul</span> <span class="o">[</span><span class="n">non_unital_non_assoc_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_mat_mul</span> <span class="o">(</span><span class="n">m</span> <span class="bp">→</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">o</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="bp">→</span> <span class="n">o</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">matrix.mul</span><span class="o">⟩</span>

<span class="kd">@[priority 100]</span>
<span class="kd">instance</span> <span class="n">matrix.has_dot_product</span> <span class="o">[</span><span class="n">non_unital_non_assoc_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_mat_mul</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">matrix.dot_product</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="n">matrix.has_mat_mul_right</span> <span class="o">[</span><span class="n">non_unital_non_assoc_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_mat_mul</span> <span class="o">(</span><span class="n">matrix</span> <span class="n">m</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">matrix.mul_vec</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="n">matrix.has_mat_mul_left</span> <span class="o">[</span><span class="n">non_unital_non_assoc_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">m</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_mat_mul</span> <span class="o">(</span><span class="n">m</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">matrix</span> <span class="n">m</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">matrix.vec_mul</span><span class="o">⟩</span>

<span class="k">#eval</span> <span class="o">((</span><span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]])</span> <span class="bp">⬝</span> <span class="o">(</span><span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]))</span>
<span class="k">#eval</span> <span class="o">((</span><span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">⬝</span> <span class="o">(</span><span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">ℕ</span><span class="o">))</span>
</code></pre></div>



<a name="285649709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285649709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285649709">(Jun 10 2022 at 09:13)</a>:</h4>
<p><code>(x : A) * (x : A)</code> where <code>x : X</code> is not enough to tell lean to use the multiplication on <code>A</code></p>



<a name="285649771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285649771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285649771">(Jun 10 2022 at 09:14)</a>:</h4>
<p>Ok, but what's the problem with the instance on <code>m → n → α</code> as in Anne's code above?</p>



<a name="285649933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285649933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285649933">(Jun 10 2022 at 09:15)</a>:</h4>
<p>I think it's a bad idea to ever spell <code>matrix m n a</code> in that way</p>



<a name="285649979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285649979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285649979">(Jun 10 2022 at 09:15)</a>:</h4>
<p>It feels as bad as spelling <code>opposite a</code> as <code>a</code> or <code>multiplicative a</code> as <code>a</code></p>



<a name="285650173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285650173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285650173">(Jun 10 2022 at 09:17)</a>:</h4>
<p>This does the right thing:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="o">(</span><span class="k">show</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">ℕ</span><span class="o">,</span> <span class="k">from</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]])</span>
    <span class="bp">⬝</span> <span class="o">(</span><span class="k">show</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">ℕ</span><span class="o">,</span> <span class="k">from</span> <span class="bp">!</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]])</span>
</code></pre></div>



<a name="285650266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285650266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285650266">(Jun 10 2022 at 09:18)</a>:</h4>
<p><code>foo (x : A)</code> where <code>x : X</code> and <code>def A := X</code> means "parse <code>x</code> as an <code>A</code>, but then call <code>foo</code> with <code>x</code> as an <code>X</code>"</p>



<a name="285650558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285650558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285650558">(Jun 10 2022 at 09:20)</a>:</h4>
<p>Here's a nicer spelling:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">to_matrix</span> <span class="o">:</span> <span class="o">(</span><span class="n">m</span> <span class="bp">→</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="bp">≃</span> <span class="n">matrix</span> <span class="n">m</span> <span class="n">n</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">equiv.refl</span> <span class="n">_</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">to_matrix_apply</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">to_matrix</span> <span class="n">f</span> <span class="n">i</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">to_matrix_symm_apply</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">matrix</span> <span class="n">m</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">to_matrix.symm</span> <span class="n">f</span> <span class="n">i</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">notation</span> <span class="bp">`!ₘ</span><span class="o">[</span><span class="bp">`</span> <span class="n">l</span><span class="o">:(</span><span class="n">foldr</span> <span class="bp">`</span><span class="o">,</span> <span class="bp">`</span> <span class="o">(</span><span class="n">h</span> <span class="n">t</span><span class="o">,</span> <span class="n">matrix.vec_cons</span> <span class="n">h</span> <span class="n">t</span><span class="o">)</span> <span class="n">matrix.vec_empty</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span><span class="o">)</span> <span class="o">:=</span> <span class="n">to_matrix</span> <span class="n">l</span>

<span class="k">#eval</span> <span class="bp">!ₘ</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span> <span class="bp">⬝</span> <span class="bp">!ₘ</span><span class="o">[</span><span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="bp">!</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]]</span>  <span class="c1">-- does the right thing</span>
</code></pre></div>



<a name="285653561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/285653561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#285653561">(Jun 10 2022 at 09:51)</a>:</h4>
<p>I implemented the <code>user_notation</code> in <a href="https://github.com/leanprover-community/mathlib/pull/14665">#14665</a></p>



<a name="289450600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289450600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289450600">(Jul 13 2022 at 12:26)</a>:</h4>
<p>Now that <code>!![1, 2; 3, 4]</code> notation is merged, we could consider revisiting <code>class has_mat_mul </code></p>



<a name="289477359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289477359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wrenna Robson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289477359">(Jul 13 2022 at 15:37)</a>:</h4>
<p>What are the operations it would apply to (and what is that symbol - is it different from the smul symbol?)</p>



<a name="289567628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289567628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289567628">(Jul 14 2022 at 09:08)</a>:</h4>
<p>The symbol is <code>\cdot</code>. It's different from the smul symbol. The dot is a bit smaller.</p>



<a name="289567696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289567696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289567696">(Jul 14 2022 at 09:08)</a>:</h4>
<p>We could use it for <code>matrix.mul</code>, where it is used already, for <code>matrix.mul_vec</code>, <code>matrix.vec_mul</code>, and <code>matrix.dot_product</code>.</p>



<a name="289707748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289707748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wrenna Robson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289707748">(Jul 15 2022 at 10:01)</a>:</h4>
<p>And possibly <code>matrix.vec_mul_vec</code>?</p>



<a name="289707814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289707814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wrenna Robson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289707814">(Jul 15 2022 at 10:02)</a>:</h4>
<p>Though that may not work with <code>matrix.dot_product</code>.</p>



<a name="289717662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289717662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289717662">(Jul 15 2022 at 12:03)</a>:</h4>
<p>We don't need notation for that, you can spell it <code>col v ⬝ row w</code></p>



<a name="289717689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289717689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289717689">(Jul 15 2022 at 12:03)</a>:</h4>
<p>You don't have that option for the others, because the result type ends up a matrix not a vector</p>



<a name="289724057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/289724057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wrenna Robson <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#289724057">(Jul 15 2022 at 13:08)</a>:</h4>
<p>Ah, so you can.</p>



<a name="290360249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290360249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290360249">(Jul 21 2022 at 10:56)</a>:</h4>
<p>I tried this in <a href="https://github.com/leanprover-community/mathlib/pull/15585">#15585</a>, but it doesn't work as well as I'd hoped because lean's overloaded notations:</p>
<ul>
<li>Doesn't seem to work with <code>local</code> or <code>open_locale</code></li>
<li>Unfolds type synonyms</li>
</ul>



<a name="290369449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290369449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290369449">(Jul 21 2022 at 12:35)</a>:</h4>
<p>I thought you planned to create a type class <code>has_mat_mul </code>. Why do you use overloaded notations now?</p>



<a name="290370445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290370445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290370445">(Jul 21 2022 at 12:44)</a>:</h4>
<p>The typeclass had its own problems:</p>
<ul>
<li>The <code>out_param</code> stuff doesn't always help, you still can't write things like <code>v ⬝ 0</code></li>
<li>You now have to change everything to be stated about <code>has_mat_mul.mul</code> instead of <code>dot_product</code> etc. This is a lot more unwieldy if the notation is not enabled;</li>
</ul>



<a name="290372989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290372989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290372989">(Jul 21 2022 at 13:08)</a>:</h4>
<p>I see. But I feel that the type class approach works quite well for <code>+</code>, <code>*</code>, <code>•</code>, etc. The fact that we can't write <code>v ⋅ 0</code> doesn't shock me. Somehow we need to tell Lean what <code>0</code> we mean. You probably can't write <code>a • 0</code> either, right?</p>



<a name="290374797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290374797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290374797">(Jul 21 2022 at 13:25)</a>:</h4>
<p><code>a • 0</code> isn't quite as bad because lean knows the result type is the same type as the 0</p>



<a name="290375965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290375965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290375965">(Jul 21 2022 at 13:35)</a>:</h4>
<p>Ah, ok, right. <code>⋅</code> would be extremely ambiguous about what comes in and what comes out...</p>



<a name="290377664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20mul_vec%20and%20vec_mul/near/290377664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Notation.20for.20mul_vec.20and.20vec_mul.html#290377664">(Jul 21 2022 at 13:49)</a>:</h4>
<p>How about this: we add a typeclass <code>has_mat_mul </code> using <code>⋅</code> and in addition localized notations <code>ᵥ⋅ₘ</code>, <code>ᵥ⋅ₘ</code>, <code>ₘ⋅ₘ</code>, <code>ᵥ⋅ᵥ</code> that abbreviate <code>has_mat_mul</code> with the appropriate type class instance specified. So in most cases, you'll be able to use <code>⋅</code>. Whenever Lean doesn't understand what's going on because it's not clear what types the arguments have, you can use the more specific notation.</p>
<p>It would be nice if the output window would show <code>⋅</code> whenever possible, though.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>