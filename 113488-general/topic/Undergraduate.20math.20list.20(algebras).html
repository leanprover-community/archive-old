---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html">Undergraduate math list (algebras)</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="256260939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256260939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256260939">(Oct 05 2021 at 14:58)</a>:</h4>
<p>Oliver, the question is whether you can write a def that takes a lie algebra structure and outputs a <code>non_unital_non_assoc_semiring</code></p>



<a name="256261505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256261505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256261505">(Oct 05 2021 at 15:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list/near/256260939">said</a>:</p>
<blockquote>
<p>Oliver, the question is whether you can write a def that takes a lie algebra structure and outputs a <code>non_unital_non_assoc_semiring</code></p>
</blockquote>
<p>Should we have <code>bracketive</code>/<code>unbracketive</code> to match <code>multiplicative</code>/<code>additive</code>? One translates between <code>+</code> and <code>*</code>, the other between lie brackets and <code>*</code>.</p>



<a name="256262488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256262488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256262488">(Oct 05 2021 at 15:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/256260939">said</a>:</p>
<blockquote>
<p>Oliver, the question is whether you can write a def that takes a lie algebra structure and outputs a <code>non_unital_non_assoc_semiring</code></p>
</blockquote>
<p>I see, well we can do this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.lie.basic</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span> <span class="o">)</span> <span class="o">[</span><span class="n">lie_ring</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">def</span> <span class="n">lie_ring.to_non_unital_non_assoc_semiring</span> <span class="o">:</span> <span class="n">non_unital_non_assoc_semiring</span> <span class="n">L</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul</span>           <span class="o">:=</span> <span class="n">has_bracket.bracket</span><span class="o">,</span>
  <span class="n">left_distrib</span>  <span class="o">:=</span> <span class="n">lie_add</span><span class="o">,</span>
  <span class="n">right_distrib</span> <span class="o">:=</span> <span class="n">add_lie</span><span class="o">,</span>
  <span class="n">zero_mul</span>      <span class="o">:=</span> <span class="n">zero_lie</span><span class="o">,</span>
  <span class="n">mul_zero</span>      <span class="o">:=</span> <span class="n">lie_zero</span><span class="o">,</span>
  <span class="bp">..</span> <span class="o">(</span><span class="kd">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">L</span><span class="o">),</span> <span class="o">}</span>
</code></pre></div>



<a name="256262745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256262745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256262745">(Oct 05 2021 at 15:09)</a>:</h4>
<p>And if we had also assumed <code>lie_algebra R L</code> (for a <code>comm_ring R</code>) we could define the relevant <code>is_scalar_tower</code> and <code>smul_comm_class</code> classes.</p>



<a name="256262833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256262833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256262833">(Oct 05 2021 at 15:09)</a>:</h4>
<p>Where does the <code>has_scalar R L</code> instance come from?</p>



<a name="256262991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256262991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256262991">(Oct 05 2021 at 15:10)</a>:</h4>
<p>From <code>lie_algebra.to_module</code></p>



<a name="256263285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256263285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256263285">(Oct 05 2021 at 15:11)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/lie_algebra.to_module">docs#lie_algebra.to_module</a></p>



<a name="256263561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256263561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256263561">(Oct 05 2021 at 15:13)</a>:</h4>
<p>Oh I was getting confused by <code>lie_ring_module</code> which has a different sort of action, never mind</p>



<a name="256263681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256263681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256263681">(Oct 05 2021 at 15:13)</a>:</h4>
<p>Oh, but actually you have a point, we need a <code>has_scalar L L</code>.</p>



<a name="256263786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256263786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256263786">(Oct 05 2021 at 15:14)</a>:</h4>
<p>Which I guess would come from <code>lie_ring.to_non_unital_non_assoc_semiring</code> via <code>has_mul.to_has_scalar</code> if we set things up right.</p>



<a name="256266194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266194">(Oct 05 2021 at 15:26)</a>:</h4>
<p>Oh wow, someone took the trouble to sort the conversations in different topics</p>



<a name="256266239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266239">(Oct 05 2021 at 15:26)</a>:</h4>
<p>What is the conclusion then? Do you have a fully working instance?</p>



<a name="256266398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266398">(Oct 05 2021 at 15:27)</a>:</h4>
<p>No but I could create one. It would be a type synonym and 3/4 associated instances on it. I can create and PR it if you would like but it is not very likely to be used.</p>



<a name="256266471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266471">(Oct 05 2021 at 15:27)</a>:</h4>
<p>I'd be more inclined to do it if we "fixed" our <code>algbera</code> class.</p>



<a name="256266476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266476">(Oct 05 2021 at 15:27)</a>:</h4>
<p>Of course, very easy and won't do any harm.</p>



<a name="256266588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266588">(Oct 05 2021 at 15:28)</a>:</h4>
<p>I don't think it necessarily needs to be PRed, but clarifying this would be nice</p>



<a name="256266613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266613">(Oct 05 2021 at 15:28)</a>:</h4>
<p>What do you mean by fixing here?</p>



<a name="256266755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266755">(Oct 05 2021 at 15:29)</a>:</h4>
<p>Changing its definition so that it does not require the underlying "ring" to be unital and associative.</p>



<a name="256266802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266802">(Oct 05 2021 at 15:29)</a>:</h4>
<p>There was an old branch where Scott and I made a brief attempt to do this and more recently there is this: <a href="https://github.com/leanprover-community/mathlib/commit/dcbed292a23994dfddf70d8262a4defb3103e968#diff-7fa8b94b14c549770d3cddb5a015c4c6029e40e3cd5161d574d9b9f5e7cdff1bR54">https://github.com/leanprover-community/mathlib/commit/dcbed292a23994dfddf70d8262a4defb3103e968#diff-7fa8b94b14c549770d3cddb5a015c4c6029e40e3cd5161d574d9b9f5e7cdff1bR54</a></p>



<a name="256266814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266814">(Oct 05 2021 at 15:29)</a>:</h4>
<p>Ok, that's a big refactor.</p>



<a name="256266842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266842">(Oct 05 2021 at 15:30)</a>:</h4>
<p>Yep</p>



<a name="256266971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256266971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256266971">(Oct 05 2021 at 15:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/256266588">said</a>:</p>
<blockquote>
<p>I don't think it necessarily needs to be PRed, but clarifying this would be nice</p>
</blockquote>
<p>I'll paste a complete version here later today.</p>



<a name="256273357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256273357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256273357">(Oct 05 2021 at 16:07)</a>:</h4>
<p>The following is not pretty but I think should illustrate how to do this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.lie.basic</span>

<span class="kd">def</span> <span class="n">lie_ring.to_has_mul</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="n">L</span>
<span class="kd">def</span> <span class="n">forward</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">→</span> <span class="n">lie_ring.to_has_mul</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span>
<span class="kd">def</span> <span class="n">back</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">:</span> <span class="n">lie_ring.to_has_mul</span> <span class="n">L</span> <span class="bp">→</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">lie_ring</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">lie_algebra</span> <span class="n">R</span> <span class="n">L</span><span class="o">]</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">non_unital_non_assoc_semiring</span> <span class="o">(</span><span class="n">lie_ring.to_has_mul</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul</span>           <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">forward</span> <span class="bp">⁅</span><span class="n">back</span> <span class="n">x</span><span class="o">,</span> <span class="n">back</span> <span class="n">y</span><span class="bp">⁆</span><span class="o">,</span>
  <span class="n">left_distrib</span>  <span class="o">:=</span> <span class="n">lie_add</span><span class="o">,</span>
  <span class="n">right_distrib</span> <span class="o">:=</span> <span class="n">add_lie</span><span class="o">,</span>
  <span class="n">zero_mul</span>      <span class="o">:=</span> <span class="n">zero_lie</span><span class="o">,</span>
  <span class="n">mul_zero</span>      <span class="o">:=</span> <span class="n">lie_zero</span><span class="o">,</span>
  <span class="bp">..</span> <span class="o">(</span><span class="kd">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">add_comm_group</span> <span class="n">L</span><span class="o">),</span> <span class="o">}</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">module</span> <span class="n">R</span> <span class="o">(</span><span class="n">lie_ring.to_has_mul</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">lie_algebra.to_module</span> <span class="n">R</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">is_scalar_tower</span> <span class="n">R</span> <span class="o">(</span><span class="n">lie_ring.to_has_mul</span> <span class="n">L</span><span class="o">)</span> <span class="o">(</span><span class="n">lie_ring.to_has_mul</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_assoc</span> <span class="o">:=</span> <span class="n">smul_lie</span><span class="o">,</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">lie_smul'</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">L</span><span class="o">)</span> <span class="o">:</span> <span class="n">t</span> <span class="bp">•</span> <span class="bp">⁅</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="bp">⁆</span> <span class="bp">=</span> <span class="bp">⁅</span><span class="n">x</span><span class="o">,</span> <span class="n">t</span> <span class="bp">•</span> <span class="n">y</span><span class="bp">⁆</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">lie_smul</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">smul_comm_class</span> <span class="n">R</span> <span class="o">(</span><span class="n">lie_ring.to_has_mul</span> <span class="n">L</span><span class="o">)</span> <span class="o">(</span><span class="n">lie_ring.to_has_mul</span> <span class="n">L</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_comm</span> <span class="o">:=</span> <span class="n">lie_smul'</span> <span class="o">}</span>
</code></pre></div>



<a name="256280807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256280807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Oliver Nash <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256280807">(Oct 05 2021 at 16:56)</a>:</h4>
<p>Tidied up <span aria-label="point up" class="emoji emoji-1f446" role="img" title="point up">:point_up:</span> slightly. LMK if you want anything else.</p>



<a name="256283221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256283221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256283221">(Oct 05 2021 at 17:11)</a>:</h4>
<p><code>with_mul</code> is probably a better name than <code>to_has_mul</code>.</p>



<a name="256289451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256289451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256289451">(Oct 05 2021 at 17:53)</a>:</h4>
<p>It still feels weird that we don't have a plain <code>non_unital_non_associative_algebra R A</code>. People coming to mathlib and asking where are algebras will have a very hard time understanding the answer</p>



<a name="256289977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256289977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256289977">(Oct 05 2021 at 17:56)</a>:</h4>
<p>If we do that we face the <a href="https://leanprover-community.github.io/mathlib_docs/find/domain">docs#domain</a> problem, where either:</p>
<ul>
<li>Lots of lemmas get stated about <code>domain</code> that don't actually require all of <code>ring</code>, <code>nontrivial</code>, and <code>no_zero_divisors</code></li>
<li>No lemmas actually use <code>domain</code>, which means it's not really pedagogically useful</li>
</ul>
<p>And to make matters worse, typeclass inference can't promote <code>ring R</code> <code>nontrivial R</code> <code>no_zero_divisors R</code> into <code>integral_domain</code> even though they mean the same thing</p>



<a name="256292819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256292819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256292819">(Oct 05 2021 at 18:12)</a>:</h4>
<p>I think that last problem goes away in lean4</p>



<a name="256292843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256292843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256292843">(Oct 05 2021 at 18:12)</a>:</h4>
<p>I guess we could just define it like <a href="https://leanprover-community.github.io/mathlib_docs/find/vector_space">docs#vector_space</a> but not use it?</p>



<a name="256292952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256292952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256292952">(Oct 05 2021 at 18:13)</a>:</h4>
<p>(i thought we did that for <code>vector_space</code> too but I guess not)</p>



<a name="256302075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256302075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256302075">(Oct 05 2021 at 19:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/256289451">said</a>:</p>
<blockquote>
<p>It still feels weird that we don't have a plain <code>non_unital_non_associative_algebra R A</code>. People coming to mathlib and asking where are algebras will have a very hard time understanding the answer</p>
</blockquote>
<p>Understanding the answer will be just as hard as understanding why we have <code>group</code> and <code>add_group</code>. And just as hard as why we can't use <code>∘</code> to denote multiplication in endomorphism rings.</p>



<a name="256302370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256302370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256302370">(Oct 05 2021 at 19:14)</a>:</h4>
<p>I disagree, this is not the same order of magnitude.</p>



<a name="256303055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256303055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256303055">(Oct 05 2021 at 19:18)</a>:</h4>
<p>Hmm, ok, I agree that such algebras could exist. Do you agree that Lie algebras wouldn't be instances?</p>



<a name="256303164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256303164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256303164">(Oct 05 2021 at 19:19)</a>:</h4>
<p>I've never used such algebras, apart from Lie algebras.</p>



<a name="256303554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256303554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256303554">(Oct 05 2021 at 19:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> Does the "<code>module R A</code> + <code>is_scalar_tower R A A</code> + <code>smul_comm_class R A A</code>" definition work in this case?</p>



<a name="256303621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256303621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256303621">(Oct 05 2021 at 19:22)</a>:</h4>
<p>If yes, then we can go with <a href="https://github.com/leanprover-community/mathlib/tree/redefine-algebra">branch#redefine-algebra</a> and use very weak typeclass assumptions in the definition.</p>



<a name="256304125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304125">(Oct 05 2021 at 19:26)</a>:</h4>
<p>Johan, did you intend to write "Lie algebras would be instances"?</p>



<a name="256304207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304207">(Oct 05 2021 at 19:27)</a>:</h4>
<p>I'm talking about <a href="https://en.wikipedia.org/wiki/Non-associative_algebra">https://en.wikipedia.org/wiki/Non-associative_algebra</a> which does include Lie algebras and mathlib algebras as special cases</p>



<a name="256304253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304253">(Oct 05 2021 at 19:27)</a>:</h4>
<p>(although wikipedia insists the base ring is a field for some mysterious reason)</p>



<a name="256304387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304387">(Oct 05 2021 at 19:28)</a>:</h4>
<p>No. I meant "would not".</p>
<p>I think it is more useful that every associative algebra gives a Lie algebra, via the commutator bracket, then the fact that the Lie algebra can be viewed as a non-assoc multiplication.<br>
Having both as instances would give two non-propeq multiplications on every assoc algebra.</p>



<a name="256304601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304601">(Oct 05 2021 at 19:29)</a>:</h4>
<p>But we can have a type tag that turns a Lie algebra into a (non-assoc) algebra.</p>



<a name="256304627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304627">(Oct 05 2021 at 19:29)</a>:</h4>
<p>Then we restate all facts in terms of Lie brackets.</p>



<a name="256304879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304879">(Oct 05 2021 at 19:31)</a>:</h4>
<p>Yury, yes I think this collection of type classes work</p>



<a name="256304950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256304950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256304950">(Oct 05 2021 at 19:31)</a>:</h4>
<p>And it is equivalent to the standard definition in case of <code>semiring A</code>.</p>



<a name="256305042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256305042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256305042">(Oct 05 2021 at 19:32)</a>:</h4>
<p>Johan, we don't have to have instances of this, I only suggest that people who want to formalize stuff about algebras can find a way to express this without searching Zulip for this thread.</p>



<a name="256305141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256305141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256305141">(Oct 05 2021 at 19:33)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> This <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span> is another reason to remove <code>algebra_map</code> from the definition of <code>algebra</code>.</p>



<a name="256305208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256305208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256305208">(Oct 05 2021 at 19:33)</a>:</h4>
<p>I certainly don't want our currently supported algebras to become harder to use because of this definition.</p>



<a name="256305278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256305278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256305278">(Oct 05 2021 at 19:34)</a>:</h4>
<p>I think we can simply put the definition somewhere and not use it.</p>



<a name="256306023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256306023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256306023">(Oct 05 2021 at 19:39)</a>:</h4>
<p>Ok, then I fully agree with you.</p>



<a name="256306815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256306815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256306815">(Oct 05 2021 at 19:44)</a>:</h4>
<p>Earlier, I suggested the same retractor as a way to get rid of some TC diamonds.</p>



<a name="256306934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256306934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256306934">(Oct 05 2021 at 19:45)</a>:</h4>
<p>We only lose some definitional equalities for <code>algebra_map</code>, nothing more.</p>



<a name="256307038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256307038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256307038">(Oct 05 2021 at 19:46)</a>:</h4>
<p>And we can reuse instances about scalar towers in definitions of algebras.</p>



<a name="256311534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/256311534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#256311534">(Oct 05 2021 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/256305042">said</a>:</p>
<blockquote>
<p>Johan, we don't have to have instances of this, I only suggest that people who want to formalize stuff about algebras can find a way to express this without searching Zulip for this thread.</p>
</blockquote>
<p>I think a better solution to this is to curate a note explaining how maths-speak translates to mathlib-speak. Typically, an explanation of how to declare a vector space or an algebra.</p>



<a name="260670195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260670195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260670195">(Nov 08 2021 at 15:14)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/10221">#10221</a> improves the docstring of <code>algebra</code> a little, which somewhat helps here.</p>



<a name="260676207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260676207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260676207">(Nov 08 2021 at 15:55)</a>:</h4>
<p>for vector spaces I think we came up with a really nice idea involving either notation or reducible defs, I can't remember, it was something Anne and I talked about months ago and then I never did anything about.</p>



<a name="260869839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260869839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260869839">(Nov 09 2021 at 22:13)</a>:</h4>
<p>Would it be possible to make a command to do the canonical <code>variables</code> incantation for you for various objects?</p>
<p>For example, maybe</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">declare</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span>
<span class="n">declare</span> <span class="n">vector_space</span> <span class="n">K</span> <span class="n">V</span>
</code></pre></div>
<p>would do</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>
<span class="kd">variables</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
</code></pre></div>
<p>I am imagining that this wouldn't be worked out automatically, but rather it would be hard-coded. Maybe another command <code>def_declare</code> could create entries in its database, allowing these definitions to be put near relevant classes.  Perhaps as a bonus it could add <code>{A : Type*}</code> and so on if these variables aren't already present.</p>
<p>An unsophisticated implementation could be that <code>declare</code> is a parameterized <code>open_locale</code>, doing textual substitution of the arguments.</p>
<p>If this is possible, would it be a good idea?  I like how it's not particularly magical (and you can verify its effects with <code>#where</code> and such) and how it doesn't abuse the language (anything nonstandard is localized to the <code>declare</code> line).</p>



<a name="260870689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260870689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260870689">(Nov 09 2021 at 22:20)</a>:</h4>
<p>This is definitely doable (with <a href="https://leanprover-community.github.io/mathlib_docs/find/lean.parser.emit_code_here">docs#lean.parser.emit_code_here</a>) and would make a nice little project! Working out which classes are needed from e.g. <code>algebra R A</code> should be doable too, at least if all the types involved appear in the target type class.</p>



<a name="260870698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260870698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260870698">(Nov 09 2021 at 22:20)</a>:</h4>
<p>I have a patch for Lean lying around somewhere that allows you to write <code>[ring R] [[algebra R A]] [[module R M]]</code>, and adds all the missing typeclass dependencies, e.g. <code>[ring R] [semiring A] [algebra R A] [add_comm_monoid M] [module R M]</code>. However, adding more locals broke the elaborator terribly and I couldn't figure out a good way to proceed.</p>



<a name="260871369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260871369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260871369">(Nov 09 2021 at 22:26)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/commit/d17c9e0c67573a35b8319da15b816409e92c160e">https://github.com/leanprover-community/lean/commit/d17c9e0c67573a35b8319da15b816409e92c160e</a></p>



<a name="260871644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260871644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260871644">(Nov 09 2021 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> Having <code>[[...]]</code> notation for auto-inserting all missing dependencies in binders would be great, too, if that could work, though it doesn't solve <code>vector_space</code>, I think.  There could be an attribute for classes (<code>abbreviation_class</code>?) that directs this feature to try to eliminate the class completely. For example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[abbreviation_class]</span>
<span class="kd">def</span> <span class="n">vector_space</span> <span class="o">(</span><span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
</code></pre></div>
<p>could define how <code>`[[vector_space K V]]</code> is replaced, though this might be confusing if you forget the double square brackets.</p>



<a name="260871783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260871783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260871783">(Nov 09 2021 at 22:30)</a>:</h4>
<p>Also as you can see, where in mathlib we would know to use <code>[add_comm_group M]</code> when <code>R</code> is a ring, the fancy brackets only insert <code>add_comm_monoid</code>.</p>



<a name="260872328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260872328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260872328">(Nov 09 2021 at 22:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/260871644">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> Having <code>[[...]]</code> notation for auto-inserting all missing dependencies in binders would be great, too, if that could work, though it doesn't solve <code>vector_space</code>, I think.  There could be an attribute for classes (<code>abbreviation_class</code>?) that directs this feature to try to eliminate the class completely. For example</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[abbreviation_class]</span>
<span class="kd">def</span> <span class="n">vector_space</span> <span class="o">(</span><span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">V</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">K</span> <span class="n">V</span><span class="o">]</span>
</code></pre></div>
<p>could define how <code>`[[vector_space K V]]</code> is replaced, though this might be confusing if you forget the double square brackets.</p>
</blockquote>
<p>Good idea to control the dependencies through an attribute. Maybe we could also setup something like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">module</span> <span class="o">(</span><span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">...</span>

<span class="kd">@[dependency (field K) (add_comm_group V)]</span>
<span class="kd">abbreviation</span> <span class="n">vector_space</span> <span class="o">(</span><span class="n">K</span> <span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">V</span><span class="o">]</span> <span class="o">:=</span> <span class="n">module</span> <span class="n">K</span> <span class="n">V</span>
<span class="c1">-- Don't specialize the typeclass arguments themselves!</span>
</code></pre></div>



<a name="260872508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260872508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260872508">(Nov 09 2021 at 22:36)</a>:</h4>
<p>this would be super cool!</p>



<a name="260872569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260872569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260872569">(Nov 09 2021 at 22:37)</a>:</h4>
<p>I assume this is then meant for teaching and not mathlib?</p>



<a name="260872667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260872667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260872667">(Nov 09 2021 at 22:38)</a>:</h4>
<p>I feel like it could be huge for mathlib if you could type more maths-friendly things far more often instead of the typeclass hell you see in things like the statement of FTC</p>



<a name="260873351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260873351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260873351">(Nov 09 2021 at 22:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/260870698">said</a>:</p>
<blockquote>
<p>I have a patch for Lean lying around somewhere that allows you to write <code>[ring R] [[algebra R A]] [[module R M]]</code>, and adds all the missing typeclass dependencies, e.g. <code>[ring R] [semiring A] [algebra R A] [add_comm_monoid M] [module R M]</code>. However, adding more locals broke the elaborator terribly and I couldn't figure out a good way to proceed.</p>
</blockquote>
<p>Looking at it again, the precise diagnosis involves <a href="https://github.com/leanprover-community/lean/blob/implicit-dep-binder/src/frontends/lean/definition_cmds.cpp#L796">lines 796-801 of <code>definition_cmds.cpp</code></a>:</p>
<div class="codehilite" data-code-language="C++"><pre><span></span><code><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">recover_from_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">m_error_recovery</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">elaborator</span><span class="w"> </span><span class="nf">elab</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">get_options</span><span class="p">(),</span><span class="w"> </span><span class="n">resolve_decl_name</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">fn</span><span class="p">),</span><span class="w"> </span><span class="n">metavar_context</span><span class="p">(),</span><span class="w"> </span><span class="n">local_context</span><span class="p">(),</span><span class="w"> </span><span class="n">recover_from_errors</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buffer</span><span class="o">&lt;</span><span class="n">expr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">new_params</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">elaborate_params</span><span class="p">(</span><span class="n">elab</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">new_params</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">elab</span><span class="p">.</span><span class="n">freeze_local_instances</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">replace_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">new_params</span><span class="p">,</span><span class="w"> </span><span class="n">fn</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>In <code>elaborate_params</code> I added the code to add dependencies for instance arguments, however <code>replace_params</code> can't tell at which points new params were inserted, so it (correctly) trips an error. So a solution would probably start with passing a list of added/deleted indices to <code>replace_params</code>.</p>



<a name="260873723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260873723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260873723">(Nov 09 2021 at 22:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/260872667">said</a>:</p>
<blockquote>
<p>I feel like it could be huge for mathlib if you could type more maths-friendly things far more often instead of the typeclass hell you see in things like the statement of FTC</p>
</blockquote>
<p>Yeah but also the modularity is crucial. During the convexity refacotr, I literally turned a single concrete type <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">R</mi></mrow><annotation encoding="application/x-tex">\R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em;"></span><span class="mord mathbb">R</span></span></span></span> into around 15 shades of spaces.</p>



<a name="260874193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260874193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260874193">(Nov 09 2021 at 22:52)</a>:</h4>
<p>In support of modularity, it can protect code from changes to the algebra hierarchy, since things about a <code>vector_space</code> don't care too much about exactly which intermediate algebraic objects you also need to include.  (And there are in fact theorems about vector spaces, I believe. <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span>)</p>



<a name="260878777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260878777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260878777">(Nov 09 2021 at 23:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/113488-general/topic/Undergraduate.20math.20list.20.28algebras.29/near/260873351">said</a>:</p>
<blockquote>
<p>So a solution would probably start with passing a list of added/deleted indices to <code>replace_params</code>.</p>
</blockquote>
<p>This seems to work, almost! Now the only issue is that we detect the list of missing instances by checking which errors result from elaborating the implicit+deps binder, but the errors seem to bubble up to the surface too(?)</p>



<a name="260883160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260883160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260883160">(Nov 10 2021 at 00:22)</a>:</h4>
<p>Now we ignore the "missing instance" errors. What do you all think, is this addition PR-worthy? <a href="https://github.com/leanprover-community/lean/compare/implicit-dep-binder">https://github.com/leanprover-community/lean/compare/implicit-dep-binder</a></p>



<a name="260883609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Undergraduate%20math%20list%20%28algebras%29/near/260883609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Undergraduate.20math.20list.20(algebras).html#260883609">(Nov 10 2021 at 00:27)</a>:</h4>
<p>What do the lean4 people think of this in lean4? Not sure who to @</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>