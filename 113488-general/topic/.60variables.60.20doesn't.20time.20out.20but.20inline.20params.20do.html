---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html">`variables` doesn't time out but inline params do</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="254523746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254523746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254523746">(Sep 23 2021 at 12:10)</a>:</h4>
<p>I'm mildly annoyed that <code>bar</code> and <code>baz</code> time out, but I can fix it. What really surprises me is that the <code>variables</code> statement and <code>foo</code> elaborate quickly.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.separable</span>

<span class="c1">-- Works quickly</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span>

<span class="c1">-- Works quickly</span>
<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">âˆ§</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">L</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="c1">-- some expression involving `K` and `L`, in order to include the typeclass params</span>
<span class="gr">sorry</span>

<span class="c1">-- Times out</span>
<span class="kd">lemma</span> <span class="n">bar</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="c1">-- Times out</span>
<span class="kd">lemma</span> <span class="n">baz</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="254523990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254523990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254523990">(Sep 23 2021 at 12:12)</a>:</h4>
<p>Aha, it's probably the universe metavariables that cause the timeout:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Works quickly</span>
<span class="kd">lemma</span> <span class="n">bar'</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="c1">-- Works quickly</span>
<span class="kd">lemma</span> <span class="n">baz'</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
<span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="254524821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254524821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254524821">(Sep 23 2021 at 12:19)</a>:</h4>
<p>Even more puzzling: if I fill in some of the params, I get a timeout again:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Times out</span>
<span class="kd">lemma</span> <span class="n">qux</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">_inist_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">(</span><span class="n">fraction_ring.field</span><span class="o">)</span> <span class="n">_inst_2</span> <span class="n">_</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="254530718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254530718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254530718">(Sep 23 2021 at 13:01)</a>:</h4>
<p>Again that seems to be a universe issue:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Times out</span>
<span class="kd">lemma</span> <span class="n">qux</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">_inist_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.field</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inist_1</span><span class="o">))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inist_1</span><span class="o">)))</span> <span class="n">_inst_2</span> <span class="n">_inst_4</span> <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="c1">-- Works quickly</span>
<span class="kd">lemma</span> <span class="n">qux'</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">_inist_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.field.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
      <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inist_1</span><span class="o">))))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inist_1</span><span class="o">)))</span> <span class="n">_inst_2</span> <span class="n">_inst_4</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="254531969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254531969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254531969">(Sep 23 2021 at 13:09)</a>:</h4>
<p>Minimal example, where removing one universe annotation will break:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Works quickly</span>
<span class="kd">lemma</span> <span class="n">qux'</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="n">_</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.field.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">K</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="254533682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254533682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254533682">(Sep 23 2021 at 13:21)</a>:</h4>
<p>The moment I saw the first example I guessed it would be a universe issue, but I didn't expect the second one.</p>



<a name="254536034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254536034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254536034">(Sep 23 2021 at 13:36)</a>:</h4>
<p>That's so strange, how could Lean ever have trouble filling in any universe variables here?<br>
Could it be that there are some unexpected universe variables (e.g. <code>max u u</code>) appearing in some of the relevant definitions?</p>



<a name="254536460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254536460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254536460">(Sep 23 2021 at 13:39)</a>:</h4>
<p>Like if <code>fraction_ring.field.{u}</code> expects a <code>integral_domain.{max u u}</code> instance, but Lean already wants to put <code>integral_domain.{u}</code> there, it might never figure out how to instantiate the universe variables of <code>fraction_ring.field</code>, and try doing other things instead</p>



<a name="254542400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254542400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254542400">(Sep 23 2021 at 14:17)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- quick</span>
<span class="kd">lemma</span> <span class="n">qux</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="n">_</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.field.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">K</span> <span class="n">_</span><span class="o">))</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="c1">-- very very slow</span>
<span class="kd">lemma</span> <span class="n">qux'</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">_inst_1</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">_inst_4</span> <span class="o">:</span> <span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="n">_</span> <span class="n">L</span> <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.field.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring</span> <span class="n">K</span> <span class="n">_</span><span class="o">))</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>
<p>I tried to fill in the instance of <code>semiring K</code> and there's even a problem there without the explicit universe annotation.</p>



<a name="254749704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254749704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254749704">(Sep 24 2021 at 18:23)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.separable</span>

<span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="c1">-- fast</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="c1">-- fast</span>

<span class="c1">-- fast</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="c1">-- fast</span>

<span class="c1">-- slow and I can't fix it with universe ascriptions</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">(</span><span class="n">fraction_ring.field</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="c1">-- slow</span>
</code></pre></div>



<a name="254749965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254749965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254749965">(Sep 24 2021 at 18:25)</a>:</h4>
<p><del><code>set_option profiler true</code> incorrectly reports that the slow example is fast :-) </del> If I replace <code>example</code> with <code>def moo</code> I see <code>elaboration of moo took 44.3s</code></p>



<a name="254751156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254751156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254751156">(Sep 24 2021 at 18:33)</a>:</h4>
<p>The below doesn't help but I'm not sure it explains 44 seconds (it is quite funny though)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span>  <span class="kd">class</span><span class="bp">-</span><span class="kd">instance</span> <span class="n">resolution</span> <span class="n">trace</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">matrix.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_0</span> <span class="bp">?</span><span class="n">u_1</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_1</span> <span class="bp">?</span><span class="n">x_2</span> <span class="bp">?</span><span class="n">x_3</span> <span class="bp">?</span><span class="n">x_4</span> <span class="bp">?</span><span class="n">x_5</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">restrict_scalars.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_2</span> <span class="bp">?</span><span class="n">u_3</span> <span class="bp">?</span><span class="n">u_4</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_6</span> <span class="bp">?</span><span class="n">x_7</span> <span class="bp">?</span><span class="n">x_8</span> <span class="bp">?</span><span class="n">x_9</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_10.semiring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_16.to_semiring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">submodule.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_8</span> <span class="bp">?</span><span class="n">u_9</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_17</span> <span class="bp">?</span><span class="n">x_18</span> <span class="bp">?</span><span class="n">x_19</span> <span class="bp">?</span><span class="n">x_20</span> <span class="bp">?</span><span class="n">x_21</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">polynomial.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_10</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_22</span> <span class="bp">?</span><span class="n">x_23</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_monoid_algebra.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_11</span> <span class="bp">?</span><span class="n">u_12</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_24</span> <span class="bp">?</span><span class="n">x_25</span> <span class="bp">?</span><span class="n">x_26</span> <span class="bp">?</span><span class="n">x_27</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">monoid_algebra.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_13</span> <span class="bp">?</span><span class="n">u_14</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_28</span> <span class="bp">?</span><span class="n">x_29</span> <span class="bp">?</span><span class="n">x_30</span> <span class="bp">?</span><span class="n">x_31</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_map.endomorphism_semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_15</span> <span class="bp">?</span><span class="n">u_16</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_32</span> <span class="bp">?</span><span class="n">x_33</span> <span class="bp">?</span><span class="n">x_34</span> <span class="bp">?</span><span class="n">x_35</span> <span class="bp">?</span><span class="n">x_36</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_39.to_semiring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_18</span> <span class="bp">?</span><span class="n">u_19</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_40</span> <span class="bp">?</span><span class="n">x_41</span> <span class="bp">?</span><span class="n">x_42</span> <span class="bp">?</span><span class="n">x_43</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">set.set_semiring.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_20</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_44</span> <span class="bp">?</span><span class="n">x_45</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_21</span> <span class="bp">?</span><span class="n">u_22</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_46</span> <span class="bp">?</span><span class="n">x_47</span> <span class="bp">?</span><span class="n">x_48</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_monoid.End.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_23</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_49</span> <span class="bp">?</span><span class="n">x_50</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">rat.semiring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">int.semiring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">nat.semiring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">opposite.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_24</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_51</span> <span class="bp">?</span><span class="n">x_52</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">with_zero.semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_25</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_53</span> <span class="bp">?</span><span class="n">x_54</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_0</span> <span class="o">:</span> <span class="n">semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_26</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_55</span> <span class="bp">?</span><span class="n">x_56</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">matrix.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_27</span> <span class="bp">?</span><span class="n">u_28</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_57</span> <span class="bp">?</span><span class="n">x_58</span> <span class="bp">?</span><span class="n">x_59</span> <span class="bp">?</span><span class="n">x_60</span> <span class="bp">?</span><span class="n">x_61</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">restrict_scalars.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_29</span> <span class="bp">?</span><span class="n">u_30</span> <span class="bp">?</span><span class="n">u_31</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_62</span> <span class="bp">?</span><span class="n">x_63</span> <span class="bp">?</span><span class="n">x_64</span> <span class="bp">?</span><span class="n">x_65</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_66.ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_72.to_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">polynomial.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_35</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_73</span> <span class="bp">?</span><span class="n">x_74</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_monoid_algebra.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_36</span> <span class="bp">?</span><span class="n">u_37</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_75</span> <span class="bp">?</span><span class="n">x_76</span> <span class="bp">?</span><span class="n">x_77</span> <span class="bp">?</span><span class="n">x_78</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">monoid_algebra.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_38</span> <span class="bp">?</span><span class="n">u_39</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_79</span> <span class="bp">?</span><span class="n">x_80</span> <span class="bp">?</span><span class="n">x_81</span> <span class="bp">?</span><span class="n">x_82</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_map.endomorphism_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_40</span> <span class="bp">?</span><span class="n">u_41</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_83</span> <span class="bp">?</span><span class="n">x_84</span> <span class="bp">?</span><span class="n">x_85</span> <span class="bp">?</span><span class="n">x_86</span> <span class="bp">?</span><span class="n">x_87</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_90.to_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">prod.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_43</span> <span class="bp">?</span><span class="n">u_44</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_91</span> <span class="bp">?</span><span class="n">x_92</span> <span class="bp">?</span><span class="n">x_93</span> <span class="bp">?</span><span class="n">x_94</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">pi.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_45</span> <span class="bp">?</span><span class="n">u_46</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_95</span> <span class="bp">?</span><span class="n">x_96</span> <span class="bp">?</span><span class="n">x_97</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">add_monoid.End.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_47</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_98</span> <span class="bp">?</span><span class="n">x_99</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">int.ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">opposite.ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_48</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_100</span> <span class="bp">?</span><span class="n">x_101</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">nonneg_ring.to_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_49</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_102</span> <span class="bp">?</span><span class="n">x_103</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_103</span> <span class="o">:</span> <span class="n">nonneg_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_nonneg_ring.to_nonneg_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_50</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_104</span> <span class="bp">?</span><span class="n">x_105</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">nonneg_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">ordered_ring.to_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_27</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_57</span> <span class="bp">?</span><span class="n">x_58</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_64.to_ordered_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_67.to_ordered_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">rat.ordered_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_ring.to_ordered_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_31</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_68</span> <span class="bp">?</span><span class="n">x_69</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_69</span> <span class="o">:</span> <span class="n">linear_ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_75.to_linear_ordered_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_69</span> <span class="o">:</span> <span class="n">linear_ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_78.to_linear_ordered_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_69</span> <span class="o">:</span> <span class="n">linear_ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">rat.linear_ordered_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_69</span> <span class="o">:</span> <span class="n">linear_ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_comm_ring.to_linear_ordered_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_35</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_79</span> <span class="bp">?</span><span class="n">x_80</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_80</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_86.to_linear_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_80</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_89.to_linear_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_80</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">rat.linear_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_80</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">int.linear_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_80</span> <span class="o">:</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_field.to_linear_ordered_comm_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_39</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_90</span> <span class="bp">?</span><span class="n">x_91</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_91</span> <span class="o">:</span> <span class="n">linear_ordered_field.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">rat.linear_ordered_field</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">linear_ordered_field.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">linear_ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">ordered_comm_ring.to_ordered_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_28</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_59</span> <span class="bp">?</span><span class="n">x_60</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_60</span> <span class="o">:</span> <span class="n">ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_66.to_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_60</span> <span class="o">:</span> <span class="n">ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">x_69.to_ordered_comm_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_60</span> <span class="o">:</span> <span class="n">ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">linear_ordered_comm_ring.to_ordered_comm_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_32</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_70</span> <span class="bp">?</span><span class="n">x_71</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">cached</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">linear_ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">ordered_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="n">failure</span> <span class="n">for</span> <span class="n">ordered_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_56</span> <span class="o">:</span> <span class="n">ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_27</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_57</span> <span class="bp">?</span><span class="n">x_58</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">rat.division_ring</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">opposite.division_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_28</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_59</span> <span class="bp">?</span><span class="n">x_60</span>
<span class="n">failed</span> <span class="n">is_def_eq</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_58</span> <span class="o">:</span> <span class="n">division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="bp">?</span><span class="n">u_29</span><span class="o">}</span> <span class="bp">?</span><span class="n">x_61</span> <span class="bp">?</span><span class="n">x_62</span>
<span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="bp">?</span><span class="n">x_62</span> <span class="o">:</span> <span class="n">field.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">_inst_2</span>
</code></pre></div>



<a name="254751793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254751793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254751793">(Sep 24 2021 at 18:37)</a>:</h4>
<p>Wow, the proof that typeclass inference finds that the field of fractions is a <code>comm_semiring</code> goes via the proof that <code>K</code> is a comm_ring which goes via the proof that it's a Euclidean domain!</p>



<a name="254752061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254752061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254752061">(Sep 24 2021 at 18:39)</a>:</h4>
<p>Lean's cached proof that the field of fractions of K[X] is a commutative semiring is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">class_instances</span><span class="o">]</span> <span class="n">caching</span> <span class="kd">instance</span> <span class="n">for</span> <span class="n">comm_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">)))</span>
<span class="bp">@</span><span class="n">comm_ring.to_comm_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">)))</span>
  <span class="o">(</span><span class="bp">@</span><span class="n">localization.comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_euclidean_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">)))</span>
     <span class="o">(</span><span class="bp">@</span><span class="n">non_zero_divisors.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
        <span class="o">(</span><span class="bp">@</span><span class="n">semiring.to_monoid_with_zero.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
           <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
                 <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
              <span class="o">(</span><span class="bp">@</span><span class="n">domain.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
                 <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
                    <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
                 <span class="o">(</span><span class="bp">@</span><span class="n">integral_domain.to_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span>
                    <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span>
                       <span class="o">(</span><span class="bp">@</span><span class="n">ring.to_semiring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">division_ring.to_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_division_ring.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))</span>
                    <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_integral_domain.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">K</span> <span class="n">_inst_1</span><span class="o">))))))))</span>
</code></pre></div>



<a name="254753976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/254753976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#254753976">(Sep 24 2021 at 18:52)</a>:</h4>
<p>The following seems fine:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">field_theory.separable</span>

<span class="c1">-- Works quickly</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">K</span> <span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span>

<span class="c1">-- Fast</span>
<span class="kd">lemma</span> <span class="n">bar</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="c1">-- Fast</span>
<span class="kd">lemma</span> <span class="n">baz</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span> <span class="o">:=</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="255019148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/255019148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#255019148">(Sep 27 2021 at 09:34)</a>:</h4>
<p>I looked into <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>'s suggestion of simplifying the proof that <code>K(x)</code> is a <code>comm_semiring</code>: to define <code>is_separable</code> and <code>fraction_ring</code> we don't actually need to assume they are fields resp. integral domain, just to prove stuff with them. Now my statement elaborates quickly enough, but typeclass search is still too slow:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Timed out after fixing the above timeout</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">field</span> <span class="n">L</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">is_separable</span> <span class="o">(</span><span class="n">fraction_ring</span> <span class="o">(</span><span class="n">polynomial</span> <span class="n">K</span><span class="o">))</span> <span class="n">L</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">localization.comm_ring</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.comm_ring</span> <span class="n">K</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">_</span> <span class="o">:=</span>
<span class="c1">-- by apply_instance -- Should fail due to missing instance, actually times out when trying the following instance:</span>
<span class="n">is_separable.of_finite</span> <span class="n">_</span> <span class="n">_</span> <span class="c1">-- Should fail due to missing `char_zero` assumption, actually times out.</span>
</code></pre></div>



<a name="255019356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/255019356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#255019356">(Sep 27 2021 at 09:36)</a>:</h4>
<p>(We really just shifted a really slow defeq of <code>[type_context.is_def_eq_detail] [2]: localization.comm_ring =?= euclidean_domain.to_comm_ring ?m_1</code> from the statement to the proof.)</p>



<a name="255026210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/255026210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#255026210">(Sep 27 2021 at 10:38)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- The cause of the above timeouts seems to be the following unification problem.</span>
<span class="c1">-- The implicits are carefully set up, if some of them get inferred, this just works.</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">localization.comm_ring</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">polynomial.comm_ring</span> <span class="n">K</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="bp">=</span>
    <span class="bp">@</span><span class="n">euclidean_domain.to_comm_ring</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">field.to_euclidean_domain</span> <span class="n">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">fraction_ring.field</span> <span class="n">_</span> <span class="n">_</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">rfl</span>
</code></pre></div>



<a name="255026984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/255026984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#255026984">(Sep 27 2021 at 10:46)</a>:</h4>
<p>Looking at the defeq trace, there's a few instances where an <code>auto_param</code> like <code>sub</code> or <code>gsmul</code> causes <code>@polynomial K (typeclass_a.to_comm_semiring)</code> to be unified with <code>@polynomial K (typeclass_b.to_comm_semiring)</code>, so we're basically exponential in the number of auto_param fields. Let me see if making irreducible defs for those helps...</p>



<a name="255031954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/255031954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#255031954">(Sep 27 2021 at 11:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238446">Anne Baanen</span> <a href="#narrow/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do/near/255026984">said</a>:</p>
<blockquote>
<p>Looking at the defeq trace, there's a few instances where an <code>auto_param</code> like <code>sub</code> or <code>gsmul</code> causes <code>@polynomial K (typeclass_a.to_comm_semiring)</code> to be unified with <code>@polynomial K (typeclass_b.to_comm_semiring)</code>, so we're basically exponential in the number of auto_param fields. Let me see if making irreducible defs for those helps...</p>
</blockquote>
<p>That seems to help about 10%, unfortunately: elaboration went from 40 seconds to 35 seconds.</p>



<a name="255074430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60variables%60%20doesn%27t%20time%20out%20but%20inline%20params%20do/near/255074430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60variables.60.20doesn't.20time.20out.20but.20inline.20params.20do.html#255074430">(Sep 27 2021 at 16:06)</a>:</h4>
<p>Still getting somewhat slow elaboration on the full test case, however <a href="https://github.com/leanprover-community/mathlib/issues/9414">#9414</a> and <a href="https://github.com/leanprover-community/mathlib/issues/9415">#9415</a> turn the timeout into just unbearably slow elaboration. (And a timeout later on in my actual usage.)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>