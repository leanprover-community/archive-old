---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/.60ring.60.20behaviour.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html">`ring` behaviour</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="213367734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213367734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213367734">(Oct 15 2020 at 00:36)</a>:</h4>
<p>Something about the interaction between casting and <code>ring</code> is different between <code>ℂ</code> and <code>ℝ</code>.  Why is this?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.complex.basic</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">--fails</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="bp">↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">--works (EDIT: actually, doesn't work)</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">--works</span>
</code></pre></div>

<p>Whatever is going on, it's not an issue for <code>abel</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">abel</span> <span class="c1">--works</span>
</code></pre></div>



<a name="213367849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213367849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213367849">(Oct 15 2020 at 00:39)</a>:</h4>
<p>What happens with an arbitrary field?</p>



<a name="213368027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368027">(Oct 15 2020 at 00:41)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">algebra</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="bp">↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>  <span class="c1">-- works</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>  <span class="c1">-- fail</span>
</code></pre></div>



<a name="213368030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368030">(Oct 15 2020 at 00:41)</a>:</h4>
<p>strange.</p>



<a name="213368154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368154">(Oct 15 2020 at 00:43)</a>:</h4>
<p>The following works.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>
</code></pre></div>



<a name="213368166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368166">(Oct 15 2020 at 00:43)</a>:</h4>
<p>The good news is <code>field_simp</code>works for both</p>



<a name="213368172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368172">(Oct 15 2020 at 00:43)</a>:</h4>
<p>Apparently Lean is interpreting <code>2</code> as something other than <code>ℂ</code>. Then <code>ring</code> not working makes sense, as I don't expect <code>ring</code> to do casts.</p>



<a name="213368214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368214">(Oct 15 2020 at 00:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="298376">Pedro Minicz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213368154">said</a>:</p>
<blockquote>
<p>The following works.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>
</code></pre></div>

</blockquote>
<p>Oops, that is wrong.</p>



<a name="213368220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368220">(Oct 15 2020 at 00:44)</a>:</h4>
<p>What actually works is this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">has_one.one</span><span class="o">,</span>
  <span class="c1">--unfold has_one.one monoid.one ring.one comm_ring.one,</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="213368228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368228">(Oct 15 2020 at 00:44)</a>:</h4>
<p>I just assume <code>ring</code> would work without the <code>unfold</code>s, my bad.</p>



<a name="213368254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368254">(Oct 15 2020 at 00:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="298376">Pedro Minicz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213368172">said</a>:</p>
<blockquote>
<p>Apparently Lean is interpreting <code>2</code> as something other than <code>ℂ</code>. Then <code>ring</code> not working makes sense, as I don't expect <code>ring</code> to do casts.</p>
</blockquote>
<p>But then why does it work for <code>ℝ</code>?  Because <code>2</code> presumably gets cast (here to a real number) from a natural number in that case, too.</p>



<a name="213368274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368274">(Oct 15 2020 at 00:45)</a>:</h4>
<p>You can see what Lean thinks the <code>2</code> is if you add <code>set_option pp.numerals false</code> and <code>set_option pp.implicit true</code>.</p>



<a name="213368339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368339">(Oct 15 2020 at 00:46)</a>:</h4>
<p>What is <code>bit0</code>?</p>



<a name="213368388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368388">(Oct 15 2020 at 00:47)</a>:</h4>
<p>Basically "times two."</p>



<a name="213368448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368448">(Oct 15 2020 at 00:48)</a>:</h4>
<p>okay, so <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> is defined as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1 + 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> is the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> in the ring.</p>



<a name="213368455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368455">(Oct 15 2020 at 00:48)</a>:</h4>
<p><code>bit0 has_one.one</code> is <code>2</code> or, in binary, <code>10</code>.</p>



<a name="213368463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368463">(Oct 15 2020 at 00:48)</a>:</h4>
<p>And <code>coe 2</code> is the coercion from nat.</p>



<a name="213368632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368632">(Oct 15 2020 at 00:51)</a>:</h4>
<p>But so why is it different between <code>ℂ</code> and <code>ℝ</code>?</p>



<a name="213368677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368677">(Oct 15 2020 at 00:52)</a>:</h4>
<p>There must be a better way of doing this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">has_one.one</span> <span class="n">monoid.one</span> <span class="n">ring.one</span> <span class="n">comm_ring.one</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">coe</span> <span class="n">lift_t</span> <span class="n">has_lift_t.lift</span> <span class="n">coe_t</span> <span class="n">has_coe_t.coe</span> <span class="n">coe_b</span> <span class="n">has_coe.coe</span><span class="o">,</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>

<p>It is interpreting <code>2</code> as a complex number as it should, it seems.</p>



<a name="213368693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368693">(Oct 15 2020 at 00:52)</a>:</h4>
<p>Weird, I don't know exactly how unfolding expressions works withing tactics, but maybe <code>ring</code> is will equipped to deal with so many?</p>



<a name="213368702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368702">(Oct 15 2020 at 00:53)</a>:</h4>
<p>You noticed that this works?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="bp">↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">--works</span>
</code></pre></div>



<a name="213368714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368714">(Oct 15 2020 at 00:53)</a>:</h4>
<p>Lean is getting stuck for me on that example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.complex.basic</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="bp">↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">-- orange bar is stuck, Lean never returns</span>
</code></pre></div>

<p>I think I'm using the most recent version of Lean + mathlib?</p>



<a name="213368729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368729">(Oct 15 2020 at 00:53)</a>:</h4>
<p>Oh, it finally errored with <code>(deterministic) timeout</code>.</p>



<a name="213368785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368785">(Oct 15 2020 at 00:54)</a>:</h4>
<p>Oh interesting, you're right, it just took a while to load and I assumed it worked :)</p>



<a name="213368818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368818">(Oct 15 2020 at 00:55)</a>:</h4>
<p>Maybe there is some <code>coe</code> loop between types which is making <code>ring</code> and get stuck somehow?</p>



<a name="213368820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368820">(Oct 15 2020 at 00:55)</a>:</h4>
<p>Well, also, like I said, this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">abel</span> <span class="c1">--works</span>
</code></pre></div>



<a name="213368825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368825">(Oct 15 2020 at 00:55)</a>:</h4>
<p>Also <code>simp</code> just works.</p>



<a name="213368877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368877">(Oct 15 2020 at 00:56)</a>:</h4>
<p>I had the impression that <code>ring</code> was more-or-less a call to <code>simp</code> with a certain collection of lemmas.</p>



<a name="213368903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368903">(Oct 15 2020 at 00:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213368877">said</a>:</p>
<blockquote>
<p>I had the impression that <code>ring</code> was more-or-less a call to <code>simp</code> with a certain collection of lemmas.</p>
</blockquote>
<p>I think <code>abel</code> is like this, but my impression is that <code>ring</code> is more complicated (it normalizes to deal with commutativity, which I don't see how <code>simp</code> could do).</p>



<a name="213368932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368932">(Oct 15 2020 at 00:57)</a>:</h4>
<p>I thought <code>abel</code> was built on top of <code>ring</code> or vice-versa.</p>



<a name="213368969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213368969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213368969">(Oct 15 2020 at 00:57)</a>:</h4>
<p>Yeah simp can't handle commutativity because it would loop.</p>



<a name="213369039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369039">(Oct 15 2020 at 00:58)</a>:</h4>
<p>Let's just define </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">ring'</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span> <span class="n">simp</span> <span class="bp">&lt;|&gt;</span> <span class="n">ring</span> <span class="o">]</span>
</code></pre></div>

<p>and call it a day :)</p>



<a name="213369124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369124">(Oct 15 2020 at 00:59)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.complex.basic</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">ring'</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span> <span class="n">simp</span> <span class="bp">&lt;|&gt;</span> <span class="n">ring</span> <span class="o">]</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring'</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring'</span>
</code></pre></div>



<a name="213369324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369324">(Oct 15 2020 at 01:01)</a>:</h4>
<p>This is very funny, but I'm still curious about why there's a difference :)</p>



<a name="213369328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369328">(Oct 15 2020 at 01:01)</a>:</h4>
<p>But why doesn't ring just call <code>simp</code> before it does it's magic?!</p>



<a name="213369356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369356">(Oct 15 2020 at 01:02)</a>:</h4>
<p>Yeah it's really strange I agree</p>



<a name="213369392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369392">(Oct 15 2020 at 01:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213369328">said</a>:</p>
<blockquote>
<p>But why doesn't ring just call <code>simp</code> before it does it's magic?!</p>
</blockquote>
<p>I guess this would count as a nonterminal simp?</p>



<a name="213369399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369399">(Oct 15 2020 at 01:02)</a>:</h4>
<p>I had the impression that writing <code>(2 : R)</code> where <code>R</code> was a ring was defeq to the coercion from nat.</p>



<a name="213369411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369411">(Oct 15 2020 at 01:03)</a>:</h4>
<p>Yeah, you'd sure think so!</p>



<a name="213369648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369648">(Oct 15 2020 at 01:07)</a>:</h4>
<p>I guess this would work too</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">def</span> <span class="n">ring'</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span> <span class="n">abel</span> <span class="bp">&lt;|&gt;</span> <span class="n">ring</span> <span class="o">]</span>
</code></pre></div>

<p>without the terminal simp, and it actually makes sense to try the "abelian group" tactic before the "ring" tactic.</p>



<a name="213369854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369854">(Oct 15 2020 at 01:10)</a>:</h4>
<p>By the way, if you replace division with multiplication then <code>ring</code> works fine.</p>



<a name="213369887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369887">(Oct 15 2020 at 01:11)</a>:</h4>
<p>Yes, I noticed, it's very odd.</p>



<a name="213369954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213369954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213369954">(Oct 15 2020 at 01:12)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.complex.basic</span>

<span class="kd">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="o">:=</span> <span class="mi">2</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">x</span><span class="bp">/</span><span class="n">foo</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">/</span><span class="n">foo</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>
</code></pre></div>

<p>WAT?!</p>



<a name="213370016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213370016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213370016">(Oct 15 2020 at 01:13)</a>:</h4>
<p>Okay, I really have no clue what's happening now.</p>



<a name="213371032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213371032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213371032">(Oct 15 2020 at 01:33)</a>:</h4>
<p>I don't know enough about the internals of <code>ring</code> to say more, but maybe this is progress:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.complex.basic</span>
<span class="kd">set_option</span> <span class="n">trace.simplify.rewrite</span> <span class="n">true</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">-- simp doesn't seem to be called</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">-- simp gives up after 8 rewrites</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="bp">/↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">try_for</span> <span class="mi">4000</span> <span class="o">{</span> <span class="n">ring</span> <span class="o">}</span> <span class="c1">-- the simp output loops after a while</span>
</code></pre></div>



<a name="213380713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213380713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213380713">(Oct 15 2020 at 05:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213368877">said</a>:</p>
<blockquote>
<p>I had the impression that <code>ring</code> was more-or-less a call to <code>simp</code> with a certain collection of lemmas.</p>
</blockquote>
<p>Nope, <code>ring</code> lifts the identity it wants to prove to a polynomial expression. (So in this case to the polynomial ring over <code>\C</code> with variables <code>x</code> and <code>y</code>.) After that, it puts the polynomials into (some) normal form, and checks whether they are equal. (This depends on an order on the variables, which it chooses itself.)</p>



<a name="213381479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213381479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213381479">(Oct 15 2020 at 05:20)</a>:</h4>
<p><code>ring</code> does not use <code>simp</code> at all. Both it and <code>abel</code> are from scratch tactics, although <code>abel</code> uses <code>ring</code> as a subroutine and <code>ring</code> uses <code>norm_num</code> (the internal parts of it, not the user facing version that uses <code>simp</code>)</p>



<a name="213381548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213381548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213381548">(Oct 15 2020 at 05:22)</a>:</h4>
<p>Oh, but to complicate matters, <code>ring</code> has a fallback that is basically <code>simp</code> with a specific simp set, which is only called if the main <code>ring</code> routine fails. The purpose is to clean up the polynomial identity to see why it didn't work, although sometimes people just use it as "nonterminal <code>ring</code>"</p>



<a name="213381560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213381560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213381560">(Oct 15 2020 at 05:23)</a>:</h4>
<p>You can use <code>ring1</code> if you don't want the nonterminal ring cleanup behavior on failure</p>



<a name="213381618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213381618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213381618">(Oct 15 2020 at 05:24)</a>:</h4>
<p><code>ring1</code> gives a nice and clear error message here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="bp">/↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring1</span>
<span class="c1">-- tactic.mk_instance failed to generate instance for</span>
<span class="c1">--   ordered_semiring ℂ</span>
</code></pre></div>



<a name="213381639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213381639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213381639">(Oct 15 2020 at 05:25)</a>:</h4>
<p>Why does ring care about ordered semirings you ask? ...good question</p>



<a name="213381929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213381929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213381929">(Oct 15 2020 at 05:34)</a>:</h4>
<p>Ah, the <code>x/foo</code> example isn't as mysterious as you might think. It is reduced to <code>x - x * foo⁻¹ + x * foo⁻¹ = x</code>, which is in fact a polynomial identity</p>



<a name="213382134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382134">(Oct 15 2020 at 05:40)</a>:</h4>
<p>Do numerals work differently in ordered semirings somehow?</p>



<a name="213382176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382176">(Oct 15 2020 at 05:40)</a>:</h4>
<p>IIRC this is all about whether ring can figure out if 2 is not zero. If the ring is an ordered semiring then 2 is definitely not zero</p>



<a name="213382192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382192">(Oct 15 2020 at 05:40)</a>:</h4>
<p><code>char_zero</code> looks like a better class.</p>



<a name="213382198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382198">(Oct 15 2020 at 05:41)</a>:</h4>
<p>But it's not ring's job to go running around trying to verify that denominators are nonzero, that's field stuff. I don't think we had char_zero when ring was written</p>



<a name="213382210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382210">(Oct 15 2020 at 05:41)</a>:</h4>
<p><code>char_zero</code> has been around forever, I think.</p>



<a name="213382218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382218">(Oct 15 2020 at 05:41)</a>:</h4>
<p><code>char_p</code> is it's younger brother</p>



<a name="213382219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382219">(Oct 15 2020 at 05:41)</a>:</h4>
<p>But I think I remember from a discussion long ago that this was why ring cared about ordered fields</p>



<a name="213382293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382293">(Oct 15 2020 at 05:43)</a>:</h4>
<p>I'm pretty sure this is due to <code>norm_num</code> in some way</p>



<a name="213382335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382335">(Oct 15 2020 at 05:44)</a>:</h4>
<p>still tracing through it</p>



<a name="213382341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382341">(Oct 15 2020 at 05:44)</a>:</h4>
<p>If this surprising behavior doesn't end up being a bug somewhere then we should probably mention something about ordered semirings or whatnot in the tactic doc entry or docstring.</p>



<a name="213382356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382356">(Oct 15 2020 at 05:44)</a>:</h4>
<p><code>norm_num</code> actually has several modules for proving inequalities of numerals, one of which works on <code>char_zero</code></p>



<a name="213382951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213382951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213382951">(Oct 15 2020 at 06:00)</a>:</h4>
<p>I narrowed it down to this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">run_cmd</span> <span class="k">do</span>
  <span class="n">ic</span> <span class="bp">←</span> <span class="n">mk_instance_cache</span> <span class="bp">`</span><span class="o">(</span><span class="n">ℂ</span><span class="o">),</span>
  <span class="n">norm_num.prove_ne_zero</span> <span class="n">ic</span> <span class="bp">`</span><span class="o">(</span><span class="mi">2</span><span class="o">:</span><span class="n">ℂ</span><span class="o">)</span>
</code></pre></div>

<p>The implementation makes it clear where we've gone wrong:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Given `a` a rational numeral, returns `⊢ a ≠ 0`. -/</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">prove_ne_zero</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">instance_cache</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">instance_cache</span> <span class="bp">×</span> <span class="n">expr</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">a</span> <span class="o">:=</span>
  <span class="k">match</span> <span class="n">match_neg</span> <span class="n">a</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">some</span> <span class="n">a</span> <span class="o">:=</span> <span class="k">do</span> <span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span> <span class="bp">←</span> <span class="n">prove_ne_zero</span> <span class="n">a</span><span class="o">,</span> <span class="n">c.mk_app</span> <span class="bp">``</span><span class="n">ne_zero_neg</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">p</span><span class="o">]</span>
  <span class="bp">|</span> <span class="n">none</span> <span class="o">:=</span> <span class="k">do</span> <span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span> <span class="bp">←</span> <span class="n">prove_pos</span> <span class="n">c</span> <span class="n">a</span><span class="o">,</span> <span class="n">c.mk_app</span> <span class="bp">``</span><span class="n">ne_zero_of_pos</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">p</span><span class="o">]</span>
  <span class="kd">end</span>
</code></pre></div>



<a name="213383055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213383055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213383055">(Oct 15 2020 at 06:03)</a>:</h4>
<p>This is called when evaluating, for example, <code>(1 / 2 : ℂ) * 1 = ?</code></p>



<a name="213384818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213384818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213384818">(Oct 15 2020 at 06:37)</a>:</h4>
<p>After Mario's explanation, this isn't too surprising, but I thought it was funny:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.zmod.basic</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span> <span class="n">nat.prime_two</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">zmod</span> <span class="mi">2</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring1</span> <span class="c1">-- fails</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">zmod</span> <span class="mi">2</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">/</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring1</span> <span class="c1">-- works</span>
</code></pre></div>



<a name="213384889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213384889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213384889">(Oct 15 2020 at 06:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213381548">said</a>:</p>
<blockquote>
<p>Oh, but to complicate matters, <code>ring</code> has a fallback that is basically <code>simp</code> with a specific simp set, which is only called if the main <code>ring</code> routine fails. The purpose is to clean up the polynomial identity to see why it didn't work, although sometimes people just use it as "nonterminal <code>ring</code>"</p>
</blockquote>
<p>It's bad that this <code>simp</code> set can loop though, right?</p>



<a name="213385501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385501">(Oct 15 2020 at 06:50)</a>:</h4>
<p>yes, I haven't looked in detail at that</p>



<a name="213385517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385517">(Oct 15 2020 at 06:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/4626">#4626</a></p>



<a name="213385791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385791">(Oct 15 2020 at 06:56)</a>:</h4>
<p>Actually I can't replicate the issue after <a href="https://github.com/leanprover-community/mathlib/issues/4626">#4626</a></p>



<a name="213385810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385810">(Oct 15 2020 at 06:56)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">z</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">-</span> <span class="n">z</span><span class="bp">/↑</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">z</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>
<span class="c1">-- tactic failed, there are unsolved goals</span>
<span class="c1">-- state:</span>
<span class="c1">-- x z : ℂ</span>
<span class="c1">-- ⊢ x + (-(↑2)⁻¹ + 1 / 2) * z = x</span>
</code></pre></div>



<a name="213385940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385940">(Oct 15 2020 at 06:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213368969">said</a>:</p>
<blockquote>
<p>Yeah simp can't handle commutativity because it would loop.</p>
</blockquote>
<p>Actually this isn't true; simp checks for commutativity looking lemmas and rewrites them only if they decrease in a term order, which prevents looping. I use <code>by simp [add_assoc, add_comm, add_left_comm]</code> all the time</p>



<a name="213385958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385958">(Oct 15 2020 at 06:59)</a>:</h4>
<p><code>simp</code> is wicked smart <span aria-label="stuck out tongue wink" class="emoji emoji-1f61c" role="img" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>



<a name="213385985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213385985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213385985">(Oct 15 2020 at 06:59)</a>:</h4>
<p>however this handling is specific to commutativity lemmas. If you give it anything else you can cause a loop, particularly if you have lemmas <code>x ~&gt; y</code> and <code>y ~&gt; x</code></p>



<a name="213386385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213386385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213386385">(Oct 15 2020 at 07:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213369328">said</a>:</p>
<blockquote>
<p>But why doesn't ring just call <code>simp</code> before it does it's magic?!</p>
</blockquote>
<p>Because <code>simp</code> is usually more expensive than <code>ring</code>. It's not a good choice to put on the critical path of a normalization tactic</p>



<a name="213386414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213386414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213386414">(Oct 15 2020 at 07:04)</a>:</h4>
<p>User should write <code>simp; ring</code></p>



<a name="213386552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213386552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213386552">(Oct 15 2020 at 07:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113488-general/topic/.60ring.60.20behaviour/near/213369399">said</a>:</p>
<blockquote>
<p>I had the impression that writing <code>(2 : R)</code> where <code>R</code> was a ring was defeq to the coercion from nat.</p>
</blockquote>
<p>It's not, the associativity of the 1's is different (and in any case it would be exponential time to verify this defeq, even if addition was definitionally associative on the ring in question)</p>



<a name="213386619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/%60ring%60%20behaviour/near/213386619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/.60ring.60.20behaviour.html#213386619">(Oct 15 2020 at 07:07)</a>:</h4>
<p><code>4 : R</code> is <code>(1 + 1) + (1 + 1)</code>, <code>\u 4 : R</code> is <code>(((0 + 1) + 1) + 1) + 1</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>