---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html">Rewrite by defeq yields "motive not type correct"</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261926841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261926841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261926841">(Nov 18 2021 at 13:30)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.functor_category</span>
<span class="kn">open</span> <span class="n">category_theory</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">category</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">category</span> <span class="n">D</span><span class="o">]</span> <span class="o">[</span><span class="n">category</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">category</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">category</span> <span class="n">G</span><span class="o">]</span>
<span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">⥤</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">D</span> <span class="bp">⥤</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">J₁</span> <span class="n">J₂</span> <span class="o">:</span> <span class="n">E</span> <span class="bp">⥤</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="n">J₁</span> <span class="bp">⟶</span> <span class="n">J₂</span><span class="o">)</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="n">F</span> <span class="bp">⥤</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">K.obj</span> <span class="o">(</span><span class="n">J₂.obj</span> <span class="o">(</span><span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">)))</span> <span class="bp">⟶</span> <span class="n">g</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">α.app</span> <span class="o">(</span><span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">))</span> <span class="bp">=</span> <span class="n">α.app</span> <span class="o">((</span><span class="n">H</span> <span class="bp">⋙</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">H.comp_obj</span> <span class="o">}</span> <span class="c">/-</span><span class="cm"> motive not type correct -/</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">α.app</span> <span class="o">(</span><span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">))</span> <span class="bp">=</span> <span class="n">α.app</span> <span class="o">((</span><span class="n">H</span> <span class="bp">⋙</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">H.comp_obj</span> <span class="o">}</span> <span class="c">/-</span><span class="cm"> goals accomplished -/</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">K.map</span> <span class="o">(</span><span class="n">α.app</span> <span class="o">(</span><span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">)))</span> <span class="bp">=</span> <span class="n">K.map</span> <span class="o">(</span><span class="n">α.app</span> <span class="o">((</span><span class="n">H</span> <span class="bp">⋙</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">c</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">H.comp_obj</span> <span class="o">}</span> <span class="c">/-</span><span class="cm"> goals accomplished -/</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">K.map</span> <span class="o">(</span><span class="n">α.app</span> <span class="o">(</span><span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">)))</span> <span class="bp">≫</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">K.map</span> <span class="o">(</span><span class="n">α.app</span> <span class="o">((</span><span class="n">H</span> <span class="bp">⋙</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">c</span><span class="o">))</span> <span class="bp">≫</span> <span class="n">f</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">H.comp_obj</span> <span class="o">}</span> <span class="c">/-</span><span class="cm"> motive not type correct !! -/</span>
</code></pre></div>
<p>All goals can actually be solved by <code>rfl</code>, but not being able to use <code>rw</code> means I have to write down the whole equality. Is there any way to improve <code>rw</code> to work in these circumstances? Or maybe another <code>eerw</code> tactic? The last example naturally arises in my attempt to show that a family of adjunctions (e.g. presheaf pullback-pushforward adjunction for each morphism in <code>Top</code>) transfers a pseudofunctor to a pseudofunctor, using results in <code>adjunction/mates</code>.</p>



<a name="261927591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261927591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261927591">(Nov 18 2021 at 13:37)</a>:</h4>
<p>just tried <code>dsimp only [H.comp_obj]</code> and it fails to simplify ...</p>



<a name="261934514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261934514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261934514">(Nov 18 2021 at 14:32)</a>:</h4>
<p><code>dsimp</code> works alone or with <code>only [category_theory.functor.comp_obj]</code>, not sure why it doesn't work with <code>only [H.comp_obj]</code>. Also not sure why <code>erw</code> ever <em>would</em> work.</p>



<a name="261934793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261934793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261934793">(Nov 18 2021 at 14:34)</a>:</h4>
<p>Maybe we should have some kind of <code>drw</code> or <code>dsimp_rw</code></p>



<a name="261935043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261935043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261935043">(Nov 18 2021 at 14:36)</a>:</h4>
<p>This also doesn't work</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">dsimp</span> <span class="o">[</span><span class="n">nat.add_zero</span> <span class="n">n</span><span class="o">],</span> <span class="o">}</span>
</code></pre></div>
<p>Maybe passing arguments to lemmas for <code>dsimp</code> messes up its <code>rfl</code>-lemma thing?</p>



<a name="261935201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261935201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261935201">(Nov 18 2021 at 14:37)</a>:</h4>
<p>My strategy for this kind of reasoning was normally to get into a state where something like <code>simp, dsimp, simp</code> would work (= close the goal)</p>



<a name="261935795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261935795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261935795">(Nov 18 2021 at 14:41)</a>:</h4>
<p>another style that would work is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">K.map</span> <span class="o">(</span><span class="n">α.app</span> <span class="o">(</span><span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">)))</span> <span class="bp">≫</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">K.map</span> <span class="o">(</span><span class="n">α.app</span> <span class="o">((</span><span class="n">H</span> <span class="bp">⋙</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">c</span><span class="o">))</span> <span class="bp">≫</span> <span class="n">f</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">change</span> <span class="n">I.obj</span> <span class="o">(</span><span class="n">H.obj</span> <span class="n">c</span><span class="o">)</span> <span class="k">with</span> <span class="o">(</span><span class="n">H</span> <span class="bp">⋙</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">obj</span> <span class="n">c</span><span class="o">,</span> <span class="gr">sorry</span> <span class="o">}</span>
</code></pre></div>



<a name="261946194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261946194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261946194">(Nov 18 2021 at 15:54)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">dsimp</span> <span class="n">works</span> <span class="k">with</span> <span class="n">only</span> <span class="o">[</span><span class="n">category_theory.functor.comp_obj</span><span class="o">]</span>
</code></pre></div>
<p>Thank you! This is gonna be a life saver. I didn't even know <code>change</code> can be used with <code>with</code> to specify where to change; I <a href="https://github.com/leanprover-community/mathlib/blob/c920a07a2d01ff34619afa523954076853311310/src/category_theory/adjunction/mates.lean#L344">tried <code>change</code> once</a> but it didn't work. Here I actually need to rewrite in the reverse direction then apply naturality (can't rw or erw naturality directly) in the reverse direction, and after that still need to rewrite by map_comp, assoc, and a triangle identity, and those can be done by simp (if it doesn't undo the rw &lt;- naturality). Unfortuantley I don't have time to complete the proofs until ~7 hours later.</p>



<a name="261947117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261947117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261947117">(Nov 18 2021 at 15:59)</a>:</h4>
<p>The relevant part of the goal at this step is</p>
<p>((adj f').unit.app ((Rmap f').obj ((Rmap (𝟙 X)).obj x)) ≫ <br>
(Rmap f').map ((L.map_id X).app (<strong>(<a href="http://L.to_prefunctor.map">L.to_prefunctor.map</a> f').obj ((Rmap f').obj</strong> ((Rmap (𝟙 X)).obj x))) ≫ (<br>
<a href="http://L.to_prefunctor.map">L.to_prefunctor.map</a> (𝟙 X)).map ((adj f').counit.app ((Rmap (𝟙 X)).obj x)) ≫ <br>
(adj (𝟙 X)).counit.app x))</p>
<p>The middle two lines are gonna be rewritten by naturality, and then cancel with the first line by triangle identity. The <code>(Rmap f').obj ((Rmap (𝟙 X)).obj</code> came from <code>Rmap (𝟙 X) ⋙ Rmap f'</code> via dsimp.</p>



<a name="261951553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Rewrite%20by%20defeq%20yields%20%22motive%20not%20type%20correct%22/near/261951553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Rewrite.20by.20defeq.20yields.20.22motive.20not.20type.20correct.22.html#261951553">(Nov 18 2021 at 16:27)</a>:</h4>
<p>I guess it would go smoothly with simps after rewriting the right hand side with triangle identity ...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>