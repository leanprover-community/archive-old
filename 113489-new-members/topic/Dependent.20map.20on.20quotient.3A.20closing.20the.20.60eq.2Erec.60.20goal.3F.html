---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html">Dependent map on quotient: closing the `eq.rec` goal?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="299537538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/299537538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#299537538">(Sep 19 2022 at 10:19)</a>:</h4>
<p>I'm trying to define the quotient of a groupoid by a normal subgroupoid below (following Bourbaki's <em>Topologie Alg√©brique</em>), and to do so I need first to define the vertices as a quotient, and then the arrows as another one (see below). I'm getting into troubles when trying to define the identity and composition morphisms, since their types depend on the element(s) on which they are defined.<br>
<code>quot.rec</code> seems to be the correct way to proceed, but then I¬†get stuck trying to prove the "soundness" of my recursion, which involves an <code>eq.rec</code>. Am I off-base, or missing something?<br>
Note that for the identity morphism, I¬†can get around this problem since I can first define a non-dependent lift, but it's not really "pretty" and wouldn't work for the composition without ugly tricks, I¬†believe.</p>
<p>Thanks!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.groupoid</span>

<span class="kn">open</span> <span class="n">set</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="kn">namespace</span> <span class="n">groupoid</span>

<span class="kn">section</span> <span class="n">subgroupoid</span>

<span class="kd">variable</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">)</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">subgroupoid</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">arrws</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">set</span> <span class="o">(</span><span class="n">G.hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">))</span>
  <span class="o">(</span><span class="n">inv'</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span><span class="o">}</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">G.hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">),</span>
            <span class="n">groupoid.inv</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">d</span> <span class="n">c</span><span class="o">)</span>
  <span class="o">(</span><span class="n">mul'</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="n">e</span><span class="o">}</span> <span class="o">{</span><span class="n">p</span><span class="o">}</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span><span class="n">q</span><span class="o">}</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">d</span> <span class="n">e</span><span class="o">),</span>
            <span class="n">p</span> <span class="bp">‚â´</span> <span class="n">q</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">c</span> <span class="n">e</span><span class="o">)</span>

<span class="kd">variable</span> <span class="o">{</span><span class="n">G</span><span class="o">}</span>

<span class="kd">def</span> <span class="n">is_normal</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
  <span class="o">(</span><span class="bp">‚àÄ</span> <span class="n">c</span><span class="o">,</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="n">c</span><span class="o">)</span> <span class="bp">‚àà</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">c</span><span class="o">))</span> <span class="bp">‚àß</span>  <span class="c1">-- S is "wide": all vertices of G are covered</span>
  <span class="o">(</span><span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">Œ≥</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">hs</span> <span class="o">:</span> <span class="n">Œ≥</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">c</span> <span class="n">c</span><span class="o">),</span> <span class="o">((</span><span class="n">G.inv</span> <span class="n">p</span><span class="o">)</span> <span class="bp">‚â´</span> <span class="n">Œ≥</span> <span class="bp">‚â´</span> <span class="n">p</span><span class="o">)</span> <span class="bp">‚àà</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">d</span> <span class="n">d</span><span class="o">))</span>


<span class="kd">end</span> <span class="n">subgroupoid</span>


<span class="kn">section</span> <span class="n">quotient</span>

<span class="c1">-- The vertices of the quotient of G by S</span>
<span class="kd">def</span> <span class="n">quot_v</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">quot</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span><span class="o">))</span>


<span class="kd">def</span> <span class="n">quot_v.mk</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">:=</span>
  <span class="o">(</span><span class="n">quot.mk</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span><span class="o">)</span> <span class="n">c</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">conj</span>  <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="bp">Œ£</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="bp">Œ£</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintros</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span><span class="n">d</span><span class="o">,</span><span class="n">g</span><span class="o">‚ü©,</span>
  <span class="n">exact</span> <span class="bp">‚àÉ</span> <span class="o">(</span><span class="n">Œ±</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">Œ≤</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">d</span> <span class="n">b</span><span class="o">),</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">Œ±</span> <span class="bp">‚â´</span> <span class="n">g</span> <span class="bp">‚â´</span> <span class="n">Œ≤</span>
<span class="kd">end</span>

<span class="kd">@[refl]</span>
<span class="kd">lemma</span> <span class="n">conj.refl</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">F</span><span class="o">,</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©,</span>
  <span class="n">use</span> <span class="o">[(</span><span class="mi">ùüô</span> <span class="n">a</span><span class="o">),</span> <span class="n">Sn.left</span> <span class="n">a</span><span class="o">,</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="n">b</span><span class="o">),</span> <span class="n">Sn.left</span> <span class="n">b</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.comp_id</span><span class="o">,</span> <span class="n">category.id_comp</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">@[symm]</span>
<span class="kd">lemma</span> <span class="n">conj.symm</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">F</span> <span class="n">G</span><span class="o">,</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">G</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintros</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span><span class="n">d</span><span class="o">,</span><span class="n">g</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">,</span><span class="n">Œ≤</span><span class="o">,</span><span class="n">hŒ≤</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">G.inv</span> <span class="n">Œ±</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">G.inv</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ≤</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.assoc</span><span class="o">,</span> <span class="n">comp_inv</span><span class="o">,</span> <span class="n">category.comp_id</span><span class="o">],</span>
  <span class="n">rw</span> <span class="bp">‚Üê</span><span class="n">category.assoc</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">inv_comp</span><span class="o">,</span> <span class="n">category.id_comp</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">@[trans]</span>
<span class="kd">lemma</span> <span class="n">conj.trans</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">‚àÄ</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span><span class="o">,</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">G</span> <span class="n">H</span> <span class="bp">‚Üí</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintros</span> <span class="o">‚ü®</span><span class="n">a‚ÇÄ</span><span class="o">,</span><span class="n">b‚ÇÄ</span><span class="o">,</span><span class="n">f‚ÇÄ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÅ</span><span class="o">,</span><span class="n">b‚ÇÅ</span><span class="o">,</span><span class="n">f‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÇ</span><span class="o">,</span><span class="n">b‚ÇÇ</span><span class="o">,</span><span class="n">f‚ÇÇ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±‚ÇÄ</span><span class="o">,</span><span class="n">hŒ±‚ÇÄ</span><span class="o">,</span><span class="n">Œ≤‚ÇÄ</span><span class="o">,</span><span class="n">hŒ≤‚ÇÄ</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©</span>  <span class="o">‚ü®</span><span class="n">Œ±‚ÇÅ</span><span class="o">,</span><span class="n">hŒ±‚ÇÅ</span><span class="o">,</span><span class="n">Œ≤‚ÇÅ</span><span class="o">,</span><span class="n">hŒ≤‚ÇÅ</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">Œ±‚ÇÄ</span> <span class="bp">‚â´</span> <span class="n">Œ±‚ÇÅ</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ±‚ÇÄ</span> <span class="n">hŒ±‚ÇÅ</span><span class="o">,</span> <span class="n">Œ≤‚ÇÅ</span> <span class="bp">‚â´</span> <span class="n">Œ≤‚ÇÄ</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ≤‚ÇÅ</span> <span class="n">hŒ≤‚ÇÄ</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.assoc</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">def</span> <span class="n">quot_start</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">quot</span> <span class="bp">$</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="n">quot.lift</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©,</span> <span class="n">apply</span> <span class="n">quot_v.mk</span><span class="o">,</span> <span class="n">exact</span> <span class="n">a</span><span class="o">,},</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a‚ÇÄ</span><span class="o">,</span><span class="n">b‚ÇÄ</span><span class="o">,</span><span class="n">f‚ÇÄ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÅ</span><span class="o">,</span><span class="n">b‚ÇÅ</span><span class="o">,</span><span class="n">f‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">,</span><span class="n">Œ≤</span><span class="o">,</span><span class="n">hŒ≤</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span><span class="n">simp</span><span class="o">,</span><span class="n">dsimp</span> <span class="o">[</span><span class="n">quot_v.mk</span><span class="o">],</span> <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span> <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">‚ü©,}</span>
<span class="kd">end</span>

<span class="kd">def</span> <span class="n">quot_end</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">quot</span> <span class="bp">$</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="n">quot.lift</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©,</span> <span class="n">apply</span> <span class="n">quot_v.mk</span><span class="o">,</span> <span class="n">exact</span> <span class="n">b</span><span class="o">,},</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a‚ÇÄ</span><span class="o">,</span><span class="n">b‚ÇÄ</span><span class="o">,</span><span class="n">f‚ÇÄ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÅ</span><span class="o">,</span><span class="n">b‚ÇÅ</span><span class="o">,</span><span class="n">f‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">,</span><span class="n">Œ≤</span><span class="o">,</span><span class="n">hŒ≤</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span><span class="n">simp</span><span class="o">,</span><span class="n">dsimp</span> <span class="o">[</span><span class="n">quot_v.mk</span><span class="o">],</span> <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span> <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">G.inv</span> <span class="n">Œ≤</span><span class="o">,</span><span class="n">S.inv'</span> <span class="n">hŒ≤</span><span class="o">‚ü©,}</span>
<span class="kd">end</span>

<span class="kd">@[instance]</span>
<span class="kd">def</span> <span class="n">quotient_quiver</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">quiver</span> <span class="o">(</span><span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span><span class="n">c</span> <span class="n">d</span><span class="o">,</span> <span class="o">{</span> <span class="n">F</span> <span class="bp">|</span> <span class="n">quot_start</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="bp">=</span> <span class="n">c</span> <span class="bp">‚àß</span> <span class="n">quot_end</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="bp">=</span> <span class="n">d</span> <span class="o">}‚ü©</span>

<span class="kd">def</span> <span class="n">quot_id'</span>  <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">),</span>  <span class="o">(</span><span class="n">quot</span> <span class="bp">$</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">quot.lift</span><span class="o">,</span> <span class="n">rotate</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="n">c</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">quot.mk</span> <span class="o">(</span><span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span><span class="n">c</span><span class="o">,</span><span class="mi">ùüô</span> <span class="n">c</span><span class="o">‚ü©</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintros</span> <span class="n">c</span> <span class="n">d</span> <span class="o">‚ü®</span><span class="n">f</span><span class="o">,</span><span class="n">fS</span><span class="o">‚ü©,</span>
    <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">[</span><span class="n">f</span><span class="o">,</span><span class="n">fS</span><span class="o">,</span><span class="n">G.inv</span> <span class="n">f</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">fS</span><span class="o">],</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.id_comp</span><span class="o">,</span> <span class="n">comp_inv</span><span class="o">],</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">def</span> <span class="n">quotient_id</span>  <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">),</span>  <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span> <span class="o">:=</span>
<span class="bp">Œª</span> <span class="n">c</span><span class="o">,</span> <span class="o">‚ü®</span> <span class="n">quot_id'</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">c</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span><span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">quot_id'</span><span class="o">,</span><span class="n">quot_start</span><span class="o">,</span><span class="n">quot_end</span><span class="o">,</span><span class="n">quot_v.mk</span><span class="o">],</span> <span class="n">induction</span> <span class="n">c</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">simp</span><span class="o">,}‚ü©</span>


<span class="kd">def</span> <span class="n">quot_id''</span>  <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">),</span>  <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">Œª</span> <span class="n">c</span><span class="o">,</span> <span class="n">c.rec_on</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="n">c</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">quotient_quiver</span><span class="o">,</span><span class="n">quot_start</span><span class="o">,</span><span class="n">quot_end</span><span class="o">,</span><span class="n">quot_v.mk</span><span class="o">],</span>
    <span class="n">use</span> <span class="n">quot.mk</span> <span class="o">(</span><span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span><span class="n">c</span><span class="o">,</span><span class="mi">ùüô</span> <span class="n">c</span><span class="o">‚ü©,</span> <span class="n">split</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintros</span> <span class="n">c</span> <span class="n">d</span> <span class="o">‚ü®</span><span class="n">f</span><span class="o">,</span><span class="n">fS</span><span class="o">‚ü©,</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">quot.mk</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span><span class="o">)</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">quot.mk</span> <span class="o">(</span><span class="bp">Œª</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span><span class="o">)</span> <span class="n">d</span><span class="o">,</span> <span class="kd">by</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span> <span class="n">constructor</span><span class="o">,</span> <span class="n">use</span> <span class="n">fS</span><span class="o">,},</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="gr">sorry</span><span class="o">,</span>
    <span class="o">}</span>
<span class="kd">end</span>


<span class="kd">def</span> <span class="n">quot_comp'</span>  <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">),</span> <span class="o">(</span><span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">d</span> <span class="bp">‚ü∂</span> <span class="n">e</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">quot</span> <span class="bp">$</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>


<span class="kd">end</span> <span class="n">quotient</span>


<span class="kd">end</span> <span class="n">groupoid</span>
<span class="kd">end</span> <span class="n">category_theory</span>
</code></pre></div>



<a name="300481460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300481460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300481460">(Sep 24 2022 at 04:00)</a>:</h4>
<p>Several comments:</p>
<ul>
<li>Since you've shown that <code>conj</code> is reflexive, symmetric and transitive, you may package them into a <a href="https://leanprover-community.github.io/mathlib_docs/find/setoid">docs#setoid</a> instance, and then you can use <code>quotient</code> instead of <code>quot</code>, which allows you access to theorems like <a href="https://leanprover-community.github.io/mathlib_docs/find/quotient.exact">docs#quotient.exact</a> that isn't true if the relation you quotient by is not an equivalence relation.</li>
<li>When defining data, we usually don't destruct an input; instead we use its projections. For example, <code>conj</code> should be defined as <code>Œª f g, ‚àÉ (Œ± ‚àà S.arrws f.1 g.1) (Œ≤ ‚àà S.arrws g.2.1 f.2.1), f.2.2 = Œ± ‚â´ g.2.2 ‚â´ Œ≤</code>, and the same applies to <code>quot_start</code> and <code>quot_end</code>; in proofs we don't care though.</li>
<li>I think the way you construct <code>quot_id</code> and <code>quotient_id</code> is perfectly fine. Not sure why you want to try the approach in <code>quot_id''</code>. The use of <code>quot.rec_on</code> seems exactly what introduces <code>eq.rec</code> that's hard to deal with.</li>
<li>In order to define <code>quot_comp'</code>, I would take the following approach: first convert (c ‚ü∂ d) and (d ‚ü∂ e) which are subtypes of quotient types into quotient types of subtypes using <a href="https://leanprover-community.github.io/mathlib_docs/find/equiv.subtype_quotient_equiv_quotient_subtype">docs#equiv.subtype_quotient_equiv_quotient_subtype</a>, then use <a href="https://leanprover-community.github.io/mathlib_docs/init/data/quot.html#quotient.lift%E2%82%82">quotient.lift‚ÇÇ</a>. You would still need to use choice to pick an arrow from <code>(S.arrws _ _).nonempty</code> to connect the two lifts of <code>d</code>, but this is the best solution I can think of.</li>
</ul>



<a name="300482641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300482641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300482641">(Sep 24 2022 at 04:22)</a>:</h4>
<p>I think it may be easier to simply define the types of arrows in the quotient groupoid as quotients rather than subtypes of quotients; I believe the following is also a valid definition:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">conj'</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span>
  <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="bp">Œ£</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="o">{</span><span class="n">c</span> <span class="bp">//</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span><span class="o">})</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="o">{</span><span class="n">d</span> <span class="bp">//</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">b</span><span class="o">}),</span> <span class="n">c.1</span> <span class="bp">‚ü∂</span> <span class="n">d.1</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">‚àÉ</span> <span class="o">(</span><span class="n">Œ±</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">f.1.1</span> <span class="n">g.1.1</span><span class="o">)</span> <span class="o">(</span><span class="n">Œ≤</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">g.2.1.1</span> <span class="n">f.2.1.1</span><span class="o">),</span> <span class="n">f.2.2</span> <span class="bp">=</span> <span class="n">Œ±</span> <span class="bp">‚â´</span> <span class="n">g.2.2</span> <span class="bp">‚â´</span> <span class="n">Œ≤</span>

<span class="kd">def</span> <span class="n">quotient_quiver</span> <span class="o">[</span><span class="n">G</span> <span class="o">:</span> <span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">is_normal</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">quiver</span> <span class="o">(</span><span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">quot</span> <span class="o">(</span><span class="n">conj'</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">a</span> <span class="n">b</span><span class="o">)‚ü©</span>
</code></pre></div>



<a name="300515229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300515229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300515229">(Sep 24 2022 at 10:25)</a>:</h4>
<p>Thanks for the feedback. <br>
As for your third bullet: It's mostly because I felt that I'd have to deal with this problem of <code>quot.rec_on/eq.rec</code> with <code>quot_comp</code> anyway, and since <code>id</code> is easier than <code>comp</code>, it would help me figure out how to deal with that. <br>
As for your proposal, I¬†thought about something along these lines but couldn't tell if it was useful. Do we agree that your proposal takes care of the conversion mentioned in bullet 4 already?</p>



<a name="300520078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300520078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300520078">(Sep 24 2022 at 11:02)</a>:</h4>
<p>But as far as I¬†understand, I¬†can't simply do <code>quotient.lift‚ÇÇ</code>, because the lift needs to have a dependent codomain, so only <code>quot.rec</code> works here.</p>



<a name="300553895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300553895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300553895">(Sep 24 2022 at 15:46)</a>:</h4>
<p><span class="user-mention" data-user-id="461830">@R√©mi Bottinelli</span> I haven't dealt with the composition problem, but I have some suggestions for handling the <code>groupoid</code> structure and how to organize taking the vertex quotient</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">category_theory.groupoid</span>

<span class="kn">open</span> <span class="n">set</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kd">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">groupoid</span>

<span class="kn">section</span> <span class="n">subgroupoid</span>

<span class="kd">variable</span> <span class="o">[</span><span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">subgroupoid</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">arrws</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">set</span> <span class="o">(</span><span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">))</span>
<span class="o">(</span><span class="n">inv'</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span><span class="o">}</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">),</span>
          <span class="n">groupoid.inv</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">d</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul'</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="n">e</span><span class="o">}</span> <span class="o">{</span><span class="n">p</span><span class="o">}</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span><span class="n">q</span><span class="o">}</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="n">q</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">d</span> <span class="n">e</span><span class="o">),</span>
          <span class="n">p</span> <span class="bp">‚â´</span> <span class="n">q</span> <span class="bp">‚àà</span> <span class="n">arrws</span> <span class="n">c</span> <span class="n">e</span><span class="o">)</span>

<span class="kd">variable</span> <span class="o">{</span><span class="n">C</span><span class="o">}</span>

<span class="kn">namespace</span> <span class="n">subgroupoid</span>

<span class="kd">structure</span> <span class="n">is_normal</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">wide</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">c</span><span class="o">,</span> <span class="mi">ùüô</span> <span class="n">c</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">c</span> <span class="n">c</span><span class="o">)</span>  <span class="c1">-- S is "wide": all vertices of G are covered</span>
<span class="o">(</span><span class="n">conj</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span><span class="o">}</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">Œ≥</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">hs</span> <span class="o">:</span> <span class="n">Œ≥</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">c</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">groupoid.inv</span> <span class="n">p</span> <span class="bp">‚â´</span> <span class="n">Œ≥</span> <span class="bp">‚â´</span> <span class="n">p</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">d</span> <span class="n">d</span><span class="o">)</span>

<span class="kd">lemma</span> <span class="n">is_normal.arrws_nonempty_refl</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">S.is_normal</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="o">:=</span>
<span class="o">‚ü®</span><span class="mi">ùüô</span> <span class="n">c</span><span class="o">,</span> <span class="n">Sn.wide</span> <span class="n">c</span><span class="o">‚ü©</span>

<span class="kd">lemma</span> <span class="n">is_normal.arrws_nonempty_symm</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">S.is_normal</span><span class="o">)</span>
  <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">d</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">‚ü©,</span> <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">groupoid.inv</span> <span class="n">f</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hf</span><span class="o">‚ü©</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">is_normal.arrws_nonempty_trans</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">S.is_normal</span><span class="o">)</span>
  <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">d</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">g</span><span class="o">,</span> <span class="n">hg</span><span class="o">‚ü©,</span> <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">f</span> <span class="bp">‚â´</span> <span class="n">g</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hf</span> <span class="n">hg</span><span class="o">‚ü©</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">is_normal.arrws_nonempty_setoid</span> <span class="o">{</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">S.is_normal</span><span class="o">)</span> <span class="o">:</span> <span class="n">setoid</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">r</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">c</span> <span class="n">d</span><span class="o">,</span> <span class="o">(</span><span class="n">S.arrws</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="n">nonempty</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="n">Sn.arrws_nonempty_refl</span><span class="o">,</span>
            <span class="bp">Œª</span> <span class="n">c</span> <span class="n">d</span><span class="o">,</span> <span class="n">Sn.arrws_nonempty_symm</span><span class="o">,</span>
            <span class="bp">Œª</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span><span class="o">,</span> <span class="n">Sn.arrws_nonempty_trans</span><span class="o">‚ü©</span> <span class="o">}</span>

<span class="kd">end</span> <span class="n">subgroupoid</span>

<span class="kd">end</span> <span class="n">subgroupoid</span>

<span class="kn">section</span> <span class="n">quotient</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span><span class="o">}</span> <span class="o">[</span><span class="n">groupoid</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">subgroupoid</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">S.is_normal</span><span class="o">)</span>

<span class="c1">-- The vertices of the quotient of G by S</span>
<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">subgroupoid.quot_v</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="n">Sn.arrws_nonempty_setoid</span>

<span class="kd">def</span> <span class="n">subgroupoid.quot_v_mk</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">S.quot_v</span> <span class="n">Sn</span> <span class="o">:=</span> <span class="n">quotient.mk'</span> <span class="n">c</span>

<span class="kn">namespace</span> <span class="n">subgroupoid</span>

<span class="sd">/-- We don't need Sn in the definition, but it makes it inferrable where it is needed. -/</span>
<span class="kd">def</span> <span class="n">conj</span> <span class="o">(</span><span class="n">Sn</span> <span class="o">:</span> <span class="n">S.is_normal</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Œ£</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="bp">Œ£</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="kt">Prop</span>
<span class="bp">|</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">f</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">g</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="bp">‚àÉ</span> <span class="o">(</span><span class="n">Œ±</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">Œ≤</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">d</span> <span class="n">b</span><span class="o">),</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">Œ±</span> <span class="bp">‚â´</span> <span class="n">g</span> <span class="bp">‚â´</span> <span class="n">Œ≤</span>

<span class="kd">@[refl]</span>
<span class="kd">lemma</span> <span class="n">conj.refl</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">F</span><span class="o">,</span> <span class="n">S.conj</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©,</span>
  <span class="n">use</span> <span class="o">[</span><span class="mi">ùüô</span> <span class="n">a</span><span class="o">,</span> <span class="n">Sn.wide</span> <span class="n">a</span><span class="o">,</span> <span class="mi">ùüô</span> <span class="n">b</span><span class="o">,</span> <span class="n">Sn.wide</span> <span class="n">b</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.comp_id</span><span class="o">,</span> <span class="n">category.id_comp</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">@[symm]</span>
<span class="kd">lemma</span> <span class="n">conj.symm</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">F</span> <span class="n">G</span><span class="o">,</span> <span class="n">S.conj</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">S.conj</span> <span class="n">Sn</span> <span class="n">G</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintros</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">f</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span><span class="n">d</span><span class="o">,</span><span class="n">g</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">,</span><span class="n">Œ≤</span><span class="o">,</span><span class="n">hŒ≤</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">groupoid.inv</span> <span class="n">Œ±</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">groupoid.inv</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ≤</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.assoc</span><span class="o">,</span> <span class="n">comp_inv</span><span class="o">,</span> <span class="n">category.comp_id</span><span class="o">],</span>
  <span class="n">rw</span> <span class="bp">‚Üê</span><span class="n">category.assoc</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">inv_comp</span><span class="o">,</span> <span class="n">category.id_comp</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">@[trans]</span>
<span class="kd">lemma</span> <span class="n">conj.trans</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">F</span> <span class="n">G</span> <span class="n">H</span><span class="o">,</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">G</span> <span class="bp">‚Üí</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">G</span> <span class="n">H</span> <span class="bp">‚Üí</span> <span class="n">conj</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rintros</span> <span class="o">‚ü®</span><span class="n">a‚ÇÄ</span><span class="o">,</span><span class="n">b‚ÇÄ</span><span class="o">,</span><span class="n">f‚ÇÄ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÅ</span><span class="o">,</span><span class="n">b‚ÇÅ</span><span class="o">,</span><span class="n">f‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÇ</span><span class="o">,</span><span class="n">b‚ÇÇ</span><span class="o">,</span><span class="n">f‚ÇÇ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±‚ÇÄ</span><span class="o">,</span><span class="n">hŒ±‚ÇÄ</span><span class="o">,</span><span class="n">Œ≤‚ÇÄ</span><span class="o">,</span><span class="n">hŒ≤‚ÇÄ</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©</span>  <span class="o">‚ü®</span><span class="n">Œ±‚ÇÅ</span><span class="o">,</span><span class="n">hŒ±‚ÇÅ</span><span class="o">,</span><span class="n">Œ≤‚ÇÅ</span><span class="o">,</span><span class="n">hŒ≤‚ÇÅ</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">Œ±‚ÇÄ</span> <span class="bp">‚â´</span> <span class="n">Œ±‚ÇÅ</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ±‚ÇÄ</span> <span class="n">hŒ±‚ÇÅ</span><span class="o">,</span> <span class="n">Œ≤‚ÇÅ</span> <span class="bp">‚â´</span> <span class="n">Œ≤‚ÇÄ</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ≤‚ÇÅ</span> <span class="n">hŒ≤‚ÇÄ</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.assoc</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">def</span> <span class="n">conj_setoid</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="bp">Œ£</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">S.conj</span> <span class="n">Sn</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="n">conj.refl</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.symm</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.trans</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">}</span>

<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">quot_conj</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">S.conj_setoid</span> <span class="n">Sn</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">quot_conj_mk</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">S.quot_conj</span> <span class="n">Sn</span> <span class="o">:=</span> <span class="n">quotient.mk'</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">f</span><span class="o">‚ü©</span>

<span class="kn">namespace</span> <span class="n">quot_conj</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">S</span><span class="o">}</span> <span class="o">{</span><span class="n">Sn</span><span class="o">}</span>

<span class="kn">protected</span> <span class="kd">def</span> <span class="n">start</span> <span class="o">:</span> <span class="n">S.quot_conj</span> <span class="n">Sn</span> <span class="bp">‚Üí</span> <span class="n">S.quot_v</span> <span class="n">Sn</span> <span class="o">:=</span>
<span class="n">quotient.map'</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">f</span><span class="o">,</span> <span class="n">f.1</span><span class="o">)</span> <span class="kd">begin</span>
  <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a‚ÇÄ</span><span class="o">,</span><span class="n">b‚ÇÄ</span><span class="o">,</span><span class="n">f‚ÇÄ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÅ</span><span class="o">,</span><span class="n">b‚ÇÅ</span><span class="o">,</span><span class="n">f‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">,</span><span class="n">Œ≤</span><span class="o">,</span><span class="n">hŒ≤</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span>
  <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">‚ü©,</span>
<span class="kd">end</span>

<span class="kn">protected</span> <span class="kd">def</span> <span class="bp">¬´</span><span class="kd">end</span><span class="bp">¬ª</span>  <span class="o">:</span> <span class="n">S.quot_conj</span> <span class="n">Sn</span> <span class="bp">‚Üí</span> <span class="n">S.quot_v</span> <span class="n">Sn</span> <span class="o">:=</span>
<span class="n">quotient.map'</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">f</span><span class="o">,</span> <span class="n">f.2.1</span><span class="o">)</span> <span class="kd">begin</span>
  <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">a‚ÇÄ</span><span class="o">,</span><span class="n">b‚ÇÄ</span><span class="o">,</span><span class="n">f‚ÇÄ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">a‚ÇÅ</span><span class="o">,</span><span class="n">b‚ÇÅ</span><span class="o">,</span><span class="n">f‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span><span class="n">hŒ±</span><span class="o">,</span><span class="n">Œ≤</span><span class="o">,</span><span class="n">hŒ≤</span><span class="o">,</span><span class="n">rfl</span><span class="o">‚ü©,</span>
  <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">groupoid.inv</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ≤</span><span class="o">‚ü©,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">quot_conj</span>

<span class="kd">@[simp]</span>
<span class="kd">lemma</span> <span class="n">start_mk_eq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">S.quot_conj_mk</span> <span class="n">Sn</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">start</span> <span class="bp">=</span> <span class="n">S.quot_v_mk</span> <span class="n">Sn</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">@[simp]</span>
<span class="kd">lemma</span> <span class="n">end_mk_eq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">S.quot_conj_mk</span> <span class="n">Sn</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="kd">end</span> <span class="bp">=</span> <span class="n">S.quot_v_mk</span> <span class="n">Sn</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">instance</span> <span class="n">quot_quiver</span> <span class="o">:</span> <span class="n">quiver</span> <span class="o">(</span><span class="n">S.quot_v</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">c</span> <span class="n">d</span><span class="o">,</span> <span class="o">{</span> <span class="n">F</span> <span class="o">:</span> <span class="n">S.quot_conj</span> <span class="n">Sn</span> <span class="bp">|</span> <span class="n">F.start</span> <span class="bp">=</span> <span class="n">c</span> <span class="bp">‚àß</span> <span class="n">F.end</span> <span class="bp">=</span> <span class="n">d</span> <span class="o">}‚ü©</span>

<span class="kd">def</span> <span class="n">quot_id</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span> <span class="o">:=</span>
<span class="o">‚ü®</span><span class="n">quotient.lift_on'</span> <span class="n">c</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">c'</span><span class="o">,</span> <span class="n">S.quot_conj_mk</span> <span class="n">Sn</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="n">c'</span><span class="o">))</span> <span class="kd">begin</span>
  <span class="n">rintro</span> <span class="n">a</span> <span class="n">b</span> <span class="o">‚ü®</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">‚ü©,</span>
  <span class="n">apply</span> <span class="n">quotient.sound'</span><span class="o">,</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">,</span> <span class="n">groupoid.inv</span> <span class="n">f</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hf</span><span class="o">],</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category.id_comp</span><span class="o">,</span> <span class="n">comp_inv</span><span class="o">],</span>
<span class="kd">end</span><span class="o">,</span> <span class="kd">by</span> <span class="n">exact</span> <span class="n">quotient.ind'</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">_</span><span class="o">,</span> <span class="o">‚ü®</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="o">‚ü©)</span> <span class="n">c</span><span class="o">‚ü©</span>

<span class="kd">def</span> <span class="n">quot_comp</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">d</span> <span class="bp">‚ü∂</span> <span class="n">e</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">e</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- should do in a different way</span>
  <span class="n">letI</span> <span class="o">:=</span> <span class="n">Sn.arrws_nonempty_setoid</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">quotient.rec</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">c'</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">c</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">quotient.rec</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">d'</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">d</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">quotient.rec</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">e'</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="n">_</span> <span class="n">e</span><span class="o">,</span>
  <span class="n">rintro</span> <span class="o">‚ü®</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">g</span><span class="o">,</span> <span class="n">hg</span><span class="o">‚ü©,</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>


<span class="kd">end</span> <span class="n">subgroupoid</span>
<span class="kd">end</span> <span class="n">quotient</span>

<span class="kd">end</span> <span class="n">groupoid</span>
<span class="kd">end</span> <span class="n">category_theory</span>
</code></pre></div>



<a name="300554331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300554331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300554331">(Sep 24 2022 at 15:50)</a>:</h4>
<p>I think Junyan's correct about how the main difficulty is in subtypes of quotients vs quotients of subtypes. It might help to make custom lift functions to deal with dependent types from the objects.</p>



<a name="300562628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300562628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300562628">(Sep 24 2022 at 17:05)</a>:</h4>
<p>Thanks for the cleaned-up code. I tried commuting quotients and subtype <a href="https://github.com/bottine/Bass-Serre/blob/e027941270fa9a631c2d3f3a0b78eff043eeeae2/src/groupoid_presentation.lean#L543">here</a> but as far as I can tell, it doesn't help with the fact that I need a dependent function.</p>



<a name="300603525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300603525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300603525">(Sep 25 2022 at 03:22)</a>:</h4>
<p><span class="user-mention" data-user-id="461830">@R√©mi Bottinelli</span> Here's a full construction of the composition, which should be inserted after</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">subgroupoid.quot_v_mk</span>
<span class="kn">namespace</span> <span class="n">subgroupoid</span>
</code></pre></div>
<p>in Kyle's code (thanks!). I use my own definition of <code>quotient_quiver</code> to be able to apply <code>quot.lift‚ÇÇ</code> directly. Surely the resulting type <code>c ‚ü∂ e</code> depends on <code>c</code> and <code>e</code>, but it's still the same type for different choice of elements of the input types <code>c ‚ü∂ d</code> and <code>d ‚ü∂ e</code>, so <code>quot.lift</code> works without problem. (With your original definition of <code>quotient_quiver</code>, the situation is in some sense better, since you're constructing an element in a subtype of a type that doesn't even depend on <code>c</code> and <code>e</code>, however needing to convert from subtype of quotient to quotient of subtype makes it unpleasant to work with.) I might open a PR to put everything about <code>inv</code> into category_theory.groupoid.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">conj</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">‚àÉ</span> <span class="o">(</span><span class="n">Œ±</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">Œ≤</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">d</span> <span class="n">b</span><span class="o">),</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">Œ±</span> <span class="bp">‚â´</span> <span class="n">g</span> <span class="bp">‚â´</span> <span class="n">Œ≤</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">reassoc</span><span class="o">]</span> <span class="n">inv_comp</span> <span class="n">comp_inv</span> <span class="c1">-- groupoid</span>

<span class="kd">lemma</span> <span class="n">conj.refl</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">S.conj</span> <span class="n">f</span> <span class="n">f</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">Sn.wide</span> <span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">Sn.wide</span> <span class="n">_</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span><span class="o">‚ü©</span>

<span class="kd">lemma</span> <span class="n">conj.symm</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span> <span class="n">S.conj</span> <span class="n">f</span> <span class="n">g</span> <span class="bp">‚Üí</span> <span class="n">S.conj</span> <span class="n">g</span> <span class="n">f</span> <span class="o">:=</span>
<span class="bp">Œª</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©</span>

<span class="kd">lemma</span> <span class="n">conj_comm</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span> <span class="n">S.conj</span> <span class="n">f</span> <span class="n">g</span> <span class="bp">‚Üî</span> <span class="n">S.conj</span> <span class="n">g</span> <span class="n">f</span> <span class="o">:=</span>
<span class="o">‚ü®</span><span class="n">conj.symm</span> <span class="n">S</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">conj.symm</span> <span class="n">S</span> <span class="n">g</span> <span class="n">f</span><span class="o">‚ü©</span>

<span class="kd">lemma</span> <span class="n">conj.trans</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">e</span> <span class="bp">‚ü∂</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">S.conj</span> <span class="n">g</span> <span class="n">h</span> <span class="bp">‚Üí</span> <span class="n">S.conj</span> <span class="n">h</span> <span class="n">i</span> <span class="bp">‚Üí</span> <span class="n">S.conj</span> <span class="n">g</span> <span class="n">i</span> <span class="o">:=</span>
<span class="bp">Œª</span> <span class="o">‚ü®</span><span class="n">Œ±‚ÇÅ</span><span class="o">,</span> <span class="n">hŒ±‚ÇÅ</span><span class="o">,</span> <span class="n">Œ≤‚ÇÅ</span><span class="o">,</span> <span class="n">hŒ≤‚ÇÅ</span><span class="o">,</span> <span class="n">he‚ÇÅ</span><span class="o">‚ü©</span> <span class="o">‚ü®</span><span class="n">Œ±‚ÇÇ</span><span class="o">,</span> <span class="n">hŒ±‚ÇÇ</span><span class="o">,</span> <span class="n">Œ≤‚ÇÇ</span><span class="o">,</span> <span class="n">hŒ≤‚ÇÇ</span><span class="o">,</span> <span class="n">he‚ÇÇ</span><span class="o">‚ü©,</span>
  <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ±‚ÇÅ</span> <span class="n">hŒ±‚ÇÇ</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ≤‚ÇÇ</span> <span class="n">hŒ≤‚ÇÅ</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he‚ÇÅ</span><span class="o">,</span> <span class="n">he‚ÇÇ</span><span class="o">]‚ü©</span>

<span class="kd">def</span> <span class="n">conj_setoid</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">setoid</span> <span class="o">(</span><span class="bp">Œ£</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="o">{</span><span class="n">c</span> <span class="bp">//</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span><span class="o">})</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="o">{</span><span class="n">d</span> <span class="bp">//</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">b</span><span class="o">}),</span> <span class="n">c.1</span> <span class="bp">‚ü∂</span> <span class="n">d.1</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">r</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">S.conj</span> <span class="n">f.2.2</span> <span class="n">g.2.2</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.refl</span> <span class="n">_</span> <span class="n">Sn</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.symm</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.trans</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">conj_comp</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span><span class="n">h</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">‚ü∂</span> <span class="n">e</span><span class="o">}</span> <span class="o">(</span><span class="n">hS</span> <span class="o">:</span> <span class="n">h</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">d</span> <span class="n">e</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">S.conj</span> <span class="n">f</span> <span class="o">(</span><span class="n">g</span> <span class="bp">‚â´</span> <span class="n">h</span><span class="o">)</span> <span class="bp">‚Üî</span> <span class="n">S.conj</span> <span class="n">f</span> <span class="n">g</span> <span class="o">:=</span>
<span class="o">‚ü®</span><span class="bp">Œª</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">h</span> <span class="bp">‚â´</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hS</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©,</span>
 <span class="bp">Œª</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">inv</span> <span class="n">h</span> <span class="bp">‚â´</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="o">(</span><span class="n">S.inv'</span> <span class="n">hS</span><span class="o">)</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©‚ü©</span>

<span class="kd">lemma</span> <span class="n">conj_comp'</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span><span class="n">h</span> <span class="o">:</span> <span class="n">e</span> <span class="bp">‚ü∂</span> <span class="n">c</span><span class="o">}</span> <span class="o">(</span><span class="n">hS</span> <span class="o">:</span> <span class="n">h</span> <span class="bp">‚àà</span> <span class="n">S.arrws</span> <span class="n">e</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">S.conj</span> <span class="n">f</span> <span class="o">(</span><span class="n">h</span> <span class="bp">‚â´</span> <span class="n">g</span><span class="o">)</span> <span class="bp">‚Üî</span> <span class="n">S.conj</span> <span class="n">f</span> <span class="n">g</span> <span class="o">:=</span>
<span class="o">‚ü®</span><span class="bp">Œª</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">Œ±</span> <span class="bp">‚â´</span> <span class="n">h</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ±</span> <span class="n">hS</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©,</span>
 <span class="bp">Œª</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">Œ±</span> <span class="bp">‚â´</span> <span class="n">inv</span> <span class="n">h</span><span class="o">,</span> <span class="n">S.mul'</span> <span class="n">hŒ±</span> <span class="o">(</span><span class="n">S.inv'</span> <span class="n">hS</span><span class="o">),</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©‚ü©</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">inv_inv</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">inv</span> <span class="o">(</span><span class="n">inv</span> <span class="n">f</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">‚Üê</span> <span class="n">category.comp_id</span> <span class="o">(</span><span class="n">inv</span> <span class="o">(</span><span class="n">inv</span> <span class="n">f</span><span class="o">)),</span> <span class="bp">‚Üê</span> <span class="n">inv_comp</span> <span class="n">f</span><span class="o">,</span> <span class="n">inv_comp_assoc</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">conj_congr_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f‚ÇÅ</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">f‚ÇÇ</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">‚ü∂</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">S.conj</span> <span class="n">f‚ÇÅ</span> <span class="n">f‚ÇÇ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">S.conj</span> <span class="o">(</span><span class="n">f‚ÇÅ</span> <span class="bp">‚â´</span> <span class="n">g</span><span class="o">)</span> <span class="o">(</span><span class="n">f‚ÇÇ</span> <span class="bp">‚â´</span> <span class="n">g</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">let</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">h</span> <span class="k">in</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">Sn.conj</span> <span class="n">g</span> <span class="n">_</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©</span>

<span class="kd">lemma</span> <span class="n">conj_congr_right</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">‚ü∂</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g‚ÇÅ</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">‚ü∂</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">g‚ÇÇ</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">S.conj</span> <span class="n">g‚ÇÅ</span> <span class="n">g‚ÇÇ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">S.conj</span> <span class="o">(</span><span class="n">f</span> <span class="bp">‚â´</span> <span class="n">g‚ÇÅ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="bp">‚â´</span> <span class="n">g‚ÇÇ</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">let</span> <span class="o">‚ü®</span><span class="n">Œ±</span><span class="o">,</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="n">he</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">h</span> <span class="k">in</span> <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">Sn.conj</span> <span class="o">(</span><span class="n">groupoid.inv</span> <span class="n">f</span><span class="o">)</span> <span class="n">_</span> <span class="n">hŒ±</span><span class="o">,</span> <span class="n">Œ≤</span><span class="o">,</span> <span class="n">hŒ≤</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">he</span><span class="o">]‚ü©</span>

<span class="kd">@[instance]</span>
<span class="kd">def</span> <span class="n">quotient_quiver</span> <span class="o">:</span> <span class="n">quiver</span> <span class="o">(</span><span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">conj_setoid</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">a</span> <span class="n">b</span><span class="o">)‚ü©</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">quot_comp</span> <span class="o">{</span><span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">d</span> <span class="bp">‚ü∂</span> <span class="n">e</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">(</span><span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">e</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">sm</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">nonempty.some_mem</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">quot.lift‚ÇÇ</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">f</span> <span class="n">g‚ÇÅ</span> <span class="n">g‚ÇÇ</span> <span class="n">h</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">f‚ÇÅ</span> <span class="n">f‚ÇÇ</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="n">_</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">letI</span> <span class="o">:=</span> <span class="n">Sn.arrws_nonempty_setoid</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">f.2.2</span> <span class="bp">‚â´</span> <span class="o">(</span><span class="n">quotient.exact</span> <span class="bp">$</span> <span class="n">f.2.1.2.trans</span> <span class="n">g.1.2.symm</span><span class="o">)</span><span class="bp">.</span><span class="n">some</span> <span class="bp">‚â´</span> <span class="n">g.2.2</span><span class="o">‚ü©</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">conj_setoid</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">S.conj_congr_right</span> <span class="n">Sn</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">S.conj_comp'</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">sm</span> <span class="n">_</span><span class="o">),</span> <span class="n">conj_comm</span><span class="o">,</span> <span class="n">S.conj_comp'</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">sm</span> <span class="n">_</span><span class="o">),</span> <span class="n">conj_comm</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">h</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">‚Üê</span> <span class="n">category.assoc</span><span class="o">],</span>
    <span class="n">apply</span> <span class="n">S.conj_congr_left</span> <span class="n">Sn</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">S.conj_comp</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">sm</span> <span class="n">_</span><span class="o">),</span> <span class="n">conj_comm</span><span class="o">,</span> <span class="n">S.conj_comp</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">sm</span> <span class="n">_</span><span class="o">),</span> <span class="n">conj_comm</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">h</span> <span class="o">},</span>
<span class="kd">end</span>
</code></pre></div>



<a name="300605245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300605245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300605245">(Sep 25 2022 at 03:57)</a>:</h4>
<p>Oh I see you actually added four lemmas about groupoids in <a href="https://github.com/leanprover-community/mathlib/pull/16611/files#diff-0e224c1fd025af007b7ac0995e9e6e48e7993722ae69b3a64a3029adacc82df2">the free groupoid PR</a>. I think the best thing to do is to first show that groupoid.inv = <a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.inv">docs#category_theory.inv</a>, and use the latter everywhere (we already has the is_iso instance), to avoid duplicating the API (<a href="https://leanprover-community.github.io/mathlib_docs/find/category_theory.is_iso.inv_comp">docs#category_theory.is_iso.inv_comp</a> etc. already exist). So we should probably <code>open category_theory</code> but not <code>open groupoid</code> (or hide <code>groupoid.inv</code>) to be able to simply write <code>inv</code>.</p>



<a name="300610338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300610338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300610338">(Sep 25 2022 at 05:47)</a>:</h4>
<p>see PR <a href="https://github.com/leanprover-community/mathlib/pull/16624">#16624</a></p>



<a name="300610797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/300610797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#300610797">(Sep 25 2022 at 05:55)</a>:</h4>
<p>Thanks a lot! Looking forward to see what I¬†was misunderstanding exactly.</p>



<a name="301017493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/301017493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#301017493">(Sep 27 2022 at 14:26)</a>:</h4>
<p>I think I'm being stupid, but actually, following your approach to the quotient, I feel like now defining <code>id</code> becomes problematic. How would you do it?</p>



<a name="301083600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/301083600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#301083600">(Sep 27 2022 at 18:19)</a>:</h4>
<p>The easy way is to use choice:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">quot_id</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span> <span class="o">:=</span>
<span class="n">quot.mk</span> <span class="n">_</span> <span class="o">‚ü®‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">quot.out_eq</span> <span class="n">c</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">quot.out_eq</span> <span class="n">c</span><span class="o">‚ü©,</span> <span class="mi">ùüô</span> <span class="n">_</span><span class="o">‚ü©</span>
</code></pre></div>
<p>or you could also do it computably (albeit more complicated, and I have to adjust the sigma type to a subtype in order to use <a href="https://leanprover-community.github.io/mathlib_docs/find/subtype_quotient_equiv_quotient_subtype">docs#subtype_quotient_equiv_quotient_subtype</a>):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">sigma_conj_setoid</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="bp">Œ£</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">r</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">S.conj</span> <span class="n">f.2.2</span> <span class="n">g.2.2</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.refl</span> <span class="n">_</span> <span class="n">Sn</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.symm</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.trans</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">conj_setoid'</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">setoid</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Œ£</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">d</span> <span class="bp">//</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">f.1</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">‚àß</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">f.2.1</span> <span class="bp">=</span> <span class="n">b</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">r</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">S.conj</span> <span class="n">f.1.2.2</span> <span class="n">g.1.2.2</span><span class="o">,</span>
  <span class="n">iseqv</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.refl</span> <span class="n">_</span> <span class="n">Sn</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.symm</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="bp">Œª</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">conj.trans</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">‚ü©</span> <span class="o">}</span>
<span class="c1">-- setoid.comap coe (sigma_conj_setoid S Sn a b) -- need import data.setoid.basic</span>

<span class="kd">@[instance]</span>
<span class="kd">def</span> <span class="n">quotient_quiver</span> <span class="o">:</span> <span class="n">quiver</span> <span class="o">(</span><span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:=</span> <span class="o">‚ü®</span><span class="bp">Œª</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">conj_setoid'</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">a</span> <span class="n">b</span><span class="o">)‚ü©</span>

<span class="kd">def</span> <span class="n">quot_id</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">quot_v</span> <span class="n">S</span> <span class="n">Sn</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">‚ü∂</span> <span class="n">c</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine</span> <span class="bp">@</span><span class="n">equiv.subtype_quotient_equiv_quotient_subtype</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">sigma_conj_setoid</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">c</span> <span class="n">c</span><span class="o">)</span>
    <span class="o">(</span><span class="n">conj_setoid'</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">c</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">quot.lift</span> <span class="n">_</span> <span class="bp">$</span> <span class="bp">Œª</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">_</span><span class="o">,</span> <span class="n">iff.rfl</span><span class="o">)</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">iff.rfl</span><span class="o">)</span> <span class="n">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">obtain</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">hb</span><span class="o">,</span> <span class="bp">-</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">h</span><span class="o">,</span> <span class="n">congr'</span> <span class="mi">2</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span> <span class="n">exacts</span> <span class="o">[‚ü®</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">‚ü©,</span> <span class="o">‚ü®</span><span class="n">_</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">hb</span><span class="o">‚ü©]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">refine</span> <span class="o">‚ü®</span><span class="n">quot.lift</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">c</span><span class="o">,</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">d</span> <span class="n">e</span> <span class="n">h</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="n">c</span><span class="o">,</span> <span class="n">_</span><span class="o">‚ü©,</span> <span class="o">{</span> <span class="n">exact</span> <span class="o">‚ü®</span><span class="n">c</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="mi">ùüô</span> <span class="n">c</span><span class="o">‚ü©</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">obtain</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">h</span><span class="o">,</span> <span class="n">refine</span> <span class="n">quot.sound</span> <span class="o">‚ü®</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">S.inv'</span> <span class="n">ha</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span><span class="o">‚ü©</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rcases</span> <span class="n">c</span><span class="o">,</span> <span class="n">exacts</span> <span class="o">‚ü®</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="o">‚ü©</span> <span class="o">}</span> <span class="o">},</span>
<span class="kd">end</span>

<span class="c">/-</span><span class="cm"> and you get nice defeq: -/</span>
<span class="kd">lemma</span> <span class="n">quot_id_eq</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">quot_id</span> <span class="n">S</span> <span class="n">Sn</span> <span class="o">(</span><span class="n">quot_v_mk</span> <span class="n">S</span> <span class="n">Sn</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">quot.mk</span> <span class="n">_</span> <span class="o">‚ü®‚ü®</span><span class="n">c</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="mi">ùüô</span> <span class="n">c</span><span class="o">‚ü©,</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="o">‚ü©</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="301083853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/301083853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#301083853">(Sep 27 2022 at 18:21)</a>:</h4>
<p>Sorry I haven't got a chance to look at your new free groupoid PR carefully yet, but I agree with Jo√´l's comment there.</p>



<a name="301191503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/301191503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#301191503">(Sep 28 2022 at 09:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="224323">Junyan Xu</span> <a href="#narrow/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F/near/301083853">said</a>:</p>
<blockquote>
<p>Sorry I haven't got a chance to look at your new free groupoid PR carefully yet, but I agree with Jo√´l's comment there.</p>
</blockquote>
<p>No worry, I'm trying to finish the quotient construction in the meantime. It's at the edge of my lean abilities, so I'm advancing very slowly!</p>



<a name="301903154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Dependent%20map%20on%20quotient%3A%20closing%20the%20%60eq.rec%60%20goal%3F/near/301903154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> R√©mi Bottinelli <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Dependent.20map.20on.20quotient.3A.20closing.20the.20.60eq.2Erec.60.20goal.3F.html#301903154">(Oct 02 2022 at 07:56)</a>:</h4>
<p>Actually, I think I found a probably easier way to deal with the quotient: <br>
If <code>N</code> is a normal subgroupoid, one should be able to decompose it into <code>V * G</code> where <code>V</code> consists only of the vertex groups of <code>N</code>, and <code>G</code> has at most one arrow per pair of vertices. One can then quotient first by <code>N</code> and then by <code>G</code>:</p>
<ul>
<li>Quotienting by <code>N</code> preserves the vertices, so we only need to quotient edges.</li>
<li>Quotienting then by <code>G</code> preserves arrows: we're just bunching groups together corresponding to squashing vertices.</li>
</ul>
<p>So, both definitions should be relatively transparent, and they're actually useful by their own I¬†believe.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>