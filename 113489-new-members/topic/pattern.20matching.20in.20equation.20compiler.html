---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html">pattern matching in equation compiler</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="211053627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211053627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211053627">(Sep 23 2020 at 19:49)</a>:</h4>
<p>We have a file with the following contents:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">chess</span>

<span class="kd">@[derive decidable_eq]</span>
<span class="kd">inductive</span> <span class="n">color</span>
<span class="bp">|</span> <span class="n">white</span>
<span class="bp">|</span> <span class="n">black</span>

<span class="kd">@[derive decidable_eq]</span>
<span class="kd">inductive</span> <span class="n">pieces</span>
<span class="bp">|</span> <span class="n">bishop</span>
<span class="bp">|</span> <span class="n">king</span>
<span class="bp">|</span> <span class="n">knight</span>
<span class="bp">|</span> <span class="n">pawn</span>
<span class="bp">|</span> <span class="n">queen</span>
<span class="bp">|</span> <span class="n">rook</span>

<span class="kd">@[derive decidable_eq]</span>
<span class="kd">structure</span> <span class="n">colored_pieces</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">piece</span> <span class="o">:</span> <span class="n">pieces</span><span class="o">)</span>
<span class="o">(</span><span class="n">color</span> <span class="o">:</span> <span class="n">color</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">white_bishop</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.bishop</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">white_king</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.king</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">white_knight</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.knight</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">white_pawn</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.pawn</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">white_queen</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.queen</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">white_rook</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.rook</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span>

<span class="kd">def</span> <span class="n">black_bishop</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.bishop</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">black_king</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.king</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">black_knight</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.knight</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">black_pawn</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.pawn</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">black_queen</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.queen</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span>
<span class="kd">def</span> <span class="n">black_rook</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">pieces.rook</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span>

<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♔</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.white_king</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♕</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.white_queen</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♖</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.white_rook</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♗</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.white_bishop</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♘</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.white_knight</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♙</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.white_pawn</span>

<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♚</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.black_king</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♛</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.black_queen</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♜</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.black_rook</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♝</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.black_bishop</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♞</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.black_knight</span>
<span class="kd">notation</span> <span class="bp">`</span> <span class="bp">♟︎</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">chess.black_pawn</span>

<span class="kd">notation</span> <span class="bp">`</span> <span class="n">__</span> <span class="bp">`</span> <span class="o">:=</span> <span class="n">none</span>

<span class="kd">def</span> <span class="n">piece_repr</span> <span class="o">:</span> <span class="n">colored_pieces</span> <span class="bp">→</span> <span class="n">string</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.king</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♔"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.queen</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♕"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.rook</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♖"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.bishop</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♗"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.knight</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♘"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.pawn</span><span class="o">,</span> <span class="n">color.white</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♙"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.king</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♚"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.queen</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♛"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.rook</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♜"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.bishop</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♝"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.knight</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♞"</span>
<span class="bp">|</span> <span class="o">⟨</span><span class="n">pieces.pawn</span><span class="o">,</span> <span class="n">color.black</span><span class="o">⟩</span> <span class="o">:=</span> <span class="s2">"♟︎"</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_repr</span> <span class="n">colored_pieces</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">piece_repr</span><span class="o">⟩</span>

<span class="kd">end</span> <span class="n">chess</span>
</code></pre></div>



<a name="211053731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211053731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211053731">(Sep 23 2020 at 19:50)</a>:</h4>
<p>And we noticed we can't use the notation, nor the defns <code>white_king</code> in the pattern matching portion of the equation compiler in <code>piece_repr</code>.</p>



<a name="211053827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211053827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211053827">(Sep 23 2020 at 19:51)</a>:</h4>
<p>Is that because <code>def</code>s can't substitute in for patterns? Is that similar to how <code>pattern ...</code> has to be defined separately in Haskell?</p>



<a name="211054627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211054627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211054627">(Sep 23 2020 at 19:59)</a>:</h4>
<p>I don't remember the details here, but I think you can use <code>@[pattern]</code> on <code>def white_bishop</code>, etc to use it in the pattern match.</p>



<a name="211055142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211055142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211055142">(Sep 23 2020 at 20:02)</a>:</h4>
<p>interesting, that indeed does work</p>



<a name="211055909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211055909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211055909">(Sep 23 2020 at 20:09)</a>:</h4>
<p>and I think it works for notation too!</p>



<a name="211055915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211055915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211055915">(Sep 23 2020 at 20:09)</a>:</h4>
<p>We should add the <code>pattern</code> attribute to our docs.</p>



<a name="211055969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/pattern%20matching%20in%20equation%20compiler/near/211055969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/pattern.20matching.20in.20equation.20compiler.html#211055969">(Sep 23 2020 at 20:10)</a>:</h4>
<p>i.e. after adding the <code>@[pattern]</code> to the defs I can use the notation too, so I guess the issue was just the defs not having htat attribute.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>