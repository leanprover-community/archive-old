---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/.E2.9C.94.20Why.20my.20macro.20does.20not.20work.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20Why.20my.20macro.20does.20not.20work.3F.html">✔ Why my macro does not work?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="285782998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20Why%20my%20macro%20does%20not%20work%3F/near/285782998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Felipe GS <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20Why.20my.20macro.20does.20not.20work.3F.html#285782998">(Jun 11 2022 at 14:52)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="s2">"pizza "</span> <span class="n">term</span> <span class="o">:</span> <span class="n">command</span>

<span class="n">macro_rules</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="n">pizza</span> <span class="bp">$</span><span class="n">e</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="kd">def</span> <span class="n">ae</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">e</span><span class="o">)</span>

<span class="n">pizza</span> <span class="mi">3</span>

<span class="k">#check</span> <span class="n">ae</span> <span class="c1">-- unknown identifier 'ae'</span>
</code></pre></div>



<a name="285783142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20Why%20my%20macro%20does%20not%20work%3F/near/285783142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20Why.20my.20macro.20does.20not.20work.3F.html#285783142">(Jun 11 2022 at 14:56)</a>:</h4>
<p>Excellent question, your macro works in fact exactly as inteded and this section explains why that is the case: <a href="https://github.com/arthurpaulino/lean4-metaprogramming-book/blob/master/md/main/macros.md#hygiene-issues-and-how-to-solve-them">https://github.com/arthurpaulino/lean4-metaprogramming-book/blob/master/md/main/macros.md#hygiene-issues-and-how-to-solve-them</a></p>
<p>In short: All identifiers that a macro introduces the way you are doing it, are introduced in such a way that they are not accessible by the user from the outside world in order to avoid the user relying on names that they do not have control over, you can disable this feature with a <code>set_option hygiene false in</code> followed by your `() term but you most likely dont want to in order to avoid this bug.</p>



<a name="285783213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20Why%20my%20macro%20does%20not%20work%3F/near/285783213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20Why.20my.20macro.20does.20not.20work.3F.html#285783213">(Jun 11 2022 at 14:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="481858">Felipe GS</span> has marked this topic as resolved.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>