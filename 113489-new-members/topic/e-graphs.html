---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/e-graphs.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html">e-graphs</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="231224127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/231224127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#231224127">(Mar 21 2021 at 15:52)</a>:</h4>
<p>Welcome! I guess you're talking about the paper <a href="http://leodemoura.github.io/files/ematching.pdf">"Efficient E-matching for SMT Solvers"</a>? I'm probably not the right person to try to answer your question but maybe <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> or <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> can help.</p>



<a name="231224154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/231224154" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#231224154">(Mar 21 2021 at 15:53)</a>:</h4>
<p>What are e-graphs? Maybe I know them by another name, but that doesn't ring a bell</p>



<a name="232114940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/232114940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#232114940">(Mar 27 2021 at 20:07)</a>:</h4>
<p>Chiming here - would also be interested in knowing about egraph use in Lean. I take it the pattern matcher for tactics got an algorithmkc overhaul from Lean 3</p>



<a name="234073628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234073628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234073628">(Apr 11 2021 at 20:33)</a>:</h4>
<p>Bump. Does the synbolic rewriter in <code>rfl</code> use a particular algorithm for egraphs?</p>



<a name="234073686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234073686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234073686">(Apr 11 2021 at 20:33)</a>:</h4>
<p>If one wanted to add tactics similar to RUBI, would that be by overloading <code>simp</code>?</p>



<a name="234073925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234073925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234073925">(Apr 11 2021 at 20:37)</a>:</h4>
<p><a href="https://rulebasedintegration.org/">https://rulebasedintegration.org/</a></p>



<a name="234077371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234077371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234077371">(Apr 11 2021 at 21:22)</a>:</h4>
<p>What do you mean by the symbolic rewriter in <code>rfl</code>?</p>



<a name="234077398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234077398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234077398">(Apr 11 2021 at 21:23)</a>:</h4>
<p><code>rfl</code> is just a shorthand for <a href="https://leanprover-community.github.io/mathlib_docs/find/eq.refl">docs#eq.refl</a>, a constructor for <a href="https://leanprover-community.github.io/mathlib_docs/find/eq">docs#eq</a></p>



<a name="234090168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090168">(Apr 12 2021 at 01:07)</a>:</h4>
<p>(deleted)</p>



<a name="234090401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090401">(Apr 12 2021 at 01:11)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> here's waht I understand:</p>
<ol>
<li>Lean4 has a "symbolic" rewriter for terms in the goals<br>
From the manual:</li>
</ol>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- You can prove theorems about your functions.</span>
<span class="c1">-- The following theorem states that for any natural number `a`,</span>
<span class="c1">-- adding 2 twice produces a value equal to `a + 4`.</span>
<span class="kd">theorem</span> <span class="n">twiceAdd2</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">twice</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">4</span> <span class="o">:=</span>
  <span class="c1">-- The proof is by reflexivity. Lean "symbolically" reduces both sides of the equality</span>
  <span class="c1">-- until they are identical.</span>
  <span class="n">rfl</span>
</code></pre></div>
<ol start="2">
<li>the <code>eq.refl</code> you pointed to is in mathlib, aka Lean3.</li>
<li>In RUBI, the symbolic term rewriter is crucial for performance and solvability of integration problems.</li>
<li>Leo published a fundamental paper of egraphs for symbolic term rewriting, and <span class="user-mention" data-user-id="399443">@Alessandro</span> and I are wondering if that was implemented as the symbolic term rewriter in Lean4.</li>
</ol>



<a name="234090435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090435">(Apr 12 2021 at 01:11)</a>:</h4>
<p>Lean 4's rfl is the same as lean 3's rfl. It's not a "symbolic rewriter", it compares values up to a relation called definitional equality</p>



<a name="234090480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090480">(Apr 12 2021 at 01:12)</a>:</h4>
<p>Thanks Mario, nice to see you around here too :D</p>



<a name="234090497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090497">(Apr 12 2021 at 01:12)</a>:</h4>
<p>which involves weakly normalizing both sides to a constructor</p>



<a name="234090504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090504">(Apr 12 2021 at 01:12)</a>:</h4>
<p>I am everywhere</p>



<a name="234090560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090560">(Apr 12 2021 at 01:13)</a>:</h4>
<p>Well I'm bringing this up because I'm "close" <span aria-label="tm" class="emoji emoji-2122" role="img" title="tm">:tm:</span>  to porting RUBI to Julia, and from there porting RUBI to Lean wouldn't be "that much" additional effort. I would want to know which tactic I could dump a <code>lhs = rhs</code> ruleset, if at all feasible.</p>



<a name="234090628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090628">(Apr 12 2021 at 01:14)</a>:</h4>
<p>As far as I know, nothing about egraphs or symbolic term rewriting is involved in the implementation of rfl and/or defeq in any version of lean. This is much more based on literature on dependent type theory, reduction and strong normalization stuff</p>



<a name="234090639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090639">(Apr 12 2021 at 01:15)</a>:</h4>
<p>Oh neat.</p>



<a name="234090665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090665">(Apr 12 2021 at 01:15)</a>:</h4>
<p>However, you will find more of leo's creativity in the <code>simp</code> tactic, which does symbolic term rewriting closer to what you are talking about</p>



<a name="234090678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090678">(Apr 12 2021 at 01:15)</a>:</h4>
<p>Ah, that's the one. So I could in theory overload <code>simp</code> with a bunch of these integration rules, right?</p>



<a name="234090694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090694">(Apr 12 2021 at 01:16)</a>:</h4>
<p>yes</p>



<a name="234090733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090733">(Apr 12 2021 at 01:16)</a>:</h4>
<p>We've done that for derivatives in mathlib</p>



<a name="234090750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090750">(Apr 12 2021 at 01:16)</a>:</h4>
<p>I think integration too but I guess the coverage is lower</p>



<a name="234090774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090774">(Apr 12 2021 at 01:17)</a>:</h4>
<p>its ability to pattern match on lambdas is limited though, so most likely you would do a full integration routine as a dedicated tactic</p>



<a name="234090786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090786">(Apr 12 2021 at 01:17)</a>:</h4>
<p>Ouch.</p>



<a name="234090969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234090969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234090969">(Apr 12 2021 at 01:20)</a>:</h4>
<p>I mean, it's pretty hard to recognize that in the function <code>\lam x, sin x * (2 / cos x)</code> you want to pull out the constant factor 2 (let's say this is a preprocessing step)</p>



<a name="234091006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091006">(Apr 12 2021 at 01:21)</a>:</h4>
<p>you would have a huge number of possible patterns to look for to find the 2</p>



<a name="234091025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091025">(Apr 12 2021 at 01:22)</a>:</h4>
<p>Yup, that's a transformation that egraphs can achieve linear in the number of patterns that match, without running into the phase ordering problem of some transformations will bork others.</p>
<p>Hence why we're asking :D</p>



<a name="234091071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091071">(Apr 12 2021 at 01:22)</a>:</h4>
<p>This is a good overview (that I'm still becoming familiar with myself)<br>
<a href="https://egraphs-good.github.io/">https://egraphs-good.github.io/</a></p>



<a name="234091215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091215">(Apr 12 2021 at 01:25)</a>:</h4>
<p>I don't think I have seen anything like this implemented in lean</p>



<a name="234091224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091224">(Apr 12 2021 at 01:25)</a>:</h4>
<p>It is possible to implement it yourself, of course</p>



<a name="234091267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091267">(Apr 12 2021 at 01:26)</a>:</h4>
<p>(in lean 3 or lean 4, although it's probably better suited for lean 4)</p>



<a name="234091839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091839">(Apr 12 2021 at 01:36)</a>:</h4>
<p>Yeah, condolences to the mathlib crowd, I'm learning Lean4 - the garbage collector's too good to pass up <span aria-label="muscle" class="emoji emoji-1f4aa" role="img" title="muscle">:muscle:</span></p>



<a name="234091863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/234091863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miguel Raz Guzmán Macedo <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#234091863">(Apr 12 2021 at 01:37)</a>:</h4>
<p>(And in fact it will probably do amazingly in the benchmarks what with the functional but in place style not generating tons of allocations in all the symbolic computations.)</p>



<a name="268439754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/268439754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#268439754">(Jan 18 2022 at 19:02)</a>:</h4>
<p>Bumping this thread to note a new <a href="https://arxiv.org/pdf/2108.02290.pdf">work</a> which (claims to?) achieve exponential (!) speedups on e-matching queries in the egg library.</p>



<a name="268442784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/e-graphs/near/268442784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/e-graphs.html#268442784">(Jan 18 2022 at 19:25)</a>:</h4>
<p><span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span> 2022 <span aria-label="eyes" class="emoji emoji-1f440" role="img" title="eyes">:eyes:</span></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>