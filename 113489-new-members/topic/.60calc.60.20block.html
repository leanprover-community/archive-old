---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/.60calc.60.20block.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html">`calc` block</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="279482999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279482999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vasily Ilin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279482999">(Apr 19 2022 at 23:50)</a>:</h4>
<p>It seems that when I get something wrong inside a <code>calc</code> block, I get incomprehensible error messages. Is there a way around it? The example I am working on is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.tensor_product</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="n">open_locale</span> <span class="n">tensor_product</span>
<span class="n">open_locale</span> <span class="n">polynomial</span>
<span class="kn">open</span> <span class="n">algebra.tensor_product</span>
<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">K</span><span class="o">]</span>

<span class="c1">-- noncomputable def counit : K[X] →ₐ[K] K := polynomial.aeval 0</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">comul</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="n">aeval</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">))</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">map1</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">(</span><span class="n">algebra.tensor_product.assoc</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span><span class="bp">.</span><span class="n">symm.to_alg_hom.comp</span> <span class="o">((</span><span class="n">map</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">))</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">map2</span> <span class="o">:</span> <span class="o">(</span><span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">)</span> <span class="o">:=</span>  <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span>
<span class="bp">.</span> <span class="c1">-- this tells Lean not to recompile definitions</span>

<span class="kd">lemma</span> <span class="n">coassoc</span> <span class="o">:</span> <span class="n">map1</span> <span class="n">K</span> <span class="bp">=</span> <span class="n">map2</span> <span class="n">K</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">P2</span> <span class="o">:</span> <span class="n">map2</span> <span class="n">K</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">2</span><span class="bp">*</span><span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">map2</span> <span class="n">K</span> <span class="n">X</span> <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">unfold</span> <span class="n">map2</span><span class="o">,</span>
           <span class="bp">...</span>  <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">(</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">aeval_X</span><span class="o">]</span> <span class="c1">-- GET "don't know how to synthesize placeholder" HERE</span>
           <span class="bp">...</span>  <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">(</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">map_add</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>



<a name="279483283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279483283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279483283">(Apr 19 2022 at 23:54)</a>:</h4>
<p>Yeah it can be tricky to deal with the syntax. You have an extra comma at the end of the line starting <code>calc</code>.</p>



<a name="279513071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279513071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279513071">(Apr 20 2022 at 08:31)</a>:</h4>
<p>I usually set up all the framework and populate everything with <code>sorry</code> before starting to do anything. I also found this very frustrating when I was learning</p>



<a name="279513642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279513642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279513642">(Apr 20 2022 at 08:37)</a>:</h4>
<p>Yeah, a friend of mine has started to play with Lean recently and he complained to me about the syntax of calc, and I remember hating it too at first. Is it better in Lean 4 ?</p>



<a name="279514252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279514252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279514252">(Apr 20 2022 at 08:44)</a>:</h4>
<p>I think the specific mistake I used to make was, like above, the comma at the end of the line, because in almost every other situation in tactic mode you end a line with a comma</p>



<a name="279515065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279515065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279515065">(Apr 20 2022 at 08:52)</a>:</h4>
<p>I wonder if it would hurt anything to allow an optional comma there</p>



<a name="279515139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279515139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279515139">(Apr 20 2022 at 08:53)</a>:</h4>
<p>What I normally do, as Kevin suggests, is two split the strategy in two. Say that you want to prove that an expression <code>A</code> is less or equal than another expression <code>B</code> through three steps passing via <code>C1,C2,C3</code>. Then you can<br>
1) First write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">C1</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C3</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
</code></pre></div>
<p>Here it is important to remember that (i) the dots are crucial; (ii) you need a comma only at the end.<br>
2) You prove separate goals, forgetting the <code>calc</code> and pasting the result: for instance</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">C1</span><span class="o">,</span>
<span class="n">apply</span> <span class="n">bla</span><span class="o">,</span>
<span class="n">rw</span> <span class="n">foo</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">mickey</span><span class="o">,</span>
</code></pre></div>
<p>that you convert to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">C1</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span><span class="n">apply</span> <span class="n">bla</span><span class="o">,</span> <span class="n">rw</span> <span class="n">foo</span><span class="o">,</span> <span class="n">exact</span> <span class="n">mickey</span><span class="o">}</span>
</code></pre></div>
<p>And so on, until</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:</span> <span class="n">C3</span> <span class="bp">=</span> <span class="n">B</span><span class="o">,</span>
<span class="kd">by</span> <span class="o">{</span><span class="n">simp</span> <span class="n">only</span><span class="o">}</span>
</code></pre></div>
<p>Then you pick these things up and you insert them in the <code>calc</code> block, to get</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">C1</span> <span class="o">:</span> <span class="kd">by</span> <span class="kd">by</span> <span class="o">{</span><span class="n">apply</span> <span class="n">bla</span><span class="o">,</span> <span class="n">rw</span> <span class="n">foo</span><span class="o">,</span> <span class="n">exact</span> <span class="n">mickey</span><span class="o">}</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="kd">by</span> <span class="bp">???</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="kd">by</span> <span class="bp">???</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C3</span> <span class="o">:</span> <span class="kd">by</span> <span class="bp">???</span>
       <span class="bp">...</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:</span> <span class="kd">by</span> <span class="o">{</span><span class="n">simp</span> <span class="n">only</span><span class="o">},</span>
</code></pre></div>
<p>It normally works quite smoothly, but at the beginning I found it painful too.</p>



<a name="279519318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279519318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279519318">(Apr 20 2022 at 09:34)</a>:</h4>
<p>I wonder if this should go into the tips and tricks page, since everyone seems to have struggled with <code>calc</code> (I certainly also did!).</p>



<a name="279519414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279519414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279519414">(Apr 20 2022 at 09:35)</a>:</h4>
<p>Seems a good idea.</p>



<a name="279519589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279519589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279519589">(Apr 20 2022 at 09:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300245">Filippo A. E. Nuccio</span> <a href="#narrow/stream/113489-new-members/topic/.60calc.60.20block/near/279515139">said</a>:</p>
<blockquote>
<p>1) First write</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">C1</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C3</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>
</code></pre></div><br>
</p>
</blockquote>
<p>This is enough.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">calc</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">C1</span> <span class="o">:</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C2</span> <span class="o">:</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="n">C3</span> <span class="o">:</span> <span class="gr">sorry</span>
       <span class="bp">...</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:</span> <span class="gr">sorry</span><span class="o">,</span>
</code></pre></div>



<a name="279519765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279519765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279519765">(Apr 20 2022 at 09:38)</a>:</h4>
<p>Personally, I would also try to align the first <code>=</code> with the chain of relations below.</p>



<a name="279522831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279522831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279522831">(Apr 20 2022 at 10:08)</a>:</h4>
<p>I even went as far as considering implementing some VS Code shortcut to make this boilerplate happen automatically, but I never got around to it</p>



<a name="279523903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279523903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279523903">(Apr 20 2022 at 10:21)</a>:</h4>
<p>On a related note, I was thinking that calc proofs would be a lot easier to read if somehow the syntax highlighting were different for the proof and for the statements</p>



<a name="279524139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279524139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279524139">(Apr 20 2022 at 10:24)</a>:</h4>
<p>Adding</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="s2">"Calc template"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s2">"prefix"</span><span class="o">:</span> <span class="o">[</span><span class="s2">"_calc"</span><span class="o">],</span>
        <span class="s2">"body"</span><span class="o">:</span> <span class="o">[</span>
    <span class="s2">"calc  $0A = C1 : sorry"</span><span class="o">,</span>
    <span class="s2">"    ... ≤ C2 : sorry"</span><span class="o">,</span>
    <span class="s2">"    ... ≤ C2 : sorry"</span><span class="o">,</span>
    <span class="s2">"    ... ≤ C3 : sorry"</span><span class="o">,</span>
    <span class="s2">"    ... = B  : sorry,"</span><span class="o">],</span>
    <span class="s2">"description"</span><span class="o">:</span> <span class="s2">"Template for a calc-block"</span><span class="o">,</span>
  <span class="o">}</span>
</code></pre></div>
<p>as a User snippet in VSCode allows you to type <code>_calc + [Enter]</code> and produces the template.<br>
EDIT: I had missed the <em>very important</em> comma at the end (if you are using this in tactic mode)!</p>
<p>Arguably, the cursor should end up on <code>A</code>, though.  I'll edit!</p>



<a name="279525230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279525230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279525230">(Apr 20 2022 at 10:39)</a>:</h4>
<p>And don't you have too many commas at the end of the intermediate steps?</p>



<a name="279525364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279525364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279525364">(Apr 20 2022 at 10:40)</a>:</h4>
<p>Oh, those commas are needed by the snippet syntax.  The stuff that gets printed in VSCode is what is inside the quotations <code>"..."</code>.</p>



<a name="279525495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279525495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279525495">(Apr 20 2022 at 10:42)</a>:</h4>
<p>I initially tried </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="s2">"Calc template"</span><span class="o">:</span> <span class="o">{</span>
        <span class="s2">"prefix"</span><span class="o">:</span> <span class="o">[</span><span class="s2">"_calc"</span><span class="o">],</span>
        <span class="s2">"body"</span><span class="o">:</span> <span class="o">[</span>
    <span class="s2">"calc  $0A = C1 : sorry</span>
<span class="s2">         ... ≤ C2 : sorry</span>
<span class="s2">         ... ≤ C2 : sorry</span>
<span class="s2">         ... ≤ C3 : sorry</span>
<span class="s2">         ... = B  : sorry,"</span><span class="o">],</span>
    <span class="s2">"description"</span><span class="o">:</span> <span class="s2">"Template for a calc-block"</span><span class="o">,</span>
  <span class="o">}</span>
</code></pre></div>
<p>but was told off by VSCode.</p>
<p>For some reason, snippets that span more than one line, need to have each line encased in quotations and with a comma at the end.</p>



<a name="279528862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279528862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279528862">(Apr 20 2022 at 11:20)</a>:</h4>
<p>Very useful snippet, thanks!</p>



<a name="279547898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279547898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279547898">(Apr 20 2022 at 14:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/113489-new-members/topic/.60calc.60.20block/near/279519318">said</a>:</p>
<blockquote>
<p>I wonder if this should go into the tips and tricks page, since everyone seems to have struggled with <code>calc</code> (I certainly also did!).</p>
</blockquote>
<p>We've also got <a href="https://github.com/leanprover-community/leanprover-community.github.io/blob/newsite/templates/extras/calc.md">a page on <code>calc</code> mode</a> on our website which could be a good fit for these helpful explanations!</p>



<a name="279572930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279572930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vasily Ilin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279572930">(Apr 20 2022 at 17:03)</a>:</h4>
<p>I am following the advice of putting <code>sorry</code>s everywhere first, and then populating them, but running into a strange <code>tactic failed, result contains meta-variables</code> error. I don't know what a meta-variable is, and why this happens here. Any suggestions?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.tensor_product</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="n">open_locale</span> <span class="n">tensor_product</span>
<span class="n">open_locale</span> <span class="n">polynomial</span>
<span class="kn">open</span> <span class="n">algebra.tensor_product</span>
<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">K</span><span class="o">]</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">comul</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="n">aeval</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">))</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">map1</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="o">(</span><span class="n">algebra.tensor_product.assoc</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span><span class="bp">.</span><span class="n">symm.to_alg_hom.comp</span> <span class="o">((</span><span class="n">map</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">))</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">map2</span> <span class="o">:</span> <span class="o">(</span><span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">)</span> <span class="o">:=</span>  <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span>
<span class="bp">.</span> <span class="c1">-- this tells Lean not to recompile definitions</span>

<span class="kd">lemma</span> <span class="n">coassoc</span> <span class="o">:</span> <span class="n">map1</span> <span class="n">K</span> <span class="bp">=</span> <span class="n">map2</span> <span class="n">K</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">P2</span> <span class="o">:</span> <span class="n">map2</span> <span class="n">K</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">map2</span> <span class="n">K</span> <span class="n">X</span> <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="n">X</span><span class="o">:</span> <span class="kd">by</span> <span class="n">unfold</span> <span class="n">map2</span>
      <span class="bp">...</span>  <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">((</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
      <span class="bp">...</span>  <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">((</span><span class="n">aeval</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)))</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span> <span class="c1">-- GET tactic failed, result contains meta-variables HERE</span>
      <span class="bp">...</span>  <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">(</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span> <span class="c1">--rw aeval_X</span>
      <span class="bp">...</span>  <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">(</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span> <span class="c1">-- rw map_add (map (comul K : K[X] →ₐ[K] K[X] ⊗[K] K[X]) (alg_hom.id K K[X])) _ _</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="n">X</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">))</span> <span class="bp">⊗ₜ</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="o">(</span><span class="n">alg_hom.id</span> <span class="n">K</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="n">X</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">))</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">⊗ₜ</span> <span class="n">X</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span> <span class="o">:</span> <span class="kd">by</span> <span class="gr">sorry</span><span class="o">,</span>

  <span class="gr">sorry</span><span class="o">,</span>

<span class="kd">end</span>
</code></pre></div>



<a name="279574419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279574419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vasily Ilin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279574419">(Apr 20 2022 at 17:14)</a>:</h4>
<p>Is it something to do with universes? This (<a href="https://leanprover.github.io/theorem_proving_in_lean/quantifiers_and_equality.html#equality">https://leanprover.github.io/theorem_proving_in_lean/quantifiers_and_equality.html#equality</a>) suggests so</p>



<a name="279578723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279578723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279578723">(Apr 20 2022 at 17:45)</a>:</h4>
<p>It's complaining that it doesn't know a missing variable of type <code>Type</code>; the following fixes it:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="n">X</span> <span class="bp">=</span> <span class="o">(</span><span class="n">aeval</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)))</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">:=</span>
<span class="n">rfl</span>
</code></pre></div>



<a name="279581828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279581828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vasily Ilin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279581828">(Apr 20 2022 at 18:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/.60calc.60.20block/near/279578723">said</a>:</p>
<blockquote>
<p>It's complaining that it doesn't know a missing variable of type <code>Type</code>; the following fixes it:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">comul</span> <span class="n">K</span><span class="o">)</span> <span class="n">X</span> <span class="bp">=</span> <span class="o">(</span><span class="n">aeval</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">)))</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">:=</span>
<span class="n">rfl</span>
</code></pre></div><br>
</p>
</blockquote>
<p>How do I tell Lean that X is in K[X] for the rest of the file? I thought that it already knew it because X is <code>polynomial.X</code>. Do I need to somehow put X in a universe?</p>



<a name="279582017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279582017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279582017">(Apr 20 2022 at 18:08)</a>:</h4>
<p>X isn't in K[X], X is polynomial.X so it's in R[X] for whatever you choose R to be. Lean will usually figure things out and if it doesn't you can just give it the hint like I did above.</p>



<a name="279582136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279582136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279582136">(Apr 20 2022 at 18:09)</a>:</h4>
<p>You might be able to use some <code>local notation</code> trick</p>



<a name="279582581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279582581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vasily Ilin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279582581">(Apr 20 2022 at 18:12)</a>:</h4>
<p>A somewhat related question: I have an algebra map <code>comult</code> from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">[</mo><mi>X</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">K[X]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">]</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo stretchy="false">[</mo><mi>X</mi><mo stretchy="false">]</mo><mo>⊗</mo><mi>K</mi><mo stretchy="false">[</mo><mi>X</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">K[X] \otimes K[X]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">]</span></span></span></span>. I want to show that comult takes 1 to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>⊗</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1\otimes 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>. My attempt below does not work for some reason.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.tensor_product</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="n">open_locale</span> <span class="n">tensor_product</span>
<span class="n">open_locale</span> <span class="n">polynomial</span>
<span class="kn">open</span> <span class="n">algebra.tensor_product</span>
<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kd">universe</span> <span class="n">u</span>
<span class="kd">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">K</span><span class="o">]</span>

<span class="c1">-- noncomputable def counit : K[X] →ₐ[K] K := polynomial.aeval 0</span>

<span class="kd">noncomputable</span> <span class="kd">def</span> <span class="n">comul</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">→ₐ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="o">:=</span> <span class="n">aeval</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="n">X</span><span class="o">))</span>

<span class="kd">lemma</span> <span class="n">comul_1</span> <span class="o">:</span> <span class="n">comul</span> <span class="n">K</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">⊗ₜ</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">comul</span><span class="o">,</span> <span class="c1">-- ⊢ ⇑(aeval (X ⊗ₜ[K] 1 + 1 ⊗ₜ[K] X)) 1 = 1 ⊗ₜ[K] 1</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">aeval_C</span> <span class="n">K</span> <span class="o">(</span><span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">]</span> <span class="bp">⊗</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">K</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="o">((</span><span class="n">X</span> <span class="bp">⊗ₜ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">⊗ₜ</span><span class="o">[</span><span class="n">K</span><span class="o">]</span> <span class="n">X</span><span class="o">))</span> <span class="mi">1</span><span class="o">,</span> <span class="c1">-- did not find instance of the pattern in the target expression ⇑(aeval (X ⊗ₜ[K] 1 + 1 ⊗ₜ[K] X)) (⇑C 1)</span>
<span class="kd">end</span>
</code></pre></div>



<a name="279583729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%60calc%60%20block/near/279583729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Vasily Ilin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.60calc.60.20block.html#279583729">(Apr 20 2022 at 18:20)</a>:</h4>
<p>(deleted)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>