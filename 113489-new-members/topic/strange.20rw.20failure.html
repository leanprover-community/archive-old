---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/strange.20rw.20failure.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html">strange rw failure</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="203595773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203595773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203595773">(Jul 11 2020 at 13:00)</a>:</h4>
<p>Ok so I've been facing a weird problem. Does any of you know why the first proof fragments compile but not the second ? I think I have included all the necessary instances, so I'm a bit lost : </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">calculus</span><span class="bp">.</span><span class="n">deriv</span>

<span class="kn">open</span> <span class="n">filter</span> <span class="n">set</span>

<span class="kn">lemma</span> <span class="n">tendsto_neg_nhds_within_neg</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">tendsto</span> <span class="n">has_neg</span><span class="bp">.</span><span class="n">neg</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">Ioi</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)))</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="n">a</span> <span class="o">(</span><span class="n">Iio</span> <span class="n">a</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">s</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_map</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_nhds_within_Iio_iff_exists_Ico_subset</span> <span class="n">at</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">sorry</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">tendsto_neg_nhds_within_neg&#39;</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">[</span><span class="n">no_bot_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">no_top_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">densely_ordered</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">[</span><span class="n">topological_add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">order_topology</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">ordered_add_comm_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">tendsto</span> <span class="n">has_neg</span><span class="bp">.</span><span class="n">neg</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">Ioi</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)))</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="n">a</span> <span class="o">(</span><span class="n">Iio</span> <span class="n">a</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">s</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_map</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_nhds_within_Iio_iff_exists_Ico_subset</span> <span class="n">at</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203595925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203595925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203595925">(Jul 11 2020 at 13:06)</a>:</h4>
<p>This calls for <code>set_option pp.all true</code></p>



<a name="203596021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596021">(Jul 11 2020 at 13:08)</a>:</h4>
<p><code>ordered_add_comm_group</code> extends <code>add_comm_group</code>, as well as the ordering. You need fewer instances</p>



<a name="203596029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596029">(Jul 11 2020 at 13:08)</a>:</h4>
<p>Yes I just noticed it works if I remove ordered_add_comm_group</p>



<a name="203596038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596038">(Jul 11 2020 at 13:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/strange.20rw.20failure/near/203595925">said</a>:</p>
<blockquote>
<p>This calls for <code>set_option pp.all true</code></p>
</blockquote>
<p>I'll keep that in mind, that's useful !</p>



<a name="203596147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596147">(Jul 11 2020 at 13:12)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">all</span> <span class="n">true</span>
<span class="kn">lemma</span> <span class="n">tendsto_neg_nhds_within_neg&#39;</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">[</span><span class="n">no_bot_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">no_top_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">densely_ordered</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">[</span><span class="n">topological_add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">order_topology</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">ordered_add_comm_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">tendsto</span> <span class="n">has_neg</span><span class="bp">.</span><span class="n">neg</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">Ioi</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)))</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="n">a</span> <span class="o">(</span><span class="n">Iio</span> <span class="n">a</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">s</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_map</span><span class="o">,</span>
  <span class="n">rw</span> <span class="bp">@</span><span class="n">mem_nhds_within_Iio_iff_exists_Ico_subset</span> <span class="n">α</span> <span class="bp">_</span><span class="n">inst_4</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="bp">_</span><span class="n">inst_8</span>
    <span class="bp">_</span><span class="n">inst_2</span> <span class="bp">_</span><span class="n">inst_6</span> <span class="n">a</span> <span class="n">s</span> <span class="n">at</span> <span class="n">hs</span><span class="o">,</span>
  <span class="c">/-</span><span class="cm"></span>
<span class="cm">  rewrite tactic failed, did not find instance of the pattern in the target expression</span>
<span class="cm">  @has_mem.mem.{u_1 u_1} (set.{u_1} α) (filter.{u_1} α) (@filter.has_mem.{u_1} α) s</span>
<span class="cm">    (@nhds_within.{u_1} α _inst_4 a</span>
<span class="cm">       (@set.Iio.{u_1} α (@partial_order.to_preorder.{u_1} α (@linear_order.to_partial_order.{u_1} α _inst_1)) a))</span>

<span class="cm">    hs :</span>
<span class="cm">  @has_mem.mem.{u_1 u_1} (set.{u_1} α) (filter.{u_1} α) (@filter.has_mem.{u_1} α) s</span>
<span class="cm">    (@nhds_within.{u_1} α _inst_4 a</span>
<span class="cm">       (@set.Iio.{u_1} α</span>
<span class="cm">          (@partial_order.to_preorder.{u_1} α (@ordered_add_comm_group.to_partial_order.{u_1} α _inst_9))</span>
<span class="cm">          a))</span>
<span class="cm">       -/</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203596165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596165">(Jul 11 2020 at 13:13)</a>:</h4>
<p>Yep that's what made me feel <code>ordered_add_comm_group</code> was the problem</p>



<a name="203596215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596215">(Jul 11 2020 at 13:14)</a>:</h4>
<p>Now the problem is I need <code>ordered_add_comm_group</code> later in the proof...</p>



<a name="203596355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596355">(Jul 11 2020 at 13:19)</a>:</h4>
<p>The procedure I use to investigate that kind of issue is the start a line with <code>have := @mem_nhds_within_Iio_iff_exists_Ico_subset α</code> and then progressively add underscores at this end of this line to see what goes wrong.</p>



<a name="203596429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596429">(Jul 11 2020 at 13:20)</a>:</h4>
<p>Except I just tried on your example and nothing goes wrong until you try to use it.</p>



<a name="203596454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596454">(Jul 11 2020 at 13:21)</a>:</h4>
<p>But it will be a useful technique anyway. Hold on.</p>



<a name="203596574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596574">(Jul 11 2020 at 13:24)</a>:</h4>
<p>What I understand is I have two orders on the same type, so there is also two different <code>Iio</code></p>



<a name="203596585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596585">(Jul 11 2020 at 13:25)</a>:</h4>
<p>Yes</p>



<a name="203596587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596587">(Jul 11 2020 at 13:25)</a>:</h4>
<p>I wanted to show you a principled way of understanding this is the issue, but it's not obvious.</p>



<a name="203596631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596631">(Jul 11 2020 at 13:26)</a>:</h4>
<p>Once you realize you have two totally unrelated order relations on alpha and remove one then you can use the technique I mentioned above to zoom on the issue.</p>



<a name="203596652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596652">(Jul 11 2020 at 13:27)</a>:</h4>
<p>In case, it looks like a severe design flaw in <code>ordered_add_comm_group</code>.</p>



<a name="203596704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596704">(Jul 11 2020 at 13:28)</a>:</h4>
<p>It doesn't seem to be able to deduce <code>linear_order \a</code> from <code>ordered_add_comm_group \a</code></p>



<a name="203596712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596712">(Jul 11 2020 at 13:28)</a>:</h4>
<p>No, because you don't need a total (aka linear) order in ordered_add_comm_group</p>



<a name="203596717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596717">(Jul 11 2020 at 13:29)</a>:</h4>
<p>Oh so I removed the wrong one x)</p>



<a name="203596739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596739">(Jul 11 2020 at 13:29)</a>:</h4>
<p>I think there is nothing you can do here without changing mathlib.</p>



<a name="203596796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596796">(Jul 11 2020 at 13:31)</a>:</h4>
<p>Fyi this is the whole proof (I'm aware the end probably won't compile anyway, <code>linarith</code> already didn't like when I did a similar refactor to other proofs) : </p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">tendsto_neg_nhds_within_neg&#39;</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">linear_order</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">[</span><span class="n">no_bot_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">no_top_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">densely_ordered</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">[</span><span class="n">topological_add_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">order_topology</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">tendsto</span> <span class="n">has_neg</span><span class="bp">.</span><span class="n">neg</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">Ioi</span> <span class="o">(</span><span class="bp">-</span><span class="n">a</span><span class="o">)))</span> <span class="o">(</span><span class="n">nhds_within</span> <span class="n">a</span> <span class="o">(</span><span class="n">Iio</span> <span class="n">a</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">s</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_map</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mem_nhds_within_Iio_iff_exists_Ico_subset</span> <span class="n">α</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_nhds_within_Iio_iff_exists_Ico_subset</span> <span class="n">at</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_nhds_within_Ioi_iff_exists_Ioc_subset</span><span class="o">,</span>
  <span class="n">rcases</span> <span class="n">hs</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">l</span><span class="o">,</span> <span class="n">hl</span><span class="o">,</span> <span class="n">hs</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_Iio</span> <span class="n">at</span> <span class="n">hl</span><span class="o">,</span>
  <span class="n">use</span> <span class="bp">-</span><span class="n">l</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_Ioi</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">neg_lt_neg</span> <span class="n">hl</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">hs</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_Ioc</span> <span class="n">at</span> <span class="n">hx</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_Ico</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="n">linarith</span><span class="o">,</span>
  <span class="n">linarith</span>
<span class="kn">end</span>
</code></pre></div>



<a name="203596802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596802">(Jul 11 2020 at 13:31)</a>:</h4>
<p>I need <code>ordered_add_comm_group</code> for <code>neg_lt_neg</code></p>



<a name="203596807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596807">(Jul 11 2020 at 13:31)</a>:</h4>
<p>I suggest to change <code>ordered_add_comm_group</code> to </p>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">ordered_add_comm_group</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">partial_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_le_add_left</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>


<p>and see what breaks</p>



<a name="203596998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203596998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203596998">(Jul 11 2020 at 13:37)</a>:</h4>
<p>Well, a lot of things break if I just replace the definition x)</p>



<a name="203597051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597051">(Jul 11 2020 at 13:38)</a>:</h4>
<p>I guess so. For instance that will requires adding a lot of <code>[add_comm_group α] [partial_order α]</code> everywhere (hopefully adding them to <code>variables</code> lines would do most of the job)</p>



<a name="203597066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597066">(Jul 11 2020 at 13:39)</a>:</h4>
<p>And of course you need to do that also to the multiplicative version (<code>to_additive</code> will complain like crazy anyway if you are not consistent here) .</p>



<a name="203597124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597124">(Jul 11 2020 at 13:40)</a>:</h4>
<p>Maybe it's a better idea to let someone who know that part of the library do this job (although this is a good opportunity to get a tour). And maybe there is a better fix. For this kind of architectural question it's good to pîng <span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="203597176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597176">(Jul 11 2020 at 13:42)</a>:</h4>
<p>Did you manage to understand why the problem is not there with your real number version? Maybe there is actually a combination of existing type classes that gets the job done.</p>



<a name="203597193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597193">(Jul 11 2020 at 13:43)</a>:</h4>
<p>You can start investigating this by typing <code>#check (by apply_instance : ordered_add_comm_group ℝ)</code></p>



<a name="203597367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597367">(Jul 11 2020 at 13:49)</a>:</h4>
<p>More directly, you can try:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">implicit</span> <span class="n">true</span>
<span class="kn">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
 <span class="k">let</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">mem_nhds_within_Iio_iff_exists_Ico_subset</span> <span class="n">ℝ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>and see where Lean gets the relevant instances in the real case.</p>



<a name="203597494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203597494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203597494">(Jul 11 2020 at 13:52)</a>:</h4>
<p>But actually you proof in the real case don't go until the point where you want to use <code>ordered_add_comm_group</code> lemmas, so maybe it won't help at all.</p>



<a name="203599831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203599831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203599831">(Jul 11 2020 at 14:55)</a>:</h4>
<p>Could it simply be because the <code>order_add_comm_group \R</code> instance is defined using <code>@linear_order.le \R real.linear_order</code> ?</p>



<a name="203600042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203600042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203600042">(Jul 11 2020 at 15:00)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">calculus</span><span class="bp">.</span><span class="n">deriv</span>

<span class="kn">open</span> <span class="n">filter</span> <span class="n">set</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">real</span><span class="bp">.</span><span class="n">ordered_add_comm_group</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">real</span><span class="bp">.</span><span class="n">ordered_ring</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">real</span><span class="bp">.</span><span class="n">linear_ordered_ring</span>
<span class="bp">#</span><span class="kn">print</span> <span class="n">real</span><span class="bp">.</span><span class="n">linear_ordered_comm_ring</span>
</code></pre></div>



<a name="203603520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203603520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203603520">(Jul 11 2020 at 16:26)</a>:</h4>
<p>Why do we have <code>decidable_linear_ordered_add_comm_group</code> but not <code>linear_ordered_add_comm_group</code> ?</p>



<a name="203603543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203603543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anatole Dedecker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203603543">(Jul 11 2020 at 16:27)</a>:</h4>
<p>With <code>decidable_linear_ordered_add_comm_group</code> everything works just fine, but I don't think I use the <code>decidable</code> part</p>



<a name="203603950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203603950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203603950">(Jul 11 2020 at 16:37)</a>:</h4>
<p>It's just a historical accident because part of the library was written by computer scientists</p>



<a name="203620392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203620392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203620392">(Jul 12 2020 at 00:40)</a>:</h4>
<p>I don't understand why <code>ordered_add_comm_group</code> is being blamed here</p>



<a name="203620401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203620401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203620401">(Jul 12 2020 at 00:41)</a>:</h4>
<p>rather than removing <code>ordered_add_comm_group</code> from the list you should remove <code>add_comm_group</code></p>



<a name="203620457"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/strange%20rw%20failure/near/203620457" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/strange.20rw.20failure.html#203620457">(Jul 12 2020 at 00:42)</a>:</h4>
<p>We might need <code>linear_ordered_add_comm_group</code> for this proof</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>