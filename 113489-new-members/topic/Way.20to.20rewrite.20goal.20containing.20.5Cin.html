---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html">Way to rewrite goal containing \in</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="201043760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201043760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201043760">(Jun 16 2020 at 16:51)</a>:</h4>
<p>Since a set looks to be defined as a function from the type to propositions and is specified as a proposition that the elements of a type need to satisfy in order to be an element of the set, I was wondering if there is a convenient tactic to rewrite a goal of the form <code>a ‚àà A</code> as the proposition <code>a</code> needs to satisfy in order to be a member of <code>A</code></p>



<a name="201044632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201044632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201044632">(Jun 16 2020 at 16:58)</a>:</h4>
<p>it's <code>A</code></p>



<a name="201044691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201044691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201044691">(Jun 16 2020 at 16:58)</a>:</h4>
<p>That's breaking the interface but it's also the correct answer: <code>A a</code> is the proposition which is true iff a is in A</p>



<a name="201044777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201044777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201044777">(Jun 16 2020 at 16:59)</a>:</h4>
<p>maybe you want <code>rw set.mem_def</code></p>



<a name="201052016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201052016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201052016">(Jun 16 2020 at 17:58)</a>:</h4>
<p>I am not really sure I understand! What I meant was that <code>a ‚àà A</code> is the goal and I want to put it in a more explicit form. In my case the set <code>A</code> depends on many parameters, and if copy the set name in the proof Lean does not recognize these parameters (I have no idea why since they are defined). On the other hand <code>rw set.mem_def</code> just rewrites <code>a ‚àà A</code> as <code>A a</code> and does not make anything explicit. I attach the pictures <a href="/user_uploads/3121/BDva7h1AhSkRy6zj-LdZj1gw/Annotazione-2020-06-16-195745.png">Annotazione-2020-06-16-195745.png</a> <a href="/user_uploads/3121/pItntIMVjdyXKuLpF9Qy9aH0/Annotazione-2020-06-16-195616.png">Annotazione-2020-06-16-195616.png</a> <a href="/user_uploads/3121/eslpTpuMdl6_Fuu_THTybA-P/Annotazione-2020-06-16-195540.png">Annotazione-2020-06-16-195540.png</a> of the two propose tactics for clearance.</p>
<div class="message_inline_image"><a href="/user_uploads/3121/BDva7h1AhSkRy6zj-LdZj1gw/Annotazione-2020-06-16-195745.png" title="Annotazione-2020-06-16-195745.png"><img src="/user_uploads/3121/BDva7h1AhSkRy6zj-LdZj1gw/Annotazione-2020-06-16-195745.png"></a></div><div class="message_inline_image"><a href="/user_uploads/3121/pItntIMVjdyXKuLpF9Qy9aH0/Annotazione-2020-06-16-195616.png" title="Annotazione-2020-06-16-195616.png"><img src="/user_uploads/3121/pItntIMVjdyXKuLpF9Qy9aH0/Annotazione-2020-06-16-195616.png"></a></div><div class="message_inline_image"><a href="/user_uploads/3121/eslpTpuMdl6_Fuu_THTybA-P/Annotazione-2020-06-16-195540.png" title="Annotazione-2020-06-16-195540.png"><img src="/user_uploads/3121/eslpTpuMdl6_Fuu_THTybA-P/Annotazione-2020-06-16-195540.png"></a></div>



<a name="201052623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201052623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201052623">(Jun 16 2020 at 18:02)</a>:</h4>
<p>give us code we can cut/paste into our local editors (the jargon for this here is <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>)</p>



<a name="201052797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201052797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201052797">(Jun 16 2020 at 18:04)</a>:</h4>
<p>Your question doesn't seem to be about set membership, but rather the definition of the specific set you're interested in</p>



<a name="201053051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201053051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201053051">(Jun 16 2020 at 18:06)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">defs</span>

<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">instance</span> <span class="n">prod_manifold</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H</span> <span class="n">M</span><span class="o">]</span>
<span class="o">(</span><span class="n">H&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H&#39;</span><span class="o">]</span> <span class="o">(</span><span class="n">M&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">:</span> <span class="n">manifold</span> <span class="o">(</span><span class="n">H</span><span class="bp">√ó</span><span class="n">H&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span><span class="bp">√ó</span><span class="n">M&#39;</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">sorry</span><span class="o">,</span>

<span class="kn">instance</span> <span class="n">prod_smooth_manifold_with_corners</span> <span class="o">{</span><span class="err">ùïú</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">nondiscrete_normed_field</span> <span class="err">ùïú</span><span class="o">]</span>
  <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E</span><span class="o">]</span>
  <span class="o">{</span><span class="n">E&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E&#39;</span><span class="o">]</span>
  <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E</span> <span class="n">H</span><span class="o">)</span>
  <span class="o">{</span><span class="n">H&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H&#39;</span><span class="o">]</span> <span class="o">(</span><span class="n">I&#39;</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E&#39;</span> <span class="n">H&#39;</span><span class="o">)</span>
  <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I</span> <span class="n">M</span><span class="o">]</span>
  <span class="o">(</span><span class="n">M&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">smooth_manifold_with_corners</span> <span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">prod</span> <span class="n">I&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span><span class="bp">√ó</span><span class="n">M&#39;</span><span class="o">)</span> <span class="o">:=</span>
    <span class="o">{</span>
      <span class="n">compatible</span> <span class="o">:=</span>
      <span class="k">begin</span>
        <span class="n">intro</span> <span class="n">f</span><span class="o">,</span>
        <span class="n">intro</span> <span class="n">g</span><span class="o">,</span>
        <span class="n">intro</span> <span class="n">h_f</span><span class="o">,</span>
        <span class="n">intro</span> <span class="n">h_g</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">h_f</span> <span class="k">with</span> <span class="n">f1</span> <span class="n">temp</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp</span> <span class="k">with</span> <span class="n">hf1</span> <span class="n">temp2</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp2</span> <span class="k">with</span> <span class="n">f2</span> <span class="n">temp3</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp3</span> <span class="k">with</span> <span class="n">hf2</span> <span class="n">hf</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">hf</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">h_g</span> <span class="k">with</span> <span class="n">g1</span> <span class="n">temp</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp</span> <span class="k">with</span> <span class="n">hg1</span> <span class="n">temp2</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp2</span> <span class="k">with</span> <span class="n">g2</span> <span class="n">temp3</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp3</span> <span class="k">with</span> <span class="n">hg2</span> <span class="n">hg</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">hg</span><span class="o">,</span>
        <span class="n">simp</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_def</span><span class="o">,</span>
      <span class="kn">end</span><span class="o">,</span>
    <span class="o">}</span>
</code></pre></div>



<a name="201053194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201053194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201053194">(Jun 16 2020 at 18:08)</a>:</h4>
<p>Well the specific set I am interested in is a set defined by a property:</p>



<a name="201053698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201053698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201053698">(Jun 16 2020 at 18:12)</a>:</h4>
<p><code>dsimp</code> or <code>unfold members</code> might do it</p>



<a name="201053747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201053747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201053747">(Jun 16 2020 at 18:13)</a>:</h4>
<p><code>tidy</code> might do something useful, and you can interrogate it with <code>tidy?</code></p>



<a name="201054110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201054110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201054110">(Jun 16 2020 at 18:15)</a>:</h4>
<p>your example breaks for me at the first cases, maybe my mathlib is outdated</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">‚Ñï</span> <span class="bp">|</span> <span class="mi">2</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">‚àß</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="mi">4</span><span class="o">}</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">‚Ñï</span><span class="o">}</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">x</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">3</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">hn</span><span class="o">,</span>
  <span class="n">linarith</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201054227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201054227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201054227">(Jun 16 2020 at 18:16)</a>:</h4>
<p>the "operation" you're trying to do is to replace something with something else that's defeq</p>



<a name="201054258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201054258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201054258">(Jun 16 2020 at 18:16)</a>:</h4>
<p>so whatever you wanted to do after unfolding the definition, you can probably already do it</p>



<a name="201054753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201054753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201054753">(Jun 16 2020 at 18:20)</a>:</h4>
<p>Sorry, this should work! I might have put a sorry where I did not have to</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span><span class="bp">.</span><span class="n">defs</span>

<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">instance</span> <span class="n">prod_manifold</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H</span> <span class="n">M</span><span class="o">]</span>
<span class="o">(</span><span class="n">H&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H&#39;</span><span class="o">]</span> <span class="o">(</span><span class="n">M&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">:</span> <span class="n">manifold</span> <span class="o">(</span><span class="n">H</span><span class="bp">√ó</span><span class="n">H&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span><span class="bp">√ó</span><span class="n">M&#39;</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">atlas</span>            <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">f</span> <span class="o">:</span> <span class="o">(</span><span class="n">local_homeomorph</span> <span class="o">(</span><span class="n">M</span><span class="bp">√ó</span><span class="n">M&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span><span class="bp">√ó</span><span class="n">H&#39;</span><span class="o">)),</span>
                        <span class="bp">‚àÉ</span> <span class="n">g</span><span class="o">,</span> <span class="o">(</span><span class="n">g</span> <span class="err">‚àà</span> <span class="o">(</span><span class="n">manifold</span><span class="bp">.</span><span class="n">atlas</span> <span class="n">H</span> <span class="n">M</span><span class="o">))</span> <span class="bp">‚àß</span> <span class="o">(</span><span class="bp">‚àÉ</span> <span class="n">h</span><span class="o">,</span> <span class="o">(</span><span class="n">h</span> <span class="err">‚àà</span> <span class="o">(</span><span class="n">manifold</span><span class="bp">.</span><span class="n">atlas</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">))</span> <span class="bp">‚àß</span> <span class="o">(</span><span class="n">f</span> <span class="bp">=</span> <span class="o">(</span><span class="n">local_homeomorph</span><span class="bp">.</span><span class="n">prod</span> <span class="n">g</span> <span class="n">h</span><span class="o">))),</span>
  <span class="n">chart_at</span>         <span class="o">:=</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">x</span><span class="o">:</span> <span class="o">(</span><span class="n">M</span><span class="bp">√ó</span><span class="n">M&#39;</span><span class="o">),</span> <span class="n">local_homeomorph</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">manifold</span><span class="bp">.</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">manifold</span><span class="bp">.</span><span class="n">chart_at</span> <span class="n">H&#39;</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="o">)),</span>
  <span class="c">/-</span><span class="cm"> Why only H??? -/</span>
  <span class="n">mem_chart_source</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span><span class="o">,</span>
  <span class="n">chart_mem_atlas</span>  <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">(</span><span class="n">manifold</span><span class="bp">.</span><span class="n">chart_at</span> <span class="n">H</span> <span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">(</span><span class="n">manifold</span><span class="bp">.</span><span class="n">chart_at</span> <span class="n">H&#39;</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="o">),</span>
    <span class="n">simp</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">,}</span>

<span class="kn">instance</span> <span class="n">prod_smooth_manifold_with_corners</span> <span class="o">{</span><span class="err">ùïú</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">nondiscrete_normed_field</span> <span class="err">ùïú</span><span class="o">]</span>
  <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E</span><span class="o">]</span>
  <span class="o">{</span><span class="n">E&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E&#39;</span><span class="o">]</span>
  <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E</span> <span class="n">H</span><span class="o">)</span>
  <span class="o">{</span><span class="n">H&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H&#39;</span><span class="o">]</span> <span class="o">(</span><span class="n">I&#39;</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E&#39;</span> <span class="n">H&#39;</span><span class="o">)</span>
  <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I</span> <span class="n">M</span><span class="o">]</span>
  <span class="o">(</span><span class="n">M&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">manifold</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">smooth_manifold_with_corners</span> <span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">prod</span> <span class="n">I&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span><span class="bp">√ó</span><span class="n">M&#39;</span><span class="o">)</span> <span class="o">:=</span>
    <span class="o">{</span>
      <span class="n">compatible</span> <span class="o">:=</span>
      <span class="k">begin</span>
        <span class="n">intro</span> <span class="n">f</span><span class="o">,</span>
        <span class="n">intro</span> <span class="n">g</span><span class="o">,</span>
        <span class="n">intro</span> <span class="n">h_f</span><span class="o">,</span>
        <span class="n">intro</span> <span class="n">h_g</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">h_f</span> <span class="k">with</span> <span class="n">f1</span> <span class="n">temp</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp</span> <span class="k">with</span> <span class="n">hf1</span> <span class="n">temp2</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp2</span> <span class="k">with</span> <span class="n">f2</span> <span class="n">temp3</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp3</span> <span class="k">with</span> <span class="n">hf2</span> <span class="n">hf</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">hf</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">h_g</span> <span class="k">with</span> <span class="n">g1</span> <span class="n">temp</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp</span> <span class="k">with</span> <span class="n">hg1</span> <span class="n">temp2</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp2</span> <span class="k">with</span> <span class="n">g2</span> <span class="n">temp3</span><span class="o">,</span>
        <span class="n">cases</span> <span class="n">temp3</span> <span class="k">with</span> <span class="n">hg2</span> <span class="n">hg</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">hg</span><span class="o">,</span>
        <span class="n">simp</span><span class="o">,</span>

      <span class="kn">end</span><span class="o">,</span>
    <span class="o">}</span>
</code></pre></div>



<a name="201055019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201055019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201055019">(Jun 16 2020 at 18:22)</a>:</h4>
<p>i don't understand all this geometry, but maybe you find <code>split; dsimp,</code> interesting after the last line of your proof so far</p>



<a name="201057330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201057330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201057330">(Jun 16 2020 at 18:41)</a>:</h4>
<p>Thanks for your help! Basically what I was trying to do was simply to find a way to make the property explicit so that I could understand why <code>rw prod_coe_symm</code>, where</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">prod_coe_symm</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ±</span> <span class="n">Œ≤</span><span class="o">)</span> <span class="o">(</span><span class="n">e&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ≥</span> <span class="n">Œ¥</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">e</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="o">:</span> <span class="n">Œ≤</span> <span class="bp">√ó</span> <span class="n">Œ¥</span> <span class="bp">‚Üí</span> <span class="n">Œ±</span> <span class="bp">√ó</span> <span class="n">Œ≥</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">Œª</span><span class="n">p</span><span class="o">,</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">symm</span> <span class="n">p</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">e&#39;</span><span class="bp">.</span><span class="n">symm</span> <span class="n">p</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>


<p>fails:</p>
<div class="codehilite"><pre><span></span><code><span class="n">rewrite</span> <span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">did</span> <span class="n">not</span> <span class="n">find</span> <span class="kn">instance</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pattern</span> <span class="k">in</span> <span class="n">the</span> <span class="n">target</span> <span class="n">expression</span>
  <span class="err">‚áë</span><span class="o">((</span><span class="n">local_homeomorph</span><span class="bp">.</span><span class="n">prod</span> <span class="err">?</span><span class="n">m_9</span> <span class="err">?</span><span class="n">m_10</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span>
<span class="n">state</span><span class="o">:</span>
<span class="err">ùïú</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">nondiscrete_normed_field</span> <span class="err">ùïú</span><span class="o">,</span>
<span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">E</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_3</span> <span class="o">:</span> <span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E</span><span class="o">,</span>
<span class="n">E&#39;</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_4</span> <span class="o">:</span> <span class="n">normed_group</span> <span class="n">E&#39;</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_5</span> <span class="o">:</span> <span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E&#39;</span><span class="o">,</span>
<span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_6</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">H</span><span class="o">,</span>
<span class="n">I</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E</span> <span class="n">H</span><span class="o">,</span>
<span class="n">H&#39;</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_7</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">H&#39;</span><span class="o">,</span>
<span class="n">I&#39;</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E&#39;</span> <span class="n">H&#39;</span><span class="o">,</span>
<span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_8</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">M</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_9</span> <span class="o">:</span> <span class="n">manifold</span> <span class="n">H</span> <span class="n">M</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_10</span> <span class="o">:</span> <span class="n">smooth_manifold_with_corners</span> <span class="n">I</span> <span class="n">M</span><span class="o">,</span>
<span class="n">M&#39;</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_11</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">M&#39;</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_12</span> <span class="o">:</span> <span class="n">manifold</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_13</span> <span class="o">:</span> <span class="n">smooth_manifold_with_corners</span> <span class="n">I&#39;</span> <span class="n">M&#39;</span><span class="o">,</span>
<span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="o">(</span><span class="n">M</span> <span class="bp">√ó</span> <span class="n">M&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="bp">√ó</span> <span class="n">H&#39;</span><span class="o">),</span>
<span class="n">f1</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">M</span> <span class="n">H</span><span class="o">,</span>
<span class="n">hf1</span> <span class="o">:</span> <span class="n">f1</span> <span class="err">‚àà</span> <span class="n">atlas</span> <span class="n">H</span> <span class="n">M</span><span class="o">,</span>
<span class="n">f2</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">M&#39;</span> <span class="n">H&#39;</span><span class="o">,</span>
<span class="n">hf2</span> <span class="o">:</span> <span class="n">f2</span> <span class="err">‚àà</span> <span class="n">atlas</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">,</span>
<span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f1</span><span class="bp">.</span><span class="n">prod</span> <span class="n">f2</span><span class="o">,</span>
<span class="n">g1</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">M</span> <span class="n">H</span><span class="o">,</span>
<span class="n">hg1</span> <span class="o">:</span> <span class="n">g1</span> <span class="err">‚àà</span> <span class="n">atlas</span> <span class="n">H</span> <span class="n">M</span><span class="o">,</span>
<span class="n">g2</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">M&#39;</span> <span class="n">H&#39;</span><span class="o">,</span>
<span class="n">hg2</span> <span class="o">:</span> <span class="n">g2</span> <span class="err">‚àà</span> <span class="n">atlas</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">,</span>
<span class="n">hg</span> <span class="o">:</span> <span class="n">g</span> <span class="bp">=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">prod</span> <span class="n">g2</span>
<span class="err">‚ä¢</span> <span class="o">(</span><span class="n">f1</span><span class="bp">.</span><span class="n">prod</span> <span class="n">f2</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">g1</span><span class="bp">.</span><span class="n">prod</span> <span class="n">g2</span><span class="o">)</span> <span class="err">‚àà</span> <span class="o">(</span><span class="n">times_cont_diff_groupoid</span> <span class="err">‚ä§</span> <span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">prod</span> <span class="n">I&#39;</span><span class="o">))</span><span class="bp">.</span><span class="n">members</span>
</code></pre></div>


<p>indeed it looks pretty easy to me to see where the instance of the pattern in the target expression is (<code>(f1.prod f2).symm</code>) and I do not understand why Lean does not recognize it.<br>
In particular I was not really looking to go on with the proof but simply to find out why I cannot rewrite this lemma, but I guess there is not a simple way to make this goal explicit (the tactic you suggested either time out or require me to write the set name inside the code, and Lean does not recognize the set name). Do you have any idea why lean does not recognize the target expression?</p>



<a name="201058739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201058739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201058739">(Jun 16 2020 at 18:54)</a>:</h4>
<p>I think the issue is that the lemma is about the coercion of <code>(f1.prod f2).symm</code> to a function, but your goal does not have this coercion.</p>



<a name="201059422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201059422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201059422">(Jun 16 2020 at 18:58)</a>:</h4>
<p>Your goal is an assertion about a local homeomorphism, not a function. You might think "a local homeomorphism _is_ a function!" but this is not true in Lean -- they have different types so it's meaningless to say that they're equal. There's an "invisible function" which takes the local homeo to a function, and this invisible function isn't there in the goal, but it is there in the lemma you're trying to use to rewrite.</p>



<a name="201059470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201059470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201059470">(Jun 16 2020 at 18:59)</a>:</h4>
<p>it's also in the name <code>coe</code></p>



<a name="201059518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201059518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201059518">(Jun 16 2020 at 18:59)</a>:</h4>
<p>The invisible function in this case is called a coercion.</p>



<a name="201059694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201059694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201059694">(Jun 16 2020 at 19:01)</a>:</h4>
<p>And it's not invisible in the error message <code>‚áë((local_homeomorph.prod ?m_9 ?m_10).symm)</code>, that's the first character.</p>



<a name="201059765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201059765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201059765">(Jun 16 2020 at 19:01)</a>:</h4>
<p>indeed, Lean can see it -- it's just invisible to mathematicians :-)</p>



<a name="201060854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201060854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201060854">(Jun 16 2020 at 19:11)</a>:</h4>
<p>If you want to go to concrete goals, you can use <code>rw [times_cont_diff_groupoid, mem_groupoid_of_pregroupoid], simp, split,</code> but I'm not sure it's the recomended way (only S√©bastien could tell us).</p>



<a name="201069525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201069525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201069525">(Jun 16 2020 at 20:26)</a>:</h4>
<p>First, I would clean up the expression of your map. Can you prove lemmas such as</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">prod_symm</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ±</span> <span class="n">Œ≤</span><span class="o">)</span> <span class="o">(</span><span class="n">e&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ≥</span> <span class="n">Œ¥</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">=</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">symm</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">sorry</span>

<span class="kn">lemma</span> <span class="n">prod_comp</span> <span class="o">{</span><span class="n">Œ∑</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">Œµ</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">Œ∑</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">Œµ</span><span class="o">]</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ±</span> <span class="n">Œ≤</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ≤</span> <span class="n">Œ≥</span><span class="o">)</span>
  <span class="o">(</span><span class="n">e&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ¥</span> <span class="n">Œ∑</span><span class="o">)</span> <span class="o">(</span><span class="n">f&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">Œ∑</span> <span class="n">Œµ</span><span class="o">):</span>
  <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">prod</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">trans</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">e&#39;</span><span class="bp">.</span><span class="n">trans</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">sorry</span>
</code></pre></div>


<p>(When you want to prove that two objects are equal, a good method is to start with <code>ext x</code>. Sometimes, <code>ext</code> tries to do too much, and then <code>ext x : 1</code> is better).</p>



<a name="201069659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201069659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201069659">(Jun 16 2020 at 20:27)</a>:</h4>
<p>(These should be in the library, but you just found one of many holes: it just means that until now no one has really needed to use thoroughly products of local homeos).</p>



<a name="201070270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201070270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201070270">(Jun 16 2020 at 20:32)</a>:</h4>
<p>I have posted working proofs at <a href="https://gist.github.com/sgouezel/d8ea6cc252be22590f5c16574eb47608">https://gist.github.com/sgouezel/d8ea6cc252be22590f5c16574eb47608</a>, but in case you want to come up with your own solutions I am not posting them here to avoid spoiling.</p>



<a name="201165528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201165528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201165528">(Jun 17 2020 at 16:24)</a>:</h4>
<p>Ok, thanks a lot to everybody! I admit I had no idea what coercion was so I did not recognize <code>coe</code> in the name of the function. Now that I know about its existence I proved and used the lemma <code>prod_symm</code> by Sebastian to rewrite the goal as I wanted and it worked. However, I still have no idea whatsoever on how to approach hypotheses and goals of the form <code>e ‚àà times_cont_diff_groupoid ‚ä§ I</code>. I gave up on rewriting it as the defining propositions as I cannot mange to make the suggested tactics work. As Jalex suggested I am trying to think <code>e ‚àà times_cont_diff_groupoid ‚ä§ I</code> as if its defining property were written instead. As <code>e ‚àà (times_cont_diff_groupoid ‚ä§ I)</code> is defined to be <code>e ‚àà (times_cont_diff_groupoid ‚ä§ I).members</code> and in this case <code>(times_cont_diff_groupoid ‚ä§ I).members</code> is defined to be <code> {e : local_homeomorph H H | PG.property e e.source ‚àß PG.property e.symm e.target}</code> for some pregroupoid <code>PG</code> I would expect to make some progress with a hypothesis<code>h: (e ‚àà times_cont_diff_groupoid ‚ä§ I)</code> by writing <code> cases h with h1 h2</code> and obtain something I can work with, however when doing so I get the following:</p>
<div class="codehilite"><pre><span></span><code><span class="n">h1</span><span class="o">:</span>
  <span class="o">{</span><span class="n">property</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">H</span> <span class="bp">‚Üí</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">H</span><span class="o">),</span>
                 <span class="n">times_cont_diff_on</span> <span class="err">ùïú</span> <span class="err">‚ä§</span> <span class="o">(</span><span class="err">‚áë</span><span class="n">I</span> <span class="err">‚àò</span> <span class="n">f</span> <span class="err">‚àò</span> <span class="err">‚áë</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">))</span> <span class="o">(</span><span class="err">‚áë</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="bp">‚Åª¬π</span><span class="err">&#39;</span> <span class="n">s</span> <span class="err">‚à©</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="err">‚áë</span><span class="n">I</span><span class="o">),</span>
   <span class="n">comp</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
   <span class="n">id_mem</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
   <span class="n">locality</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
   <span class="n">congr</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">}</span><span class="bp">.</span><span class="n">property</span>
    <span class="err">‚áë</span><span class="n">e</span>
    <span class="n">e</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">source</span><span class="o">,</span>
<span class="n">h2</span> <span class="o">:</span>
  <span class="o">{</span><span class="n">property</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">H</span> <span class="bp">‚Üí</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">H</span><span class="o">),</span>
                 <span class="n">times_cont_diff_on</span> <span class="err">ùïú</span> <span class="err">‚ä§</span> <span class="o">(</span><span class="err">‚áë</span><span class="n">I</span> <span class="err">‚àò</span> <span class="n">f</span> <span class="err">‚àò</span> <span class="err">‚áë</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">))</span> <span class="o">(</span><span class="err">‚áë</span><span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="bp">‚Åª¬π</span><span class="err">&#39;</span> <span class="n">s</span> <span class="err">‚à©</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="err">‚áë</span><span class="n">I</span><span class="o">),</span>
   <span class="n">comp</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
   <span class="n">id_mem</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
   <span class="n">locality</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">,</span>
   <span class="n">congr</span> <span class="o">:=</span> <span class="bp">_</span><span class="o">}</span><span class="bp">.</span><span class="n">property</span>
    <span class="err">‚áë</span><span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span>
    <span class="n">e</span><span class="bp">.</span><span class="n">to_local_equiv</span><span class="bp">.</span><span class="n">target</span>
</code></pre></div>


<p>suggesting things are not really going as I expect and suggesting that even if <code>times_cont_diff_groupoid ‚ä§ I</code> should be a groupoid, things are stored inside still as a pregroupoid. If it were actually a groupoid I would use the lemma <code>mem_groupoid_of_pregroupoid</code>, but lean won't accept this because indeed <code>times_cont_diff_groupoid ‚ä§ I</code> is a groupoid (is there a way to have it back as a pregroupoid)? So I am still looking for some advice on how to deal with hypotheses and goals of this kind, if anybody has some!</p>



<a name="201165766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201165766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201165766">(Jun 17 2020 at 16:26)</a>:</h4>
<p><code>dsimp at h1</code> should make things a little nicer</p>



<a name="201165850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201165850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201165850">(Jun 17 2020 at 16:27)</a>:</h4>
<p>You can always just use <code>change</code> to unfold definitions to the form you want</p>



<a name="201165890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201165890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201165890">(Jun 17 2020 at 16:27)</a>:</h4>
<p>that said, I would also expect your <code>cases h</code> to work so maybe something else is going on</p>



<a name="201166862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201166862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201166862">(Jun 17 2020 at 16:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="252300">Jalex Stark</span> <a href="#narrow/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin/near/201165766">said</a>:</p>
<blockquote>
<p><code>dsimp at h1</code> should make things a little nicer</p>
</blockquote>
<p>The problem with <code>simp</code>, <code>dsimp</code>, <code>rw</code> and all of those tactics is that they just rewrite the hypotheses in a way which is almost identical with the definition. For example <code>dsimp</code> rewrites <code>e ‚àà (times_cont_diff_groupoid ‚ä§ I)</code> as <code>e ‚àà (times_cont_diff_groupoid ‚ä§ I).members</code> and this does not really help me as I already knew the two were equivalent and what I need to do here is to transform things so that I get everything expressed with <code>times_cont_diff</code> from calculus and then I can use the lemmas from the calculus library.</p>



<a name="201167081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201167081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201167081">(Jun 17 2020 at 16:37)</a>:</h4>
<p><code>dsimp [times_cont_diff_groupoid] at h1</code> maybe</p>



<a name="201167265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201167265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201167265">(Jun 17 2020 at 16:38)</a>:</h4>
<p>Sorry, I only meant that it should collapse <code>{property := x, ...}.property</code> into <code>x</code></p>



<a name="201168301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201168301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201168301">(Jun 17 2020 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="252300">Jalex Stark</span> <a href="#narrow/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin/near/201167265">said</a>:</p>
<blockquote>
<p>Sorry, I only meant that it should collapse <code>{property := x, ...}.property</code> into <code>x</code></p>
</blockquote>
<p>Oh right sorry to you, I just got confused between the notation I am using in my file and I thought you meant a different thing. What you suggest does make things nicer even if things are still a bit different from what I expect: they are not just the properties defining the set applied to <code>e</code> but a lot of coercions (shift symbols) seem to appear, so I will try to read a bit more from the tutorial before going on as I don't really know about them. Thanks a lot fot the help!</p>



<a name="201171720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201171720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201171720">(Jun 17 2020 at 17:13)</a>:</h4>
<p>If you give a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> I can have a look.</p>



<a name="201176614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Way%20to%20rewrite%20goal%20containing%20%5Cin/near/201176614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Way.20to.20rewrite.20goal.20containing.20.5Cin.html#201176614">(Jun 17 2020 at 17:48)</a>:</h4>
<p>Ok thanks a lot! I will try a bit more on my own and then come back if I won't have managed!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>