---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/dsimp.20strange.20behaviour.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html">dsimp strange behaviour</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="215559994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215559994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215559994">(Nov 04 2020 at 09:50)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">nat</span>
<span class="kn">open</span> <span class="n">has_add</span>

<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">add</span><span class="o">],</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>doesn't work but it works once I say <code>import tactic</code>?</p>



<a name="215560345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215560345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215560345">(Nov 04 2020 at 09:55)</a>:</h4>
<p>I can't reproduce.</p>



<a name="215560354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215560354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215560354">(Nov 04 2020 at 09:55)</a>:</h4>
<p><del>For me it fails with and without the import, with the same error</del></p>



<a name="215560447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215560447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215560447">(Nov 04 2020 at 09:56)</a>:</h4>
<p>Copy-pasto... let me try again</p>



<a name="215560521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215560521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215560521">(Nov 04 2020 at 09:57)</a>:</h4>
<p>Now it just hangs... with the import</p>



<a name="215560854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215560854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215560854">(Nov 04 2020 at 10:00)</a>:</h4>
<p>Thorsten, what are you expecting on paper? This proof won't work, no matter how much you unfold stuff. You need to use associativity.</p>



<a name="215560963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215560963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215560963">(Nov 04 2020 at 10:01)</a>:</h4>
<p>I don't think you need associativity? Since this works</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">open</span> <span class="n">nat</span>
<span class="kn">open</span> <span class="n">has_add</span>

<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">+</span> <span class="n">n'</span><span class="o">)</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">=</span> <span class="n">n'.succ</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>So I think Thorsten is just expecting <code>dsimp</code> to do what my <code>change</code> line did.</p>



<a name="215561348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215561348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215561348">(Nov 04 2020 at 10:05)</a>:</h4>
<p>Oh right. Relying on definitional equality is <em>so</em> weird.</p>



<a name="215561460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215561460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215561460">(Nov 04 2020 at 10:06)</a>:</h4>
<p>(This case of associativity is indeed definitional)</p>



<a name="215561734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215561734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215561734">(Nov 04 2020 at 10:09)</a>:</h4>
<p>So the issue is that, if you don't want to use <code>change</code>, you need to unfold stuff and then refold some (differently). I don't think we have any tactic doing that besides <code>change</code> (or its twin <code>show</code>).</p>



<a name="215561785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215561785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215561785">(Nov 04 2020 at 10:09)</a>:</h4>
<p>Ok, originally I defined add myself:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">test</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">def</span> <span class="n">add</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span>
<span class="bp">|</span> <span class="n">n</span> <span class="n">zero</span>     <span class="o">:=</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">(</span><span class="n">succ</span> <span class="n">m</span><span class="o">)</span> <span class="o">:=</span> <span class="n">succ</span> <span class="o">(</span><span class="n">add</span> <span class="n">n</span> <span class="n">m</span><span class="o">)</span>

<span class="kn">local</span> <span class="kd">notation</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">add</span> <span class="n">m</span> <span class="n">n</span>

<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">add</span><span class="o">],</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">test</span>
</code></pre></div>
<p>I thought I am just reproducing the definition of + from the standard library but it seems this is different.</p>



<a name="215561914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215561914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215561914">(Nov 04 2020 at 10:11)</a>:</h4>
<p>In my course I first ask students to show that +,* are a semiaring but then I tell them to use the ring tactic. I wanted to use the official definition of + actually.</p>



<a name="215562083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562083">(Nov 04 2020 at 10:13)</a>:</h4>
<p>OK I shouldn't rely on dsimp , fair enough. It is how I am used to work simplify using definitions but I understand this is nt the lean way because dsimp does more things than I expect.</p>



<a name="215562101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562101">(Nov 04 2020 at 10:13)</a>:</h4>
<p>Your last snippet is clearly (technologically) different since you're not using at all <code>has_add</code>, which is what you need to refold in the other proof.</p>



<a name="215562127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562127">(Nov 04 2020 at 10:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/dsimp.20strange.20behaviour/near/215560521">said</a>:</p>
<blockquote>
<p>Now it just hangs... with the import</p>
</blockquote>
<p>btw I think this is because <code>nat.add</code> is <code>protected</code>, so <code>dsimp [(+), add]</code> is just <code>dsimp [(+), has_add.add]</code> so it's looping.</p>



<a name="215562218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562218">(Nov 04 2020 at 10:14)</a>:</h4>
<p>No, it's not <code>dsimp</code> doing more than you expect. When you use <code>has_add</code> there are more things to unfold than with your def of <code>add</code> and custom non-polymorphic notation.</p>



<a name="215562236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562236">(Nov 04 2020 at 10:14)</a>:</h4>
<p>but if I don't open has_add it doesn't work at all?</p>



<a name="215562273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562273">(Nov 04 2020 at 10:15)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">test</span>

<span class="kn">open</span> <span class="n">nat</span>


<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">add</span><span class="o">],</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">test</span>
</code></pre></div>
<p>fails.</p>



<a name="215562299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562299">(Nov 04 2020 at 10:15)</a>:</h4>
<p>Of course, there is no <code>add</code> in the root namespace.</p>



<a name="215562301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562301">(Nov 04 2020 at 10:15)</a>:</h4>
<p>That's because <code>nat.add</code> is <code>protected</code>, so even if you have <code>open nat</code> you still need to write <code>nat.add</code></p>



<a name="215562390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562390">(Nov 04 2020 at 10:16)</a>:</h4>
<p>Right, both <code>nat.add</code> and <code>has_add.add</code> are hidden here, for different reasons.</p>



<a name="215562426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562426">(Nov 04 2020 at 10:17)</a>:</h4>
<p>If I use nat.add my rewrite doesn't work.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">test</span>

<span class="kn">open</span> <span class="n">nat</span>


<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">nat.add</span><span class="o">],</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">test</span>
</code></pre></div>



<a name="215562447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562447">(Nov 04 2020 at 10:17)</a>:</h4>
<p>Maybe it is easier if I use my own definition and instantiate ring to this one?</p>



<a name="215562517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562517">(Nov 04 2020 at 10:18)</a>:</h4>
<p>Why do you want to use <code>dsimp</code> instead of <code>show</code>?</p>



<a name="215562545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562545">(Nov 04 2020 at 10:18)</a>:</h4>
<p>Maybe because I don't know show?</p>



<a name="215562568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562568">(Nov 04 2020 at 10:18)</a>:</h4>
<p>It's the same as <code>change</code>.</p>



<a name="215562583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562583">(Nov 04 2020 at 10:18)</a>:</h4>
<p>Do you understand what I wrote about refolding?</p>



<a name="215562590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562590">(Nov 04 2020 at 10:19)</a>:</h4>
<p>Because I just want lean to simplify the term.</p>



<a name="215562605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562605">(Nov 04 2020 at 10:19)</a>:</h4>
<p>No, you don't want to simplify</p>



<a name="215562620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562620">(Nov 04 2020 at 10:19)</a>:</h4>
<p>You want to unfold and then refold.</p>



<a name="215562656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562656">(Nov 04 2020 at 10:19)</a>:</h4>
<p>Do you use VSCode? Do you know how to use the tactic state widget to understand what is the meaning of each notation?</p>



<a name="215562706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562706">(Nov 04 2020 at 10:20)</a>:</h4>
<p>I want to apply an equation that follows from the definition of the function. It works for my own definition and I thought that the library definition behaves the same way.</p>



<a name="215562720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562720">(Nov 04 2020 at 10:20)</a>:</h4>
<p>No I am using emacs.</p>



<a name="215562754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562754">(Nov 04 2020 at 10:20)</a>:</h4>
<p>You should just try out VScode once to experience the tactic state widget</p>



<a name="215562769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562769">(Nov 04 2020 at 10:20)</a>:</h4>
<p>Your students will love it</p>



<a name="215562789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562789">(Nov 04 2020 at 10:21)</a>:</h4>
<p>Can you copy-paste the way you see tactic state in emacs after the dsimp?</p>



<a name="215562790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562790">(Nov 04 2020 at 10:21)</a>:</h4>
<p>They use VScode anyway. At leats some of them.</p>



<a name="215562811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562811">(Nov 04 2020 at 10:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271218">Thorsten Altenkirch</span> <a href="#narrow/stream/113489-new-members/topic/dsimp.20strange.20behaviour/near/215562706">said</a>:</p>
<blockquote>
<p>I want to apply an equation that follows from the definition of the function. It works for my own definition and I thought that the library definition behaves the same way.</p>
</blockquote>
<p>Does <code>erw</code> work, instead of the <code>rw</code>?</p>



<a name="215562829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562829">(Nov 04 2020 at 10:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">n'</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span>
<span class="n">ih</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n'</span> <span class="bp">=</span> <span class="n">n'</span>
<span class="bp">⊢</span> <span class="o">(</span><span class="mi">0</span><span class="bp">.</span><span class="n">add</span> <span class="n">n'</span><span class="o">)</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">=</span> <span class="n">n'.succ</span>
</code></pre></div>



<a name="215562833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562833">(Nov 04 2020 at 10:21)</a>:</h4>
<p>You need to understand the meaning of notations there.</p>



<a name="215562861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562861">(Nov 04 2020 at 10:22)</a>:</h4>
<p>Ok, great. What is <code>+</code> on line 2 and what is <code>.add</code> on line 3 in your opinion?</p>



<a name="215562936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562936">(Nov 04 2020 at 10:22)</a>:</h4>
<p>I just looked for a way to explain and use the definition of add.</p>



<a name="215562962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562962">(Nov 04 2020 at 10:22)</a>:</h4>
<p><span class="user-mention" data-user-id="271218">@Thorsten Altenkirch</span> Voila:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">test</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">nat.add</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">test</span>
</code></pre></div>



<a name="215562973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562973">(Nov 04 2020 at 10:22)</a>:</h4>
<p>How come it works for my own definition?</p>



<a name="215562998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215562998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215562998">(Nov 04 2020 at 10:23)</a>:</h4>
<p>Is your own definition using <code>+</code> notation?</p>



<a name="215563010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563010">(Nov 04 2020 at 10:23)</a>:</h4>
<p>As in, did you define an instance of <code>has_add</code> for it?</p>



<a name="215563016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563016">(Nov 04 2020 at 10:23)</a>:</h4>
<p>Here is how you answer those crucial question in VSCode:<br>
<a href="/user_uploads/3121/vM5z8RsggJ-NTVmnbgRDPtEX/thorsten.gif">thorsten.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/vM5z8RsggJ-NTVmnbgRDPtEX/thorsten.gif" title="thorsten.gif"><img src="/user_uploads/3121/vM5z8RsggJ-NTVmnbgRDPtEX/thorsten.gif"></a></div>



<a name="215563027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563027">(Nov 04 2020 at 10:23)</a>:</h4>
<p>Johan, I already told all that to Thorsten.</p>



<a name="215563082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563082">(Nov 04 2020 at 10:24)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">test</span>

<span class="kn">open</span> <span class="n">nat</span>


<span class="kd">def</span> <span class="n">add</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span>
<span class="bp">|</span> <span class="n">n</span> <span class="n">zero</span>     <span class="o">:=</span> <span class="n">n</span>
<span class="bp">|</span> <span class="n">n</span> <span class="o">(</span><span class="n">succ</span> <span class="n">m</span><span class="o">)</span> <span class="o">:=</span> <span class="n">succ</span> <span class="o">(</span><span class="n">add</span> <span class="n">n</span> <span class="n">m</span><span class="o">)</span>

<span class="kn">local</span> <span class="kd">notation</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">add</span> <span class="n">m</span> <span class="n">n</span>


<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">nat.add</span><span class="o">],</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">test</span>
</code></pre></div>
<p>works</p>



<a name="215563086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563086">(Nov 04 2020 at 10:24)</a>:</h4>
<p><span class="user-mention" data-user-id="271218">@Thorsten Altenkirch</span> I think you want to <code>dsimp</code> at <code>ih</code> and the goal</p>



<a name="215563097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563097">(Nov 04 2020 at 10:24)</a>:</h4>
<p>He is not using <code>has_add.add</code> at all in his custom example hence there is no need to refold <code>nat.add</code> into <code>has_add.add</code></p>



<a name="215563125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563125">(Nov 04 2020 at 10:24)</a>:</h4>
<p><span class="user-mention" data-user-id="271218">@Thorsten Altenkirch</span> there is a <code>has_add.add</code> in <code>ih</code> blocking your rewrite.</p>



<a name="215563152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563152">(Nov 04 2020 at 10:25)</a>:</h4>
<p>That's why my code is working, because I <code>dsimp at *</code></p>



<a name="215563186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563186">(Nov 04 2020 at 10:25)</a>:</h4>
<p>OK so there is no way to port my way of using dsimp in my example to using the library definition of +?</p>



<a name="215563194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563194">(Nov 04 2020 at 10:25)</a>:</h4>
<p>At the stage where things go wrong, my VSCode screencast show he has <code>has_add.add</code> in the assumption but not in the goal, hence need to reintroduce it in the goal or unfold it in the assumption.</p>



<a name="215563203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563203">(Nov 04 2020 at 10:25)</a>:</h4>
<p>In particular <code>local notation m + n := add m n</code> is not syntactically equal to using <code>has_add.add</code></p>



<a name="215563382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563382">(Nov 04 2020 at 10:27)</a>:</h4>
<p>I understand partially why it doesn't work but basically the conclusion is that I cannot easily simulate the behaviour of my own definition using the library.</p>



<a name="215563494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563494">(Nov 04 2020 at 10:28)</a>:</h4>
<p>That seems 100% fair. The library is meant to handle extremely general stuff, where the addition symbol could mean hundreds of things, it does make things a bit more complicated.</p>



<a name="215563541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563541">(Nov 04 2020 at 10:29)</a>:</h4>
<p>The library has this extra <code>has_add</code> layer.</p>



<a name="215563590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563590">(Nov 04 2020 at 10:29)</a>:</h4>
<p>I guess I should have just proven the definitional equations and then used rewrite and completely avoid dsimp?</p>



<a name="215563673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563673">(Nov 04 2020 at 10:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271218">Thorsten Altenkirch</span> <a href="#narrow/stream/113489-new-members/topic/dsimp.20strange.20behaviour/near/215563382">said</a>:</p>
<blockquote>
<p>I understand partially why it doesn't work but basically the conclusion is that I cannot easily simulate the behaviour of my own definition using the library.</p>
</blockquote>
<p>Well... if you <code>dsimp</code> away the <code>has_add.add</code> <em>everywhere</em>, then after that you should be in a state that's similar to your own definition.</p>



<a name="215563711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563711">(Nov 04 2020 at 10:30)</a>:</h4>
<p>I don't see why you are ok with dsimping it away in the goal, but don't like the idea of dsimping it away in assumptions as well.</p>



<a name="215563764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215563764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215563764">(Nov 04 2020 at 10:31)</a>:</h4>
<p>Because I just want to dsimp the goal, that is reduce using definitional equations.</p>



<a name="215564114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215564114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215564114">(Nov 04 2020 at 10:34)</a>:</h4>
<p>Well, if you insist on only dsimping the goal:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">namespace</span> <span class="n">test</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">revert</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">dsimp</span> <span class="o">[(</span><span class="bp">+</span><span class="o">),</span><span class="n">nat.add</span><span class="o">],</span>
  <span class="n">intro</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">end</span> <span class="n">test</span>
</code></pre></div>



<a name="215568622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215568622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215568622">(Nov 04 2020 at 11:28)</a>:</h4>
<p>Thank you, but I don't think this is pedagogically helpful.</p>



<a name="215568832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215568832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215568832">(Nov 04 2020 at 11:31)</a>:</h4>
<p>Ok, I understand that it may be a god idea to package away definitional equalities. However, I do find it useful to be able to apply them easily when defining a function. It does work for my own definition of + but I can't simulate this with the library definition. Maybe for good reasons but this spoils the way I wanted to explain things. I guess maybe what I want to do is to prove the definitional equalities and then add them to dsimp and not to use has_add. How would I go about this?</p>



<a name="215571895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215571895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215571895">(Nov 04 2020 at 12:09)</a>:</h4>
<p><span class="user-mention" data-user-id="271218">@Thorsten Altenkirch</span> if you want to use the mathlib, then you need to use <code>has_add</code>. And this <code>has_add</code> will be part of the type of <code>ih</code>. I don't see a way around this.</p>



<a name="215573263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215573263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215573263">(Nov 04 2020 at 12:26)</a>:</h4>
<p>So basically I shouldn't use dsimp but prove the definitional equalities and then rewrite with them?</p>



<a name="215573445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215573445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215573445">(Nov 04 2020 at 12:28)</a>:</h4>
<p>I mean I don't want to use the math lib when I am re-proving that Nat is a semiring - obviously. But once we have done this I am happy to use ring. However, I would like that the tactics I have introduced before still work. If I understand you correctly, then basically I shouldn't use dsimp?</p>



<a name="215573604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215573604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215573604">(Nov 04 2020 at 12:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="271218">Thorsten Altenkirch</span> <a href="#narrow/stream/113489-new-members/topic/dsimp.20strange.20behaviour/near/215573263">said</a>:</p>
<blockquote>
<p>So basically shouldn't use dsimp but prove the definitional equalities and then rewrite with them?</p>
</blockquote>
<p>This will not help you if you don't want to rewrite at <code>ih</code>.</p>



<a name="215573783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215573783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215573783">(Nov 04 2020 at 12:33)</a>:</h4>
<p>I mean</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">add_succ</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">succ</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">succ</span> <span class="o">(</span><span class="n">m</span> <span class="bp">+</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">m</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">reflexivity</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">theorem</span> <span class="n">add_lneutr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">n</span>  <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">assume</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">n</span> <span class="k">with</span> <span class="n">n'</span> <span class="n">ih</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
  <span class="n">rewrite</span> <span class="n">add_succ</span><span class="o">,</span>
  <span class="n">rewrite</span> <span class="n">ih</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="215573990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215573990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215573990">(Nov 04 2020 at 12:35)</a>:</h4>
<p>Ooh, ok, that would work yes. Because <code>add_succ</code> mentions <code>+</code> on both sides</p>



<a name="215574333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215574333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thorsten Altenkirch <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215574333">(Nov 04 2020 at 12:39)</a>:</h4>
<p>I better don't comment on lean's notation mechanism. Seriously, have a look at agda...</p>



<a name="215574534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215574534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215574534">(Nov 04 2020 at 12:41)</a>:</h4>
<p>Seriously, we are all waiting for Lean 4 to happen (-;</p>



<a name="215574639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215574639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215574639">(Nov 04 2020 at 12:42)</a>:</h4>
<p>Also, seriously, I have no idea whether agda's notation mechanism can deal with an algebraic hierarchy similar to what we have in mathlib. (But that's mainly because I have no experience with agda at all.)</p>



<a name="215586439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215586439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215586439">(Nov 04 2020 at 14:20)</a>:</h4>
<p>Thorsten, this doesn't really have to do with notation at all, but rather type classes.</p>



<a name="215586804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215586804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215586804">(Nov 04 2020 at 14:22)</a>:</h4>
<p>The global <code>+</code> notation refers to <code>has_add.add</code> not (say) <code>nat.add</code>. The cost is that there is this extra layer of indirection which may need to be unfolded. The gain is that we can use <code>+</code> everywhere and it just works, and we can use a single set of lemmas like <code>add_zero</code> to reason about it.</p>



<a name="215586846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215586846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215586846">(Nov 04 2020 at 14:23)</a>:</h4>
<p>From what I have seen of Agda, it doesn't attempt to address this at all.</p>



<a name="215592650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215592650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215592650">(Nov 04 2020 at 15:05)</a>:</h4>
<p><span class="user-mention" data-user-id="271218">@Thorsten Altenkirch</span> In Agda, can I say: "let <code>G</code> be an additive group", and use <code>+</code> for its group operation?</p>



<a name="215592855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215592855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215592855">(Nov 04 2020 at 15:06)</a>:</h4>
<p>or "let <code>R</code> and <code>S</code> be rings, <code>M</code> an <code>R</code>-module and <code>N</code> an <code>S</code>-module" and then use <code>+</code> for addition in all of them?</p>



<a name="215593409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215593409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215593409">(Nov 04 2020 at 15:09)</a>:</h4>
<p>but just writing expressions is only half the story--we also want to uniformly reason about these situations by rewriting with <code>add_comm</code>, or using tactics like <code>abel</code></p>



<a name="215635363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215635363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215635363">(Nov 04 2020 at 20:13)</a>:</h4>
<p>pedagogically I would just avoid redefining the <code>+</code> syntax - you are running into extra weirdness because of it, it's fundamentally not a very basic part of the programming language, so you're kind of running into these weird meta-type-problem things and your students will run into them too. if you want to prove basic arithmetic stuff in order to teach how it works, just stick with calling it <code>add</code></p>



<a name="215639433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/dsimp%20strange%20behaviour/near/215639433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/dsimp.20strange.20behaviour.html#215639433">(Nov 04 2020 at 20:49)</a>:</h4>
<p>and/or make a local notation to clobber the global <code>+</code> to make it look good</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>