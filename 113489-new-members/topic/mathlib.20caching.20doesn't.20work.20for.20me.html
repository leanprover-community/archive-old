---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html">mathlib caching doesn't work for me</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="319283210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319283210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Geoffrey Irving <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319283210">(Jan 03 2023 at 21:29)</a>:</h4>
<p>Each time I upgrade mathlib using <code>leanproject upgrade-mathlib</code>, it downloads a bunch of cache files but then seems to ignore the cache when I go to rebuild my project (it rebuilds a ton of mathlib files).   This makes builds after upgrades take a long time.  Any ideas why the caching might not be working?  I'm on an M1 Mac if that's relevant, and using Lean from homebrew rather than elan since when I first installed Lean elan didn't support M1.</p>



<a name="319290222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319290222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319290222">(Jan 03 2023 at 22:22)</a>:</h4>
<p>Does <code>lean --version</code> output something that matches the contents of your <code>leanproject.toml</code>?</p>



<a name="319291202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319291202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Geoffrey Irving <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319291202">(Jan 03 2023 at 22:30)</a>:</h4>
<p>It looks like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">%</span> <span class="n">lean</span> <span class="c1">--version</span>
<span class="n">Lean</span> <span class="o">(</span><span class="n">version</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">50</span><span class="bp">.</span><span class="mi">3</span><span class="o">,</span> <span class="n">Release</span><span class="o">)</span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">package</span><span class="o">]</span>
<span class="n">name</span> <span class="bp">=</span> <span class="s2">"ray"</span>
<span class="n">version</span> <span class="bp">=</span> <span class="s2">"0.1"</span>
<span class="n">lean_version</span> <span class="bp">=</span> <span class="s2">"leanprover-community/lean:3.50.3"</span>
<span class="n">path</span> <span class="bp">=</span> <span class="s2">"src"</span>

<span class="o">[</span><span class="n">dependencies</span><span class="o">]</span>
<span class="n">mathlib</span> <span class="bp">=</span> <span class="o">{</span><span class="n">git</span> <span class="bp">=</span> <span class="s2">"https://github.com/leanprover-community/mathlib"</span><span class="o">,</span> <span class="n">rev</span> <span class="bp">=</span> <span class="s2">"44b58b42794e5abe2bf86397c38e26b587e07e59"</span><span class="o">}</span>
</code></pre></div>



<a name="319291549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319291549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319291549">(Jan 03 2023 at 22:32)</a>:</h4>
<p>What does <code>lean --make one_of_your_files</code> do? Does it start building files in mathlib rather than your stuff?</p>



<a name="319292224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319292224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319292224">(Jan 03 2023 at 22:37)</a>:</h4>
<p><code>leanproject --version</code> would also be a good thing to check</p>



<a name="319292404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319292404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Geoffrey Irving <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319292404">(Jan 03 2023 at 22:38)</a>:</h4>
<p>It complains that I haven't updated my files for the mathlib changes, and  then starts building part of mathlib (some measure theory, in this case).</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">%</span> <span class="n">lean</span> <span class="c1">--make uniform.lean</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">geoffreyi</span><span class="bp">/</span><span class="n">ray</span><span class="bp">/</span><span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">algebra</span><span class="bp">/</span><span class="n">order</span><span class="bp">/</span><span class="n">ring.lean</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">geoffreyi</span><span class="bp">/</span><span class="n">ray</span><span class="bp">/</span><span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">algebra</span><span class="bp">/</span><span class="n">order</span><span class="bp">/</span><span class="n">ring.lean'</span> <span class="n">not</span> <span class="n">found</span> <span class="k">in</span> <span class="n">the</span> <span class="n">search</span> <span class="n">path</span>
<span class="n">Use</span> <span class="bp">'</span><span class="n">lean</span> <span class="c1">--path' to see where lean is looking, or https://leanprover-community.github.io/file-not-found.html for more</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">geoffreyi</span><span class="bp">/</span><span class="n">ray</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">tactics.lean</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">geoffreyi</span><span class="bp">/</span><span class="n">ray</span><span class="bp">/</span><span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">algebra</span><span class="bp">/</span><span class="n">order</span><span class="bp">/</span><span class="n">ring.lean'</span> <span class="n">not</span> <span class="n">found</span> <span class="k">in</span> <span class="n">the</span> <span class="n">search</span> <span class="n">path</span>
<span class="n">Use</span> <span class="bp">'</span><span class="n">lean</span> <span class="c1">--path' to see where lean is looking, or https://leanprover-community.github.io/file-not-found.html for more</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">geoffreyi</span><span class="bp">/</span><span class="n">ray</span><span class="bp">/</span><span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">src</span><span class="bp">/</span><span class="n">measure_theory</span><span class="bp">/</span><span class="n">measure</span><span class="bp">/</span><span class="n">haar.lean</span><span class="o">:</span> <span class="n">parsing</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">288</span>
</code></pre></div>



<a name="319292918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319292918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319292918">(Jan 03 2023 at 22:43)</a>:</h4>
<p>And <code>leanproject --version</code>?</p>



<a name="319295418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319295418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Geoffrey Irving <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319295418">(Jan 03 2023 at 23:04)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">%</span> <span class="n">leanproject</span> <span class="c1">--version</span>
<span class="n">leanproject</span><span class="o">,</span> <span class="n">version</span> <span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span>
</code></pre></div>



<a name="319295502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319295502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319295502">(Jan 03 2023 at 23:05)</a>:</h4>
<p>Try deleting <code>_target/deps</code>, then running <code>leanpkg configure</code>, then <code>leanproject get-mathlib-cache</code></p>



<a name="319295535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319295535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319295535">(Jan 03 2023 at 23:05)</a>:</h4>
<p>Although if you're curious what went wrong, before you do that...</p>



<a name="319295561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319295561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319295561">(Jan 03 2023 at 23:05)</a>:</h4>
<p>Cd into <code>Users/geoffreyi/ray/_target/deps/mathlib</code> and run <code>git diff</code></p>



<a name="319298519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319298519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Geoffrey Irving <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319298519">(Jan 03 2023 at 23:31)</a>:</h4>
<p><code>git diff</code> doesn't show anything, since I'm on a detached HEAD branch with no changes.  To clarify, do you know what went wrong, or is this a guess?</p>



<a name="319300881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319300881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319300881">(Jan 03 2023 at 23:54)</a>:</h4>
<p>My guess was that you modified something by accident. I know that you can safely delete that folder and regenerate it; and I'm guessing that the regenerated version might magically fix everything</p>



<a name="319304716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319304716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319304716">(Jan 04 2023 at 00:36)</a>:</h4>
<p>Try <code>leanproject get-mathlib</code></p>



<a name="319346262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mathlib%20caching%20doesn%27t%20work%20for%20me/near/319346262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mathlib.20caching.20doesn't.20work.20for.20me.html#319346262">(Jan 04 2023 at 09:01)</a>:</h4>
<p>Kevin, I already wrote that above. <code>get-mathlib</code> is just a truncated spelling of <code>get-mathlib-cache</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>