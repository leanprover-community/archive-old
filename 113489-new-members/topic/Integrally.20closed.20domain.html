---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Integrally.20closed.20domain.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html">Integrally closed domain</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198692444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198692444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198692444">(May 25 2020 at 18:26)</a>:</h4>
<p>Hello Lean community! This is my first ever post here, and I'm a lean beginner. As a toy starting out project I'm trying to add the definition of what it means for an integral domain to be integrally closed, using <code>def integral_closure</code> from integral_closure.lean. Apologies if it's already there - I'm still learning the syntax, so might have overlooked it - but I'm trying something like the following added to integral_closure.lean:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">localization</span>
<span class="bp">...</span>
<span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="n">integral_closure</span> <span class="n">R</span> <span class="o">(</span><span class="n">localization</span><span class="bp">.</span><span class="n">fraction_ring</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="n">R</span>
</code></pre></div>


<p>However, the Lean goal pane complains of Type mismatch, because "integral_closure R (localization.fraction_ring R)" has type "subalgebra R _", and it's being compared to type integral_domain.</p>
<p>What's the optimal way of resolving this? I thought of trying to get the underlying rings, and comparing those, but I wonder if there's a better way.</p>



<a name="198693113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693113">(May 25 2020 at 18:37)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> Hi, and welcome!</p>



<a name="198693222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693222">(May 25 2020 at 18:38)</a>:</h4>
<p>Mathematically, what you are doing is totally fine. (Of course!) However, in type theory, you need to strictly separated "ambient sets" and "subsets of an ambient set"</p>



<a name="198693241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693241">(May 25 2020 at 18:38)</a>:</h4>
<p>This is usually very close to our mathematical intuition. But sometimes it's annoying.</p>



<a name="198693311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693311">(May 25 2020 at 18:39)</a>:</h4>
<p>In your specific example, you introduce <code>R</code> by saying <code>(R)</code> in the statement, which is short for saying that <code>R</code> is a "type", in other words, an "ambient set". Roughly speaking, this means that you will never compare <code>R</code> directly to anything else.</p>



<a name="198693370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693370">(May 25 2020 at 18:40)</a>:</h4>
<p>(It is totally fine to say that it is <em>isomorphic</em> to something else, but not <em>equal</em>.)</p>



<a name="198693400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693400">(May 25 2020 at 18:40)</a>:</h4>
<p>So, long story short, you want to say that the <code>integral_closure R (blabla)</code> is <em>equal</em> to the image of <code>R</code> inside the localisation.</p>



<a name="198693552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693552">(May 25 2020 at 18:42)</a>:</h4>
<p>Hi Johan, thanks for the welcome!</p>



<a name="198693570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693570">(May 25 2020 at 18:42)</a>:</h4>
<p>Oh, I didn't know that putting <code>()</code> around the R changes its meaning; i copied that from the definition of <code>is_noetherian_ring</code> in noetherian.lean:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">is_noetherian_ring</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">is_noetherian</span> <span class="n">R</span> <span class="n">R</span>
</code></pre></div>



<a name="198693604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693604">(May 25 2020 at 18:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198693570">said</a>:</p>
<blockquote>
<p>Oh, I didn't know that putting <code>()</code> around the R changes its meaning</p>
</blockquote>
<p>It doesn't really... but you need an ambient set to start with</p>



<a name="198693621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693621">(May 25 2020 at 18:43)</a>:</h4>
<p>Hey Barinder. Did you see p3 of my <a href="http://wwwf.imperial.ac.uk/~buzzard/xena/pdfs/formalise_UG_maths.pdf">Birmingham talk</a>? Let that be a warning to you.</p>



<a name="198693626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693626">(May 25 2020 at 18:43)</a>:</h4>
<p>And the <code>(R)</code> is really just shorthand for <code>(R : Type*)</code>.</p>



<a name="198693711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693711">(May 25 2020 at 18:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198693621">said</a>:</p>
<blockquote>
<p>Hey Barinder. Did you see p3 of my <a href="http://wwwf.imperial.ac.uk/~buzzard/xena/pdfs/formalise_UG_maths.pdf">Birmingham talk</a>? Let that be a warning to you.</p>
</blockquote>
<p>Hi Kevin! No I didn't see that talk, I'll take a look!</p>



<a name="198693727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693727">(May 25 2020 at 18:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198693621">said</a>:</p>
<blockquote>
<p>Hey Barinder. Did you see p3 of my <a href="http://wwwf.imperial.ac.uk/~buzzard/xena/pdfs/formalise_UG_maths.pdf">Birmingham talk</a>? Let that be a warning to you.</p>
</blockquote>
<p>What's the warning? One might give up Zelda?</p>



<a name="198693741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693741">(May 25 2020 at 18:45)</a>:</h4>
<p>Barinder and I have talked Zelda in the past</p>



<a name="198693798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693798">(May 25 2020 at 18:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198693626">said</a>:</p>
<blockquote>
<p>And the <code>(R)</code> is really just shorthand for <code>(R : Type*)</code>.</p>
</blockquote>
<p>aah yes, that makes more sense now!</p>



<a name="198693891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198693891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198693891">(May 25 2020 at 18:48)</a>:</h4>
<p>Yeah, we shouldn't use those abbreviations.... but hey, sometimes people are bored, and want to get the job done quickly</p>



<a name="198694059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694059">(May 25 2020 at 18:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198693400">said</a>:</p>
<blockquote>
<p>So, long story short, you want to say that the <code>integral_closure R (blabla)</code> is <em>equal</em> to the image of <code>R</code> inside the localisation.</p>
</blockquote>
<p>ok, so hopefully there is already defined somewhere a map from an integral domain into its fraction field? quickly looking through localization.lean, it looks like there is <code>coe : α → localization α S</code>, which looks promising</p>



<a name="198694092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694092">(May 25 2020 at 18:51)</a>:</h4>
<p>Note that this file was thoroughly rewritten a few days ago</p>



<a name="198694094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694094">(May 25 2020 at 18:51)</a>:</h4>
<p>Do you have the latest version?</p>



<a name="198694192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694192">(May 25 2020 at 18:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198694094">said</a>:</p>
<blockquote>
<p>Do you have the latest version?</p>
</blockquote>
<p>oh, i'm not sure ... i created the project a few days ago, and given how quickly mathlib moves, i almost certainly don't have the latest version; but i won't be far off</p>



<a name="198694203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694203">(May 25 2020 at 18:53)</a>:</h4>
<p>You should be able to type <code>leanproject up</code> in your project</p>



<a name="198694302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694302">(May 25 2020 at 18:55)</a>:</h4>
<p>Hmmz... it seems that <code>fraction_ring</code> got lost in the battle</p>



<a name="198694324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694324">(May 25 2020 at 18:55)</a>:</h4>
<p>There is now something called <code>fraction_map</code>, which should serve the same purpose</p>



<a name="198694385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694385">(May 25 2020 at 18:56)</a>:</h4>
<p>Except that it is the map, and not the "ambient set" of the codomain.</p>



<a name="198694426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694426">(May 25 2020 at 18:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198694203">said</a>:</p>
<blockquote>
<p>You should be able to type <code>leanproject up</code> in your project</p>
</blockquote>
<p>just done, thanks! and indeed Johan, i can't find <code>fraction_ring</code> anymore</p>



<a name="198694570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694570">(May 25 2020 at 18:58)</a>:</h4>
<p>In the end, this upgrade should pay off. (It solves exactly the issue with localisations that Kevin describes on page 10 (or so) of the pdf he linked above)</p>



<a name="198694591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694591">(May 25 2020 at 18:59)</a>:</h4>
<p>Namely: <code>R[1/f][1/g] ≠ R[1/fg]</code>... they are only isomorphic, not equal. Same issue that you ran into with your first post.</p>



<a name="198694619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198694619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198694619">(May 25 2020 at 18:59)</a>:</h4>
<p>(The <code>≠</code> is abuse of notation)</p>



<a name="198695100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198695100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198695100">(May 25 2020 at 19:07)</a>:</h4>
<p>oh wow, yeah i can see it's been majorly rewritten; seems a lot more functorial now</p>



<a name="198696853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198696853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198696853">(May 25 2020 at 19:37)</a>:</h4>
<p>so i've now tried, in <code>integral_closure.lean</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">variables</span> <span class="o">(</span><span class="n">K</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="n">integral_closure</span> <span class="n">R</span> <span class="o">(</span><span class="n">localization</span><span class="bp">.</span><span class="n">to_integral_domain</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span>
<span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">localization</span><span class="bp">.</span><span class="n">fraction_map</span> <span class="n">R</span> <span class="n">K</span><span class="o">))</span> <span class="bp">=</span> <span class="n">localization</span><span class="bp">.</span><span class="n">fraction_map</span> <span class="n">R</span> <span class="n">K</span> <span class="n">R</span>
</code></pre></div>


<p>I'm sure there are problems with the syntax there; but perhaps more importantly, Lean Goal isn't finding <code>localization.fraction_map</code> or <code>localization.to_integral_domain</code>; do those labels of <code>protected</code> and <code>local attribute</code> used in <code>localization.lean</code> mean that these definitions are not to be used outside of this file?</p>



<a name="198697140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697140">(May 25 2020 at 19:42)</a>:</h4>
<p>to_integral_domain is in the fraction_map namespace</p>



<a name="198697221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697221">(May 25 2020 at 19:43)</a>:</h4>
<p>As for the syntax, the square brackets are used to declare that an argument is a typeclass, and will be inferred automatically by lean, so when you call a function which has these for arguments you don't need to supply them explicitly, so [comm_ring K] after the := won't work.</p>



<a name="198697345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697345">(May 25 2020 at 19:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697221">said</a>:</p>
<blockquote>
<p>As for the syntax, the square brackets are used to declare that an argument is a typeclass, and will be inferred automatically by lean, so when you call a function which has these for arguments you don't need to supply them explicitly, so [comm_ring K] after the := won't work.</p>
</blockquote>
<p>ok thanks, so that's just fixed by replacing <code>[comm_ring K]</code> by <code>K</code>?</p>



<a name="198697430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697430">(May 25 2020 at 19:47)</a>:</h4>
<p>You should remove it completely I think, the signature is</p>
<div class="codehilite"><pre><span></span><code><span class="n">fraction_map</span><span class="bp">.</span><span class="n">to_integral_domain</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_4</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_5</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_4</span> <span class="o">:</span> <span class="n">integral_domain</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_5</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">K</span><span class="o">],</span> <span class="n">fraction_map</span> <span class="n">A</span> <span class="n">K</span> <span class="bp">→</span> <span class="n">integral_domain</span> <span class="n">K</span>
</code></pre></div>


<p>so there is only one argument you need to supply as the others are surrounded by {} or [] lean will work them out from the fraction_map A K you give it.</p>



<a name="198697434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697434">(May 25 2020 at 19:47)</a>:</h4>
<p>By "in <code>integral_closure.lean</code>", I hope you mean "I made a new file which starts with the line <code>import ring_theory.integral_closure</code>" rather than "I am editing a library file".</p>



<a name="198697523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697523">(May 25 2020 at 19:48)</a>:</h4>
<p>Also, the error messages look quite intimidating at first, but they really tell you what's going on</p>



<a name="198697525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697525">(May 25 2020 at 19:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697140">said</a>:</p>
<blockquote>
<p>to_integral_domain is in the fraction_map namespace</p>
</blockquote>
<p>apologies, i'm very new to Lean and namespaces: is it the case that those definitions within the <code>namespace fraction_map</code> are not accessible to other lean files?</p>



<a name="198697571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697571">(May 25 2020 at 19:49)</a>:</h4>
<p>Definitions like <code>blah</code> in that namespace are all called <code>fraction_map.blah</code> outside it</p>



<a name="198697678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697678">(May 25 2020 at 19:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697571">said</a>:</p>
<blockquote>
<p>Definitions like <code>blah</code> in that namespace are all called <code>fraction_map.blah</code> outside it</p>
</blockquote>
<p>aaaaaaaah ... yes, it finds it now! and the error message gives me the next clue, which <span class="user-mention" data-user-id="127136">@Alex J. Best</span>  already noted: "too many arguments"</p>



<a name="198697693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697693">(May 25 2020 at 19:51)</a>:</h4>
<p>If you <code>open fraction_map</code> then you can go back to calling it <code>blah</code></p>



<a name="198697899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697899">(May 25 2020 at 19:55)</a>:</h4>
<p>What is this <code>fraction_map</code>? </p>
<div class="codehilite"><pre><span></span><code><span class="c">/-</span><span class="cm">- Localization map from an integral domain `R` to its field of fractions. -/</span>
<span class="bp">@</span><span class="o">[</span><span class="kn">reducible</span><span class="o">]</span> <span class="n">def</span> <span class="n">fraction_map</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span> <span class="o">:=</span> <span class="n">localization</span> <span class="o">(</span><span class="n">non_zero_divisors</span> <span class="n">R</span><span class="o">)</span> <span class="n">K</span>
</code></pre></div>


<p>Is this docstring wrong?</p>



<a name="198697939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198697939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198697939">(May 25 2020 at 19:55)</a>:</h4>
<p>I don't understand how localisation works any more :-)</p>



<a name="198698067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698067">(May 25 2020 at 19:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697434">said</a>:</p>
<blockquote>
<p>By "in <code>integral_closure.lean</code>", I hope you mean "I made a new file which starts with the line <code>import ring_theory.integral_closure</code>" rather than "I am editing a library file".</p>
</blockquote>
<p>i did actually start in my new file <code>src/hello_world.lean</code>, but at some point switched to directly editing the <code>_target/deps/mathlib/src/ring_theory/integral_closure.lean</code>, and trying to add the definition there somewhere. I'm guessing I should stick to my sandbox and not edit the library files?</p>
<p>but if the goal is to contribute to mathlib, starting off with small commits, then wouldn't that ultimately be done directly to the library file, to a branch of a fork of the mathlib repo?</p>



<a name="198698251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698251">(May 25 2020 at 19:59)</a>:</h4>
<p>Yeah you should definitely edit the library files at some point. But it might not be a good idea as a beginner. For example, all those library files are compiled into olean files on your system right now, because <code>leanproject</code> downloaded compiled binaries for all of them. If you edit one, then it might need recompiling, and every file it imports might need recompiling too, and then everything will become very slow as VS Code tries to do it all on the fly. You can edit the library files but there are caveats.</p>



<a name="198698415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698415">(May 25 2020 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697693">said</a>:</p>
<blockquote>
<p>If you <code>open fraction_map</code> then you can go back to calling it <code>blah</code></p>
</blockquote>
<p>oh, so that's what <code>open</code> means! does that imply that all namespace names in the library are unique?</p>



<a name="198698612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698612">(May 25 2020 at 20:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697899">said</a>:</p>
<blockquote>
<p>What is this <code>fraction_map</code>? </p>
<div class="codehilite"><pre><span></span><code><span class="c">/-</span><span class="cm">- Localization map from an integral domain `R` to its field of fractions. -/</span>
<span class="bp">@</span><span class="o">[</span><span class="kn">reducible</span><span class="o">]</span> <span class="n">def</span> <span class="n">fraction_map</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">K</span><span class="o">]</span> <span class="o">:=</span> <span class="n">localization</span> <span class="o">(</span><span class="n">non_zero_divisors</span> <span class="n">R</span><span class="o">)</span> <span class="n">K</span>
</code></pre></div>


<p>Is this docstring wrong?</p>
</blockquote>
<p>the doc at the top says this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">When</span> <span class="bp">`</span><span class="n">R</span><span class="bp">`</span> <span class="n">is</span> <span class="n">an</span> <span class="n">integral</span> <span class="n">domain</span><span class="o">,</span> <span class="n">we</span> <span class="n">define</span> <span class="bp">`</span><span class="n">fraction_map</span> <span class="n">R</span> <span class="n">K</span><span class="bp">`</span> <span class="n">as</span> <span class="n">an</span> <span class="kn">abbreviation</span> <span class="n">for</span>
<span class="bp">`</span><span class="n">localization</span> <span class="o">(</span><span class="n">non_zero_divisors</span> <span class="n">R</span><span class="o">)</span> <span class="n">K</span><span class="bp">`</span><span class="o">,</span> <span class="n">the</span> <span class="n">natural</span> <span class="n">map</span> <span class="n">to</span> <span class="bp">`</span><span class="n">R</span><span class="bp">`</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">field</span> <span class="n">of</span> <span class="n">fractions</span><span class="bp">.</span>
</code></pre></div>


<p>but i haven't looked under the hood of <code>localization</code></p>



<a name="198698662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698662">(May 25 2020 at 20:03)</a>:</h4>
<p>Yeah I see, it's all been completely rewritten</p>



<a name="198698685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698685">(May 25 2020 at 20:03)</a>:</h4>
<p>oh hi <span class="user-mention" data-user-id="118107">@Amelia Livingston</span> , I was just being confused by your new PR :-)</p>



<a name="198698794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698794">(May 25 2020 at 20:04)</a>:</h4>
<p><code>localization</code> is not a Prop, that's as far as I've got</p>



<a name="198698899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698899">(May 25 2020 at 20:05)</a>:</h4>
<p><code>localization S A</code> for <code>S</code> a submonoid of <code>R</code>, is the type of ring homs R -&gt; A which induce an isomorphism <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo stretchy="false">[</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi>S</mi><mo stretchy="false">]</mo><mo>→</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">R[1/S]\to A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">[</span><span class="mord">1</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span> I think</p>



<a name="198698954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198698954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198698954">(May 25 2020 at 20:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198698251">said</a>:</p>
<blockquote>
<p>Yeah you should definitely edit the library files at some point. But it might not be a good idea as a beginner. For example, all those library files are compiled into olean files on your system right now, because <code>leanproject</code> downloaded compiled binaries for all of them. If you edit one, then it might need recompiling, and every file it imports might need recompiling too, and then everything will become very slow as VS Code tries to do it all on the fly. You can edit the library files but there are caveats.</p>
</blockquote>
<p>ok, i wasn't aware of this recompiling issue; i'll continue in my own src folder for now</p>



<a name="198699230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198699230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198699230">(May 25 2020 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697939">said</a>:</p>
<blockquote>
<p>I don't understand how localisation works any more :-)</p>
</blockquote>
<p>Same, this was quite confusing, maybe not the easiest project to tackle in this state of flux <span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> , I just got to</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">fraction_map</span> <span class="n">R</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">integral_closure</span> <span class="n">R</span> <span class="n">φ</span><span class="bp">.</span><span class="n">codomain</span> <span class="o">:</span> <span class="n">set</span> <span class="n">φ</span><span class="bp">.</span><span class="n">codomain</span><span class="o">)</span> <span class="bp">=</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">φ</span><span class="bp">.</span><span class="n">to_fun</span>
</code></pre></div>


<p>but honestly I have no idea if this is the right thing!</p>



<a name="198699353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198699353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198699353">(May 25 2020 at 20:13)</a>:</h4>
<p>Here I take the fraction map as an argument, so this leaves the problem of constructing the fraction field to the user, I guess this is how we get around problems of isomorphic-but-not-equal constructions, by making future definitions not depend on the exact construction used, but it feels weird to state being integrally closed in this way,</p>



<a name="198699673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198699673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198699673">(May 25 2020 at 20:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198699230">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697939">said</a>:</p>
<blockquote>
<p>I don't understand how localisation works any more :-)</p>
</blockquote>
<p>Same, this was quite confusing, maybe not the easiest project to tackle in this state of flux <span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> , I just got to</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">fraction_map</span> <span class="n">R</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">integral_closure</span> <span class="n">R</span> <span class="n">φ</span><span class="bp">.</span><span class="n">codomain</span> <span class="o">:</span> <span class="n">set</span> <span class="n">φ</span><span class="bp">.</span><span class="n">codomain</span><span class="o">)</span> <span class="bp">=</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">φ</span><span class="bp">.</span><span class="n">to_fun</span>
</code></pre></div>


<p>but honestly I have no idea if this is the right thing!</p>
</blockquote>
<p>maybe not the easiest project, but a decent one to learn by running?!?</p>



<a name="198699878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198699878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198699878">(May 25 2020 at 20:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198699353">said</a>:</p>
<blockquote>
<p>Here I take the fraction map as an argument, so this leaves the problem of constructing the fraction field to the user, I guess this is how we get around problems of isomorphic-but-not-equal constructions, by making future definitions not depend on the exact construction used, but it feels weird to state being integrally closed in this way,</p>
</blockquote>
<p>yes indeed, because an "integrally closed domain" means "integrally closed in fraction field", so ideally the user shouldn't need to construct it explicitly</p>



<a name="198699973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198699973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amelia Livingston <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198699973">(May 25 2020 at 20:24)</a>:</h4>
<p>I haven't read this thread in depth because I've got an exam tomorrow and the next day but I can help more after that. A couple of things: </p>
<ol>
<li>Your life will be easier if you assume <code>K</code> is a field, not an arbitrary comm ring. I'll add to the docs explaining this.</li>
<li><span class="user-mention" data-user-id="127136">@Alex J. Best</span> - I think that looks okay - does it still work if you replace <code>to_fun</code> with <code>to_map</code>? <code>to_map</code> is the  underlying ring hom and it might cause problems using the underlying function <code>to_fun</code></li>
<li>The <code>fraction_map</code> section of the file will be added to a bit (I'll try open a PR on Wednesday); there are some useful lemmas from the old version of the file I want to 'port'.</li>
</ol>



<a name="198700002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198700002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198700002">(May 25 2020 at 20:24)</a>:</h4>
<p>My 5c: <code>(R)</code> is a shorthand for <code>(R : guess_me)</code>, i.e. lean will try to guess the type of R based on how do you use it</p>



<a name="198700151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198700151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198700151">(May 25 2020 at 20:27)</a>:</h4>
<p>E.g. with <code>(R S) (f : R -&gt; S) (x y) (h : f x = y)</code> lean will guess most types</p>



<a name="198700156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198700156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198700156">(May 25 2020 at 20:27)</a>:</h4>
<p><span class="user-mention" data-user-id="118107">@Amelia Livingston</span> Good luck with the exams, please don't get distracted on our account!</p>



<a name="198700381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198700381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198700381">(May 25 2020 at 20:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198699673">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="127136">Alex J. Best</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198699230">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198697939">said</a>:</p>
<blockquote>
<p>I don't understand how localisation works any more :-)</p>
</blockquote>
<p>Same, this was quite confusing, maybe not the easiest project to tackle in this state of flux <span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> , I just got to</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">fraction_map</span> <span class="n">R</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">integral_closure</span> <span class="n">R</span> <span class="n">φ</span><span class="bp">.</span><span class="n">codomain</span> <span class="o">:</span> <span class="n">set</span> <span class="n">φ</span><span class="bp">.</span><span class="n">codomain</span><span class="o">)</span> <span class="bp">=</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">φ</span><span class="bp">.</span><span class="n">to_fun</span>
</code></pre></div>


<p>but honestly I have no idea if this is the right thing!</p>
</blockquote>
<p>maybe not the easiest project, but a decent one to learn by running?!?</p>
</blockquote>
<p>I'm not sure to be honest, I think there are probably quite a few other things that you would find mathematically relevant / interesting that don't touch on areas where mathlib isn't in such a state of transition right now. That said you've just learned some stuff about typeclasses and namespaces while running so who knows</p>



<a name="198700888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198700888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198700888">(May 25 2020 at 20:39)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> I think just the opposite of Alex! I think that this brand spanking new approach to localisations needs to be tested, and I know that Barinder knows the mathematics behind the material, and it's about time this whole Dedekind Domain / DVR / Nullstellensatz level of commutative algebra gets going again. If someone makes it their project and then just asks lots of questions, people like me will get dragged back in because talking about localisations is a lot more interesting than marking undergraduate scripts. We need to check it works. Amelia has refactored the library and now we need to see it in action.</p>



<a name="198701109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198701109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198701109">(May 25 2020 at 20:42)</a>:</h4>
<p>I guess I was swayed by Amelia saying she has more to add to the file yet!</p>



<a name="198702169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198702169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198702169">(May 25 2020 at 21:01)</a>:</h4>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is integrally closed<br>
iff for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r, s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s \ne 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>r</mi><mi mathvariant="normal">/</mi><mi>s</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mi mathvariant="normal">/</mi><mi>s</mi><msup><mo stretchy="false">)</mo><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">(r/s)^n + a_1 (r/s)^{n-1} + \cdots + a_n = 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi mathvariant="normal">/</mi><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r/s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span><br>
iff for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r, s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s \ne 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mi>n</mi></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msup><mi>r</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><msup><mi>s</mi><mi>n</mi></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">r^n + a_1 r^{n-1} s + \cdots + a_n s^n = 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.747722em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.964108em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.814392em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>∣</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">s \mid r</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span></p>



<a name="198702184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198702184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198702184">(May 25 2020 at 21:01)</a>:</h4>
<p>there you go, no fraction field needed</p>



<a name="198702249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198702249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198702249">(May 25 2020 at 21:02)</a>:</h4>
<p>iff for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r, s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s \ne 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mi>n</mi></msup><mo>∈</mo><mo stretchy="false">⟨</mo><msup><mi>r</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msup><mi>s</mi><mi>n</mi></msup><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">r^n \in \langle r^{n-1} s, \cdots, s^n \rangle</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.703492em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mclose">⟩</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>∣</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">s \mid r</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span></p>



<a name="198702284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198702284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198702284">(May 25 2020 at 21:03)</a>:</h4>
<p>this is just like observing that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is a valuation domain iff for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r, s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span>, either <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>∣</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">r \mid s</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>∣</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">s \mid r</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span></p>



<a name="198702342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198702342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198702342">(May 25 2020 at 21:04)</a>:</h4>
<p>then you can show that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is integrally closed iff its integral closure w.r.t. any fraction field is itself</p>



<a name="198702354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198702354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198702354">(May 25 2020 at 21:05)</a>:</h4>
<p>with a characterisation of "is a fraction field"</p>



<a name="198704312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198704312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198704312">(May 25 2020 at 21:47)</a>:</h4>
<p>BTW, do we have something like <code>homogenize (p : polynomial R) (n := nat_degree p) : mv_polynomial (option unit) R</code>?</p>



<a name="198704314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198704314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198704314">(May 25 2020 at 21:47)</a>:</h4>
<p>There's a concept of A being integrally closed in B though</p>



<a name="198704330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198704330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198704330">(May 25 2020 at 21:47)</a>:</h4>
<p>You (Kenny) are formalizing the absolute notion</p>



<a name="198704395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198704395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198704395">(May 25 2020 at 21:49)</a>:</h4>
<p>Then we can have <code>integrally_closed_in R A</code>, <code>integrally_closed R</code>, and theorem(s) linking these two notions.</p>



<a name="198714455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198714455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198714455">(May 26 2020 at 02:02)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span>, going back to something you said above: you should definitely not edit mathlib by editing files in the <code>_target</code> directory. Tools like <code>leanproject</code> happily clobber this directory, and it's just asking to lose your work to edit files there. Better to clone <code>mathlib</code> directly, and work in a branch there.</p>



<a name="198715025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198715025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198715025">(May 26 2020 at 02:18)</a>:</h4>
<p>And PR your branch!</p>



<a name="198717479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198717479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198717479">(May 26 2020 at 03:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198704330">said</a>:</p>
<blockquote>
<p>You (Kenny) are formalizing the absolute notion</p>
</blockquote>
<p>But that's also what Barinder was doing</p>



<a name="198717543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198717543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198717543">(May 26 2020 at 03:28)</a>:</h4>
<p>And we'll want the equivalence with Kenny's props anyway. I think following Kenny's approach for the absolute version is a good idea.</p>



<a name="198769272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198769272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198769272">(May 26 2020 at 14:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198714455">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span>, going back to something you said above: you should definitely not edit mathlib by editing files in the <code>_target</code> directory. Tools like <code>leanproject</code> happily clobber this directory, and it's just asking to lose your work to edit files there. Better to clone <code>mathlib</code> directly, and work in a branch there.</p>
</blockquote>
<p>ok, thanks for clarifying. I have already forked and cloned <code>mathlib</code> locally, but am currently working in a project environment to get to grips with the library and syntax.</p>



<a name="198769487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198769487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198769487">(May 26 2020 at 14:27)</a>:</h4>
<p>Trying to follow Kenny's suggestion above for the relative case (i.e. A is integrally closed in B) led me to the following way to implement <code>is_integrally_closed_in</code>, not using <code>integral_closure</code>, but the lower-level <code>is_integral</code> for elements. I tried the following in my sandbox (modelled on the setup in <code>integral_closure.lean</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_integrally_closed_in</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">R</span>
</code></pre></div>


<p>That doesn't work though:</p>
<div class="codehilite"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="n">class</span> <span class="kn">instance</span> <span class="n">for</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">A</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_3</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span>
<span class="err">⊢</span> <span class="n">has_mem</span> <span class="n">A</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
</code></pre></div>


<p>I'm still unsure how to read these errors, but I think it's complaining that it doesn't know what <code>a ∈ R</code> means, if <code>a</code> was supposed to be of type A. So something like</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">is_integrally_closed_in</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">is_in_base_ring</span> <span class="n">a</span>
</code></pre></div>


<p>might work, except I don't know if there is such a method <code>is_in_base_ring</code> for elements of R-algebras?</p>



<a name="198769667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198769667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198769667">(May 26 2020 at 14:28)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> Yup, it's the same ambient set issue again (-;</p>



<a name="198769688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198769688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198769688">(May 26 2020 at 14:28)</a>:</h4>
<p><code>a</code> lives in <code>A</code>, and <code>R</code> is not a <em>subset</em> of <code>A</code>.</p>



<a name="198769713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198769713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198769713">(May 26 2020 at 14:28)</a>:</h4>
<p>So you have to apply the map to get to <code>A</code></p>



<a name="198769817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198769817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198769817">(May 26 2020 at 14:29)</a>:</h4>
<p>You could write something like <code>\exists r : R, a = r</code> or alternatively <code>a \in set.range blabla</code> like yesterday.</p>



<a name="198770906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198770906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198770906">(May 26 2020 at 14:37)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> the first suggestion gives</p>
<div class="codehilite"><pre><span></span><code><span class="n">term</span>
  <span class="n">r</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
</code></pre></div>



<a name="198771296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198771296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198771296">(May 26 2020 at 14:39)</a>:</h4>
<p>Ooh, sorry... I thought that there would be an "invisible map" (see <a href="https://xenaproject.wordpress.com/2020/04/30/the-invisible-map/">https://xenaproject.wordpress.com/2020/04/30/the-invisible-map/</a>) that would get you from <code>R</code> to <code>A</code>.<br>
Aka: <code>coe</code></p>



<a name="198771393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198771393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198771393">(May 26 2020 at 14:40)</a>:</h4>
<p>So, we'll have to apply the map explicitly.</p>



<a name="198771440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198771440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198771440">(May 26 2020 at 14:40)</a>:</h4>
<p>In this case, the name of the map is <code>algebra_map A</code></p>



<a name="198771509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198771509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198771509">(May 26 2020 at 14:41)</a>:</h4>
<p>So you can write <code>\exists r : R, algebra_map A r = a</code>, which is pretty ugly, I agree.</p>



<a name="198771856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198771856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198771856">(May 26 2020 at 14:43)</a>:</h4>
<p>where is the map? is it the one in <code>algebra.lean</code>?  and in general, how do i find these things for myself? right click on algebra, go to definition, and hope to find it somewhere nearby?</p>



<a name="198771935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198771935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198771935">(May 26 2020 at 14:44)</a>:</h4>
<p>Yup, that's one of the most useful ways of finding things.</p>



<a name="198772011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198772011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198772011">(May 26 2020 at 14:44)</a>:</h4>
<p>Besides that: there is quite a rigid naming convention. After playing a little bit, you'll find that you can start guessing the names of lemmas.</p>



<a name="198772063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198772063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198772063">(May 26 2020 at 14:44)</a>:</h4>
<p>Finally, there are tactics <code>library_search</code> and <code>suggest</code>, that can help with finding things in the library.</p>



<a name="198772482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198772482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198772482">(May 26 2020 at 14:47)</a>:</h4>
<p>aah yes, I remember <code>library_search</code> from the tutorials ... thanks!</p>



<a name="198772815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198772815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198772815">(May 26 2020 at 14:50)</a>:</h4>
<p>If you have <code>φ : fraction_map R K</code>, you can use <code>localization.is_integer φ a</code> to say <code>∃ x : R, φ x = a</code>. It might be worth the effort to generalize this to any <code>algebra</code>.</p>



<a name="198772897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198772897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198772897">(May 26 2020 at 14:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198771509">said</a>:</p>
<blockquote>
<p>So you can write <code>\exists r : R, algebra_map A r = a</code>, which is pretty ugly, I agree.</p>
</blockquote>
<p>unfortunately it's still not liking the type of <code>r</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">algebra_map</span> <span class="n">A</span> <span class="n">r</span>
<span class="n">term</span>
  <span class="n">r</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="err">?</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="err">?</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span>
</code></pre></div>


<p>what is even meant by <code>Type ? : Type (?+1)</code>? sorry for the numerous questions!</p>



<a name="198773054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773054">(May 26 2020 at 14:51)</a>:</h4>
<p>The <code>?</code> is an unknown universe level.</p>



<a name="198773112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773112">(May 26 2020 at 14:51)</a>:</h4>
<p>So it is saying that it was expecting another argument which should have been a type, before the <code>R</code>.</p>



<a name="198773183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773183">(May 26 2020 at 14:52)</a>:</h4>
<p>What is the type signature of <code>algebra_map</code>?</p>



<a name="198773270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773270">(May 26 2020 at 14:52)</a>:</h4>
<p>Usually the first thing I do when I get a type mismatch error is hover my mouse of the current occurrence of the function, and see what its arguments are meant to be.</p>



<a name="198773288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773288">(May 26 2020 at 14:52)</a>:</h4>
<p>Huh... I thought I knew this part of the library... <span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span>  sorry for messing up</p>



<a name="198773310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773310">(May 26 2020 at 14:53)</a>:</h4>
<p>looks like it's <code>(R : Type u) (A : Type v) [comm_semiring R] [semiring A] [algebra R A]</code></p>



<a name="198773313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773313">(May 26 2020 at 14:53)</a>:</h4>
<p>Or type <code>#print algebra_map</code> before the current theorem.</p>



<a name="198773324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773324">(May 26 2020 at 14:53)</a>:</h4>
<p>Maybe it wants to see the even uglier <code>algebra_map R A r</code></p>



<a name="198773361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773361">(May 26 2020 at 14:53)</a>:</h4>
<p>Yup... it has <code>()</code> around both <code>R</code> and <code>A</code>, so you need to explicitly give both.</p>



<a name="198773469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773469">(May 26 2020 at 14:54)</a>:</h4>
<p>(Johan really wishes that Lean were better at inference, but inference and coercions to functions do not play well together.)</p>



<a name="198773507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773507">(May 26 2020 at 14:54)</a>:</h4>
<p>We should be able to change that to <code>{R : Type u}</code> by now... but I suggest that you don't bother with that now.</p>



<a name="198773584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773584">(May 26 2020 at 14:54)</a>:</h4>
<p>Because <code>algebra_map</code> doesn't return an honest function, but instead a <code>ring_hom</code>, it (used to be?) is hard for Lean to infer the type <code>R</code>.</p>



<a name="198773811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198773811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198773811">(May 26 2020 at 14:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198773313">said</a>:</p>
<blockquote>
<p>Or type <code>#print algebra_map</code> before the current theorem.</p>
</blockquote>
<p>oh wow, print statements in Lean! first i've seen that</p>



<a name="198774283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198774283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198774283">(May 26 2020 at 14:59)</a>:</h4>
<p>If you try <code>#print hello_world</code> you will be disappointed</p>



<a name="198774427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198774427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198774427">(May 26 2020 at 15:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198773361">said</a>:</p>
<blockquote>
<p>Yup... it has <code>()</code> around both <code>R</code> and <code>A</code>, so you need to explicitly give both.</p>
</blockquote>
<p>yes! that works! is this an appropriate formal definition of "A is integrally closed in B", in the spirit of Kenny's suggestion above?</p>



<a name="198774602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198774602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198774602">(May 26 2020 at 15:01)</a>:</h4>
<p>Well, Kenny didn't talk about the relative version right?</p>



<a name="198774639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198774639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198774639">(May 26 2020 at 15:01)</a>:</h4>
<p>For the relative version, your definition seems perfect.</p>



<a name="198774942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198774942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198774942">(May 26 2020 at 15:03)</a>:</h4>
<p>no he didn't indeed ... but wouldn't the absolute version just be the relative version, but with the ambient R-algebra set to the fraction field of R?</p>



<a name="198783824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198783824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198783824">(May 26 2020 at 15:58)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> I think that for the absolute version, it might be nice to take Kenny's version as definition (because it avoids talking about <em>the</em> fraction field, so you don't have to choose one). After that, the first lemma to prove is that Kenny's def is equivalent to <code>is_integrally_closed_in R (any_arbitrary_fraction_field R)</code>.</p>



<a name="198784040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198784040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198784040">(May 26 2020 at 16:00)</a>:</h4>
<p>The reason this is nice: <code>Q</code> is <em>not</em> the fraction field of <code>Z</code>. Of course it satisfies the correct universal property, so you can easily plug it into <code>any_arbitrary_fraction_field R</code>.</p>



<a name="198789479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198789479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198789479">(May 26 2020 at 16:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198783824">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> I think that for the absolute version, it might be nice to take Kenny's version as definition (because it avoids talking about <em>the</em> fraction field, so you don't have to choose one). After that, the first lemma to prove is that Kenny's def is equivalent to <code>is_integrally_closed_in R (any_arbitrary_fraction_field R)</code>.</p>
</blockquote>
<p>ok, that sounds like a plan for me to get on with! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> (though i'll probably be back before too long asking about how to tell lean about <code>any_arbitrary_fraction_field</code>)</p>



<a name="198790169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198790169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198790169">(May 26 2020 at 16:47)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> I think <code>fraction_map</code> is exactly that.</p>



<a name="198807235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198807235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198807235">(May 26 2020 at 19:07)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> What do you think of</p>
<div class="codehilite"><pre><span></span><code><span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">⦃</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">⦄,</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>
</code></pre></div>



<a name="198807383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198807383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198807383">(May 26 2020 at 19:08)</a>:</h4>
<p>I didn't think about this definition... I might have gotten the order wrong...</p>



<a name="198807546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198807546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198807546">(May 26 2020 at 19:09)</a>:</h4>
<p>Silly me. Now it should be fixed.</p>



<a name="198807734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198807734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198807734">(May 26 2020 at 19:11)</a>:</h4>
<p><code>finset.nat.antidiagonal n</code> is the finite set of pairs of natural numbers <code>(i,j)</code> with <code>i + j = n</code>.</p>



<a name="198810636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198810636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198810636">(May 26 2020 at 19:34)</a>:</h4>
<p>Don't we have a definition for this in the perfectoid project?</p>



<a name="198811435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198811435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198811435">(May 26 2020 at 19:40)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">integral_closure</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>

<span class="kn">open</span> <span class="n">function</span>

<span class="c">/-</span><span class="cm">-An R-algebra A is integrally closed if every element of A that is integral over R is contained in</span>
<span class="cm">the image of the canonical map R → A. This algebra_map is required to be injective.-/</span>
<span class="kn">structure</span> <span class="n">is_integrally_closed</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">A</span><span class="o">))</span>
<span class="o">(</span><span class="n">closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">,</span> <span class="o">(</span><span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span><span class="o">)</span> <span class="bp">→</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">A</span> <span class="o">:</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">A</span><span class="o">))</span>
</code></pre></div>



<a name="198811541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198811541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198811541">(May 26 2020 at 19:41)</a>:</h4>
<p>This is from the perfectoid project, right?</p>



<a name="198811748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198811748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198811748">(May 26 2020 at 19:43)</a>:</h4>
<p>Right, it's in <code>for_mathlib</code></p>



<a name="198812229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198812229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198812229">(May 26 2020 at 19:47)</a>:</h4>
<p>But this is the relative case, not the absolute one. (To be clear: we want both.)</p>



<a name="198815651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198815651" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198815651">(May 26 2020 at 20:14)</a>:</h4>
<p>You know you really should PR things to mathlib :P</p>



<a name="198815672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198815672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198815672">(May 26 2020 at 20:14)</a>:</h4>
<p>Yes we know</p>



<a name="198815702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198815702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198815702">(May 26 2020 at 20:14)</a>:</h4>
<p>This is why we try to teach younger people to avoid our past mistakes</p>



<a name="198816990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198816990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198816990">(May 26 2020 at 20:25)</a>:</h4>
<p><span class="user-mention" data-user-id="246273">@Bhavik Mehta</span> do you understand that Johan's massive removal of a bunch of stuff from core was part of a perfectoid PR? Sometimes these things take forever. When I've finished marking I am going to completely refactor normal subgroups and quotient groups again just to PR more perfectoid stuff. The task is humongous for us and we do appreciate that it needs doing but it is surprisingly difficult!</p>



<a name="198817048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198817048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198817048">(May 26 2020 at 20:25)</a>:</h4>
<p>Haha I know I was just poking a bit of fun :)</p>



<a name="198817054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198817054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198817054">(May 26 2020 at 20:25)</a>:</h4>
<p>I know :-)</p>



<a name="198817187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198817187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198817187">(May 26 2020 at 20:26)</a>:</h4>
<p>Major design decisions have been made eg bundling ring homs since we wrote the project</p>



<a name="198817220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198817220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198817220">(May 26 2020 at 20:26)</a>:</h4>
<p>But on the other hand I regard this now as an excuse to make mathlib better</p>



<a name="198860668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198860668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198860668">(May 27 2020 at 08:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198807235">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> What do you think of</p>
<div class="codehilite"><pre><span></span><code><span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">⦃</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">⦄,</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>
</code></pre></div>


</blockquote>
<p>That looks good! Much better than what I was trying, which was the last of Kenny's displayed definitions involving <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mi>n</mi></msup><mo>∈</mo><mo stretchy="false">⟨</mo><msup><mi>r</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msup><mi>s</mi><mi>n</mi></msup><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">r^n \in\langle r^{n-1}s,\cdots,s^n\rangle</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.703492em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mclose">⟩</span></span></span></span>; I tried (after asking over at "noob questions")</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="bp">∀</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="o">(</span><span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">∧</span> <span class="o">(</span><span class="bp">∃</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">,</span>
<span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">image</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">,</span> <span class="n">r</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="bp">-</span><span class="n">i</span><span class="o">)</span> <span class="bp">*</span> <span class="n">s</span><span class="bp">^</span><span class="o">(</span><span class="err">↑</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="o">))</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>
</code></pre></div>


<p>but this failed because the <code>set.image</code> was of type <code>set (fin n) → set R</code> and I needed it to be of type <code>set R</code></p>



<a name="198860730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198860730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198860730">(May 27 2020 at 08:02)</a>:</h4>
<p>Looking at the 'perfectoid project' implementation of <code>is_integrally_closed</code>, it looks like my attempt at <code>is_integrally_closed_in</code> above was missing the requirement that the algebra map is injective which gives the inclusion of rings</p>



<a name="198861248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198861248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198861248">(May 27 2020 at 08:07)</a>:</h4>
<p>Yup, I also noticed the injectivity thing</p>



<a name="198861263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198861263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198861263">(May 27 2020 at 08:07)</a>:</h4>
<p>(We're still too much used to thinking of subrings <span aria-label="rofl" class="emoji emoji-1f923" role="img" title="rofl">:rofl:</span>)</p>



<a name="198861342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198861342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198861342">(May 27 2020 at 08:08)</a>:</h4>
<p>When we formalised Huber pairs, we worked with subrings for a long time, until I realised this meant that we couldn't turn <code>Z_p, Q_p</code> into a huber pair.</p>



<a name="198861370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198861370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198861370">(May 27 2020 at 08:08)</a>:</h4>
<p>So we switched to injective ring homs</p>



<a name="198862082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198862082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198862082">(May 27 2020 at 08:16)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> One big advantage of <code>finset.nat.antidiagonal</code> is that it avoids talking about subtraction of natural numbers. If you want to know why this is a good thing, write <code>#eval 2 - 3</code></p>



<a name="198874020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874020">(May 27 2020 at 10:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198862082">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="300547">Barinder Singh Banwait</span> One big advantage of <code>finset.nat.antidiagonal</code> is that it avoids talking about subtraction of natural numbers. If you want to know why this is a good thing, write <code>#eval 2 - 3</code></p>
</blockquote>
<p>aah, I see. I note that <code>#eval 1/0</code> gives the same result <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="198874028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874028">(May 27 2020 at 10:33)</a>:</h4>
<p>is a <code>structure</code> the same as a <code>def</code>? I was just going to write </p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">is_integrally_closed_in</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">injective</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">))</span> <span class="bp">∧</span>
<span class="o">(</span><span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">∃</span>  <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">a</span><span class="o">)</span>
</code></pre></div>


<p>which seems to compile fine, but is the <code>structure</code> syntax better?</p>



<a name="198874165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874165">(May 27 2020 at 10:34)</a>:</h4>
<p><code>structure</code> does define a new thing, like <code>def</code>, but it defines something for which the use syntax will be a bit different.</p>



<a name="198874369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874369">(May 27 2020 at 10:37)</a>:</h4>
<p>you mean the <code>use</code> tactic will be written differently?</p>



<a name="198874371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874371">(May 27 2020 at 10:37)</a>:</h4>
<p>As long as the interface is there, then the only difference for users will be that there will be a slightly different syntax available for usage. For example if you defined a group to be <code>axiom1 \and axiom2 \and axiom3</code> and then if you had a term <code>G</code> of this type, you would forever be writing things like <code>G.2.1</code> to get to axiom 2. With a structure it's just <code>G.mul_one</code> by definition. But these things can typically be worked around. It's kind of an implementation issue I guess.</p>



<a name="198874502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874502">(May 27 2020 at 10:39)</a>:</h4>
<p>I just mean the obvious statement that there are lots of ways of implementing the same mathematical idea, but different implementations will then give you different ways of accessing the information hidden inside the idea</p>



<a name="198874565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874565">(May 27 2020 at 10:40)</a>:</h4>
<p>oh i see, that makes sense, so you get to name your conditions which i can see will make for way more readable code</p>



<a name="198874590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874590">(May 27 2020 at 10:40)</a>:</h4>
<p>I prefer it if some CS person does the definitions and then I just prove the theorems. But sometimes the CS people just say "we don't know, it depends on what you want to do with it, just try anything and then change it later if it's annoying"</p>



<a name="198874611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198874611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198874611">(May 27 2020 at 10:40)</a>:</h4>
<p>My advice is to ask someone like <span class="user-mention" data-user-id="112680">@Johan Commelin</span> just to tell you a definition and then start proving theorems with it.</p>



<a name="198875119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198875119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198875119">(May 27 2020 at 10:46)</a>:</h4>
<p>yep <span class="user-mention" data-user-id="112680">@Johan Commelin</span> has helped me out a lot,  i've now got the definitions of absolute/relative integrally-closed, am now working on lemmas proving equivalence of definitions</p>



<a name="198875121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198875121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198875121">(May 27 2020 at 10:46)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> In this case I would use the <code>structure</code> version</p>



<a name="198875167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198875167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198875167">(May 27 2020 at 10:47)</a>:</h4>
<p>proving lemmas is much more fun because you don't have to keep asking "is this right?" -- if it compiles, it's right.</p>



<a name="198875181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198875181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198875181">(May 27 2020 at 10:47)</a>:</h4>
<p>Looking forward to the "fundamental theorem of absolute integrally-closedness"</p>



<a name="198875278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198875278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198875278">(May 27 2020 at 10:48)</a>:</h4>
<p>Already one can ask whether the integral closure of the integral closure is the integral closure, this makes sense in a relative situation and...isn't this the sort of thing which Kenny has already essentially done?</p>



<a name="198875305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198875305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198875305">(May 27 2020 at 10:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198875278">said</a>:</p>
<blockquote>
<p>Already one can ask whether the integral closure of the integral closure is the integral closure, this makes sense in a relative situation and...isn't this the sort of thing which Kenny has already essentially done?</p>
</blockquote>
<p>yes i recall seeing <code>integral_closure_idem</code> in integral_closure.lean</p>



<a name="198877228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198877228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198877228">(May 27 2020 at 11:13)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> is there a trick to get the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∑</mo></mrow><annotation encoding="application/x-tex">\sum</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span></span></span></span> notation above to work? In your definition above <code>∑ ij in finset.nat.antidiagonal n</code>, it's complaining about <code>unexpected token</code>, but elsewhere in the library it seems fine</p>



<a name="198877262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198877262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198877262">(May 27 2020 at 11:13)</a>:</h4>
<p><code>open_locale big_operators</code></p>



<a name="198877272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198877272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198877272">(May 27 2020 at 11:13)</a>:</h4>
<p>Somewhere near the top of your file</p>



<a name="198912610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198912610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198912610">(May 27 2020 at 15:56)</a>:</h4>
<p>I'm having some trouble stating that "fundamental theorem"; i've tried:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">is_integrally_closed_in</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">))</span>
<span class="o">(</span><span class="n">closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">∃</span>  <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">a</span><span class="o">)</span>

<span class="kn">lemma</span> <span class="n">fundamental_theorem_integrally_closedness</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">],</span> <span class="n">is_integrally_closed_in</span> <span class="n">R</span> <span class="o">(</span><span class="n">fraction_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>


<p>but I get this error:</p>
<div class="codehilite"><pre><span></span><code><span class="n">function</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">is_integrally_closed_in</span> <span class="n">R</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="kt">Prop</span>
</code></pre></div>


<p>what's going on here? i thought that <code>is_integrally_closed_in</code> needs two arguments R and A, but apparently I'm wrong, is it a map from R to A that is required?</p>



<a name="198912934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198912934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198912934">(May 27 2020 at 15:58)</a>:</h4>
<p>What are the imports?</p>



<a name="198912998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198912998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198912998">(May 27 2020 at 15:59)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">noetherian</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">integral_closure</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">adjoin</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>
</code></pre></div>



<a name="198913127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913127">(May 27 2020 at 16:00)</a>:</h4>
<p>Can you post fully working code? I still can't get it to compile</p>



<a name="198913129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913129">(May 27 2020 at 16:00)</a>:</h4>
<p>and here are the global variables and opens:</p>
<div class="codehilite"><pre><span></span><code><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
<span class="kn">open</span> <span class="n">ideal</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="n">open_locale</span> <span class="n">big_operators</span>
</code></pre></div>



<a name="198913164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913164">(May 27 2020 at 16:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198913127">said</a>:</p>
<blockquote>
<p>Can you post fully working code? I still can't get it to compile</p>
</blockquote>
<p>ok one sec ...</p>



<a name="198913265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913265">(May 27 2020 at 16:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">noetherian</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">integral_closure</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">adjoin</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
<span class="kn">open</span> <span class="n">ideal</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">structure</span> <span class="n">is_integrally_closed_in</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">))</span>
<span class="o">(</span><span class="n">closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">∃</span>  <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">a</span><span class="o">)</span>

<span class="n">def</span> <span class="n">my_set</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">x</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">i</span><span class="o">:</span><span class="bp">ℕ</span> <span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span><span class="bp">≤</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span><span class="n">i</span><span class="bp">≤</span> <span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">r</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="bp">-</span><span class="n">i</span><span class="o">)</span> <span class="bp">*</span><span class="n">s</span><span class="bp">^</span><span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="o">(</span><span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">∧</span> <span class="o">(</span><span class="bp">∃</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">,</span>
<span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>

<span class="kn">lemma</span> <span class="n">equiv_johan_absolute</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">⦄,</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">fundamental_theorem_integrally_closedness</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">],</span> <span class="n">is_integrally_closed_in</span> <span class="n">R</span> <span class="o">(</span><span class="n">fraction_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198913382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913382">(May 27 2020 at 16:02)</a>:</h4>
<p>Thanks. If you hover over <code>is_integrally_closed_in</code> then you will see that indeed it takes one explicit argument</p>



<a name="198913478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913478">(May 27 2020 at 16:02)</a>:</h4>
<p>Just hover over the function where the error is</p>



<a name="198913754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913754">(May 27 2020 at 16:04)</a>:</h4>
<p>the explicit arguments are the one in round parentheses, right? so in this case that's just <code>(R : Type u)</code>; so it only needs one R of type <code>universes</code>?</p>



<a name="198913844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913844">(May 27 2020 at 16:05)</a>:</h4>
<p>In your current set-up it is just asking for a ring R, yes</p>



<a name="198913891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198913891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198913891">(May 27 2020 at 16:05)</a>:</h4>
<p>which of course is not a good idea, and which explains the error</p>



<a name="198914013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914013">(May 27 2020 at 16:06)</a>:</h4>
<p>You should think of <code>R : Type u</code> as it asking for a set, and <code>[comm_ring R]</code> as it saying "actually, that set needs a ring structure, but I'll find it from somewhere"</p>



<a name="198914095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914095">(May 27 2020 at 16:07)</a>:</h4>
<p>so the real problem is with the definition of <code>is_integrally_closed_in</code>, which ought to have input either two rings, or an algebra map from R to A?</p>



<a name="198914155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914155">(May 27 2020 at 16:07)</a>:</h4>
<p>If your input is just the two rings then however will Lean guess the map between them?</p>



<a name="198914298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914298">(May 27 2020 at 16:08)</a>:</h4>
<p>oh, apparently <code>algebra</code> is a class so Lean <em>can</em> do this</p>



<a name="198914327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914327">(May 27 2020 at 16:08)</a>:</h4>
<p>So yes, it looks like the input ought to be two rings</p>



<a name="198914413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914413">(May 27 2020 at 16:09)</a>:</h4>
<p>and before the function is run, there had better be a variable <code>[algebra R A]</code> which will put the R-algebra structure on A into the typeclass inference system</p>



<a name="198914684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914684">(May 27 2020 at 16:11)</a>:</h4>
<p>This set-up is stil a bit messed up, even after the fix which I'm pushing you to notice yourself, but unfortunately I don't have time to fix it right now even though I want to support you as a new user; I have to get back to marking.</p>



<a name="198914763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914763">(May 27 2020 at 16:12)</a>:</h4>
<p>But before I go, does anyone know why if I hover over <code>[algebra R A] I see </code>algebra R A ring.to_semiring` ?</p>



<a name="198914841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198914841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198914841">(May 27 2020 at 16:13)</a>:</h4>
<p>ok thanks Kevin ... so i've tried to make the inputs to <code>is_integrally_closed_in</code> more explicit:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">is_integrally_closed_in</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">))</span>
<span class="o">(</span><span class="n">closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">∃</span>  <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">a</span><span class="o">)</span>
</code></pre></div>


<p>and then i tried</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">fundamental_theorem_integrally_closedness</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">],</span> <span class="n">is_integrally_closed_in</span> <span class="n">R</span> <span class="n">A</span><span class="o">:=</span>
</code></pre></div>


<p>but that gave me error at <code>algebra</code> with semiring and comm_ring</p>



<a name="198915024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198915024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198915024">(May 27 2020 at 16:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198914763">said</a>:</p>
<blockquote>
<p>But before I go, does anyone know why if I hover over <code>[algebra R A] I see </code>algebra R A ring.to_semiring` ?</p>
</blockquote>
<p>yes, my problem exactly!</p>



<a name="198915047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198915047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198915047">(May 27 2020 at 16:14)</a>:</h4>
<p>This lemma is not true though, right?</p>



<a name="198915095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198915095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198915095">(May 27 2020 at 16:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198914684">said</a>:</p>
<blockquote>
<p>This set-up is stil a bit messed up, even after the fix which I'm pushing you to notice yourself, but unfortunately I don't have time to fix it right now even though I want to support you as a new user; I have to get back to marking.</p>
</blockquote>
<p>of course, absolutely - thanks for your help!</p>



<a name="198915153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198915153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198915153">(May 27 2020 at 16:15)</a>:</h4>
<p>Because if R is integrally closed it doesn't imply that every map R -&gt; A is injective</p>



<a name="198915193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198915193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198915193">(May 27 2020 at 16:15)</a>:</h4>
<p>so first you might want to figure out what maths statement you're making</p>



<a name="198916332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198916332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198916332">(May 27 2020 at 16:23)</a>:</h4>
<p>yes indeed, now the lemma is false; that last <code>A</code> should be a fraction field of R. but the closest thing we have to that is a <code>fraction_map</code></p>



<a name="198917441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198917441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198917441">(May 27 2020 at 16:32)</a>:</h4>
<p>I think the quantifiers are also not where you want them, if <code>A</code> is meant to be the fraction field.</p>



<a name="198917484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198917484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198917484">(May 27 2020 at 16:32)</a>:</h4>
<p>It's better to prove: for every fraction field <code>A</code>: <code>R</code> is integrally closed iff it's integrally closed in <code>A</code>.</p>



<a name="198917557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198917557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198917557">(May 27 2020 at 16:33)</a>:</h4>
<p>Because now you can also conclude that if <code>R</code> is integrally closed in one fraction field, it is also in another. (And the statement is generally easier to use.)</p>



<a name="198917819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198917819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198917819">(May 27 2020 at 16:35)</a>:</h4>
<p>Of course there's no additional mathematical content in this version because fraction fields are all "the same", but if <code>A</code> can be something more general (e.g., any field that <code>R</code> maps to?) then there is.</p>



<a name="198924605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198924605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198924605">(May 27 2020 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198917484">said</a>:</p>
<blockquote>
<p>It's better to prove: for every fraction field <code>A</code>: <code>R</code> is integrally closed iff it's integrally closed in <code>A</code>.</p>
</blockquote>
<p>aah yes, putting the "for every fraction field" before the <code>:</code> makes a lot more sense, thanks Reid!</p>
<p>So i've got a statement that now compiles:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">fundamental_theorem_integrally_closedness</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">fraction_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">]:</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="n">is_integrally_closed_in</span> <span class="n">R</span> <span class="n">A</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>That's putting a lot of structure on R and A; does this now translate to saying: Let <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> be an integral domain. Then, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi></mrow><annotation encoding="application/x-tex">\forall</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">∀</span></span></span></span> fraction fields <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span> of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span>, we have : <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is integrally closed <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\Leftrightarrow R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">⇔</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is integrally closed in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span>.</p>



<a name="198924705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198924705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198924705">(May 27 2020 at 17:28)</a>:</h4>
<p>Is faction_map a typeclass?</p>



<a name="198924800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198924800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198924800">(May 27 2020 at 17:29)</a>:</h4>
<p>ermm...<code>@[reducible] def fraction_map [comm_ring K] := localization (non_zero_divisors R) K</code> ... so i guess not?</p>



<a name="198924841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198924841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198924841">(May 27 2020 at 17:29)</a>:</h4>
<p>(Then it shouldn't be in square brackets)</p>



<a name="198924956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198924956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198924956">(May 27 2020 at 17:30)</a>:</h4>
<p>But this is looking better -- maybe just change to round brackets?</p>



<a name="198925268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198925268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198925268">(May 27 2020 at 17:33)</a>:</h4>
<p>so changing it from <code>[fraction_map R A]</code> to <code>(fraction_map R A)</code> gives <code>don't know how to synthesize placeholder</code>, but changing it to <code>(H : fraction_map R A)</code> works fine, and i guess this is what I want; that A is a fraction field of R is a hypothesis, so that <code>H : </code> is necessary?</p>



<a name="198926825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198926825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198926825">(May 27 2020 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> With <code>[...]</code> you don't need to give the argument a name, with the other types of parens you (usually) do need to give the name.</p>



<a name="198926869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198926869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198926869">(May 27 2020 at 17:46)</a>:</h4>
<p>But I suggest you call it <code>f</code> instead of <code>H</code>, because we want to think of it as the map from <code>R</code> to its fraction field.</p>



<a name="198929740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198929740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198929740">(May 27 2020 at 18:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198926869">said</a>:</p>
<blockquote>
<p>But I suggest you call it <code>f</code> instead of <code>H</code>, because we want to think of it as the map from <code>R</code> to its fraction field.</p>
</blockquote>
<p>ok, will do, thanks <span class="user-mention" data-user-id="112680">@Johan Commelin</span> !</p>



<a name="198930069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198930069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198930069">(May 27 2020 at 18:10)</a>:</h4>
<p>Please let me know if you've got a working statement! It's high time that this lemma is proven (-;</p>



<a name="198933981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198933981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198933981">(May 27 2020 at 18:40)</a>:</h4>
<p>i think i've got the statement now:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">noetherian</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">integral_closure</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">adjoin</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>
<span class="kn">variables</span> <span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
<span class="kn">open</span> <span class="n">ideal</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">structure</span> <span class="n">is_integrally_closed_in</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span>
<span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="o">(</span><span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">))</span>
<span class="o">(</span><span class="n">closed</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">),</span> <span class="n">is_integral</span> <span class="n">R</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">∃</span>  <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span> <span class="n">algebra_map</span> <span class="n">R</span> <span class="n">A</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">a</span><span class="o">)</span>

<span class="n">def</span> <span class="n">my_set</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">x</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">i</span><span class="o">:</span><span class="bp">ℕ</span> <span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span><span class="bp">≤</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span><span class="n">i</span><span class="bp">≤</span> <span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">r</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="mi">1</span><span class="bp">-</span><span class="n">i</span><span class="o">)</span> <span class="bp">*</span><span class="n">s</span><span class="bp">^</span><span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">is_integrally_closed</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="o">(</span><span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">∧</span> <span class="o">(</span><span class="bp">∃</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">,</span>
<span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>

<span class="kn">lemma</span> <span class="n">equiv_johan_absolute</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">⦄,</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">fundamental_theorem_integrally_closedness</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span>
<span class="o">[</span><span class="n">comm_ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">fraction_map</span> <span class="n">R</span> <span class="n">A</span><span class="o">):</span>
  <span class="n">is_integrally_closed</span> <span class="n">R</span> <span class="bp">↔</span> <span class="n">is_integrally_closed_in</span> <span class="n">R</span> <span class="n">A</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>(this is just in my project for now, i know that those names aren't fit for the library!) i haven't started on the proofs yet, i was going to start that tomorrow morning</p>



<a name="198934290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/198934290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#198934290">(May 27 2020 at 18:42)</a>:</h4>
<p>Looks good to me!</p>



<a name="199119226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199119226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199119226">(May 29 2020 at 06:55)</a>:</h4>
<p>i've got stuck on proving the following mathematically-obvious statement from above: Suppose we have a linear relation </p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>n</mi></mrow></munder><msub><mi>a</mi><mi>i</mi></msub><msup><mi>r</mi><mi>j</mi></msup><msup><mi>s</mi><mi>i</mi></msup><mo>=</mo><mn>0.</mn></mrow><annotation encoding="application/x-tex">\sum_{i+j=n} a_i r^j s^i = 0.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.463782em;vertical-align:-1.413777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8723309999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.413777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span></span></span></span></span></p>
<p>with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>n</mi></msub><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a_n \neq 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>. Then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mi>n</mi></msup><mo>∈</mo></mrow><annotation encoding="application/x-tex">r^n \in</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.703492em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span></span></span></span> span <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⟨</mo><msup><mi>r</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msup><mi>s</mi><mi>n</mi></msup><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle r^{n-1}s, \cdots, s^n\rangle</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">⟨</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mclose">⟩</span></span></span></span>. How does one show span membership? I saw that linear_algebra.basic has a <code>mem_span</code> lemma, which I tried in the following MWE as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">mwe</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">⦄,</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>
  <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="n">R</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">r</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">s_non_zero</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_span</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">p</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">p_H</span><span class="o">,</span>
  <span class="err">???</span>
<span class="kn">end</span>
</code></pre></div>


<p>...but then I get stuck :(</p>



<a name="199119756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199119756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199119756">(May 29 2020 at 07:02)</a>:</h4>
<p>but it's wrong</p>



<a name="199119766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199119766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199119766">(May 29 2020 at 07:03)</a>:</h4>
<p>n=1, 2r+s=0</p>



<a name="199119773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199119773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199119773">(May 29 2020 at 07:03)</a>:</h4>
<p>(r=1, s=-2)</p>



<a name="199119844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199119844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199119844">(May 29 2020 at 07:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110064">Kenny Lau</span> <a href="#narrow/stream/113489-new-members/topic/Integrally.20closed.20domain/near/198702169">said</a>:</p>
<blockquote>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is integrally closed<br>
iff for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r, s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s \ne 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>r</mi><mi mathvariant="normal">/</mi><mi>s</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mi mathvariant="normal">/</mi><mi>s</mi><msup><mo stretchy="false">)</mo><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">(r/s)^n + a_1 (r/s)^{n-1} + \cdots + a_n = 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi mathvariant="normal">/</mi><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r/s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span><br>
iff for every <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo separator="true">,</mo><mi>s</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">r, s \in R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s \ne 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mi>n</mi></msup><mo>+</mo><msub><mi>a</mi><mn>1</mn></msub><msup><mi>r</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><msup><mi>s</mi><mi>n</mi></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">r^n + a_1 r^{n-1} s + \cdots + a_n s^n = 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.747722em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.964108em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.814392em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>∣</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">s \mid r</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span></p>
</blockquote>
<p>you will notice in my formulation that the coefficient of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>r</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">r^n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>



<a name="199120044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199120044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199120044">(May 29 2020 at 07:07)</a>:</h4>
<p>Oh yes, quite right, sorry I forgot to explicitly state in my last post that I'm taking <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a_0 = 1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>. My apologies. It is in the statement of the <code>lemma mwe</code> i'm trying to prove; i'll edit for clarity, Thanks Kenny</p>



<a name="199120319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199120319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199120319">(May 29 2020 at 07:10)</a>:</h4>
<p>you can do some rewrites to change the goal into <code>finset.sum _ \in span R _</code></p>



<a name="199121615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199121615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199121615">(May 29 2020 at 07:28)</a>:</h4>
<p>And after that, there should be a <code>submodule.sum_mem</code> lemma, hopefully.</p>



<a name="199122782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199122782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199122782">(May 29 2020 at 07:44)</a>:</h4>
<p>thanks, yes that all looks promising. unfortunately i'm struggling to rewrite as suggested, i'm not sure how I can "isolate a summand" from a sum, which is my Hypothesis <code>H</code>; so far I've got this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">mwe</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">⦃</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">⦄,</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">→</span>
  <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="n">R</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">r</span> <span class="n">s</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">s_non_zero</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">K</span> <span class="o">:</span> <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">range</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="bp">-</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">f</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">r</span><span class="bp">^</span><span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="n">i</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="n">s</span><span class="bp">^</span><span class="o">(</span><span class="mi">1</span><span class="bp">+</span><span class="n">i</span><span class="o">)),</span> <span class="k">by</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">K</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mem_span</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">p</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">p_H</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">submodule</span><span class="bp">.</span><span class="n">sum_mem</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">my_set</span> <span class="n">at</span> <span class="n">p_H</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">c</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">C</span><span class="o">,</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="199123381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199123381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199123381">(May 29 2020 at 07:50)</a>:</h4>
<ol>
<li>you might consider using <code>finset.range (n+1)</code> instead of antidiagonal</li>
<li>if you insist, then there should be some <code>finset.insert_erase</code> lemma for you to rewrite with</li>
</ol>



<a name="199125075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199125075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199125075">(May 29 2020 at 08:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Using <code>finset.range</code> will create nat subtraction problems elsewhere.</p>



<a name="199125087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199125087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199125087">(May 29 2020 at 08:11)</a>:</h4>
<p>So I would opt for the <code>finset.insert_erase</code> approach</p>



<a name="199125091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199125091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199125091">(May 29 2020 at 08:11)</a>:</h4>
<p>solvable nat subtraction problems</p>



<a name="199125112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Integrally%20closed%20domain/near/199125112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Integrally.20closed.20domain.html#199125112">(May 29 2020 at 08:11)</a>:</h4>
<p>Solvable <code>finset.insert_erase</code> problem</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>