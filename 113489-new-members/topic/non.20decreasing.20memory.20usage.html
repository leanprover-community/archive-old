---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html">non decreasing memory usage</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="201057407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201057407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas Viana <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201057407">(Jun 16 2020 at 18:42)</a>:</h4>
<p>Hi!</p>
<p>I am using Lean with the vscode extension on linux, with compiled mathlib etc. I have no problems when I am editing a few files, even when I use imports from mathlib. But after a few minutes/hours of editing my files and pressing F12 to open the source of stuff, the lean process memory is consuming 30%-40% of my (8GB) memory, and even if I close all the vscode tabs the memory usage never goes down. So I have to periodically kill and restart the lean process. Is this normal? Is there something I can do?</p>



<a name="201057985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201057985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201057985">(Jun 16 2020 at 18:46)</a>:</h4>
<p>you can restart lean from within vscode</p>



<a name="201058158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201058158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201058158">(Jun 16 2020 at 18:48)</a>:</h4>
<p>ctrl-shift-p "restart lean" should find it</p>



<a name="201058218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201058218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201058218">(Jun 16 2020 at 18:49)</a>:</h4>
<p>i think these issues are common, but if you have things set up correctly, then restarting lean is actually not so expensive (so the common solution is just to restart lean when there's an issue)</p>



<a name="201058383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201058383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201058383">(Jun 16 2020 at 18:50)</a>:</h4>
<p>I don't have any insights in to the nature of the problem, but it's probably the sort of thing where working on it for Lean 3 is duplicating efforts of the Lean 4 folks</p>



<a name="201079026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201079026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201079026">(Jun 16 2020 at 21:53)</a>:</h4>
<p>I am also having this problem. But in my case Lean is consuming so much memory my computer eventually freezes. Is there a way to limit the amount of memory used by the server?</p>



<a name="201080293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201080293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201080293">(Jun 16 2020 at 22:08)</a>:</h4>
<p>There's a -M switch which you can tell VS Code to use. I remember but having much success with it though</p>



<a name="201080305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201080305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201080305">(Jun 16 2020 at 22:08)</a>:</h4>
<p>I fixed freezes by creating some swap space</p>



<a name="201080891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201080891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201080891">(Jun 16 2020 at 22:16)</a>:</h4>
<p>It is possible that there is some bug that can be fixed. Is there a reliable way of reproducing this? e.g. a list of steps that someone can take to get the memory usage to go up by X GB over and over.</p>



<a name="201080938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201080938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201080938">(Jun 16 2020 at 22:17)</a>:</h4>
<p>I thought it was limited by default.</p>



<a name="201081083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201081083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201081083">(Jun 16 2020 at 22:19)</a>:</h4>
<p>We've discussed the -M flag before, see <a href="#narrow/stream/113489-new-members/topic/emacs/near/197821742">this post</a>. If it's not working, that's a problem.</p>



<a name="201081388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201081388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201081388">(Jun 16 2020 at 22:22)</a>:</h4>
<p>I've definitely seen Lean eat up all my memory and lock up my computer. It happened a lot when I was working on linter stuff and had multiple copies of mathlib in memory at once. I suspected at the time that there was a memory leak with opening and closing many different files in the same VSCode session. But I never spent the time to find a reliable way to reproduce it.</p>



<a name="201081449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201081449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201081449">(Jun 16 2020 at 22:23)</a>:</h4>
<p>This kind of memory issue is above my paygrade, but if anyone is interested in investigating, I can try again to find a way to reproduce it. (<span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> if you're feeling bored? ;) )</p>



<a name="201081550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201081550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201081550">(Jun 16 2020 at 22:24)</a>:</h4>
<p>But generally, restarting the Lean server will clean things up. I have that bound to a hotkey and hit it now and then out of instinct.</p>



<a name="201082864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201082864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201082864">(Jun 16 2020 at 22:39)</a>:</h4>
<p>If you have multiple copies of mathlib open, maybe they correspond to multiple lean server processes (with different LEAN_PATHs, or even different versions of Lean) each separately limited to 4G or whatever it is.</p>



<a name="201084354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201084354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201084354">(Jun 16 2020 at 22:59)</a>:</h4>
<p>I'm not as much of a pro as Rob, I only ever have one VS Code open and no command line lean running, and I've still seen lean take down my work computer with 8 gigs -- indeed this was commonplace earlier this year and the -M flag wouldn't fix it for me. In the end I just used my laptop when at work. 16 gigs is enough for me</p>



<a name="201091556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201091556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201091556">(Jun 17 2020 at 00:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113489-new-members/topic/non.20decreasing.20memory.20usage/near/201080938">said</a>:</p>
<blockquote>
<p>I thought it was limited by default.</p>
</blockquote>
<p>I was going to follow <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>'s advice, but noticed that <code>-M 4096</code> is set by default for me.</p>



<a name="201095114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201095114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas Viana <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201095114">(Jun 17 2020 at 02:13)</a>:</h4>
<p>I have just tested the memory limit and it is working; here it was set to 4GB too but when things start moving to swap my computer freezes. It seems to me that the vscode extension keeps the files you closed "in cache", so if you reopen them there is no need to check them again. But to me this can turn into a problem when I peek and close multiple files from mathlib in the same session.</p>



<a name="201095193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201095193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas Viana <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201095193">(Jun 17 2020 at 02:15)</a>:</h4>
<p>I made lean use all the 4GB limit just by opening and closing random mathlib files (when I open them, lean does the checking even if I have them compiled in the project)</p>



<a name="201095241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201095241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lucas Viana <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201095241">(Jun 17 2020 at 02:16)</a>:</h4>
<p>It would be useful if I could disable the checking of files inside the mathlib folder</p>



<a name="201095254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201095254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201095254">(Jun 17 2020 at 02:16)</a>:</h4>
<p>There's the <code>--old</code> command line option (in Lean 3.10.0c and newer), which might help with this.</p>



<a name="201177679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201177679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201177679">(Jun 17 2020 at 17:56)</a>:</h4>
<p>I've been getting complete computer freezes recently with VSCode and Lean as well.</p>



<a name="201178034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201178034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201178034">(Jun 17 2020 at 17:59)</a>:</h4>
<p>Does it just happen when you have a lot of files open?</p>



<a name="201178289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201178289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201178289">(Jun 17 2020 at 18:01)</a>:</h4>
<p>I have 3 files open, only 1 mathlib file, and the extension is set to <code>check visible files</code></p>



<a name="201178318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201178318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201178318">(Jun 17 2020 at 18:01)</a>:</h4>
<p>I'll try setting memory limit to 1024 MB</p>



<a name="201178363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/non%20decreasing%20memory%20usage/near/201178363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/non.20decreasing.20memory.20usage.html#201178363">(Jun 17 2020 at 18:01)</a>:</h4>
<p>If that won't work, I'll try remote VSC on a DigitalOcean droplet</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>