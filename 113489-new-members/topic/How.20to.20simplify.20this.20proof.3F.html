---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html">How to simplify this proof?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202397987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202397987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202397987">(Jun 30 2020 at 05:56)</a>:</h4>
<p>For the following proof of <code>h</code> I just want to say:  "repeatedly apply mul_assoc and one_mul and mul_left_inv".</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span>

<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="n">mul_assoc</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">c</span><span class="o">))</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="n">one_mul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">a</span><span class="o">)</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">(</span><span class="n">mul_left_inv</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">my_group</span>

<span class="kn">theorem</span> <span class="n">mul_inv_rev</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="k">have</span> <span class="n">h</span><span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">,</span>
    <span class="o">{</span><span class="n">rw</span> <span class="n">mul_left_inv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_assoc</span> <span class="n">b</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_left_inv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_left_inv</span><span class="o">},</span>
    <span class="n">rw</span> <span class="n">mul_assoc</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_right_cancel</span> <span class="n">h</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">my_group</span>
</code></pre></div>


<p>Is there a way to do this better than I'm doing now?</p>



<a name="202398020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202398020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202398020">(Jun 30 2020 at 05:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span>
<span class="kn">namespace</span> <span class="n">my_group</span>

<span class="kn">theorem</span> <span class="n">mul_inv_rev</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">group</span>

<span class="kn">end</span> <span class="n">my_group</span>
</code></pre></div>



<a name="202398064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202398064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202398064">(Jun 30 2020 at 05:58)</a>:</h4>
<p>lol</p>



<a name="202398146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202398146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202398146">(Jun 30 2020 at 06:00)</a>:</h4>
<p>nice.</p>



<a name="202398157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202398157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202398157">(Jun 30 2020 at 06:01)</a>:</h4>
<p>And what if I'm not allowed to use group?  i.e. I have to only use the three axioms, and no "exotic" tactics like <code>group</code>. Can I use something like <code>repeat</code>?</p>



<a name="202398512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202398512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202398512">(Jun 30 2020 at 06:10)</a>:</h4>
<p>Here are a few more proofs inspired by the proof in mathlib:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">group</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span>
<span class="kn">namespace</span> <span class="n">my_group</span>

<span class="c1">-- mathlib proof</span>
<span class="kn">lemma</span> <span class="n">mul_inv_rev</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="n">inv_eq_of_mul_eq_one</span> <span class="err">$</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">]</span>

<span class="c1">-- above proof converted to tactic mode</span>
<span class="c1">-- lemmas in `simp only` found using `squeeze_simp`</span>
<span class="kn">theorem</span> <span class="n">mul_inv_rev&#39;</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">inv_eq_of_mul_eq_one</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_inv_cancel_left</span><span class="o">,</span> <span class="n">mul_right_inv</span><span class="o">],</span>
<span class="kn">end</span>

<span class="c1">-- rewrites found using `set_option trace.simplify.rewrite true`</span>
<span class="kn">theorem</span> <span class="n">mul_inv_rev&#39;&#39;</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">inv_eq_of_mul_eq_one</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_inv_cancel_left</span><span class="o">,</span> <span class="n">mul_right_inv</span><span class="o">],</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">my_group</span>
</code></pre></div>



<a name="202530981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202530981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202530981">(Jul 01 2020 at 04:55)</a>:</h4>
<p>Thanks for this! Some questions:</p>
<ol>
<li>what does the <code>$</code> sign mean in the first proof?</li>
<li>What do you mean by <code>--above proof converted to tactic mode</code> and <code>-- lemmas in 'simp only' found using 'squeeze_simp'</code>?</li>
<li>what do you mean by <code>-- rewrites found using 'set_option trace.simplify.rewrite true'</code></li>
</ol>



<a name="202531101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531101">(Jul 01 2020 at 04:58)</a>:</h4>
<p>the <code>$</code> is just another notation for application at low precedence</p>



<a name="202531131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531131">(Jul 01 2020 at 04:58)</a>:</h4>
<p>it's the same as <code>inv_eq_of_mul_eq_one (by simp [mul_assoc])</code></p>



<a name="202531144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531144">(Jul 01 2020 at 04:58)</a>:</h4>
<ol>
<li><code>a $ b c</code>  is the same as <code>a (b c)</code>, basically <code>$</code> is an operator with extremely low precedence so that it acts like it wraps parentheses around everything that follows.</li>
<li>
<p>a. I mean that I took the term proof above and rewrote it fully in tactic mode.<br>
b. If you use <code>squeeze_simp</code> instead of <code>simp</code>, it outputs the lemmas that were actually used, which lets you write a <code>simp only</code> statement. See <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#squeeze_simp%20/%20squeeze_simpa%20/%20squeeze_scope">this doc entry</a>.</p>
</li>
<li>
<p>If you write <code>set_option trace.simplify.rewrite true</code> before a proof using <code>simp</code>, then Lean will output some trace information when it runs <code>simp</code>, letting you see the rewrites that were performed. See the beginning of <a href="https://leanprover-community.github.io/extras/simp.html">this page</a>.</p>
</li>
</ol>



<a name="202531583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531583">(Jul 01 2020 at 05:08)</a>:</h4>
<p>When I write this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">mul_inv_rev3</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">b</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">⁻¹</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="n">apply</span> <span class="n">inv_eq_of_mul_eq_one</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_right_inv</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">],</span>
<span class="kn">end</span>
</code></pre></div>


<p>It tells me: <code>tactic failed, there are unsolved goals</code>, even though those theorems should be enough to fully simplify to <code>1=1</code>. How should I think about this? Should I just think "simp will not always be able to simplify even if it would be obvious to humans that it could"?</p>



<a name="202531665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531665">(Jul 01 2020 at 05:10)</a>:</h4>
<blockquote>
<p>even though those theorems should be enough to fully simplify to <code>1=1</code></p>
</blockquote>
<p>Why? The tactic state after the <code>simp</code> will tell you how far it got.</p>



<a name="202531732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531732">(Jul 01 2020 at 05:12)</a>:</h4>
<blockquote>
<p>Should I just think "simp will not always be able to simplify even if it would be obvious to humans that it could"?</p>
</blockquote>
<p>There are tons and tons of things that are obvious to humans which are very nonobvious to <code>simp</code> or Lean. The doc I linked in point 3 above gives some explanation about how simp works. You can also turn on the various trace options to see what it tried.</p>



<a name="202531736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531736">(Jul 01 2020 at 05:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F/near/202531665">said</a>:</p>
<blockquote>
<p>Why? The tactic state after the <code>simp</code> will tell you how far it got.</p>
</blockquote>
<p>I mean, it is possible for me to rewrite the equation <code>a * b * (b⁻¹ * a⁻¹) = 1</code> as 1=1, using only the lemmas <code>mul_assoc, mul_right_inv, mul_one, one_mul</code>.</p>



<a name="202531814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531814">(Jul 01 2020 at 05:15)</a>:</h4>
<p>That's true, but that's not how <code>simp</code> works. You can see that it uses <code>mul_assoc</code> in the "other" direction. While it's possible to reverse the direction with <code>simp only [←mul_assoc, mul_right_inv, mul_one, one_mul],</code>, you can see that <code>simp</code> still isn't smart enough to only apply <code>←mul_assoc</code> once before attempting to apply <code>mul_right_inv</code>.</p>



<a name="202531826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202531826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202531826">(Jul 01 2020 at 05:15)</a>:</h4>
<p>Ok that makes sense.</p>



<a name="202532763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202532763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris M <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202532763">(Jul 01 2020 at 05:37)</a>:</h4>
<p>Thanks for the help!</p>



<a name="202535414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20simplify%20this%20proof%3F/near/202535414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20simplify.20this.20proof.3F.html#202535414">(Jul 01 2020 at 06:37)</a>:</h4>
<p>"I can intuitively solve a logic puzzle" is not the same as "this algorithm will always find the solution that I can intuitively spot"</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>