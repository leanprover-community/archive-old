---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html">Rewrite type of term in function definition</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="273100423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273100423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273100423">(Feb 24 2022 at 15:02)</a>:</h4>
<p>Is there a way to rewrite the type of a term in a function definition?</p>
<p>I'm getting the following error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">foo</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">motive</span> <span class="n">Foo</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">motive</span> <span class="n">Bar</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span>
</code></pre></div>
<p>But I have a theorem that states</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Foo</span> <span class="bp">=</span> <span class="n">Bar</span>
</code></pre></div>
<p>So is there a way to use this theorem to resolve the type mismatch?</p>
<p>EDIT: Forgot to mention, I'm working with lean 4</p>



<a name="273101279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273101279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273101279">(Feb 24 2022 at 15:08)</a>:</h4>
<p>If the theorem is called <code>foobar</code> and you have this error when applying something to your goal, just write:<br>
<code>rw foobar,</code></p>



<a name="273101659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273101659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273101659">(Feb 24 2022 at 15:11)</a>:</h4>
<p>Oh, sorry, you were probably asking about something else, right?</p>



<a name="273101700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273101700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273101700">(Feb 24 2022 at 15:11)</a>:</h4>
<p>Usually, it is better to post your code than to post your error.</p>



<a name="273102127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273102127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273102127">(Feb 24 2022 at 15:15)</a>:</h4>
<p>or ideally, post both</p>



<a name="273102463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273102463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273102463">(Feb 24 2022 at 15:18)</a>:</h4>
<p>Yeah, I'm talking about a function definition, rather than a proof.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">List.Nil</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span>
  <span class="o">:=</span> <span class="n">W.mk</span> <span class="o">(</span><span class="n">A.Nil</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">emp</span> <span class="bp">=&gt;</span> <span class="n">Empty.rec</span> <span class="o">(</span><span class="bp">λ</span><span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="n">emp</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">List.rec</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">{</span><span class="n">motive</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span>
  <span class="o">(</span><span class="n">mNil</span> <span class="o">:</span> <span class="n">motive</span> <span class="n">List.Nil</span><span class="o">)</span>
  <span class="o">(</span><span class="n">mCons</span> <span class="o">:</span> <span class="o">(</span><span class="n">hd</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">tl</span><span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">motive</span> <span class="n">tl</span> <span class="bp">→</span> <span class="n">motive</span> <span class="o">(</span><span class="n">List.Cons</span> <span class="n">hd</span> <span class="n">tl</span><span class="o">))</span>
    <span class="o">:</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">motive</span> <span class="n">t</span>
<span class="bp">|</span> <span class="n">W.mk</span> <span class="o">(</span><span class="n">A.Nil</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=&gt;</span> <span class="n">mNil</span>  <span class="c1">-- &lt;-- mNil is of type `motive List.Nil`, but `motive W.mk Flist_A.Nil f)` is expected</span>
<span class="bp">|</span> <span class="n">W.mk</span> <span class="o">(</span><span class="n">A.Cons</span> <span class="n">hd</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=&gt;</span> <span class="n">_</span> <span class="c1">-- not important yet</span>
</code></pre></div>



<a name="273102908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273102908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273102908">(Feb 24 2022 at 15:21)</a>:</h4>
<p>So I have a term <code>mNil</code> of type <code>motive List.Nil</code> which I want to return from my function that is declared to return <code>motive W.mk ...</code>, <br>
which seems fine as <code>List.Nil</code> is equal to <code>W.mk ...</code></p>



<a name="273103266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273103266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273103266">(Feb 24 2022 at 15:23)</a>:</h4>
<p>I could of course change the type of mNil, but the goal is to hide the internal machinery, so that it seems like <code>List.Nil</code> and <code>List.Cons</code> are actual constructors, rather than wrappers around <code>W ...</code></p>



<a name="273103382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273103382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273103382">(Feb 24 2022 at 15:24)</a>:</h4>
<p>With <code>List.rec</code> the normal high-level recursor that one would expect an inductive type to have</p>



<a name="273106066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273106066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273106066">(Feb 24 2022 at 15:43)</a>:</h4>
<p>Here is a more minimal example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">inductive</span> <span class="n">Foo</span>
  <span class="bp">|</span> <span class="n">X</span> <span class="o">:</span> <span class="o">(</span><span class="n">Empty</span> <span class="bp">→</span> <span class="n">Nat</span><span class="o">)</span> <span class="bp">→</span> <span class="n">Foo</span>

<span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">Foo</span>
  <span class="o">:=</span> <span class="n">Foo.X</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">emp</span> <span class="bp">=&gt;</span> <span class="mi">1</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">foobar</span> <span class="o">(</span><span class="n">foo</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">):</span>
  <span class="n">foo</span> <span class="bp">=</span> <span class="n">bar</span> <span class="o">:=</span>
  <span class="kd">by</span>
    <span class="n">unfold</span> <span class="n">bar</span>
    <span class="n">cases</span> <span class="n">foo</span>
    <span class="n">apply</span> <span class="n">congrArg</span>
    <span class="n">funext</span> <span class="n">x</span>
    <span class="n">cases</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">func</span> <span class="o">(</span><span class="n">motive</span> <span class="o">:</span> <span class="n">Foo</span> <span class="bp">→</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">foo</span> <span class="o">:</span> <span class="n">Foo</span><span class="o">)</span> <span class="o">(</span><span class="n">mBar</span> <span class="o">:</span> <span class="n">motive</span> <span class="n">bar</span><span class="o">)</span> <span class="o">:</span> <span class="n">motive</span> <span class="n">foo</span>
  <span class="o">:=</span> <span class="n">mBar</span> <span class="c1">-- ERROR</span>
</code></pre></div>
<p>Where the error is again</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">mBar</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">motive</span> <span class="n">bar</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">motive</span> <span class="n">foo</span> <span class="o">:</span> <span class="kt">Type</span>
</code></pre></div>



<a name="273107627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273107627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273107627">(Feb 24 2022 at 15:53)</a>:</h4>
<p>You can use <code>Eq.rec</code> or something, but you're heading down a dark path</p>



<a name="273110167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20type%20of%20term%20in%20function%20definition/near/273110167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Keizer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20type.20of.20term.20in.20function.20definition.html#273110167">(Feb 24 2022 at 16:10)</a>:</h4>
<p>Thanks for the pointer, I'll see what I can work out</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>