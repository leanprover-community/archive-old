---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html">Weird Type Mismatch error</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="208421290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208421290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208421290">(Aug 29 2020 at 07:09)</a>:</h4>
<p>I am getting a very weird error and I have no idea why this is not working. I couldn't reproduce the error more minimally than this. Can someone help please?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">ideal</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">lemma</span> <span class="n">maximal_ideal_of_field_quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">]</span> <span class="o">:</span> <span class="n">I</span><span class="bp">.</span><span class="n">is_maximal</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">refine</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">is_maximal_iff</span><span class="bp">.</span><span class="n">mpr</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span> <span class="o">{</span> <span class="n">sorry</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">J</span> <span class="n">x</span> <span class="n">hIJ</span> <span class="n">hxI</span> <span class="n">hxJ</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">hxne0</span> <span class="o">:</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">),</span> <span class="o">{</span>
      <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">hxI2</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">I</span><span class="o">,</span> <span class="o">{</span><span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h</span><span class="o">},</span>
      <span class="n">sorry</span>
    <span class="o">},</span>
    <span class="n">sorry</span><span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>


<p>Error: </p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h</span>
<span class="n">term</span>
  <span class="n">h</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="err">⇑</span><span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="err">⇑</span><span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">,</span>
<span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">,</span>
<span class="n">J</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">,</span>
<span class="n">x</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span>
<span class="n">hIJ</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">≤</span> <span class="n">J</span><span class="o">,</span>
<span class="n">hxI</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∉</span> <span class="n">I</span><span class="o">,</span>
<span class="n">hxJ</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="err">⇑</span><span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="err">⊢</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">I</span>
</code></pre></div>



<a name="208421524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208421524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208421524">(Aug 29 2020 at 07:16)</a>:</h4>
<p>Try using <code>convert</code> instead of exact. What happens if you <code>set_option pp.all true</code>?</p>



<a name="208421540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208421540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208421540">(Aug 29 2020 at 07:17)</a>:</h4>
<p>Oh I think I see it. I don't think <code>field I.quotient</code> means what you think it means. It means "let's put a random field structure on the quotient, completely unrelated to the quotient ring structure". So now you have two ring structures on something and they don't agree</p>



<a name="208421577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208421577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208421577">(Aug 29 2020 at 07:18)</a>:</h4>
<p>And hence two different zeros</p>



<a name="208421591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208421591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208421591">(Aug 29 2020 at 07:19)</a>:</h4>
<p>I posted a way to do this in another thread recently. Maybe search for is_integral_domain and a conversation involving Damiano Testa and Johan and I</p>



<a name="208423309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208423309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208423309">(Aug 29 2020 at 08:18)</a>:</h4>
<p>Oh, I see now why only the converse of my statement was in Lean. I guess I will try to work on <code>is_field</code> then.</p>



<a name="208425295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208425295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208425295">(Aug 29 2020 at 09:19)</a>:</h4>
<p>I wrote it a few days ago but didn't PR it. Did you find it? Search on mobile isn't finding it for me. There is a technical issue with it. Unfortunately fields have extra data -- the <code>inv</code> function, which is unique but not part of the <code>ring</code> story. I still think it's a useful thing to have though</p>



<a name="208425352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208425352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208425352">(Aug 29 2020 at 09:21)</a>:</h4>
<p>I posted it in a discussion about transporting integral domains across isomorphisms and proving that if R/I was an ID then I was prime</p>



<a name="208425761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208425761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208425761">(Aug 29 2020 at 09:34)</a>:</h4>
<p>Looks like it was the same thread you mentioned earlier and seems like I just skipped that code when reading the thread. Though I did something slightly differently, but wouldn't this be better since you can use inverse notation without calling is_field.to_field or something?</p>
<p>My version: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">nontrivial</span> <span class="n">R</span><span class="o">,</span> <span class="n">has_inv</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mul_inv_cancel</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">(</span><span class="n">inv_zero</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>
</code></pre></div>


<p>Your version: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">exists_pair_ne</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="n">mul_inv_cancel&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>
</code></pre></div>



<a name="208426182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426182">(Aug 29 2020 at 09:49)</a>:</h4>
<p>Make sure it's a Prop. There's a bug in Lean 3 which might make that structure a type by default. Put <code> : Prop</code> before the := . But now you'll have to make this inv operator on your quotient. You could try both and see which is easier to use. I'm not very good at definitions. <span class="user-mention" data-user-id="112680">@Johan Commelin</span>  was not positive about this being a good idea and I'm not very good at definitions.</p>



<a name="208426194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426194">(Aug 29 2020 at 09:49)</a>:</h4>
<p>Oh wait if you're extending data then it probably isn't a prop. Isn't the point to get a true/false statement?</p>



<a name="208426265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426265">(Aug 29 2020 at 09:51)</a>:</h4>
<p>What I needed this was so that Lean can take the data for the usual ring structure on <code>I.quotient</code> and then tell Lean that this data extends to a field. Before, Lean was giving <code>I.quotient</code> a random field structure and that wasn't working.</p>



<a name="208426315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426315">(Aug 29 2020 at 09:52)</a>:</h4>
<p>Right but to make it a field in the sense of lean you still have to add the data of inv because for some reason that's the way fields are set up in lean</p>



<a name="208426321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426321">(Aug 29 2020 at 09:53)</a>:</h4>
<p>Can you extend group with zero instead?</p>



<a name="208426339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426339">(Aug 29 2020 at 09:53)</a>:</h4>
<p>The issue is that a field isn't just a ring which is a field, it's a ring plus a new function inv which satisfies the axioms of a field</p>



<a name="208426342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426342">(Aug 29 2020 at 09:54)</a>:</h4>
<p>And you can work out inv from the other data</p>



<a name="208426391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426391">(Aug 29 2020 at 09:54)</a>:</h4>
<p>I am not sure what you mean by extending group with zero. Isn't it already a group with 0 since it is a ring?</p>



<a name="208426393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426393">(Aug 29 2020 at 09:54)</a>:</h4>
<p>The way I did it was asking for an abstract existence of inv and then building it later when I needed <code>field</code> not just <code>is_field</code></p>



<a name="208426395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426395">(Aug 29 2020 at 09:55)</a>:</h4>
<p>A ring is a monoid with 0</p>



<a name="208426399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426399">(Aug 29 2020 at 09:55)</a>:</h4>
<p>A division ring is a group with zero</p>



<a name="208426404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426404">(Aug 29 2020 at 09:55)</a>:</h4>
<p>A commutative division ring is a field</p>



<a name="208426405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426405">(Aug 29 2020 at 09:55)</a>:</h4>
<p>Oh nvm, I got confused</p>



<a name="208426469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426469">(Aug 29 2020 at 09:56)</a>:</h4>
<p>I guess the best way to not run into problems is to make the <code>is_field</code> into a <code>Prop</code> the way you described it and have propositions to turn it into a <code>field</code> for when it is necessary.</p>



<a name="208426483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426483">(Aug 29 2020 at 09:57)</a>:</h4>
<p>The technical issue here in the background is the following</p>



<a name="208426527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426527">(Aug 29 2020 at 09:58)</a>:</h4>
<p>Group with 0 wouldn't work, since that extends <code>has_inv</code> so it is the same issue.</p>



<a name="208426548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426548">(Aug 29 2020 at 09:59)</a>:</h4>
<p>If we start with <code>h1 : field k</code> and then make <code>h2 : is_field k</code> and then <code>h3 : field k</code> then h1 and h3 might have <code>inv</code>s which are equal as functions but which are not definitionally equal</p>



<a name="208426603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426603" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426603">(Aug 29 2020 at 10:00)</a>:</h4>
<p>And so you can imagine a situation where you have two terms of type <code>field k</code> which are not definitionally equal, and this is bad because <code>field</code> is a class</p>



<a name="208426612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426612">(Aug 29 2020 at 10:01)</a>:</h4>
<p>And the type class inference system doesn't expect this sort of thing to happen so it might lead to problems down the line</p>



<a name="208426660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426660">(Aug 29 2020 at 10:02)</a>:</h4>
<p>But to be quite frank we certainly need the lemma that if the quotient is a field then the ideal is maximal so we seem to need a predicate on commutative rings saying they are fields</p>



<a name="208426668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426668">(Aug 29 2020 at 10:03)</a>:</h4>
<p>Maybe it's just the construction of field from is_field which should be avoided in general</p>



<a name="208426711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426711">(Aug 29 2020 at 10:04)</a>:</h4>
<p>Go ahead and make a PR :-) How are Dedekind domains? Which of the two PRs are you working with, or are you using another one? :-/</p>



<a name="208426793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208426793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208426793">(Aug 29 2020 at 10:06)</a>:</h4>
<p>Thank you for the insight! I will prove this theorem and I will look into PRing it. Right now I wasn't exactly working on Dedekind Domains. I used a definition I did for Dedekind domains a while ago, then I defined a number field and a number ring and I was working on proving that a number ring is a dedekind domain, though I needed this theorem to do it (or at least that is the way it is done in the book I am following).</p>



<a name="208441088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441088">(Aug 29 2020 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="250372">@Ashvni Narayanan</span> you might be interested in this. Ashvni is thinking about proving that the class group of a number field is finite. I don't know what the most general statement is. The class group of a general Dedekind domain is not finite -- finiteness is an arithmetic issue, not an algebraic one. The class group of a global field is finite. A global field has a funny definition as far as I can see -- it is either a number field or a finite extension of (Z/pZ)(T). To define the integers of a finite extension of (Z/pZ)(T) you have to "choose an infinity"! If you choose the usual one, then the integers of (Z/pZ)(T) are (Z/pZ)[T], which has trivial class group. Other infinities are available. What is driving the finiteness of the class group? Is it something to do with the fact that all residue fields are finite in both of these cases, or do you need more? I should know this but I don't.</p>



<a name="208441633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441633">(Aug 29 2020 at 16:19)</a>:</h4>
<p>Artin-Whaples seem to think its the product formula, <a href="https://projecteuclid.org/euclid.bams/1183507128">https://projecteuclid.org/euclid.bams/1183507128</a></p>



<a name="208441730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441730">(Aug 29 2020 at 16:21)</a>:</h4>
<p>It's the product formula and finiteness of residue fields, IMO</p>



<a name="208441803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441803">(Aug 29 2020 at 16:23)</a>:</h4>
<p>FWIW, the "uniform" definition of a global field is a finitely generated field of Kronecker dimension 1</p>



<a name="208441888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441888">(Aug 29 2020 at 16:25)</a>:</h4>
<p>The best intuition I have for this comes from the Lang-Neron theorem.</p>



<a name="208441889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441889">(Aug 29 2020 at 16:25)</a>:</h4>
<p>I wonder how we are going to name the fields of higher dimension once we get more theorems about them (-;</p>



<a name="208441955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441955">(Aug 29 2020 at 16:26)</a>:</h4>
<p>Infinite finitely generated fields are all anabelian <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="208441984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208441984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208441984">(Aug 29 2020 at 16:27)</a>:</h4>
<p>Are we going to call the 2-dim fields superglobal? And then hyperglobal? ultraglobal?</p>



<a name="208442014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442014">(Aug 29 2020 at 16:27)</a>:</h4>
<p>Lol I just use the Kronecker dimension in general.</p>



<a name="208442016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442016">(Aug 29 2020 at 16:27)</a>:</h4>
<p>I think Weil tries to do the general case in "basic number theory" but that book is such a chore read, I've not opened it for years. What little I once knew I learnt from there.</p>



<a name="208442062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442062">(Aug 29 2020 at 16:28)</a>:</h4>
<p>(I mean unifying number fields and 1-d function fields over finite fields)</p>



<a name="208442093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442093">(Aug 29 2020 at 16:29)</a>:</h4>
<p>There is also a class field theory for all f.g. fields, btw</p>



<a name="208442199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442199">(Aug 29 2020 at 16:31)</a>:</h4>
<p>These things will be interesting to formalise -- even the statements.</p>



<a name="208442200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442200">(Aug 29 2020 at 16:31)</a>:</h4>
<p>Higher dimensional local fields are called "higher local fields" (very creative)</p>



<a name="208442249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442249">(Aug 29 2020 at 16:32)</a>:</h4>
<p>I am still unclear about how I'm going to be talking about representations of Gal(Q-bar/Q) and whether or not I'm supposed to be picking a Q-bar or proving things valid for all Q-bar's.</p>



<a name="208442254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442254">(Aug 29 2020 at 16:32)</a>:</h4>
<p>Use the groupoid?</p>



<a name="208442257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442257">(Aug 29 2020 at 16:32)</a>:</h4>
<p>All the Langlandsy stuff should be canonically independent of everything</p>



<a name="208442268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442268">(Aug 29 2020 at 16:33)</a>:</h4>
<p>Maybe the groupoid is the way to go</p>



<a name="208442287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442287">(Aug 29 2020 at 16:33)</a>:</h4>
<p>This issue is all over the place in anabelian geometry.</p>



<a name="208442292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442292">(Aug 29 2020 at 16:33)</a>:</h4>
<p>but it's funny because in all the Langlands papers I read (at least those written by the French, who are careful about these things) they choose an alg closure of Q on line 1.</p>



<a name="208442297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442297">(Aug 29 2020 at 16:33)</a>:</h4>
<p>We are usually lazy and just work with profinite groups with outer-morphisms</p>



<a name="208442359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442359">(Aug 29 2020 at 16:34)</a>:</h4>
<p>and if people are doing more serious things then they even "choose Langlands parameters", which means choosing a Q-bar, a Q_p-bar for all p, and maps from Q-bar to C and to all Q_p-bar's. This is again all on line 1.</p>



<a name="208442379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442379">(Aug 29 2020 at 16:34)</a>:</h4>
<p><span class="user-mention" data-user-id="302826">@Aaron Anderson</span> would just work in a "monster model"</p>



<a name="208442382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442382">(Aug 29 2020 at 16:35)</a>:</h4>
<p>"Make so many choices that it is impossible to conceive of them. And now let's begin. And all the important stuff will be independent of all these choices. I promise."</p>



<a name="208442946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208442946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Aaron Anderson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208442946">(Aug 29 2020 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error/near/208442379">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="302826">Aaron Anderson</span> would just work in a "monster model"</p>
</blockquote>
<p>One universe up, just because we can</p>



<a name="208480585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208480585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208480585">(Aug 30 2020 at 11:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error/near/208441088">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="250372">Ashvni Narayanan</span> you might be interested in this. Ashvni is thinking about proving that the class group of a number field is finite. I don't know what the most general statement is. The class group of a general Dedekind domain is not finite -- finiteness is an arithmetic issue, not an algebraic one. The class group of a global field is finite. A global field has a funny definition as far as I can see -- it is either a number field or a finite extension of (Z/pZ)(T). To define the integers of a finite extension of (Z/pZ)(T) you have to "choose an infinity"! If you choose the usual one, then the integers of (Z/pZ)(T) are (Z/pZ)[T], which has trivial class group. Other infinities are available. What is driving the finiteness of the class group? Is it something to do with the fact that all residue fields are finite in both of these cases, or do you need more? I should know this but I don't.</p>
</blockquote>
<p>I am looking into it. I defined a number field, but if <span class="user-mention" data-user-id="131875">@Alexandru-Andrei Bosinta</span>  has already done some non-trivial work on it, I guess it does not make sense to redo it. I wanted to prove the finiteness of the ideal class group of number fields, hoping that the Dedekind domain PRs are done by then. I was also hoping that the proof of finiteness for number fields would give me some ideas as to how much we can generalize the statement. As far as I recall, I think there is a theorem that says that all abelian groups occur as class groups for some Dedekind domain. Moreover, it is sufficient to look at quadratic extensions (this is a highly incomplete statement). That is all I can say as of now.</p>



<a name="208487790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208487790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208487790">(Aug 30 2020 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-id="250372">@Ashvni Narayanan</span>  I say we compare definitions and whatever work each of us done on it. I didn't get to do much though, but I can give you the work I did so far. There is probably a better way to do this, but I find it easiest to post it here for now. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">field</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">rat</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebraic</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">integral_closure</span>

<span class="kn">open</span> <span class="n">function</span>
<span class="n">open_locale</span> <span class="n">classical</span> <span class="n">big_operators</span>

<span class="n">def</span> <span class="n">is_integrally_closed_domain</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span> <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>

<span class="n">class</span> <span class="n">dedekind_id</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
    <span class="o">(</span><span class="n">noetherian</span> <span class="o">:</span> <span class="n">is_noetherian_ring</span> <span class="n">R</span><span class="o">)</span>
    <span class="o">(</span><span class="n">int_closed</span> <span class="o">:</span> <span class="n">is_integrally_closed_domain</span> <span class="n">R</span><span class="o">)</span>
    <span class="o">(</span><span class="n">max_nonzero_primes</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">P</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">,</span> <span class="n">P</span> <span class="bp">≠</span> <span class="err">⊥</span> <span class="bp">→</span> <span class="n">P</span><span class="bp">.</span><span class="n">is_prime</span> <span class="bp">→</span> <span class="n">P</span><span class="bp">.</span><span class="n">is_maximal</span><span class="o">)</span>

<span class="n">class</span> <span class="n">number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span>
   <span class="o">(</span><span class="n">fld</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">)</span>
   <span class="o">(</span><span class="n">alg</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℚ</span> <span class="n">K</span><span class="o">)</span>
   <span class="o">(</span><span class="n">fd</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℚ</span> <span class="n">K</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">field_of_number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_1</span><span class="bp">.</span><span class="n">fld</span>

<span class="kn">instance</span> <span class="n">algebra_of_number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℚ</span> <span class="n">K</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_1</span><span class="bp">.</span><span class="n">alg</span>

<span class="kn">instance</span> <span class="n">infinite_of_number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">infinite</span> <span class="n">K</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="k">let</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℤ</span> <span class="bp">→</span> <span class="n">K</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)),</span>
  <span class="n">apply</span> <span class="n">infinite</span><span class="bp">.</span><span class="n">of_injective</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">hxy</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hxy2</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">),</span> <span class="n">exact</span> <span class="n">hxy</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">),</span> <span class="k">calc</span> <span class="mi">0</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">sub_eq_zero</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hxy</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="o">((</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)))</span> <span class="o">:</span> <span class="n">sub_eq_add_neg</span> <span class="o">(</span><span class="err">↑</span><span class="n">x</span> <span class="err">•</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="err">↑</span><span class="n">y</span> <span class="err">•</span> <span class="mi">1</span><span class="o">)</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">+</span> <span class="o">((</span><span class="bp">-</span><span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">neg_smul</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">add_smul</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">sub_eq_add_neg</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">∨</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span> <span class="o">{</span><span class="n">exact</span> <span class="o">(</span><span class="bp">@</span><span class="n">smul_eq_zero</span> <span class="n">ℚ</span> <span class="n">K</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="n">h</span><span class="o">)},</span>
  <span class="n">cases</span> <span class="n">h2</span><span class="o">,</span> <span class="o">{</span><span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">),</span> <span class="n">exact</span> <span class="n">sub_eq_zero</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h2</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">rat</span><span class="bp">.</span><span class="n">coe_int_inj</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h3</span><span class="o">},</span>
  <span class="o">{</span><span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">h2</span><span class="o">,</span> <span class="n">simp</span><span class="o">}</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">number_ring</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">integral_closure</span> <span class="bp">ℤ</span> <span class="n">K</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">field</span><span class="bp">.</span><span class="n">to_comm_ring</span> <span class="n">K</span> <span class="bp">_</span><span class="n">inst_1</span><span class="bp">.</span><span class="n">fld</span><span class="o">)</span> <span class="bp">_</span>

<span class="kn">theorem</span> <span class="n">integral_domain_of_number_ring</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">integral_domain</span> <span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span><span class="bp">.</span><span class="n">integral_domain</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">):</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">field</span><span class="bp">.</span><span class="n">inv</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">field</span><span class="bp">.</span><span class="n">mul_inv_cancel</span> <span class="n">h</span>

<span class="c">/-</span><span class="cm">- A predicate to express that a ring is a field.</span>

<span class="cm">This is mainly useful because such a predicate does not contain data,</span>
<span class="cm">and can therefore be easily transported along ring isomorphisms. -/</span>
<span class="kn">structure</span> <span class="n">is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
    <span class="o">(</span><span class="n">exists_pair_ne</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span>
    <span class="o">(</span><span class="n">mul_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
    <span class="o">(</span><span class="n">mul_inv_cancel&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="c">/-</span><span class="cm">- Every field satisfies the predicate for integral domains. -/</span>
<span class="kn">lemma</span> <span class="n">field</span><span class="bp">.</span><span class="n">to_is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_field</span> <span class="n">R</span> <span class="o">:=</span>
    <span class="o">{</span><span class="n">mul_inv_cancel&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="n">field</span><span class="bp">.</span><span class="n">mul_inv_cancel</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
   <span class="bp">..</span> <span class="o">(</span><span class="err">‹</span><span class="bp">_</span><span class="err">›</span> <span class="o">:</span> <span class="n">field</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">is_field</span><span class="bp">.</span><span class="n">to_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_field</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">field</span> <span class="n">R</span> <span class="o">:=</span>
    <span class="o">{</span><span class="n">inv</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="k">if</span> <span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="o">(</span><span class="n">is_field</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">h</span> <span class="n">ha</span><span class="o">)),</span>
    <span class="n">inv_zero</span> <span class="o">:=</span> <span class="o">(</span><span class="n">dif_pos</span> <span class="n">rfl</span><span class="o">),</span>
    <span class="n">mul_inv_cancel</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="k">begin</span>
        <span class="n">convert</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some_spec</span> <span class="o">(</span><span class="n">is_field</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">h</span> <span class="n">ha</span><span class="o">),</span>
        <span class="n">exact</span> <span class="n">dif_neg</span> <span class="n">ha</span>
    <span class="kn">end</span><span class="o">),</span>
    <span class="bp">.._</span><span class="n">inst_1</span><span class="o">,</span> <span class="bp">..</span><span class="n">h</span><span class="o">}</span>

<span class="c">/-</span><span class="cm">- There is a unique inverse in a field.</span>
<span class="cm">-/</span>
<span class="kn">lemma</span> <span class="n">uniq_inv_of_is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">is_field</span> <span class="n">R</span><span class="o">]:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="bp">∃!</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">exists_unique_of_exists_of_unique</span><span class="o">,</span>
        <span class="o">{</span><span class="n">exact</span> <span class="bp">_</span><span class="n">inst_2</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">hx</span><span class="o">},</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">z</span> <span class="n">hxy</span> <span class="n">hxz</span><span class="o">,</span>
    <span class="k">calc</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="o">(</span><span class="n">mul_one</span> <span class="n">y</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hxz</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:</span> <span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="o">(</span><span class="n">mul_assoc</span> <span class="n">y</span> <span class="n">x</span> <span class="n">z</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">y</span> <span class="n">x</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hxy</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">z</span> <span class="o">:</span> <span class="n">one_mul</span> <span class="n">z</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm">- If the quotient of a `comm_ring` by an ideal is a field, then the ideal is maximal</span>
<span class="cm">-/</span>
<span class="kn">lemma</span> <span class="n">maximal_ideal_of_is_field_quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">)</span>
<span class="o">[</span><span class="bp">@</span><span class="n">is_field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span> <span class="o">(</span><span class="n">comm_ring</span><span class="bp">.</span><span class="n">to_ring</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span> <span class="n">I</span><span class="o">))]</span> <span class="o">:</span> <span class="n">I</span><span class="bp">.</span><span class="n">is_maximal</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">apply</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">is_maximal_iff</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span> <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
        <span class="n">rcases</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_2</span><span class="bp">.</span><span class="n">exists_pair_ne</span><span class="o">)</span> <span class="k">with</span> <span class="bp">⟨⟨</span><span class="n">x</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">y</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hxy</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">apply</span> <span class="n">hxy</span><span class="o">,</span>
        <span class="n">apply</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span><span class="n">mul_one</span> <span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">),</span>
        <span class="n">apply</span> <span class="n">submodule</span><span class="bp">.</span><span class="n">smul_mem&#39;</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">h</span><span class="o">},</span>
    <span class="o">{</span><span class="n">intros</span> <span class="n">J</span> <span class="n">x</span> <span class="n">hIJ</span> <span class="n">hxnI</span> <span class="n">hxJ</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxn0</span> <span class="o">:</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
        <span class="o">{</span><span class="n">exact</span> <span class="bp">@</span><span class="n">mt</span> <span class="o">((</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="err">∈</span> <span class="n">I</span><span class="o">)</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hxnI</span><span class="o">},</span>
        <span class="k">have</span> <span class="n">hinvx</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">),</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span> <span class="o">{</span><span class="n">exact</span> <span class="bp">_</span><span class="n">inst_2</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">hxn0</span><span class="o">},</span>
        <span class="n">rcases</span> <span class="n">hinvx</span> <span class="k">with</span> <span class="bp">⟨⟨</span><span class="n">y</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">change</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="n">at</span> <span class="n">hy</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span><span class="o">((</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">map_mul</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="n">at</span> <span class="n">hy</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxy1I</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span> <span class="err">∈</span> <span class="n">I</span><span class="o">,</span> <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hy</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxy1J</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hIJ</span> <span class="n">hxy1I</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxyJ</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span> <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mul_mem_right</span> <span class="n">J</span> <span class="n">hxJ</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hend</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="o">(</span><span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span> <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">sub_mem</span> <span class="n">J</span> <span class="n">hxyJ</span> <span class="n">hxy1J</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="o">(</span><span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="k">by</span> <span class="n">ring</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">h1</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">hend</span><span class="o">}</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm">- The quotient of a ring by an ideal is a field iff the ideal is maximal.</span>
<span class="cm">-/</span>
<span class="kn">theorem</span> <span class="n">maximal_ideal_iff_is_field_quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
<span class="n">I</span><span class="bp">.</span><span class="n">is_maximal</span> <span class="bp">↔</span> <span class="o">(</span><span class="bp">@</span><span class="n">is_field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span> <span class="o">(</span><span class="n">comm_ring</span><span class="bp">.</span><span class="n">to_ring</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span> <span class="n">I</span><span class="o">)))</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
        <span class="n">exact</span> <span class="bp">@</span><span class="n">field</span><span class="bp">.</span><span class="n">to_is_field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span> <span class="o">(</span><span class="bp">@</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">field</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">I</span> <span class="n">h</span><span class="o">)},</span>
    <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
        <span class="n">exact</span> <span class="bp">@</span><span class="n">maximal_ideal_of_is_field_quotient</span> <span class="n">R</span> <span class="bp">_</span> <span class="n">I</span> <span class="n">h</span><span class="o">,}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">dedekind_domain_of_number_ring</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">dedekind_id</span> <span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">noetherian</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">int_closed</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">max_nonzero_primes</span> <span class="o">:=</span> <span class="o">(</span><span class="k">begin</span>
    <span class="n">intros</span> <span class="n">P</span> <span class="n">hP</span> <span class="n">hPp</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">hid</span> <span class="o">:</span> <span class="n">integral_domain</span> <span class="n">P</span><span class="bp">.</span><span class="n">quotient</span><span class="o">,</span> <span class="n">exact</span> <span class="bp">@</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">integral_domain</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">P</span> <span class="n">hPp</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">hfin</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">P</span><span class="bp">.</span><span class="n">quotient</span><span class="o">,</span> <span class="o">{</span><span class="n">sorry</span><span class="o">},</span>
    <span class="k">have</span> <span class="n">hf</span> <span class="o">:</span> <span class="n">is_field</span> <span class="o">(</span><span class="n">P</span><span class="bp">.</span><span class="n">quotient</span><span class="o">),</span> <span class="o">{</span><span class="n">sorry</span><span class="o">},</span>
    <span class="n">exact</span> <span class="bp">@</span><span class="n">maximal_ideal_of_is_field_quotient</span> <span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span> <span class="bp">_</span> <span class="n">P</span> <span class="n">hf</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">)}</span>
</code></pre></div>


<p>I defined a number field (hopefully this definition works) and I proved that the field has to be infinite (though I am not sure what this fact will be used for yet). I defined a number ring and attempted to start proving that it is a dedekind domain, but I needed a theorem for that.</p>



<a name="208488967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208488967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208488967">(Aug 30 2020 at 15:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="131875">Alexandru-Andrei Bosinta</span> <a href="#narrow/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error/near/208487790">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="250372">Ashvni Narayanan</span>  I say we compare definitions and whatever work each of us done on it. I didn't get to do much though, but I can give you the work I did so far. There is probably a better way to do this, but I find it easiest to post it here for now. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">field</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">rat</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebraic</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">integral_closure</span>

<span class="kn">open</span> <span class="n">function</span>
<span class="n">open_locale</span> <span class="n">classical</span> <span class="n">big_operators</span>

<span class="n">def</span> <span class="n">is_integrally_closed_domain</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span> <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="err">∣</span> <span class="n">r</span>

<span class="n">class</span> <span class="n">dedekind_id</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
    <span class="o">(</span><span class="n">noetherian</span> <span class="o">:</span> <span class="n">is_noetherian_ring</span> <span class="n">R</span><span class="o">)</span>
    <span class="o">(</span><span class="n">int_closed</span> <span class="o">:</span> <span class="n">is_integrally_closed_domain</span> <span class="n">R</span><span class="o">)</span>
    <span class="o">(</span><span class="n">max_nonzero_primes</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">P</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">,</span> <span class="n">P</span> <span class="bp">≠</span> <span class="err">⊥</span> <span class="bp">→</span> <span class="n">P</span><span class="bp">.</span><span class="n">is_prime</span> <span class="bp">→</span> <span class="n">P</span><span class="bp">.</span><span class="n">is_maximal</span><span class="o">)</span>

<span class="n">class</span> <span class="n">number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span>
   <span class="o">(</span><span class="n">fld</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span><span class="o">)</span>
   <span class="o">(</span><span class="n">alg</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℚ</span> <span class="n">K</span><span class="o">)</span>
   <span class="o">(</span><span class="n">fd</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℚ</span> <span class="n">K</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">field_of_number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">field</span> <span class="n">K</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_1</span><span class="bp">.</span><span class="n">fld</span>

<span class="kn">instance</span> <span class="n">algebra_of_number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">algebra</span> <span class="n">ℚ</span> <span class="n">K</span> <span class="o">:=</span> <span class="bp">_</span><span class="n">inst_1</span><span class="bp">.</span><span class="n">alg</span>

<span class="kn">instance</span> <span class="n">infinite_of_number_field</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">infinite</span> <span class="n">K</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="k">let</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">ℤ</span> <span class="bp">→</span> <span class="n">K</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)),</span>
  <span class="n">apply</span> <span class="n">infinite</span><span class="bp">.</span><span class="n">of_injective</span> <span class="n">f</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">hxy</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hxy2</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">),</span> <span class="n">exact</span> <span class="n">hxy</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">),</span> <span class="k">calc</span> <span class="mi">0</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">sub_eq_zero</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">hxy</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="o">((</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)))</span> <span class="o">:</span> <span class="n">sub_eq_add_neg</span> <span class="o">(</span><span class="err">↑</span><span class="n">x</span> <span class="err">•</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="err">↑</span><span class="n">y</span> <span class="err">•</span> <span class="mi">1</span><span class="o">)</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">+</span> <span class="o">((</span><span class="bp">-</span><span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">neg_smul</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">add_smul</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="err">•</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">sub_eq_add_neg</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">∨</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span> <span class="o">{</span><span class="n">exact</span> <span class="o">(</span><span class="bp">@</span><span class="n">smul_eq_zero</span> <span class="n">ℚ</span> <span class="n">K</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">((</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">-</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">K</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="n">h</span><span class="o">)},</span>
  <span class="n">cases</span> <span class="n">h2</span><span class="o">,</span> <span class="o">{</span><span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">),</span> <span class="n">exact</span> <span class="n">sub_eq_zero</span><span class="bp">.</span><span class="n">mp</span> <span class="n">h2</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">rat</span><span class="bp">.</span><span class="n">coe_int_inj</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h3</span><span class="o">},</span>
  <span class="o">{</span><span class="n">exfalso</span><span class="o">,</span> <span class="n">revert</span> <span class="n">h2</span><span class="o">,</span> <span class="n">simp</span><span class="o">}</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">number_ring</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">integral_closure</span> <span class="bp">ℤ</span> <span class="n">K</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">@</span><span class="n">field</span><span class="bp">.</span><span class="n">to_comm_ring</span> <span class="n">K</span> <span class="bp">_</span><span class="n">inst_1</span><span class="bp">.</span><span class="n">fld</span><span class="o">)</span> <span class="bp">_</span>

<span class="kn">theorem</span> <span class="n">integral_domain_of_number_ring</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">integral_domain</span> <span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span><span class="bp">.</span><span class="n">integral_domain</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">):</span> <span class="n">x</span> <span class="bp">*</span> <span class="o">(</span><span class="n">field</span><span class="bp">.</span><span class="n">inv</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">field</span><span class="bp">.</span><span class="n">mul_inv_cancel</span> <span class="n">h</span>

<span class="c">/-</span><span class="cm">- A predicate to express that a ring is a field.</span>

<span class="cm">This is mainly useful because such a predicate does not contain data,</span>
<span class="cm">and can therefore be easily transported along ring isomorphisms. -/</span>
<span class="kn">structure</span> <span class="n">is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
    <span class="o">(</span><span class="n">exists_pair_ne</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≠</span> <span class="n">y</span><span class="o">)</span>
    <span class="o">(</span><span class="n">mul_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
    <span class="o">(</span><span class="n">mul_inv_cancel&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">},</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="c">/-</span><span class="cm">- Every field satisfies the predicate for integral domains. -/</span>
<span class="kn">lemma</span> <span class="n">field</span><span class="bp">.</span><span class="n">to_is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">field</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_field</span> <span class="n">R</span> <span class="o">:=</span>
    <span class="o">{</span><span class="n">mul_inv_cancel&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="n">field</span><span class="bp">.</span><span class="n">mul_inv_cancel</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
   <span class="bp">..</span> <span class="o">(</span><span class="err">‹</span><span class="bp">_</span><span class="err">›</span> <span class="o">:</span> <span class="n">field</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">is_field</span><span class="bp">.</span><span class="n">to_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_field</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">field</span> <span class="n">R</span> <span class="o">:=</span>
    <span class="o">{</span><span class="n">inv</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="k">if</span> <span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="o">(</span><span class="n">is_field</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">h</span> <span class="n">ha</span><span class="o">)),</span>
    <span class="n">inv_zero</span> <span class="o">:=</span> <span class="o">(</span><span class="n">dif_pos</span> <span class="n">rfl</span><span class="o">),</span>
    <span class="n">mul_inv_cancel</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="k">begin</span>
        <span class="n">convert</span> <span class="n">classical</span><span class="bp">.</span><span class="n">some_spec</span> <span class="o">(</span><span class="n">is_field</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">h</span> <span class="n">ha</span><span class="o">),</span>
        <span class="n">exact</span> <span class="n">dif_neg</span> <span class="n">ha</span>
    <span class="kn">end</span><span class="o">),</span>
    <span class="bp">.._</span><span class="n">inst_1</span><span class="o">,</span> <span class="bp">..</span><span class="n">h</span><span class="o">}</span>

<span class="c">/-</span><span class="cm">- There is a unique inverse in a field.</span>
<span class="cm">-/</span>
<span class="kn">lemma</span> <span class="n">uniq_inv_of_is_field</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">is_field</span> <span class="n">R</span><span class="o">]:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="bp">∃!</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">),</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">intros</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">exists_unique_of_exists_of_unique</span><span class="o">,</span>
        <span class="o">{</span><span class="n">exact</span> <span class="bp">_</span><span class="n">inst_2</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">hx</span><span class="o">},</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">z</span> <span class="n">hxy</span> <span class="n">hxz</span><span class="o">,</span>
    <span class="k">calc</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="o">(</span><span class="n">mul_one</span> <span class="n">y</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">z</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hxz</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">y</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:</span> <span class="n">eq</span><span class="bp">.</span><span class="n">symm</span> <span class="o">(</span><span class="n">mul_assoc</span> <span class="n">y</span> <span class="n">x</span> <span class="n">z</span><span class="o">)</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">y</span> <span class="n">x</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">z</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">hxy</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">z</span> <span class="o">:</span> <span class="n">one_mul</span> <span class="n">z</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm">- If the quotient of a `comm_ring` by an ideal is a field, then the ideal is maximal</span>
<span class="cm">-/</span>
<span class="kn">lemma</span> <span class="n">maximal_ideal_of_is_field_quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">)</span>
<span class="o">[</span><span class="bp">@</span><span class="n">is_field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span> <span class="o">(</span><span class="n">comm_ring</span><span class="bp">.</span><span class="n">to_ring</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span> <span class="n">I</span><span class="o">))]</span> <span class="o">:</span> <span class="n">I</span><span class="bp">.</span><span class="n">is_maximal</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">apply</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">is_maximal_iff</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span> <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
        <span class="n">rcases</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_2</span><span class="bp">.</span><span class="n">exists_pair_ne</span><span class="o">)</span> <span class="k">with</span> <span class="bp">⟨⟨</span><span class="n">x</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">y</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hxy</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">apply</span> <span class="n">hxy</span><span class="o">,</span>
        <span class="n">apply</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span><span class="n">mul_one</span> <span class="o">(</span><span class="n">x</span><span class="bp">-</span><span class="n">y</span><span class="o">),</span>
        <span class="n">apply</span> <span class="n">submodule</span><span class="bp">.</span><span class="n">smul_mem&#39;</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">h</span><span class="o">},</span>
    <span class="o">{</span><span class="n">intros</span> <span class="n">J</span> <span class="n">x</span> <span class="n">hIJ</span> <span class="n">hxnI</span> <span class="n">hxJ</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxn0</span> <span class="o">:</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
        <span class="o">{</span><span class="n">exact</span> <span class="bp">@</span><span class="n">mt</span> <span class="o">((</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="err">∈</span> <span class="n">I</span><span class="o">)</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq_zero_iff_mem</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hxnI</span><span class="o">},</span>
        <span class="k">have</span> <span class="n">hinvx</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">),</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span> <span class="o">{</span><span class="n">exact</span> <span class="bp">_</span><span class="n">inst_2</span><span class="bp">.</span><span class="n">mul_inv_cancel&#39;</span> <span class="n">hxn0</span><span class="o">},</span>
        <span class="n">rcases</span> <span class="n">hinvx</span> <span class="k">with</span> <span class="bp">⟨⟨</span><span class="n">y</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hy</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">change</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="n">at</span> <span class="n">hy</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span><span class="o">((</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk</span> <span class="n">I</span><span class="o">)</span><span class="bp">.</span><span class="n">map_mul</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="n">at</span> <span class="n">hy</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxy1I</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span> <span class="err">∈</span> <span class="n">I</span><span class="o">,</span> <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">eq</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hy</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxy1J</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hIJ</span> <span class="n">hxy1I</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hxyJ</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span> <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">mul_mem_right</span> <span class="n">J</span> <span class="n">hxJ</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">hend</span> <span class="o">:</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="o">(</span><span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="err">∈</span> <span class="n">J</span><span class="o">,</span> <span class="n">exact</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">sub_mem</span> <span class="n">J</span> <span class="n">hxyJ</span> <span class="n">hxy1J</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="o">(</span><span class="n">x</span><span class="bp">*</span><span class="n">y</span><span class="bp">-</span><span class="mi">1</span><span class="o">),</span> <span class="k">by</span> <span class="n">ring</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">h1</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">hend</span><span class="o">}</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm">- The quotient of a ring by an ideal is a field iff the ideal is maximal.</span>
<span class="cm">-/</span>
<span class="kn">theorem</span> <span class="n">maximal_ideal_iff_is_field_quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
<span class="n">I</span><span class="bp">.</span><span class="n">is_maximal</span> <span class="bp">↔</span> <span class="o">(</span><span class="bp">@</span><span class="n">is_field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span> <span class="o">(</span><span class="n">comm_ring</span><span class="bp">.</span><span class="n">to_ring</span> <span class="o">(</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span> <span class="n">I</span><span class="o">)))</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
        <span class="n">exact</span> <span class="bp">@</span><span class="n">field</span><span class="bp">.</span><span class="n">to_is_field</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span> <span class="o">(</span><span class="bp">@</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">field</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">I</span> <span class="n">h</span><span class="o">)},</span>
    <span class="o">{</span><span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
        <span class="n">exact</span> <span class="bp">@</span><span class="n">maximal_ideal_of_is_field_quotient</span> <span class="n">R</span> <span class="bp">_</span> <span class="n">I</span> <span class="n">h</span><span class="o">,}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">dedekind_domain_of_number_ring</span> <span class="o">(</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">number_field</span> <span class="n">K</span><span class="o">]</span> <span class="o">:</span> <span class="n">dedekind_id</span> <span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">noetherian</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">int_closed</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">max_nonzero_primes</span> <span class="o">:=</span> <span class="o">(</span><span class="k">begin</span>
    <span class="n">intros</span> <span class="n">P</span> <span class="n">hP</span> <span class="n">hPp</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">hid</span> <span class="o">:</span> <span class="n">integral_domain</span> <span class="n">P</span><span class="bp">.</span><span class="n">quotient</span><span class="o">,</span> <span class="n">exact</span> <span class="bp">@</span><span class="n">ideal</span><span class="bp">.</span><span class="n">quotient</span><span class="bp">.</span><span class="n">integral_domain</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">P</span> <span class="n">hPp</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">hfin</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">P</span><span class="bp">.</span><span class="n">quotient</span><span class="o">,</span> <span class="o">{</span><span class="n">sorry</span><span class="o">},</span>
    <span class="k">have</span> <span class="n">hf</span> <span class="o">:</span> <span class="n">is_field</span> <span class="o">(</span><span class="n">P</span><span class="bp">.</span><span class="n">quotient</span><span class="o">),</span> <span class="o">{</span><span class="n">sorry</span><span class="o">},</span>
    <span class="n">exact</span> <span class="bp">@</span><span class="n">maximal_ideal_of_is_field_quotient</span> <span class="o">(</span><span class="n">number_ring</span> <span class="n">K</span><span class="o">)</span> <span class="bp">_</span> <span class="n">P</span> <span class="n">hf</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">)}</span>
</code></pre></div>


<p>I defined a number field (hopefully this definition works) and I proved that the field has to be infinite (though I am not sure what this fact will be used for yet). I defined a number ring and attempted to start proving that it is a dedekind domain, but I needed a theorem for that.</p>
</blockquote>
<p>Thanks a lot, this is very helpful!</p>



<a name="208497370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208497370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208497370">(Aug 30 2020 at 18:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> I wrote the theorem (quotient by an ideal is a field iff the ideal is maximal) and I want to make a pull request. I read from the page "How to contribute to mathlib", so I would like to ask for write access to a non-master branch. I don't really know who to ask (or even if what I am asking makes sense, but that is what that page tells you to ask for). My github username is AlexandruBosinta.</p>



<a name="208497384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208497384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208497384">(Aug 30 2020 at 18:12)</a>:</h4>
<p>You ask <span class="user-group-mention" data-user-group-id="2494">@maintainers</span></p>



<a name="208497410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208497410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208497410">(Aug 30 2020 at 18:13)</a>:</h4>
<p>Your docstring comment <code>/-- Every field satisfies the predicate for integral domains. -/</code> should probably say <code>...for fields</code></p>



<a name="208497412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208497412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208497412">(Aug 30 2020 at 18:13)</a>:</h4>
<p><span class="user-mention" data-user-id="131875">@Alexandru-Andrei Bosinta</span> Invite sent! <a href="https://github.com/leanprover-community/mathlib/invitations">https://github.com/leanprover-community/mathlib/invitations</a></p>



<a name="208497470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208497470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexandru-Andrei Bosinta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208497470">(Aug 30 2020 at 18:14)</a>:</h4>
<p>Yeah, I changed it. That was what was originally written there (I took it directly from some code you posted on another thread) and I didn't initially change it.</p>



<a name="208559556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208559556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenji Nakagawa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208559556">(Aug 31 2020 at 13:58)</a>:</h4>
<p>It's worth mentioning <span class="user-mention" data-user-id="131875">@Alexandru-Andrei Bosinta</span> and <span class="user-mention" data-user-id="250372">@Ashvni Narayanan</span> that there's a thread in #maths called "Dedekind Domains" which should be of interest.</p>



<a name="208560078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208560078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208560078">(Aug 31 2020 at 14:02)</a>:</h4>
<p>Yes, this thread is poorly named now and hence will be hard to find later</p>



<a name="208562111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20Type%20Mismatch%20error/near/208562111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ashvni Narayanan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error.html#208562111">(Aug 31 2020 at 14:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="319839">Kenji Nakagawa</span> <a href="#narrow/stream/113489-new-members/topic/Weird.20Type.20Mismatch.20error/near/208559556">said</a>:</p>
<blockquote>
<p>It's worth mentioning <span class="user-mention silent" data-user-id="131875">Alexandru-Andrei Bosinta</span> and <span class="user-mention silent" data-user-id="250372">Ashvni Narayanan</span> that there's a thread in #maths called "Dedekind Domains" which should be of interest.</p>
</blockquote>
<p>Thank you!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>