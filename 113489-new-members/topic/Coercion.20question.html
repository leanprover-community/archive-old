---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Coercion.20question.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html">Coercion question</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="205927879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205927879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205927879">(Aug 04 2020 at 16:20)</a>:</h4>
<p>I have the following in my context:</p>
<p><a href="/user_uploads/3121/I8-zRwJcXF255WYmTVJkTMbC/context.png">context.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/I8-zRwJcXF255WYmTVJkTMbC/context.png" title="context.png"><img src="/user_uploads/3121/I8-zRwJcXF255WYmTVJkTMbC/context.png"></a></div><p>with the corresponding types:</p>
<p><a href="/user_uploads/3121/lbl6HRT-a854mDX8OAjKSB-o/xtxtype.png">xtxtype.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/lbl6HRT-a854mDX8OAjKSB-o/xtxtype.png" title="xtxtype.png"><img src="/user_uploads/3121/lbl6HRT-a854mDX8OAjKSB-o/xtxtype.png"></a></div><p>I didn't find a way to obtain the goal, everything seems to fail (<code>norm_cast</code>, <code>fin.coe_eq_val</code>, <code>fin.coe_fin_lt.mp</code>). Does anyone see something that might work here?</p>



<a name="205927909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205927909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205927909">(Aug 04 2020 at 16:20)</a>:</h4>
<p>does <code>exact h3</code> work?</p>



<a name="205927921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205927921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205927921">(Aug 04 2020 at 16:20)</a>:</h4>
<p>Nope</p>



<a name="205927937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205927937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205927937">(Aug 04 2020 at 16:21)</a>:</h4>
<p>apply h3?</p>



<a name="205927979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205927979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205927979">(Aug 04 2020 at 16:21)</a>:</h4>
<p>Funny I didn't try this last one. I'll give it a try in a sec.</p>



<a name="205928075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928075">(Aug 04 2020 at 16:22)</a>:</h4>
<p>No, it doesn't.</p>



<a name="205928089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928089">(Aug 04 2020 at 16:22)</a>:</h4>
<p>just bite the bullet and do cases on i and j</p>



<a name="205928112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928112">(Aug 04 2020 at 16:22)</a>:</h4>
<p><code>finish</code> would probably work :)</p>



<a name="205928130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928130">(Aug 04 2020 at 16:22)</a>:</h4>
<p>I think <code>h3</code> might say something like <code>j % (n + 2) &lt; (i + 1) % (n + 2)</code> or something</p>



<a name="205928195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928195">(Aug 04 2020 at 16:23)</a>:</h4>
<p>and you can prove <code>j % (n + 2) = j</code> by <code>mod_lt</code> or something</p>



<a name="205928290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928290">(Aug 04 2020 at 16:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/113489-new-members/topic/Coercion.20question/near/205928112">said</a>:</p>
<blockquote>
<p><code>finish</code> would probably work :)</p>
</blockquote>
<p>It doesn't. I wish it did.</p>



<a name="205928308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928308">(Aug 04 2020 at 16:24)</a>:</h4>
<p>Oh, I see the coercion is going into fin (n+2). Missed that.</p>



<a name="205928535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205928535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205928535">(Aug 04 2020 at 16:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Coercion.20question/near/205928130">said</a>:</p>
<blockquote>
<p>I think <code>h3</code> might say something like <code>j % (n + 2) &lt; (i + 1) % (n + 2)</code> or something</p>
</blockquote>
<p>Thanks, I'll have to try <code>cases</code> I guess. Maybe I get to see if there's a hidden problem somewhere in the process.</p>



<a name="205931768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205931768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205931768">(Aug 04 2020 at 16:56)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">fin</span> <span class="n">tactic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">j</span><span class="bp">.</span><span class="n">val</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">succ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">)))</span> <span class="o">:</span> <span class="n">j</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">succ</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="o">(</span><span class="n">j</span><span class="bp">.</span><span class="n">val</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">val</span> <span class="bp">=</span> <span class="n">j</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">fin</span><span class="bp">.</span><span class="n">coe_val_of_lt</span> <span class="o">(</span><span class="k">show</span> <span class="n">j</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">,</span> <span class="k">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">j</span><span class="bp">.</span><span class="mi">2</span><span class="o">])</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">succ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">val</span> <span class="bp">=</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">succ</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">fin</span><span class="bp">.</span><span class="n">coe_val_of_lt</span> <span class="o">(</span><span class="k">show</span> <span class="n">i</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">,</span> <span class="k">by</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">i</span><span class="bp">.</span><span class="mi">2</span><span class="o">])</span> <span class="o">},</span>
  <span class="n">change</span> <span class="o">(</span><span class="n">j</span><span class="bp">.</span><span class="n">val</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">i</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">succ</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">val</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rwa</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="205932189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205932189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205932189">(Aug 04 2020 at 17:00)</a>:</h4>
<p>This looks like a situation it would be better not to get into in the first place</p>



<a name="205932477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205932477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205932477">(Aug 04 2020 at 17:03)</a>:</h4>
<p>e.g. if <code>h3</code> was stated in terms of things like <code>cast_succ</code></p>



<a name="205942090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205942090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205942090">(Aug 04 2020 at 18:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113489-new-members/topic/Coercion.20question/near/205932477">said</a>:</p>
<blockquote>
<p>e.g. if <code>h3</code> was stated in terms of things like <code>cast_succ</code></p>
</blockquote>
<p>That <code>h3</code> comes from something like this:</p>
<div class="codehilite"><pre><span></span><code>    <span class="n">rcases</span> <span class="n">lt_trichotomy</span> <span class="o">((</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">)</span> <span class="o">)</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="k">with</span> <span class="n">h1</span><span class="bp">|</span><span class="n">h2</span><span class="bp">|</span><span class="n">h3</span><span class="o">,</span>
</code></pre></div>


<p>and is the one case that leads to <code>false</code>. I did expect to have trouble with it, the other two  worked like a charm. How could I have done a better job with <code>cast_succ</code>?</p>



<a name="205943475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205943475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205943475">(Aug 04 2020 at 18:36)</a>:</h4>
<p>Don't write things like <code>((i+1) : fin (n+2))</code> (you implicitly used a coercion here) but instead use methods of <code>fin</code> designed for this purpose</p>



<a name="205943548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/205943548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#205943548">(Aug 04 2020 at 18:37)</a>:</h4>
<p>see the top of <code>data.fin</code></p>



<a name="206147642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206147642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206147642">(Aug 06 2020 at 14:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113489-new-members/topic/Coercion.20question/near/205943475">said</a>:</p>
<blockquote>
<p>Don't write things like <code>((i+1) : fin (n+2))</code> (you implicitly used a coercion here) but instead use methods of <code>fin</code> designed for this purpose</p>
</blockquote>
<p>This is very good advice, unfortunately I just got it too late and am not sure what to do now. I have a rather dense 200-lines proof that hinges on this one <code>sorry</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">fin</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">lemma</span> <span class="n">fin_lt_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="o">((</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>


<p>which I thought was easy when I outlined the proof, but it turns out I couldn't bring to completion (one of the ways I tried is below). Does anyone see how to finish this? I can't seem to figure out how to use an alternative at the place I need this. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">fin_lt_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="o">((</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="n">apply</span> <span class="n">fin</span><span class="bp">.</span><span class="n">lt_iff_val_lt_val</span><span class="bp">.</span><span class="n">mpr</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">,</span> <span class="n">linarith</span> <span class="o">[</span><span class="n">i</span><span class="bp">.</span><span class="mi">2</span><span class="o">],</span>
    <span class="k">have</span> <span class="n">h2</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">fin</span><span class="bp">.</span><span class="n">coe_val_of_lt</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">i</span><span class="bp">.</span><span class="n">val</span> <span class="n">h1</span><span class="o">,</span>
    <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="206148930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206148930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206148930">(Aug 06 2020 at 14:33)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">lemma</span> <span class="n">fin_lt_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="o">((</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">fin</span><span class="bp">.</span><span class="n">lt_iff_val_lt_val</span><span class="bp">.</span><span class="n">mpr</span><span class="o">,</span>
  <span class="n">convert</span> <span class="n">nat</span><span class="bp">.</span><span class="n">lt_succ_self</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="206245732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206245732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206245732">(Aug 07 2020 at 11:18)</a>:</h4>
<p>this is a nightmare to prove.</p>



<a name="206245776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206245776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206245776">(Aug 07 2020 at 11:19)</a>:</h4>
<p>The case i = 0 is defeq to <code>0 &lt; (0 + (0 + 1) % (n + (0 + 1) + 1)) % (n + bit0 (0 + 1)),</code></p>



<a name="206245851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206245851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206245851">(Aug 07 2020 at 11:20)</a>:</h4>
<p>Just refactor, it will be easier and will save you more pain later</p>



<a name="206246162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206246162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206246162">(Aug 07 2020 at 11:24)</a>:</h4>
<p>Fwiw I've proven this (PM with Dan). I have a better proof that doesn't use norm cast and things, but I'm on my phone rn.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">fin_lt_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">i</span> <span class="k">with</span> <span class="n">i</span> <span class="n">hi</span><span class="o">,</span>
  <span class="n">change</span> <span class="o">(</span><span class="bp">_</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">val</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="bp">_</span> <span class="o">:</span> <span class="n">fin</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">2</span><span class="o">))</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fin</span><span class="bp">.</span><span class="n">coe_mk</span><span class="o">,</span> <span class="n">coe_coe</span><span class="o">],</span>
  <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">fin</span><span class="bp">.</span><span class="n">coe_val_of_lt</span><span class="o">,</span> <span class="n">fin</span><span class="bp">.</span><span class="n">coe_val_of_lt</span><span class="o">]</span><span class="bp">;</span> <span class="n">omega</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="206246192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206246192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206246192">(Aug 07 2020 at 11:25)</a>:</h4>
<p>nice!</p>



<a name="206246288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206246288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206246288">(Aug 07 2020 at 11:26)</a>:</h4>
<p>There's a few more <code>fin</code> lemmas that I was gonna PR today, but my internet decided to not work very well. I'll try and PR these to mathlib tomorrow (should these be PR-ed?)</p>



<a name="206260400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20question/near/206260400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Stanescu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20question.html#206260400">(Aug 07 2020 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Coercion.20question/near/206245732">said</a>:</p>
<blockquote>
<p>this is a nightmare to prove.</p>
</blockquote>
<p>I really think this would be useful in <code>mathlib</code>. <code>fin</code>is a great type to have for finite-length sequences, as the discussion initiated by <span class="user-mention" data-user-id="139442">@Patrick Thomas</span> about partitions/Riemann sums also suggests. This result is very helpful when working with <code>strict_mono</code> sequences, which will be needed in many circumstances, most probably including that case (refining partitions). Kudos <span class="user-mention" data-user-id="266440">@Shing Tak Lam</span> !</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>