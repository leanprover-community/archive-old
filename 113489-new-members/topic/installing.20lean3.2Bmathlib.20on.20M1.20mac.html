---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html">installing lean3+mathlib on M1 mac</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322013324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322013324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322013324">(Jan 18 2023 at 10:09)</a>:</h4>
<p>Hi all! I also have an M1 mac now, and am stuck :( can any kind soul help?</p>
<p>Installation of lean, leanproject etc. went well, I have the native versions from homebrew and followed the trick to install leanpkg (without actually creating a parallel x86-homebrew).</p>
<p>I can then run "leanproject new testproject", which gives me a fresh project with lean 3.50.3 </p>
<p>I can then "cd testproject" and "emacs src/test.lean" and type "#check 1" which works well.</p>
<p>However, I type "import algebra.group.basic" and all hell breaks loose: "invalid import data.option.defs", "excessive memory consumption" etc.</p>



<a name="322031336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322031336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322031336">(Jan 18 2023 at 11:41)</a>:</h4>
<p>This suggests Mathlib hasn't been successfully added to your project. What happens after running <code>leanproject add-mathlib</code> in your project folder and trying again to <code>import algebra.group.basic</code>?</p>



<a name="322044969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322044969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322044969">(Jan 18 2023 at 12:54)</a>:</h4>
<p>Thanks Anne, you're a magician!<br>
It said "This project already depends on mathlib"; but now all works!</p>



<a name="322048090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322048090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322048090">(Jan 18 2023 at 13:09)</a>:</h4>
<p>Uh... celebrated too quickly. <code>import algebra.group.basic</code> works, but <code>import tactic</code> produces</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.option.defs</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">expression</span> <span class="n">traversal'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.option.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">option.elim._main'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.option.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">option.elim._main'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.option.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">option.elim._main'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.option.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">option.elim._main'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.quot</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">replace'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">algebra.group.defs</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">expression</span> <span class="n">traversal'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">algebra.group.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">has_vadd'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.prod.basic</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">replace'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">algebra.group.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">has_vadd'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">order.hom.basic</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">expression</span> <span class="n">traversal'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">algebra.group.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">has_vadd'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">data.prod.basic</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">prod_map'</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">order.rel_classes</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">replace'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">order.lattice</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">replace'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">order.lattice</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">le_antisymm''</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">order.lattice</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">le_antisymm''</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">order.with_bot</span>
<span class="n">excessive</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">expression</span> <span class="n">traversal'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">memory</span> <span class="n">consumption</span> <span class="n">threshold</span><span class="o">)</span>
<span class="n">invalid</span> <span class="kn">import</span><span class="o">:</span> <span class="n">algebra.group.defs</span>
<span class="n">invalid</span> <span class="n">object</span> <span class="n">declaration</span><span class="o">,</span> <span class="n">environment</span> <span class="n">already</span> <span class="n">has</span> <span class="n">an</span> <span class="n">object</span> <span class="n">named</span> <span class="bp">'</span><span class="n">has_vadd'</span>
<span class="bp">...</span>
</code></pre></div>
<p>How can I determine which parts of my install are broken? It used to work just fine^{TM} before that.</p>



<a name="322048824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322048824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322048824">(Jan 18 2023 at 13:13)</a>:</h4>
<p>I'd first try to close vs code and start again - if that doesn't work, probably your cache is messed up</p>



<a name="322049201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322049201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322049201">(Jan 18 2023 at 13:15)</a>:</h4>
<p><span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> yes, I'm sure my cache is messed up! Just, how do I unmess it? I use emacs. I tried <code>leanproject get-mathlib-cache</code> and <code>leanproject add-mathlib</code>. Also, <code>leanproject check</code> say's I'm good.</p>



<a name="322056771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322056771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322056771">(Jan 18 2023 at 13:50)</a>:</h4>
<p>If you already ran <code>leanproject get-mathlib-cache</code> without issues, then running <code>lean --make _target/deps/mathlib/src/tactic/default.lean</code> in your project directory should finish within a few seconds with no output.</p>



<a name="322056953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322056953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322056953">(Jan 18 2023 at 13:51)</a>:</h4>
<p>If this takes a long time and/or gives output, I'd delete the cache (<code>~/.mathlib/bunch-of-numbers.tar.xz</code>) and rerun <code>leanproject get-mathlib-cache</code>.</p>



<a name="322057485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322057485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322057485">(Jan 18 2023 at 13:54)</a>:</h4>
<p>If the <code>lean</code> command finishes quickly, then the issue is probably with Emacs. On VS Code or nvim I'd advise making sure to run your editor in the right working directory (i.e. Open Folder in the menu or <code>:cd ...</code>), but I recall that (spac)emacs, back when I used to use it, already automatically opened the right directory. Still, something you might want to try out.</p>



<a name="322063282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322063282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322063282">(Jan 18 2023 at 14:18)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> I tried this; this is what happens:</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">% </span>rm ~/.mathlib/*xz
<span class="gp">% </span>leanproject get-mathlib-cache
<span class="go">Looking for mathlib oleans for 6890b009ba</span>
<span class="go">  locally...</span>
<span class="go">  remotely...</span>
<span class="go">  Found remote mathlib oleans</span>
<span class="go">Located matching cache</span>
<span class="go">  6890b009ba: 100%|█████████████████████████████████████████████████████████████████| 84.6M/84.6M [00:13&lt;00:00, 6.40MB/s]</span>
<span class="go">Applying cache</span>
<span class="go">  files extracted: 3036 [00:05, 603.78/s]</span>
<span class="gp">% </span>lean --make _target/deps/mathlib/src/tactic/default.lean
<span class="go">/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/logic/function/basic.lean: function.factors_through.apply_ex/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/logic/relation.lean: relation.refl_trans_gen.head_induction_/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/logic/relation.lean: relation.refl_trans_gen.total_of_right_/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/order/monotone/basic.lean: not_monotone_not_antitone_iff_exi/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/logic/equiv/basic.lean: equiv.prod_congr_left_trans_prod_com/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/control/traversable/lemmas.lean: traversable.traverse_eq_map/Users/laurent/src/lean/testproject/_target/deps/mathlib/src/logic/equiv/basic.lean: parsing at line 1312^C</span>
</code></pre></div>
<p>(I interrupted it when it was clear it was recompiling everything).</p>



<a name="322063822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322063822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322063822">(Jan 18 2023 at 14:20)</a>:</h4>
<p>Perhaps the lean versions mismatch? What is the output of <code>lean --version</code>, the value of <code>lean_version</code> in <code>leanpkg.toml</code> and the value of <code>lean_version</code> in <code>_target/deps/mathlib/leanpkg.toml</code>? If they mismatch, try changing the value in <code>leanpkg.toml</code> to match that one in <code>_target/deps/mathlib/leanpkg.toml</code> and recompiling.</p>



<a name="322064665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322064665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322064665">(Jan 18 2023 at 14:24)</a>:</h4>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="gp">% </span>lean --version
<span class="go">Lean (version 3.50.3, Release)</span>
<span class="gp">% </span>grep lean_version _target/deps/mathlib/leanpkg.toml leanpkg.toml
<span class="go">_target/deps/mathlib/leanpkg.toml:lean_version = "leanprover-community/lean:3.50.3"</span>
<span class="go">leanpkg.toml:lean_version = "leanprover-community/lean:3.50.3"</span>
<span class="gp">% </span>which lean
<span class="go">/opt/homebrew/bin/lean</span>
</code></pre></div>



<a name="322066600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322066600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322066600">(Jan 18 2023 at 14:32)</a>:</h4>
<p>It's somewhat suspicious that <code>which lean</code> returns a path in homebrew, shouldn't it be something like <code>~/.elan/bin/lean</code>? But the version numbers look okay so that is probably not it...</p>



<a name="322066691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322066691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322066691">(Jan 18 2023 at 14:32)</a>:</h4>
<p>I think we'll need someone with actual Mac (M1) experience to take a look at this :(</p>



<a name="322069824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322069824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alistair Tucker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322069824">(Jan 18 2023 at 14:45)</a>:</h4>
<p>What is the "leanpkg trick"?</p>



<a name="322151815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322151815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322151815">(Jan 18 2023 at 21:00)</a>:</h4>
<p><span class="user-mention" data-user-id="111433">@Alistair Tucker</span> The "leanpkg trick" is to install leanpkg, and then modify its x86_64 executables by hand to make them point to native ones.</p>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> It's stranger and stranger... after a few random attempts (which I didn't write down) I got at one moment the <code>lean --make</code> command to return without output. I can't get there anymore now; however, it seems that just letting <code>lean --make</code> run recomputes the cache, and I'm now in a state where I can work. This is perfectly acceptable for me; is there a command such as <code>leanproject compile-mathlib</code> which would run all the  necessary<code>lean --make</code> for me, without attempting to pull a cache?</p>



<a name="322174136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322174136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alistair Tucker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322174136">(Jan 18 2023 at 23:33)</a>:</h4>
<p>It's not clear how it might cause the problems you describe, but your setup is distinctly nonstandard. Still it sounds like someone got it working at some point and left instructions that you were able to follow? You should be able to achieve something similar using <code>elan</code> (which virtually everyone does) and in particular <code>elan toolchain link</code>.</p>



<a name="322195353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322195353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322195353">(Jan 19 2023 at 03:48)</a>:</h4>
<p>I only skimmed the thread, so possibly someone's mentioned it, but yeah, having an <code>/opt/homebrew/bin/lean</code> means you ran <code>brew install lean</code> at some point, so run <code>brew uninstall lean</code>. Depending on where you have put the elan toolchain directory on your PATH that may be your only issue, or you may still have another.</p>



<a name="322195358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322195358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322195358">(Jan 19 2023 at 03:48)</a>:</h4>
<p>So run the <code>brew uninstall</code> then share <code>type -a lean</code> probably</p>



<a name="322240501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322240501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alistair Tucker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322240501">(Jan 19 2023 at 10:10)</a>:</h4>
<p>Well Laurent will still need a <code>lean</code> and last time I checked <code>elan</code> was not able to  find an aarch_64 version by itself. My idea was rather that <code>elan toolchain link</code> be used to link to the <code>lean</code> in <code>opts/homebrew</code>. I can't claim to have tried exactly that, but I have used <code>elan</code> to link to an aarch_64 <code>lean</code> compiled locally (which remains yet another option).</p>



<a name="322245365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322245365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Laurent Bartholdi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322245365">(Jan 19 2023 at 10:34)</a>:</h4>
<p>OK, a progress report. My idea was to install elan as a x86_64 application, and then <code>elan toolchain link</code> the homebrew version of lean into elan. It seems that only using the self-compiled lean works, though, something must be weird with homebrew's. Here's in summary what I did, hopefully it helps someone in the same situation as mine.</p>
<div class="codehilite" data-code-language="Bash Session"><pre><span></span><code><span class="go">cd /usr/local/src</span>
<span class="go">git clone https://github.com/leanprover/elan.git</span>
<span class="go">git clone https://github.com/leanprover/lean.git</span>
<span class="go">cd elan</span>
<span class="go">cargo build &amp;&amp; cargo install</span>
<span class="go">cd target/release</span>
<span class="go">./elan-init</span>
<span class="gp"># </span>don<span class="err">'</span>t panic about error messages which will come up when elan fails to find binaries!
<span class="gp"># </span>each <span class="nb">time</span> you see a missing binary, carefully note its release number and follow steps such as the following.
<span class="go">cd /usr/local/src/lean</span>
<span class="go">git checkout v3.24.0 &amp;&amp; mkdir -p build/release &amp;&amp; cd build/release</span>
<span class="go">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/src/lean/v3.24.0 ../../src &amp;&amp; make -j install</span>
<span class="go">elan toolchain link leanprover-community--lean---3.24.0 /usr/local/src/lean/v3.24.0</span>

<span class="go">cd /usr/local/src/lean</span>
<span class="go">git checkout v3.50.3 &amp;&amp; mkdir -p build/release &amp;&amp; cd build/release</span>
<span class="go">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/src/lean/v3.50.3 ../../src &amp;&amp; make -j install</span>
<span class="go">elan toolchain link leanprover-community--lean---3.50.3 /usr/local/src/lean/v3.50.3</span>

<span class="go">elan toolchain link stable /usr/local/src/lean/v3.50.3</span>
<span class="go">elan default stable</span>
</code></pre></div>



<a name="322254161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/installing%20lean3%2Bmathlib%20on%20M1%20mac/near/322254161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alistair Tucker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/installing.20lean3.2Bmathlib.20on.20M1.20mac.html#322254161">(Jan 19 2023 at 11:18)</a>:</h4>
<p>In fact <code>elan</code> also has an aarch_64 version that you can install using the instructions <a href="https://github.com/leanprover/elan#manual-installation">here</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>