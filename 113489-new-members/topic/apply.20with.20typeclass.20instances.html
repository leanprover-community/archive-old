---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html">apply with typeclass instances</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197064088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064088">(May 10 2020 at 16:20)</a>:</h4>
<p>Is there a variant of apply which creates new goals for any missing type class instances?</p>



<a name="197064105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064105">(May 10 2020 at 16:21)</a>:</h4>
<p>it randomly seems to do this sometimes already, usually in circumstances where the new goals can be solved by <code>apply_instance</code>...</p>



<a name="197064117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064117">(May 10 2020 at 16:21)</a>:</h4>
<p>I assume you're using a recent Lean? there was some issue with <code>apply</code> and type classes but it was fixed a fairly long time ago</p>



<a name="197064120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064120">(May 10 2020 at 16:22)</a>:</h4>
<p>"fixed" possibly meaning we replaced a heuristic with a much better but maybe still not always correct heuristic, I'm not sure.</p>



<a name="197064161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064161">(May 10 2020 at 16:22)</a>:</h4>
<p>Yeah I'm on 3.9.0 right now - I did have the impression that this used to happen as well but I can't be sure</p>



<a name="197064171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064171">(May 10 2020 at 16:22)</a>:</h4>
<p>I think the new goal I want isn't solved by apply_instance</p>



<a name="197064202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064202">(May 10 2020 at 16:23)</a>:</h4>
<p>Probably not, given that <code>apply</code> (1) isn't finding the instance, (2) isn't creating a new goal.</p>



<a name="197064224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064224">(May 10 2020 at 16:23)</a>:</h4>
<p>Maybe just use <code>haveI</code> or <code>letI</code> first?</p>



<a name="197064260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064260">(May 10 2020 at 16:23)</a>:</h4>
<p>Yeah that's probably the most sensible solution, just thought I'd check first! Thanks</p>



<a name="197064262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064262">(May 10 2020 at 16:23)</a>:</h4>
<p>Also, while <code>apply</code> is difficult, I seem to recall that <code>exact</code> or <code>refine</code> might have an option for this</p>



<a name="197064316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064316">(May 10 2020 at 16:24)</a>:</h4>
<p>Or its default behavior might do what you want</p>



<a name="197064332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064332">(May 10 2020 at 16:24)</a>:</h4>
<p>The default behaviour for both of those doesn't do what I want</p>



<a name="197064382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064382">(May 10 2020 at 16:25)</a>:</h4>
<p>Oh, I see there's <code>apply_with</code></p>



<a name="197064423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064423">(May 10 2020 at 16:26)</a>:</h4>
<p><code>apply_with blah { instances := ff }</code> maybe</p>



<a name="197064442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064442">(May 10 2020 at 16:26)</a>:</h4>
<p>I find it slightly surprising that using @ and term mode, leaving the missing instance as <code>_</code> gives the error <code>failed to synthesize type class instance</code> instead of saying couldn't synthesize term</p>



<a name="197064449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064449">(May 10 2020 at 16:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113489-new-members/topic/apply.20with.20typeclass.20instances/near/197064423" title="#narrow/stream/113489-new-members/topic/apply.20with.20typeclass.20instances/near/197064423">said</a>:</p>
<blockquote>
<p><code>apply_with blah { instances := ff }</code> maybe</p>
</blockquote>
<p>This doesn't seem to work for me...</p>



<a name="197064450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064450">(May 10 2020 at 16:27)</a>:</h4>
<p><code>haveI</code> probably is the best thing to do here</p>



<a name="197064468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064468">(May 10 2020 at 16:27)</a>:</h4>
<p>I've also noticed that it seems kind of random what happens with this. I encountered this just yesterday with <code>refine</code> I think.</p>



<a name="197064530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064530">(May 10 2020 at 16:28)</a>:</h4>
<p>Oh hang on, the <code>apply_with</code> thing works when I don't use <code>@</code></p>



<a name="197064533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064533">(May 10 2020 at 16:28)</a>:</h4>
<p>I gave <code>refine</code> a pretty complicated expression involving <code>_</code> inside a lambda and stuff, no idea if that was relevant.</p>



<a name="197064613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064613">(May 10 2020 at 16:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="246273">Bhavik Mehta</span> <a href="#narrow/stream/113489-new-members/topic/apply.20with.20typeclass.20instances/near/197064530" title="#narrow/stream/113489-new-members/topic/apply.20with.20typeclass.20instances/near/197064530">said</a>:</p>
<blockquote>
<p>Oh hang on, the <code>apply_with</code> thing works when I don't use <code>@</code></p>
</blockquote>
<p><code>apply_with (preserves_hpb over.forget) { instances := ff } ,</code> does create the new goal, <code>apply_with (preserves_hpb over.forget t) { instances := ff }</code> doesn't</p>



<a name="197064681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064681">(May 10 2020 at 16:30)</a>:</h4>
<p>and the instances doesn't need to be mentioned at all actually</p>



<a name="197064685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197064685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197064685">(May 10 2020 at 16:30)</a>:</h4>
<p>It seems like it's something to do with where the instance is in the declaration</p>



<a name="197065021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197065021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197065021">(May 10 2020 at 16:36)</a>:</h4>
<p>I would believe that</p>



<a name="197066234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197066234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197066234">(May 10 2020 at 17:05)</a>:</h4>
<p>My hacky workaround to this issue is to use <code>refine @foo _ _ (id _) bar</code></p>



<a name="197066270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197066270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197066270">(May 10 2020 at 17:06)</a>:</h4>
<p>where the <code>id</code> is on the typeclass I want to prove</p>



<a name="197066282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197066282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197066282">(May 10 2020 at 17:06)</a>:</h4>
<p><span class="user-mention" data-user-id="246273">@Bhavik Mehta</span></p>



<a name="197066307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197066307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197066307">(May 10 2020 at 17:07)</a>:</h4>
<p>Cool, thanks!</p>



<a name="197066315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply%20with%20typeclass%20instances/near/197066315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply.20with.20typeclass.20instances.html#197066315">(May 10 2020 at 17:07)</a>:</h4>
<p>It turned out my thing should have been inferred anyway, and I just didn't have the right imports</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>