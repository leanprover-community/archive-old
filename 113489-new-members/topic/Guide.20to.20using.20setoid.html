---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Guide.20to.20using.20setoid.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html">Guide to using setoid</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="278526084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278526084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278526084">(Apr 11 2022 at 09:08)</a>:</h4>
<p>Is there a comprehensive-ish tutorial on using setoid in specific written somewhere? There's one section on it in Theorem Proving in Lean I found, but it doesn't go into much detail and I'm having a lot of trouble actually using it in practice.</p>



<a name="278529582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278529582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278529582">(Apr 11 2022 at 09:43)</a>:</h4>
<p>Here's what I wrote about them for my recent course <a href="https://www.ma.imperial.ac.uk/~buzzard/xena/formalising-mathematics-2022/Part_A/section06quotients/quotients.html">https://www.ma.imperial.ac.uk/~buzzard/xena/formalising-mathematics-2022/Part_A/section06quotients/quotients.html</a> and here are the associated exercises <a href="https://github.com/ImperialCollegeLondon/formalising-mathematics-2022/tree/master/src/section06quotients">https://github.com/ImperialCollegeLondon/formalising-mathematics-2022/tree/master/src/section06quotients</a></p>



<a name="278529992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278529992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278529992">(Apr 11 2022 at 09:47)</a>:</h4>
<p>thanks!</p>



<a name="278530460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278530460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278530460">(Apr 11 2022 at 09:52)</a>:</h4>
<p>There's also a file on quotient groups in the <code>outtakes</code> directory which I never got into good shape because it uses the <code>quotient'</code> trick which i didn't explain</p>



<a name="278530785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278530785" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278530785">(Apr 11 2022 at 09:55)</a>:</h4>
<p>hmmm<br>
so my question in particular is, say I define the alias</p>
<p><code>def int := quotient int.setoid</code></p>
<p>(having already done the <code>setoid</code> setup above)</p>



<a name="278530882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278530882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278530882">(Apr 11 2022 at 09:56)</a>:</h4>
<p>I now define a bunch of theorems and instances and so on using <code>int</code>, in particular, say, <code>has_neg int</code> and <code>has_zero int</code></p>



<a name="278530947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278530947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278530947">(Apr 11 2022 at 09:57)</a>:</h4>
<p>If you write a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> it will be easier for everyone to answer your question.</p>



<a name="278530965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278530965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278530965">(Apr 11 2022 at 09:57)</a>:</h4>
<p>Lean doesn't seem to then pass this on to things of the form <code>⟦.⟧ </code>, complaining things like <code>failed to synthesize type class instance for failed to synthesize type class instance for
⊢ has_zero (quotient int.setoid)</code></p>



<a name="278530978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278530978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278530978">(Apr 11 2022 at 09:57)</a>:</h4>
<p>hmmm, this time I maybe can</p>



<a name="278531035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278531035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278531035">(Apr 11 2022 at 09:58)</a>:</h4>
<p>a decent chunk of my current problems are partially due to the length of this file -_-</p>



<a name="278532108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532108">(Apr 11 2022 at 10:08)</a>:</h4>
<p>here</p>



<a name="278532113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532113">(Apr 11 2022 at 10:08)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span> <span class="n">tactic.basic</span>

<span class="kn">namespace</span> <span class="n">peano</span>

<span class="kd">def</span> <span class="n">eqv</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a.1</span> <span class="bp">+</span> <span class="n">b.2</span> <span class="bp">=</span> <span class="n">b.1</span> <span class="bp">+</span> <span class="n">a.2</span>

<span class="kd">theorem</span> <span class="n">eqv.refl</span> <span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="n">eqv</span> <span class="n">a</span> <span class="n">a</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">tauto</span>
<span class="kd">theorem</span> <span class="n">eqv.symm</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">eqv</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">eqv</span> <span class="n">b</span> <span class="n">a</span> <span class="o">:=</span>
    <span class="kd">by</span> <span class="o">{</span><span class="n">repeat</span> <span class="o">{</span><span class="n">rw</span> <span class="n">eqv</span><span class="o">},</span> <span class="n">tauto</span><span class="o">}</span>
<span class="kd">theorem</span> <span class="n">eqv.trans</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="n">eqv</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">eqv</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">eqv</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
  <span class="k">assume</span> <span class="n">A</span> <span class="n">B</span><span class="o">,</span>
  <span class="kd">begin</span>
    <span class="n">rw</span> <span class="n">eqv</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="kd">end</span>

<span class="kd">theorem</span> <span class="n">eqv_is_eqv</span> <span class="o">:</span> <span class="n">equivalence</span> <span class="n">eqv</span> <span class="o">:=</span>
  <span class="n">mk_equivalence</span> <span class="n">eqv</span> <span class="n">eqv.refl</span> <span class="n">eqv.symm</span> <span class="n">eqv.trans</span>

<span class="kd">instance</span> <span class="n">int.setoid</span> <span class="o">:</span> <span class="n">setoid</span> <span class="o">(</span><span class="n">nat</span> <span class="bp">×</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:=</span>
      <span class="n">setoid.mk</span> <span class="n">eqv</span> <span class="n">eqv_is_eqv</span>

<span class="kd">def</span> <span class="n">int</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="n">int.setoid</span>

<span class="kd">def</span> <span class="n">int.mk</span> <span class="o">(</span><span class="n">p</span> <span class="n">m</span><span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">int</span> <span class="o">:=</span> <span class="bp">⟦</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span><span class="bp">⟧</span>

<span class="kn">namespace</span> <span class="n">int</span>
  <span class="kd">instance</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">int</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">⟦</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span><span class="bp">⟧</span><span class="o">⟩</span>
<span class="kd">end</span> <span class="n">int</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span><span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span>

<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">:</span> <span class="bp">⟦</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span><span class="bp">⟧</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">end</span> <span class="n">peano</span>
</code></pre></div>



<a name="278532338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532338">(Apr 11 2022 at 10:10)</a>:</h4>
<p>Lean complains at </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="kd">class</span> <span class="kd">instance</span> <span class="n">for</span>
<span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span>
<span class="bp">⊢</span> <span class="n">has_zero</span> <span class="o">(</span><span class="n">quotient</span> <span class="n">int.setoid</span><span class="o">)</span>
</code></pre></div>
<p>at <code>⟦(c, d)⟧ = 0</code></p>



<a name="278532582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532582">(Apr 11 2022 at 10:13)</a>:</h4>
<p>I think you can write <code>lemma foo : ⟦(c, d)⟧  = (0 : int) := sorry</code></p>



<a name="278532836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532836">(Apr 11 2022 at 10:15)</a>:</h4>
<p>hmmm<br>
so you can, thanks</p>



<a name="278532860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532860">(Apr 11 2022 at 10:15)</a>:</h4>
<p>that said, I'm still generally just drowning in <code>unfolds</code> trying to work with these things</p>



<a name="278532943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532943">(Apr 11 2022 at 10:16)</a>:</h4>
<p>I am not sure, but also</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[reducible]</span>
<span class="kd">def</span> <span class="n">int</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="n">int.setoid</span>
</code></pre></div>
<p>should work.</p>



<a name="278532947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278532947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278532947">(Apr 11 2022 at 10:16)</a>:</h4>
<p>I'm getting the impression that you're "supposed" to just use <code>quot.out</code> pretty early to get to the underlying representation, at least for low-level stuff, but I'm trying not to because I'm trying to follow a book on axiomatizations/reverse mathematics and I'd rather not invoke choice so early in the game lol</p>



<a name="278533008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533008">(Apr 11 2022 at 10:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278532943">said</a>:</p>
<blockquote>
<p>I am not sure, but also</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[reducible]</span>
<span class="kd">def</span> <span class="n">int</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="n">int.setoid</span>
</code></pre></div>
<p>should work.</p>
</blockquote>
<p>ahhh, that helps a lot</p>



<a name="278533014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533014">(Apr 11 2022 at 10:17)</a>:</h4>
<p>thanks muchly</p>



<a name="278533019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533019">(Apr 11 2022 at 10:17)</a>:</h4>
<p>The problem is that you provided an instance of <code>has_zero</code> to <code>int</code>, that it defined to be <code>quotient int.setoid</code>, but Lean doesn't unfold it.</p>



<a name="278533020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533020">(Apr 11 2022 at 10:17)</a>:</h4>
<p>that does work</p>



<a name="278533142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533142">(Apr 11 2022 at 10:18)</a>:</h4>
<p>hmm</p>



<a name="278533152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533152">(Apr 11 2022 at 10:18)</a>:</h4>
<p>so when should I be marking things <code>reducible</code>?</p>



<a name="278533464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533464">(Apr 11 2022 at 10:21)</a>:</h4>
<p>I would say that the correct thing to do is the opposite: provide a good API, and then mark the definition <code>irreducible</code>.</p>



<a name="278533931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278533931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278533931">(Apr 11 2022 at 10:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="359992">Robert Maxton</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278532860">said</a>:</p>
<blockquote>
<p>that said, I'm still generally just drowning in <code>unfolds</code> trying to work with these things</p>
</blockquote>
<p>Can you give an example?</p>



<a name="278534537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278534537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278534537">(Apr 11 2022 at 10:33)</a>:</h4>
<p>why the thumbsdown :(</p>



<a name="278534544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278534544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278534544">(Apr 11 2022 at 10:33)</a>:</h4>
<p>uh, lemme see</p>



<a name="278534731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278534731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278534731">(Apr 11 2022 at 10:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278533464">said</a>:</p>
<blockquote>
<p>I would say that the correct thing to do is the opposite: provide a good API, and then mark the definition <code>irreducible</code>.</p>
</blockquote>
<p>er<br>
but then I end up having to constantly switch between <code>quot.mk</code> and my actual type to do anything</p>



<a name="278535047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535047">(Apr 11 2022 at 10:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278533931">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="359992">Robert Maxton</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278532860">said</a>:</p>
<blockquote>
<p>that said, I'm still generally just drowning in <code>unfolds</code> trying to work with these things</p>
</blockquote>
<p>Can you give an example?</p>
</blockquote>
<p>for example</p>
<p>add as setup</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">private</span> <span class="kd">def</span> <span class="n">neg_int_pair</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">×</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟦</span><span class="o">(</span><span class="n">a.2</span><span class="o">,</span> <span class="n">a.1</span><span class="o">)</span><span class="bp">⟧</span>
<span class="kn">private</span> <span class="kd">lemma</span> <span class="n">neg_respects_eqv</span> <span class="o">(</span><span class="n">a₁</span> <span class="n">a₂</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">×</span> <span class="n">nat</span><span class="o">):</span>
  <span class="n">a₁</span> <span class="bp">≈</span> <span class="n">a₂</span> <span class="bp">→</span> <span class="n">neg_int_pair</span> <span class="n">a₁</span> <span class="bp">=</span> <span class="n">neg_int_pair</span> <span class="n">a₂</span> <span class="o">:=</span>
<span class="k">assume</span> <span class="n">h_eqv</span><span class="o">,</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">has_equiv.equiv</span> <span class="n">eqv</span> <span class="n">neg_int_pair</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">quot.sound</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">setoid.r</span> <span class="n">eqv</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">cc</span>
<span class="kd">end</span>

<span class="kn">namespace</span> <span class="n">int</span>
  <span class="kd">def</span> <span class="n">neg</span><span class="o">:</span> <span class="n">int</span> <span class="bp">→</span> <span class="n">int</span> <span class="o">:=</span>
    <span class="n">quotient.lift</span> <span class="n">neg_int_pair</span> <span class="n">neg_respects_eqv</span>

  <span class="kd">instance</span> <span class="o">:</span> <span class="n">has_neg</span> <span class="n">int</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">neg</span><span class="o">⟩</span>
<span class="kd">end</span> <span class="n">int</span>
</code></pre></div>



<a name="278535162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535162">(Apr 11 2022 at 10:40)</a>:</h4>
<p>you already can see the <code>unfold &lt;three or four things&gt;, apply quot.sound, unfold &lt;more things&gt;, dsimp</code> pattern I resort to a <em>lot</em> in order to get at the underlying representation</p>



<a name="278535193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535193">(Apr 11 2022 at 10:41)</a>:</h4>
<p>I realize that largely that defeats the purpose, which is why I'm trying to prove a few basic principles about <code>add</code> and <code>neg</code> and <code>sub</code> so I can stop doing that</p>



<a name="278535212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535212">(Apr 11 2022 at 10:41)</a>:</h4>
<p>anyway, I then have a helper lemma</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="kd">lemma</span> <span class="n">int.neg_mk</span> <span class="o">:</span> <span class="bp">-⟦</span><span class="o">(</span><span class="n">ap</span><span class="o">,</span> <span class="n">am</span><span class="o">)</span><span class="bp">⟧</span> <span class="bp">=</span> <span class="bp">⟦</span><span class="o">(</span><span class="n">am</span><span class="o">,</span> <span class="n">ap</span><span class="o">)</span><span class="bp">⟧</span> <span class="o">:=</span>
    <span class="kd">begin</span>
      <span class="n">unfold</span> <span class="n">quotient.mk</span> <span class="n">has_neg.neg</span> <span class="n">int.neg</span> <span class="n">quotient.lift</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">neg_int_pair</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">quotient.mk</span><span class="o">,</span>
    <span class="kd">end</span>
</code></pre></div>



<a name="278535277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535277">(Apr 11 2022 at 10:42)</a>:</h4>
<p>which is reasonably short, but is also pretty much literally nothing but <code>unfold</code>s <br>
and <code>unfold_projs</code> won't do it all for me</p>



<a name="278535504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535504">(Apr 11 2022 at 10:45)</a>:</h4>
<p>Doesn't <code>lemma int.neg_mk : -⟦(ap, am)⟧ = ⟦(am, ap)⟧ := rfl</code> work?</p>



<a name="278535731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278535731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278535731">(Apr 11 2022 at 10:48)</a>:</h4>
<p>hmmm<br>
well, a), apparently not<br>
but b) even if it did, it wouldn't help me in more complex cases where I actually need to do work after unfolding everything down to the underlying equivalence</p>



<a name="278537305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278537305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278537305">(Apr 11 2022 at 11:06)</a>:</h4>
<p>Thumbs down was for "supposed to invoke choice", that usually just results in you having to work harder to prove the same thing that <code>lift</code> already asked for in the first place.</p>



<a name="278537770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278537770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278537770">(Apr 11 2022 at 11:11)</a>:</h4>
<p>fair enough, guess I just misread it lol</p>



<a name="278537850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278537850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278537850">(Apr 11 2022 at 11:12)</a>:</h4>
<p>but in this case, for example, it's not like <code>a = -a ↔ a = 0</code> follows from the well-definedness of <code>neg</code> alone, I need to actually go digging into how <code>neg</code> works on the underlying representation, I think?</p>



<a name="278537980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278537980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278537980">(Apr 11 2022 at 11:13)</a>:</h4>
<p>Rather than unfolding everything, if you want to get at the underlying relation then state it as a lemma</p>



<a name="278537982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278537982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278537982">(Apr 11 2022 at 11:13)</a>:</h4>
<p>If you're unfolding the same thing over and over again, it means you're missing a lemma</p>



<a name="278537994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278537994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278537994">(Apr 11 2022 at 11:13)</a>:</h4>
<p>This is the lemma you're missing:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">equiv_iff</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">×</span> <span class="n">nat</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≈</span> <span class="n">b</span> <span class="bp">↔</span> <span class="n">a.1</span> <span class="bp">+</span> <span class="n">b.2</span> <span class="bp">=</span> <span class="n">b.1</span> <span class="bp">+</span> <span class="n">a.2</span> <span class="o">:=</span> <span class="n">iff.rfl</span>
</code></pre></div>



<a name="278538077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538077">(Apr 11 2022 at 11:14)</a>:</h4>
<p>(in addition to the <code>int.neg_mk</code> above, which is also a good lemma)</p>



<a name="278538078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538078">(Apr 11 2022 at 11:14)</a>:</h4>
<p>^ this, although I would write it for <code>[(a, b)] = [(c, d)]</code> instead</p>



<a name="278538205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538205">(Apr 11 2022 at 11:15)</a>:</h4>
<p>same thing for <code>-[(a, b)] = [(b, a)]</code> for unfolding the definition of <code>-</code></p>



<a name="278538274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538274">(Apr 11 2022 at 11:16)</a>:</h4>
<p>Probably you want both, since my version lets you get rid of any <code>equiv</code>s that pop up while using <code>quotient.lift</code> or <code>quotient.map</code></p>



<a name="278538290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538290">(Apr 11 2022 at 11:16)</a>:</h4>
<p>with just a few things like that as simp lemmas you can demolish most goals about associativity or whatever using <code>simp</code></p>



<a name="278538506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538506">(Apr 11 2022 at 11:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278535504">said</a>:</p>
<blockquote>
<p>Doesn't <code>lemma int.neg_mk : -⟦(ap, am)⟧ = ⟦(am, ap)⟧ := rfl</code> work?</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="359992">Robert Maxton</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278535731">said</a>:</p>
<blockquote>
<p>hmmm<br>
well, a), apparently not</p>
</blockquote>
<p>This works as long as <code>int</code> is reducible. If you choose not to make <code>int</code> reducible, then you can't use <code>⟦⟧</code> anywhere</p>



<a name="278538579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538579">(Apr 11 2022 at 11:19)</a>:</h4>
<p>hm<br>
works in my mwe but not in my original, even though it's marked reducible in both places</p>



<a name="278538628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538628">(Apr 11 2022 at 11:20)</a>:</h4>
<p>semireducible (aka default) should suffice</p>



<a name="278538661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538661">(Apr 11 2022 at 11:20)</a>:</h4>
<p>empirically it doesn't, though I'm starting to suspect the size of this file is getting in the way of things</p>



<a name="278538718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538718">(Apr 11 2022 at 11:21)</a>:</h4>
<p>also related to the above, but if I prove a bunch of things about things of the form <code>[(a, b)]</code>, they don't seem to play nice when I then pass in <code>ints</code> instead, I think<br>
though I will double check in a bit</p>



<a name="278538766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538766">(Apr 11 2022 at 11:21)</a>:</h4>
<p>those lemmas won't trigger if you put in ints, and this is deliberate</p>



<a name="278538832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278538832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278538832">(Apr 11 2022 at 11:22)</a>:</h4>
<p>so e.g. <code>[(a, b)] + c</code> won't reduce</p>



<a name="278539020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539020">(Apr 11 2022 at 11:24)</a>:</h4>
<p>Another thing you should do to avoid weird type inference is to explicitly redefine <code>quotient.mk</code> for your particular quotient and give it the right type. In this case it would be <code>def int.mk (a b : nat) : int := [(a, b)]</code></p>



<a name="278539047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539047">(Apr 11 2022 at 11:24)</a>:</h4>
<p>and then all of the theorems mentioned above should use <code>int.mk</code> instead of <code>[(a, b)]</code></p>



<a name="278539091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539091">(Apr 11 2022 at 11:25)</a>:</h4>
<p>.... so, uh, never actually use the convenient <code>[.]</code> syntax?<br>
that seems... disappointing &gt;.&gt;</p>



<a name="278539115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539115">(Apr 11 2022 at 11:25)</a>:</h4>
<p>and you have simp lemmas like <code>[(a, b)] = int.mk a b</code> to make sure that any occurrences of the quotient that accidentally pop up are removed</p>



<a name="278539131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539131">(Apr 11 2022 at 11:25)</a>:</h4>
<p>you can add a notation for <code>int.mk</code> if you want</p>



<a name="278539309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539309">(Apr 11 2022 at 11:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278538832">said</a>:</p>
<blockquote>
<p>so e.g. <code>[(a, b)] + c</code> won't reduce</p>
</blockquote>
<p>but I would like to rise above the level where I'm constantly referring back to the underlying representation someday, and that means I need to be able to write "axioms" (quote-unquote, since I'm proving them) that rely on that representation, but can be used by outside functions that only pass in black-boxed ints</p>



<a name="278539362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539362">(Apr 11 2022 at 11:27)</a>:</h4>
<p>the problem with the <code>[.]</code> syntax is that it has type <code>quotient &lt;stuff&gt;</code>, which means that if you write <code>[(0, 0)] = 0</code> then the <code>0</code> on the right will be looking for <code>has_zero (quotient &lt;stuff&gt;)</code> which is bad</p>



<a name="278539493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539493">(Apr 11 2022 at 11:29)</a>:</h4>
<p>the lemmas I've been talking about, like <code>-mk a b = mk b a</code>, are lemmas to help you prove theorems about the int functions you actually care about like <code>-(-a) = a</code></p>



<a name="278539571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278539571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278539571">(Apr 11 2022 at 11:29)</a>:</h4>
<p>the proof method for all of these is to use <code>quotient.induction</code> to replace <code>a</code> with <code>int.mk x y</code> and then <code>simp</code></p>



<a name="278540055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278540055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278540055">(Apr 11 2022 at 11:34)</a>:</h4>
<p>Note that I don't use <code>unfold</code> once in my exposition of how to make <code>int</code> from <code>nat x nat</code> <a href="https://github.com/ImperialCollegeLondon/formalising-mathematics-2022/blob/master/src/section06quotients/sheet4Z.lean">here</a>. I do however write a bunch of helper lemmas such as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">R</span> <span class="o">(</span><span class="n">ab</span> <span class="n">cd</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="n">ab.1</span> <span class="bp">+</span> <span class="n">cd.2</span> <span class="bp">=</span> <span class="n">ab.2</span> <span class="bp">+</span> <span class="n">cd.1</span>

<span class="kd">lemma</span> <span class="n">R_def</span> <span class="o">(</span><span class="n">ab</span> <span class="n">cd</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
<span class="n">R</span> <span class="n">ab</span> <span class="n">cd</span> <span class="bp">↔</span> <span class="n">ab.1</span> <span class="bp">+</span> <span class="n">cd.2</span> <span class="bp">=</span> <span class="n">ab.2</span> <span class="bp">+</span> <span class="n">cd.1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">R_def'</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
<span class="n">R</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">d</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">c</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="bp">...</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_zero</span> <span class="n">myint</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">zero</span> <span class="o">:=</span> <span class="bp">⟦</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span><span class="bp">⟧</span> <span class="o">}</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">zero_def</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">myint</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">⟦</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span><span class="bp">⟧</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="bp">...</span>
</code></pre></div>



<a name="278540148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278540148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278540148">(Apr 11 2022 at 11:35)</a>:</h4>
<p>(I should think all the proofs are refl)</p>



<a name="278542280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278542280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278542280">(Apr 11 2022 at 11:57)</a>:</h4>
<p>I do not seem to be getting anywhere near as much use out of <code>refl</code> as any of you do :v</p>



<a name="278542327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278542327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278542327">(Apr 11 2022 at 11:57)</a>:</h4>
<p>admittedly, this is probably in large part because I also rewrote <code>nat</code> and therefore do not have quite so optimized a set of <code>simp</code> lemmas</p>



<a name="278542453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278542453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278542453">(Apr 11 2022 at 11:58)</a>:</h4>
<p>I was originally planning on just implementing the entire book from scratch but at this rate I may end up just switching to existing libraries after I "re-implement" them</p>



<a name="278542980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278542980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278542980">(Apr 11 2022 at 12:03)</a>:</h4>
<p>You reimplemented <code>nat</code>? <span aria-label="fear" class="emoji emoji-1f628" role="img" title="fear">:fear:</span> That should definitely have been part of your <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>!</p>



<a name="278543129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278543129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278543129">(Apr 11 2022 at 12:05)</a>:</h4>
<p>Note that you would have the same issues with type classes if you defined something like <code>def complex := real \x real</code></p>



<a name="278543972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278543972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278543972">(Apr 11 2022 at 12:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278542980">said</a>:</p>
<blockquote>
<p>You reimplemented <code>nat</code>? <span aria-label="fear" class="emoji emoji-1f628" role="img" title="fear">:fear:</span> That should definitely have been part of your <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>!</p>
</blockquote>
<p>... I mean, at that point, it stops being a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> and starts being "here is the entirety of my code", though?</p>



<a name="278544053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278544053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278544053">(Apr 11 2022 at 12:14)</a>:</h4>
<p>that's kind of the issue I've been having, really, is that since I reimplemented everything from scratch it's hard to isolate things into an <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>, so I just end up asking very vague general-practice questions instead</p>



<a name="278544127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278544127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278544127">(Apr 11 2022 at 12:15)</a>:</h4>
<p>like if you don't mind looking through my ~1k lines of code then yay, but I don't really expect that of random people on the internet :p</p>



<a name="278544333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278544333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278544333">(Apr 11 2022 at 12:17)</a>:</h4>
<p>Anyways, <code>refl</code> doesn't depend on what simp lemmas you wrote or didn't write.</p>



<a name="278545655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278545655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Robert Maxton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278545655">(Apr 11 2022 at 12:28)</a>:</h4>
<p>Huh. Good to know</p>



<a name="278733671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Guide%20to%20using%20setoid/near/278733671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jake Levinson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Guide.20to.20using.20setoid.html#278733671">(Apr 12 2022 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="359992">Robert Maxton</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278543972">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113489-new-members/topic/Guide.20to.20using.20setoid/near/278542980">said</a>:</p>
<blockquote>
<p>You reimplemented <code>nat</code>? <span aria-label="fear" class="emoji emoji-1f628" role="img" title="fear">:fear:</span> That should definitely have been part of your <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>!</p>
</blockquote>
<p>... I mean, at that point, it stops being a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> and starts being "here is the entirety of my code", though?</p>
</blockquote>
<p>I suspect that reimplementing basic stuff can lead to weird situations like this, where each definition in mathlib already has a bunch of layers of lemmas to smooth out (e.g.) intermediate facts between an underlying representation and the intended usage.</p>
<p>You might be reimplementing the basics in order to learn about writing math in Lean -- I did some of that myself last year. But at the same time you're (unwittingly) forcing yourself to deal with a bunch of core type theory design choices, which might turn out to be subtler than you expect. For example, Mario's advice about defining <code>int.mk</code> and writing all subsequent theorems with <code>int.mk</code> instead of simply <code>quotient.mk</code>.</p>
<p>At least when I tried this, I eventually decided to approach reimplementing the basics with the mindset of "I'll push this as far as it goes but won't be surprised if I get stuck at some (early) point". I still found it to be a helpful exercise though!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>