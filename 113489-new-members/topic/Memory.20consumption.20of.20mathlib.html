---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html">Memory consumption of mathlib</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="214228505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214228505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Meyer Zinn <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214228505">(Oct 22 2020 at 18:28)</a>:</h4>
<p>Hey y'all, new Lean user here :) I'm trying to do some simple proofs using mathlib and am encountering a memory error:</p>
<blockquote>
<p>excessive memory consumption detected at 'expression traversal' (potential solution: increase memory consumption threshold)</p>
</blockquote>
<p>I've already allowed Lean to use up to 12GB of memory. How much more should I allocate to compile it the first time?  Is there a memory leak in mathlib?</p>



<a name="214228711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214228711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214228711">(Oct 22 2020 at 18:29)</a>:</h4>
<p>If you set up your local copy of mathlib using leanproject, it should have downloaded the oleans files and you shouldn't have to recompile mathlib itself. How did you download mathlib, and how did you open it in your editor?</p>



<a name="214230803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214230803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Meyer Zinn <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214230803">(Oct 22 2020 at 18:45)</a>:</h4>
<p>I just changed the reference in the tutorials project, and re-ran the build. However, I may have found the issue--I thought I'd increased the memory limit by adding a command-line flag to the VSCode settings and did not even see the specific setting for memory limits. It seems to build fine now that I've actually increased the limit.</p>



<a name="214231236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214231236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214231236">(Oct 22 2020 at 18:48)</a>:</h4>
<p>how long does the build take?</p>



<a name="214231249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214231249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214231249">(Oct 22 2020 at 18:48)</a>:</h4>
<p>are you building mathlib or the tutorials project?</p>



<a name="214231593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214231593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214231593">(Oct 22 2020 at 18:51)</a>:</h4>
<p>Did you mean you changed the reference to the version of mathlib in the toml file? Did you run <code>leanproject get-mathlib-cache</code> and then restart the Lean interpreter in VSCode?</p>



<a name="214235266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214235266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214235266">(Oct 22 2020 at 19:17)</a>:</h4>
<p>The "orange bars" that show up next to lines in VS Code indicate that Lean is processing them; in almost all cases they should disappear within 10 seconds or so when you open a new file; if they stick around any longer, (especially near the "import" lines) that's a strong indication that the Lean server is recompiling mathlib, which is almost always not what you want. For one, when the Lean server launched by your editor compiles mathlib, it doesn't write <code>olean</code> files to disk, which means that next time you open the project the same thing might happen.</p>
<p>If you do run into this, the solution is to go to the command line and run either <code>leanproject get-mathlib-cache</code> to get the precompiled olean files from our Azure server, or <code>leanproject build</code> and wait an hour or so for mathlib to build locally.</p>



<a name="214235589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214235589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Meyer Zinn <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214235589">(Oct 22 2020 at 19:20)</a>:</h4>
<p>It took less than five minutes to build from scratch (on a fairly beefy computer). I'll run the get-mathlib-cache command and see what it does.</p>



<a name="214235791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214235791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214235791">(Oct 22 2020 at 19:21)</a>:</h4>
<p>Yeah, an hour is the worst case (single-threaded, no previous olean files).</p>



<a name="214236028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214236028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214236028">(Oct 22 2020 at 19:23)</a>:</h4>
<p>Ah, what did you mean when you say you "changed the reference" above? I'm guessing you either edited <code>leanpkg.toml</code> or ran <code>leanproject up</code>?</p>



<a name="214237351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214237351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Meyer Zinn <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214237351">(Oct 22 2020 at 19:33)</a>:</h4>
<p>I edited the TOML.</p>



<a name="214237608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214237608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214237608">(Oct 22 2020 at 19:35)</a>:</h4>
<p>The TOML edit means that you're likely having older oleans but newer lean files. Which triggers the recompilation. try <code>leanproject get-mathlib-cache</code>, which will sync the oleans to the commit you've indicated in the toml.</p>



<a name="214237728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214237728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214237728">(Oct 22 2020 at 19:36)</a>:</h4>
<p>Then a restart of the lean interpreter (via VSCode) will update the interpreter cache to use those oleans. so the oleans will now correspond to the lean files, and won't have to recompile any of them.</p>



<a name="214237961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214237961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214237961">(Oct 22 2020 at 19:38)</a>:</h4>
<p>A more interesting question to us is: why did you feel the need for all those manipulations? Why not following the instructions (which never ever mention modifying the toml file)?</p>



<a name="214254982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214254982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214254982">(Oct 22 2020 at 22:19)</a>:</h4>
<p>I can't answer for the original person, and I'm guilty of the same sin of editing the TOML file -- but TOML is an odd choice for a non-human-editable file. It'd perhaps be a bit clearer if it were specifically a non-human-editable file-format as maybe one additional signal it's not meant to be edited. =</p>



<a name="214255400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255400">(Oct 22 2020 at 22:25)</a>:</h4>
<p>it's quite human editable</p>



<a name="214255427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255427">(Oct 22 2020 at 22:25)</a>:</h4>
<p>Well I agree but I've seen Patrick say a few times "no one should edit it directly" :)</p>



<a name="214255446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255446">(Oct 22 2020 at 22:25)</a>:</h4>
<p>but <code>leanproject</code> also makes it easy to manage without direct editing</p>



<a name="214255589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255589">(Oct 22 2020 at 22:26)</a>:</h4>
<p>I think patrick associates editing the TOML file with people who take installation "into their own hands" and end up with strange configuration messes</p>



<a name="214255627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255627">(Oct 22 2020 at 22:27)</a>:</h4>
<p>which is understandably frustrating since <code>leanproject</code> was written specifically to solve that problem</p>



<a name="214255631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255631">(Oct 22 2020 at 22:27)</a>:</h4>
<p>Ah, that's probably fair.</p>



<a name="214255634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255634">(Oct 22 2020 at 22:27)</a>:</h4>
<p>YEah.</p>



<a name="214255717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255717">(Oct 22 2020 at 22:28)</a>:</h4>
<p>I mean I'd still say if you're coming from somewhere else and you see a TOML file you'll assume you should edit it, so personally I wouldn't find it too surprising if someone did so. But I guess I see the conundrum.</p>



<a name="214255800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255800">(Oct 22 2020 at 22:29)</a>:</h4>
<p>I liken it to the git configuration file</p>



<a name="214255829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255829">(Oct 22 2020 at 22:29)</a>:</h4>
<p>you can write your settings in the file directly, or if you prefer use <code>git config</code> and it writes to the file for you</p>



<a name="214255916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255916">(Oct 22 2020 at 22:30)</a>:</h4>
<p>Yeah :) I think it'd be an interesting usability study to know who does what more -- I essentially never use <code>git config</code> personally, but maybe it's a good analogy indeed since some sites will tell new users which <code>git config</code> command lines to paste.</p>



<a name="214255970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214255970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214255970">(Oct 22 2020 at 22:31)</a>:</h4>
<p>You also have to keep in mind that there is some history here; <code>leanpkg</code> was written to solve these problems and <code>leanpkg.toml</code> is its frontend, but now <code>leanproject</code> is a wrapper around that and it produces a <code>leanpkg.toml</code> file for consumption by <code>lean</code> and <code>leanpkg</code></p>



<a name="214256105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214256105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214256105">(Oct 22 2020 at 22:33)</a>:</h4>
<p><em>nod</em></p>



<a name="214256254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214256254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214256254">(Oct 22 2020 at 22:35)</a>:</h4>
<p>I don't really understand all the reasoning behind why <code>leanproject</code> needs to be a separate program from <code>leanpkg</code>, and it's obviously confusing for newcomers. I think it was just that <code>leanpkg</code> is written in <code>lean</code> and patrick wanted to write python?</p>



<a name="214256318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214256318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214256318">(Oct 22 2020 at 22:36)</a>:</h4>
<p>it also has a bunch of mathlib-specific features while <code>leanpkg</code> is in core and is mostly lean-only</p>



<a name="214256824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214256824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214256824">(Oct 22 2020 at 22:43)</a>:</h4>
<p>Possibly if it wants to front leanpkg entirely for someone who doesn't want to use it it could plop leanpkg.toml into and out of existence only when it's communicating with leanpkg (if it doesn't have some other way to communicate). But maybe that was also considered</p>



<a name="214257630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214257630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214257630">(Oct 22 2020 at 22:56)</a>:</h4>
<p>personally I expected that the toml file was editable and ran into the same problem at first - the reason people use markup files like yaml for config is usually so that you can edit them, and in most programming ecosystems like npm in javascript or requirements.txt in python, you are supposed to edit those files and it will not cause a massive recompilation</p>



<a name="214257653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214257653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214257653">(Oct 22 2020 at 22:56)</a>:</h4>
<p>it seems like people run into the problem of "it is forever recompiling" often enough that maybe some level of the tooling can alert you about it automatically?</p>



<a name="214257734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214257734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214257734">(Oct 22 2020 at 22:58)</a>:</h4>
<p>one trick is, if it isn't supposed to be edited, you can keep it gzipped it on disk, so that it's impossible for people to edit it ;-)</p>



<a name="214257796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214257796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214257796">(Oct 22 2020 at 22:59)</a>:</h4>
<p>or rename with a leading <code>.</code></p>



<a name="214257870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214257870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214257870">(Oct 22 2020 at 23:00)</a>:</h4>
<p>well, you typically do edit those, like your <code>.emacs</code></p>



<a name="214257882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214257882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214257882">(Oct 22 2020 at 23:00)</a>:</h4>
<p>Yeah it's kind of trying to be a lockfile it sounds like, except because of the hysterical raisins it's TOML and has to be named as is since that's what leanpkg is looking for</p>



<a name="214258009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214258009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214258009">(Oct 22 2020 at 23:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321696">Julian Berman</span> <a href="#narrow/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib/near/214257882">said</a>:</p>
<blockquote>
<p>hysterical raisins</p>
</blockquote>
<p>Can I have some? <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="214258693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214258693" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214258693">(Oct 22 2020 at 23:14)</a>:</h4>
<p>If <code>leanproject</code> doesn't expect the <code>leanpkg.toml</code> file to be edited by a human then it could add a comment to the file to this effect</p>



<a name="214258895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214258895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214258895">(Oct 22 2020 at 23:17)</a>:</h4>
<p>I think it's totally fine to edit <code>leanpkg.toml</code> yourself if you know what you're doing. I don't think <code>leanproject</code> has any trouble with manually edited <code>leanpkg.toml</code> files. It's just that people might not know to manually run <code>leanproject get-mathlib-cache</code> afterwards and then they end up compiling mathlib in their editor.</p>



<a name="214258914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214258914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214258914">(Oct 22 2020 at 23:17)</a>:</h4>
<p>what if leanproject just got the cache for me</p>



<a name="214258967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214258967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214258967">(Oct 22 2020 at 23:18)</a>:</h4>
<p>One wrinkle is that <code>leanpkg</code> (which <code>leanproject</code> runs) removes comments from <code>leanpkg.toml</code>.</p>



<a name="214258987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214258987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214258987">(Oct 22 2020 at 23:18)</a>:</h4>
<p>How would leanproject know to get the cache if all you did was edit <code>leanpkg.toml</code> and open VS Code or emacs?</p>



<a name="214259000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214259000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214259000">(Oct 22 2020 at 23:18)</a>:</h4>
<p>Are you suggesting that the editor should always run <code>leanproject</code>?</p>



<a name="214259032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214259032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214259032">(Oct 22 2020 at 23:19)</a>:</h4>
<p>well... sure?</p>



<a name="214259049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214259049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214259049">(Oct 22 2020 at 23:19)</a>:</h4>
<p>could just run <code>leanproject --get-the-cache-if-I-should-obviously-get-the-new-cache</code></p>



<a name="214259275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214259275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214259275">(Oct 22 2020 at 23:23)</a>:</h4>
<p>It's a good idea; I recorded it as a vscode-lean issue <a href="https://github.com/leanprover/vscode-lean/issues/228">here</a>.</p>



<a name="214259406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214259406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214259406">(Oct 22 2020 at 23:25)</a>:</h4>
<p>or, if we consider the goal to be to minimize the number of identical complaints in zulip that compiling is taking forever, with a minimal amount of work, we could just change the "compiling is taking forever" error message to say "try running leanproject get-cache"</p>



<a name="214293258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214293258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Miroslav Olšák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214293258">(Oct 23 2020 at 09:52)</a>:</h4>
<p>So the comment in <code>leanpkg.toml</code> (added by <code>leanproject</code>) should be something like:</p>
<blockquote>
<p>This file is meant to be managed by the "leanproject" script. Do not edit this file unless you know what you are doing.</p>
</blockquote>
<p>Editing <code>leanpkg.toml</code> is simply the first idea one gets when he looks into the directory of a lean project, and he does not remember all the various commands for lean package management.</p>



<a name="214299219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214299219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214299219">(Oct 23 2020 at 11:03)</a>:</h4>
<p>In some languages, a newly generated manifest/config file will start with a comment along the lines of <code>users aren't really supposed to edit this directly, learn more [here]</code>. Maybe something like that is appropriate for a newly generated leanpkg.toml.</p>



<a name="214299453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214299453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214299453">(Oct 23 2020 at 11:06)</a>:</h4>
<p>IE the default cargo.lock produced by Rust's package manner starts with:</p>
<div class="codehilite" data-code-language="markdown"><pre><span></span><code><span class="gh"># This file is automatically @generated by Cargo.</span>
<span class="gh"># It is not intended for manual editing.</span>
</code></pre></div>



<a name="214300662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214300662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214300662">(Oct 23 2020 at 11:23)</a>:</h4>
<p>Let us repeat once more: there is no issue at all editing this file by hand <em>if you know what you are doing</em>. The message is: if you are a beginner and edit this file, don't be surprised when things don't work.</p>



<a name="214303158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214303158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214303158">(Oct 23 2020 at 11:46)</a>:</h4>
<p>The message coming back to us is that it's all well and good you saying this here, but this is not at all clear before the chaos starts because there is no such warning in the toml.</p>



<a name="214306434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214306434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris B <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214306434">(Oct 23 2020 at 12:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib/near/214300662">said</a>:</p>
<blockquote>
<p>Let us repeat once more: there is no issue at all editing this file by hand <em>if you know what you are doing</em>. The message is: if you are a beginner and edit this file, don't be surprised when things don't work.</p>
</blockquote>
<p>I understand, but your original question was "why did you feel the need for all those manipulations? Why not following the instructions (which never ever mention modifying the toml file)?".  The point is that some languages use comments to directly address users within their configuration files, the contents are obviously variable. </p>
<p>This applies to your question in that "the directions don't mention editing the toml file" is not the same thing as "the toml files tells you not to edit the toml file (unless you know what you're doing)".  You can put whatever version  of<code>If you're new to Lean, please read [link] before editing the contents of this file.</code> in there.</p>



<a name="214308524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214308524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214308524">(Oct 23 2020 at 12:47)</a>:</h4>
<p>Was just about to throw together the trivial PR (which I'm sure we can bikeshed on), but I think said trivial PR may not be completely trivial since I think the leanpkg TOML parser  needs a fix</p>



<a name="214308582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214308582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214308582">(Oct 23 2020 at 12:48)</a>:</h4>
<p>Will send the mathlibtools one anyway but I guess it can't be merged until that's investigated (and I haven't had coffee yet)</p>



<a name="214309311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214309311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214309311">(Oct 23 2020 at 12:55)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib-tools/pull/85">https://github.com/leanprover-community/mathlib-tools/pull/85</a> for anyone's bikeshedding pleasure.</p>



<a name="214325251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214325251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214325251">(Oct 23 2020 at 15:07)</a>:</h4>
<p>Great, I'll have a look during the week-end. I also have some suggestion by Floris in the leanproject backlog.</p>



<a name="214327903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214327903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214327903">(Oct 23 2020 at 15:29)</a>:</h4>
<p>Cool and thanks for being open to it :) I'm sure as usual this is a thing that you've thought about like 20 times already so it's probably not fun to revisit.</p>



<a name="214330054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214330054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214330054">(Oct 23 2020 at 15:47)</a>:</h4>
<p>In fact people continually come here saying "I did random stuff not in the instructions and now it's broken" and of course this is frustrating to read, but it seems difficult to stop this happening. I think part of the problem is that if you're going to engage with lean at all then you're probably the kind of person who might fiddle with config files.</p>



<a name="214330483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214330483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214330483">(Oct 23 2020 at 15:50)</a>:</h4>
<p>I would like to point out that I did try to follow the instructions (not in their entirety), but I could not find a description of how <code>leanproject</code> works and what are the commands that it executes.</p>
<p>Somewhat related to memory timeouts, one command that I just learned today from <span class="user-mention" data-user-id="112680">@Johan Commelin</span>  is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">lean</span> <span class="c1">--make src/data/finset/lattice.lean</span>
</code></pre></div>

<p>which, as far as I can tell, allows you to build locally only the file specified in the path.  I would have liked to know about this command earlier!</p>



<a name="214330666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214330666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214330666">(Oct 23 2020 at 15:52)</a>:</h4>
<p>I guess we need two kinds of docs... for people that want to casually experiment with mathlib, and for people who want to make (more than one) PRs</p>



<a name="214330927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214330927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214330927">(Oct 23 2020 at 15:54)</a>:</h4>
<p>I mean this is obviously a common thing for better or worse, there's people who just won't read docs, whether because they're too excited to use lean or otherwise, so to me it's basically "make things as error-proof as can be reasonably", and then yeah the docs may fill in the rest.</p>



<a name="214330987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214330987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214330987">(Oct 23 2020 at 15:55)</a>:</h4>
<p>For 10 years (quite literally) I think we've (in Python land) been answering the same questions (about someone setting up Python wrong on ubuntu, or touching their system python, or etc. etc.)</p>



<a name="214331016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214331016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214331016">(Oct 23 2020 at 15:55)</a>:</h4>
<p>All things which are documented, folks just have limited initial reading buffers :)</p>



<a name="214346133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214346133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214346133">(Oct 23 2020 at 18:02)</a>:</h4>
<p>I think the main issue is that the mathlib build system is unusual compared to other build systems. so people come in expecting it to work like python or node.js and it doesn't. in particular, the situation where you cannot compile the library on your own machine, but the packaging system does not distribute prebuilt object files at import time, instead you manually grab the cached olean files and that lookup is based on git hashes which normally would not be worked into a package management system.</p>



<a name="214346383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214346383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214346383">(Oct 23 2020 at 18:04)</a>:</h4>
<p>it doesn't really make much sense to try to improve the build system now, though, if lean 4 is going to use a totally incompatible one, and it is at least probable that mathlib ends up migrating to lean 4</p>



<a name="214348496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Memory%20consumption%20of%20mathlib/near/214348496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Memory.20consumption.20of.20mathlib.html#214348496">(Oct 23 2020 at 18:21)</a>:</h4>
<p>You can compile the library on your own machine though. We just recommend that people avoid it if they can.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>