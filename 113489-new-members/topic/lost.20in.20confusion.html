---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/lost.20in.20confusion.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html">lost in confusion</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="306723143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306723143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306723143">(Oct 28 2022 at 18:28)</a>:</h4>
<p>After some upgrade of mathlib, some of my code broke with an error message of the form:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">term</span>
  <span class="n">hf</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">function.bijective</span> <span class="bp">⇑</span><span class="n">f</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">function.bijective</span> <span class="bp">⇑?</span><span class="n">m_5</span>
</code></pre></div>
<p>If I try to fill some implicit arguments, I get a different error, </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">term</span>
  <span class="n">f</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">↥</span><span class="n">s</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="bp">↥</span><span class="n">s</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">?</span><span class="n">m_1</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="bp">?</span><span class="n">m_2</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="bp">?</span> <span class="bp">?</span><span class="o">)</span>
</code></pre></div>
<p>Can anybody help me guess what happens…</p>



<a name="306723503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306723503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306723503">(Oct 28 2022 at 18:30)</a>:</h4>
<p>Possibly a universe issue?</p>



<a name="306723559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306723559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306723559">(Oct 28 2022 at 18:30)</a>:</h4>
<p>do you have a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> you can share?</p>



<a name="306724373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306724373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306724373">(Oct 28 2022 at 18:34)</a>:</h4>
<p>It's hard to give a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>, because this happens after many many files of sthing which is not yet in mathlib.</p>



<a name="306725067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306725067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306725067">(Oct 28 2022 at 18:38)</a>:</h4>
<p>I guess I don't even know what <code>→ₑ[φ]</code> is notation for...</p>



<a name="306725191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306725191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306725191">(Oct 28 2022 at 18:39)</a>:</h4>
<p>I just tried to build a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> by introducing the notation and some sorry, but even there I have a problem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">def</span> <span class="n">is_preprimitive</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">structure</span> <span class="n">equivariant_map</span> <span class="o">{</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">)</span>
  <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>
<span class="o">(</span><span class="n">map_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">m</span> <span class="bp">•</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">φ</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="bp">•</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">a</span><span class="o">))</span>

<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">φ</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="n">φ</span> <span class="n">α</span> <span class="n">β</span>
<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">M</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="o">(</span><span class="bp">@</span><span class="n">id</span> <span class="n">M</span><span class="o">)</span> <span class="n">α</span> <span class="n">β</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">N</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">is_preprimitive_of_bijective_map_iff</span>
  <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">function.surjective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">function.bijective</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">is_preprimitive</span> <span class="n">M</span> <span class="n">α</span> <span class="bp">↔</span> <span class="n">is_preprimitive</span> <span class="n">N</span> <span class="n">β</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="306725357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306725357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306725357">(Oct 28 2022 at 18:40)</a>:</h4>
<p>On the <code>hf : function.bijective f</code>, Lean complains:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">function.bijective</span> <span class="n">f</span>
<span class="n">term</span>
  <span class="n">f</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u_3</span> <span class="n">u_4</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">?</span><span class="n">m_1</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m_2</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">imax</span> <span class="bp">?</span> <span class="bp">?</span><span class="o">)</span>
</code></pre></div>



<a name="306725558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306725558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306725558">(Oct 28 2022 at 18:41)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">def</span> <span class="n">is_preprimitive</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">structure</span> <span class="n">equivariant_map</span> <span class="o">{</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">)</span>
  <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>
<span class="o">(</span><span class="n">map_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">m</span> <span class="bp">•</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">φ</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="bp">•</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">a</span><span class="o">))</span>

<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">φ</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="n">φ</span> <span class="n">α</span> <span class="n">β</span>
<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">M</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="o">(</span><span class="bp">@</span><span class="n">id</span> <span class="n">M</span><span class="o">)</span> <span class="n">α</span> <span class="n">β</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">N</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span>

<span class="kd">instance</span> <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">equivariant_map.to_fun</span><span class="o">⟩</span>

<span class="kd">lemma</span> <span class="n">is_preprimitive_of_bijective_map_iff</span>
  <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">function.surjective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">function.bijective</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">is_preprimitive</span> <span class="n">M</span> <span class="n">α</span> <span class="bp">↔</span> <span class="n">is_preprimitive</span> <span class="n">N</span> <span class="n">β</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="306725644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306725644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306725644">(Oct 28 2022 at 18:41)</a>:</h4>
<p>you need to tell lean how it should think of terms of <code>α →ₑ[φ] β</code> as functions</p>



<a name="306725688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306725688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306725688">(Oct 28 2022 at 18:42)</a>:</h4>
<p>presumably using <a href="https://leanprover-community.github.io/mathlib_docs/find/fun_like">docs#fun_like</a> is the right approach in this case.</p>



<a name="306726069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306726069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306726069">(Oct 28 2022 at 18:44)</a>:</h4>
<p>So:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">def</span> <span class="n">is_preprimitive</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">structure</span> <span class="n">equivariant_map</span> <span class="o">{</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">)</span>
  <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>
<span class="o">(</span><span class="n">map_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">m</span> <span class="bp">•</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">φ</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="bp">•</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">a</span><span class="o">))</span>

<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">φ</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="n">φ</span> <span class="n">α</span> <span class="n">β</span>
<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">M</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="o">(</span><span class="bp">@</span><span class="n">id</span> <span class="n">M</span><span class="o">)</span> <span class="n">α</span> <span class="n">β</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">N</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span>

<span class="kd">instance</span> <span class="n">foo</span> <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">}</span> <span class="o">:</span> <span class="n">fun_like</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">)</span> <span class="n">α</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">coe</span> <span class="o">:=</span> <span class="n">equivariant_map.to_fun</span><span class="o">,</span>
  <span class="n">coe_injective'</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">f</span><span class="o">,</span> <span class="n">cases</span> <span class="n">g</span><span class="o">,</span> <span class="n">simpa</span> <span class="o">}</span> <span class="o">}</span>

<span class="kd">lemma</span> <span class="n">is_preprimitive_of_bijective_map_iff</span>
  <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">function.surjective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">function.bijective</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">is_preprimitive</span> <span class="n">M</span> <span class="n">α</span> <span class="bp">↔</span> <span class="n">is_preprimitive</span> <span class="n">N</span> <span class="n">β</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="306726224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306726224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306726224">(Oct 28 2022 at 18:45)</a>:</h4>
<p>Does that solve the original issue?</p>



<a name="306728360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306728360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306728360">(Oct 28 2022 at 18:56)</a>:</h4>
<p>I'm polishing my mwe, I hadn't copied enough…</p>



<a name="306728599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306728599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306728599">(Oct 28 2022 at 18:58)</a>:</h4>
<p>This seems to replicate my issue (and bring no other…)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>


<span class="kn">import</span> <span class="n">algebra.group.defs</span>
<span class="kn">import</span> <span class="n">data.set.pointwise</span>
<span class="kn">import</span> <span class="n">group_theory.group_action.defs</span>
<span class="kn">import</span> <span class="n">group_theory.specific_groups.alternating</span>


<span class="kd">def</span> <span class="n">is_preprimitive</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">N</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span>

<span class="n">open_locale</span> <span class="n">pointwise</span> <span class="n">classical</span>

<span class="sd">/-- The instance that makes the stabilizer of a set acting on that set -/</span>
<span class="kd">instance</span> <span class="n">mul_action.of_stabilizer</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">mul_action</span> <span class="o">(</span><span class="n">mul_action.stabilizer</span> <span class="n">M</span> <span class="n">s</span><span class="o">)</span> <span class="n">s</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">structure</span> <span class="n">equivariant_map</span> <span class="o">{</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">)</span>
  <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>
<span class="o">(</span><span class="n">map_smul'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">m</span> <span class="bp">•</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">φ</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="bp">•</span> <span class="n">to_fun</span> <span class="o">(</span><span class="n">a</span><span class="o">))</span>

<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">φ</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="n">φ</span> <span class="n">α</span> <span class="n">β</span>
<span class="kd">notation</span> <span class="n">α</span> <span class="bp">`</span> <span class="bp">→</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="n">M</span><span class="o">:</span><span class="mi">25</span> <span class="bp">`</span><span class="o">]</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">β</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">equivariant_map</span> <span class="o">(</span><span class="bp">@</span><span class="n">id</span> <span class="n">M</span><span class="o">)</span> <span class="n">α</span> <span class="n">β</span>

<span class="kd">class</span> <span class="n">equivariant_map_class</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">out_param</span> <span class="bp">$</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
  <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">)</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span>
  <span class="kd">extends</span> <span class="n">fun_like</span> <span class="n">F</span> <span class="n">α</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map_smul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">f</span> <span class="o">(</span><span class="n">m</span> <span class="bp">•</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">φ</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="bp">•</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">))</span>


<span class="kd">instance</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">group</span> <span class="n">N</span><span class="o">]</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">mul_action</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">φ</span><span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">):</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">equivariant_map.to_fun</span><span class="o">⟩</span>


<span class="kd">lemma</span> <span class="n">is_preprimitive_of_bijective_map_iff</span>
  <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">→</span> <span class="n">N</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">β</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">function.surjective</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">function.bijective</span> <span class="n">f</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">is_preprimitive</span> <span class="n">M</span> <span class="n">α</span> <span class="bp">↔</span> <span class="n">is_preprimitive</span> <span class="n">N</span> <span class="n">β</span> <span class="o">:=</span> <span class="gr">sorry</span>


<span class="kd">variables</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span>

<span class="kd">lemma</span> <span class="n">stabilizer.is_preprimitive</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">hs</span> <span class="o">:</span> <span class="o">(</span><span class="n">s</span><span class="bp">ᶜ</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">nontrivial</span><span class="o">):</span>
  <span class="n">is_preprimitive</span> <span class="o">(</span><span class="n">mul_action.stabilizer</span> <span class="o">(</span><span class="n">alternating_group</span> <span class="n">α</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="n">s</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">φ</span> <span class="o">:</span> <span class="n">mul_action.stabilizer</span> <span class="o">(</span><span class="n">alternating_group</span> <span class="n">α</span><span class="o">)</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">equiv.perm</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">mul_action.to_perm</span><span class="o">,</span>
  <span class="k">suffices</span> <span class="n">hφ</span> <span class="o">:</span> <span class="n">function.surjective</span> <span class="n">φ</span><span class="o">,</span>

  <span class="k">let</span> <span class="n">f</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">→ₑ</span><span class="o">[</span><span class="n">φ</span><span class="o">]</span> <span class="n">s</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">to_fun</span> <span class="o">:=</span> <span class="n">id</span><span class="o">,</span>
  <span class="n">map_smul'</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">hf</span> <span class="o">:</span> <span class="n">function.bijective</span> <span class="n">f</span> <span class="o">:=</span> <span class="n">function.bijective_id</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">is_preprimitive_of_bijective_map_iff</span> <span class="n">hφ</span> <span class="n">hf</span><span class="o">,</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="306728722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306728722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306728722">(Oct 28 2022 at 18:58)</a>:</h4>
<p>The problem appears at the very end,  Lean doesn't want to use <code>hf</code>…</p>



<a name="306729167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306729167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306729167">(Oct 28 2022 at 19:01)</a>:</h4>
<p>I can get rid of the error by replacing <code>  rw is_preprimitive_of_bijective_map_iff hφ hf,</code> with <code>rw is_preprimitive_of_bijective_map_iff _ _ _ _ hφ hf,</code></p>



<a name="306729835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306729835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306729835">(Oct 28 2022 at 19:05)</a>:</h4>
<p>You're right. This shows that my <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> does not make the problem appear, while it appears in real life…</p>



<a name="306730545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306730545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306730545">(Oct 28 2022 at 19:09)</a>:</h4>
<p>if you have your actual code in a branch of mathlib or some separate repo, you could share a link?</p>



<a name="306732024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306732024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306732024">(Oct 28 2022 at 19:18)</a>:</h4>
<p>Yes, this is <a href="https://github.com/leanprover-community/mathlib/tree/acl-Wielandt">branch#acl-Wielandt</a><br>
The problem is in alternating_iwasawa.lean<br>
It appears on line 350, and there are similar issues below.</p>



<a name="306732052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306732052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306732052">(Oct 28 2022 at 19:18)</a>:</h4>
<p>I'm totally confused and so grateful for your help…</p>



<a name="306732742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306732742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306732742">(Oct 28 2022 at 19:23)</a>:</h4>
<p>I got the branch and I'm trying to build that file now.</p>



<a name="306733320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306733320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306733320">(Oct 28 2022 at 19:27)</a>:</h4>
<p>I'm getting <code>could not resolve import: mul_action_finset</code>. Is there a file missing?</p>



<a name="306733609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306733609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306733609">(Oct 28 2022 at 19:29)</a>:</h4>
<p>Yes… I had forgotten to add this file to the <code>commit</code>…</p>



<a name="306733648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306733648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306733648">(Oct 28 2022 at 19:29)</a>:</h4>
<p>it's not an issue for the error in question, I'm just wondering</p>



<a name="306734937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306734937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306734937">(Oct 28 2022 at 19:37)</a>:</h4>
<p>it looks like there might be a diamond.</p>



<a name="306735040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306735040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306735040">(Oct 28 2022 at 19:38)</a>:</h4>
<p>I have moved the contentious lemma in another file, and I get different problems…</p>



<a name="306735343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306735343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306735343">(Oct 28 2022 at 19:40)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">I1</span> <span class="o">:</span> <span class="n">has_smul</span> <span class="o">(</span><span class="n">stabilizer</span> <span class="o">(</span><span class="n">alternating_group</span> <span class="n">α</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="n">s</span> <span class="o">:=</span>
    <span class="n">mul_action.to_has_smul</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">I2</span> <span class="o">:</span> <span class="n">has_smul</span> <span class="o">(</span><span class="n">stabilizer</span> <span class="o">(</span><span class="n">alternating_group</span> <span class="n">α</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="n">s</span> <span class="o">:=</span>
    <span class="n">has_smul.stabilizer</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">I1</span> <span class="bp">=</span> <span class="n">I2</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- FAILS</span>
<span class="kd">end</span>
</code></pre></div>



<a name="306735379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306735379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306735379">(Oct 28 2022 at 19:40)</a>:</h4>
<p>let me try to extract a minimal example</p>



<a name="306736013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306736013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306736013">(Oct 28 2022 at 19:45)</a>:</h4>
<p>I might have defined twice this <code>has_smul</code> ?</p>



<a name="306736061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306736061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306736061">(Oct 28 2022 at 19:45)</a>:</h4>
<p>no I think these are both in mathlib somewhere</p>



<a name="306736163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306736163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306736163">(Oct 28 2022 at 19:46)</a>:</h4>
<p>oh maybe <code>has_smul.stabilizer</code> is not?</p>



<a name="306736330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306736330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306736330">(Oct 28 2022 at 19:47)</a>:</h4>
<p>Ah! Yeah, this is from your file <code>jordan/for_mathlib/stabilizer</code></p>



<a name="306736401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306736401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306736401">(Oct 28 2022 at 19:47)</a>:</h4>
<p>Okay, so I think we understand the issue -- it's a diamond caused by this isntance</p>



<a name="306737497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306737497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306737497">(Oct 28 2022 at 19:55)</a>:</h4>
<p>The reason that the <code>has_smul</code> instances are not defeq is because your version of <code>has_smul.stabilizer</code> uses pattern matching whereas mathlib's version uses projections. For example, if you change your definition to </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- The instance that makes the stabilizer of a set acting on that set -/</span>
<span class="kd">instance</span> <span class="n">has_smul.stabilizer</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">has_smul</span> <span class="bp">↥</span><span class="o">(</span><span class="n">stabilizer</span> <span class="n">G</span> <span class="n">s</span><span class="o">)</span> <span class="bp">↥</span><span class="n">s</span> <span class="o">:=</span> <span class="o">{</span>
<span class="n">smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">g</span> <span class="n">x</span><span class="o">,</span> <span class="o">⟨(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="bp">•</span> <span class="n">x</span><span class="o">,</span>
  <span class="kd">begin</span>
    <span class="gr">sorry</span>
  <span class="kd">end</span><span class="o">⟩,</span> <span class="o">}</span>
</code></pre></div>
<p>then the <del>error</del> problematic diamond disappears.</p>
<p>Of course, the correct solution is to just use mathlib's instance :)</p>



<a name="306738531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306738531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306738531">(Oct 28 2022 at 20:00)</a>:</h4>
<p>hmmm actually I can't seem to find the action of the stabilizer of a set on the set itself. Is that something that was recently added to mathlib?</p>



<a name="306738955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306738955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306738955">(Oct 28 2022 at 20:02)</a>:</h4>
<p>Ah no it's not in mathlib! But the difference is caused by the internals of <a href="https://leanprover-community.github.io/mathlib_docs/find/sub_mul_action.mul_action">docs#sub_mul_action.mul_action</a></p>



<a name="306739007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306739007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306739007">(Oct 28 2022 at 20:03)</a>:</h4>
<p>again, it stems from the pattern-matching vs. projection issue</p>



<a name="306748713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306748713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306748713">(Oct 28 2022 at 21:01)</a>:</h4>
<p>I think there is a recent PR where I discussed adding stabilizer actions</p>



<a name="306748799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306748799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306748799">(Oct 28 2022 at 21:02)</a>:</h4>
<p>Annoyingly they don't generalize and we have to repeat them for every subobject</p>



<a name="306749673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306749673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Antoine Chambert-Loir <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306749673">(Oct 28 2022 at 21:07)</a>:</h4>
<p>Thank you so much !</p>



<a name="306758305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/lost%20in%20confusion/near/306758305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/lost.20in.20confusion.html#306758305">(Oct 28 2022 at 22:11)</a>:</h4>
<p>The discussion was <a href="https://github.com/leanprover-community/mathlib/pull/17086#issuecomment-1293833495">https://github.com/leanprover-community/mathlib/pull/17086#issuecomment-1293833495</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>