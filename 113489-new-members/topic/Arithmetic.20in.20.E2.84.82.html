---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html">Arithmetic in ℂ</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="284537063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284537063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leo Mayer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284537063">(May 31 2022 at 21:05)</a>:</h4>
<p>I'm working through exercises in "Linear Algebra done right" with <span class="user-mention" data-user-id="414458">@Vasily Ilin</span>,  and one of them was "verify this expression is a third root of unity." I have a solution which works but is pretty awful:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.complex.basic</span>

<span class="kn">open</span> <span class="n">complex</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">real.mul_self_sqrt</span><span class="o">,</span>
  <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">nat.zero_le</span> <span class="mi">3</span><span class="o">,</span>
  <span class="k">calc</span>
      <span class="o">((</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">=</span>
      <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="mi">8</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">3</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span> <span class="bp">+</span> <span class="o">((</span><span class="n">I</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)))</span><span class="bp">*</span><span class="o">(</span><span class="bp">-</span><span class="mi">3</span><span class="bp">+</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)))</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">ring</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="mi">8</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">3</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">I</span><span class="bp">*</span><span class="n">I</span><span class="bp">*</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="bp">-</span><span class="mi">3</span><span class="bp">+</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)))</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">h</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="mi">8</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">3</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="bp">*</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="o">(</span><span class="bp">-</span><span class="mi">3</span><span class="bp">+</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)))</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">I_mul_I</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">ring</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>Is there a more pleasant way to do this?</p>



<a name="284538068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284538068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284538068">(May 31 2022 at 21:16)</a>:</h4>
<p>Slightly random looking, but this works without any by hand calculation:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.complex.basic</span>

<span class="kn">open</span> <span class="n">complex</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">field_simp</span><span class="o">,</span>
  <span class="n">ring_nf</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">ring_nf</span><span class="o">,</span>
  <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">norm_num</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="284539779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284539779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leo Mayer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284539779">(May 31 2022 at 21:31)</a>:</h4>
<p>Thanks! Good to know that <code>norm_num</code> knows about squaring square roots!<br>
So does <code>norm_cast</code> move the coercions as high up the syntax tree as possible, so that we can, eg, use lemmas about arithmetic in  ℕ, ℤ, ℝ, etc before having to reason in ℂ?</p>



<a name="284540103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284540103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284540103">(May 31 2022 at 21:34)</a>:</h4>
<p>Exactly, this lets norm num apply what it/simp knows about squaring real square roots, rather than squares of coercions</p>



<a name="284540939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284540939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leo Mayer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284540939">(May 31 2022 at 21:42)</a>:</h4>
<p>It's sad that this doesn't work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span><span class="o">)</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">=</span> <span class="mi">3</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">norm_num</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>or else the proof could maybe be shorter using <code>ring_nf SOP</code>?</p>



<a name="284542502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284542502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284542502">(May 31 2022 at 21:58)</a>:</h4>
<p>Might be worth adding the norm_num lemma that <code>(real.sqrt a) ^ n = a ^ (n / 2) * (real.sqrt a) ^ (n % 2)</code> then</p>



<a name="284546261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284546261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284546261">(May 31 2022 at 22:41)</a>:</h4>
<p>that's not how norm_num works, it doesn't have lemmas like that</p>



<a name="284546307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284546307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284546307">(May 31 2022 at 22:41)</a>:</h4>
<p>norm_num evaluates things to a normal form, so you would need to define what normal form means for sqrt expressions</p>



<a name="284546385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284546385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284546385">(May 31 2022 at 22:42)</a>:</h4>
<p>this kind of reasoning is closest to what <code>ring</code> could do</p>



<a name="284546419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284546419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284546419">(May 31 2022 at 22:42)</a>:</h4>
<p>you need to know some facts about sqrt, and I think <code>linear_combination</code> can handle it</p>



<a name="284546599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284546599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284546599">(May 31 2022 at 22:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span><span class="o">)</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">=</span> <span class="mi">3</span><span class="bp">*</span><span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">real.sq_sqrt</span> <span class="mi">3</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">),</span>
  <span class="n">linear_combination</span> <span class="o">(</span><span class="n">this</span><span class="o">,</span> <span class="n">real.sqrt</span> <span class="mi">3</span><span class="o">),</span>
<span class="kd">end</span>
</code></pre></div>



<a name="284546685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284546685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284546685">(May 31 2022 at 22:46)</a>:</h4>
<p>when <a href="https://github.com/leanprover-community/mathlib/pull/14229">#14229</a> lands it can be written <code>by linear_combination real.sqrt 3 * @real.sq_sqrt 3 (by norm_num)</code></p>



<a name="284547018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284547018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284547018">(May 31 2022 at 22:51)</a>:</h4>
<p>A lemma like that could be a simp lemma under the side condition that n is at least 2, which norm num could then discharge is what I'm thinking. Or would that also not happen the way I hope?</p>



<a name="284547099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284547099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284547099">(May 31 2022 at 22:52)</a>:</h4>
<p>The normal form would then naturally be no natural powers on sqrts?</p>



<a name="284547348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284547348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284547348">(May 31 2022 at 22:56)</a>:</h4>
<p>And here's a proof of your original problem</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">+</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="n">real.sqrt</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">I</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">3</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span><span class="o">,</span> <span class="n">exact_mod_cast</span> <span class="bp">@</span><span class="n">real.sq_sqrt</span> <span class="mi">3</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">linear_combination</span> <span class="o">(</span><span class="n">this</span><span class="o">,</span> <span class="o">(</span><span class="bp">-</span><span class="mi">3</span><span class="bp">+</span><span class="o">(</span><span class="n">real.sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="bp">*</span><span class="n">I</span><span class="o">))</span><span class="bp">/</span><span class="mi">8</span><span class="o">),</span>
<span class="kd">end</span>
</code></pre></div>



<a name="284547572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284547572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284547572">(May 31 2022 at 22:59)</a>:</h4>
<p><span class="user-mention" data-user-id="127136">@Alex J. Best</span> <code>norm_num</code> calls <code>simp</code>, which is why it was able to solve some simple questions about sqrt, but it doesn't really understand <code>sqrt</code> at all. <code>norm_num</code> normal form is not like <code>simp</code> normal form, in that the latter is defined simply as "whatever is not modified by <code>simp</code>" and the former has an explicit definition per type (for example, a normal form for <code>nat</code> is a numeral expression like <code>37</code>). If you allow sqrts, then the normal form is something like "arbitrary + * ^ combinations of <code>sqrt</code> operations" and it sounds like a nightmare to decide equality on that grammar</p>



<a name="284547893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Arithmetic%20in%20%E2%84%82/near/284547893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Arithmetic.20in.20.E2.84.82.html#284547893">(May 31 2022 at 23:02)</a>:</h4>
<p><code>sqrt 2 * sqrt 3 = sqrt 6</code> has no natural powers on sqrts but they are distinct normal forms by your definition</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>