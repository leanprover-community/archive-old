---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/linarith.20substitution.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html">linarith substitution</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204595927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204595927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Iocta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204595927">(Jul 21 2020 at 19:59)</a>:</h4>
<p>Why doesn't <code>linarith</code> work at the bottom?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">specific_limits</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">int</span><span class="bp">.</span><span class="n">parity</span>

<span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">classical</span><span class="bp">.</span><span class="n">prop_decidable</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">Lemmas from that file were hidden in my course, or restating things which</span>
<span class="cm">were proved without name in previous files.</span>
<span class="cm">-/</span>

<span class="kn">notation</span> <span class="bp">`|`</span><span class="n">x</span><span class="bp">`|`</span> <span class="o">:=</span> <span class="n">abs</span> <span class="n">x</span>

<span class="n">def</span> <span class="n">extraction</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="n">n</span> <span class="n">m</span><span class="o">,</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">φ</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="n">φ</span> <span class="n">m</span>



<span class="n">def</span> <span class="n">seq_limit</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">|</span><span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">l</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span>


<span class="n">def</span> <span class="n">cluster_point</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∃</span> <span class="n">φ</span><span class="o">,</span> <span class="n">extraction</span> <span class="n">φ</span> <span class="bp">∧</span> <span class="n">seq_limit</span> <span class="o">(</span><span class="n">u</span> <span class="err">∘</span> <span class="n">φ</span><span class="o">)</span> <span class="n">a</span>

<span class="kn">variable</span> <span class="o">{</span> <span class="n">φ</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span>

<span class="kn">lemma</span> <span class="n">near_cluster</span> <span class="o">:</span>
  <span class="n">cluster_point</span> <span class="n">u</span> <span class="n">a</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">|</span><span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">a</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="n">sorry</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">The above exercice can be done in five lines.</span>
<span class="cm">Hint: you can use the anonymous constructor syntax when proving</span>
<span class="cm">existential statements.</span>
<span class="cm">-/</span>

<span class="c">/-</span><span class="cm">- If `u` tends to `l` then its subsequences tend to `l`. -/</span>
<span class="c1">-- 0041</span>
<span class="kn">lemma</span> <span class="n">subseq_tendsto_of_tendsto&#39;</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">l</span><span class="o">)</span> <span class="o">(</span><span class="n">hφ</span> <span class="o">:</span> <span class="n">extraction</span> <span class="n">φ</span><span class="o">)</span> <span class="o">:</span>
<span class="n">seq_limit</span> <span class="o">(</span><span class="n">u</span> <span class="err">∘</span> <span class="n">φ</span><span class="o">)</span> <span class="n">l</span> <span class="o">:=</span>
<span class="n">sorry</span>



<span class="kn">lemma</span> <span class="n">unique_limit</span> <span class="o">{</span><span class="n">u</span> <span class="n">l</span> <span class="n">l&#39;</span><span class="o">}</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">l</span> <span class="bp">→</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">l&#39;</span> <span class="bp">→</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">l&#39;</span> <span class="o">:=</span>
<span class="n">sorry</span>


<span class="c">/-</span><span class="cm">- If `u` tends to `l` all its cluster points are equal to `l`. -/</span>
<span class="c1">-- 0042</span>
<span class="kn">lemma</span> <span class="n">cluster_limit</span> <span class="o">(</span><span class="n">hl</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">l</span><span class="o">)</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">cluster_point</span> <span class="n">u</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">l</span> <span class="o">:=</span>
<span class="n">sorry</span>


<span class="c">/-</span><span class="cm">- Cauchy_sequence sequence -/</span>
<span class="n">def</span> <span class="n">cauchy_sequence</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">N</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">p</span> <span class="n">q</span><span class="o">,</span> <span class="n">p</span> <span class="bp">≥</span> <span class="n">N</span> <span class="bp">→</span> <span class="n">q</span> <span class="bp">≥</span> <span class="n">N</span> <span class="bp">→</span> <span class="bp">|</span><span class="n">u</span> <span class="n">p</span> <span class="bp">-</span> <span class="n">u</span> <span class="n">q</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span>



<span class="c">/-</span><span class="cm"></span>
<span class="cm">In the next exercise, you can reuse</span>
<span class="cm"> near_cluster : cluster_point u a → ∀ ε &gt; 0, ∀ N, ∃ n ≥ N, |u n - a| ≤ ε</span>
<span class="cm">-/</span>
<span class="c1">-- 0044</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">hu</span> <span class="o">:</span> <span class="n">cauchy_sequence</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">hl</span> <span class="o">:</span> <span class="n">cluster_point</span> <span class="n">u</span> <span class="n">l</span><span class="o">)</span> <span class="o">:</span> <span class="n">seq_limit</span> <span class="n">u</span> <span class="n">l</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="n">intros</span> <span class="n">ε</span> <span class="n">ε_pos</span><span class="o">,</span>
<span class="n">specialize</span> <span class="n">hu</span> <span class="o">(</span><span class="n">ε</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">),</span>
<span class="n">cases</span> <span class="n">hu</span> <span class="k">with</span> <span class="n">N</span> <span class="n">hN</span><span class="o">,</span>
<span class="n">use</span> <span class="n">N</span><span class="o">,</span>
<span class="n">intros</span> <span class="n">n</span> <span class="n">hn</span><span class="o">,</span>
<span class="k">have</span> <span class="n">exists_N&#39;</span><span class="o">:</span> <span class="bp">∃</span> <span class="n">N&#39;</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span> <span class="bp">|</span> <span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">l</span> <span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">near_cluster</span> <span class="n">hl</span> <span class="o">(</span><span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">),</span>
<span class="n">cases</span> <span class="n">exists_N&#39;</span> <span class="k">with</span> <span class="n">N&#39;</span> <span class="n">hN&#39;</span><span class="o">,</span>
<span class="n">cases</span> <span class="n">hN&#39;</span> <span class="k">with</span> <span class="n">N&#39;_ge_N</span> <span class="n">N&#39;_close</span><span class="o">,</span>
<span class="n">specialize</span> <span class="n">hN</span> <span class="n">N&#39;</span> <span class="n">n</span> <span class="n">N&#39;_ge_N</span> <span class="n">hn</span><span class="o">,</span>
<span class="k">calc</span> <span class="bp">|</span> <span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">l</span> <span class="bp">|</span> <span class="bp">=</span> <span class="bp">|</span> <span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">u</span> <span class="n">N&#39;</span>  <span class="bp">+</span> <span class="o">(</span><span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">l</span><span class="o">)</span> <span class="bp">|</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>
<span class="bp">...</span> <span class="bp">≤</span> <span class="bp">|</span> <span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">|</span> <span class="bp">+</span> <span class="bp">|</span> <span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">l</span> <span class="bp">|</span> <span class="o">:</span> <span class="k">by</span> <span class="n">apply</span> <span class="n">abs_add</span>
<span class="bp">...</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span> <span class="o">:</span> <span class="k">by</span> <span class="n">linarith</span> <span class="c1">-- XXX Doesn&#39;t work</span>
<span class="bp">...</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="o">:</span> <span class="k">by</span> <span class="n">linarith</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204596070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204596070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204596070">(Jul 21 2020 at 20:00)</a>:</h4>
<p>what is the error, including the proof state?</p>



<a name="204596194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204596194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Iocta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204596194">(Jul 21 2020 at 20:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">linarith</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">find</span> <span class="n">a</span> <span class="n">contradiction</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">hl</span> <span class="o">:</span> <span class="n">cluster_point</span> <span class="n">u</span> <span class="n">l</span><span class="o">,</span>
<span class="n">ε</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">ε_pos</span> <span class="o">:</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">N</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span>
<span class="n">N&#39;</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">N&#39;_ge_N</span> <span class="o">:</span> <span class="n">N&#39;</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span>
<span class="n">N&#39;_close</span> <span class="o">:</span> <span class="bp">|</span><span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">l</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">,</span>
<span class="n">hN</span> <span class="o">:</span> <span class="bp">|</span><span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">u</span> <span class="n">n</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">,</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">|</span><span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">u</span> <span class="n">N&#39;</span><span class="bp">|</span> <span class="bp">+</span> <span class="bp">|</span><span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">l</span><span class="bp">|</span> <span class="bp">&gt;</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span>
<span class="err">⊢</span> <span class="n">false</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">u</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">hl</span> <span class="o">:</span> <span class="n">cluster_point</span> <span class="n">u</span> <span class="n">l</span><span class="o">,</span>
<span class="n">ε</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">ε_pos</span> <span class="o">:</span> <span class="n">ε</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">N</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span>
<span class="n">N&#39;</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">N&#39;_ge_N</span> <span class="o">:</span> <span class="n">N&#39;</span> <span class="bp">≥</span> <span class="n">N</span><span class="o">,</span>
<span class="n">N&#39;_close</span> <span class="o">:</span> <span class="bp">|</span><span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">l</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">,</span>
<span class="n">hN</span> <span class="o">:</span> <span class="bp">|</span><span class="n">u</span> <span class="n">N&#39;</span> <span class="bp">-</span> <span class="n">u</span> <span class="n">n</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span> <span class="bp">/</span> <span class="mi">2</span>
<span class="err">⊢</span> <span class="bp">|</span><span class="n">u</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">l</span><span class="bp">|</span> <span class="bp">≤</span> <span class="n">ε</span>
</code></pre></div>



<a name="204596345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204596345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204596345">(Jul 21 2020 at 20:02)</a>:</h4>
<p>You have a hypothesis about <code>|u N' - u n|</code> not <code>|u n - u N'|</code> and linarith doesn't know they're equal?</p>



<a name="204596393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204596393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204596393">(Jul 21 2020 at 20:03)</a>:</h4>
<p>What Reid said, you can do by <code>by rw abs_sub; linarith</code> instead</p>



<a name="204596609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204596609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Iocta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204596609">(Jul 21 2020 at 20:04)</a>:</h4>
<p>Thanks</p>



<a name="204600357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204600357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204600357">(Jul 21 2020 at 20:40)</a>:</h4>
<p>When I was using linarith to solve goals like this, I would incredulously ask the designer why linarith didn't just apply things like <code>abs_sub</code> automatically, given that it's clearly a linear inequality kind of thing. The answer is that tactics are there to do one job and to do it well, and job of linarith is to deal with goals and hypotheses of the form x&lt;=y and x=y and x&lt;y. The moment you start asking it to do more, eg hypotheses of the form <code>a&lt;b \and c&lt;d</code> you are facing the possibility of chaos as it starts unfolding everything in case it turns out to be an inequality. It's the user's job to reduce everything to plain a&lt;=b statements because that's where the tactic starts it's work -- that's it's specification. Once all this sunk in I began to be able to use <code>linarith</code> much more effectively.</p>



<a name="204600569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/linarith%20substitution/near/204600569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/linarith.20substitution.html#204600569">(Jul 21 2020 at 20:42)</a>:</h4>
<p>When working with absolute values you need to know stuff like abs_le and le_abs etc and apply them yourself to break everything into bare inequalities, so it's worth knowing the basic interface for abs with these kinds of question</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>