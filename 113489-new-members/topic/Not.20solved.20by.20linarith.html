---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Not.20solved.20by.20linarith.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html">Not solved by linarith</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="258198826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258198826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Elias Fåkvam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258198826">(Oct 19 2021 at 13:58)</a>:</h4>
<p>Why is this not solved by linarith? at first i thought it might be because 0-1 would not make sense, but adding the positivity of j did not help.<br>
its part of a longer poof but i have included all the imports in case they might be the problem.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="kn">open</span> <span class="n">nat</span>
<span class="kn">open</span> <span class="n">classical</span>

<span class="kd">lemma</span> <span class="n">mytest</span> <span class="o">(</span><span class="n">j</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">j</span><span class="bp">-</span><span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">j</span><span class="o">:=</span>
<span class="kd">begin</span>
<span class="n">linarith</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="258201499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258201499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ayush Agrawal <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258201499">(Oct 19 2021 at 14:14)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="443251">@Elias Fåkvam</span> i am also noob here but, as far as I know linarith is not able to find the contradiction (0 &lt; 0) just from (j &gt; 0) and (j - 1 &gt;= j) as linear combinations with nat numbers would not give 0 here. Gimme a sec and I'll provide some more insights here. Any others plz correct me!</p>



<a name="258202512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258202512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ayush Agrawal <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258202512">(Oct 19 2021 at 14:19)</a>:</h4>
<p>Maybe this might make it more clear:<br>
u can use <code>set_option trace.linarith true</code> for peeking what's going on</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">trying</span> <span class="n">to</span> <span class="n">split</span> <span class="n">hypotheses</span>
<span class="n">linarith</span> <span class="n">is</span> <span class="n">running</span> <span class="n">on</span> <span class="n">the</span> <span class="n">following</span> <span class="n">hypotheses</span><span class="o">:</span>
<span class="o">[</span><span class="n">ℕ</span><span class="o">,</span> <span class="n">j</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">≥</span> <span class="n">j</span><span class="o">]</span>
<span class="n">Preprocessing</span><span class="o">:</span> <span class="n">filter</span> <span class="n">terms</span> <span class="n">that</span> <span class="n">are</span> <span class="n">not</span> <span class="n">proofs</span> <span class="n">of</span> <span class="n">comparisons</span>
<span class="o">[</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">≥</span> <span class="n">j</span><span class="o">,</span> <span class="n">j</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">]</span>
<span class="n">Preprocessing</span><span class="o">:</span> <span class="n">replace</span> <span class="n">negations</span> <span class="n">of</span> <span class="n">comparisons</span>
<span class="o">[</span><span class="n">j</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">≥</span> <span class="n">j</span><span class="o">]</span>
<span class="n">Preprocessing</span><span class="o">:</span> <span class="n">move</span> <span class="n">nats</span> <span class="n">to</span> <span class="n">ints</span>
<span class="o">[</span><span class="mi">0</span> <span class="bp">&lt;</span> <span class="bp">↑</span><span class="n">j</span><span class="o">,</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="n">j</span><span class="o">]</span>
<span class="n">Preprocessing</span><span class="o">:</span> <span class="n">strengthen</span> <span class="n">strict</span> <span class="n">inequalities</span> <span class="n">over</span> <span class="n">int</span>
<span class="o">[</span><span class="mi">0</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="n">j</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">),</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">),</span> <span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">≤</span> <span class="bp">↑</span><span class="n">j</span><span class="o">]</span>
<span class="n">Preprocessing</span><span class="o">:</span> <span class="n">make</span> <span class="n">comparisons</span> <span class="k">with</span> <span class="n">zero</span>
<span class="o">[</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">-</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">-</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">-↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">-↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">]</span>
<span class="n">Preprocessing</span><span class="o">:</span> <span class="n">cancel</span> <span class="n">denominators</span>
<span class="o">[</span><span class="bp">-↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">-↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">-</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">-</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">]</span>
<span class="n">after</span> <span class="n">preprocessing</span><span class="o">,</span> <span class="n">linarith</span> <span class="n">has</span> <span class="mi">4</span> <span class="n">facts</span><span class="o">:</span>
<span class="o">[</span><span class="bp">-↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">-↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">-</span> <span class="bp">↑</span><span class="o">(</span><span class="n">j</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">-</span> <span class="bp">↑</span><span class="n">j</span> <span class="bp">≤</span> <span class="mi">0</span><span class="o">]</span>
<span class="n">hypotheses</span> <span class="n">appear</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">different</span> <span class="n">types</span>
</code></pre></div>



<a name="258203380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258203380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ayush Agrawal <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258203380">(Oct 19 2021 at 14:24)</a>:</h4>
<p>u can read resources on Fourier–Motzkin elimination from wiki and <a href="https://leanprover-community.github.io/mathlib_docs/tactic/linarith/elimination.html">https://leanprover-community.github.io/mathlib_docs/tactic/linarith/elimination.html</a> to get what linarith uses. <del>Here at the last line above u can observe that linear combinations of the facts with natural number coefficients greater than one is not possible for <code>linarith</code> to find contradiction 0 &lt; 0 so it is failing. Hope this helps.</del> lemme know it u need more insights!</p>



<a name="258207173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258207173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ayush Agrawal <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258207173">(Oct 19 2021 at 14:44)</a>:</h4>
<p>Its interesting tho, since it should be able to find the contradiction using   <code> -1 + (j - (j -1)) </code> this should be both zero and less than 0! <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> can u take a look here? is due to lack of treatment of - - 1 -&gt; 1?</p>



<a name="258207519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258207519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258207519">(Oct 19 2021 at 14:46)</a>:</h4>
<p>I am no <code>linarith</code> expert but the problem is that it doesn't try to replace <code>↑(j - 1)</code> with <code>↑j - 1</code>.</p>



<a name="258207710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258207710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ayush Agrawal <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258207710">(Oct 19 2021 at 14:47)</a>:</h4>
<p>Hmm yes! Interesting to think about the nuances here though :)</p>



<a name="258207844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258207844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258207844">(Oct 19 2021 at 14:48)</a>:</h4>
<p>I'm not sure <code>linarith</code> tries to do anything with the weird nat subtraction</p>



<a name="258207894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258207894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258207894">(Oct 19 2021 at 14:48)</a>:</h4>
<p>Seems like it could use <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.zify">docs#tactic.zify</a></p>



<a name="258253850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258253850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258253850">(Oct 19 2021 at 19:03)</a>:</h4>
<p>linarith does use zify as a preprocessing step, it just doesn't use zify with the extra hypotheses included unfortunately. It should definitely be possible to support this if we wanted, but the obvious 1-line fix of including all hypotheses in the zify call doesn't work as it then uses the hypotheses to simplify themselves, resulting in trivial hypotheses.</p>



<a name="258254201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258254201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258254201">(Oct 19 2021 at 19:05)</a>:</h4>
<p>Also <span class="user-mention" data-user-id="443251">@Elias Fåkvam</span> you should try and only work with less than and less than an equal to (rather than &gt; and \ge), a long time ago mathlib made the decision that having two equivalent but distinct ways of saying the same thing wasn't worth the headache, so decided to only use &lt; and \le, hence many tactics and lemmas won't work flawlessly with &gt; and \ge now.</p>



<a name="258332703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Not%20solved%20by%20linarith/near/258332703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Not.20solved.20by.20linarith.html#258332703">(Oct 20 2021 at 08:47)</a>:</h4>
<p>I just made <a href="https://github.com/leanprover-community/mathlib/issues/9822">#9822</a> to track this.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>