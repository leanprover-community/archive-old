---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html">rewrite only first occurrence?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="181763874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181763874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> agro1986 <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181763874">(Nov 24 2019 at 14:55)</a>:</h4>
<p>Hi all. In tactics mode, how do I say <code>rewrite th1 but please do it only on the first occurence k thx</code>? Thanks a lot</p>



<a name="181763944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181763944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181763944">(Nov 24 2019 at 14:57)</a>:</h4>
<p>you can do it with <code>conv</code>, but I would like to see a use case first</p>



<a name="181763945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181763945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> agro1986 <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181763945">(Nov 24 2019 at 14:57)</a>:</h4>
<p>More concretely, I want to change <code>n = n + 1</code> into <code>n + 0 = n + 1</code>. If I use the proof <code>n = n + 0</code>, rw will change it into <code>n + 0 = n + 0 + 1</code> :(</p>



<a name="181764002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764002">(Nov 24 2019 at 14:58)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">conv</span> <span class="o">{</span><span class="n">to_lhs</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">add_zero</span> <span class="n">n</span><span class="o">},</span>
<span class="kn">end</span>
</pre></div>



<a name="181764017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764017">(Nov 24 2019 at 14:59)</a>:</h4>
<p>it's not changing the first occurrence, but it is rewriting only on the lhs of the equality</p>



<a name="181764018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764018">(Nov 24 2019 at 14:59)</a>:</h4>
<p>which achieves the same effect</p>



<a name="181764102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> agro1986 <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764102">(Nov 24 2019 at 15:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> thanks. What about the case where I want to change a hypothesis <code>h</code>, not the goal? In rw we say <code>rw th1 at h</code></p>



<a name="181764145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764145">(Nov 24 2019 at 15:02)</a>:</h4>
<p><code>at h</code> still works</p>



<a name="181764152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764152">(Nov 24 2019 at 15:02)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">conv</span> <span class="n">at</span> <span class="n">h</span> <span class="o">{</span><span class="n">to_lhs</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">add_zero</span> <span class="n">n</span><span class="o">},</span>
<span class="kn">end</span>
</pre></div>



<a name="181764157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764157">(Nov 24 2019 at 15:02)</a>:</h4>
<p>it goes on the <code>conv</code> because that's the part that figures out where to work</p>



<a name="181764171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> agro1986 <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764171">(Nov 24 2019 at 15:03)</a>:</h4>
<p>Ahh I see! I tried writing <code>at h</code> at the end of the sentence so it didn't work. Thanks a lot!</p>



<a name="181764221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764221">(Nov 24 2019 at 15:04)</a>:</h4>
<p>if you mouse over the <code>conv</code> it should print <code>conv (at id)? (in expr)? { tactic }</code> which shows the correct order of use</p>



<a name="181764294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> agro1986 <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764294">(Nov 24 2019 at 15:06)</a>:</h4>
<p>cool! I used it for solving this: <a href="http://wwwf.imperial.ac.uk/~buzzard/xena/natural_number_game/" target="_blank" title="http://wwwf.imperial.ac.uk/~buzzard/xena/natural_number_game/">http://wwwf.imperial.ac.uk/~buzzard/xena/natural_number_game/</a></p>
<div class="codehilite"><pre><span></span>  rw ← add_one_eq_succ,
  assume h,
  conv at h {to_lhs, rw ← add_zero n},
  have h2 := add_left_cancel _ _ _ h,
  apply zero_ne_succ 0,
  rw ← one_eq_succ_zero,
  exact h2,
</pre></div>



<a name="181764527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764527">(Nov 24 2019 at 15:13)</a>:</h4>
<p>what's the theorem?</p>



<a name="181764602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764602">(Nov 24 2019 at 15:15)</a>:</h4>
<p>the natural number game says what theorem you are proving just outside the text box, you need that if you want to quote the theorem outside the game (and some more besides that, depending on how advanced the theorem is, you might have your own definitions and such to rely on)</p>



<a name="181764613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181764613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181764613">(Nov 24 2019 at 15:15)</a>:</h4>
<p>it's always best to post complete examples here in chat so we can test your work</p>



<a name="181772229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181772229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181772229">(Nov 24 2019 at 18:46)</a>:</h4>
<p>Mario surely you can work out the theorem from the proof :-)</p>



<a name="181772238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181772238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181772238">(Nov 24 2019 at 18:46)</a>:</h4>
<p>Is that reverse mathematics?</p>



<a name="181772974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181772974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181772974">(Nov 24 2019 at 19:05)</a>:</h4>
<p>Hm, it's a bit complicated because you made up all the theorem names, but this prelude does the job:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">namespace</span> <span class="n">mynat</span>
<span class="kn">open</span> <span class="n">nat</span>
<span class="kn">theorem</span> <span class="n">add_one_eq_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kn">theorem</span> <span class="n">add_left_cancel</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">add_left_cancel</span>
<span class="kn">theorem</span> <span class="n">zero_ne_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">≠</span> <span class="n">succ</span> <span class="n">n</span><span class="bp">.</span>
<span class="kn">theorem</span> <span class="n">one_eq_succ_zero</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">succ</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≠</span> <span class="n">succ</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">add_one_eq_succ</span><span class="o">,</span>
  <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">conv</span> <span class="n">at</span> <span class="n">h</span> <span class="o">{</span><span class="n">to_lhs</span><span class="o">,</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">add_zero</span> <span class="n">n</span><span class="o">},</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:=</span> <span class="n">add_left_cancel</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">zero_ne_succ</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">one_eq_succ_zero</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">h2</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">mynat</span>
</pre></div>



<a name="181773125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20only%20first%20occurrence%3F/near/181773125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20only.20first.20occurrence.3F.html#181773125">(Nov 24 2019 at 19:09)</a>:</h4>
<p>and golfed:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≠</span> <span class="n">succ</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">exact</span> <span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">zero_ne_succ</span> <span class="mi">0</span> <span class="o">(</span><span class="n">add_left_cancel</span> <span class="n">n</span> <span class="mi">0</span> <span class="mi">1</span> <span class="n">h</span><span class="o">)</span>
<span class="kn">end</span>
</pre></div>


<p>the best tactic proof is a term proof :P</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>