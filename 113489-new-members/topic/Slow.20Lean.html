---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Slow.20Lean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html">Slow Lean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="201372266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201372266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201372266">(Jun 19 2020 at 10:13)</a>:</h4>
<p>At some point through a proof Lean started being very slow (each time I write something, even simple tactics, it takes more than 1 minute to update the goal) and the rest of my laptop seems to work fine! Does anyone have any tip on what I could try to do or any way I can troubleshoot Lean?</p>



<a name="201373050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373050">(Jun 19 2020 at 10:24)</a>:</h4>
<p>What is probably happening is that you have written a proof which takes a lot of time to compile, and every time you press a key Lean is recompiling the proof.</p>



<a name="201373243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373243">(Jun 19 2020 at 10:27)</a>:</h4>
<p>The reason that mathlib is written in heiroglyphics is precisely because they want all proofs to compile as fast as possible. There are several ways you can proceed. Firstly, there's some trick with putting <code>end.</code> instead of <code>end</code> after the problematic proof; this is supposed to tell Lean not to keep compiling it. This won't work if the problem is the proof you're currently working on though. Assuming the problem is a long proof you're finished with, another quick fix is to comment out the long proof, replace it with <code>sorry</code>, and then put it back in the end, and another is to take out that proof and put it in another file, which you can import. Note that the problematic line can just be one line such as <code>finish</code> or another expensive tactic.</p>



<a name="201373436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373436" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373436">(Jun 19 2020 at 10:29)</a>:</h4>
<p>If the problem is with a proof you're working on (i.e. you've still not finished the proof but Lean takes an age to compile the proof) then you might want to think about refactoring the proof. Best Lean style is lots of short proofs, not one big one -- this is how Grothendieck wrote mathematics as well. Deligne once said that it was amazing, he seemed to be doing a bunch of things which all looked trivial, and then something highly non-trivial would come out at the end. Lean likes to see mathematicians isolating the trivial steps and proving them as independent lemmas, rather than proving everything you need in one big proof. If you find yourself writing <code>have sublemma : &lt;independent thing&gt;, {proof of sublemma}</code> in the middle of your proof then that's a great example of something which can go outside instead.</p>



<a name="201373549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373549">(Jun 19 2020 at 10:30)</a>:</h4>
<p>Ok thanks that is very useful. I am a bit surprised because it looks to be a fairly simple and basic proof, so I am wondering if I am doing something specific that slows it down. Do you have any specific tip for improving it?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span><span class="bp">.</span><span class="n">function</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">z</span> <span class="n">h3</span> <span class="n">h4</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="n">exact</span> <span class="bp">⟨</span><span class="n">h1</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span> <span class="n">h2</span> <span class="n">h4</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h1</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h2</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">snd</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201373750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373750">(Jun 19 2020 at 10:33)</a>:</h4>
<p>Can you please make it a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> ? The code above doesn't compile as it stands.</p>



<a name="201373915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373915">(Jun 19 2020 at 10:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Slow.20Lean/near/201373750">said</a>:</p>
<blockquote>
<p>Can you please make it a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> ? The code above doesn't compile as it stands.</p>
</blockquote>
<p>Done, sorry, I did not include the set import!</p>



<a name="201373976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201373976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201373976">(Jun 19 2020 at 10:36)</a>:</h4>
<p>Thanks. This code takes under a second to compile for me. Did you say something was taking a minute?</p>



<a name="201374017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374017">(Jun 19 2020 at 10:36)</a>:</h4>
<p>Yes but it does compile fast for me as well on a separate file, is it possible that it conflicts with something on my original file?</p>



<a name="201374051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374051">(Jun 19 2020 at 10:37)</a>:</h4>
<p>With <code>set_option profiler true</code> I get</p>
<div class="codehilite"><pre><span></span><code>parsing took 33.7ms
type checking of prod_of_images_eq_image_of_prod took 0.102ms
decl post-processing of prod_of_images_eq_image_of_prod took 0.00224ms
elaboration of prod_of_images_eq_image_of_prod took 798ms
</code></pre></div>


<p>It's hard to help if I cannot easily reproduce the problem at my end.</p>



<a name="201374088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374088">(Jun 19 2020 at 10:37)</a>:</h4>
<p>You ideally need to post some code which enables me to reproduce the problem at my end without any effort on my part -- this is the best way to get help.</p>



<a name="201374188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374188">(Jun 19 2020 at 10:38)</a>:</h4>
<p>If this entails posting 1000 lines of code then you can post it on a gist or other pastey sites</p>



<a name="201374487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374487">(Jun 19 2020 at 10:42)</a>:</h4>
<p>Ok thanks! I will try to understand first on my own as I did not realize it compiled fast on a separate file before sending the code to you and my code uses files downloaded from still-non-approved push-requests so it takes a bit of effort to produce a mwe right now, but I will definitely come back if I do not manage to solve this on my own! Thanks a lot for the help up to now!</p>



<a name="201374622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374622">(Jun 19 2020 at 10:44)</a>:</h4>
<p>Don't underestimate <code>leanproject</code>. If you have 1000 lines of code which compiles only with a non-master branch of mathlib then you can just post the code, say which branch to use, and I can use leanproject to check out the non-master branch oleans.</p>



<a name="201374704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374704">(Jun 19 2020 at 10:45)</a>:</h4>
<p>Even a non-PR'ed branch of mathlib, as long as it's on the leanprover-community version, gets compiled by the system and the oleans get dumped on the azure server.</p>



<a name="201374793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201374793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201374793">(Jun 19 2020 at 10:46)</a>:</h4>
<p>And if you're pushing to a fork of mathlib on github because you don't have push access to non-master branches of mathlib, then you can just ask for access (the advantage of access is precisely that the system makes oleans for everyone; this makes PR reviews much easier for people).</p>



<a name="201375131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201375131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201375131">(Jun 19 2020 at 10:51)</a>:</h4>
<p>Ok I think I managed to create a mwe that compiles extremely slow for me. Here it is</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>

<span class="n">noncomputable</span> <span class="n">theory</span>

<span class="kn">namespace</span> <span class="n">local_homeomorph</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">γ</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">δ</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">γ</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">δ</span><span class="o">]</span>

<span class="kn">lemma</span> <span class="n">prod_symm</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">e&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">γ</span> <span class="n">δ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="bp">=</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">symm</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="bp">.</span><span class="n">symm</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">ext</span> <span class="n">x</span> <span class="o">:</span> <span class="mi">1</span><span class="bp">;</span> <span class="n">simp</span>

<span class="kn">lemma</span> <span class="n">prod_comp</span> <span class="o">{</span><span class="n">η</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">ε</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">η</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">ε</span><span class="o">]</span>
  <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">β</span> <span class="n">γ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">e&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">δ</span> <span class="n">η</span><span class="o">)</span> <span class="o">(</span><span class="n">f&#39;</span> <span class="o">:</span> <span class="n">local_homeomorph</span> <span class="n">η</span> <span class="n">ε</span><span class="o">):</span>
  <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">prod</span> <span class="n">e&#39;</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">prod</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">trans</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">e&#39;</span><span class="bp">.</span><span class="n">trans</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span> <span class="o">:</span> <span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">simp</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">ext</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">rcases</span> <span class="n">y</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">local_equiv</span><span class="bp">.</span><span class="n">trans_source</span><span class="o">],</span>
    <span class="n">tauto</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">times_cont_diff_on</span><span class="bp">.</span><span class="n">general_prod</span> <span class="o">{</span><span class="err">𝕜</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">nondiscrete_normed_field</span> <span class="err">𝕜</span><span class="o">]</span>
<span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">𝕜</span> <span class="n">E</span><span class="o">]</span>
<span class="o">{</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">T</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">𝕜</span> <span class="n">T</span><span class="o">]</span>
<span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">F</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">𝕜</span> <span class="n">F</span><span class="o">]</span>
<span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">𝕜</span> <span class="n">G</span><span class="o">]</span>
<span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">E</span><span class="o">}</span> <span class="o">{</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">T</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">with_top</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">E</span> <span class="bp">→</span> <span class="n">F</span><span class="o">}</span> <span class="o">{</span><span class="n">g</span> <span class="o">:</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">G</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="n">times_cont_diff_on</span> <span class="err">𝕜</span> <span class="n">n</span> <span class="n">f</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">hg</span> <span class="o">:</span> <span class="n">times_cont_diff_on</span> <span class="err">𝕜</span> <span class="n">n</span> <span class="n">g</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">times_cont_diff_on</span> <span class="err">𝕜</span> <span class="n">n</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">E</span> <span class="bp">×</span> <span class="n">T</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">prod</span> <span class="n">s</span> <span class="n">t</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">comp_of_prod_eq_prod_of_comp</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="n">D</span> <span class="bp">→</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">×</span> <span class="n">D</span><span class="o">,</span> <span class="o">(</span><span class="n">h</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">k</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">∘</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">((</span><span class="n">h</span> <span class="err">∘</span> <span class="n">f</span><span class="o">)</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="o">(</span><span class="n">k</span> <span class="err">∘</span> <span class="n">g</span><span class="o">)</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">z</span> <span class="n">h3</span> <span class="n">h4</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="n">exact</span> <span class="bp">⟨</span><span class="n">h1</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span> <span class="n">h2</span> <span class="n">h4</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h1</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h2</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">snd</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
  <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">local_homeomorph</span>
</code></pre></div>


<p>Let me know if you get the same problem!</p>



<a name="201375158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201375158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201375158">(Jun 19 2020 at 10:51)</a>:</h4>
<p>(the lemma is at the end)</p>



<a name="201375737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201375737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201375737">(Jun 19 2020 at 10:59)</a>:</h4>
<p>OK great, <code>prod_of_images_eq_image_of_prod</code> is taking 8 seconds to compile for me according to the profiler, so we have something to work on.</p>



<a name="201375969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201375969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201375969">(Jun 19 2020 at 11:02)</a>:</h4>
<p>It is being caused by the import. The below is slow, but if you change the import to a more primitive one, it is quick.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>
<span class="c1">--import data.set.basic</span>

<span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">z</span> <span class="n">h3</span> <span class="n">h4</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="n">exact</span> <span class="bp">⟨</span><span class="n">h1</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span> <span class="n">h2</span> <span class="n">h4</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="n">simp</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h1</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h2</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">snd</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201375984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201375984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201375984">(Jun 19 2020 at 11:02)</a>:</h4>
<p>The issue will probably be the simplifier.</p>



<a name="201376074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376074">(Jun 19 2020 at 11:03)</a>:</h4>
<p>Using the simplifier in the middle of a proof is not recommended, because its behaviour can change over time, which makes your proofs brittle (you update mathlib and they break).</p>



<a name="201376316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376316">(Jun 19 2020 at 11:07)</a>:</h4>
<p>Yes, it's the simplifier. The much heavier import gave it far more options. You're not closing a goal with it, so maybe it spends a lot of time trying a gazillion simp lemmas before it decides to quit. If you use <code>squeeze_simp</code> instead of <code>simp</code> it will tell you a smaller simp set to use. Here is a fix for your problem, found with <code>squeeze_simp</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">and_imp</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_image</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_prod</span><span class="o">,</span> <span class="n">exists_imp_distrib</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">exists</span><span class="o">],</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">z</span> <span class="n">h3</span> <span class="n">h4</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
    <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="n">exact</span> <span class="bp">⟨</span><span class="n">h1</span><span class="o">,</span> <span class="n">h3</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span> <span class="n">h2</span> <span class="n">h4</span>
  <span class="o">},</span>
  <span class="o">{</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">and_imp</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_image</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_prod</span><span class="o">,</span> <span class="n">exists_imp_distrib</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">exists</span><span class="o">],</span>
    <span class="n">intros</span> <span class="n">y</span> <span class="n">z</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">y</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h1</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
    <span class="o">{</span>
      <span class="n">use</span> <span class="n">z</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h2</span><span class="o">,</span>
      <span class="k">have</span> <span class="n">h4</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="n">prod</span><span class="bp">.</span><span class="n">snd</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">h4</span><span class="o">,</span>
    <span class="o">},</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201376363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376363">(Jun 19 2020 at 11:07)</a>:</h4>
<p>However even this would not be regarded as good practice -- <code>simp</code> is supposed to close goals only.</p>



<a name="201376478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376478">(Jun 19 2020 at 11:09)</a>:</h4>
<p>So you would suggest replacing the <code>simp only</code>s with the lemmas in square brackets and find the good combination that works?</p>



<a name="201376501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376501">(Jun 19 2020 at 11:09)</a>:</h4>
<p>Is this required to PR things on Mathlib?</p>



<a name="201376591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376591">(Jun 19 2020 at 11:10)</a>:</h4>
<p>In any case it is weird that it took 8 seconds for you and more than 20 for me (yet I thought I had a good processor: an Intel i9)</p>



<a name="201376596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376596">(Jun 19 2020 at 11:10)</a>:</h4>
<p>Mathlib would not accept code with non-terminal simps in. If you <em>really</em> want to use a non-terminal simp, then there's an idiom which you can do instead: you run <code>simp</code>, see the new goal, and then write <code>suffices : &lt;new goal&gt;, by simpa using this</code></p>



<a name="201376660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376660">(Jun 19 2020 at 11:11)</a>:</h4>
<p>But my instinct is that a lemma of this size should have a very short proof; I'll see if I can find one for you.</p>



<a name="201376670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376670">(Jun 19 2020 at 11:11)</a>:</h4>
<p>You can tell it's the end of term :D</p>



<a name="201376801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201376801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201376801">(Jun 19 2020 at 11:13)</a>:</h4>
<p>Haha thanks a lot! In if you suggest not using simps in the middle of proof I will just look for a combination of rws that works instead with the lemmas indicated by squeeze simp (it's not that I really want to use simp, but I did not really know what the standard practice was!)</p>



<a name="201377459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201377459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201377459">(Jun 19 2020 at 11:23)</a>:</h4>
<p>Using simp only is ok (no need to express it in terms of rewrites) just not simp on its own.</p>



<a name="201377514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201377514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201377514">(Jun 19 2020 at 11:24)</a>:</h4>
<p>You don't need any simps for this lemma</p>



<a name="201377569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201377569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201377569">(Jun 19 2020 at 11:25)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="bp">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">d</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">hfa</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="o">,</span> <span class="n">hgc</span><span class="bp">⟩⟩</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">[(</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="o">),</span> <span class="bp">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">],</span>
    <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hfa</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hgc</span>
  <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">h</span><span class="bp">⟩⟩</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="o">]</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201378610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201378610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201378610">(Jun 19 2020 at 11:39)</a>:</h4>
<p>or</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="n">set</span><span class="bp">.</span><span class="n">ext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">d</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">hfa</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="o">,</span> <span class="n">hgc</span><span class="bp">⟩⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="o">),</span> <span class="bp">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">ext</span> <span class="n">hfa</span> <span class="n">hgc</span><span class="bp">⟩</span><span class="o">,</span>
 <span class="bp">λ</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">h</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">ext_iff</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="o">,</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">ext_iff</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩⟩⟩</span>
</code></pre></div>


<p>as they'd say in mathlib</p>



<a name="201378652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201378652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201378652">(Jun 19 2020 at 11:39)</a>:</h4>
<p>but here's the coolest proof:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">set</span><span class="bp">.</span><span class="n">basic</span> <span class="n">tactic</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span> <span class="k">by</span> <span class="n">tidy</span>
</code></pre></div>



<a name="201378713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201378713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201378713">(Jun 19 2020 at 11:40)</a>:</h4>
<p>but does it take 8 seconds again?</p>



<a name="201378743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201378743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201378743">(Jun 19 2020 at 11:40)</a>:</h4>
<p>Yeah, that mathlib proof was just the output of <code>squeeze_tidy</code> [note to beginners: squeeze_tidy doesn't exist]</p>



<a name="201378774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201378774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201378774">(Jun 19 2020 at 11:40)</a>:</h4>
<p><code>tidy</code> likes <code>simp * at *</code> as a pretty early move</p>



<a name="201378954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201378954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201378954">(Jun 19 2020 at 11:42)</a>:</h4>
<p>Yes, with <code>tidy</code> the proof time goes up again (to 3.5 seconds) if you import the manifold file.</p>



<a name="201379036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201379036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201379036">(Jun 19 2020 at 11:43)</a>:</h4>
<p><code>tidy?</code> finds</p>
<div class="codehilite"><pre><span></span><code>  <span class="o">:=</span> <span class="k">by</span> <span class="o">{</span><span class="n">ext1</span><span class="o">,</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">intros</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_right</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_left</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_left_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_right_h</span><span class="o">,</span> <span class="n">induction</span> <span class="n">a_right_h_right</span><span class="o">,</span> <span class="n">induction</span> <span class="n">a_left_h_right</span><span class="o">,</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span> <span class="o">}</span> <span class="o">}</span> <span class="o">},</span> <span class="n">intros</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_h_right</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_h_left</span><span class="o">,</span> <span class="n">induction</span> <span class="n">a_h_h_right_right</span><span class="o">,</span> <span class="n">induction</span> <span class="n">a_h_h_right_left</span><span class="o">,</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">refl</span> <span class="o">}</span> <span class="o">},</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">refl</span> <span class="o">}}</span>
</code></pre></div>


<p>which takes about half a second.</p>



<a name="201379141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201379141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201379141">(Jun 19 2020 at 11:45)</a>:</h4>
<p>The mathlib proof is lightning fast even with the import, of course</p>



<a name="201380848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201380848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201380848">(Jun 19 2020 at 12:06)</a>:</h4>
<p>So in fact proving the result with <code>tidy?</code>, posting in the proof, removing the irrelevant <code>dsimp</code> and changing both <code>simp</code>s to <code>squeeze_simp</code> and then <code>simp only</code> cuts the time down to about 150ms, which is pretty respectable.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">real_instances</span>

<span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span> <span class="k">by</span>
<span class="o">{</span> <span class="n">ext1</span><span class="o">,</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">set</span><span class="bp">.</span><span class="n">mem_image</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj_iff</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">prod_mk_mem_set_prod_eq</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">exists</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">fsplit</span><span class="o">,</span>
  <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span>
    <span class="n">intros</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_right</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_left</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_left_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_right_h</span><span class="o">,</span>
    <span class="n">induction</span> <span class="n">a_right_h_right</span><span class="o">,</span> <span class="n">induction</span> <span class="n">a_left_h_right</span><span class="o">,</span>
    <span class="n">fsplit</span><span class="o">,</span>
    <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span>
      <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span>
        <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span>
          <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
        <span class="n">assumption</span> <span class="o">},</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">eq_self_iff_true</span><span class="o">,</span> <span class="n">and_self</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span><span class="o">}</span>
    <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">intros</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_h_right</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_h_left</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">a_h_h_right_right</span><span class="o">,</span> <span class="n">induction</span> <span class="n">a_h_h_right_left</span><span class="o">,</span>
  <span class="n">fsplit</span><span class="o">,</span>
  <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span>
    <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span>
      <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
    <span class="n">refl</span>
    <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span> <span class="n">fsplit</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">refl</span> <span class="o">}}</span>
</code></pre></div>


<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> this is a pretty long proof found by <code>tidy</code> -- pretty neat! Can you do post-processing to make <code>tidy?</code> use <code>simp only</code> instead of <code>simp</code>?</p>



<a name="201382237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201382237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201382237">(Jun 19 2020 at 12:25)</a>:</h4>
<p>How does rintro work?</p>



<a name="201382645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201382645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201382645">(Jun 19 2020 at 12:30)</a>:</h4>
<p><code>rintro</code> is <code>intro</code> and then <code>rcases</code>, and <code>rcases</code> is just iterated <code>cases</code></p>



<a name="201382697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201382697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201382697">(Jun 19 2020 at 12:31)</a>:</h4>
<p>I think it's pretty easy to see what it's doing -- just look at the tactic state before and after the <code>rintro</code>. I am just doing <code>intro</code> and then completely taking everything apart.</p>



<a name="201382868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201382868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201382868">(Jun 19 2020 at 12:33)</a>:</h4>
<p>I'm introing a term of type <code>(b, d) ∈ (f '' s).prod (g '' t)</code> but I don't really want that term, I want witnesses to what's going on, i.e. I want the <code>a \in s</code> such that <code>f a = b</code> etc.</p>



<a name="201383004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383004">(Jun 19 2020 at 12:35)</a>:</h4>
<p>Ok thanks! And just for the records: would <code>tidy</code> be an acceptable proof for Mathlib?</p>



<a name="201383018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383018">(Jun 19 2020 at 12:35)</a>:</h4>
<p><code>rintro ⟨⟨a, ha, hfa⟩, ⟨c, hc, hgc⟩⟩,</code> is the same as</p>
<div class="codehilite"><pre><span></span><code>    <span class="n">intro</span> <span class="n">ac</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">ac</span> <span class="k">with</span> <span class="n">hb</span> <span class="n">hd</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hb</span> <span class="k">with</span> <span class="n">a</span> <span class="n">ha&#39;</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">ha&#39;</span> <span class="k">with</span> <span class="n">ha</span> <span class="n">hfa</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hd</span> <span class="k">with</span> <span class="n">c</span> <span class="n">hc&#39;</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hc&#39;</span> <span class="k">with</span> <span class="n">hc</span> <span class="n">hgc</span><span class="o">,</span>
</code></pre></div>



<a name="201383109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383109">(Jun 19 2020 at 12:36)</a>:</h4>
<p>The question of whether <code>tidy</code> is acceptable for mathlib is a contentious one. The argument for is that it's very clear what's happening -- the proof is "just shuffle everything around and don't really think". The argument against is that it makes mathlib take longer to compile.</p>



<a name="201383348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383348">(Jun 19 2020 at 12:38)</a>:</h4>
<p>The ext1...proof was generated by <code>tidy</code> so in some sense that's the happy medium, especially after I replaced the simp with simp only -- the tidy-generated proof was pretty quick. But because tidy is just doing a bunch of very simple things (it's only using ext and cases and stuff like that) one can often construct a lightning-fast term proof and then argue that it doesn't matter that it's incomprehensible because the proof was trivial anyway so nobody actually wants to read it.</p>



<a name="201383454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383454">(Jun 19 2020 at 12:39)</a>:</h4>
<p>Of course you can just search mathlib for tidy -- there are 288 results, but some of them are in comments.</p>



<a name="201383529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383529">(Jun 19 2020 at 12:40)</a>:</h4>
<p>If you removed some of the things <code>tidy</code> does (mostly <code>simp</code>) it would probably quickly produce a fast proof in this example</p>



<a name="201383543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383543">(Jun 19 2020 at 12:40)</a>:</h4>
<p>In any case, I don't think it is that hard to write a tactic that produces basically your "mathlib mode" proof</p>



<a name="201383605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383605">(Jun 19 2020 at 12:41)</a>:</h4>
<p>That's an interesting point. Note that the majority of times <code>tidy</code> appears is in the category theory part of the repo, where it plays a very important role.</p>



<a name="201383653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383653">(Jun 19 2020 at 12:41)</a>:</h4>
<p>another thing <code>tidy</code> does that is probably useless most of the time is <code>simp ... at *</code></p>



<a name="201383729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383729">(Jun 19 2020 at 12:42)</a>:</h4>
<p>but maybe this isn't that much more expensive than <code>simp ...</code>--I don't know</p>



<a name="201383769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383769">(Jun 19 2020 at 12:42)</a>:</h4>
<p>I mean, in human proofs the <code>at *</code> part is probably used &lt; 10% of the time.</p>



<a name="201383795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383795">(Jun 19 2020 at 12:43)</a>:</h4>
<p>Can we tell tidy not to use simp?</p>



<a name="201383814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383814">(Jun 19 2020 at 12:43)</a>:</h4>
<p>It never occurred to me to use simp when I was constructing the tactic-free proof.</p>



<a name="201383922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201383922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201383922">(Jun 19 2020 at 12:44)</a>:</h4>
<p>I don't think you can easily remove tactics from the list but you can copy <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/tidy.lean#L41-L57">https://github.com/leanprover-community/mathlib/blob/master/src/tactic/tidy.lean#L41-L57</a> and pare it down</p>



<a name="201384158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384158">(Jun 19 2020 at 12:47)</a>:</h4>
<p>dammit stupid tidy doesn't solve it if I remove simp! It can't solve this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">state</span><span class="o">:</span>
<span class="mi">6</span> <span class="n">goals</span>
<span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">,</span>
<span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_3</span><span class="o">,</span>
<span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_4</span><span class="o">,</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">,</span>
<span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">,</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">,</span>
<span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">,</span>
<span class="n">a_w_fst</span> <span class="o">:</span> <span class="n">A</span><span class="o">,</span>
<span class="n">a_w_snd</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span>
<span class="n">a_h_left_left</span> <span class="o">:</span> <span class="o">(</span><span class="n">a_w_fst</span><span class="o">,</span> <span class="n">a_w_snd</span><span class="o">)</span><span class="bp">.</span><span class="n">fst</span> <span class="err">∈</span> <span class="n">s</span><span class="o">,</span>
<span class="n">a_h_left_right</span> <span class="o">:</span> <span class="o">(</span><span class="n">a_w_fst</span><span class="o">,</span> <span class="n">a_w_snd</span><span class="o">)</span><span class="bp">.</span><span class="n">snd</span> <span class="err">∈</span> <span class="n">t</span><span class="o">,</span>
<span class="n">x_snd</span> <span class="o">:</span> <span class="n">D</span><span class="o">,</span>
<span class="n">x_fst</span> <span class="o">:</span> <span class="n">B</span>
<span class="err">⊢</span> <span class="n">A</span>
</code></pre></div>



<a name="201384214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384214">(Jun 19 2020 at 12:47)</a>:</h4>
<p>hey, <code>simp</code> can't solve it either :-/</p>



<a name="201384286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384286">(Jun 19 2020 at 12:48)</a>:</h4>
<p>try changing <code>fsplit</code> to <code>split</code></p>



<a name="201384295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384295">(Jun 19 2020 at 12:48)</a>:</h4>
<p>I'm curious whether this helps</p>



<a name="201384308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384308">(Jun 19 2020 at 12:48)</a>:</h4>
<p><code>  fsplit                                      &gt;&gt; pure "fsplit",</code></p>



<a name="201384330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384330">(Jun 19 2020 at 12:48)</a>:</h4>
<p>Just the one on the left?</p>



<a name="201384346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384346">(Jun 19 2020 at 12:49)</a>:</h4>
<p>well, both if you want the proof output to be accurate</p>



<a name="201384368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384368">(Jun 19 2020 at 12:49)</a>:</h4>
<p>but at least the one on the left yes</p>



<a name="201384385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384385">(Jun 19 2020 at 12:49)</a>:</h4>
<p>Works!</p>



<a name="201384482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384482">(Jun 19 2020 at 12:50)</a>:</h4>
<p>Modded <code>tidy</code> finds</p>
<div class="codehilite"><pre><span></span><code>   <span class="n">ext1</span><span class="o">,</span> <span class="n">cases</span> <span class="n">x</span><span class="o">,</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">intros</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_right</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_left</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_left_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_right_h</span><span class="o">,</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">split</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">2</span> <span class="o">{</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">ext1</span> <span class="o">[]</span> <span class="o">{</span><span class="n">new_goals</span> <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">new_goals</span><span class="bp">.</span><span class="n">all</span><span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">unfold_coes</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">1</span> <span class="o">{</span> <span class="n">unfold_coes</span> <span class="o">}</span> <span class="o">}</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">4</span> <span class="o">{</span> <span class="n">split</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">}</span> <span class="o">},</span> <span class="n">intros</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_w</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a_h_left</span><span class="o">,</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">injections_and_clear</span><span class="o">,</span> <span class="n">assumption</span> <span class="o">}</span> <span class="o">},</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">split</span><span class="o">,</span> <span class="n">work_on_goal</span> <span class="mi">0</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="n">injections_and_clear</span><span class="o">,</span> <span class="n">assumption</span> <span class="o">},</span>
</code></pre></div>



<a name="201384546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384546">(Jun 19 2020 at 12:51)</a>:</h4>
<p>which is compiling in just over 100ms</p>



<a name="201384639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384639">(Jun 19 2020 at 12:51)</a>:</h4>
<p>I'm assuming that adding the manifold import won't change the timing, but of course I'm now orangebaring.</p>



<a name="201384871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384871">(Jun 19 2020 at 12:53)</a>:</h4>
<p>oh rofl the import doesn't compile now :-)</p>



<a name="201384976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201384976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201384976">(Jun 19 2020 at 12:54)</a>:</h4>
<p>oh wait I can roll back the tidy edit :D</p>



<a name="201385243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385243">(Jun 19 2020 at 12:56)</a>:</h4>
<p>yeah bingo, so this is really an instance where the weakened tidy finds a better proof, because it's not allowed to use simp so the import doesn't screw it up. Recall that normal <code>tidy?</code> produces a proof which with the manifold import takes 500ms to compile.</p>



<a name="201385320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385320">(Jun 19 2020 at 12:56)</a>:</h4>
<p>Weakened <code>tidy?</code> produces a proof which takes 100ms to compile with the manifold import.</p>



<a name="201385499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385499">(Jun 19 2020 at 12:58)</a>:</h4>
<p>Sorry again for another low level question: how does <code>rcases</code> work? I can't find its syntax</p>



<a name="201385524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385524">(Jun 19 2020 at 12:58)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#rcases">tactic#rcases</a> ?</p>



<a name="201385554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385554">(Jun 19 2020 at 12:58)</a>:</h4>
<p>I had a story for why <code>split</code> should help over <code>fsplit</code> but now I realize it's not really compatible with the original tidy succeeding with <code>split</code></p>



<a name="201385623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385623">(Jun 19 2020 at 12:59)</a>:</h4>
<p>Ok thanks!</p>



<a name="201385664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385664">(Jun 19 2020 at 12:59)</a>:</h4>
<p>do you mean original tidy succeeding with <code>fsplit</code>?</p>



<a name="201385760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201385760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201385760">(Jun 19 2020 at 13:00)</a>:</h4>
<p>Oh yes, sorry</p>



<a name="201386895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201386895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201386895">(Jun 19 2020 at 13:09)</a>:</h4>
<p>Do you know also a place where I can find an example of <code>rcases</code>? I don't understand the documentation</p>



<a name="201387171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387171">(Jun 19 2020 at 13:11)</a>:</h4>
<p>Well never mind maybe I got it</p>



<a name="201387308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387308">(Jun 19 2020 at 13:12)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">prod_of_images_eq_image_of_prod</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">→</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">C</span><span class="o">):</span>
  <span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">prod</span> <span class="o">(</span><span class="n">g</span> <span class="err">&#39;&#39;</span> <span class="n">t</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">×</span> <span class="n">C</span><span class="o">,</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">g</span> <span class="n">x</span><span class="bp">.</span><span class="n">snd</span><span class="o">))</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="bp">.</span><span class="n">prod</span> <span class="n">t</span>
  <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="bp">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">d</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">temp</span><span class="o">,</span>
    <span class="n">rcases</span> <span class="n">temp</span> <span class="k">with</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">hfa</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="o">,</span> <span class="n">hgc</span><span class="bp">⟩⟩</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">[(</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="o">),</span> <span class="bp">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">],</span>
    <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hfa</span><span class="o">,</span> <span class="n">exact</span> <span class="n">hgc</span>
  <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">c</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">ha</span><span class="o">,</span> <span class="n">hc</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">h</span><span class="bp">⟩⟩</span><span class="o">,</span>
    <span class="n">use</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">hc</span><span class="o">]</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201387339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387339">(Jun 19 2020 at 13:13)</a>:</h4>
<p>Ok thanks!!</p>



<a name="201387485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387485">(Jun 19 2020 at 13:14)</a>:</h4>
<p>When a term is just made up directly of smaller terms, we're just pulling the smaller terms out. For example a term of type <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>f</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x\in f(Y)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span> can be taken apart into a term <code>y : Y</code> and a proof that <code>f y = x</code> (which is another term, in type theory)</p>



<a name="201387692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387692">(Jun 19 2020 at 13:15)</a>:</h4>
<p>The commas in the pointy brackets are right associative, so <code>⟨a, ha, hfa⟩</code> means <code>⟨a, ⟨ha, hfa⟩⟩</code></p>



<a name="201387791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387791">(Jun 19 2020 at 13:16)</a>:</h4>
<p>Look at how I took <code>temp</code> apart with <code>cases</code>, each time turning one term into 2.</p>



<a name="201387846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387846">(Jun 19 2020 at 13:16)</a>:</h4>
<p>It's just some kind of tree, and <code>rcases</code> enables me to take it all apart in one go.</p>



<a name="201387907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201387907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201387907">(Jun 19 2020 at 13:17)</a>:</h4>
<p>(<code>ac</code> = <code>temp</code>)</p>
<div class="codehilite"><pre><span></span><code>    <span class="n">intro</span> <span class="n">ac</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">ac</span> <span class="k">with</span> <span class="n">hb</span> <span class="n">hd</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hb</span> <span class="k">with</span> <span class="n">a</span> <span class="n">ha&#39;</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">ha&#39;</span> <span class="k">with</span> <span class="n">ha</span> <span class="n">hfa</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hd</span> <span class="k">with</span> <span class="n">c</span> <span class="n">hc&#39;</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hc&#39;</span> <span class="k">with</span> <span class="n">hc</span> <span class="n">hgc</span><span class="o">,</span>
</code></pre></div>



<a name="201388012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201388012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201388012">(Jun 19 2020 at 13:18)</a>:</h4>
<p>Everything has only one constructor so there are no <code>|</code>s involved.</p>



<a name="201394694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201394694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201394694">(Jun 19 2020 at 14:07)</a>:</h4>
<p>Ok thank you very much!</p>



<a name="201395011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201395011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201395011">(Jun 19 2020 at 14:10)</a>:</h4>
<p>Moreover I was wondering: as a general strategy, if when doing a proof I need to use simps to make it human, supposing that at the end of the proof I realize the simps can be removed, should I remove them or replace them with the output of squeeze_simp, to leave the proof readable?</p>



<a name="201395096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201395096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201395096">(Jun 19 2020 at 14:10)</a>:</h4>
<p>I mean what is the standard practice in mathlib?</p>



<a name="201395296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201395296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201395296">(Jun 19 2020 at 14:12)</a>:</h4>
<p>Standard practice is to replace a non-terminal simp with the output of squeeze simp.</p>



<a name="201395315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201395315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201395315">(Jun 19 2020 at 14:12)</a>:</h4>
<p>For really basic statements like this, it's better to avoid simp completely if possible</p>



<a name="201395380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201395380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201395380">(Jun 19 2020 at 14:12)</a>:</h4>
<p>If you can write it as a chain of rewrites thats nice, but you'll find a lot of <code>simp only</code> in mathlib.</p>



<a name="201395392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201395392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201395392">(Jun 19 2020 at 14:13)</a>:</h4>
<p>in other words, if the human proof is something like "they're the same", then human readability of the proof is not a factor</p>



<a name="201396174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201396174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201396174">(Jun 19 2020 at 14:19)</a>:</h4>
<p>Ok but I mean what if the simp can be completely removed without replacing them with the output of <code>squeeze_simp</code>? The point is that if I remove them completely, if someone clicks in the middle of my proofs the goal is like 20 lines of incomprehensible symbols</p>



<a name="201396190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201396190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201396190">(Jun 19 2020 at 14:19)</a>:</h4>
<p>But the proof still works</p>



<a name="201396259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201396259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201396259">(Jun 19 2020 at 14:19)</a>:</h4>
<p>Not in the proof of this post I mean, in other proofs</p>



<a name="201398536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201398536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201398536">(Jun 19 2020 at 14:38)</a>:</h4>
<p>What do you mean by completely removed? Presumably simp was doing something that should then be done by another tactic or term?<br>
It depends, for one example: a lot of simp lemmas are proved by <code>rfl</code> and so a combination of lemmas proved in this way might also be provable by <code>rfl</code> instead of <code>simp, refl</code>. Then <code>simp</code> could be removed but <code>refl</code> would have to work harder to reprove all the simp lemmas along the way. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="mi">10</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="err">↑</span><span class="o">(</span><span class="mi">10</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
 <span class="n">refl</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="mi">10</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="err">↑</span><span class="o">(</span><span class="mi">10</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
 <span class="n">simp</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>on my machine the first takes 1.3 s and the second 0.3s, so "removing simp" and replacing it with a more low level tactic in this case is not helpful.</p>



<a name="201398730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201398730" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201398730">(Jun 19 2020 at 14:40)</a>:</h4>
<p>And squeeze simp output  takes 0.07s!</p>



<a name="201399930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Slow%20Lean/near/201399930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Slow.20Lean.html#201399930">(Jun 19 2020 at 14:49)</a>:</h4>
<p>And finally the explicit rw proof <code>rw [nat.cast_bit0, nat.cast_bit1, nat.cast_bit0, nat.cast_one],</code> takes only 9ms, but nobody wants to write that out every time ;) they have a goal like this. <code>norm_num</code> takes about 0.1s and <code>norm_cast</code> roughly the same as simp only.<br>
Of these I'd say the "best" is the tactic specialised to goals like this "norm_cast", it's efficient, short and you are saying what you mean which makes it far more readable than the rw or simps really.<br>
In conclusion use the profiler and experiment and have fun ;)!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>