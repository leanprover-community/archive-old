---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html">rewrite tactic failed, lemma lhs is a metavariable</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="192156408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jiekai <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192156408">(Mar 29 2020 at 04:46)</a>:</h4>
<p>Why is <code>rw ← b_ih_h,</code> here failing? </p>
<div class="codehilite"><pre><span></span>rewrite tactic failed, lemma lhs is a metavariable
state:
a b_n b_ih_w : mynat,
b_ih_h : b_n + succ b_ih_w = a
⊢ a = succ b_n + b_ih_w
</pre></div>



<a name="192156420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192156420">(Mar 29 2020 at 04:47)</a>:</h4>
<p>because rw is stupid</p>



<a name="192156421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192156421">(Mar 29 2020 at 04:47)</a>:</h4>
<p>try <code>rw b_ih_h.symm</code></p>



<a name="192156477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jiekai <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192156477">(Mar 29 2020 at 04:49)</a>:</h4>
<p>Worked! so many tricks</p>



<a name="192156568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192156568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jiekai <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192156568">(Mar 29 2020 at 04:52)</a>:</h4>
<p>What's the difference between <code>symm</code> and <code> ← </code>?</p>



<a name="192164938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192164938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192164938">(Mar 29 2020 at 09:21)</a>:</h4>
<p>In theory, nothing</p>



<a name="192164943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192164943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192164943">(Mar 29 2020 at 09:21)</a>:</h4>
<p>I am surprised the arrow didn't work</p>



<a name="192168915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192168915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192168915">(Mar 29 2020 at 11:12)</a>:</h4>
<p>The reason is because the rewrite tactic is explicitly checking that the lhs is not a variable. The idea here is that if you rewrite with something that matches any term, you will not get a useful result. This check is wrong for two reasons: (1) the variable is not a metavariable, and even if it was that might still be a reasonable thing to do if the type of the variable is constraining enough; and (2) it's always the lhs, not the rhs, even if you use <code>&lt;-</code>.</p>



<a name="192168937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192168937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192168937">(Mar 29 2020 at 11:13)</a>:</h4>
<p>Isn't at least point 2) something that could change in Lean 3.8?</p>



<a name="192169657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192169657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192169657">(Mar 29 2020 at 11:31)</a>:</h4>
<p>both could be fixed in lean 3.8</p>



<a name="192169676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192169676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192169676">(Mar 29 2020 at 11:32)</a>:</h4>
<p>There is nothing wrong with the algorithm, there is just a check that throws an exception. Delete the check and everything else should work</p>



<a name="192169714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192169714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192169714">(Mar 29 2020 at 11:32)</a>:</h4>
<p>I meant that point 2) sounds like a plain <em>bug</em>, whereas point 1) is debatable.</p>



<a name="192170139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192170139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192170139">(Mar 29 2020 at 11:43)</a>:</h4>
<p>I think that the part of 1) about not matching variables that are not metavariables / universally quantified variables is also a bug. For example in the example above, we are rewriting with an equality in the context, which can only match <code>a</code>, not anything else with the same type as <code>a</code></p>



<a name="192170192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/192170192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#192170192">(Mar 29 2020 at 11:44)</a>:</h4>
<p>The only time the error is reasonable is if you are rewriting with <code>\forall x, x = ...</code>, so that the pattern can match any term</p>



<a name="273674115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273674115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amaury Hayat <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273674115">(Mar 01 2022 at 17:05)</a>:</h4>
<p>Hi all ! Is this point still a problem ? I am asking because I had this type of issue for the first time today and only with the rule mul_mul_div: when I try to use</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">real</span><span class="o">)(</span><span class="n">h</span><span class="o">:</span> <span class="n">x</span><span class="bp">≠</span> <span class="mi">0</span><span class="o">)(</span><span class="n">h1</span><span class="o">:</span> <span class="n">y</span><span class="bp">=</span><span class="mi">1</span><span class="o">):</span><span class="n">y</span><span class="bp">*</span><span class="n">x</span><span class="bp">*</span><span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rwa</span> <span class="bp">←</span><span class="n">mul_mul_div</span> <span class="n">_</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>this does not work and gives the message "rewrite tactic failed, lemma lhs is a metavariable" while when I try</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">real</span><span class="o">)(</span><span class="n">h</span><span class="o">:</span> <span class="n">x</span><span class="bp">≠</span> <span class="mi">0</span><span class="o">)(</span><span class="n">h1</span><span class="o">:</span> <span class="n">y</span><span class="bp">=</span><span class="mi">1</span><span class="o">):</span><span class="n">y</span><span class="bp">*</span><span class="n">x</span><span class="bp">*</span><span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rwa</span> <span class="bp">←</span><span class="n">mul_mul_div</span> <span class="n">y</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>it works. Since all other basic rules that I tried in the last months worked well I was wondering whether this is a general issue with rw / I am doing something wrong in this example / this only concerns mul_mul_div (and maybe a few others  that I haven't tried) for some reason ?</p>



<a name="273675525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273675525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273675525">(Mar 01 2022 at 17:12)</a>:</h4>
<p>This is curious -- it shouldn't matter that the LHS is a metavariable since you're rewriting in the reverse direction.</p>
<p>Here's a workaround:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)(</span><span class="n">h</span><span class="o">:</span> <span class="n">x</span><span class="bp">≠</span> <span class="mi">0</span><span class="o">)(</span><span class="n">h1</span><span class="o">:</span> <span class="n">y</span><span class="bp">=</span><span class="mi">1</span><span class="o">):</span><span class="n">y</span><span class="bp">*</span><span class="n">x</span><span class="bp">*</span><span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rwa</span> <span class="o">(</span><span class="n">mul_mul_div</span> <span class="n">_</span> <span class="n">h</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="273676563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273676563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273676563">(Mar 01 2022 at 17:19)</a>:</h4>
<p>Is this a faulty check in <code>rw</code>? That is, it checks whether there are metavariables in the LHS before it actually knows which side of the equality is the LHS?</p>



<a name="273681419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273681419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Amaury Hayat <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273681419">(Mar 01 2022 at 17:47)</a>:</h4>
<p>Thanks for the answer :) Yes, this is curious, and also I tried many basic rules and never had that before...</p>



<a name="273717892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273717892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273717892">(Mar 01 2022 at 22:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> are you aware of this?</p>



<a name="273723971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273723971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273723971">(Mar 01 2022 at 22:54)</a>:</h4>
<p>Is it the case in general that <code>rw</code> never works if you provide <code>_</code> arguments? (assuming they can't somehow be inferred before looking at the rewrite target)</p>



<a name="273725803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273725803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273725803">(Mar 01 2022 at 23:08)</a>:</h4>
<p>No, I definitely made that work before.</p>



<a name="273725816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273725816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273725816">(Mar 01 2022 at 23:08)</a>:</h4>
<p>Yes, I was aware of this and find it mildly amusing</p>



<a name="273725921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273725921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273725921">(Mar 01 2022 at 23:09)</a>:</h4>
<p>I'm not even sure the check is all that useful, rw can totally work even if the pattern is a metavariable</p>



<a name="273725952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273725952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273725952">(Mar 01 2022 at 23:09)</a>:</h4>
<p>it should just match the first subterm which matches the type</p>



<a name="273726140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273726140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273726140">(Mar 01 2022 at 23:11)</a>:</h4>
<p>Oh, I even say as much <a href="#narrow/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable/near/192168915">earlier in this thread</a></p>



<a name="273728585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273728585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273728585">(Mar 01 2022 at 23:35)</a>:</h4>
<p>It looks like it might be an easy fix: <a href="https://github.com/leanprover-community/lean/blob/master/src/library/tactic/rewrite_tactic.cpp#L62">this if block</a> should move two lines up. (Or, if the LHS check is not actually useful, the two lines above could be deleted.)</p>



<a name="273731209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273731209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273731209">(Mar 02 2022 at 00:00)</a>:</h4>
<p>I tried removing the LHS check to see what would happen, and it looks like it's there to give a nicer error message.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">z</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">z</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">h</span><span class="o">,</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">14:3: rewrite tactic failed, did not find instance of the pattern in the target expression</span>
<span class="cm">  ?m_1</span>
<span class="cm">-/</span>
<span class="kd">end</span>
</code></pre></div>
<p>According to a docstring for the pattern matching algorithm (<code>kabstract</code>): "We detect subterms equivalent to \c t using key-matching.<br>
    That is, only perform is_def_eq tests when the head symbol of substerm is equivalent to head symbol of \c t."</p>



<a name="273731424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273731424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273731424">(Mar 02 2022 at 00:00)</a>:</h4>
<p>But backwards rewriting with LHS metavariables works great:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">nat.mul_div_left'</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">m</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">m</span> <span class="bp">/</span> <span class="n">m</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rwa</span> <span class="n">nat.mul_div_left</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">/</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rwa</span> <span class="bp">←</span> <span class="n">nat.mul_div_left'</span> <span class="n">_</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="273734452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273734452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273734452">(Mar 02 2022 at 00:33)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/pull/690">lean#690</a></p>



<a name="273741519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273741519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273741519">(Mar 02 2022 at 01:56)</a>:</h4>
<p>The current behavior encourages us to write lemmas with the simpler dude on the RHS, right?</p>



<a name="273741549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20tactic%20failed%2C%20lemma%20lhs%20is%20a%20metavariable/near/273741549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20tactic.20failed.2C.20lemma.20lhs.20is.20a.20metavariable.html#273741549">(Mar 02 2022 at 01:57)</a>:</h4>
<p>Not that that should mean we leave it broken, but <a href="https://leanprover-community.github.io/mathlib_docs/find/mul_mul_div">docs#mul_mul_div</a> looks backwards to me</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>