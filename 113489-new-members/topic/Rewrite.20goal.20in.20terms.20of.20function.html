---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html">Rewrite goal in terms of function</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="293896715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293896715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julia Ramos Alves <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293896715">(Aug 17 2022 at 13:29)</a>:</h4>
<p>Hello all! I have extracted the following example from  a proof that I am working on:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.fourier</span>
<span class="kn">import</span> <span class="n">measure_theory.integral.interval_integral</span>
<span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">analysis.special_functions.integrals</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">real.pi</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">*</span>
      <span class="bp">∫</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="k">in</span>
        <span class="bp">-</span><span class="n">real.pi..real.pi</span><span class="o">,</span>
        <span class="bp">↑</span><span class="n">x</span> <span class="bp">*</span> <span class="n">complex.exp</span> <span class="o">(</span><span class="bp">-</span><span class="n">complex.I</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">n</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span>
    <span class="o">(</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span> <span class="bp">^</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">complex.I</span> <span class="bp">/</span> <span class="bp">↑</span><span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">u</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">v</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">complex.exp</span> <span class="o">(</span><span class="bp">-</span><span class="n">complex.I</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">complex.I</span><span class="bp">/</span> <span class="n">n</span><span class="o">),</span>
  <span class="k">let</span> <span class="n">u'</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">v'</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">complex.exp</span> <span class="o">(</span><span class="bp">-</span><span class="n">complex.I</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="o">),</span>
<span class="kd">end</span>
</code></pre></div>
<p>My problem is that I want to be able to write the goal in terms of these defined functions, but since they are not iff or eq, then rw does not work for it, how should I approach this? Is there a way to keep these let statements as they are and do this or do I have to turn them into different statements for it to work?</p>



<a name="293897043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293897043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293897043">(Aug 17 2022 at 13:30)</a>:</h4>
<p><code>change</code> (<a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#change">tactic#change</a>) probably works</p>



<a name="293899948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293899948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293899948">(Aug 17 2022 at 13:47)</a>:</h4>
<p>Use <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.interactive.set">docs#tactic.interactive.set</a> instead of <code>let</code>. Then you can specify a name for the hypothesis that <code>u</code>, <code>v</code>, <code>u'</code>, <code>v'</code> are equal to their definition.</p>



<a name="293902509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293902509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julia Ramos Alves <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293902509">(Aug 17 2022 at 14:01)</a>:</h4>
<p>I have tried both of these suggestions but they haven't worked.</p>



<a name="293902600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293902600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293902600">(Aug 17 2022 at 14:01)</a>:</h4>
<p>Can you show me what you tried precisely?</p>



<a name="293903295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293903295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julia Ramos Alves <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293903295">(Aug 17 2022 at 14:05)</a>:</h4>
<p>I wrote</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">set</span> <span class="n">u</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="k">with</span> <span class="n">hu</span><span class="o">,</span>
<span class="n">set</span> <span class="n">v</span><span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">complex.exp</span> <span class="o">(</span><span class="bp">-</span><span class="n">complex.I</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">complex.I</span><span class="bp">/</span> <span class="n">n</span><span class="o">)</span> <span class="k">with</span> <span class="n">hv</span><span class="o">,</span>
</code></pre></div>
<p>instead of the previous first two let statements and also tried a few things like rw v, simp_rw v, rw \l hv, change hv.<br>
I don't know exactly how to make it work.</p>



<a name="293903574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293903574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293903574">(Aug 17 2022 at 14:07)</a>:</h4>
<p>Can you copy-paste the full code block?</p>



<a name="293904305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293904305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293904305">(Aug 17 2022 at 14:11)</a>:</h4>
<p>Have you read the documentation for change that I linked to?</p>



<a name="293904701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293904701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293904701">(Aug 17 2022 at 14:13)</a>:</h4>
<p>I think we have a <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a> problem here: the real question is how to do integration by parts. The answer to that is that you need a</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">has_deriv_at</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span><span class="o">,</span> <span class="n">complex.exp</span> <span class="o">(</span><span class="bp">-</span><span class="n">complex.I</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">complex.I</span><span class="bp">/</span> <span class="n">n</span><span class="o">))</span> <span class="n">complex.exp</span> <span class="o">(</span><span class="bp">-</span><span class="n">complex.I</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span> <span class="gr">sorry</span>
</code></pre></div>
<p>(I haven't checked that code)<br>
the derivative of the coercion:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">analysis.calculus.fderiv</span>
<span class="kn">import</span> <span class="n">analysis.complex.basic</span>
<span class="kn">import</span> <span class="n">analysis.calculus.deriv</span>

<span class="kd">lemma</span> <span class="n">has_fderiv_at_of_real</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_fderiv_at</span> <span class="o">(</span><span class="n">coe</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span> <span class="n">complex.of_real_clm</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">continuous_linear_map.has_fderiv_at</span> <span class="n">complex.of_real_clm</span>

<span class="kd">lemma</span> <span class="n">has_deriv_at_of_real</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_deriv_at</span> <span class="o">(</span><span class="n">coe</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span> <span class="mi">1</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">has_fderiv_at_of_real.has_deriv_at</span>
</code></pre></div>
<p>and with these things you can apply integration by parts without defining the functions by hand</p>



<a name="293905229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293905229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293905229">(Aug 17 2022 at 14:15)</a>:</h4>
<p>btw the last lemma should be in mathlib, right?</p>



<a name="293907778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Rewrite%20goal%20in%20terms%20of%20function/near/293907778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Rewrite.20goal.20in.20terms.20of.20function.html#293907778">(Aug 17 2022 at 14:28)</a>:</h4>
<p>Returning to the original problem, I usually do <code>dsimp only [u]</code> to expand a definition <code>u</code> via <code>let</code> within a proof. These definitions seem to be <code>abbreviation</code>s or at least <code>reducible</code>, because <code>rw</code> sees through them (but <code>split_ifs</code> doesn't, for example), however no equational lemma is generated (similar to <code>abbreviation</code>) so you can't <code>rw u</code> (and <code>unfold</code> and <code>dunfold</code> also don't work).</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>