---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/polynomial.20op_C.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html">polynomial op_C</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="277512699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277512699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277512699">(Apr 02 2022 at 07:24)</a>:</h4>
<p>Dear All,</p>
<p>I am trying to work with <code>mul_opposite</code> and <code>polynomial</code>.  As far as I can see, there is little more in mathlib, besides the equivalence</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">op_ring_equiv</span> <span class="n">R</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">]</span><span class="bp">ᵐᵒᵖ</span> <span class="bp">≃+*</span> <span class="n">R</span><span class="bp">ᵐᵒᵖ</span><span class="o">[</span><span class="n">X</span><span class="o">]</span>
</code></pre></div>
<p>I can get by with the two lemmas below: if my understanding is correct, they should be true.  Can someone either provide a proof, or give a hint as to how to use <code>op_ring_equiv</code> to prove them?</p>
<p>Thanks!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory.polynomial.basic</span>

<span class="n">open_locale</span> <span class="n">polynomial</span>
<span class="kn">open</span> <span class="n">polynomial</span> <span class="n">mul_opposite</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">semiring</span> <span class="n">R</span><span class="o">]</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">mul_opposite.op_C</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">(</span><span class="n">C</span> <span class="n">a</span><span class="o">))</span> <span class="bp">=</span> <span class="n">C</span> <span class="o">(</span><span class="n">op</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">mul_opposite.op_X</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="bp">=</span> <span class="n">X</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="277513505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277513505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277513505">(Apr 02 2022 at 07:44)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.op_ring_equiv">docs#polynomial.op_ring_equiv</a></p>



<a name="277513519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277513519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277513519">(Apr 02 2022 at 07:45)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/add_monoid_algebra.op_ring_equiv_single">docs#add_monoid_algebra.op_ring_equiv_single</a> is basically the proof you want</p>



<a name="277513561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277513561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277513561">(Apr 02 2022 at 07:46)</a>:</h4>
<p>You just need to do the appropriate unfolding to turn polynomial into add_monoid_algebra</p>



<a name="277532048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277532048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277532048">(Apr 02 2022 at 14:16)</a>:</h4>
<p>I spent quite some time trying various combinations of </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">unfold</span> <span class="n">polynomial</span>
<span class="n">unfold</span> <span class="n">op_ring_equiv</span><span class="o">,</span>
<span class="n">unfold</span> <span class="n">add_monoid_algebra.op_ring_equiv</span><span class="o">,</span>
<span class="n">unfold</span> <span class="n">C</span><span class="o">,</span>
<span class="n">unfold</span> <span class="n">monomial</span><span class="o">,</span>
<span class="n">unfold</span> <span class="n">monomial_fun</span><span class="o">,</span>
<span class="n">ext</span><span class="o">,</span>
<span class="n">simp</span><span class="o">,</span>
<span class="n">congr</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">add_monoid_algebra.op_ring_equiv_single</span> <span class="n">a</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">convert</span> <span class="n">add_monoid_algebra.op_ring_equiv_single</span> <span class="n">a</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">add_monoid_algebra.op_ring_equiv_single</span> <span class="mi">0</span> <span class="n">a</span><span class="o">,</span>
<span class="n">convert</span> <span class="n">add_monoid_algebra.op_ring_equiv_single</span> <span class="mi">0</span> <span class="n">a</span><span class="o">,</span>
</code></pre></div>
<p>but (I can say with almost certainly) none of these commands in any order actually works.</p>
<p>I imagine that the proof is just a few characters, but I am having a really hard time figuring out which ones...</p>



<a name="277532919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277532919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277532919">(Apr 02 2022 at 14:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/polynomial.20op_C/near/277513505">said</a>:</p>
<blockquote>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.op_ring_equiv">docs#polynomial.op_ring_equiv</a></p>
</blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/pull/13132">#13132</a> :-)</p>



<a name="277533645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277533645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277533645">(Apr 02 2022 at 14:48)</a>:</h4>
<p>This is harder to do now <code>polynomial</code> is a structure with one field.</p>



<a name="277535796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277535796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277535796">(Apr 02 2022 at 15:30)</a>:</h4>
<p>I feel very silly, but... this does not answer the question, right?</p>
<p>I had not realized the typo in the doc-string, since I had only read the lean code. <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="277536277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277536277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277536277">(Apr 02 2022 at 15:40)</a>:</h4>
<p>Yes, I can't answer the question in just a few characters. I could imagine proving it using <code>ext</code> and checking coefficients but I think Eric has something much smarter in mind. The issue is that we can no longer unfold <code>polynomial</code> into <code>add_monoid_algebra</code> because they're no longer defeq.</p>



<a name="277536309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277536309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277536309">(Apr 02 2022 at 15:41)</a>:</h4>
<p>Ok, for the moment, I am happy with working assuming that the two lemmas that I wrote above are provable.  I can always leave <code>sorry</code>s and go back to them later.</p>



<a name="277536357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277536357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277536357">(Apr 02 2022 at 15:42)</a>:</h4>
<p>Ideally, I would like to know that nat_degree, support, leading_coeff convert "the obvious way" from a polynomial to its <code>op</code>.  I think that I may be able to do the conversion, once those two pieces are in place.</p>



<a name="277536370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277536370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277536370">(Apr 02 2022 at 15:43)</a>:</h4>
<p>(that is, once that <del>bridge</del>gap is closed, then I can make everything fit through the equivalence, or so I hope)</p>



<a name="277539456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277539456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277539456">(Apr 02 2022 at 16:45)</a>:</h4>
<p>I made a start on this, but needed <a href="https://github.com/leanprover-community/mathlib/pull/13139">#13139</a> first</p>



<a name="277540036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277540036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277540036">(Apr 02 2022 at 16:58)</a>:</h4>
<p>It should be possible to just do something like (<a href="https://leanprover-community.github.io/mathlib_docs/find/to_finsupp_iso">docs#to_finsupp_iso</a>)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">apply</span> <span class="n">to_finsupp_iso.injective</span><span class="o">,</span>
<span class="n">clean_up_the_mess</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">the_lemma_i_mentioned_earlier</span>
</code></pre></div>



<a name="277540047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277540047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277540047">(Apr 02 2022 at 16:58)</a>:</h4>
<p>But I can't work out what the intended spelling of <code>clean_up_the_mess</code> is</p>



<a name="277540248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277540248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277540248">(Apr 02 2022 at 17:02)</a>:</h4>
<p>Ok, thanks for the suggestion!  I'm probably not going to look at this today, but I have full proofs of the fact that supports, natdegrees, coeffs, leading coeffs... are what they should be, modulo these two lemmas.</p>



<a name="277547683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277547683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277547683">(Apr 02 2022 at 19:40)</a>:</h4>
<p>Besides failing at proving <code>X = X</code>, this question exposed two typos in doc-strings: the one Kevin opened above and <a href="https://github.com/leanprover-community/mathlib/pull/13144">#13144</a>.</p>



<a name="277698578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277698578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277698578">(Apr 04 2022 at 08:35)</a>:</h4>
<p>As is often the case, once you find a solution to a problem, the problem suddenly appears much easier!  What is below works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">op_monomial</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">(</span><span class="n">monomial</span> <span class="n">n</span> <span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="bp">=</span> <span class="n">monomial</span> <span class="n">n</span> <span class="o">(</span><span class="n">op</span> <span class="n">r</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">op_ring_equiv</span><span class="o">]</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">op_C</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">(</span><span class="n">C</span> <span class="n">a</span><span class="o">))</span> <span class="bp">=</span> <span class="n">C</span> <span class="o">(</span><span class="n">op</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">op_monomial</span> <span class="mi">0</span> <span class="n">a</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">op_X</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">op</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">]))</span> <span class="bp">=</span> <span class="n">X</span> <span class="o">:=</span>
<span class="n">op_monomial</span> <span class="mi">1</span> <span class="mi">1</span>
</code></pre></div>



<a name="277698726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277698726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277698726">(Apr 04 2022 at 08:36)</a>:</h4>
<p>The first <code>by simp [op_ring_equiv]</code> squeezes to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">op_ring_equiv</span><span class="o">,</span> <span class="n">ring_equiv.trans_apply</span><span class="o">,</span> <span class="n">ring_equiv.op_apply_apply</span><span class="o">,</span>
  <span class="n">ring_equiv.to_add_equiv_eq_coe</span><span class="o">,</span> <span class="n">add_equiv.mul_op_apply</span><span class="o">,</span> <span class="n">add_equiv.to_fun_eq_coe</span><span class="o">,</span>
  <span class="n">add_equiv.coe_trans</span><span class="o">,</span> <span class="n">op_add_equiv_apply</span><span class="o">,</span> <span class="n">ring_equiv.coe_to_add_equiv</span><span class="o">,</span> <span class="n">op_add_equiv_symm_apply</span><span class="o">,</span>
  <span class="n">function.comp_app</span><span class="o">,</span> <span class="n">unop_op</span><span class="o">,</span> <span class="n">to_finsupp_iso_monomial</span><span class="o">,</span> <span class="n">add_monoid_algebra.op_ring_equiv_single</span><span class="o">,</span>
  <span class="n">to_finsupp_iso_symm_single</span><span class="o">]</span>
</code></pre></div>
<p>No wonder there were lots of wring turns that I was taking!</p>



<a name="277700830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277700830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277700830">(Apr 04 2022 at 08:54)</a>:</h4>
<p>I am thinking of making a PR with the lemmas above and also </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">coeff_op</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span> <span class="o">(</span><span class="n">mul_opposite.op</span> <span class="n">p</span><span class="o">))</span><span class="bp">.</span><span class="n">coeff</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">mul_opposite.op</span> <span class="o">(</span><span class="n">p.coeff</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="gr">sorry</span>

 <span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">support_op</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span> <span class="o">(</span><span class="n">op</span> <span class="n">p</span><span class="o">))</span><span class="bp">.</span><span class="n">support</span> <span class="bp">=</span> <span class="n">p.support</span> <span class="o">:=</span> <span class="gr">sorry</span>

 <span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">nat_degree_op</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span> <span class="o">(</span><span class="n">op</span> <span class="n">p</span><span class="o">))</span><span class="bp">.</span><span class="n">nat_degree</span> <span class="bp">=</span> <span class="n">p.nat_degree</span> <span class="o">:=</span> <span class="gr">sorry</span>

 <span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">leading_coeff_op</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">])</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span> <span class="o">(</span><span class="n">op</span> <span class="n">p</span><span class="o">))</span><span class="bp">.</span><span class="n">leading_coeff</span> <span class="bp">=</span> <span class="n">op</span> <span class="n">p.leading_coeff</span> <span class="o">:=</span>
</code></pre></div>
<p>Assuming this seems like a good idea, what should the namespaces for these lemmas be?  <code>polynomial</code> for dot-notation?  Should <code>mul_opposite</code> or <code>op_ring_equiv</code> appear somewhere?</p>
<p>Thanks!</p>



<a name="277703396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703396">(Apr 04 2022 at 09:14)</a>:</h4>
<p>Those look useful. And yes, I would go for <code>namespace polynomial</code>.</p>



<a name="277703525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703525">(Apr 04 2022 at 09:15)</a>:</h4>
<p>Thanks!  I'm preparing a PR.  I am thinking of starting a new file <code>ring_theory.polynomial.opposites</code>.  The <code>polynomial</code> files tend to be big and slow, and probably not often people need opposites, when working with polynomials.</p>
<p>Does this sound reasonable?</p>



<a name="277703698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703698">(Apr 04 2022 at 09:17)</a>:</h4>
<p>I think they should be called <code>coeff_op_ring_equiv</code>, and be stated without the <code>op</code> on the LHS by changing the type of <code>p</code></p>



<a name="277703705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703705">(Apr 04 2022 at 09:17)</a>:</h4>
<p>But those lemmas look good to me</p>



<a name="277703731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703731">(Apr 04 2022 at 09:17)</a>:</h4>
<p>Also, in the context of this PR, <code>op (a * b)</code> converts to <code>op b * op a</code>.  However, it would make more sense to have <code>op (C a * X ^ n)</code> convert to <code>(C (op a) * X ^ n</code>.  Is there a way to instruct <code>simp</code> to use a different lemma than the "obvious" one?</p>



<a name="277703737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703737">(Apr 04 2022 at 09:17)</a>:</h4>
<p>If you do that, I think <code>op_ring_equiv</code> should move to that file</p>



<a name="277703846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703846">(Apr 04 2022 at 09:18)</a>:</h4>
<p>We could add a simp lemma that sends <code>X ^ n * C</code> to <code>C * X ^ n</code>?</p>



<a name="277703859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703859">(Apr 04 2022 at 09:18)</a>:</h4>
<p>We already have <a href="https://leanprover-community.github.io/mathlib_docs/find/polynomial.X_pow_mul">docs#polynomial.X_pow_mul</a>, but that's not safe as a simp lemma</p>



<a name="277703867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703867">(Apr 04 2022 at 09:18)</a>:</h4>
<p>The lemma already exists.</p>



<a name="277703884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703884">(Apr 04 2022 at 09:18)</a>:</h4>
<p>Not specialized to <code>C</code>, does it?</p>



<a name="277703906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703906">(Apr 04 2022 at 09:19)</a>:</h4>
<p>Ah, I see your point!</p>



<a name="277703919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703919">(Apr 04 2022 at 09:19)</a>:</h4>
<p>I will also add this lemma, then.  Though to a more basic file.</p>



<a name="277703920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703920">(Apr 04 2022 at 09:19)</a>:</h4>
<p>The idea with specializing to <code>C</code> is that it becomes a valid simp lemma that doesn't loop on <code>X ^ n * X ^ n</code></p>



<a name="277703965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277703965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277703965">(Apr 04 2022 at 09:19)</a>:</h4>
<p>Note that I just finished off my polynomial refactor in <a href="https://github.com/leanprover-community/mathlib/pull/13139">#13139</a>, which will likely upset some calls to <code>simp</code> in your code if it gets merged</p>



<a name="277704080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277704080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277704080">(Apr 04 2022 at 09:20)</a>:</h4>
<p>Thanks for the heads up!  However, having learned that <code>monomial</code> is a much more stable spelling of <code>C a * X ^ n</code>, I am confident that it will be easy to fix the first lemma and all the other ones follow from it.</p>



<a name="277705148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277705148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277705148">(Apr 04 2022 at 09:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/polynomial.20op_C/near/277703698">said</a>:</p>
<blockquote>
<p>I think they should be called <code>coeff_op_ring_equiv</code>, and be stated without the <code>op</code> on the LHS by changing the type of <code>p</code></p>
</blockquote>
<p>I thought that I understood this comment, but is what is below what you had in mind?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">coeff_op_ring_equiv</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">R</span><span class="o">[</span><span class="n">X</span><span class="o">]</span><span class="bp">ᵐᵒᵖ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">op_ring_equiv</span> <span class="n">R</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">coeff</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">op</span> <span class="o">((</span><span class="n">unop</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">coeff</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>



<a name="277713941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277713941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277713941">(Apr 04 2022 at 10:59)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/13162">#13162</a></p>
<p>It seems that no file used <code>polynomial.op_ring_equiv</code>, so I simply moved the definition to a new file and placed there also the lemmas above.</p>
<p>I will see if CI finds a hidden use of <code>op_ring_equiv</code> somewhere.</p>



<a name="277715418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/polynomial%20op_C/near/277715418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/polynomial.20op_C.html#277715418">(Apr 04 2022 at 11:15)</a>:</h4>
<p>I also PRed the <code>simp</code> version of <code>X_mul</code> and <code>X_pow_mul</code>: <a href="https://github.com/leanprover-community/mathlib/pull/13163">#13163</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>