---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html">rewrite h at {1,3}</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="243626509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243626509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243626509">(Jun 23 2021 at 09:26)</a>:</h4>
<p>What's the notation to use with the rewrite tactic to control which instances within the goal statement get rewritten?  I was working from an old version of Avigad et al.'s "Theorem Proving in Lean" tutorial (Chapter 11) which says that "For example, rewrite t at {1, 3} specifies that only the first and third occurrences should be replaced", but I can't get this to work (I'm using a fresh install of VSCode, and I've also tried it at <a href="https://leanprover.github.io/live/latest/">https://leanprover.github.io/live/latest/</a>)</p>
<p>Has this notation been deprecated?  Is there an alternative notation to achieve the same effect?</p>



<a name="243626665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243626665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243626665">(Jun 23 2021 at 09:28)</a>:</h4>
<p>Example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rw</span> <span class="o">[</span><span class="n">hm</span><span class="o">]</span> <span class="o">{</span><span class="n">occs</span> <span class="o">:=</span> <span class="n">occurrences.pos</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]},</span>
</code></pre></div>



<a name="243626912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243626912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243626912">(Jun 23 2021 at 09:31)</a>:</h4>
<p>Ah, great, thanks!  Is this already in the documentation somewhere that I missed?</p>



<a name="243626939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243626939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243626939">(Jun 23 2021 at 09:31)</a>:</h4>
<p>I don't know...</p>



<a name="243632017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243632017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243632017">(Jun 23 2021 at 10:24)</a>:</h4>
<p>I think <code>nth_rewrite</code> tends to get used instead of <code>occs</code>? There was some weird bugs, iirc</p>



<a name="243735790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243735790" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243735790">(Jun 24 2021 at 02:37)</a>:</h4>
<p><code>occs</code> only replaces <em>different</em> instantiations of the pattern you're rewriting by. If the exact subexpression appears multiple times, you'll need to use <code>nth_rewrite</code>.</p>



<a name="243752306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243752306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243752306">(Jun 24 2021 at 07:53)</a>:</h4>
<p>In the example I was looking at we have a term <code>H1 : a = b</code> and the goal is <code>f a a a = 0</code>, and using <code>rewrite [H1] {occs := occurrences.pos [1,3]}</code> successfully re-writes the goal to <code>f b a b = 0</code> as intended.  So I'm not clear on what you mean by "different instantiations" vs "exact subexpression".  Isn't this a case where we have the exact subexpression <code>a</code> appearing multiple times?</p>



<a name="243895322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243895322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243895322">(Jun 25 2021 at 09:52)</a>:</h4>
<p>When you have a rewrite that can be instatiated (like an equality within a forall statement) rewrite occs first picks the instantiation then applies to the occurences, does experimenting with this example help?:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">âˆ€</span> <span class="n">n</span><span class="o">,</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">2</span><span class="bp">*</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">37</span> <span class="o">:=</span>
<span class="kd">begin</span>
<span class="c1">--nth_rewrite 0 h, -- rewrites the first 1+ 1 = 2*1</span>
<span class="c1">--nth_rewrite 1 h, -- rewrites 2 + 2 = 2*2</span>
<span class="n">rewrite</span> <span class="o">[</span><span class="n">h</span><span class="o">]</span> <span class="o">{</span><span class="n">occs</span> <span class="o">:=</span> <span class="n">occurrences.pos</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]},</span> <span class="c1">-- this doesn't rewrite 2 + 2 = 2*2 we have to do rw [h 2] to do so somehow.</span>
<span class="kd">end</span>
</code></pre></div>



<a name="243907791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243907791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243907791">(Jun 25 2021 at 12:21)</a>:</h4>
<p>Ah, yes, I get it now!  Thanks very much for this explanation.</p>



<a name="243909227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243909227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243909227">(Jun 25 2021 at 12:34)</a>:</h4>
<p>At least, I think I get it.  Does <code>rewrite [h] {occs := occurrences.pos [...]}</code>always grab the first thing that matches (in this case, matching <code>n</code> to <code>1</code>)?  And then our choice of what to put in the square brackets after <code>pos</code> governs which occurrences of that thing (in this case, which occurrences of <code>1+1</code>) to replace.  If I've got that right, is there any way to force it to grab the second match instead (matching <code>n</code> with <code>2</code>)?  Or is it best just to give up on <code>occs</code> altogether and always just use <code>nth_rewrite</code> instead (which I guess is what Scott was saying yesterday)?</p>



<a name="243909839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243909839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243909839">(Jun 25 2021 at 12:41)</a>:</h4>
<p>If <code>nth_rewrite</code> works, I would go with that. At some point is was a bit buggy for me. But maybe that has been fixed in the mean time.</p>



<a name="243939218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20h%20at%20%7B1%2C3%7D/near/243939218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20h.20at.20.7B1.2C3.7D.html#243939218">(Jun 25 2021 at 16:29)</a>:</h4>
<p>Thanks!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>