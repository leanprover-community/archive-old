---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/mul_right_comm_monoid.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html">mul_right_comm_monoid</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="233817352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233817352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233817352">(Apr 09 2021 at 13:08)</a>:</h4>
<p>I could not find the instances below: am I missing some import?  Does it make sense to PR it?  Or should the solution be to have only a single <code>cancel_comm_monoid</code> class, instead of <code>cancel_left_comm_monoid</code>,<code>cancel_right_comm_monoid</code> and <code>cancel_comm_monoid</code>, with crossed instances relating them?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">right_of_left</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">right_cancel_comm_monoid</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul_right_cancel</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">ac</span><span class="o">,</span> <span class="kd">begin</span>
  <span class="n">repeat</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">_</span> <span class="n">b</span> <span class="n">at</span> <span class="n">ac</span><span class="o">},</span>
  <span class="n">exact</span> <span class="n">mul_left_cancel</span> <span class="n">ac</span><span class="o">,</span>
 <span class="kd">end</span><span class="o">,</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>

<span class="kd">instance</span> <span class="n">left_of_right</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">right_cancel_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">left_cancel_comm_monoid</span> <span class="n">R</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">apply_instance</span>  <span class="c1">-- fails</span>
</code></pre></div>



<a name="233818907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233818907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233818907">(Apr 09 2021 at 13:18)</a>:</h4>
<p>Here are a bunch of (missing?/unneeded) instances:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>

<span class="kd">instance</span> <span class="n">right_of_left</span> <span class="o">[</span><span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">right_cancel_comm_monoid</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul_right_cancel</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">ac</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">repeat</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">_</span> <span class="n">b</span> <span class="n">at</span> <span class="n">ac</span><span class="o">},</span> <span class="n">exact</span> <span class="n">mul_left_cancel</span> <span class="n">ac</span> <span class="o">},</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>

<span class="kd">instance</span> <span class="n">left_of_right</span> <span class="o">[</span><span class="n">right_cancel_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">left_cancel_comm_monoid</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul_left_cancel</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">bc</span><span class="o">,</span> <span class="kd">by</span> <span class="o">{</span> <span class="n">repeat</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">a</span> <span class="n">at</span> <span class="n">bc</span><span class="o">},</span> <span class="n">exact</span> <span class="n">mul_right_cancel</span> <span class="n">bc</span> <span class="o">},</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">right_cancel_comm_monoid</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>

<span class="kd">instance</span> <span class="n">cancel_of_left</span> <span class="o">[</span><span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">cancel_comm_monoid</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">),</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">right_cancel_comm_monoid</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>

<span class="kd">instance</span> <span class="n">cancel_of_right</span> <span class="o">[</span><span class="n">right_cancel_comm_monoid</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">cancel_comm_monoid</span> <span class="n">R</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">left_cancel_comm_monoid</span> <span class="n">R</span><span class="o">),</span>
  <span class="bp">..</span><span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">right_cancel_comm_monoid</span> <span class="n">R</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>



<a name="233819350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233819350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233819350">(Apr 09 2021 at 13:21)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/left_cancel_comm_monoid">docs#left_cancel_comm_monoid</a>, for the lazy like me</p>



<a name="233819496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233819496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233819496">(Apr 09 2021 at 13:22)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/left_cancel_comm_monoid">docs#left_cancel_comm_monoid</a>  ← Sorry, simply my attempt at seeing how to generate the link!</p>



<a name="233819936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233819936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233819936">(Apr 09 2021 at 13:24)</a>:</h4>
<p>Unless there is a reason for preferring these typeclasses, I would opt for having a single <code>cancel_comm_monoid</code> typeclass, with "asymmetric" fields, choosing, say, <code>mul_left_cancel</code>.</p>



<a name="233819985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233819985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233819985">(Apr 09 2021 at 13:25)</a>:</h4>
<p>And, if such a thing exist, also <code>cancel_semigroup</code>...</p>



<a name="233819992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233819992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233819992">(Apr 09 2021 at 13:25)</a>:</h4>
<p>Looks like they were added in <a href="https://github.com/leanprover-community/mathlib/issues/3688">#3688</a> and we didn't realize <code>left</code> + <code>comm</code> is exactly the same as <code>right</code> + <code>comm</code>.</p>



<a name="233820045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820045">(Apr 09 2021 at 13:25)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/left_cancel_comm_semigroup">docs#left_cancel_comm_semigroup</a> may not exist...</p>



<a name="233820105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820105">(Apr 09 2021 at 13:26)</a>:</h4>
<p>So yes, defining <code>cancel_comm_monoid extends left_cancel_monoid, comm_monoid</code> and then proving <code>right_cancel</code> as well, looks like the best option.</p>



<a name="233820218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820218">(Apr 09 2021 at 13:26)</a>:</h4>
<p>(i.e. provide instances <code>cancel_comm_monoid.to_right_cancel_monoid</code> and <code>cancel_comm_monoid.to_cancel_monoid</code>.)</p>



<a name="233820324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820324">(Apr 09 2021 at 13:27)</a>:</h4>
<p>Actually, judging from the number of instances, let's promote <code>right_cancel_comm_monoid</code> to be the one true typeclass.</p>



<a name="233820339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820339">(Apr 09 2021 at 13:27)</a>:</h4>
<p>...and there are the <code>add</code> versions as well.</p>



<a name="233820598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820598">(Apr 09 2021 at 13:29)</a>:</h4>
<p>Unfortunately <code>@[to_additive]</code> can't autogenerate structures (like typeclasses), so we have to write out the class twice :(</p>



<a name="233820606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820606">(Apr 09 2021 at 13:29)</a>:</h4>
<p>for the left version, there is this comment in the code:<br>
-- TODO: I found 1 (one) lemma assuming <code>[add_left_cancel_monoid]</code>.<br>
-- Should we port more lemmas to this typeclass?<br>
I guess that I am going to be the one taking, at least in part, this to completion!</p>



<a name="233820650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820650">(Apr 09 2021 at 13:29)</a>:</h4>
<p>Anne, or rather, in this case, remove them twice!  <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="233820941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233820941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233820941">(Apr 09 2021 at 13:31)</a>:</h4>
<p>Ok, so I am going to keep the <code>right_comm</code> code, except that I remove the word <code>right</code> from it.  Then, I change the <code>left_comm</code> classes to instance, correct?</p>



<a name="233821127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821127">(Apr 09 2021 at 13:32)</a>:</h4>
<p>Finally, I remove what is now <code>comm</code> with no indication of <code>left/right</code>.</p>
<p>From a procedural point of view, I would begin with removing the <code>comm</code> [no left/right], then promote <code>right_comm</code> to <code>comm</code> only and finally instance the <code>left</code>.</p>



<a name="233821137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821137">(Apr 09 2021 at 13:32)</a>:</h4>
<p>Sounds good. Don't we have <a href="https://leanprover-community.github.io/mathlib_docs/find/cancel_comm_monoid">docs#cancel_comm_monoid</a> already?</p>



<a name="233821239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821239">(Apr 09 2021 at 13:33)</a>:</h4>
<p>Yes, but it extends both.  Ah, I could make it extend only right, erase right and instance left.  This is simpler, you are right!</p>



<a name="233821247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821247">(Apr 09 2021 at 13:33)</a>:</h4>
<p>So make sure that the "new" <code>cancel_comm_monoid</code> has the same lemmas and instances as the "old" <code>cancel_comm_monoid</code>.</p>



<a name="233821358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821358">(Apr 09 2021 at 13:34)</a>:</h4>
<p>I will get down to it!  I am sure that lean will let me know if I mess something up...</p>



<a name="233821568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821568">(Apr 09 2021 at 13:35)</a>:</h4>
<p>What does <code>ancestor</code> mean below?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[protect_proj, ancestor add_left_cancel_comm_monoid add_right_cancel_comm_monoid]</span>
<span class="kd">class</span> <span class="n">add_cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
  <span class="kd">extends</span> <span class="n">add_left_cancel_comm_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_right_cancel_comm_monoid</span> <span class="n">M</span>
</code></pre></div>
<p>Should this become </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[protect_proj, ancestor add_right_cancel_comm_monoid]</span>
<span class="kd">class</span> <span class="n">add_cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
  <span class="kd">extends</span> <span class="n">add_right_cancel_comm_monoid</span> <span class="n">M</span>
</code></pre></div>



<a name="233821981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233821981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233821981">(Apr 09 2021 at 13:38)</a>:</h4>
<p>I am not exactly sure to be honest! I think <code>protect_proj</code> will give the <code>protected</code> attribute to the fields of the structure (so that <code>cancel_comm_monoid.mul</code> doesn't become <code>mul</code> when the <code>cancel_comm_monoid</code> namespace is open).</p>



<a name="233822201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233822201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233822201">(Apr 09 2021 at 13:39)</a>:</h4>
<p>And <code>ancestor</code> is used by the <code>subtype_instance</code> tactic to copy over fields, it looks like. So just copy over what comes after the <code>extends</code>.</p>



<a name="233822333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233822333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233822333">(Apr 09 2021 at 13:40)</a>:</h4>
<p>So <code>add_cancel_comm_monoid</code> would look something like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[protect_proj, ancestor add_comm_monoid add_right_cancel_monoid]</span>
<span class="kd">class</span> <span class="n">add_cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
  <span class="kd">extends</span> <span class="n">add_comm_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_right_cancel_monoid</span> <span class="n">M</span>
</code></pre></div>



<a name="233823359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233823359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233823359">(Apr 09 2021 at 13:47)</a>:</h4>
<p>Hence, the <code>ancestor</code> thing will be "forgotten" in the <code>instance</code> from <code>cancel_comm</code> to <code>cancel_left</code>, right?</p>



<a name="233823641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233823641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233823641">(Apr 09 2021 at 13:48)</a>:</h4>
<p>Yes, it is just to keep track of which fields to copy and which ones to add when declaring a new instance via tactics.</p>



<a name="233824288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233824288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233824288">(Apr 09 2021 at 13:52)</a>:</h4>
<p>Why not extend both but fill out the redundant axiom with opt_param?</p>



<a name="233824987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233824987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233824987">(Apr 09 2021 at 13:56)</a>:</h4>
<p>What does opt_param mean?</p>



<a name="233825221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233825221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233825221">(Apr 09 2021 at 13:58)</a>:</h4>
<p>I think <a href="https://leanprover-community.github.io/mathlib_docs/find/preorder/src">src#preorder</a> has an example</p>



<a name="233825350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233825350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233825350">(Apr 09 2021 at 13:59)</a>:</h4>
<p>The <code>(lt := ...)</code> parameter fills that field automatically</p>



<a name="233825391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233825391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233825391">(Apr 09 2021 at 13:59)</a>:</h4>
<p>I had seen this and I remember having been happy that it "just worked".  I guess that now is my time to make it "just work", right?  <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="233825676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233825676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233825676">(Apr 09 2021 at 14:01)</a>:</h4>
<p>also, when I do this</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Commutative version of cancel_monoid. -/</span>
<span class="kd">@[protect_proj, ancestor right_cancel_monoid left_cancel_monoid comm_monoid, to_additive add_cancel_comm_monoid]</span>
<span class="kd">class</span> <span class="n">cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span>
  <span class="n">left_cancel_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">right_cancel_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">comm_monoid</span> <span class="n">M</span>
</code></pre></div>
<p><code>class</code> complains:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Failed</span> <span class="n">to</span> <span class="n">map</span> <span class="n">fields</span> <span class="n">of</span> <span class="n">cancel_comm_monoid</span>
</code></pre></div>



<a name="233825953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233825953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233825953">(Apr 09 2021 at 14:02)</a>:</h4>
<p>This disappears, though, if I remove the line with <code>@</code></p>



<a name="233827535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233827535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233827535">(Apr 09 2021 at 14:12)</a>:</h4>
<p>In fact, simply erasing <code>to_additive add_cancel_comm_monoid</code> is enough to make the error go away.</p>



<a name="233827735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233827735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233827735">(Apr 09 2021 at 14:13)</a>:</h4>
<p>Since the class just above <code>cancel_comm_monoid</code> is <code>add_cancel_comm_monoid</code>, maybe the <code>to_additive</code> is not needed?  I would have guessed that <code>to_additive</code> would have created exactly the class that is defined above, right?</p>



<a name="233827816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233827816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233827816">(Apr 09 2021 at 14:13)</a>:</h4>
<p>Ah, Anne said that <code>to_additive</code> does not work with classes...</p>



<a name="233827871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233827871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233827871">(Apr 09 2021 at 14:14)</a>:</h4>
<p>So, I probably need it, but I am not able to make it work.</p>



<a name="233828548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233828548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233828548">(Apr 09 2021 at 14:18)</a>:</h4>
<p>Sorry about the noise: I think that I am making progress!  Ignore the previous comments, for the moment!</p>



<a name="233830391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830391">(Apr 09 2021 at 14:29)</a>:</h4>
<p>You need to add the <code>to_additive</code> after the class</p>



<a name="233830422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830422">(Apr 09 2021 at 14:30)</a>:</h4>
<p>If the proof of an <code>instance</code> is <code>by apply_instance</code>, then that <code>instance</code> is not needed, correct?</p>
<p>This means that I will want to prove instances <code>[left_cancel] + [comm] =&gt; [cancel] + [comm]</code> and similarly for <code>right</code> and then same again for <code>add</code>.</p>



<a name="233830579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830579">(Apr 09 2021 at 14:30)</a>:</h4>
<p>Those don't sound like they should be instances</p>



<a name="233830591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830591">(Apr 09 2021 at 14:30)</a>:</h4>
<p>they will loop</p>



<a name="233830683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830683">(Apr 09 2021 at 14:31)</a>:</h4>
<p>Mario, right now, this works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Commutative version of add_cancel_monoid. -/</span>
<span class="kd">@[protect_proj, ancestor add_right_cancel_monoid add_left_cancel_monoid add_comm_monoid]</span>
<span class="kd">class</span> <span class="n">add_cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span>
  <span class="n">add_right_cancel_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_left_cancel_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_comm_monoid</span> <span class="n">M</span>

<span class="sd">/-- Commutative version of cancel_monoid. -/</span>
<span class="kd">@[protect_proj, ancestor right_cancel_monoid left_cancel_monoid comm_monoid,</span>
<span class="kd">  to_additive add_cancel_comm_monoid]</span>
<span class="kd">class</span> <span class="n">cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span>
  <span class="n">right_cancel_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">left_cancel_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">comm_monoid</span> <span class="n">M</span>

<span class="sd">/-- An add_cancel_comm_monoid. -/</span>
<span class="kd">instance</span> <span class="n">add_left_cancel_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">add_cancel_comm_monoid</span> <span class="n">M</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">add_left_cancel_monoid</span> <span class="n">M</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">apply_instance</span>
</code></pre></div>
<p>I imagine that the last instance can be removed.  Is the rest looking good?</p>



<a name="233830814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830814">(Apr 09 2021 at 14:32)</a>:</h4>
<p>Don't put <code>to_additive</code> on the class definition</p>



<a name="233830842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830842">(Apr 09 2021 at 14:32)</a>:</h4>
<p>Why not on the class definition?</p>



<a name="233830852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830852">(Apr 09 2021 at 14:32)</a>:</h4>
<p>Ok, no <code>instances [left_cancel] + [comm] =&gt; [cancel] + [comm]</code>.  Should there be defs instead?  Or simply not there at all?</p>



<a name="233830855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830855">(Apr 09 2021 at 14:32)</a>:</h4>
<p>Don't we do that everywhere?</p>



<a name="233830901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830901">(Apr 09 2021 at 14:32)</a>:</h4>
<p>It has to be done after the definition of the class</p>



<a name="233830997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233830997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233830997">(Apr 09 2021 at 14:32)</a>:</h4>
<p>I copied the <code>to_additive</code> adapting what was already there.  Still, I am happy to keep it or remove it, as needed-</p>



<a name="233831054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831054">(Apr 09 2021 at 14:33)</a>:</h4>
<p>although maybe my info is out of date, it used to be a lot more annoying</p>



<a name="233831085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831085">(Apr 09 2021 at 14:33)</a>:</h4>
<p>Are you sure? I thought that's just because you can't put <code>to_additive</code> on the <code>mul</code> version until the add version is defined</p>



<a name="233831116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831116">(Apr 09 2021 at 14:33)</a>:</h4>
<p>And for some reason lots of files define the add version after the mul version</p>



<a name="233831151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831151" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831151">(Apr 09 2021 at 14:33)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- A `group` is a `monoid` with an operation `⁻¹` satisfying `a⁻¹ * a = 1`.</span>

<span class="sd">There is also a division operation `/` such that `a / b = a * b⁻¹`,</span>
<span class="sd">with a default so that `a / b = a * b⁻¹` holds by definition.</span>
<span class="sd">-/</span>
<span class="kd">@[protect_proj, ancestor div_inv_monoid]</span>
<span class="kd">class</span> <span class="n">group</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">div_inv_monoid</span> <span class="n">G</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">mul_left_inv</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="sd">/-- An `add_group` is an `add_monoid` with a unary `-` satisfying `-a + a = 0`.</span>

<span class="sd">There is also a binary operation `-` such that `a - b = a + -b`,</span>
<span class="sd">with a default so that `a - b = a + -b` holds by definition.</span>
<span class="sd">-/</span>
<span class="kd">@[protect_proj, ancestor sub_neg_monoid]</span>
<span class="kd">class</span> <span class="n">add_group</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">sub_neg_monoid</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">add_left_neg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">,</span> <span class="bp">-</span><span class="n">a</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span><span class="o">]</span> <span class="n">group</span>
</code></pre></div>



<a name="233831156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831156">(Apr 09 2021 at 14:33)</a>:</h4>
<p>like this</p>



<a name="233831219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831219">(Apr 09 2021 at 14:34)</a>:</h4>
<p>Yes, exactly - the attribute is only separate because the definitions are in the wrong order</p>



<a name="233831351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831351" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831351">(Apr 09 2021 at 14:34)</a>:</h4>
<p>My guess would be that</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[foo, bar]</span>
<span class="kd">class</span> <span class="n">X</span>
</code></pre></div>
<p>and</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[foo]</span>
<span class="kd">class</span> <span class="n">X</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">bar</span><span class="o">]</span> <span class="n">X</span>
</code></pre></div>
<p>are indistinguishable to lean</p>



<a name="233831681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831681">(Apr 09 2021 at 14:36)</a>:</h4>
<p>No, they have different effects, because in the first one <code>bar</code> can act while <code>X</code> is still being constructed, so it can influence the constructors and such</p>



<a name="233831827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233831827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233831827">(Apr 09 2021 at 14:36)</a>:</h4>
<p>for example <code>@[class] structure foo := (a : nat)</code> vs <code>structure foo := (a : nat)  attribute [class] foo</code> have different types for <code>foo.a</code></p>



<a name="233832418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233832418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233832418">(Apr 09 2021 at 14:40)</a>:</h4>
<p>Ok, I feel like the dog playing cards of the memes... the conclusion is that I should put the to additive <em>after</em> the definition as an attribute, right?</p>



<a name="233832493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233832493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233832493">(Apr 09 2021 at 14:40)</a>:</h4>
<p><a href="/user_uploads/3121/BxiFu8N9Fz3ajlpxAfIrQlDS/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/BxiFu8N9Fz3ajlpxAfIrQlDS/image.png" title="image.png"><img src="/user_uploads/3121/BxiFu8N9Fz3ajlpxAfIrQlDS/image.png"></a></div>



<a name="233832714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233832714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233832714">(Apr 09 2021 at 14:42)</a>:</h4>
<p>I think so: define <code>class add_cancel_comm_monoid</code>, then <code>class cancel_comm_monoid</code>, then <code>attribute [to_additive] cancel_comm_monoid</code>.</p>



<a name="233832956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233832956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233832956">(Apr 09 2021 at 14:43)</a>:</h4>
<p>While I am at it, should the second be the preferred form, then?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[protect_proj, ancestor left_cancel_semigroup monoid, to_additive add_left_cancel_monoid]</span>
<span class="kd">class</span> <span class="n">left_cancel_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">left_cancel_semigroup</span> <span class="n">M</span><span class="o">,</span> <span class="n">monoid</span> <span class="n">M</span>


<span class="c1">--better as follows than above?</span>
<span class="kd">@[protect_proj, ancestor left_cancel_semigroup monoid]</span>
<span class="kd">class</span> <span class="n">left_cancel_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">left_cancel_semigroup</span> <span class="n">M</span><span class="o">,</span> <span class="n">monoid</span> <span class="n">M</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span><span class="o">]</span> <span class="n">add_left_cancel_monoid</span>
</code></pre></div>



<a name="233835945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233835945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233835945">(Apr 09 2021 at 15:00)</a>:</h4>
<p>PR <a href="https://github.com/leanprover-community/mathlib/issues/7134">#7134</a></p>



<a name="233836158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233836158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233836158">(Apr 09 2021 at 15:01)</a>:</h4>
<p>It already has an error.  I will try to fix it, but may need further assistance.  Sorry for opening this can of worms and not being able to clean up my own mess...</p>



<a name="233839471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233839471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233839471">(Apr 09 2021 at 15:11)</a>:</h4>
<p>Given my very superficial understanding of the discussion above, what is below seem to be in the wrong order: should the two definitions be swapped around?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- A commutative monoid is a monoid with commutative `(*)`. -/</span>
<span class="kd">@[protect_proj, ancestor monoid comm_semigroup]</span>
<span class="kd">class</span> <span class="n">comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">comm_semigroup</span> <span class="n">M</span>

<span class="sd">/-- An additive commutative monoid is an additive monoid with commutative `(+)`. -/</span>
<span class="kd">@[protect_proj, ancestor add_monoid add_comm_semigroup]</span>
<span class="kd">class</span> <span class="n">add_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">add_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_comm_semigroup</span> <span class="n">M</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span><span class="o">]</span> <span class="n">comm_monoid</span>
</code></pre></div>



<a name="233839607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233839607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233839607">(Apr 09 2021 at 15:12)</a>:</h4>
<p>(This is the order in which they appear in the file <code>algebra/group/defs</code>.)</p>



<a name="233839903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233839903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233839903">(Apr 09 2021 at 15:13)</a>:</h4>
<p><code>attribute [to_additive] add_left_cancel_monoid</code> means "<code>add_left_cancel_monoid</code> is the multiplicative version of some additive lemma"</p>



<a name="233839939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233839939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233839939">(Apr 09 2021 at 15:13)</a>:</h4>
<p>Which is obviously not what you meant!</p>



<a name="233839957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233839957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233839957">(Apr 09 2021 at 15:13)</a>:</h4>
<p>That attribute is only supposed to go on multiplicative things</p>



<a name="233840107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233840107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233840107">(Apr 09 2021 at 15:14)</a>:</h4>
<p>I think you probably meant <code>attribute [to_additive add_left_cancel_monoid] left_cancel_monoid</code></p>



<a name="233840128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233840128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233840128">(Apr 09 2021 at 15:14)</a>:</h4>
<p>Ok, but I think that I did not change this: this is what already was in the file <em>before</em> I touched it!<br>
(Let me check that this is really true!)</p>



<a name="233840167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233840167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233840167">(Apr 09 2021 at 15:14)</a>:</h4>
<p>(your claim is not really true!)</p>



<a name="233840419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233840419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233840419">(Apr 09 2021 at 15:15)</a>:</h4>
<p><code>@[to_additive x] def y</code> means "x is the additive version of y"</p>



<a name="233840500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233840500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233840500">(Apr 09 2021 at 15:15)</a>:</h4>
<p>Usually you can omit <code>x</code> and lean works it out from the name</p>



<a name="233841011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233841011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233841011">(Apr 09 2021 at 15:17)</a>:</h4>
<p>Ok, I will change this, but looking at the file in git, I do not think that I wrote this.  Still, I am happy to change it!  <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="233841862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233841862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233841862">(Apr 09 2021 at 15:20)</a>:</h4>
<p>Is this the correct form, then?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- An additive commutative monoid is an additive monoid with commutative `(+)`. -/</span>
<span class="kd">@[protect_proj, ancestor add_monoid add_comm_semigroup]</span>
<span class="kd">class</span> <span class="n">add_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">add_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_comm_semigroup</span> <span class="n">M</span>

<span class="sd">/-- A commutative monoid is a monoid with commutative `(*)`. -/</span>
<span class="kd">@[protect_proj, ancestor monoid comm_semigroup]</span>
<span class="kd">class</span> <span class="n">comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">comm_semigroup</span> <span class="n">M</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span><span class="o">]</span> <span class="n">add_comm_monoid</span>
</code></pre></div>



<a name="233842532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233842532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233842532">(Apr 09 2021 at 15:24)</a>:</h4>
<p>No!</p>



<a name="233842616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233842616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233842616">(Apr 09 2021 at 15:25)</a>:</h4>
<p>You've told lean that <code>add_comm_monoid</code> is the multiplicative version</p>



<a name="233843103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843103">(Apr 09 2021 at 15:28)</a>:</h4>
<p>I'm sorry, I am trying to understand and keep everything straight, but I am clearly failing.  I will try to produce a better version!</p>



<a name="233843221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843221">(Apr 09 2021 at 15:29)</a>:</h4>
<p>That example above isn't copied from group/basic, is assume?</p>



<a name="233843230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843230">(Apr 09 2021 at 15:29)</a>:</h4>
<p>This works in this case, right?  Or am I still confused?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- An additive commutative monoid is an additive monoid with commutative `(+)`. -/</span>
<span class="kd">@[protect_proj, ancestor add_monoid add_comm_semigroup]</span>
<span class="kd">class</span> <span class="n">add_comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">add_monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">add_comm_semigroup</span> <span class="n">M</span>

<span class="sd">/-- A commutative monoid is a monoid with commutative `(*)`. -/</span>
<span class="kd">@[protect_proj, ancestor monoid comm_semigroup]</span>
<span class="kd">class</span> <span class="n">comm_monoid</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">monoid</span> <span class="n">M</span><span class="o">,</span> <span class="n">comm_semigroup</span> <span class="n">M</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span><span class="o">]</span> <span class="n">comm_monoid</span>
</code></pre></div>



<a name="233843324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843324">(Apr 09 2021 at 15:30)</a>:</h4>
<p>Your last line is different between that snippet and the previous one</p>



<a name="233843350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843350">(Apr 09 2021 at 15:30)</a>:</h4>
<p>The most recent one is correct</p>



<a name="233843354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843354">(Apr 09 2021 at 15:30)</a>:</h4>
<p>The very first one was, the one with the comm_monoid <em>before</em> the `add_comm_monoid*.</p>



<a name="233843441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843441">(Apr 09 2021 at 15:30)</a>:</h4>
<p>Yes, I changed the last line, since I imagine that that would fix the issue...</p>



<a name="233843522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843522">(Apr 09 2021 at 15:31)</a>:</h4>
<p>That most recent one looks fine, and it doesn't care what order the two classes go in as long as the attribute is after both</p>



<a name="233843793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843793">(Apr 09 2021 at 15:32)</a>:</h4>
<p>Finally I did something right!</p>



<a name="233843988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233843988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233843988">(Apr 09 2021 at 15:33)</a>:</h4>
<p>So, as a "generic rule", the name not inside the square brackets should <em>not</em> had <code>add</code>, correct?</p>



<a name="233844295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233844295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233844295">(Apr 09 2021 at 15:35)</a>:</h4>
<p>To be honest, I had completely missed the distinction between inside and outside the square brackets.  I hope that I have it straight now.</p>



<a name="233845716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233845716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233845716">(Apr 09 2021 at 15:44)</a>:</h4>
<p><code>@[to_additive x] def y</code> attaches the attribute to <code>y</code>. <code>attribute [to_additive] x</code> attaches the attribute to <code>x</code>.</p>



<a name="233845941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233845941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233845941">(Apr 09 2021 at 15:45)</a>:</h4>
<p>You either attach the tag when you're making the definition (e.g. <code>@[simp] theorem blah...</code>) or you attach the tag afterwards (e.g. <code>theorem blah...</code> and then later <code>attribute [simp] blah</code>).</p>



<a name="233846063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846063">(Apr 09 2021 at 15:46)</a>:</h4>
<p>Ah, Kevin, one more "subtlety" that I had missed!  Anyway, the PR has been building for over 5s now, so it must all be correct... <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="233846194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846194">(Apr 09 2021 at 15:47)</a>:</h4>
<p>You can use <code>#print blah</code> to see all the tags attached to the definition/theorem called <code>blah</code> -- they appear at the very top of the output.</p>



<a name="233846298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846298">(Apr 09 2021 at 15:48)</a>:</h4>
<p>Also, from the discussion above, I gathered that <code>@[to_additive]</code> and <code>attribute [to_additive]</code> are not equivalent and the latter seems to be preferred.</p>



<a name="233846446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846446">(Apr 09 2021 at 15:49)</a>:</h4>
<p>I think they are equivalent. I think you're confused because the <code>to_additive</code> attribute can take other inputs.</p>



<a name="233846637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846637">(Apr 09 2021 at 15:50)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/aa1fa0b2ba0739deaec3fe65f42640998120bc80/src/algebra/free_monoid.lean#L24-L26">here</a> is an example in mathlib where the to_additive attribute is actually taking an input -- a string, which is the docstring for the additive version. <code>to_additive</code> is a very flexible attribute and I completely agree that there is right now no good place to read about how it works.</p>



<a name="233846670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846670">(Apr 09 2021 at 15:50)</a>:</h4>
<p>Kevin, this is what made me say what I did: honestly, I do not understand what the difference is/might be/isn't!<br>
<a href="#narrow/stream/113489-new-members/topic/mul_right_comm_monoid/near/233831681">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/mul_right_comm_monoid/near/233831681</a></p>



<a name="233846755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233846755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233846755">(Apr 09 2021 at 15:51)</a>:</h4>
<p>The things you wrote above are equivalent, because you didn't give <code>to_additive</code> any inputs. The fun starts when you add other attributes at the same time, or add attributes which do funky stuff.</p>



<a name="233847061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233847061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233847061">(Apr 09 2021 at 15:53)</a>:</h4>
<p>I am confused on so many levels that I do not even make sense to myself...</p>



<a name="233847198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233847198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233847198">(Apr 09 2021 at 15:54)</a>:</h4>
<p>For example <code>@[simp, to_additive] def x...</code> is different to <code>@[to_additive, simp] def x...</code> because in the first one the additivised version of x will also get the simp attribute.</p>



<a name="233847652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233847652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233847652">(Apr 09 2021 at 15:57)</a>:</h4>
<p>some attributes are quite powerful and subtle things, and <code>to_additive</code> is one of them. The way I learnt how it worked was just by looking at files like <a href="https://github.com/leanprover-community/mathlib/blob/master/src/group_theory/submonoid/basic.lean">submonoid.basic</a> and making sure I understood what was going on and why things were done the way they were done. But I guess what really taught me was writing some code like this myself, and being forced to learn it (like you are now).</p>



<a name="233848035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233848035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233848035">(Apr 09 2021 at 15:59)</a>:</h4>
<p>I think that when I was at your stage (a competent Lean programmer and a mathematician) I started to ask myself whether I could actually <em>completely</em> understand random Lean files in mathlib, as opposed to just "basically understanding what was going on". I still ignore pretty much all <code>meta</code> and <code>do</code> code, but everything else I decided that I should probably be able to get to the bottom of it (and of course there are mathematicians who decide to understand <code>meta</code> code too...)</p>



<a name="233848162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233848162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233848162">(Apr 09 2021 at 16:00)</a>:</h4>
<p>Ok, thanks for the encouragement!  I think that the PR is building now, so I must have learned <em>something</em>! <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="233848304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233848304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233848304">(Apr 09 2021 at 16:01)</a>:</h4>
<p>Custom attributes like <code>to_additive</code> and <code>simps</code> (but not <code>simp</code>, I think) are basically metaprograms like tactics that run as Lean processes a declaration. We should expand the documentation if the way to use one isn't completely clear.</p>



<a name="233848632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233848632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233848632">(Apr 09 2021 at 16:03)</a>:</h4>
<p>You should write some <code>to_additive</code> doc before you forget everything. The basic things are: (1) basic usage (it makes an additive version of a multiplicative lemma) (2) add the attribute after <code>simp</code> if you want the <code>simp</code> to apply to the additive version (3) for structures (rather than theorems) you have to make the structure yourself and then tag it later (your confusion about adding the attribute at the same time or afterwards) (4) link to the "dictionary" which auto-generates things like theorem names (5) how to override docstrings e.g. with <code>add_decl_doc</code> (see for example line 279 of submonoid.basic, I linked to the file above) (6) the gotcha with g^n vs n smul g and how it breaks everything.</p>



<a name="233848713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233848713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233848713">(Apr 09 2021 at 16:03)</a>:</h4>
<p>Well, at the moment, I am having difficulty even keeping track of whether something is inside or outside some brackets, so my issues are probably at a more fundamental level than what the documentation might say.</p>
<p>That and having to keep track of whether there was an <code>add</code> or not, a <code>right + comm</code> or not really crossed my eyes!</p>



<a name="233848891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233848891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233848891">(Apr 09 2021 at 16:04)</a>:</h4>
<p>Ok, I might give this a shot!  Actually, your summary is already clearer than what is in my mind...</p>



<a name="233849214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233849214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233849214">(Apr 09 2021 at 16:07)</a>:</h4>
<p>oh also the docstring trick</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- multiplicative docstring -/</span>
<span class="kd">@[to_additive "additive docstring"]</span> <span class="kd">def</span> <span class="n">gi</span> <span class="o">:</span> <span class="n">galois_insertion...</span>
</code></pre></div>
<p>and the "choose another name rather than the auto-generated one" trick e.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive ordered_add_comm_group.add_lt_add_left]</span>
<span class="kd">lemma</span> <span class="n">ordered_comm_group.mul_lt_mul_left'</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:=</span>
</code></pre></div>
<p>(remove the prime, because there will be some ring version which doesn't have an additive counterpart)</p>



<a name="233849553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233849553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233849553">(Apr 09 2021 at 16:09)</a>:</h4>
<p>The final aspect is tagging something with <code>to_additive</code> "out of band", that is, via an <code>attribute ...</code> line like at</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">order_of_one</span> <span class="o">:</span> <span class="n">order_of</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">order_of_le_of_pow_eq_one</span> <span class="o">(</span><span class="n">nat.one_pos</span><span class="o">)</span> <span class="o">(</span><span class="n">pow_one</span> <span class="mi">1</span><span class="o">)</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">nat.succ_le_of_lt</span> <span class="o">(</span> <span class="n">order_of_pos'</span> <span class="o">⟨</span><span class="mi">1</span><span class="o">,</span> <span class="o">⟨</span><span class="n">nat.one_pos</span><span class="o">,</span> <span class="n">pow_one</span> <span class="mi">1</span><span class="o">⟩⟩)</span> <span class="o">}</span>
<span class="kd">end</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">add_order_of_zero</span> <span class="o">:</span> <span class="n">add_order_of</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">H</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">←</span> <span class="n">order_of_of_add_eq_add_order_of</span><span class="o">]</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span> <span class="n">add_order_of_zero</span><span class="o">]</span> <span class="n">order_of_one</span>
</code></pre></div>



<a name="233854455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233854455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233854455">(Apr 09 2021 at 16:41)</a>:</h4>
<p>Is there a way to get Lean to list the attributes of a given lemma?  Say that I want to discover whether an autogenerated lemma is or isn't <code>simp</code>: chan I <code>#check</code> or <code>#print</code> or something like this to find out?</p>



<a name="233855636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233855636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233855636">(Apr 09 2021 at 16:49)</a>:</h4>
<p><code>#print</code> and look at the very top of the output.</p>



<a name="233856664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233856664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233856664">(Apr 09 2021 at 16:57)</a>:</h4>
<p>Thanks, Kevin!</p>



<a name="233880515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233880515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233880515">(Apr 09 2021 at 19:47)</a>:</h4>
<p>To my surprise, once I fixed the silly errors that I introduced, PR <a href="https://github.com/leanprover-community/mathlib/issues/7134">#7134</a> "just worked"!  The 4 typeclasses <code>(add_)left_cancel_comm_monoid, (add_)right_cancel_comm_monoid</code> can leave mathlib and no one would notice...</p>



<a name="233884954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233884954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233884954">(Apr 09 2021 at 20:22)</a>:</h4>
<p>I also just noticed that this might be the first time that a PR of mine actually has a net <em>negative</em> effect on the number of lines of code in mathlib.</p>



<a name="233893652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233893652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233893652">(Apr 09 2021 at 21:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/113489-new-members/topic/mul_right_comm_monoid/near/233884954">said</a>:</p>
<blockquote>
<p>I also just noticed that this might be the first time that a PR of mine actually has a net <em>negative</em> effect on the number of lines of code in mathlib.</p>
</blockquote>
<p>"Fools ignore complexity. Pragmatists suffer it. Some can avoid it. Geniuses remove it." Congratulations, you are now a genius :)</p>



<a name="233909193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mul_right_comm_monoid/near/233909193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mul_right_comm_monoid.html#233909193">(Apr 10 2021 at 00:05)</a>:</h4>
<p>This topic was moved by <span class="user-mention silent" data-user-id="110087">Scott Morrison</span> to <a class="stream-topic" data-stream-id="217875" href="/#narrow/stream/217875-Is-there-code-for-X.3F/topic/mul_right_comm_monoid">#Is there code for X? &gt; mul_right_comm_monoid</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>