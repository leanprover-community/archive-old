---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/structure.20forgets.20its.20parents.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html">structure forgets its parents</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204412193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eloi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412193">(Jul 20 2020 at 11:43)</a>:</h4>
<p>Hi, I am writing a structure that indirectly extends from <code>linear_map</code>, and I don't know how to recover this map to impose more conditions on it. Thanks!</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">matrix</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">quadratic_form</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span>
<span class="n">local</span> <span class="kn">notation</span> <span class="bp">`</span><span class="n">Quadratic_form</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">quadratic_form</span> <span class="bp">ℤ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">properly_equivalent</span> <span class="o">(</span><span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:</span> <span class="n">Quadratic_form</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">quadratic_form</span><span class="bp">.</span><span class="n">isometry</span> <span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:=</span>
  <span class="o">(</span><span class="n">determinant_is_one</span> <span class="o">:</span>  <span class="n">to_fun</span><span class="bp">.</span><span class="n">to_matrix</span><span class="bp">.</span><span class="n">det</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">linear_map</span><span class="bp">.</span><span class="n">to_matrix</span>
<span class="bp">#</span><span class="kn">check</span> <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span>
</code></pre></div>



<a name="204412287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412287">(Jul 20 2020 at 11:44)</a>:</h4>
<p>Do you mean that this gives an error?</p>



<a name="204412308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412308">(Jul 20 2020 at 11:45)</a>:</h4>
<p>Aah, the <code>to_fun.to_matrix</code> looks a bit suspicious</p>



<a name="204412583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eloi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412583">(Jul 20 2020 at 11:48)</a>:</h4>
<p>Yes I know, because <code>to_fun</code> is only a function and not a <code>linear_map</code>... but at some point this strucure had a <code>linear_map</code> with <code>to_fun</code> as "its" <code>to_fun</code>... I don't know how to recover this <code>linear_map</code>.</p>



<a name="204412597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412597">(Jul 20 2020 at 11:49)</a>:</h4>
<p>I see</p>



<a name="204412611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412611">(Jul 20 2020 at 11:49)</a>:</h4>
<p>Aside, note that we also have: <a href="https://github.com/leanprover-community/mathlib/blob/4ec7cc58e126b736de864b91649c0f7f3d6a7d48/src/linear_algebra/quadratic_form.lean#L490">https://github.com/leanprover-community/mathlib/blob/4ec7cc58e126b736de864b91649c0f7f3d6a7d48/src/linear_algebra/quadratic_form.lean#L490</a></p>



<a name="204412636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412636">(Jul 20 2020 at 11:49)</a>:</h4>
<p>So you might want to have <code>proper_isometry</code> and <code>properly_equivalent</code> along the same lines</p>



<a name="204412745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204412745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204412745">(Jul 20 2020 at 11:51)</a>:</h4>
<p>I think you can talk about <code>linear_map.to_matrix \&lt; to_fun, map_add', map_smul' \&gt;</code>. It's a bit ugly, but it works for the definition.<br>
Then you can restate it afterwards, which you should probably do anyways.</p>



<a name="204413564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204413564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eloi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204413564">(Jul 20 2020 at 12:02)</a>:</h4>
<p>What is the correct sintax? I can't get it working... This is what I tried</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">matrix</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">quadratic_form</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span>
<span class="n">local</span> <span class="kn">notation</span> <span class="bp">`</span><span class="n">Quadratic_form</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">quadratic_form</span> <span class="bp">ℤ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">proper_isometry</span> <span class="o">(</span><span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:</span> <span class="n">Quadratic_form</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">quadratic_form</span><span class="bp">.</span><span class="n">isometry</span> <span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:=</span>
  <span class="o">(</span><span class="n">determinant_is_one</span> <span class="o">:</span>  <span class="o">(</span><span class="n">linear_map</span><span class="bp">.</span><span class="n">to_matrix</span> <span class="bp">⟨</span><span class="n">to_fun</span><span class="o">,</span> <span class="n">map_add&#39;</span><span class="o">,</span> <span class="n">map_smul&#39;</span><span class="bp">⟩</span><span class="o">)</span><span class="bp">.</span><span class="n">det</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>
</code></pre></div>



<a name="204413642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204413642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204413642">(Jul 20 2020 at 12:03)</a>:</h4>
<p>Hmm, maybe remove the <code>\&lt;to_fun, .. \&gt;</code> part, and put a <code>_</code> there.</p>



<a name="204413656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204413656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204413656">(Jul 20 2020 at 12:03)</a>:</h4>
<p>Then click onthe light bulb, and choose the "skeleton" option</p>



<a name="204414065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204414065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eloi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204414065">(Jul 20 2020 at 12:09)</a>:</h4>
<p>Doesn't work either... I get the following error message: </p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">as</span> <span class="kn">structure</span> <span class="kn">instance</span>
  <span class="o">{</span><span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_fun</span><span class="o">,</span> <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="n">map_add&#39;</span><span class="o">,</span> <span class="n">map_smul&#39;</span> <span class="o">:=</span> <span class="n">map_smul&#39;</span><span class="o">}</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="bp">ℤ</span><span class="o">]</span> <span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="o">(</span><span class="err">?</span><span class="n">m_2</span> <span class="bp">→</span> <span class="err">?</span><span class="n">m_1</span><span class="o">)</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="err">?</span><span class="n">m_1</span><span class="o">]</span> <span class="err">?</span><span class="n">m_3</span> <span class="bp">→</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="err">?</span> <span class="err">?</span><span class="o">)</span>
</code></pre></div>


<p>my attempt was:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">structure</span> <span class="n">proper_isometry</span> <span class="o">(</span><span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:</span> <span class="n">Quadratic_form</span><span class="o">)</span> <span class="kn">extends</span> <span class="o">(</span><span class="n">quadratic_form</span><span class="bp">.</span><span class="n">isometry</span> <span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">):=</span>
  <span class="o">(</span><span class="n">determinant_is_one</span> <span class="o">:</span>  <span class="o">(</span><span class="n">linear_map</span><span class="bp">.</span><span class="n">to_matrix</span> <span class="o">{</span><span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_fun</span><span class="o">,</span>
                                                <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="n">map_add&#39;</span><span class="o">,</span>
                                                <span class="n">map_smul&#39;</span> <span class="o">:=</span> <span class="n">map_smul&#39;</span>
                                                <span class="o">})</span><span class="bp">.</span><span class="n">det</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>
</code></pre></div>



<a name="204414274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204414274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204414274">(Jul 20 2020 at 12:12)</a>:</h4>
<p>Aha, we probably need to tell it a bit more types...</p>



<a name="204414306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204414306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204414306">(Jul 20 2020 at 12:12)</a>:</h4>
<p>If you copy <code> : (fin d → ℤ) →ₗ[ℤ] fin d → ℤ</code> and put it after the <code>}</code>, but before <code>).det</code>... does that help?</p>



<a name="204414329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204414329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204414329">(Jul 20 2020 at 12:13)</a>:</h4>
<p>(Note the <code>:</code> at the begin of the text-to-be-copied</p>



<a name="204418775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204418775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eloi <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204418775">(Jul 20 2020 at 13:01)</a>:</h4>
<p>It didn't work... I tried two alternatives:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">matrix</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">quadratic_form</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span>
<span class="n">local</span> <span class="kn">notation</span> <span class="bp">`</span><span class="n">Quadratic_form</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">quadratic_form</span> <span class="bp">ℤ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">proper_isometry&#39;</span> <span class="o">(</span><span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:</span> <span class="n">Quadratic_form</span><span class="o">)</span> <span class="kn">extends</span> <span class="o">(</span><span class="n">quadratic_form</span><span class="bp">.</span><span class="n">isometry</span> <span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">):=</span>
  <span class="o">(</span><span class="n">determinant_is_one</span> <span class="o">:</span>
    <span class="o">({</span><span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_fun</span><span class="o">,</span> <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="n">map_add&#39;</span><span class="o">,</span> <span class="n">map_smul&#39;</span> <span class="o">:=</span> <span class="n">map_smul&#39;</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="bp">ℤ</span><span class="o">]</span> <span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span><span class="bp">.</span><span class="n">to_matrix</span><span class="bp">.</span><span class="n">det</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>


<span class="kn">structure</span> <span class="n">proper_isometry</span> <span class="o">(</span><span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:</span> <span class="n">Quadratic_form</span><span class="o">)</span> <span class="kn">extends</span> <span class="o">(</span><span class="n">quadratic_form</span><span class="bp">.</span><span class="n">isometry</span> <span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">):=</span>
  <span class="o">(</span><span class="n">determinant_is_one</span> <span class="o">:</span>  <span class="o">(</span><span class="n">linear_map</span><span class="bp">.</span><span class="n">to_matrix</span> <span class="o">{</span><span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_fun</span><span class="o">,</span>
                                                <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="n">map_add&#39;</span><span class="o">,</span>
                                                <span class="n">map_smul&#39;</span> <span class="o">:=</span> <span class="n">map_smul&#39;</span>
                                                <span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="bp">ℤ</span><span class="o">]</span> <span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span><span class="bp">.</span><span class="n">det</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>
</code></pre></div>


<p>both give the error message:  </p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="o">{</span><span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_fun</span><span class="o">,</span> <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="n">map_add&#39;</span><span class="o">,</span> <span class="n">map_smul&#39;</span> <span class="o">:=</span> <span class="n">map_smul&#39;</span><span class="o">}</span><span class="bp">.</span><span class="n">to_matrix</span>
<span class="n">term</span>
  <span class="o">{</span><span class="n">to_fun</span> <span class="o">:=</span> <span class="n">to_fun</span><span class="o">,</span> <span class="n">map_add&#39;</span> <span class="o">:=</span> <span class="n">map_add&#39;</span><span class="o">,</span> <span class="n">map_smul&#39;</span> <span class="o">:=</span> <span class="n">map_smul&#39;</span><span class="o">}</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="bp">ℤ</span><span class="o">]</span> <span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="o">(</span><span class="err">?</span><span class="n">m_2</span> <span class="bp">→</span> <span class="err">?</span><span class="n">m_1</span><span class="o">)</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="err">?</span><span class="n">m_1</span><span class="o">]</span> <span class="err">?</span><span class="n">m_3</span> <span class="bp">→</span> <span class="err">?</span><span class="n">m_1</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="err">?</span> <span class="err">?</span><span class="o">)</span>
</code></pre></div>



<a name="204444680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204444680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204444680">(Jul 20 2020 at 16:32)</a>:</h4>
<p>My next step would be to write <code>@linear_map.to_matrix</code> and start filling in the implicit fields to see if something funny happens.</p>



<a name="204444882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204444882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204444882">(Jul 20 2020 at 16:34)</a>:</h4>
<p>aaand: bingo!</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">matrix</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">quadratic_form</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span>
<span class="n">local</span> <span class="kn">notation</span> <span class="bp">`</span><span class="n">Quadratic_form</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">quadratic_form</span> <span class="bp">ℤ</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span> <span class="bp">→</span> <span class="bp">ℤ</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">proper_isometry</span> <span class="o">(</span><span class="n">Q</span> <span class="n">Q&#39;</span><span class="o">:</span> <span class="n">Quadratic_form</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">quadratic_form</span><span class="bp">.</span><span class="n">isometry</span> <span class="n">Q</span> <span class="n">Q&#39;</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">determinant_is_one</span> <span class="o">:</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">linear_map</span><span class="bp">.</span><span class="n">to_matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">ℤ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">⟨</span><span class="n">to_fun</span><span class="o">,</span> <span class="n">map_add&#39;</span><span class="o">,</span> <span class="n">map_smul&#39;</span><span class="bp">⟩</span><span class="o">)</span><span class="bp">.</span><span class="n">det</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span>
</code></pre></div>


<p>gives error</p>
<div class="codehilite"><pre><span></span><code><span class="n">synthesized</span> <span class="n">type</span> <span class="n">class</span> <span class="kn">instance</span> <span class="n">is</span> <span class="n">not</span> <span class="n">definitionally</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">expression</span> <span class="n">inferred</span> <span class="k">by</span> <span class="n">typing</span> <span class="n">rules</span><span class="o">,</span> <span class="n">synthesized</span>
  <span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">d</span><span class="o">),</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">d</span><span class="o">),</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="bp">ℤ</span>
<span class="n">inferred</span>
  <span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span> <span class="o">(</span><span class="n">fin</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">d</span><span class="o">),</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">ℤ</span>
</code></pre></div>



<a name="204444930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204444930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204444930">(Jul 20 2020 at 16:35)</a>:</h4>
<p>There is some kind of typeclass diamond which is stopping unification from working.</p>



<a name="204445088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/structure%20forgets%20its%20parents/near/204445088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/structure.20forgets.20its.20parents.html#204445088">(Jul 20 2020 at 16:36)</a>:</h4>
<p>I'm afraid this is beyond my pay grade but at least we now know the problem.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>