---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html">Implicitly bringing structure field props into context</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="261713949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261713949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261713949">(Nov 16 2021 at 22:07)</a>:</h4>
<p>I'm playing around with the pattern of defining a <code>structure</code> that associates a value with some propositions about the value.</p>
<p>Trivial example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">list3</span> <span class="o">:=</span> <span class="o">(</span><span class="n">val</span> <span class="o">:</span> <span class="n">list</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">len</span> <span class="o">:</span> <span class="n">val.length</span> <span class="bp">=</span> <span class="mi">3</span><span class="o">)</span>
</code></pre></div>
<p>I'm finding that one disadvantage of this approach is that the tactics don't seem to treat the <code>val</code> field as a local hypothesis.</p>
<p>This works fine - <code>library_search</code> finds the <code>len</code> prop:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">l3</span> <span class="o">:</span> <span class="n">list3</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">l3.val.length</span> <span class="bp">=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>
<p>However this does not:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">l3</span> <span class="o">:</span> <span class="n">list3</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">l3.val.length</span> <span class="bp">&lt;=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>
<p>But I can persuade it to work if I explicitly bring <code>len</code> into the context:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">l3</span> <span class="o">:</span> <span class="n">list3</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">l3.val.length</span> <span class="bp">&lt;=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="k">have</span> <span class="n">l3.len</span> <span class="o">:=</span> <span class="n">l3.len</span><span class="o">,</span> <span class="n">library_search</span><span class="o">,</span> <span class="o">}</span>
</code></pre></div>
<p>Is there anything that I can do to make <code>l3.len</code> implicitly in context whenever <code>l3</code> is? I want the behaviour of the last example with the <code>have</code>, but without having to type the <code>have</code>.</p>
<p>On a slightly more general note, is this pattern common and considered good? Or are there reasons that I shouldn't be trying to group values and their propositions like this?</p>



<a name="261714415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261714415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261714415">(Nov 16 2021 at 22:10)</a>:</h4>
<p>One way, though somewhat explicit, is <code>cases l3</code>.  This essentially brings all the fields into the context.</p>



<a name="261714847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261714847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261714847">(Nov 16 2021 at 22:14)</a>:</h4>
<p>If you have just a single proposition, it's more common to use <code>subtype</code>: <code>{val : list nat // val.length = 3}</code>.  Sometimes you might write it as a set and use the coercion to <code>subtype</code>.</p>
<p>But using custom structures to "bundle" data with properties is fairly common, too.  I think whether it's good comes down to seeing how you tend to use it -- do they make the interface to your definitions and theorems cleaner?</p>



<a name="261714916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261714916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261714916">(Nov 16 2021 at 22:15)</a>:</h4>
<p>Actually <code>cases</code> is explicitly not what I want, because I want to keep <code>l3</code> intact.  <code>cases</code> replaces <code>l3</code> with its constituent parts, but I want to leave it as it is and augment the context with the <code>len</code> prop.</p>



<a name="261715099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715099">(Nov 16 2021 at 22:16)</a>:</h4>
<p>I have more than one prop, but I could AND them together I suppose. What advantages does <code>subtype</code> give here?</p>



<a name="261715318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715318">(Nov 16 2021 at 22:18)</a>:</h4>
<p>The advantage of a subtype is that there's a bunch of pre-written lemmas to help you out (like you get that <code>list3.val</code> is injective).  It's a tradeoff, since then you'd have to <code>/\</code> everything together, and that's not very nice.</p>



<a name="261715320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715320">(Nov 16 2021 at 22:18)</a>:</h4>
<p>I think the bundle will be a cleaner interface once I've built up all of the relevant lemmas on the bundle structure, but I'm finding declaring those lemmas to be a bit tricky for reasons like this.</p>



<a name="261715372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715372">(Nov 16 2021 at 22:18)</a>:</h4>
<p>Do you have an example where you need <code>l3</code> to remain intact? There are some cases I can think of, but I'm wondering what your own constraint is here.</p>



<a name="261715640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715640">(Nov 16 2021 at 22:20)</a>:</h4>
<p>(Also, I'm finding <code>have l3.len := l3.len</code> to be odd -- it seems like you're creating a new name that shadows <code>l3.len</code>, right? Would <code>have l3_len := l3.len</code> be the same? Without having tested it, it seems like using <code>l3.len</code> like this tricks <code>library_search</code> into printing out that it's using <code>l3.len</code>.)</p>



<a name="261715747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715747">(Nov 16 2021 at 22:22)</a>:</h4>
<p>I'm building up a library of functions and lemmas that operate on <code>list3</code>s. (It's not actually <code>list3</code>, that's a simplified example.) So I'll be using values of that type, so I want to keep it around.</p>



<a name="261715886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715886">(Nov 16 2021 at 22:22)</a>:</h4>
<p>Yes <code>l3_len</code> works the same. As far as I can tell I'm just shadowing it.</p>



<a name="261715945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261715945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261715945">(Nov 16 2021 at 22:23)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">l3</span> <span class="o">:</span> <span class="n">list3</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">l3.val.length</span> <span class="bp">&lt;=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span> <span class="o">{</span> <span class="k">have</span> <span class="n">l3_len</span> <span class="o">:=</span> <span class="n">l3.len</span><span class="o">,</span> <span class="n">library_search</span><span class="o">,</span> <span class="o">}</span>
</code></pre></div>
<p><code>library_search</code> is giving me <code>exact (eq.symm l3_len).ge</code></p>



<a name="261716355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261716355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261716355">(Nov 16 2021 at 22:26)</a>:</h4>
<p>Which of course I can manually simplify to <code>exact (eq.symm l3.len).ge</code>. But it would be cool if it just got that without me doing any work.</p>



<a name="261716437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261716437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261716437">(Nov 16 2021 at 22:27)</a>:</h4>
<p>Anyway, I think the short answer is "no, there's not something that automatically includes fields of a structure into the context".  You could write a tactic to do this if you wanted, but you'd have to call it.</p>
<p>You could also modify <code>library_search</code> to walk through things in your context and add <code>Prop</code> fields to its list of assumptions.</p>



<a name="261716456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261716456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261716456">(Nov 16 2021 at 22:27)</a>:</h4>
<p>Or even <code>l3.len.le</code></p>



<a name="261716837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261716837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261716837">(Nov 16 2021 at 22:30)</a>:</h4>
<p>Modifying <code>library_search</code> to do it is intriguing, but I expect that's an unreasonable amount of work, isn't it?</p>



<a name="261717262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261717262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261717262">(Nov 16 2021 at 22:33)</a>:</h4>
<p>Although actually, this is about more than <code>library_search</code>. That was just the easy example. I've observed similar behaviour with things like <code>simp</code>, where using <code>have</code> to bring field props into context is required. What I'm actually looking for is a way to do this that operates irrespective of tactic.</p>



<a name="261717440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261717440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261717440">(Nov 16 2021 at 22:35)</a>:</h4>
<p>Oh yeah <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> , good point. I guess <code>library_search</code> isn't even giving me the best way here.</p>



<a name="261717887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261717887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261717887">(Nov 16 2021 at 22:39)</a>:</h4>
<p>You could make a variant of <code>cases</code> that introduces an <code>x</code> with <code>h : x = l3</code>, does <code>cases x</code>, uses <code>h</code> to create rewrites for fields of <code>l3</code>, then rewrites the fields that <code>cases x</code> created with it.</p>
<p>In practice, I find I just add things I think I might need when I'm trying to find things when writing proofs.  Like <code>library_search [l3.len]</code> should probably work.</p>



<a name="261718190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718190">(Nov 16 2021 at 22:42)</a>:</h4>
<p>Yeah, I think just writing the slightly over explicit code is the way to go, rather than trying anything too complicated like making custom tactics.  I think the <code>have</code> shadowing trick actually works quite nicely, it's just a bit verbose.</p>



<a name="261718232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718232">(Nov 16 2021 at 22:43)</a>:</h4>
<p>Do you think it would make sense to add a feature like this into the language, though? Perhaps some attribute that can be applied to structures to specify that certain fields are implicitly in the context?</p>



<a name="261718653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718653">(Nov 16 2021 at 22:46)</a>:</h4>
<p>What exactly is the problem you're trying to solve? Is it "I want to be reminded of this in the goal view", and so just a user experience thing? Or is it "<code>library_search</code> can't find my proof unless I add a <code>have</code>"?</p>



<a name="261718681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718681">(Nov 16 2021 at 22:46)</a>:</h4>
<p>It seems that if this is something you need (and not just for <code>library_search</code> and <code>simp</code> convenience) then it suggests that it'd be better to unbundle the structure.</p>
<p>(I checked: <code>library_search [l3.len]</code> does work.)</p>



<a name="261718825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718825">(Nov 16 2021 at 22:48)</a>:</h4>
<p>I guess there's also things that operate using <code>assumption</code>, which I think <code>simp</code> does when trying to fill in hypotheses to simp lemmas.</p>



<a name="261718839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718839">(Nov 16 2021 at 22:48)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span>  It's "tactics generally can't find my proof unless I add a <code>have</code>". It's convenient with things like <code>simp? *</code> too. And presumably other tactics as well, but I've only actually played with simple examples so far.</p>



<a name="261718910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261718910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261718910">(Nov 16 2021 at 22:49)</a>:</h4>
<p>Different tactics look at different things, but no tactic is going to start fishing fields out of a structure apart from tactics like <code>tidy</code> which is a finishing tactic which will take your structure apart mercilessly.</p>



<a name="261719039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719039">(Nov 16 2021 at 22:50)</a>:</h4>
<p>Actually, fishing fields out of structures would be an excellent additional to <code>library_search</code>, and completely doable.</p>



<a name="261719099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719099">(Nov 16 2021 at 22:50)</a>:</h4>
<p><code>library_search</code> hands off to <code>solve_by_elim</code> after it has successfully applied a library lemma, and it should be possible to tell <code>solve_by_elim</code> that it is allowed to use projections of local hypotheses.</p>



<a name="261719112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719112">(Nov 16 2021 at 22:51)</a>:</h4>
<p>I was going to mention <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.auto_cases">docs#tactic.auto_cases</a> (which is used by <code>tidy</code>) but (1) it doesn't know about your custom structure (2) it uses <code>cases</code> (3) it's apparently not an interactive tactic</p>



<a name="261719125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719125">(Nov 16 2021 at 22:51)</a>:</h4>
<p>I'm not sure whether <code>simp *</code> or <code>linarith</code> should pull fields out of structures, but <code>library_search</code> certainly should</p>



<a name="261719144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719144">(Nov 16 2021 at 22:51)</a>:</h4>
<p>There's also <code>case_bash</code> somewhere.</p>



<a name="261719164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719164">(Nov 16 2021 at 22:51)</a>:</h4>
<p>Ah, I didn't know about that one.</p>



<a name="261719175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719175">(Nov 16 2021 at 22:51)</a>:</h4>
<p><code>auto_cases</code> is extremely lame. It was amongst the first tactics I ever wrote, and should be redone.</p>



<a name="261719338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719338">(Nov 16 2021 at 22:53)</a>:</h4>
<p>That sounds reasonable <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>, but I'm actually not imagining this as being a feature of tactics themselves. In my imagination, it's a feature of the <code>structure</code> that whenever it exists in the context, it automatically adds its own props into the context at the top level.</p>
<p>I'm very new to lean though, so I don't know if that makes sense when you get to the technical details. I was hoping that there was just some attribute I could throw on the <code>structure</code> or something like that.</p>



<a name="261719472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719472">(Nov 16 2021 at 22:54)</a>:</h4>
<p>Improving <code>library_search</code> to do this sounds cool, but that was really only the simple case I was using as an example.</p>



<a name="261719542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719542">(Nov 16 2021 at 22:54)</a>:</h4>
<p>I really don't want <code>add_assoc</code>, <code>add_comm</code>, <code>add_zero</code>, <code>zero_add</code>, <code>add_left_neg...</code> all being thrown into my local context every time I make something an additive abelian group.</p>



<a name="261719580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719580">(Nov 16 2021 at 22:55)</a>:</h4>
<p>Aah, but you only want it for certain structures I guess.</p>



<a name="261719616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719616">(Nov 16 2021 at 22:55)</a>:</h4>
<p>Certain structures, and even only certain fields of certain structures.</p>



<a name="261719626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719626">(Nov 16 2021 at 22:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I was imagining modifying <a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.solve_by_elim.mk_assumption_set">docs#tactic.solve_by_elim.mk_assumption_set</a>, which is called once at the beginning of <code>library_search</code>, and it could add <code>Prop</code>-fields of non-excluded local hypotheses.</p>



<a name="261719938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719938">(Nov 16 2021 at 22:58)</a>:</h4>
<p>There is some danger of infinite regress since the field could be another structure of the same type.</p>



<a name="261719954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261719954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261719954">(Nov 16 2021 at 22:58)</a>:</h4>
<p>Er wait maybe it can't be for a <code>structure</code></p>



<a name="261720400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261720400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261720400">(Nov 16 2021 at 23:02)</a>:</h4>
<p>Sounds good. Behind an additional flag, of course. I'd guess that just doing a single pass over the hypotheses is good enough.</p>



<a name="261720606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261720606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261720606">(Nov 16 2021 at 23:04)</a>:</h4>
<p>I assume anything that works for <code>structures</code> would/should also work for subtypes, right? This doesn't work yet.</p>
<p><code>example (l3: {val : list nat // val.length = 3}) : (l3.val.length = 3) := by library_search,</code></p>



<a name="261720640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261720640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261720640">(Nov 16 2021 at 23:04)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/subtype/src">src#subtype</a> shows you that it's just another structure</p>



<a name="261720664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261720664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261720664">(Nov 16 2021 at 23:05)</a>:</h4>
<p>Right, yeah good.</p>



<a name="261720675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261720675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261720675">(Nov 16 2021 at 23:05)</a>:</h4>
<p>Presumably <code>library_search</code> is finding the function which takes a structure and spits out the field.</p>



<a name="261720807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261720807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261720807">(Nov 16 2021 at 23:06)</a>:</h4>
<p>I'm not sure if I'm misunderstanding you Kevin, but just to be clear, that snipped I just posted doesn't work currently.</p>



<a name="261721120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261721120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261721120">(Nov 16 2021 at 23:09)</a>:</h4>
<p>Here's a silly prototype:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">structure</span> <span class="n">a</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
<span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span>
  <span class="c1">-- tactic.get_constructors_for</span>
  <span class="c1">-- #check tactic.get_decls_from</span>

<span class="kn">open</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">add_structure_hyps</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="k">do</span>
  <span class="n">l</span> <span class="bp">←</span> <span class="n">tactic.expanded_field_list</span> <span class="bp">`</span><span class="n">a</span><span class="o">,</span>
  <span class="n">l.mfoldl</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">b</span><span class="o">,</span> <span class="k">do</span>
    <span class="c1">-- trace b,</span>
    <span class="n">c</span> <span class="bp">←</span> <span class="n">mk_const</span> <span class="bp">$</span> <span class="n">name.append</span> <span class="n">b.1</span> <span class="n">b.2</span><span class="o">,</span>
    <span class="n">l</span> <span class="bp">←</span> <span class="n">get_local</span> <span class="bp">`</span><span class="n">c</span><span class="o">,</span>
    <span class="k">let</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">expr.mk_app</span> <span class="n">c</span> <span class="o">[</span><span class="n">l</span><span class="o">],</span>
    <span class="n">ty</span> <span class="bp">←</span> <span class="n">infer_type</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">i</span> <span class="bp">←</span> <span class="n">is_prop</span> <span class="n">ty</span><span class="o">,</span>
    <span class="n">guardb</span> <span class="n">i</span> <span class="bp">&gt;&gt;</span> <span class="n">note</span> <span class="bp">`</span><span class="n">this</span> <span class="n">ty</span> <span class="n">d</span> <span class="bp">&gt;&gt;</span> <span class="n">skip</span> <span class="bp">&lt;|&gt;</span> <span class="n">skip</span><span class="o">,</span>
    <span class="n">skip</span><span class="o">)</span> <span class="o">()</span>
  <span class="c1">-- l.mfoldl (λ _ b, do</span>

<span class="kd">lemma</span> <span class="n">oof</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">c.b</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- have := a.h c,</span>
  <span class="n">add_structure_hyps</span><span class="o">,</span>
  <span class="n">linarith</span>
<span class="kd">end</span>
</code></pre></div>



<a name="261721148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261721148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261721148">(Nov 16 2021 at 23:09)</a>:</h4>
<p>Is this what you are thinking?</p>



<a name="261721263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261721263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261721263">(Nov 16 2021 at 23:10)</a>:</h4>
<p>Currently it is silly and names everything <code>this</code> and hardcodes the name <code>c</code>, but you get the idea I hope</p>



<a name="261721614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261721614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261721614">(Nov 16 2021 at 23:13)</a>:</h4>
<p>That's pretty cool <span class="user-mention" data-user-id="127136">@Alex J. Best</span>!</p>



<a name="261721728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261721728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261721728">(Nov 16 2021 at 23:14)</a>:</h4>
<p>That doesn't have the usability I was hoping for because it requires an explicit tactic invocation, and it's not automatically associated with the <code>structure</code>, but if nothing better comes out of this discussion I'll probably use something based on that.</p>



<a name="261722153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261722153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261722153">(Nov 16 2021 at 23:19)</a>:</h4>
<p>Yeah it could certainly be added as a pre-processing step for linarith to do this, but we like small lego-block style tactics so people can combine them in different ways, it certainly seems useful to me to have this as an independent tactic for other purposes too.</p>



<a name="261723149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261723149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261723149">(Nov 16 2021 at 23:29)</a>:</h4>
<p>Off topic, but I wish Lean was named something that I could google things about without having to carefully refine my search to avoid sifting through tons of articles from Startup Bros all excited about their lean management practices.</p>



<a name="261723714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261723714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261723714">(Nov 16 2021 at 23:35)</a>:</h4>
<p>The trick is to google for lean prover or lean theorem prover</p>



<a name="261723726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261723726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261723726">(Nov 16 2021 at 23:35)</a>:</h4>
<p>use leanprover</p>



<a name="261723810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261723810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261723810">(Nov 16 2021 at 23:36)</a>:</h4>
<p>Good tips, thanks.</p>



<a name="261724320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261724320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261724320">(Nov 16 2021 at 23:40)</a>:</h4>
<p>Slightly more advanced version <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">structure</span> <span class="n">a</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
<span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="mi">5</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="mi">3</span><span class="o">)</span>
  <span class="c1">-- tactic.get_constructors_for</span>
  <span class="c1">-- #check tactic.get_decls_from</span>

<span class="kn">open</span> <span class="n">tactic</span> <span class="n">expr</span>
<span class="n">setup_tactic_parser</span>
<span class="kn">namespace</span> <span class="n">tactic</span>
<span class="kn">namespace</span> <span class="n">interactive</span>
<span class="kd">meta</span> <span class="kd">def</span> <span class="n">add_structure_hyps</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">texpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="k">do</span>
    <span class="n">h</span> <span class="bp">←</span> <span class="n">i_to_expr</span> <span class="n">t</span><span class="o">,</span>
    <span class="n">tyo</span> <span class="bp">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">l</span> <span class="bp">←</span> <span class="n">tactic.expanded_field_list</span> <span class="o">(</span><span class="n">expr.const_name</span> <span class="n">tyo</span><span class="o">),</span>
    <span class="n">l.mfoldl</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">b</span><span class="o">,</span> <span class="k">do</span>
      <span class="n">c</span> <span class="bp">←</span> <span class="n">mk_const</span> <span class="bp">$</span> <span class="n">name.append</span> <span class="n">b.1</span> <span class="n">b.2</span><span class="o">,</span>
      <span class="k">let</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">expr.mk_app</span> <span class="n">c</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span>
      <span class="n">ty</span> <span class="bp">←</span> <span class="n">infer_type</span> <span class="n">d</span><span class="o">,</span>
      <span class="n">i</span> <span class="bp">←</span> <span class="n">is_prop</span> <span class="n">ty</span><span class="o">,</span>
      <span class="n">guardb</span> <span class="n">i</span> <span class="bp">&gt;&gt;</span> <span class="n">note</span> <span class="bp">`</span><span class="n">this</span> <span class="n">ty</span> <span class="n">d</span> <span class="bp">&gt;&gt;</span> <span class="n">skip</span> <span class="bp">&lt;|&gt;</span> <span class="n">skip</span><span class="o">,</span>
      <span class="n">skip</span><span class="o">)</span> <span class="o">()</span>
<span class="kd">end</span> <span class="n">interactive</span>
<span class="kd">end</span> <span class="n">tactic</span>

<span class="kd">lemma</span> <span class="n">oof</span> <span class="o">(</span><span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">d.b</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="c1">-- have := a.h c,</span>
  <span class="n">add_structure_hyps</span> <span class="n">d</span><span class="o">,</span>
  <span class="n">linarith</span>
<span class="kd">end</span>
</code></pre></div>



<a name="261725262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261725262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261725262">(Nov 16 2021 at 23:47)</a>:</h4>
<p>Very cool <span class="user-mention" data-user-id="127136">@Alex J. Best</span>! Thanks - I'll be stealing that immediately!</p>



<a name="261725733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261725733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261725733">(Nov 16 2021 at 23:53)</a>:</h4>
<p>I realise that this probably isn't going to happen, because people don't seem too interested in this more magic version of the idea, but I'd like to refine my description of what I'd ideally like to see.</p>
<p>I would like <em>any tactic</em> that makes use of local hypothesese to automatically see "nested" local hypothesese that exist as <code>structure</code> fields. <code>simp</code>, <code>library_search</code>, <code>finish</code>, <code>linarith</code> etc and anything else that makes use of the local state would have them available.</p>
<p>Without knowing the details of how tactics are implemented, I'm imagining that this could be done by modifying whatever the equivalent of <code>get_local_hypothesese()</code> is.</p>
<p>If this would introduce too much overhead by bringing too many things into scope, I'm happy for this to be opt-in on a per-field basis with an attribute on the <code>structure</code> declaration. Like <code>@[simp]</code>, there are some places where this makes more sense than others.</p>



<a name="261725893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261725893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261725893">(Nov 16 2021 at 23:55)</a>:</h4>
<p>These nested hypotheses wouldn't necessarily need to be <em>actually</em> brought into the local context to be displayed to the user - they would just be visible to tactics that use them.</p>



<a name="261726220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261726220" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261726220">(Nov 16 2021 at 23:56)</a>:</h4>
<p>Do people think this idea is bad and/or technically infeasible?</p>



<a name="261726767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261726767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261726767">(Nov 17 2021 at 00:03)</a>:</h4>
<p>I don't think it's either bad or techinically infeasible. The biggest problem is that is proposes modify many tactics at once (some implemented in core, some in mathlib). We are very keen to keep tactics simple and focused -- think of the philosophy of unix command line tools.</p>



<a name="261726865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261726865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261726865">(Nov 17 2021 at 00:04)</a>:</h4>
<p>I think a <code>with_projections { ... }</code> might be good. It would just pull out projections as local hypotheses during the scope of the <code>{ ... }</code>.</p>



<a name="261726929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261726929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261726929">(Nov 17 2021 at 00:04)</a>:</h4>
<p>As said above, I do think that this change should/could be made to <code>library_search</code>.</p>



<a name="261728103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Implicitly%20bringing%20structure%20field%20props%20into%20context/near/261728103" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Implicitly.20bringing.20structure.20field.20props.20into.20context.html#261728103">(Nov 17 2021 at 00:17)</a>:</h4>
<p>That seems reasonable <span class="user-mention" data-user-id="110087">@Scott Morrison</span>,  and <code>with_projections</code> seems like an interesting way to go.</p>
<p>My motivation is generally increasing the usability of <code>subtype</code>s and <code>subtype</code>-like structures, which appear to be a generally powerful idea, but currently a bit finicky and verbose to use. Conceptually, I think of this not as a modification to individual tactics, but to what it means for something to be in the local context. I now realise that that's probably not how it would work in implementation.</p>
<p>I still think this would be a nice feature, and it doesn't feel like it compromises the simple tactics philosophy to me, but I'll cede to your opinion as being far more informed than mine.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>