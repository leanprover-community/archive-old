---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Coercion.20brackets.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20brackets.html">Coercion brackets</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204581431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20brackets/near/204581431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason KY. <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20brackets.html#204581431">(Jul 21 2020 at 18:03)</a>:</h4>
<p>I'm trying to define quotient groups through congruence and I'm a bit stuck on the following</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory</span><span class="bp">.</span><span class="n">congruence</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span>

<span class="kn">namespace</span> <span class="n">group_con</span>

<span class="kn">structure</span> <span class="n">group_con</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">con</span> <span class="n">G</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inv&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">r</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">→</span> <span class="n">r</span> <span class="n">x</span><span class="bp">⁻¹</span> <span class="n">y</span><span class="bp">⁻¹</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">has_coe_to_setoid</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">group_con</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">setoid</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">⟨λ</span> <span class="n">R</span><span class="o">,</span> <span class="n">R</span><span class="bp">.</span><span class="n">to_con</span><span class="bp">.</span><span class="n">to_setoid</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">group_con</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">R</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">R</span><span class="bp">.</span><span class="n">r</span> <span class="n">x</span> <span class="n">y</span><span class="bp">⟩</span>

<span class="kn">lemma</span> <span class="n">mul</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="n">group_con</span> <span class="n">G</span><span class="o">}</span> <span class="o">{</span><span class="n">x₀</span> <span class="n">x₁</span> <span class="n">y₀</span> <span class="n">y₁</span> <span class="o">:</span> <span class="n">G</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">R</span> <span class="n">x₀</span> <span class="n">x₁</span> <span class="bp">→</span> <span class="n">R</span> <span class="n">y₀</span> <span class="n">y₁</span> <span class="bp">→</span> <span class="n">R</span> <span class="o">(</span><span class="n">x₀</span> <span class="bp">*</span> <span class="n">y₀</span><span class="o">)</span> <span class="o">(</span><span class="n">x₁</span> <span class="bp">*</span> <span class="n">y₁</span><span class="o">)</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply</span> <span class="n">R</span><span class="bp">.</span><span class="n">mul&#39;</span>

<span class="kn">lemma</span> <span class="n">inv</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="n">group_con</span> <span class="n">G</span><span class="o">}</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">}</span> <span class="o">:</span> <span class="n">R</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">→</span> <span class="n">R</span> <span class="n">x</span><span class="bp">⁻¹</span> <span class="n">y</span><span class="bp">⁻¹</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply</span> <span class="n">R</span><span class="bp">.</span><span class="n">inv&#39;</span>

<span class="n">def</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">group_con</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="n">quotient</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="n">setoid</span> <span class="n">G</span><span class="o">)</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="n">group_con</span> <span class="n">G</span><span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="n">G</span> <span class="o">(</span><span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">quotient</span><span class="bp">.</span><span class="n">mk&#39;</span><span class="bp">⟩</span>

<span class="kn">lemma</span> <span class="n">eq</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span>  <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">↔</span> <span class="n">R</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">eq&#39;</span>

<span class="n">def</span> <span class="n">lift_on</span> <span class="o">{</span><span class="n">β</span><span class="o">}</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="n">group_con</span> <span class="n">G</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">R</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">β</span> <span class="o">:=</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">lift_on&#39;</span> <span class="n">x</span> <span class="n">f</span> <span class="n">h</span>

<span class="n">def</span> <span class="n">lift_on₂</span> <span class="o">{</span><span class="n">β</span><span class="o">}</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="n">group_con</span> <span class="n">G</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">→</span> <span class="n">G</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a₁</span> <span class="n">a₂</span> <span class="n">b₁</span> <span class="n">b₂</span><span class="o">,</span> <span class="n">R</span> <span class="n">a₁</span> <span class="n">b₁</span> <span class="bp">→</span> <span class="n">R</span> <span class="n">a₂</span> <span class="n">b₂</span> <span class="bp">→</span> <span class="n">f</span> <span class="n">a₁</span> <span class="n">a₂</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">b₁</span> <span class="n">b₂</span><span class="o">)</span> <span class="o">:</span> <span class="n">β</span> <span class="o">:=</span>
<span class="n">quotient</span><span class="bp">.</span><span class="n">lift_on₂&#39;</span> <span class="n">x</span> <span class="n">y</span> <span class="n">f</span> <span class="n">h</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="o">(</span><span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">mul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">lift_on₂</span> <span class="n">x</span> <span class="n">y</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span> <span class="o">,</span> <span class="o">((</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">))</span>
    <span class="err">$</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h₁</span> <span class="n">h₂</span><span class="o">,</span> <span class="n">eq</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="n">mul</span> <span class="n">h₁</span> <span class="n">h₂</span><span class="o">)</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_inv</span> <span class="o">(</span><span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">⟨λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">lift_on</span> <span class="n">x</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="o">((</span><span class="n">x</span><span class="bp">⁻¹</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">))</span> <span class="err">$</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span><span class="o">,</span> <span class="n">eq</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="n">inv</span> <span class="n">h</span><span class="o">)</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_one</span> <span class="o">(</span><span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="o">((</span><span class="mi">1</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span><span class="bp">⟩</span>

<span class="kn">lemma</span> <span class="n">coe</span>     <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span>   <span class="o">:</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">mk&#39;</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">coe_mul</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="o">((</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">coe_inv</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span>   <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span><span class="bp">⁻¹</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">coe_one</span>           <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="o">((</span><span class="mi">1</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">mul_left_inv&#39;</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">quotient</span><span class="bp">.</span><span class="n">induction_on&#39;</span> <span class="n">a</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">x</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">coe</span><span class="o">],</span>
  <span class="k">show</span> <span class="o">((</span><span class="n">x</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="c1">-- why does it show (↑x)⁻¹ * ↑x = 1 and not ↑(x⁻¹) * ↑x = 1 ?</span>
  <span class="n">sorry</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">group_con</span>
</code></pre></div>


<p>As the comment indicates, why is the lean goal <code>(↑x)⁻¹ * ↑x = 1</code> and not <code>↑(x⁻¹) * ↑x = 1</code>.  My original intention was to <code>rw coe_inv</code> but that doesn't work either.</p>
<p>Sorry for such a long mwe, any help appreciated!</p>



<a name="204582820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20brackets/near/204582820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20brackets.html#204582820">(Jul 21 2020 at 18:15)</a>:</h4>
<p>This sort of thing used to confuse me too. Someone will say "lean reads from left to right" or "lean expands from the outside in" or some such buzz phrase which helps some people but never helps me. But I do know the answer. When Lean sees <code>((x⁻¹) : quotient R)</code> it unfolds it to <code>has_inv.inv x : quotient R</code> and then it decides which <code>has_inv.inv</code> to use. Because the answer is supposed to be in <code>quotient R</code> it decides to use the inverse on <code>quotient R</code>. And <em>then</em> it looks at which element of <code>quotient R</code> it's supposed to be inversing, and it finds something which isn't in quotient R, so it coerces it there.</p>



<a name="204582903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20brackets/near/204582903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20brackets.html#204582903">(Jul 21 2020 at 18:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  <span class="k">show</span> <span class="o">((</span><span class="n">x</span><span class="bp">⁻¹</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">quotient</span> <span class="n">R</span><span class="o">)</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
</code></pre></div>


<p>gives you the behaviour you want.</p>



<a name="204583590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coercion%20brackets/near/204583590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason KY. <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coercion.20brackets.html#204583590">(Jul 21 2020 at 18:21)</a>:</h4>
<p>Ah! That makes a lot of sense, thanks!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>