---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html">covariant_class ℝ and ring_nf in calc</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="264570591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264570591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Johnson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264570591">(Dec 11 2021 at 16:20)</a>:</h4>
<p>While practicing <code>calc</code> proof mode, I got stuck on this simple inequality:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.real.basic</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">4</span> <span class="bp">/</span> <span class="n">b</span><span class="o">)</span> <span class="bp">≥</span> <span class="mi">9</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply</span> <span class="n">sub_nonneg.mp</span><span class="o">,</span>
  <span class="n">apply</span> <span class="o">(</span><span class="n">mul_le_mul_right</span> <span class="o">(</span><span class="n">mul_pos</span> <span class="n">h₁</span> <span class="n">h₂</span><span class="o">))</span><span class="bp">.</span><span class="n">mp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">_</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">sq_nonneg</span> <span class="n">_</span>
  <span class="bp">...</span>    <span class="bp">≤</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">ring_nf</span>
  <span class="bp">...</span>    <span class="bp">≤</span> <span class="o">((</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">4</span> <span class="bp">/</span> <span class="n">b</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="gr">sorry</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p>So I am interested to know:</p>
<ul>
<li>Why can't the first <code>sorry</code> be solved <code>by ring_nf</code>?</li>
<li>Why does the second <code>sorry</code> ask me to prove <code>covariant_class ℝ ℝ (function.swap has_add.add) has_le.le</code>?</li>
<li>Can this proof be simplified somehow?</li>
</ul>



<a name="264571278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264571278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264571278">(Dec 11 2021 at 16:34)</a>:</h4>
<p>Division isn't a thing in rings, and neither is &lt;=, so the first <code>sorry</code> is out of scope for ringlike tactics for two reasons. There's a "clear denominators" tactic, and you probably want to change the &lt;= to an =.</p>



<a name="264571410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264571410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264571410">(Dec 11 2021 at 16:37)</a>:</h4>
<p>Also if things are equalities rather than inequalities you can state them as such, calc will still produce an inequality from a chain of <code>\le</code> and <code>=</code>, edit: oops just saw kevin already wrote this</p>



<a name="264571478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264571478" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264571478">(Dec 11 2021 at 16:38)</a>:</h4>
<p>P.s. its always easier to help if you include the imports, in this case <code>import data.real.basic</code></p>



<a name="264571495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264571495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264571495">(Dec 11 2021 at 16:39)</a>:</h4>
<p>Why if I use the (correct) <code>ring</code> instead of <code>ring_nf</code> the line above the first sorry, does it close the relevant goal and still tell me to use <code>ring_nf</code>? Is this a bug?</p>



<a name="264571914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264571914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264571914">(Dec 11 2021 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc/near/264571495">said</a>:</p>
<blockquote>
<p>Why if I use the (correct) <code>ring</code> instead of <code>ring_nf</code> the line above the first sorry, does it close the relevant goal and still tell me to use <code>ring_nf</code>? Is this a bug?</p>
</blockquote>
<p>Is your mathlib up to date? Mario made a couple changes to <code>ring</code> this week, one to address a bug exactly like this</p>



<a name="264572350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264572350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264572350">(Dec 11 2021 at 16:56)</a>:</h4>
<blockquote>
<p>Is your mathlib up to date?</p>
</blockquote>
<p>It is!</p>



<a name="264572464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264572464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264572464">(Dec 11 2021 at 16:58)</a>:</h4>
<p>Oh, <code>ring_nf</code> is the right tactic there. <code>ring</code> is for equations, this is proving an inequality by normalizing to 0 &lt;= 0</p>



<a name="264572521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264572521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264572521">(Dec 11 2021 at 16:59)</a>:</h4>
<blockquote>
<p>Why does the second sorry ask me to <code>prove covariant_class ℝ ℝ (function.swap has_add.add) has_le.le</code>?</p>
</blockquote>
<p>This goal appeared when you did the unconventional <code>apply sub_nonneg.mp</code>, as you can see if you put your cursor before and after that tactic. <code>apply</code> is not always the cleverest when it comes to type class inference. You would be better off doing <code>rw \l sub_nonneg</code>. You can solve the second goal with <code>apply_instance</code>, the tactic which says "solve this goal using type class inference".</p>



<a name="264572664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264572664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264572664">(Dec 11 2021 at 17:00)</a>:</h4>
<p>Oh, except the rewrite fails because you have you have not written your example in Lean's normal form: you should use &lt;= not &gt;=.</p>



<a name="264572847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/covariant_class%20%E2%84%9D%20and%20ring_nf%20in%20calc/near/264572847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/covariant_class.20.E2.84.9D.20and.20ring_nf.20in.20calc.html#264572847">(Dec 11 2021 at 17:04)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">tactic.field_simp</span> <span class="c1">-- clear denominator tactic</span>
<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">a</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">9</span> <span class="bp">≤</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">4</span> <span class="bp">/</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="bp">←</span> <span class="n">sub_nonneg</span><span class="o">,</span>
  <span class="n">apply</span> <span class="o">(</span><span class="n">mul_le_mul_right</span> <span class="o">(</span><span class="n">mul_pos</span> <span class="n">h₁</span> <span class="n">h₂</span><span class="o">))</span><span class="bp">.</span><span class="n">mp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">zero_mul</span><span class="o">,</span>
  <span class="k">calc</span> <span class="n">_</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="bp">^</span> <span class="mi">2</span> <span class="o">:</span> <span class="n">sq_nonneg</span> <span class="n">_</span>
  <span class="bp">...</span>    <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">9</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">ring</span>
  <span class="bp">...</span>    <span class="bp">=</span> <span class="o">((</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">/</span> <span class="n">a</span> <span class="bp">+</span> <span class="mi">4</span> <span class="bp">/</span> <span class="n">b</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">9</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">_</span><span class="o">,</span>
  <span class="n">field_simp</span> <span class="o">[(</span><span class="n">ne_of_gt</span> <span class="n">h₁</span><span class="o">),</span> <span class="o">(</span><span class="n">ne_of_gt</span> <span class="n">h₂</span><span class="o">)],</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>