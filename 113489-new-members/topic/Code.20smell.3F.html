---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Code.20smell.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html">Code smell?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="281498046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281498046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281498046">(May 06 2022 at 21:48)</a>:</h4>
<p>Is it a code smell if I often write <code>apply congr_arg,</code> in my proofs?</p>



<a name="281498309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281498309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281498309">(May 06 2022 at 21:51)</a>:</h4>
<p>Sometimes you might want <code>congr' 1,</code> instead. <code>refine congr_arg _ _</code> can also sometimes be more predictable</p>



<a name="281524465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281524465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281524465">(May 07 2022 at 06:59)</a>:</h4>
<p>Is it a code smell if I write <code>change</code> immediately followed by <code>convert_to</code> in some places (not many) of my proofs?</p>



<a name="281524793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281524793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281524793">(May 07 2022 at 07:07)</a>:</h4>
<p>My experience with <code>change</code> is that often you are better off proving a <code>rfl</code> lemma doing the change for you.  In some cases this simple trick has spectacular proof-shortening effects.  I wish I had an example at hand, but I don't at the moment.</p>



<a name="281525786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281525786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281525786">(May 07 2022 at 07:32)</a>:</h4>
<p>You mean a lemma that "restates" the definition?</p>



<a name="281527459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281527459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281527459">(May 07 2022 at 08:17)</a>:</h4>
<p>Yes, just a lemma whose proof is <code>rfl</code>, guiding lean through the definition.</p>



<a name="281527674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281527674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281527674">(May 07 2022 at 08:22)</a>:</h4>
<p>Is there no better way how to tell Lean to apply / unapply definition without creating this boilerplate? Unfortunately <code>unfold</code> does not always do what I want.</p>



<a name="281527911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281527911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281527911">(May 07 2022 at 08:27)</a>:</h4>
<p>Can you give an example of a definition where <code>unfold</code> does the wrong thing?</p>



<a name="281527962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281527962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281527962">(May 07 2022 at 08:28)</a>:</h4>
<p>Yes, I can. However, making MWE out of it will probably be hard.</p>



<a name="281527986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281527986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281527986">(May 07 2022 at 08:29)</a>:</h4>
<p>What's the non-mwe version? Can you link to a gist or something?</p>



<a name="281528140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281528140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281528140">(May 07 2022 at 08:33)</a>:</h4>
<p>On this line:<br>
<a href="https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/closure_properties/binary/CF_union_CF.lean#L326">https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/closure_properties/binary/CF_union_CF.lean#L326</a></p>
<p>I am unpacking this definition:<br>
<a href="https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/cfg.lean#L29">https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/cfg.lean#L29</a></p>
<p>Unfotunately <code>unfold CF_generates,</code> does not work.</p>



<a name="281528202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281528202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281528202">(May 07 2022 at 08:35)</a>:</h4>
<p>It gives me: <code>simplify tactic failed to simplify</code></p>



<a name="281528765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281528765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281528765">(May 07 2022 at 08:46)</a>:</h4>
<p>What's the goal state at that point</p>



<a name="281528837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281528837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281528837">(May 07 2022 at 08:48)</a>:</h4>
<p>I would like to obtain <code>CF_generates_str (union_grammar g₁ g₂) (list.map symbol.terminal w),</code> without stating it explicitly. My <code>change</code> only does what I supposed that <code>unfold</code> would do.</p>



<a name="281528935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281528935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281528935">(May 07 2022 at 08:51)</a>:</h4>
<p>I would say that <code>unfold</code> is a code smell indicating that there is missing boilerplate.</p>



<a name="281529019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281529019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281529019">(May 07 2022 at 08:52)</a>:</h4>
<p>Is there really no better way than repeating the definition again as a lemma? I hate how it looks.</p>



<a name="281529683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281529683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281529683">(May 07 2022 at 09:09)</a>:</h4>
<p>Does <code>rw CF_generates</code> do what you want?</p>



<a name="281529752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281529752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281529752">(May 07 2022 at 09:11)</a>:</h4>
<p>It gives me: <code>failed</code></p>



<a name="281529895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281529895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281529895">(May 07 2022 at 09:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/281528837">said</a>:</p>
<blockquote>
<p>I would like to obtain <code>CF_generates_str (union_grammar g₁ g₂) (list.map symbol.terminal w),</code> without stating it explicitly. My <code>change</code> only does what I supposed that <code>unfold</code> would do.</p>
</blockquote>
<p>Yes, but what was the goal state before that?</p>



<a name="281529967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281529967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281529967">(May 07 2022 at 09:17)</a>:</h4>
<p>Oh sorry. It was: <code>w ∈ CF_generates (union_grammar g₁ g₂)</code></p>



<a name="281530010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530010">(May 07 2022 at 09:18)</a>:</h4>
<p>That goal is nonsense</p>



<a name="281530012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530012">(May 07 2022 at 09:18)</a>:</h4>
<p><code>CF_generates </code> isn't a set</p>



<a name="281530021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530021">(May 07 2022 at 09:18)</a>:</h4>
<p>How did you get there?</p>



<a name="281530037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530037">(May 07 2022 at 09:19)</a>:</h4>
<p>Is <code>language</code> <a href="https://leanprover-community.github.io/mathlib_docs/find/language">docs#language</a>?</p>



<a name="281530040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530040">(May 07 2022 at 09:19)</a>:</h4>
<p>If so, these lines are wrong<br>
<a href="https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/cfg.lean#L33-L34">https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/cfg.lean#L33-L34</a></p>



<a name="281530044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530044">(May 07 2022 at 09:19)</a>:</h4>
<p>That should be</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">CF_language</span> <span class="o">:</span> <span class="n">language</span> <span class="n">T</span> <span class="o">:=</span>
<span class="n">set_of</span> <span class="o">(</span><span class="n">CF_generates</span> <span class="n">g</span><span class="o">)</span>
</code></pre></div>



<a name="281530216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530216">(May 07 2022 at 09:23)</a>:</h4>
<p>Oh, thanks a lot!!</p>
<p>So I cannot use <code>set t</code> as <code>t → Prop</code> hoping that it is definitionally equivalent?</p>



<a name="281530224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530224">(May 07 2022 at 09:23)</a>:</h4>
<p>You'll find you have to fight with <code>change</code> all the time if you do that</p>



<a name="281530278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530278">(May 07 2022 at 09:24)</a>:</h4>
<p>Thank you very much!!! This change will eliminate <code>change</code> in so many places!!!</p>



<a name="281530286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530286">(May 07 2022 at 09:24)</a>:</h4>
<p>They're definitionally equivalent, but to keep things in a state where lean will help you, you use <code>∈ </code> to convert a set into a function, and <a href="https://leanprover-community.github.io/mathlib_docs/find/set_of">docs#set_of</a> (aka <code>{x | p x}</code>) to convert a function into a set</p>



<a name="281530426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530426">(May 07 2022 at 09:28)</a>:</h4>
<p>I don't know whether it is related but... When I have a goal in the form of <code>list.mem a L</code> existing lemmata about lists don't work. I have to <code>change</code> it to <code>a ∈ L</code> and only then they can be applied. Is there a similar trick for that?</p>



<a name="281530633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530633">(May 07 2022 at 09:34)</a>:</h4>
<p>Same question. How did you get there?</p>



<a name="281530987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281530987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281530987">(May 07 2022 at 09:42)</a>:</h4>
<p>I had: <code>r_in : r ∈ (head :: tail)</code><br>
<a href="https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/closure_properties/binary/CF_union_CF.lean#L151">https://github.com/madvorak/grammars/blob/75c5d5db4be45957bafd1d651086821af4373472/src/context_free/closure_properties/binary/CF_union_CF.lean#L151</a><br>
I called: <code>cases r_in,</code><br>
The first case was great: <code>r = head</code><br>
The second case was: <code>list.mem r tail</code><br>
What could I have done instead to obtain <code>r ∈ tail</code> please?</p>



<a name="281531281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531281">(May 07 2022 at 09:48)</a>:</h4>
<p>You should have looked for a lemma that matches the form of the hypothesis</p>



<a name="281531284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531284">(May 07 2022 at 09:48)</a>:</h4>
<p><a href="https://leanprover-community.github.io/contribute/naming.html">#naming</a> suggests it would be called <a href="https://leanprover-community.github.io/mathlib_docs/find/list.mem_cons">docs#list.mem_cons</a></p>



<a name="281531295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531295">(May 07 2022 at 09:49)</a>:</h4>
<p>Clicking that link reveals it's called <a href="https://leanprover-community.github.io/mathlib_docs/find/list.mem_cons_iff">docs#list.mem_cons_iff</a></p>



<a name="281531303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531303">(May 07 2022 at 09:49)</a>:</h4>
<p>Either way, if you type <code>list.mem_cons</code> in vs-code, autocomplete should do the rest</p>



<a name="281531321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531321">(May 07 2022 at 09:49)</a>:</h4>
<p>Thanks a lot!!!</p>



<a name="281531326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531326">(May 07 2022 at 09:50)</a>:</h4>
<p>Is there a general methodical mistake that I make?</p>



<a name="281531372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531372">(May 07 2022 at 09:50)</a>:</h4>
<p>In fact, <code>cases list.eq_or_mem_of_mem_cons r_in</code> is probably what you want, where that lemma is just below the one I linked to</p>



<a name="281531379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531379">(May 07 2022 at 09:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/281531326">said</a>:</p>
<blockquote>
<p>Is there a general methodical mistake that I make?</p>
</blockquote>
<p>Always search for a lemma before unfolding. To some extent, <code>cases</code> does unfolding too. Use your judgement on the output of <code>cases</code> to decide if you might have unfolded too far</p>



<a name="281531388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531388">(May 07 2022 at 09:51)</a>:</h4>
<p>An easy way to search for useful lemmas is just <code>simp?</code></p>



<a name="281531394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531394">(May 07 2022 at 09:51)</a>:</h4>
<p>I learnt to use <code>squeeze_simp</code> only recently.</p>



<a name="281531396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531396">(May 07 2022 at 09:51)</a>:</h4>
<p>Which might not get you to where you want to be, but will usually take you to a place where it's easier to find matching lemmas</p>



<a name="281531399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281531399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281531399">(May 07 2022 at 09:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/281531394">said</a>:</p>
<blockquote>
<p>I learnt to use <code>squeeze_simp</code> only recently.</p>
</blockquote>
<p>That's better than <code>simp?</code> but a bit slower</p>



<a name="281541722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281541722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281541722">(May 07 2022 at 13:53)</a>:</h4>
<p>Is it a code smell when I have the following pair of lines in my code?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rw</span> <span class="n">some_lemma</span><span class="o">,</span>
<span class="n">rw</span> <span class="n">some_lemma</span> <span class="n">at</span> <span class="n">some_assumption</span><span class="o">,</span>
</code></pre></div>



<a name="281541804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281541804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rémy Degenne <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281541804">(May 07 2022 at 13:55)</a>:</h4>
<p>You can write instead the shorter</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rw</span> <span class="n">some_lemma</span> <span class="n">at</span> <span class="n">some_assumption</span> <span class="bp">⊢</span><span class="o">,</span>
</code></pre></div>
<p>That last sign means the goal.</p>



<a name="281541859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/281541859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rémy Degenne <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#281541859">(May 07 2022 at 13:57)</a>:</h4>
<p>Writing such a line is not uncommon and not a code smell in itself</p>



<a name="284584721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284584721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284584721">(Jun 01 2022 at 09:06)</a>:</h4>
<p>Is it idiomatic to use <code>variable</code> instead of <code>variables</code> when adding a single (implicit) argument?</p>



<a name="284584948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284584948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284584948">(Jun 01 2022 at 09:09)</a>:</h4>
<p>I tend not to because my brain always bugs when I then add another variable to it and get a weird error.</p>



<a name="284585104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585104">(Jun 01 2022 at 09:10)</a>:</h4>
<p>Yeah, I agree; the very marginal readability benefit is totally outweighed by the awkwardness to edit</p>



<a name="284585145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585145">(Jun 01 2022 at 09:11)</a>:</h4>
<p>It would be like having <code>[1, 2, and 3]</code> as list notation</p>



<a name="284585330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585330">(Jun 01 2022 at 09:13)</a>:</h4>
<p>It smells like a slightly bad design decision that both <code>variable</code> and <code>variables</code> exist.</p>



<a name="284585442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585442">(Jun 01 2022 at 09:15)</a>:</h4>
<p>I think it would be fine if they were functionally the same.</p>



<a name="284585445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585445">(Jun 01 2022 at 09:15)</a>:</h4>
<p>However, I am pretty fine with both <code>intro</code> and <code>intros</code> because I almost never edit them.</p>



<a name="284585877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585877">(Jun 01 2022 at 09:19)</a>:</h4>
<p>Note that in lean 4 <code>variable</code> has been deleted and <code>variables</code> has been renamed to <code>variable</code></p>



<a name="284585987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284585987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284585987">(Jun 01 2022 at 09:20)</a>:</h4>
<p>I think <code>intro</code> is just as bad TBH. <code>rintro</code> is just silently identical to <code>rintros</code></p>



<a name="284586034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284586034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284586034">(Jun 01 2022 at 09:21)</a>:</h4>
<p>Yeah, I always use <code>rintro</code> instead of <code>intro</code> and <code>intros</code> for the same reasons.</p>



<a name="284586175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284586175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284586175">(Jun 01 2022 at 09:22)</a>:</h4>
<p>Plural<del>s</del> were a mistake <span aria-label="trademark" class="emoji emoji-2122" role="img" title="trademark">:trademark:</span></p>



<a name="284586399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284586399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284586399">(Jun 01 2022 at 09:25)</a>:</h4>
<p>Although, a variation on this same "one looks different from more than one" issue is <code>rw e</code> vs <code>rw [e1, e2]</code></p>



<a name="284586424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284586424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284586424">(Jun 01 2022 at 09:25)</a>:</h4>
<p>lean 4 also removed the first version, possibly for this reason</p>



<a name="284586638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284586638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284586638">(Jun 01 2022 at 09:27)</a>:</h4>
<p>I really like <code>rw e</code> as it works in lean 3.</p>



<a name="284588005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284588005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284588005">(Jun 01 2022 at 09:41)</a>:</h4>
<p>BTW, is it a bad style if I declare <code>variables</code> which are then used only in small portion of the stuff in the given scope?</p>



<a name="284588030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284588030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284588030">(Jun 01 2022 at 09:41)</a>:</h4>
<p>We do it all the time in mathlib</p>



<a name="284588209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284588209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284588209">(Jun 01 2022 at 09:43)</a>:</h4>
<p>Is it OK even if they occupy "expensive" identifiers (i.e., one-letter names)?</p>



<a name="284588894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284588894" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284588894">(Jun 01 2022 at 09:51)</a>:</h4>
<p>You can always "shadow" expensive variable names in <code>lemma</code> statements</p>



<a name="284589035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284589035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284589035">(Jun 01 2022 at 09:52)</a>:</h4>
<p>The two main problems you face when having too many variables are usually:</p>
<ul>
<li>Having a type <code>R</code> that has too many typeclasses in the <code>variables</code> list, and not being able to easily exclude those without declaring a brand new <code>R</code></li>
<li>Not remembering whether the <code>variables</code> line 100 lines up the file uses <code>()</code> or <code>{}</code> to declare the variables, and getting your argument implicitness wrong as a result</li>
</ul>



<a name="284789687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284789687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284789687">(Jun 02 2022 at 19:01)</a>:</h4>
<p>Am I the only one who finds it confusing to use <code>variables</code> for explicit arguments <code>(a : T)</code> shared by multiple items? I have a natural tendency to expect, when I look at a declaration of a function, to see all arguments that I need to pass when calling the function.</p>
<p>The code intellisense "quick info" in VSCode shows all arguments (including those written using <code>variables</code> anywhere above) but I like to look at my definition in the code. There I easily get confused by an "invisible" required argument.</p>



<a name="284789846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284789846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Violeta Hernández <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284789846">(Jun 02 2022 at 19:02)</a>:</h4>
<p>I agree that it's confusing. Gets particularly annoying when you add a few extra theorems and suddenly the argument <code>a</code> can be made implicit in them</p>



<a name="284790044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284790044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284790044">(Jun 02 2022 at 19:04)</a>:</h4>
<p>So, should I use <code>variables</code> only for <code>{stuff}</code> and <code>[stuff]</code> for the sake of code readability?</p>



<a name="284790219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284790219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Violeta Hernández <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284790219">(Jun 02 2022 at 19:05)</a>:</h4>
<p>I mean, if you have 15 theorems in a code block and all of them need an explicit argument, I'd say using <code>variables (stuff)</code> is fine</p>



<a name="284790292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284790292" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Violeta Hernández <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284790292">(Jun 02 2022 at 19:06)</a>:</h4>
<p>But if it's just a handful, then it's not a great idea</p>



<a name="284791413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284791413" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284791413">(Jun 02 2022 at 19:14)</a>:</h4>
<p>I'd like to hear more opinions about this issue. It has been bugging me recently a lot.</p>



<a name="284791904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284791904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284791904">(Jun 02 2022 at 19:18)</a>:</h4>
<p>I have the same stance as Violeta. Unless all your lemmas are gonna need the same explicit arguments, restrict <code>variables</code> declarations to implicit or instance arguments.</p>



<a name="284791998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284791998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284791998">(Jun 02 2022 at 19:19)</a>:</h4>
<p>And if they do, does it justify the loss of readability?</p>



<a name="284792169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284792169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Violeta Hernández <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284792169">(Jun 02 2022 at 19:20)</a>:</h4>
<p>I think that in some cases, you gain a lot of readability. Writing down <code>(a : T) (b : U) (c : V)</code> over and over, particularly when the types have much longer names, and particularly when they're clear from context, is quite a chore</p>



<a name="284793044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284793044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284793044">(Jun 02 2022 at 19:27)</a>:</h4>
<p>I think my view lies closer to Martin's here. One other case to consider; if one of your explicit arguments is a <code>Type</code>, it's a chore to repeat all its typeclasses on a lemma. Usually this is handled with <code>variables (R)</code> <code>the_lemma</code> <code>variables {R}</code></p>



<a name="284793088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284793088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284793088">(Jun 02 2022 at 19:27)</a>:</h4>
<p>Which is still fairly readable because the explicit argument is adjacent</p>



<a name="284903455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284903455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284903455">(Jun 03 2022 at 16:43)</a>:</h4>
<p>Is there a shortcut for the following two lines?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">rw</span> <span class="n">set.mem_set_of_eq</span> <span class="n">at</span> <span class="bp">⊢</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">set.mem_set_of_eq</span> <span class="n">at</span> <span class="bp">⊢</span><span class="o">,</span>
</code></pre></div>
<p>I want to apply <code>set.mem_set_of_eq</code> twice to the goal and once to <code>h</code>.</p>



<a name="284903648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284903648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284903648">(Jun 03 2022 at 16:45)</a>:</h4>
<p>Does</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">set.mem_set_of_eq</span><span class="o">]</span> <span class="n">at</span> <span class="bp">⊢</span> <span class="n">h</span>
</code></pre></div>
<p>work?</p>



<a name="284903903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284903903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284903903">(Jun 03 2022 at 16:47)</a>:</h4>
<p><code>dsimp at ⊢ h,</code>?</p>



<a name="284904053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284904053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284904053">(Jun 03 2022 at 16:48)</a>:</h4>
<p>Or even not doing anything?  <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="284904159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284904159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284904159">(Jun 03 2022 at 16:49)</a>:</h4>
<p>Ah yes, I didn't even had a look of what the lemma was.<br>
To clarify, the lemma is useful for a human being, but the LHS is defined to be the RHS, so it's possible the Lean doesn't need it at all.</p>



<a name="284905520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284905520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284905520">(Jun 03 2022 at 17:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/284903648">said</a>:</p>
<blockquote>
<p>Does</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">set.mem_set_of_eq</span><span class="o">]</span> <span class="n">at</span> <span class="bp">⊢</span> <span class="n">h</span>
</code></pre></div>
<p>work?</p>
</blockquote>
<p>Yes, it does. However, I don't like calling <code>simp</code> for something that I know precisely how to do.</p>



<a name="284906114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284906114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284906114">(Jun 03 2022 at 17:05)</a>:</h4>
<p>I tried <code>rw set.mem_set_of_eq at ⊢ h ⊢,</code> but was disappointed.</p>



<a name="284906314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284906314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284906314">(Jun 03 2022 at 17:06)</a>:</h4>
<p>I don't mind that much that I have to write two nearly-identical lines. I hate that the "three operations" are grouped into "two commands" in a counter-intuitive way.</p>



<a name="284906677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284906677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284906677">(Jun 03 2022 at 17:09)</a>:</h4>
<p>Maybe you could try <code>repeat { rw set.mem_set_of_eq, try { rw set.mem_set_of_eq at h } }</code>?</p>



<a name="284906699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284906699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284906699">(Jun 03 2022 at 17:09)</a>:</h4>
<p>I'm not sure what we are aiming for here, though...</p>



<a name="284907067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284907067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284907067">(Jun 03 2022 at 17:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/284906699">said</a>:</p>
<blockquote>
<p>I'm not sure what we are aiming for here, though...</p>
</blockquote>
<p>I am aiming for something less awkward. If it cannot be done, I will put up with it.</p>



<a name="284907112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284907112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284907112">(Jun 03 2022 at 17:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321459">Damiano Testa</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/284906677">said</a>:</p>
<blockquote>
<p>Maybe you could try <code>repeat { rw set.mem_set_of_eq, try { rw set.mem_set_of_eq at h } }</code>?</p>
</blockquote>
<p>I'd rather write three lines than this.</p>



<a name="284907196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284907196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284907196">(Jun 03 2022 at 17:14)</a>:</h4>
<p>But have you tried just skipping the rw?</p>



<a name="284907209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284907209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284907209">(Jun 03 2022 at 17:14)</a>:</h4>
<p>What is the next line in your proof?</p>



<a name="284907624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284907624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284907624">(Jun 03 2022 at 17:18)</a>:</h4>
<p>I know I can skip this <code>rw</code>. However, according to some advice I obtained here previously, I decided to define stuff with <code>set_of</code> in order to avoid the command <code>change</code>. So now, I want to take advantage of that. I am aware that <code>set.mem_set_of_eq</code> does only a definitional equality; however, it has impact on the effect of some other tactics. And I don't feel like going to <code>change</code> again.</p>



<a name="284907671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284907671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284907671">(Jun 03 2022 at 17:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/284905520">said</a>:</p>
<blockquote>
<p>Yes, it does. However, I don't like calling <code>simp</code> for something that I know precisely how to do.</p>
</blockquote>
<p>I'm curious what the motivation is for this preference -- <code>simp</code> is designed for repeatedly doing rewrites like this.</p>
<p>But if this preference is strong, you can refactor it as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">repeat</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">set.mem_set_of_eq</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="n">set.mem_set_of_eq</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
</code></pre></div>



<a name="284908501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284908501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284908501">(Jun 03 2022 at 17:25)</a>:</h4>
<p>Calling <code>simp</code> performs some kind of state-space search. Why would I tell the computer to perform the search every time it rebuilds my project if I can explicitly say what three substitutions lead to the desired state?</p>



<a name="284908707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284908707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284908707">(Jun 03 2022 at 17:27)</a>:</h4>
<p>BTW, I don't like calling <code>repeat</code> for something that I want to do exactly twice. What is your preference?</p>



<a name="284908900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284908900" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284908900">(Jun 03 2022 at 17:28)</a>:</h4>
<p>Regarding your state-space search, it would be interesting to measure the time difference.  After all, <code>rw</code> also looks around the expression to find locations to perform the rewrite.  I wonder which one is faster.  It might depend on the expression itself...</p>



<a name="284909124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284909124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284909124">(Jun 03 2022 at 17:30)</a>:</h4>
<p>I have certainly observed <code>simp</code> producing shorter proof terms than the corresponding chain of rewrites, but not always.</p>



<a name="284909298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284909298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284909298">(Jun 03 2022 at 17:31)</a>:</h4>
<p>I like to use <code>simp</code> together with <code>have</code> or <code>convert</code> but not in the middle of my proof.</p>



<a name="284909426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284909426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284909426">(Jun 03 2022 at 17:32)</a>:</h4>
<p>I know that <code>simp only</code> is pretty safe to use, but I still don't like it in non-terminal positions.</p>



<a name="284909459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284909459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284909459">(Jun 03 2022 at 17:32)</a>:</h4>
<p>I'm also wary of non-terminal simps, so I understand your concern.</p>



<a name="284909644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284909644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284909644">(Jun 03 2022 at 17:34)</a>:</h4>
<p>In general, I prefer to use <code>simp</code> less often. Also my friends make fun of me: "Look, Martin is simping for math again!"</p>



<a name="284909914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284909914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284909914">(Jun 03 2022 at 17:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/284908501">said</a>:</p>
<blockquote>
<p>Calling <code>simp</code> performs some kind of state-space search.</p>
</blockquote>
<p>How much work do you think it's doing here? It might be called "simp" but that doesn't mean it's looking for the simplest representation (unless the <code>simp</code> lemmas you provide cause it to enter rewrite cycles, like with <code>add_assoc</code> and <code>add_comm</code> together)</p>



<a name="284910003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284910003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284910003">(Jun 03 2022 at 17:37)</a>:</h4>
<p>simp only is not calling any lemmas other than the ones you provide. It still does things that rw doesn't, like beta reduction</p>



<a name="284910015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284910015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284910015">(Jun 03 2022 at 17:37)</a>:</h4>
<p>If you don't like <code>repeat</code>, then try <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#iterate">tactic#iterate</a> or </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">rw</span> <span class="o">[</span><span class="n">set.mem_set_of_eq</span><span class="o">,</span> <span class="n">set.mem_set_of_eq</span><span class="o">],</span>
  <span class="n">rw</span> <span class="n">set.mem_set_of_eq</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
</code></pre></div>



<a name="284924791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284924791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Stuart Presnell <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284924791">(Jun 03 2022 at 19:45)</a>:</h4>
<p>If you’re doing something to be PRed to mathlib then the preference is (other things being equal) for shorter solutions. So if <code>simp only</code> does the job, your personal preference for a more verbose spelling likely won’t make it through review. Of course, this isn’t an issue if you’re just writing for your own projects.</p>



<a name="284927156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/284927156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#284927156">(Jun 03 2022 at 20:09)</a>:</h4>
<p>Yes, it is a project that only I write.</p>



<a name="285023237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/285023237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#285023237">(Jun 05 2022 at 07:35)</a>:</h4>
<p>Is there a more idiomatic way how to write <code>clear_except,</code> to delete everything but the goal?</p>



<a name="286932985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286932985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286932985">(Jun 21 2022 at 15:40)</a>:</h4>
<p>Is there a shortcut for the following construction?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="n">sublemma</span> <span class="o">:</span> <span class="bp">∃</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="bp">...</span><span class="o">),</span>
<span class="o">{</span>
  <span class="o">(</span><span class="bp">...</span><span class="o">)</span>
<span class="o">},</span>
<span class="n">cases</span> <span class="n">sublemma</span> <span class="k">with</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span>
</code></pre></div>
<p>I repeat lines like the above very often.</p>



<a name="286933610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286933610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286933610">(Jun 21 2022 at 15:44)</a>:</h4>
<p>I think <code>obtain</code> is meant to be the shortcut for <code>have</code> + <code>cases</code> -- i.e. <code>obtain \&lt;x, hx\&gt; := stuffinyourproof</code>, with or without the explicit type if necessary</p>



<a name="286933736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286933736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286933736">(Jun 21 2022 at 15:45)</a>:</h4>
<p>I can't remember whether <code>obtain</code> suuports the <code>,</code> syntax instead of <code>:= { ... }</code> specifically, but otherwise yes</p>



<a name="286935022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286935022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286935022">(Jun 21 2022 at 15:53)</a>:</h4>
<p>it does</p>



<a name="286935082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286935082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286935082">(Jun 21 2022 at 15:53)</a>:</h4>
<p>you have to give the type if you want to pattern match though, <code>obtain \&lt;x, y\&gt;,</code> doesn't work</p>



<a name="286951332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286951332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286951332">(Jun 21 2022 at 17:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/286935082">said</a>:</p>
<blockquote>
<p>you have to give the type if you want to pattern match though, <code>obtain \&lt;x, y\&gt;,</code> doesn't work</p>
</blockquote>
<p>I assume that's because the notation is ambiguous when you have nested constructors?</p>



<a name="286951795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286951795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286951795">(Jun 21 2022 at 17:57)</a>:</h4>
<p>Like  if you want to <code>obtain \&lt;x, y, z\&gt;</code> of type <code>(p \and q) \and (r \and s)</code>.</p>



<a name="286952919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286952919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286952919">(Jun 21 2022 at 18:05)</a>:</h4>
<p>No, it's always right associative in that sense. It's because it is ambiguous what we are destructing: it could be <code>Exists.rec</code> or <code>and.rec</code> or <code>nat.rec</code></p>



<a name="286953117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286953117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286953117">(Jun 21 2022 at 18:06)</a>:</h4>
<p>you can't pattern match on something of unknown type: <code>obtain &lt;x, y&gt; := _</code> is an error</p>



<a name="286955440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955440">(Jun 21 2022 at 18:24)</a>:</h4>
<p>I'm not sure if I don't get it or if I am thinking the same. Say I <code>have</code> something of type <code>(∃ n : ℕ, p n) ∧ (∃ n : ℕ, q n)</code>. How is this different from <code>((p ∧ q) ∧ r) ∧ ((s ∧ t) ∧ u)</code> (except for the fact that the <code>n</code>s can be further destructed) ?</p>



<a name="286955515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955515">(Jun 21 2022 at 18:24)</a>:</h4>
<p>you can't use <code>exists.rec</code> to destruct an element of the second type</p>



<a name="286955522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955522">(Jun 21 2022 at 18:24)</a>:</h4>
<p>I mean, I agree that it's ambiguous, I am just surprised that you (seem to) say that it's not for something like <code>(p ∧ q) ∧ (s ∧ t)</code></p>



<a name="286955555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955555">(Jun 21 2022 at 18:25)</a>:</h4>
<p>the tactic has to decide what theorem to apply, and it needs the type to do that</p>



<a name="286955616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955616">(Jun 21 2022 at 18:25)</a>:</h4>
<p>the brackets can be nested in different ways if you want to destruct stuff like <code>(p ∧ q) ∧ (s ∧ t)</code></p>



<a name="286955689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955689">(Jun 21 2022 at 18:26)</a>:</h4>
<p>you would need to use <code>&lt;&lt;hp, hq&gt;, &lt;hs, ht&gt;&gt;</code> to match that</p>



<a name="286955768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955768">(Jun 21 2022 at 18:26)</a>:</h4>
<p>obtain doesn't try to be smart about associativity if you don't write the brackets correctly</p>



<a name="286955848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955848">(Jun 21 2022 at 18:27)</a>:</h4>
<p>you can also use <code>&lt;&lt;hp, hq&gt;, hs, ht&gt;</code> in that case but that's just because the angle brackets are always interpreted as right associative</p>



<a name="286955882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286955882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286955882">(Jun 21 2022 at 18:27)</a>:</h4>
<p><code>&lt;hp, hq, &lt;hs, ht&gt;&gt;</code> would not work</p>



<a name="286956267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956267">(Jun 21 2022 at 18:31)</a>:</h4>
<p>But then I don't see why lean wouldn't know what to destruct. Can it not just look at the top-most symbol?</p>



<a name="286956276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956276">(Jun 21 2022 at 18:31)</a>:</h4>
<p>When you say "It's because it is ambiguous what we are destructing:"</p>



<a name="286956548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956548">(Jun 21 2022 at 18:33)</a>:</h4>
<p>because the top most symbol is <code>?m_1</code></p>



<a name="286956557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956557">(Jun 21 2022 at 18:33)</a>:</h4>
<p>if the type is not known</p>



<a name="286956637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956637">(Jun 21 2022 at 18:34)</a>:</h4>
<p>if you write <code>obtain &lt;x, y&gt;,</code> with literally no other information, how can it tell what you want to destruct?</p>



<a name="286956725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956725">(Jun 21 2022 at 18:35)</a>:</h4>
<p>you can use <code>obtain &lt;x, y&gt; : \exists n, P n,</code> or <code>obtain &lt;x, y&gt; := h</code>, both of which provide a way to get the type</p>



<a name="286956782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956782">(Jun 21 2022 at 18:35)</a>:</h4>
<p>Right, thanks. I was assuming that lean would derive the type from the <code>{}</code> block that follows.</p>



<a name="286956876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956876">(Jun 21 2022 at 18:36)</a>:</h4>
<p>it can't use types from the future because after the <code>,</code> the tactic runs and it has to transition the tactic state to something such that the <code>{}</code> block will do something useful</p>



<a name="286956932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956932">(Jun 21 2022 at 18:37)</a>:</h4>
<p>Got it, makes a lot of sense.</p>



<a name="286956962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/286956962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bart Michels <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#286956962">(Jun 21 2022 at 18:37)</a>:</h4>
<p>Thanks!</p>



<a name="290901768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/290901768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#290901768">(Jul 26 2022 at 14:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/285023237">said</a>:</p>
<blockquote>
<p>Is there a more idiomatic way how to write <code>clear_except,</code> to delete everything but the goal?</p>
</blockquote>
<p>I encountered it again. Is there any idiomatic way to write it? I kinda wanna signpost that I will show that the goal is tautological.</p>



<a name="296065390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/296065390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#296065390">(Aug 30 2022 at 09:29)</a>:</h4>
<p>What should I do instead of the following two lines?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="n">my_inequality_</span> <span class="o">:=</span> <span class="n">my_inequality</span><span class="o">,</span>
<span class="n">tauto</span><span class="o">,</span>
</code></pre></div>
<p>I want to "load" an existing private lemma into a local context in order to discharge the goal by <code>tauto</code> with its help?</p>



<a name="296079342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/296079342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#296079342">(Aug 30 2022 at 11:12)</a>:</h4>
<p>Seems fine to me</p>



<a name="296084479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/296084479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#296084479">(Aug 30 2022 at 11:50)</a>:</h4>
<p>I'd rather do something like <code>tauto [my_inequality]</code> or perform <code>tauto</code> with <code>library_search</code> at the same time.<br>
Or, is there a way to do what I did without needing to name the proposition again?</p>



<a name="296084626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/296084626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#296084626">(Aug 30 2022 at 11:51)</a>:</h4>
<p>You can use <code>have := xxx</code> which will call the local assumption <code>this</code></p>



<a name="296085066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/296085066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#296085066">(Aug 30 2022 at 11:55)</a>:</h4>
<p>Is it idiomatic in Lean? I guess it is OK when I write <code>have := my_inequality,</code> on the penultimate line of the block (followed by a tactic that does not obtain <code>this</code> as an explicit argument).</p>



<a name="296100847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/296100847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#296100847">(Aug 30 2022 at 13:24)</a>:</h4>
<p>Using <code>this</code> is fairly idiomatic, and some tactics like <code>simpa using</code> have special support for it even</p>



<a name="300342426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300342426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300342426">(Sep 23 2022 at 11:38)</a>:</h4>
<p>In my proofs, my block often ends with something like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="n">almost_there</span> <span class="o">:=</span> <span class="n">some_lemma</span> <span class="n">some_parameter</span><span class="o">,</span>
<span class="n">rw</span> <span class="o">[</span><span class="n">some_transformation</span><span class="o">,</span> <span class="n">other_transformation</span><span class="o">]</span> <span class="n">at</span> <span class="n">almost_there</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">almost_there</span><span class="o">,</span>
</code></pre></div>
<p>Is there a better way to write it?</p>



<a name="300342564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300342564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300342564">(Sep 23 2022 at 11:39)</a>:</h4>
<p><code>rwa</code> :)</p>



<a name="300342758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300342758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300342758">(Sep 23 2022 at 11:40)</a>:</h4>
<p>The line <code>have almost_there := some_lemma some_parameter,</code> has to stay, I guess.</p>



<a name="300342844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300342844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300342844">(Sep 23 2022 at 11:41)</a>:</h4>
<p><code>simpa only [some_transformation, other_transformation] using some_lemma some_parameter</code> might or might not work in your situation.</p>



<a name="300342924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300342924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300342924">(Sep 23 2022 at 11:41)</a>:</h4>
<p>Is there any reason <code>rwa [] using _</code> is not supported syntax?</p>



<a name="300343473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300343473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300343473">(Sep 23 2022 at 11:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/300342564">said</a>:</p>
<blockquote>
<p><code>rwa</code> :)</p>
</blockquote>
<p>Isn't it a bit slower? I'd rather have it call <code>exact</code> [right side of <code>rwa</code>] than to walk through the local context.</p>



<a name="300344672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300344672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300344672">(Sep 23 2022 at 11:52)</a>:</h4>
<p>It's almost no difference, given that you will typically have less &lt; 50 assumptions in context. And note that this is also (slightly) cheaper in tactic parsing.</p>



<a name="300347609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/300347609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#300347609">(Sep 23 2022 at 12:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/300342924">said</a>:</p>
<blockquote>
<p>Is there any reason <code>rwa [] using _</code> is not supported syntax?</p>
</blockquote>
<p>Ooh this would be really nice</p>



<a name="304665750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/304665750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#304665750">(Oct 18 2022 at 12:17)</a>:</h4>
<p>Is it bad practice to reuse argument names between different functions / lemmata and have <code>x</code> of different type in different parts of your code?</p>



<a name="304666115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/304666115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#304666115">(Oct 18 2022 at 12:19)</a>:</h4>
<p>Not necessarily. But having multiple <code>x</code>s` at the same time will be confusing.</p>



<a name="307546804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/307546804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#307546804">(Nov 02 2022 at 15:09)</a>:</h4>
<p>What about <code>dsimp only [],</code> in the middle of a proof?</p>



<a name="307547313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/307547313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#307547313">(Nov 02 2022 at 15:11)</a>:</h4>
<p>Those are fine according to mathlib standards.</p>
<p>A small golf: <code>dsimp only</code> does the same thing as <code>dsimp only []</code></p>



<a name="307547717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/307547717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#307547717">(Nov 02 2022 at 15:13)</a>:</h4>
<p>One of the reasons <code>dsimp only</code> appears is that it's able to do a number of reductions that are necessary for further rewrites.</p>



<a name="307548085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/307548085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#307548085">(Nov 02 2022 at 15:14)</a>:</h4>
<p>Even <code>dsimp</code> is allowed, because theoretically it transforms something into something definitionally equivalent, so it's not so bad fixing things if the simp set changes. (I usually still go for <code>dsimp only [whatever the lemmas]</code> when possible)</p>



<a name="307548263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/307548263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#307548263">(Nov 02 2022 at 15:15)</a>:</h4>
<p>But, once you're done with a proof, it's worth checking if there are any <code>dsimp</code>s (or <code>unfold</code>s) that you can remove. It can be surprising what's not necessary.</p>



<a name="307548514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/307548514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#307548514">(Nov 02 2022 at 15:16)</a>:</h4>
<p>I usually realize that <code>dsimp</code> and <code>unfold</code> cannot be removed.</p>



<a name="310600813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310600813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310600813">(Nov 17 2022 at 12:36)</a>:</h4>
<p>Is there a way how to replace the following two lines by a single command?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="n">is_it_in</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">l</span><span class="o">,</span> <span class="mi">42</span> <span class="bp">∈</span> <span class="n">l</span><span class="o">)</span> <span class="n">hyp</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">only</span> <span class="n">at</span> <span class="n">is_it_in</span><span class="o">,</span>
</code></pre></div>
<p>I wish there was a way to write the <code>congr_arg</code> expression in a way that will not require the beta reduction immediately after it.</p>



<a name="310601604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310601604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310601604">(Nov 17 2022 at 12:41)</a>:</h4>
<p>You could use <code>have is_it_in : 42 \in a = 42 \in b := congr_arg ..</code> (if I remembered <code>congr_arg</code> correctly)</p>



<a name="310602572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310602572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310602572">(Nov 17 2022 at 12:47)</a>:</h4>
<p>That's a bit too verbose but thanks.</p>



<a name="310603071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310603071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310603071">(Nov 17 2022 at 12:50)</a>:</h4>
<p>Oh, or maybe even <code>have is_it_in : _ \in _ = _ \in _ := ...</code></p>



<a name="310603528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310603528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310603528">(Nov 17 2022 at 12:53)</a>:</h4>
<p>You could use <a href="https://leanprover-community.github.io/mathlib_docs/tactics.html#dsimp_result">tactic#dsimp_result</a>, for this example its still a bit verbose but it might be helpful in other cases</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.set.basic</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">is_it_in</span><span class="o">,</span> <span class="o">{</span> <span class="n">dsimp_result</span> <span class="o">{</span> <span class="n">exact</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">l</span><span class="o">,</span> <span class="mi">42</span> <span class="bp">∈</span> <span class="n">l</span><span class="o">)</span> <span class="n">hyp</span><span class="o">}</span> <span class="o">},</span>
<span class="kd">end</span>
</code></pre></div>



<a name="310604002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310604002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310604002">(Nov 17 2022 at 12:57)</a>:</h4>
<p>Ext lemmas are good for these too</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">t</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">s</span> <span class="bp">↔</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">t</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">set.ext_iff.mp</span> <span class="n">h</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">this</span>
<span class="kd">end</span>
</code></pre></div>



<a name="310604087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/310604087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#310604087">(Nov 17 2022 at 12:57)</a>:</h4>
<p>For submodules you can for example use <a href="https://leanprover-community.github.io/mathlib_docs/find/set_like.ext_iff">docs#set_like.ext_iff</a> since they tend to use the <code>set_like</code> interface</p>



<a name="312160405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312160405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312160405">(Nov 25 2022 at 10:58)</a>:</h4>
<p>I have the following block, which totally looks like a code smell, on six places in my code.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">exfalso</span><span class="o">,</span>
<span class="o">(</span><span class="bp">...</span><span class="o">)</span>
<span class="n">apply</span> <span class="n">false_of_true_eq_false</span><span class="o">,</span>
<span class="n">convert</span> <span class="n">my_hyp.symm</span><span class="o">,</span>
<span class="o">{</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">eq_iff_iff</span><span class="o">,</span> <span class="n">true_iff</span><span class="o">],</span>
  <span class="o">(</span><span class="bp">...</span><span class="o">)</span>
<span class="o">},</span>
<span class="o">{</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">eq_iff_iff</span><span class="o">,</span> <span class="n">false_iff</span><span class="o">],</span>
  <span class="o">(</span><span class="bp">...</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div>
<p>Is there a better way to write the same thing without significantly changing the decomposition?</p>



<a name="312163926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312163926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312163926">(Nov 25 2022 at 11:19)</a>:</h4>
<p>If I read this right, the situation is that <code>my_hyp : p = q</code>, and you have a proof of <code>p</code> and a proof of <code>¬ q</code>? I'd probably structure this as:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">q</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">...</span> <span class="o">},</span>
<span class="n">refine</span> <span class="o">(</span><span class="n">this</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">elim</span><span class="o">,</span>
<span class="n">rw</span> <span class="n">my_hyp</span><span class="o">,</span>
<span class="c1">-- Now prove `p`</span>
<span class="o">{</span> <span class="bp">...</span> <span class="o">}</span>
</code></pre></div>



<a name="312164156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312164156" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312164156">(Nov 25 2022 at 11:20)</a>:</h4>
<p>Another option might be:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">have</span> <span class="n">hp</span> <span class="o">:</span> <span class="n">p</span><span class="o">,</span>
<span class="o">{</span> <span class="bp">...</span> <span class="o">},</span>
<span class="k">have</span> <span class="n">hnq</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">p</span><span class="o">,</span>
<span class="o">{</span> <span class="n">rw</span> <span class="n">my_hyp</span><span class="o">,</span>
  <span class="c1">-- Now prove `¬ q`</span>
  <span class="bp">...</span> <span class="o">},</span>
<span class="n">contradiction</span>
</code></pre></div>



<a name="312164932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312164932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312164932">(Nov 25 2022 at 11:24)</a>:</h4>
<p>Oh yes, thanks!<br>
Is there also a way that doesn't require me to restate <code>p</code> and/or <code>q</code>?</p>



<a name="312165159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312165159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312165159">(Nov 25 2022 at 11:26)</a>:</h4>
<p>Motivation: I often work with propositions that take more than 100 characters to state. And I don't like boilerplate in my code.</p>



<a name="312167532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312167532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312167532">(Nov 25 2022 at 11:39)</a>:</h4>
<p>The best I can figure out is the rather cryptic <code>(mt (eq.mp my_hyp) _ _).elim</code></p>



<a name="312167724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312167724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312167724">(Nov 25 2022 at 11:40)</a>:</h4>
<p>Or I guess <code>absurd (eq.mp my_hyp _) _</code>?</p>



<a name="312249015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312249015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312249015">(Nov 25 2022 at 19:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="417654">Martin Dvořák</span> <a href="#narrow/stream/113489-new-members/topic/Code.20smell.3F/near/312165159">said</a>:</p>
<blockquote>
<p>Motivation: I often work with propositions that take more than 100 characters to state</p>
</blockquote>
<p>Some people would claim that this is the code smell</p>



<a name="312287510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Code%20smell%3F/near/312287510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Junyan Xu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Code.20smell.3F.html#312287510">(Nov 26 2022 at 03:11)</a>:</h4>
<p>A bit late but this directly gives what you wanted:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.set.basic</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">set</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hyp</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="o">((</span><span class="bp">∈</span><span class="o">)</span> <span class="mi">42</span><span class="o">)</span> <span class="n">hyp</span><span class="o">,</span> <span class="c">/-</span><span class="cm"> this: 42 ∈ a = (42 ∈ b) -/</span>
<span class="kd">end</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>