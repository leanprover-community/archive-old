---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html">Using `dec_trivial` to prove equality</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="221161694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221161694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221161694">(Dec 29 2020 at 19:53)</a>:</h4>
<p>I have two complex terms that via <code>#eval</code> are equal. I'm trying to prove that these terms are equal via <code>... = ... := dec_trivial</code>. Yet I get </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">deep</span> <span class="n">recursion</span> <span class="n">was</span> <span class="n">detected</span> <span class="n">at</span> <span class="bp">'</span><span class="n">replace'</span> <span class="o">(</span><span class="n">potential</span> <span class="n">solution</span><span class="o">:</span> <span class="n">increase</span> <span class="n">stack</span> <span class="n">space</span> <span class="k">in</span> <span class="n">your</span> <span class="n">system</span><span class="o">)</span>
</code></pre></div>
<p>Is that really the case, or am I down a forsaken path?</p>



<a name="221167399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221167399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221167399">(Dec 29 2020 at 21:11)</a>:</h4>
<p>in case you didn't try it, I'm pretty sure I've seen that exact error message once and restarting lean made it go away somehow</p>



<a name="221168090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221168090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221168090">(Dec 29 2020 at 21:20)</a>:</h4>
<p>This occurs even with <code>leanproject build</code> which is a wrapper for <code>lean --make src</code>, and I got the same error.</p>



<a name="221168298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221168298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221168298">(Dec 29 2020 at 21:22)</a>:</h4>
<p>What happens if you try <code>rfl</code> or <code>by refl</code>?</p>



<a name="221168331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221168331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221168331">(Dec 29 2020 at 21:22)</a>:</h4>
<p>It might help to say a little more about what the terms are?</p>



<a name="221169528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221169528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221169528">(Dec 29 2020 at 21:38)</a>:</h4>
<p><code>rfl</code> has  the same issue. You can see the files and output at <a href="https://github.com/Julian/lean-across-the-board/blob/list/src/guarini.lean">https://github.com/Julian/lean-across-the-board/blob/list/src/guarini.lean</a>. The <code>list</code> branch compiles cleanly except for that one statement, so you can clone and try it out!</p>



<a name="221170048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170048">(Dec 29 2020 at 21:44)</a>:</h4>
<p>Kernel evaluation doesn't scale very well; it can't handle numbers larger than ~20. You should use <code>norm_num</code> for better evaluation</p>



<a name="221170056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170056" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170056">(Dec 29 2020 at 21:44)</a>:</h4>
<p>I see you've used strings. Case closed.</p>



<a name="221170174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170174">(Dec 29 2020 at 21:46)</a>:</h4>
<p>Oh I see, this is what all that verified parser stuff was about</p>



<a name="221170195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170195">(Dec 29 2020 at 21:46)</a>:</h4>
<p><code>board.reduce</code> is equality of finite matrices</p>



<a name="221170214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170214">(Dec 29 2020 at 21:46)</a>:</h4>
<p>the <code>#eval</code> part just uses a <code>has_repr</code></p>



<a name="221170273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170273">(Dec 29 2020 at 21:47)</a>:</h4>
<p>The final statement makes reference to <code>guarini_algebraic</code> which is a list of strings</p>



<a name="221170280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170280" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170280">(Dec 29 2020 at 21:47)</a>:</h4>
<p>The proofs above show that doing moves exactly specified by <code>(start_square, end_square)</code> provably give the <code>ending_position</code>.</p>



<a name="221170283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170283">(Dec 29 2020 at 21:47)</a>:</h4>
<p>Ah I see what you mean</p>



<a name="221170370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170370">(Dec 29 2020 at 21:48)</a>:</h4>
<p>the kernel can't handle string equality evaluation at all</p>



<a name="221170399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170399">(Dec 29 2020 at 21:48)</a>:</h4>
<p>I'm not sure exactly how the parser is implemented but I would assume it eventually boils down to a string and/or character equality test</p>



<a name="221170445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170445">(Dec 29 2020 at 21:49)</a>:</h4>
<p>You might have some luck with the reverse: constructing the string and proving it is equal to a given string literal</p>



<a name="221170533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170533">(Dec 29 2020 at 21:50)</a>:</h4>
<p>so if your parser is invertible that might be an alternative way to get the kernel to believe that the parser would evaluate to X without actually running it</p>



<a name="221170568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170568">(Dec 29 2020 at 21:50)</a>:</h4>
<p>Aha, I had hoped the parser part itself wasn't a necessary part of the proof, that somehow the <code>string -&gt; description structure</code> would just work.</p>



<a name="221170580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170580">(Dec 29 2020 at 21:51)</a>:</h4>
<p>It's not invertible because chess notation is fuzzy, it's many to one dependent on board state unfortunately.</p>



<a name="221170585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170585">(Dec 29 2020 at 21:51)</a>:</h4>
<p>If you can prove that part separately, you might be able to remove it from the dec_trivial</p>



<a name="221170624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170624">(Dec 29 2020 at 21:51)</a>:</h4>
<p>Here we only need the chess notation to evaluate to "parsed chess notation" in some reasonable inductive type</p>



<a name="221170696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170696">(Dec 29 2020 at 21:52)</a>:</h4>
<p>the kernel can probably handle working with the latter (it may sweat a bit but it shouldn't timeout)</p>



<a name="221170814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170814">(Dec 29 2020 at 21:54)</a>:</h4>
<p>So two proofs, that each thing in the list of strings parses to a valid <code>description</code>, and that a different one that the list of <code>description</code> does the correct sequence?</p>



<a name="221170964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170964">(Dec 29 2020 at 21:56)</a>:</h4>
<p>right</p>



<a name="221170987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221170987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221170987">(Dec 29 2020 at 21:56)</a>:</h4>
<p>the first one you can prove by <code>simp</code> or so, and the second with <code>rfl</code></p>



<a name="221171798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221171798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221171798">(Dec 29 2020 at 22:07)</a>:</h4>
<p>It's also an option to pre-evaluate the parser to build the list of descriptions, and insert that directly into the theorem statement using a tactic, if you don't care about proving that the parsing goes to plan</p>



<a name="221172766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221172766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221172766">(Dec 29 2020 at 22:19)</a>:</h4>
<p>Yes, I'd have to write that tactic though, and I've kept delaying learning about how to do that</p>



<a name="221176809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Using%20%60dec_trivial%60%20to%20prove%20equality/near/221176809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Using.20.60dec_trivial.60.20to.20prove.20equality.html#221176809">(Dec 29 2020 at 23:35)</a>:</h4>
<p>That's actually the easier option. You just call <code>eval_expr</code> to evaluate the expression as you would with <code>#eval</code>, then <code>reflect</code> to insert it into the theorem statement. The option using <code>simp</code> is likely to be more complicated because you will have to simplify a ton of things and even then you will probably get stuck at some decision procedure or other</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>