---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/apply_instance.20for.20defs.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html">apply_instance for defs</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204356532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356532" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356532">(Jul 19 2020 at 15:45)</a>:</h4>
<p>In the following code</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">complex</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">finite_dimensional</span>
<span class="kn">import</span> <span class="n">tactic</span>

<span class="n">universes</span> <span class="n">u</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span>

<span class="kn">instance</span> <span class="n">hn_fd</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply_instance</span><span class="o">,</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">V</span> <span class="o">:=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">hn_fd&#39;</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="n">V</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply_instance</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204356581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356581">(Jul 19 2020 at 15:46)</a>:</h4>
<p>The first instance works but the second gives an error</p>



<a name="204356610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356610">(Jul 19 2020 at 15:47)</a>:</h4>
<p>Is <code>def</code> doing something more than just setting <code>V</code> definitionally equal to <code>(n → ℂ)</code>?</p>



<a name="204356612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356612">(Jul 19 2020 at 15:47)</a>:</h4>
<p><code>delta V, apply_instance</code></p>



<a name="204356669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356669">(Jul 19 2020 at 15:48)</a>:</h4>
<p>You need to tell Lean to "open the box" and look inside the definition. That's what the <code>delta</code> does.</p>



<a name="204356701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356701">(Jul 19 2020 at 15:49)</a>:</h4>
<p>I tried this </p>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="n">hn_fd&#39;</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="n">V</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">delta</span> <span class="n">V</span><span class="o">,</span> <span class="c1">--similar error with unfold</span>
  <span class="n">apply_instance</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>but I'm still getting </p>
<div class="codehilite"><pre><span></span><code><span class="n">tactic</span><span class="bp">.</span><span class="n">mk_instance</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">generate</span> <span class="kn">instance</span> <span class="n">for</span>
  <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="o">(</span><span class="err">?</span><span class="n">m_1</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span>
<span class="n">state</span><span class="o">:</span>
<span class="err">⊢</span> <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="o">(</span><span class="err">?</span><span class="n">m_1</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span>
</code></pre></div>



<a name="204356764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356764">(Jul 19 2020 at 15:50)</a>:</h4>
<p>looks like Lean is forgetting that <code>n</code> is  <code>fintype</code></p>



<a name="204356963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204356963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204356963">(Jul 19 2020 at 15:54)</a>:</h4>
<p>If I copy your code block, I get an error even earlier, in the statement of the lemma. Do you also get it, and do you understand what it means?</p>



<a name="204357380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357380">(Jul 19 2020 at 16:00)</a>:</h4>
<p>Ah, I totally missed that, thanks! This is what I'm seeing </p>
<div class="codehilite"><pre><span></span><code><span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="err">⊢</span> <span class="kt">Type</span> <span class="err">?</span>
</code></pre></div>



<a name="204357391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357391">(Jul 19 2020 at 16:01)</a>:</h4>
<p>I <em>think</em> Lean is unable to infer what <code>n</code> is</p>



<a name="204357635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357635">(Jul 19 2020 at 16:05)</a>:</h4>
<p>This is very interesting. I thought that using <code>variables {n : Type u} [fintype n]</code> will pass <code>n</code> as an implicit variable to all the definitions and theorems in the namespace.  I don't think I know how to fix this.</p>



<a name="204357729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357729">(Jul 19 2020 at 16:07)</a>:</h4>
<p>Maybe you need to use <code>include n</code>?</p>



<a name="204357826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357826">(Jul 19 2020 at 16:09)</a>:</h4>
<p>Still getting error in the statement of the lemma :(</p>



<a name="204357830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357830">(Jul 19 2020 at 16:09)</a>:</h4>
<p>Although the error has slightly changed now </p>
<div class="codehilite"><pre><span></span><code><span class="n">don&#39;t</span> <span class="n">know</span> <span class="n">how</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">placeholder</span>
<span class="kn">context</span><span class="o">:</span>
<span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">n</span>
<span class="err">⊢</span> <span class="kt">Type</span> <span class="err">?</span>
</code></pre></div>



<a name="204357852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357852">(Jul 19 2020 at 16:09)</a>:</h4>
<p>It basically just means <code>{n : Type u} [fintype n]</code> is implictly in all your definitions (actually, only the ones which mention <code>n</code>).</p>



<a name="204357923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204357923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204357923">(Jul 19 2020 at 16:10)</a>:</h4>
<p>This isn't what you want, for the reason you are discovering.</p>



<a name="204358061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358061">(Jul 19 2020 at 16:13)</a>:</h4>
<p>I honestly don't know what to do. My guess is that <code>def V := (n → ℂ)</code> is not the right way to ask Lean to treat <code>V</code> as a placeholder for <code>(n → ℂ)</code></p>



<a name="204358134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358134">(Jul 19 2020 at 16:14)</a>:</h4>
<p><code>variables (n : Type u)</code> is the easiest</p>



<a name="204358277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358277">(Jul 19 2020 at 16:16)</a>:</h4>
<p>This is giving me </p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="n">V</span>
<span class="n">term</span>
  <span class="n">V</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">Π</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">)</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">n</span><span class="o">],</span> <span class="kt">Type</span> <span class="err">?</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="err">?</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="err">?</span> <span class="o">(</span><span class="err">?</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="err">?</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="err">?</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span>
</code></pre></div>


<p>Wow, this is turning out to be more complicated than I expected!</p>



<a name="204358297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358297">(Jul 19 2020 at 16:17)</a>:</h4>
<p>This is because <code>V</code> now requires an explicit argument for <code>n</code>.</p>



<a name="204358341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358341">(Jul 19 2020 at 16:18)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="n">hn_fd&#39;</span> <span class="o">:</span> <span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="o">(</span><span class="n">V</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply_instance</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>Now Lean complains that it can't find an <code>add_comm_group</code> instance on <code>V n</code>.</p>



<a name="204358565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358565">(Jul 19 2020 at 16:25)</a>:</h4>
<p>Hmm... it seems to me that Lean does not like <em>hiding</em> the variable <code>n</code> in <code>V</code>. <br>
For now, I'll just stick to using <code>(n → ℂ)</code> everywhere. <br>
I'm a bit sad though that there is no straightforward way in Lean to simply rename a term like <code>(n → ℂ)</code></p>



<a name="204358689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358689">(Jul 19 2020 at 16:28)</a>:</h4>
<p>Although, in math, it is common to write statements like "In this section, we will let <code>V</code> decode <code>ℂ^n</code>." It would be  good to know what the Lean variant of this is.</p>



<a name="204358706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358706">(Jul 19 2020 at 16:29)</a>:</h4>
<p><code>parameter</code>, but I wouldn't recommend using it unless you first know how to use <code>variable</code></p>



<a name="204358720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358720">(Jul 19 2020 at 16:29)</a>:</h4>
<p>You would still need to copy the instances you want anyways.</p>



<a name="204358725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358725">(Jul 19 2020 at 16:30)</a>:</h4>
<p>Another option is <code>local notation</code>.</p>



<a name="204358846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358846">(Jul 19 2020 at 16:32)</a>:</h4>
<p>Yess! This works, thanks so much!!</p>



<a name="204358861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358861">(Jul 19 2020 at 16:33)</a>:</h4>
<p>What's the issue with using delta? That's the Lean variant you asked for. When we say that V will encode, delta is the decoding step.</p>



<a name="204358870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358870">(Jul 19 2020 at 16:33)</a>:</h4>
<p>Although local notation is very easy too.</p>



<a name="204358876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358876">(Jul 19 2020 at 16:33)</a>:</h4>
<p><code>delta</code> did not work</p>



<a name="204358881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204358881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Apurva Nakade <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204358881">(Jul 19 2020 at 16:33)</a>:</h4>
<p>there was an error in the theorem statement itself</p>



<a name="204359005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204359005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204359005">(Jul 19 2020 at 16:36)</a>:</h4>
<p>Well, this works, but this is worse than just using <code>n → ℂ</code> everywhere:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">V</span> <span class="o">:=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">hn_fd&#39;</span> <span class="o">:</span> <span class="bp">@</span><span class="n">finite_dimensional</span> <span class="n">ℂ</span> <span class="o">(</span><span class="n">V</span> <span class="n">n</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="k">by</span> <span class="o">{</span> <span class="n">delta</span> <span class="n">V</span><span class="o">,</span> <span class="n">apply_instance</span> <span class="o">})</span> <span class="o">(</span><span class="k">by</span> <span class="o">{</span> <span class="n">delta</span> <span class="n">V</span><span class="o">,</span> <span class="n">apply_instance</span> <span class="o">})</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">delta</span> <span class="n">V</span><span class="o">,</span>
  <span class="n">apply_instance</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204359006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204359006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204359006">(Jul 19 2020 at 16:36)</a>:</h4>
<p><code>def V n :=... </code></p>



<a name="204359225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204359225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204359225">(Jul 19 2020 at 16:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">derive</span> <span class="n">add_comm_group</span><span class="o">,</span> <span class="n">derive</span> <span class="o">(</span><span class="n">vector_space</span> <span class="n">ℂ</span><span class="o">),</span> <span class="n">derive</span> <span class="o">(</span><span class="n">finite_dimensional</span> <span class="n">ℂ</span><span class="o">)]</span>
<span class="n">def</span> <span class="n">V</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">:=</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">ℂ</span><span class="o">)</span>
</code></pre></div>


<p>I don't know if it's possible to get <code>[fintype n]</code> on only the <code>finite_dimensional</code> instance</p>



<a name="204359233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204359233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204359233">(Jul 19 2020 at 16:42)</a>:</h4>
<p>or to avoid repeating <code>derive</code></p>



<a name="204359511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204359511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204359511">(Jul 19 2020 at 16:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113489-new-members/topic/apply_instance.20for.20defs/near/204359233">said</a>:</p>
<blockquote>
<p>or to avoid repeating <code>derive</code></p>
</blockquote>
<p>This yes, <code>@[derive [..., ...]]</code>. The other probably not.</p>



<a name="204359515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204359515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204359515">(Jul 19 2020 at 16:50)</a>:</h4>
<p>We should really have a doc entry on <code>derive</code> <a href="https://leanprover-community.github.io/mathlib_docs/attributes.html">here</a>. Does anyone want to volunteer?</p>



<a name="204360194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/204360194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#204360194">(Jul 19 2020 at 17:03)</a>:</h4>
<p>(I'll do it if someone gives me some pointers on how it works...)</p>



<a name="205085382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205085382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205085382">(Jul 27 2020 at 06:35)</a>:</h4>
<p>I also wonder how <code>derive</code> works. Some search (by <code>git blaming</code> the related tests) got me <a href="https://github.com/leanprover-community/mathlib/issues/1475">leanprover-community/mathlib#1475</a> then  <a href="#narrow/stream/113488-general/topic/deriving.20instances">this Zulip chat</a>  and <a href="https://github.com/leanprover-community/lean/blob/master/library/init/meta/derive.lean">https://github.com/leanprover-community/lean/blob/master/library/init/meta/derive.lean</a> .</p>
<p>I can't immediately tell how it works (from the source), only knowing that there's such a mechanism to register derive handlers and there're a few such handlers available in mathlib, each targeting a specific scenario.</p>
<p>By a few I mean two of them (found by searching <code>derive_handler</code>: <code>inhabited_instance</code> and <code>delta_instance</code>) and they seem to be well documented by themselves, it's just not easy for anyone to find the doc by just seeing <code>@[derive ...]</code>.</p>
<p>P.S. Is it possible to make VSCode display the doc when hover <code>@[derive ...]</code> or make it clickable? I don't know where's related code in VSCode plugin.</p>



<a name="205085522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205085522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205085522">(Jul 27 2020 at 06:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="296911">Utensil Song</span> <a href="#narrow/stream/113489-new-members/topic/apply_instance.20for.20defs/near/205085382">said</a>:</p>
<blockquote>
<p>P.S. Is it possible to make VSCode display the doc when hover <code>@[derive ...]</code> or make it clickable? I don't know where's related code in VSCode plugin.</p>
</blockquote>
<p>Most likely not without making changes to Lean itself. I don't know how hard it would be.</p>



<a name="205088395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205088395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205088395">(Jul 27 2020 at 07:33)</a>:</h4>
<p>Seems possible to address the hover part by modifying  <a href="https://github.com/leanprover/vscode-lean/blob/master/src/hover.ts">https://github.com/leanprover/vscode-lean/blob/master/src/hover.ts</a> by manually write some doc in json and provide them to hover. To avoid becoming out of sync with the source, it could be just a link to an HTML doc generated from Lean /Mathlib. This would be enough for most users I guess.</p>
<p>As for the clickable part, modifying <a href="https://github.com/leanprover/vscode-lean/blob/master/src/definition.ts">https://github.com/leanprover/vscode-lean/blob/master/src/definition.ts</a> with the same naive manual approach would not work since the location has to be provided by Lean language server and there's no such an API to literal specify the symbol (out of context) to locate.</p>



<a name="205088712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205088712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205088712">(Jul 27 2020 at 07:39)</a>:</h4>
<p>I think it'd be better overall to have the Lean server return the doc string and location from the attribute declaration. That would allow Emacs users to view such docstrings as well.</p>



<a name="205088947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205088947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205088947">(Jul 27 2020 at 07:43)</a>:</h4>
<p>Sure.</p>



<a name="205195259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205195259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205195259">(Jul 28 2020 at 03:32)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a></p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="n">Module</span><span class="bp">.</span><span class="n">monoidal</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="n">CommRing</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">delta_instance</span>

<span class="kn">open</span> <span class="n">category_theory</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">category</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">monoidal_category</span> <span class="n">C</span><span class="o">]</span>

<span class="n">def</span> <span class="n">tensor_power</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">C</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="o">:=</span> <span class="mi">𝟙</span><span class="bp">_</span> <span class="n">C</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="n">X</span> <span class="err">⊗</span> <span class="n">tensor_power</span> <span class="n">n</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="n">CommRing</span><span class="o">}</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">Module</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">Module</span> <span class="n">R</span> <span class="o">:=</span> <span class="n">tensor_power</span> <span class="n">M</span> <span class="mi">17</span>

<span class="c1">-- And if you want to do this with unbundled objects:</span>

<span class="n">universes</span> <span class="n">u</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">tensor_power</span> <span class="o">(</span><span class="n">Module</span><span class="bp">.</span><span class="n">of</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">Module</span> <span class="n">R</span><span class="o">)</span>

<span class="c1">-- WORKS</span>
<span class="c1">-- instance : add_comm_group (foo R M) := by { delta foo, apply_instance, }</span>
<span class="c1">-- instance : module R (foo R M) := by { delta foo, apply_instance, }</span>

<span class="c1">-- WORKS</span>
<span class="c1">-- instance : add_comm_group (foo R M) := by delta_instance foo</span>
<span class="c1">-- instance : module R (foo R M) :=  by delta_instance foo</span>

<span class="kn">namespace</span> <span class="n">foo</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">tactic.mk_instance failed to generate instance for</span>
<span class="cm">  add_comm_group (foo R M)</span>
<span class="cm">-/</span>
<span class="bp">@</span><span class="o">[</span><span class="n">derive</span> <span class="n">add_comm_group</span><span class="o">]</span>
<span class="n">def</span> <span class="n">to_add_comm_group</span> <span class="o">:=</span> <span class="n">foo</span> <span class="n">R</span> <span class="n">M</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">failed to synthesize type class instance for</span>
<span class="cm">R : Type u,</span>
<span class="cm">_inst_3 : comm_ring R,</span>
<span class="cm">M : Type u,</span>
<span class="cm">_inst_4 : add_comm_group M,</span>
<span class="cm">_inst_5 : module R M</span>
<span class="cm">⊢ add_comm_group (to_module R M)</span>
<span class="cm">-/</span>
<span class="bp">@</span><span class="o">[</span><span class="n">derive</span> <span class="n">module</span> <span class="n">R</span><span class="o">]</span>
<span class="n">def</span> <span class="n">to_module</span> <span class="o">:=</span> <span class="n">foo</span> <span class="n">R</span> <span class="n">M</span>

<span class="kn">end</span> <span class="n">foo</span>
</code></pre></div>



<a name="205195265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205195265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205195265">(Jul 28 2020 at 03:33)</a>:</h4>
<p>I don't understand why <code>derive</code> doesn't work here.</p>



<a name="205195313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205195313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205195313">(Jul 28 2020 at 03:34)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/master/src/linear_algebra/dual.lean#L39">https://github.com/leanprover-community/mathlib/blob/master/src/linear_algebra/dual.lean#L39</a> is similar but works:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">derive</span> <span class="o">[</span><span class="n">add_comm_group</span><span class="o">,</span> <span class="n">module</span> <span class="n">R</span><span class="o">]]</span> <span class="n">def</span> <span class="n">dual</span> <span class="o">:=</span> <span class="n">M</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">R</span><span class="o">]</span> <span class="n">R</span>
</code></pre></div>



<a name="205196396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205196396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205196396">(Jul 28 2020 at 04:04)</a>:</h4>
<p>This doesn't work because <code>derive</code> only unfolds the current definition (i.e. <code>to_add_comm_group</code> in your example). It would need to _also_ unfold <code>foo</code> before it could find the instance.</p>



<a name="205196405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205196405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205196405">(Jul 28 2020 at 04:04)</a>:</h4>
<p>If you put another <code>@[derive]</code> on <code>foo</code> it should work.</p>



<a name="205196698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205196698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205196698">(Jul 28 2020 at 04:13)</a>:</h4>
<p>Oh, moving <code>derive</code> to where <code>foo</code> is defined works:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">derive</span> <span class="o">[</span><span class="n">add_comm_group</span><span class="o">,</span> <span class="n">module</span> <span class="n">R</span><span class="o">]]</span>
<span class="n">def</span> <span class="n">foo</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">tensor_power</span> <span class="o">(</span><span class="n">Module</span><span class="bp">.</span><span class="n">of</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">Module</span> <span class="n">R</span><span class="o">)</span>
</code></pre></div>



<a name="205196743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/apply_instance%20for%20defs/near/205196743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/apply_instance.20for.20defs.html#205196743">(Jul 28 2020 at 04:14)</a>:</h4>
<p>So does <code>attribute [derive [add_comm_group, module R]] foo</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>