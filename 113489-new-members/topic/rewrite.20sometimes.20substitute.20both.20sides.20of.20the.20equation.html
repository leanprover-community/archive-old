---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html">rewrite sometimes substitute both sides of the equation</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="221095166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095166">(Dec 28 2020 at 22:11)</a>:</h4>
<p>Good evening! I am new to Lean and I have a question about a phenomenon that is not well documented online.<br>
I have noticed that  some times, the rewrite command replaces multiple occurrence of the pattern found. In particular,  in the Mathematics in Lean book, I found:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>import algebra.ring
namespace my_ring
variables <span class="o">{</span>R : Type*<span class="o">}</span> <span class="o">[</span>ring R<span class="o">]</span>

theorem add_neg_cancel_right <span class="o">(</span>a b : R<span class="o">)</span> : <span class="o">(</span>a + b<span class="o">)</span> + -b <span class="o">=</span> a :<span class="o">=</span>
by rw <span class="o">[</span>add_assoc, add_right_neg, add_comm, zero_add<span class="o">]</span>

theorem add_right_cancel <span class="o">{</span>a b c : R<span class="o">}</span> <span class="o">(</span>h : a + <span class="nv">b</span> <span class="o">=</span> c + b<span class="o">)</span> : <span class="nv">a</span> <span class="o">=</span> c :<span class="o">=</span>
   calc
    <span class="nv">a</span>
      <span class="o">=</span> <span class="o">(</span>a + b<span class="o">)</span> + -b : by rw <span class="o">[</span>← add_neg_cancel_right<span class="o">]</span>
  ... <span class="o">=</span> <span class="o">(</span>c + b<span class="o">)</span> + -b : by rw <span class="o">[</span>← h<span class="o">]</span>
  ... <span class="o">=</span>  c           : by rw <span class="o">[</span>add_assoc, add_comm b, add_left_neg, add_comm, zero_add<span class="o">]</span>
-- END

end my_ring
</code></pre></div>
<p>I want to replace 'a' by '(a + b) + -b' only on the left side, but Lean did both sides for me, which is not what I wanted... Could someone help me with this?</p>



<a name="221095241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095241">(Dec 28 2020 at 22:12)</a>:</h4>
<p>You're looking for <a href="https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks">#backticks</a></p>



<a name="221095252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095252">(Dec 28 2020 at 22:12)</a>:</h4>
<p>(I'm talking about your Zulip issue first)</p>



<a name="221095273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095273">(Dec 28 2020 at 22:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation/near/221095241">said</a>:</p>
<blockquote>
<p>You're looking for <a href="https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks">#backticks</a></p>
</blockquote>
<p>I got it! Thanks!</p>



<a name="221095348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095348">(Dec 28 2020 at 22:14)</a>:</h4>
<p><code>rw</code> will replace every occurrence of a <em>single</em> pattern.</p>



<a name="221095509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095509">(Dec 28 2020 at 22:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation/near/221095348">said</a>:</p>
<blockquote>
<p><code>rw</code> will replace every occurrence of a <em>single</em> pattern.</p>
</blockquote>
<p>I also observe that Lean replaces all patterns (some are very complex)</p>
<p>Is there a way to specify only the first or second pattern, or left/right side?</p>



<a name="221095528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095528">(Dec 28 2020 at 22:17)</a>:</h4>
<p>One possible answer is <a href="https://leanprover-community.github.io/extras/conv.html">https://leanprover-community.github.io/extras/conv.html</a></p>



<a name="221095541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095541">(Dec 28 2020 at 22:17)</a>:</h4>
<p>There are simpler answers for simpler cases but that one is the most flexible one.</p>



<a name="221095614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095614">(Dec 28 2020 at 22:18)</a>:</h4>
<p>I don't understand your example, it seems to have independent issues.</p>



<a name="221095722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095722">(Dec 28 2020 at 22:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation/near/221095614">said</a>:</p>
<blockquote>
<p>I don't understand your example, it seems to have independent issues.</p>
</blockquote>
<p>Professor Massot, are you referring to the example code that I posted?</p>



<a name="221095769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095769">(Dec 28 2020 at 22:21)</a>:</h4>
<p>Yes. I think the issue is your <code>rw [← add_neg_cancel_right]</code> has no way to infer who is <code>b</code>.</p>



<a name="221095875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095875">(Dec 28 2020 at 22:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation/near/221095769">said</a>:</p>
<blockquote>
<p>Yes. I think the issue is your <code>rw [← add_neg_cancel_right]</code> has no way to infer who is <code>b</code>.</p>
</blockquote>
<p>I have updated again:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.ring</span>
<span class="kn">namespace</span> <span class="n">my_ring</span>
<span class="kd">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>

<span class="kd">theorem</span> <span class="n">add_neg_cancel_right</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="bp">-</span><span class="n">b</span> <span class="bp">=</span> <span class="n">a</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_right_neg</span><span class="o">,</span> <span class="n">add_comm</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">]</span>

<span class="kd">theorem</span> <span class="n">add_right_cancel</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">R</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:=</span>
   <span class="k">calc</span>
    <span class="n">a</span>
      <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="bp">-</span><span class="n">b</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">add_neg_cancel_right</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">c</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="bp">-</span><span class="n">b</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">h</span><span class="o">]</span>
  <span class="bp">...</span> <span class="bp">=</span>  <span class="n">c</span>           <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_assoc</span><span class="o">,</span> <span class="n">add_comm</span> <span class="n">b</span><span class="o">,</span> <span class="n">add_left_neg</span><span class="o">,</span> <span class="n">add_comm</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">]</span>
<span class="c1">-- END</span>

<span class="kd">end</span> <span class="n">my_ring</span>
</code></pre></div>



<a name="221095963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221095963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221095963">(Dec 28 2020 at 22:24)</a>:</h4>
<p>If I change the code back to </p>
<p><code>rw [add_neg_cancel_right a b]</code></p>
<p>then it works very well, it just substituted my right hand side :)</p>



<a name="221096087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096087" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096087">(Dec 28 2020 at 22:26)</a>:</h4>
<p>Ok, here you see the announced behavior. Given <code>rw [← add_neg_cancel_right a b]</code> goes looking for the pattern <code>a</code>. It sees it twice (one on each side), hence it rewrites twice. You can fix this by using <code>conv_lhs { rw [← add_neg_cancel_right a b] }</code> to go only to the left-hand side.</p>



<a name="221096121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096121">(Dec 28 2020 at 22:27)</a>:</h4>
<p>Thank you for your answer, Professor Massot! I will try that and also read the link that you sent!</p>



<a name="221096171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096171">(Dec 28 2020 at 22:28)</a>:</h4>
<p>or <code>conv { to_lhs, rw ← add_neg_cancel_right a b }</code> or many other variations.</p>



<a name="221096190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096190">(Dec 28 2020 at 22:28)</a>:</h4>
<p>You are using bash syntax highlighting btw, you can just write <code> ``` </code> with no language specifier and it will default to "lean"</p>



<a name="221096416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096416">(Dec 28 2020 at 22:32)</a>:</h4>
<p>Btw, is there an advantage to having lean syntax? Can we just run it on the server... I am just wondering</p>



<a name="221096444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096444">(Dec 28 2020 at 22:33)</a>:</h4>
<p>Yes you can.</p>



<a name="221096469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096469">(Dec 28 2020 at 22:33)</a>:</h4>
<p>Try to switch to lean syntax and you'll get a new icon on the upper-right corner of your code area.</p>



<a name="221096483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096483">(Dec 28 2020 at 22:33)</a>:</h4>
<p>Of course this will work only if the Lean snippet is autonomous.</p>



<a name="221096765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trung Tran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096765">(Dec 28 2020 at 22:38)</a>:</h4>
<p>Thank you for telling me that. I will start posting self-contained codes from now on.</p>



<a name="221096857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/rewrite%20sometimes%20substitute%20both%20sides%20of%20the%20equation/near/221096857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/rewrite.20sometimes.20substitute.20both.20sides.20of.20the.20equation.html#221096857">(Dec 28 2020 at 22:40)</a>:</h4>
<p>The important point is to post self-contained code  in the first message of a thread, because it makes it much easier to help you, as explained in <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>. The Lean javascript version is mostly a nice bonus.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>