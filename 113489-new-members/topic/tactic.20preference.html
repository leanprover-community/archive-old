---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/tactic.20preference.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html">tactic preference</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="213690617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690617">(Oct 18 2020 at 05:56)</a>:</h4>
<p>Dear All,</p>
<p>in the process of cleaning up proofs, I find myself having to make choices between using different tactics with the same final effect.  In practice, I often end up with the following scheme:</p>
<p><code>simp</code> becomes <code>rw</code> (if I am lucky, via <code>squeeze_simp</code>)<br>
<code>apply [...], exact [...]</code> becomes <code>exact [......]</code><br>
<code>rw [... \iff ...]</code> becomes <code>apply [(...).mp(r)...]</code> (when reasonable/possible)<br>
<code>have</code> becomes a previous <code>lemma</code></p>
<p>I realize that tactics are not just not linearly ordered, they are probably not even a poset!  Still, a proof commits you to some choices and I would like to know that I am at least going in a reasonable direction.  I would like to know whether you find the scheme above reasonable.  What other substitutions would you make?  For instance, I rarely use <code>subst [...]</code> since the next tactic is almost invariably <code>rw</code> and then I merge them in a longer <code>rw</code>.  Which is normally preferred: <code>subst [...], rw [...]</code> or <code>rw [......]</code>?</p>
<p>Sorry for the vague question: I hope that someone can still give me some pointers!</p>



<a name="213690636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690636">(Oct 18 2020 at 05:57)</a>:</h4>
<p>I try to merge <code>subst</code> into the nearest <code>rcases</code></p>



<a name="213690694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690694">(Oct 18 2020 at 05:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/tactic.20preference/near/213690636">said</a>:</p>
<blockquote>
<p>I try to merge <code>subst</code> into the nearest <code>rcases</code></p>
</blockquote>
<p>Ah, I use very rarely <code>rcases</code>!  The fact that you mention it, makes me understand that I should use it more!  Thanks!</p>



<a name="213690705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690705">(Oct 18 2020 at 05:59)</a>:</h4>
<p>You can go really far with <code>rcases</code> and <code>refine</code></p>



<a name="213690716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690716">(Oct 18 2020 at 05:59)</a>:</h4>
<p>it's basically term mode proof in tactic clothing</p>



<a name="213690718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690718">(Oct 18 2020 at 05:59)</a>:</h4>
<p><code>refine</code> I *try * a lot, but end up being able to apply it only very rarely.</p>



<a name="213690776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690776">(Oct 18 2020 at 06:00)</a>:</h4>
<p>refine can be used in place of almost any tactic, although the equivalent may not be pretty depending on the tactic it replaces</p>



<a name="213690789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690789">(Oct 18 2020 at 06:00)</a>:</h4>
<p>so would a good measure be the length of the output of <code>show_term</code> to inform the choices above?</p>



<a name="213690801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690801">(Oct 18 2020 at 06:01)</a>:</h4>
<p>it's good for replacing <code>split</code>, <code>existsi</code>/<code>use</code> and <code>intro</code> in some combination</p>



<a name="213690817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690817">(Oct 18 2020 at 06:02)</a>:</h4>
<p>ah, I did not know that <code>split</code>s could be avoided by <code>refine</code>: this will keep me busy!  Ahaha</p>



<a name="213690854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690854">(Oct 18 2020 at 06:02)</a>:</h4>
<p>yes, although you should be aware that some tactics do work that doesn't show up in the term, for example <code>simp</code></p>



<a name="213690861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690861">(Oct 18 2020 at 06:02)</a>:</h4>
<p><code>split</code> is just <code>refine &lt;_, _&gt;</code></p>



<a name="213690865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690865">(Oct 18 2020 at 06:02)</a>:</h4>
<p>and you can stick a term in there if one of the sides is easy</p>



<a name="213690866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690866">(Oct 18 2020 at 06:02)</a>:</h4>
<p>I never leave a <code>simp</code> and almost never leave even a <code>simp only</code></p>



<a name="213690877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690877">(Oct 18 2020 at 06:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/tactic.20preference/near/213690861">said</a>:</p>
<blockquote>
<p><code>split</code> is just <code>refine &lt;_, _&gt;</code></p>
</blockquote>
<p>I did not know!  I will stop using <code>split</code>, then!</p>



<a name="213690923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690923">(Oct 18 2020 at 06:04)</a>:</h4>
<p>I will also point out that this doesn't necessarily match everyone's preference; this is good for making low compile time proofs but may go against one's aesthetics</p>



<a name="213690946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690946">(Oct 18 2020 at 06:05)</a>:</h4>
<p><code>existsi a</code> is just <code>refine &lt;a, _&gt;</code></p>



<a name="213690951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690951">(Oct 18 2020 at 06:05)</a>:</h4>
<p>Yes, I understand that.  Although, to be honest, proof irrelevance has the effect in my mind of replacing "beauty" with "efficiency" in a proof.</p>



<a name="213690991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690991">(Oct 18 2020 at 06:06)</a>:</h4>
<p>a kindred spirit <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="213690994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690994">(Oct 18 2020 at 06:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/tactic.20preference/near/213690946">said</a>:</p>
<blockquote>
<p><code>existsi a</code> is just <code>refine &lt;a, _&gt;</code></p>
</blockquote>
<p>I did not even know about the tactic <code>existsi</code>.</p>



<a name="213690998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213690998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213690998">(Oct 18 2020 at 06:06)</a>:</h4>
<p><code>use</code> is basically the same as <code>existsi</code></p>



<a name="213691015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691015">(Oct 18 2020 at 06:07)</a>:</h4>
<p>Ah, good to know!  I work aournd statements so as to avoid needing <code>use</code> whenever I can.  I do not know why...</p>



<a name="213691065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691065">(Oct 18 2020 at 06:08)</a>:</h4>
<p>It does a bit of postprocessing with <code>simp</code> to make it more user friendly I think</p>



<a name="213691075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691075">(Oct 18 2020 at 06:09)</a>:</h4>
<p>check out this beautiful proof:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">split_bits.determ_l</span> <span class="o">{</span><span class="n">n₁</span> <span class="n">n₂</span> <span class="n">l</span><span class="o">}</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">split_bits</span> <span class="n">n₁</span> <span class="n">l</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">split_bits</span> <span class="n">n₂</span> <span class="n">l</span><span class="o">)</span> <span class="o">:</span> <span class="n">n₁</span> <span class="bp">=</span> <span class="n">n₂</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">induction</span> <span class="n">l</span> <span class="n">generalizing</span> <span class="n">n₁</span> <span class="n">n₂</span><span class="o">,</span> <span class="o">{</span><span class="n">cases</span> <span class="n">h₁</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h₂</span><span class="o">,</span> <span class="n">refl</span><span class="o">},</span>
  <span class="n">rcases</span> <span class="n">l_hd</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">l'</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span>
  <span class="n">induction</span> <span class="n">l'</span> <span class="n">generalizing</span> <span class="n">n₁</span> <span class="n">n₂</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">h₁</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h₂</span><span class="o">,</span> <span class="n">exact</span> <span class="n">l_ih</span> <span class="n">h₁_a</span> <span class="n">h₂_a</span> <span class="o">},</span>
  <span class="o">{</span> <span class="k">have</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">n</span> <span class="n">l'</span><span class="o">},</span>
      <span class="n">split_bits</span> <span class="n">n</span> <span class="n">l'</span> <span class="bp">→</span>
      <span class="n">l'</span> <span class="bp">=</span> <span class="o">⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">l'_hd</span> <span class="o">::</span> <span class="n">l'_tl</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩</span> <span class="o">::</span> <span class="n">l_tl</span> <span class="bp">→</span>
      <span class="n">l'_hd</span> <span class="bp">=</span> <span class="n">nat.bodd</span> <span class="n">n</span> <span class="bp">∧</span>
      <span class="n">split_bits</span> <span class="o">(</span><span class="n">nat.div2</span> <span class="n">n</span><span class="o">)</span> <span class="o">(⟨</span><span class="n">_</span><span class="o">,</span> <span class="n">l'_tl</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩</span> <span class="o">::</span> <span class="n">l_tl</span><span class="o">),</span>
    <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">cases</span> <span class="n">a</span><span class="bp">;</span> <span class="n">try</span> <span class="o">{</span><span class="n">cases</span> <span class="n">a_1</span><span class="o">},</span>
      <span class="n">rcases</span> <span class="n">a_bs</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">l₂</span><span class="o">,</span> <span class="n">rfl</span><span class="o">⟩,</span>
      <span class="n">injection</span> <span class="n">a_1</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h_2</span><span class="o">,</span>
      <span class="n">cases</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">v</span> <span class="o">:</span> <span class="bp">Σ</span> <span class="n">n</span><span class="o">,</span> <span class="n">bitvec</span> <span class="n">n</span><span class="o">,</span> <span class="n">v.2.1</span><span class="o">)</span> <span class="n">h_1</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">a_a</span><span class="o">⟩</span> <span class="o">},</span>
    <span class="n">rcases</span> <span class="n">this</span> <span class="n">h₁</span> <span class="n">rfl</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">h₁'</span><span class="o">⟩,</span>
    <span class="n">rcases</span> <span class="n">this</span> <span class="n">h₂</span> <span class="n">rfl</span> <span class="k">with</span> <span class="o">⟨</span><span class="n">e</span><span class="o">,</span> <span class="n">h₂'</span><span class="o">⟩,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">nat.bit_decomp</span> <span class="n">n₁</span><span class="o">,</span> <span class="n">e</span><span class="o">,</span> <span class="n">l'_ih</span> <span class="n">h₁'</span> <span class="n">h₂'</span><span class="o">,</span> <span class="n">nat.bit_decomp</span><span class="o">]</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>

<p>100% old school tactics</p>



<a name="213691077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691077">(Oct 18 2020 at 06:09)</a>:</h4>
<p>I now need to resist the urge to go back to all the code that I have written and preform further substitutions... surely, alongside proof-checkers, there are "proof-spas", beautifying your code, no?</p>



<a name="213691126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691126">(Oct 18 2020 at 06:10)</a>:</h4>
<p>it's big business in metamath land, but lean doesn't make it so easy to optimize proofs in any large scale way</p>



<a name="213691150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691150">(Oct 18 2020 at 06:11)</a>:</h4>
<p>Why do you call the proof above "old school tactics"?  What are examples "new school tactics"?  I feel that I am a beginner learning the old-school...</p>



<a name="213691201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691201">(Oct 18 2020 at 06:12)</a>:</h4>
<p>Is this something AI can do for us someday?  Take the corpus of all the lemmas and definitions in mathlib, and find its own proofs, sometimes 3 lines shorter than the existing proofs?</p>



<a name="213691219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691219">(Oct 18 2020 at 06:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/113489-new-members/topic/tactic.20preference/near/213691201">said</a>:</p>
<blockquote>
<p>Is this something AI can do for us someday?  Take the corpus of all the lemmas and definitions in mathlib, and find its own proofs, sometimes 3 lines shorter than the existing proofs?</p>
</blockquote>
<p>In my proofs, I think I would be happy if it only shortened them by 3 lines!  Even my one-line-proofs are long...</p>



<a name="213691275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691275">(Oct 18 2020 at 06:14)</a>:</h4>
<p>It's something that can absolutely be done in principle (that's basically what GPT-f did for metamath), but the limiting factor is ease of access of the data to automated tools, which is crazy considering that it's a formal theorem prover</p>



<a name="213691330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691330">(Oct 18 2020 at 06:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/tactic.20preference/near/213691275">said</a>:</p>
<blockquote>
<p>that's basically what GPT-f did for metamath</p>
</blockquote>
<p>I don't know about this, can you suggest something for further reading?</p>



<a name="213691346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691346">(Oct 18 2020 at 06:17)</a>:</h4>
<p>In fact, for a long time the main metamath tool has had a proof processing tool called "minimize" that is basically a peephole optimizer: it looks at sequences of 2 or 3 steps in your proof and tries to find ways to do the same thing in 1 or 2 steps utilizing the whole library. It's computationally expensive, so it is run once a year or so on the entire library, but it can also be run in the background while you are working on your new proof</p>



<a name="213691391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691391">(Oct 18 2020 at 06:18)</a>:</h4>
<p>There is some discussion about GPT-f on the <a class="stream" data-stream-id="219941" href="/#narrow/stream/219941-Machine-Learning-for-Theorem-Proving">#Machine Learning for Theorem Proving</a> stream</p>



<a name="213691453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691453">(Oct 18 2020 at 06:20)</a>:</h4>
<p>The upshot is that most proofs in <a href="http://set.mm">set.mm</a> are "locally optimal": they don't necessarily take the globally shortest path but there are no local missteps so everything proceeds straightforwardly</p>



<a name="213691468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691468">(Oct 18 2020 at 06:21)</a>:</h4>
<p>a simple analogue for lean would be deleting <code>have</code> statements that are never used</p>



<a name="213691518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691518">(Oct 18 2020 at 06:22)</a>:</h4>
<p>But none of that can happen in lean 3 because no one can parse lean except lean</p>



<a name="213691998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213691998" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213691998">(Oct 18 2020 at 06:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Thank you very much for your input!  I have already shortened a couple of proofs using some of your ideas!</p>



<a name="213706477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706477">(Oct 18 2020 at 13:29)</a>:</h4>
<p>What causes the parsing difficulties in Lean 3 (and what's changing)?</p>



<a name="213706490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706490">(Oct 18 2020 at 13:29)</a>:</h4>
<p>Well, lean 4 will be <em>even harder to parse</em></p>



<a name="213706538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706538">(Oct 18 2020 at 13:30)</a>:</h4>
<p>the reason lean 3 is hard to parse is because you can run arbitrary code while parsing</p>



<a name="213706549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706549">(Oct 18 2020 at 13:30)</a>:</h4>
<p>Ah, of course.</p>



<a name="213706562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706562" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706562">(Oct 18 2020 at 13:31)</a>:</h4>
<p>which means that parsing correctly implies also running the VM correctly, having a typechecker and tactic framework and every other observable feature of lean</p>



<a name="213706771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706771">(Oct 18 2020 at 13:36)</a>:</h4>
<p>how do you run arbitrary code while parsing?</p>



<a name="213706930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706930">(Oct 18 2020 at 13:40)</a>:</h4>
<p>notation I guess?</p>



<a name="213706956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213706956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213706956">(Oct 18 2020 at 13:41)</a>:</h4>
<p>Or are you saying how would you implement that? I mean I guess if you're sufficiently motivated you start with running a Lean process externally or embedding it in the parser, parse everything you can statically and then communicate with it for the bits you can't parse yourself or something</p>



<a name="213707019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213707019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213707019">(Oct 18 2020 at 13:42)</a>:</h4>
<p>Anything using the <code>parser</code> monad</p>



<a name="213707024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213707024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213707024">(Oct 18 2020 at 13:42)</a>:</h4>
<p>tactic argument parsing and user commands</p>



<a name="213707172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213707172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213707172">(Oct 18 2020 at 13:46)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">meta</span> <span class="kd">def</span> <span class="n">tactic.interactive.even</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">interactive.parse</span> <span class="o">(</span><span class="k">do</span>
  <span class="n">n</span> <span class="bp">←</span> <span class="n">lean.parser.small_nat</span><span class="o">,</span>
  <span class="n">guard</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">∣</span> <span class="n">n</span><span class="o">)))</span> <span class="o">:=</span> <span class="n">tactic.skip</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">even</span> <span class="mi">1234</span> <span class="c1">-- ok</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">even</span> <span class="mi">1233</span> <span class="c1">-- parse error</span>
</code></pre></div>



<a name="213707202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213707202" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213707202">(Oct 18 2020 at 13:47)</a>:</h4>
<p>I'm saying that it is impossible to parse lean without also doing everything else lean does. It is not a separate pass</p>



<a name="213817767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213817767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213817767">(Oct 19 2020 at 17:21)</a>:</h4>
<p>can you get Lean to output a representation of the abstract syntax tree of a file? like in python, it's also a pain to make a third-party parser for Python code, but you don't have to do it because Python itself can use its parser and then you can walk the AST to encode it into json or something</p>



<a name="213818073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213818073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213818073">(Oct 19 2020 at 17:23)</a>:</h4>
<p>I think there never really is an abstract syntax tree, or at least, not of the whole file at the same time</p>



<a name="213818145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213818145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213818145">(Oct 19 2020 at 17:24)</a>:</h4>
<p>which isn't to say you couldn't retrofit such a concept onto Lean, but it sounds like a lot of work</p>



<a name="213818275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213818275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213818275">(Oct 19 2020 at 17:25)</a>:</h4>
<p>I looked into how the "return information for the identifier at a specific location" feature works and it just reparses the whole file up to that location</p>



<a name="213818742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213818742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213818742">(Oct 19 2020 at 17:28)</a>:</h4>
<p>weird</p>



<a name="213818786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213818786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213818786">(Oct 19 2020 at 17:28)</a>:</h4>
<p>In Lean 4 the parser is written in Lean and will be user-extensible in ways which hopefully include being able to capture the parsed AST for whatever nefarious purposes one might have</p>



<a name="213819211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213819211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213819211">(Oct 19 2020 at 17:31)</a>:</h4>
<p>and there's actually a <code>Syntax</code> Lean type which is the AST, rather than, when the parser encounters the <code>inductive</code> keyword, it just calling the handler for <code>inductive</code> commands, or however it works now</p>



<a name="213819641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213819641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213819641">(Oct 19 2020 at 17:35)</a>:</h4>
<p>One way to implement AST retrieval would be to have an AST structure in the parser state, and then just log all parser function calls in it, i.e. whenever you call <code>p.inductive()</code> the first thing it does is call <code>ast.inductive()</code> which pushes an inductive AST node on the stack. You end up with a preorder traversal of the AST as an array and stream that out</p>



<a name="213819809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213819809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213819809">(Oct 19 2020 at 17:36)</a>:</h4>
<p>i guess even the ast is kind of weird if you're thinking of external proof minimizers or similar</p>



<a name="213819903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213819903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213819903">(Oct 19 2020 at 17:37)</a>:</h4>
<p>what you really want is a reduced language... like theoretically, would it be possible to write every proof in lean as a sequence of <code>have ___, from &lt;existing lemma&gt; _ _ _</code> type lines?</p>



<a name="213819943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213819943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213819943">(Oct 19 2020 at 17:37)</a>:</h4>
<p>because otherwise the minimizer has to understand <code>norm_num</code>, <code>solve_by_elim</code>, all these complex things</p>



<a name="213819975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213819975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213819975">(Oct 19 2020 at 17:37)</a>:</h4>
<p>That kind of thing is in the olean files and the export format, and there are already external parsers for that</p>



<a name="213820121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820121">(Oct 19 2020 at 17:38)</a>:</h4>
<p>the external typecheckers work on the data from the export format, which you can get by running <code>lean --export</code></p>



<a name="213820174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820174">(Oct 19 2020 at 17:39)</a>:</h4>
<p>but what we don't have access to is stuff like the list of tactics used in a file</p>



<a name="213820177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820177">(Oct 19 2020 at 17:39)</a>:</h4>
<p>But this might somehow be "too reduced"</p>



<a name="213820282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820282">(Oct 19 2020 at 17:40)</a>:</h4>
<p>it's too reduced to minimize a proof - it isn't obvious how minimal a lean proof is, from its compiled form. it might be useful for something though...</p>



<a name="213820355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820355">(Oct 19 2020 at 17:41)</a>:</h4>
<p>the olean files are a bit more feature rich in that they contain notations and annotations, in addition to raw logical proof data (which is all that is in the lean export files), but they don't have anything about <code>begin end</code> blocks</p>



<a name="213820392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820392">(Oct 19 2020 at 17:41)</a>:</h4>
<p>is lean 4 going to maintain these formats</p>



<a name="213820416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820416">(Oct 19 2020 at 17:41)</a>:</h4>
<p>no, olean was never meant to be a stable format</p>



<a name="213820463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820463">(Oct 19 2020 at 17:42)</a>:</h4>
<p>and even the core logic has changed so the export format would have to be different</p>



<a name="213820533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820533">(Oct 19 2020 at 17:42)</a>:</h4>
<p>but I think in lean 4 there won't be an export format (but there will be enough tools to roll your own)</p>



<a name="213820560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820560">(Oct 19 2020 at 17:42)</a>:</h4>
<p>i wonder how painful transitioning from 3 -&gt; 4 is going to be....</p>



<a name="213820573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820573">(Oct 19 2020 at 17:42)</a>:</h4>
<p>quite</p>



<a name="213820673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820673">(Oct 19 2020 at 17:44)</a>:</h4>
<p>I'm told that lean 4 is at least compatible enough to read lean 3 olean files and get "raw mathlib"</p>



<a name="213820759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820759">(Oct 19 2020 at 17:44)</a>:</h4>
<p>or maybe that was the export format? <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> knows</p>



<a name="213820764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820764">(Oct 19 2020 at 17:44)</a>:</h4>
<p>olean or export?</p>



<a name="213820780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820780">(Oct 19 2020 at 17:44)</a>:</h4>
<p>I think it was export</p>



<a name="213820841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820841">(Oct 19 2020 at 17:45)</a>:</h4>
<p>that would make more sense. No one wants to parse the rats nest that is olean files</p>



<a name="213820868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820868">(Oct 19 2020 at 17:45)</a>:</h4>
<p>says the author of olean-rs</p>



<a name="213820882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820882" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820882">(Oct 19 2020 at 17:45)</a>:</h4>
<p>by the way, last time I checked it was out of date <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="213820978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213820978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213820978">(Oct 19 2020 at 17:46)</a>:</h4>
<p>I should do something about that</p>



<a name="213821027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821027">(Oct 19 2020 at 17:46)</a>:</h4>
<p>There is an importer for the text output format here: <a href="https://github.com/gebner/lean4-mathlib-import">https://github.com/gebner/lean4-mathlib-import</a></p>



<a name="213821073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821073">(Oct 19 2020 at 17:47)</a>:</h4>
<h1>Import mathlib into Lean 4</h1>
<p>This tool takes the text export of <a href="https://github.com/leanprover-community/mathlib">mathlib</a> and creates an olean file that you can import with <a href="https://github.com/leanprover/lean4">Lean 4</a>.</p>
<p>Notation, etc., is not supported.  All theorems are imported as axioms.  Some names are adapted to the new convention, some aren't.  <strong>This code is not intended for production.</strong></p>
<p>You can build the <code>Mathlib.olean</code> as follows (make sure you have enough RAM):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">make</span>
<span class="n">make</span> <span class="n">emacs</span>    <span class="bp">#</span> <span class="n">install</span> <span class="n">the</span> <span class="n">lean4</span> <span class="n">emacs</span> <span class="n">package</span> <span class="n">yourself</span><span class="bp">!</span>
</code></pre></div>

<p>(If you're on NixOS, you might need to run everything inside <code>nix-shell ~/lean4</code>.)</p>
<p>After that, you can import mathlib and play with it in Lean 4:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Import.Mathlib</span>
<span class="k">#check</span> <span class="o">(</span><span class="n">deriv</span> <span class="o">:</span> <span class="o">(</span><span class="n">real</span> <span class="bp">→</span> <span class="n">real</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">real</span> <span class="bp">→</span> <span class="n">real</span><span class="o">))</span>
</code></pre></div>



<a name="213821102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821102">(Oct 19 2020 at 17:47)</a>:</h4>
<p>Relevant Zulip thread <a href="#narrow/stream/113488-general/topic/Importing.20mathlib.20into.20Lean.204/near/187561178">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Importing.20mathlib.20into.20Lean.204/near/187561178</a></p>



<a name="213821130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821130">(Oct 19 2020 at 17:47)</a>:</h4>
<p>oh, you <em>write</em> olean files?</p>



<a name="213821160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821160">(Oct 19 2020 at 17:47)</a>:</h4>
<p>so let's say I want to parse, or quasi-parse mathlib. the theory is that you could make a faster library_search if you did some preprocessing and wrote things in a faster language. I just want the names, namespaces, and signatures of the lemmas/theorems, though. enough to generate some code that refers to them. I don't need to verify the proofs. is that possible from the export format?</p>



<a name="213821161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821161">(Oct 19 2020 at 17:47)</a>:</h4>
<p>so I suppose you know what lean 4 olean looks like</p>



<a name="213821234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821234">(Oct 19 2020 at 17:48)</a>:</h4>
<p>I'm using the Lean 4 API for olean files.</p>



<a name="213821374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821374">(Oct 19 2020 at 17:49)</a>:</h4>
<p>You can fairly easily write an introspection tactic from lean to gather that information. That's what leandoc is</p>



<a name="213821421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821421">(Oct 19 2020 at 17:49)</a>:</h4>
<p>You can also reconstruct this information from the export format.</p>



<a name="213821498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821498">(Oct 19 2020 at 17:50)</a>:</h4>
<p>ok. so it's not the full AST but it's like the first level of the AST</p>



<a name="213821520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821520">(Oct 19 2020 at 17:50)</a>:</h4>
<p>more like the last level</p>



<a name="213821547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821547">(Oct 19 2020 at 17:50)</a>:</h4>
<p>it's the fully digested form</p>



<a name="213821604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821604">(Oct 19 2020 at 17:51)</a>:</h4>
<p>well, if you think of the AST as a tree where the root is like a namespace, and the first level of the tree is the children of that namespace, and then the next levels are how those children start to be defined, etc</p>



<a name="213821633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821633">(Oct 19 2020 at 17:51)</a>:</h4>
<p>you don't even have information about implicit args though, so generating a parseable expr from that info is tough</p>



<a name="213821684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821684">(Oct 19 2020 at 17:51)</a>:</h4>
<p>lean isn't really structured like that though</p>



<a name="213821750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821750">(Oct 19 2020 at 17:52)</a>:</h4>
<p>you can put stuff in namespaces in an arbitrary order</p>



<a name="213821777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821777">(Oct 19 2020 at 17:52)</a>:</h4>
<p>from any file</p>



<a name="213821857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821857">(Oct 19 2020 at 17:53)</a>:</h4>
<p>I mean, the file structure is like that with namespaces and sections, but none of that structure is visible in the digested theorems</p>



<a name="213821953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821953">(Oct 19 2020 at 17:53)</a>:</h4>
<p>makes sense. well i'll check out what leandoc does</p>



<a name="213821983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213821983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213821983">(Oct 19 2020 at 17:54)</a>:</h4>
<p>Implicit arguments are there in the text output format.  Even infix notation.</p>



<a name="213822027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213822027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213822027">(Oct 19 2020 at 17:54)</a>:</h4>
<p>But yes, please write your own exporter in lean like doc-gen.</p>



<a name="213822028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213822028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213822028">(Oct 19 2020 at 17:54)</a>:</h4>
<p>That's another thing that you could only get at with a proper AST - we currently have no idea when namespaces and sections start and end, except when you are inside them</p>



<a name="213822175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213822175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213822175">(Oct 19 2020 at 17:55)</a>:</h4>
<p>and getting the current namespace is only recently available too. I think we still can't get at the list of variables in scope</p>



<a name="213822282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/tactic%20preference/near/213822282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/tactic.20preference.html#213822282">(Oct 19 2020 at 17:56)</a>:</h4>
<p>so my dream of writing a <code>def</code>-equivalent tactic is as yet unfulfilled</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>