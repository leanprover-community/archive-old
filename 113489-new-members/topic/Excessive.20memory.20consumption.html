---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Excessive.20memory.20consumption.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html">Excessive memory consumption</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="281799906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281799906" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281799906">(May 10 2022 at 09:38)</a>:</h4>
<p>I'm working on a git branch of mathlib. After I eddited an existing file (algebra/group/units.lean), I opened my own lean file, and lean didn't respond and said the following error at import part:<br>
"invalid import: data.option.defs<br>
excessive memory consumption detected at 'expression traversal' (potential solution: increase memory consumption threshold)"<br>
How should I do?<br>
What I did is: restart VS code and Lean, commit changes and execute <code>leanproject mk-cache</code> and <code>leanproject get-cache</code> in git bash.</p>



<a name="281800656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281800656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281800656">(May 10 2022 at 09:47)</a>:</h4>
<p><code>leanproject mk-cache</code> just saves the files you currently have compiled</p>



<a name="281800706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281800706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281800706">(May 10 2022 at 09:48)</a>:</h4>
<p>When you run <code>get-cache</code> does it say "fetching remote oleans" or "using local oleans"</p>



<a name="281800927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281800927" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281800927">(May 10 2022 at 09:50)</a>:</h4>
<p>It says:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">leanproject</span> <span class="n">get</span><span class="bp">-</span><span class="n">cache</span>
<span class="n">Looking</span> <span class="n">for</span> <span class="n">mathlib</span> <span class="n">oleans</span> <span class="n">for</span> <span class="mi">25</span><span class="n">a62a84e1</span>
  <span class="n">locally...</span>
  <span class="n">Found</span> <span class="kn">local</span> <span class="n">mathlib</span> <span class="n">oleans</span>
<span class="n">Using</span> <span class="n">matching</span> <span class="n">cache</span>
<span class="n">Applying</span> <span class="n">cache</span>
  <span class="n">files</span> <span class="n">extracted</span><span class="o">:</span> <span class="mi">2421</span> <span class="o">[</span><span class="mi">01</span><span class="o">:</span><span class="mi">03</span><span class="o">,</span> <span class="mi">37</span><span class="bp">.</span><span class="mi">92</span><span class="bp">/</span><span class="n">s</span><span class="o">]</span>
</code></pre></div>
<p>so probably it used local oleans.</p>



<a name="281801089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281801089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281801089">(May 10 2022 at 09:52)</a>:</h4>
<p>Should I use <code>leanproject build</code>?</p>



<a name="281801529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281801529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281801529">(May 10 2022 at 09:57)</a>:</h4>
<p>You've poisoned your cache with useless oleans</p>



<a name="281801544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281801544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281801544">(May 10 2022 at 09:57)</a>:</h4>
<p><code>leanproject build</code> would create new ones, but will take a long time</p>



<a name="281801636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281801636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281801636">(May 10 2022 at 09:58)</a>:</h4>
<p>Have you pushed your changes to github at all? If so, then it can build you a better cache (without using your CPU time and electricity!)</p>



<a name="281801811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281801811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281801811">(May 10 2022 at 10:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>, should <code>mk-cache</code> give a warning / overridable error if the oleans are out of date? Is "out of date oleans" something we can actually detect right now?</p>



<a name="281806727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281806727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281806727">(May 10 2022 at 10:52)</a>:</h4>
<p>Thanks, so I shouldn't have used<code>leanproject mk-cache</code>.<br>
Now I pushed it to github, so what should I do next?</p>



<a name="281810206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281810206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281810206">(May 10 2022 at 11:33)</a>:</h4>
<p>I used <code>leanproject --force-download get-cache</code>, and problem went away! Thanks!</p>



<a name="281823428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281823428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281823428">(May 10 2022 at 13:25)</a>:</h4>
<p>I forgot that option existed; indeed, that's exactly the right solution</p>



<a name="281823539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281823539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281823539">(May 10 2022 at 13:26)</a>:</h4>
<p><code>mk-cache</code> is mainly useful for if you started a local build, but then decide to switch branch to work on something else. When you reload the cache, you'll be able to resume your build where you left off</p>



<a name="281823658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281823658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281823658">(May 10 2022 at 13:27)</a>:</h4>
<p>Local builds are often useful if you edit <code>really_basic_file.lean</code> and run <code>lean --make mostly_basic_file.lean</code>;  rather than pushing to github and waiting an hour or two for it to build everything</p>



<a name="281825992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281825992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281825992">(May 10 2022 at 13:46)</a>:</h4>
<p>Just for future reference, you could always just delete the poisoned cache directly. On Linux they are stored in <code>~/.mathlib</code>. I'm not sure where they are on another OS.</p>



<a name="281851423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/281851423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#281851423">(May 10 2022 at 16:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Excessive.20memory.20consumption/near/281801811">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span>, should <code>mk-cache</code> give a warning / overridable error if the oleans are out of date? Is "out of date oleans" something we can actually detect right now?</p>
</blockquote>
<p>I never use this command myself. I'm open to any modification.</p>



<a name="282402700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/282402700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#282402700">(May 15 2022 at 10:32)</a>:</h4>
<p>What's the usual way when modifying many imported files?<br>
I modified such a file again, and I run <code>lean --make</code> for it, but lean was very slow and I had to commit and push it to github and wait.<br>
Is this a usual case?</p>



<a name="282402786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/282402786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#282402786">(May 15 2022 at 10:34)</a>:</h4>
<p>If you change files that many other files depend on, yeah, that's common</p>



<a name="282405089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/282405089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Haruhisa Enomoto <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#282405089">(May 15 2022 at 11:33)</a>:</h4>
<p>OK, I didn't know that, thanks!</p>



<a name="282854688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/282854688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Helwer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#282854688">(May 18 2022 at 21:58)</a>:</h4>
<p>I just installed lean and mathlib from the vs code extension, and get the same error when opening 00_first_proofs.lean in the tutorials directory; it runs for a while then times out. The leanproject binary doesn't seem to be included in .elan/bin so I can't download a cache.</p>



<a name="282855483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/282855483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#282855483">(May 18 2022 at 22:04)</a>:</h4>
<p>You need to follow installation instructions from <a href="https://leanprover-community.github.io/get_started.html#regular-install">https://leanprover-community.github.io/get_started.html#regular-install</a> if you want the full tooling</p>



<a name="282855517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Excessive%20memory%20consumption/near/282855517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Andrew Helwer <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Excessive.20memory.20consumption.html#282855517">(May 18 2022 at 22:05)</a>:</h4>
<p>(deleted)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>