---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Add.20declaration.20to.20environment.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Add.20declaration.20to.20environment.html">Add declaration to environment</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="205494185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Add%20declaration%20to%20environment/near/205494185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Add.20declaration.20to.20environment.html#205494185">(Jul 30 2020 at 15:35)</a>:</h4>
<p>While working with what to me looks a fairly reasonable definition, I ran into a"failed to add declaration to environment" error. Where did I go wrong?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">geometry</span><span class="bp">.</span><span class="n">manifold</span><span class="bp">.</span><span class="n">times_cont_mdiff</span>
<span class="kn">import</span> <span class="n">topology</span><span class="bp">.</span><span class="n">continuous_map</span>

<span class="c">/-</span><span class="cm">!</span>
<span class="cm"># Smooth bundled map</span>

<span class="cm">In this file we define the type `smooth_map` of smooth bundled maps.</span>

<span class="cm">-/</span>

<span class="kn">variables</span> <span class="o">{</span><span class="err">ùïú</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">nondiscrete_normed_field</span> <span class="err">ùïú</span><span class="o">]</span>
<span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E</span><span class="o">]</span>
<span class="o">{</span><span class="n">E&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E&#39;</span><span class="o">]</span>
<span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H</span><span class="o">]</span>
<span class="o">{</span><span class="n">H&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H&#39;</span><span class="o">]</span>
<span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E</span> <span class="n">H</span><span class="o">}</span> <span class="o">{</span><span class="n">I&#39;</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E&#39;</span> <span class="n">H&#39;</span><span class="o">}</span>
<span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">charted_space</span> <span class="n">H</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I</span> <span class="n">M</span><span class="o">]</span>
<span class="o">{</span><span class="n">M&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">charted_space</span> <span class="n">H&#39;</span> <span class="n">M&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I&#39;</span> <span class="n">M&#39;</span><span class="o">]</span>
<span class="o">{</span><span class="n">E&#39;&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">normed_group</span> <span class="n">E&#39;&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">normed_space</span> <span class="err">ùïú</span> <span class="n">E&#39;&#39;</span><span class="o">]</span>
<span class="o">{</span><span class="n">H&#39;&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">H&#39;&#39;</span><span class="o">]</span>
<span class="o">{</span><span class="n">I&#39;&#39;</span> <span class="o">:</span> <span class="n">model_with_corners</span> <span class="err">ùïú</span> <span class="n">E&#39;&#39;</span> <span class="n">H&#39;&#39;</span><span class="o">}</span>
<span class="o">{</span><span class="n">M&#39;&#39;</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">M&#39;&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">charted_space</span> <span class="n">H&#39;&#39;</span> <span class="n">M&#39;&#39;</span><span class="o">]</span> <span class="o">[</span><span class="n">smooth_manifold_with_corners</span> <span class="n">I&#39;&#39;</span> <span class="n">M&#39;&#39;</span><span class="o">]</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">I</span><span class="o">)</span> <span class="o">(</span><span class="n">I&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">M&#39;</span><span class="o">)</span>

<span class="bp">@</span><span class="o">[</span><span class="n">protect_proj</span><span class="o">]</span>
<span class="kn">structure</span> <span class="n">smooth_map</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span>             <span class="o">:</span> <span class="n">M</span> <span class="bp">‚Üí</span> <span class="n">M&#39;</span><span class="o">)</span>
<span class="o">(</span><span class="n">smooth_to_fun</span>      <span class="o">:</span> <span class="n">smooth</span> <span class="n">I</span> <span class="n">I&#39;</span> <span class="n">to_fun</span><span class="o">)</span>

<span class="kn">notation</span> <span class="bp">`</span><span class="n">C</span><span class="err">‚àû</span><span class="o">(</span><span class="bp">`</span> <span class="n">I</span> <span class="bp">`</span><span class="o">,</span> <span class="bp">`</span> <span class="n">M</span> <span class="bp">`;</span> <span class="bp">`</span> <span class="n">I&#39;</span> <span class="bp">`</span><span class="o">,</span> <span class="bp">`</span> <span class="n">M&#39;</span> <span class="bp">`</span><span class="o">)</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">smooth_map</span> <span class="n">I</span> <span class="n">I&#39;</span> <span class="n">M</span> <span class="n">M&#39;</span>

<span class="kn">namespace</span> <span class="n">smooth_map</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">I</span><span class="o">}</span> <span class="o">{</span><span class="n">I&#39;</span><span class="o">}</span> <span class="o">{</span><span class="n">M</span><span class="o">}</span> <span class="o">{</span><span class="n">M&#39;</span><span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="n">C</span><span class="err">‚àû</span><span class="o">(</span><span class="n">I</span><span class="o">,</span> <span class="n">M</span><span class="bp">;</span> <span class="n">I&#39;</span><span class="o">,</span> <span class="n">M&#39;</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">‚ü®_</span><span class="o">,</span> <span class="n">smooth_map</span><span class="bp">.</span><span class="n">to_fun</span><span class="bp">‚ü©</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="n">C</span><span class="err">‚àû</span><span class="o">(</span><span class="n">I</span><span class="o">,</span> <span class="n">M</span><span class="bp">;</span> <span class="n">I&#39;</span><span class="o">,</span> <span class="n">M&#39;</span><span class="o">)</span> <span class="n">C</span><span class="o">(</span><span class="n">M</span><span class="o">,</span> <span class="n">M&#39;</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">‚ü®Œª</span> <span class="n">f</span><span class="o">,</span> <span class="bp">‚ü®</span><span class="n">f</span><span class="bp">.</span><span class="n">to_fun</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">smooth_to_fun</span><span class="bp">.</span><span class="n">continuous</span><span class="bp">‚ü©‚ü©</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">C</span><span class="err">‚àû</span><span class="o">(</span><span class="n">I</span><span class="o">,</span> <span class="n">M</span><span class="bp">;</span> <span class="n">I&#39;</span><span class="o">,</span> <span class="n">M&#39;</span><span class="o">)}</span>

<span class="kn">lemma</span> <span class="n">coe_inj</span> <span class="o">‚¶É</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">C</span><span class="err">‚àû</span><span class="o">(</span><span class="n">I</span><span class="o">,</span> <span class="n">M</span><span class="bp">;</span> <span class="n">I&#39;</span><span class="o">,</span> <span class="n">M&#39;</span><span class="o">)‚¶Ñ</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">M</span> <span class="bp">‚Üí</span> <span class="n">M&#39;</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">g</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h</span><span class="bp">;</span> <span class="n">refl</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">kernel failed to type check declaration &#39;ext&#39; this is usually due to a buggy tactic or a bug in the builtin elaborator</span>
<span class="cm">elaborated type:</span>
<span class="cm">  ‚àÄ {ùïú : Type u_1} [_inst_1 : nondiscrete_normed_field ùïú] {E : Type u_2} [_inst_2 : normed_group E]</span>
<span class="cm">  [_inst_3 : normed_space ùïú E] {E&#39; : Type u_3} [_inst_4 : normed_group E&#39;] [_inst_5 : normed_space ùïú E&#39;]</span>
<span class="cm">  [_inst_6 : topological_space H] {H&#39; : Type u_5} [_inst_7 : topological_space H&#39;] {I : model_with_corners ùïú E H}</span>
<span class="cm">  {I&#39; : model_with_corners ùïú E&#39; H&#39;} {M : Type u_6} [_inst_8 : topological_space M] [_inst_9 : charted_space H M]</span>
<span class="cm">  [_inst_10 : smooth_manifold_with_corners I M] {M&#39; : Type u_7} [_inst_11 : topological_space M&#39;]</span>
<span class="cm">  [_inst_12 : charted_space H&#39; M&#39;] [_inst_13 : smooth_manifold_with_corners I&#39; M&#39;] {f g : C‚àû(I, M; I&#39;, M&#39;)}</span>
<span class="cm">  {H_1 : Type u_4}, (‚àÄ (x : M), ‚áëf x = ‚áëg x) ‚Üí f = g</span>
<span class="cm">elaborated value:</span>
<span class="cm">  Œª {ùïú : Type u_1} [_inst_1 : nondiscrete_normed_field ùïú] {E : Type u_2} [_inst_2 : normed_group E]</span>
<span class="cm">  [_inst_3 : normed_space ùïú E] {E&#39; : Type u_3} [_inst_4 : normed_group E&#39;] [_inst_5 : normed_space ùïú E&#39;]</span>
<span class="cm">  [_inst_6 : topological_space H] {H&#39; : Type u_5} [_inst_7 : topological_space H&#39;] {I : model_with_corners ùïú E H}</span>
<span class="cm">  {I&#39; : model_with_corners ùïú E&#39; H&#39;} {M : Type u_6} [_inst_8 : topological_space M] [_inst_9 : charted_space H M]</span>
<span class="cm">  [_inst_10 : smooth_manifold_with_corners I M] {M&#39; : Type u_7} [_inst_11 : topological_space M&#39;]</span>
<span class="cm">  [_inst_12 : charted_space H&#39; M&#39;] [_inst_13 : smooth_manifold_with_corners I&#39; M&#39;] {f g : C‚àû(I, M; I&#39;, M&#39;)}</span>
<span class="cm">  {H_1 : Type u_4} (H_1 : ‚àÄ (x : M), ‚áëf x = ‚áëg x), sorry</span>
<span class="cm">nested exception message:</span>
<span class="cm">failed to add declaration to environment, it contains local constants</span>
<span class="cm">-/</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ext</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">ext</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="n">x</span><span class="o">,</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span> <span class="n">sorry</span>
</code></pre></div>



<a name="205496455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Add%20declaration%20to%20environment/near/205496455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Add.20declaration.20to.20environment.html#205496455">(Jul 30 2020 at 15:54)</a>:</h4>
<p>You have a space <code>H</code> and an assumption <code>H</code>, and Lean is confused. Use another letter for your assumption, and things should hopefully be better.</p>



<a name="205499674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Add%20declaration%20to%20environment/near/205499674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicol√≤ Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Add.20declaration.20to.20environment.html#205499674">(Jul 30 2020 at 16:19)</a>:</h4>
<p>Ops haha I did not notice that, I copied the file from topology, changed smooth with continuous and did not even look at the name of the hypothesis</p>



<a name="205507992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Add%20declaration%20to%20environment/near/205507992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Add.20declaration.20to.20environment.html#205507992">(Jul 30 2020 at 17:35)</a>:</h4>
<p>The error message is not extremely helpful, indeed :-)</p>



<a name="205508396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Add%20declaration%20to%20environment/near/205508396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Add.20declaration.20to.20environment.html#205508396">(Jul 30 2020 at 17:38)</a>:</h4>
<p>Yes it's impressively bad on this occasion, something perhaps to remember. Actually I'm not sure I ever remember seeing this message and it being caused by a buggy tactic or a bug in the built-in elaborator</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>