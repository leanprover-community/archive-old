---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Substitution.20notation.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html">Substitution notation</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202766671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202766671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202766671">(Jul 03 2020 at 03:58)</a>:</h4>
<p>I am having trouble defining notation for substitution. I want <code>M[x/N] = subst x N M</code> and <code>M[x/N][y/L] = (M[x/N])[y/L]</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">axioms</span> <span class="o">(</span><span class="n">term</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span>
<span class="kn">axiom</span> <span class="n">subst</span> <span class="o">:</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span><span class="o">[</span><span class="bp">`</span> <span class="n">x</span> <span class="bp">`/`</span> <span class="n">N</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span> <span class="c1">-- Unsure about this definition.</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">/</span> <span class="n">N</span> <span class="o">]</span> <span class="c1">-- Fails: `command expected`.</span>
</code></pre></div>



<a name="202767076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767076">(Jul 03 2020 at 04:08)</a>:</h4>
<p>I think your problem is a conflict with some built in notation, I suggest you pick a different unicode character.</p>
<div class="codehilite"><pre><span></span><code><span class="n">axioms</span> <span class="o">(</span><span class="n">term</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span>
<span class="kn">axiom</span> <span class="n">subst</span> <span class="o">:</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span><span class="err">ðŸ˜€</span><span class="bp">`</span> <span class="n">x</span> <span class="bp">`</span><span class="err">ðŸ˜ƒ</span><span class="bp">`</span> <span class="n">N</span> <span class="bp">`</span><span class="err">ðŸ˜€</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span> <span class="c1">-- Unsure about this definition.</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="err">ðŸ˜€</span> <span class="mi">0</span> <span class="err">ðŸ˜ƒ</span><span class="n">N</span> <span class="err">ðŸ˜€</span> <span class="c1">-- works</span>
</code></pre></div>



<a name="202767101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767101">(Jul 03 2020 at 04:09)</a>:</h4>
<p>The <code>/</code> seems to be the problem though, you could try setting the priority higher also</p>



<a name="202767162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767162">(Jul 03 2020 at 04:10)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">axioms</span> <span class="o">(</span><span class="n">term</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span>
<span class="kn">axiom</span> <span class="n">subst</span> <span class="o">:</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span> <span class="o">[</span> <span class="bp">`</span> <span class="n">x</span> <span class="bp">`</span> <span class="bp">//</span> <span class="bp">`</span> <span class="n">N</span> <span class="bp">`</span> <span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span> <span class="c1">-- Unsure about this definition.</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">N</span> <span class="o">]</span> <span class="c1">-- M [ 0 // N ] : term</span>
</code></pre></div>



<a name="202767163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767163">(Jul 03 2020 at 04:10)</a>:</h4>
<p>For example, setting a low precedence level</p>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="mi">1</span> <span class="n">x</span> <span class="bp">`</span><span class="err">â†¦</span><span class="bp">`</span><span class="o">:</span><span class="mi">1</span> <span class="n">N</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span><span class="o">:</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span> <span class="c1">-- Unsure about this definition.</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="err">â†¦</span> <span class="n">N</span> <span class="o">]</span> <span class="c1">-- OK</span>
</code></pre></div>



<a name="202767176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767176">(Jul 03 2020 at 04:10)</a>:</h4>
<p>I found that setting a precendence level of <code>[</code> or <code>]</code> causes all <code>[</code> and <code>]</code> globally to change precendence, so maybe it is best not to change it</p>



<a name="202767185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767185">(Jul 03 2020 at 04:11)</a>:</h4>
<p>It probably has a good precedence level for this application to begin with, I suppose.</p>



<a name="202767330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767330" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767330">(Jul 03 2020 at 04:14)</a>:</h4>
<p>The following notation works:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span> <span class="o">[</span><span class="bp">`</span> <span class="n">x</span> <span class="bp">`</span> <span class="o">:=</span> <span class="bp">`</span> <span class="n">N</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span>
</code></pre></div>


<p>But using <code>:=</code> looks fishy.</p>



<a name="202767538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767538">(Jul 03 2020 at 04:20)</a>:</h4>
<p>All suggestions seem to break down with <code>M [ 0 // M [ 0 // M ] ]</code> (<code>M [ 0 // (M [ 0 // M ]) ]</code> works).</p>
<p>I remember seeing something that seem to solve this exact problem (resetting the precedence inside the notation or something like that), but I don't remember exactly.</p>



<a name="202767561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767561">(Jul 03 2020 at 04:21)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span><span class="o">[</span><span class="bp">`</span> <span class="n">x</span> <span class="bp">`//`</span> <span class="n">N</span><span class="o">:</span><span class="mi">0</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">[</span><span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span><span class="o">]]</span>
</code></pre></div>



<a name="202767630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767630">(Jul 03 2020 at 04:22)</a>:</h4>
<p>Changing the priority of <code>[</code> breaks it.</p>
<div class="codehilite"><pre><span></span><code><span class="n">axioms</span> <span class="o">(</span><span class="n">term</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="n">N</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span>
<span class="kn">axiom</span> <span class="n">subst</span> <span class="o">:</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span> <span class="o">[</span> <span class="bp">`</span> <span class="n">x</span> <span class="bp">`</span> <span class="bp">//</span> <span class="bp">`</span> <span class="n">N</span> <span class="bp">`</span> <span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">]</span> <span class="o">]</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span> <span class="o">[</span> <span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="n">x</span> <span class="bp">`</span> <span class="bp">//</span> <span class="bp">`</span> <span class="n">N</span> <span class="bp">`</span> <span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">]</span> <span class="o">]</span> <span class="c1">-- Fails.</span>
</code></pre></div>



<a name="202767645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/202767645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#202767645">(Jul 03 2020 at 04:23)</a>:</h4>
<p>The following works. Apparently the precedence of <code>[</code> can't be less than <code>N</code>'s.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span> <span class="o">[</span> <span class="bp">`</span><span class="o">:</span><span class="mi">1</span> <span class="n">x</span> <span class="bp">`</span> <span class="bp">//</span> <span class="bp">`</span> <span class="n">N</span><span class="o">:</span><span class="mi">0</span> <span class="bp">`</span> <span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="n">x</span> <span class="n">N</span> <span class="n">M</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">[</span> <span class="mi">0</span> <span class="bp">//</span> <span class="n">M</span> <span class="o">]</span> <span class="o">]</span>
</code></pre></div>



<a name="203040808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203040808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203040808">(Jul 06 2020 at 21:07)</a>:</h4>
<p>Is it possible to have a "postfix with more arguments"?</p>



<a name="203040812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203040812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203040812">(Jul 06 2020 at 21:07)</a>:</h4>
<p>I am using <code>notation M `[` x ` := ` L `]` := subst x L M</code> for my substitution notation. In goals, Lean displays <code>f M[x := L]</code> for <code>f (M[x := L])</code>, however, if I write <code>f M[x := L]</code> Lean parses it as <code>(f M)[x := L]</code>, which makes sense, because of the precedence of function application.</p>



<a name="203042551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203042551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203042551">(Jul 06 2020 at 21:24)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">axiom</span> <span class="n">term</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kn">axiom</span> <span class="n">shift</span> <span class="o">:</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>
<span class="kn">axiom</span> <span class="n">subst</span> <span class="o">:</span> <span class="o">(</span><span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span><span class="o">)</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>
<span class="kn">axiom</span> <span class="n">Ïƒ</span> <span class="o">:</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span><span class="o">[</span><span class="bp">`</span> <span class="n">x</span> <span class="bp">`</span> <span class="o">:=</span> <span class="bp">`</span> <span class="n">L</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="o">(</span><span class="n">Ïƒ</span> <span class="n">x</span> <span class="n">L</span><span class="o">)</span> <span class="n">M</span>

<span class="kn">axiom</span> <span class="n">problematic</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">â„•</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="n">R</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">shift</span> <span class="o">(</span><span class="n">L</span><span class="o">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">L</span><span class="o">])</span> <span class="bp">=</span> <span class="n">shift</span> <span class="n">R</span><span class="o">[</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">shift</span> <span class="n">R</span><span class="o">]</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">problematic</span> <span class="c1">-- `shift L[x := L] = (shift R)[x + 1 := shift R]`!!</span>

<span class="c1">-- The type of this axiom is what `#check problematic` displays, which is different from `problematic`.</span>
<span class="kn">axiom</span> <span class="n">problematic&#39;</span> <span class="o">:</span> <span class="bp">âˆ€</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">â„•</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="n">M</span> <span class="o">:</span> <span class="n">term</span><span class="o">),</span>
  <span class="n">shift</span> <span class="n">M</span><span class="o">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">L</span><span class="o">]</span> <span class="bp">=</span> <span class="o">(</span><span class="n">shift</span> <span class="n">M</span><span class="o">)[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">L</span><span class="o">]</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">problematic&#39;</span>
</code></pre></div>



<a name="203042644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203042644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203042644">(Jul 06 2020 at 21:25)</a>:</h4>
<p>This leads to my question: can I have something like <code>postfix `[` x ` := ` L `]` := subst x L</code>, so that Lean parses what I write as it displays goals?</p>



<a name="203043601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203043601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203043601">(Jul 06 2020 at 21:36)</a>:</h4>
<p>Could you change the binding power of <code>[</code> and <code>]</code> to be higher than function application?</p>



<a name="203043635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203043635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203043635">(Jul 06 2020 at 21:36)</a>:</h4>
<p>Is the issue that it's not parsing the way you expect it to?  What would the fully parenthesized version of <code>problematic</code> be?</p>



<a name="203043864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203043864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203043864">(Jul 06 2020 at 21:38)</a>:</h4>
<p>(I'm guessing you want the substitution brackets to have higher precedence than function application, which Yakov addresses.  I've heard changing binding power of something like <code>[</code> and <code>]</code> can mess up parsing elsewhere, though.)</p>



<a name="203044071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044071">(Jul 06 2020 at 21:40)</a>:</h4>
<p>As a stopgap:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">axiom</span> <span class="n">problematic</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">â„•</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="n">R</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">shift</span> <span class="o">(</span><span class="n">L</span><span class="o">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">L</span><span class="o">])</span> <span class="bp">=</span> <span class="n">shift</span> <span class="err">$</span> <span class="n">R</span><span class="o">[</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">shift</span> <span class="n">R</span><span class="o">]</span>
</code></pre></div>



<a name="203044145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044145">(Jul 06 2020 at 21:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/113489-new-members/topic/Substitution.20notation/near/203043601">said</a>:</p>
<blockquote>
<p>Could you change the binding power of <code>[</code> and <code>]</code> to be higher than function application?</p>
</blockquote>
<p>I've tried setting the precedence of <code>[</code> to <code>:max</code> (if that is what you mean by binding power), didn't solve the issue.</p>



<a name="203044206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044206">(Jul 06 2020 at 21:42)</a>:</h4>
<p>and was it left-binding or right-binding?</p>



<a name="203044249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044249">(Jul 06 2020 at 21:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113489-new-members/topic/Substitution.20notation/near/203043635">said</a>:</p>
<blockquote>
<p>Is the issue that it's not parsing the way you expect it to?  What would the fully parenthesized version of <code>problematic</code> be?</p>
</blockquote>
<p>The issue is the mismatch between Lean's parser and printer. I've expanded the example, should make things clearer.</p>



<a name="203044250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044250">(Jul 06 2020 at 21:42)</a>:</h4>
<p>well there's your problem--you need to set it higher than that! <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="203044286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044286">(Jul 06 2020 at 21:43)</a>:</h4>
<p>See <code>data.opposite</code> for example</p>



<a name="203044295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044295">(Jul 06 2020 at 21:43)</a>:</h4>
<p>Naming seems to imply it shouldn't be possible. I'll give it a try.</p>



<a name="203044315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044315">(Jul 06 2020 at 21:43)</a>:</h4>
<p>Disclaimer: I have no idea what will happen with <code>[]</code> specifically, but there are plenty of other bracket characters available if you need them...</p>



<a name="203044324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203044324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203044324">(Jul 06 2020 at 21:43)</a>:</h4>
<p>In flypitch we used </p>
<div class="codehilite"><pre><span></span><code><span class="kn">notation</span> <span class="n">t</span> <span class="bp">`</span><span class="o">[</span><span class="bp">`</span><span class="o">:</span><span class="n">max</span> <span class="n">s</span> <span class="bp">`</span> <span class="bp">//</span> <span class="bp">`</span><span class="o">:</span><span class="mi">95</span> <span class="n">n</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span><span class="o">:</span><span class="mi">0</span> <span class="o">:=</span> <span class="n">fol</span><span class="bp">.</span><span class="n">subst_term</span> <span class="n">t</span> <span class="n">s</span> <span class="n">n</span>
</code></pre></div>


<p><a href="https://github.com/flypitch/flypitch/blob/c762ba89b7ca4d3e014aee0dc89d804454c38808/src/fol.lean#L357">https://github.com/flypitch/flypitch/blob/c762ba89b7ca4d3e014aee0dc89d804454c38808/src/fol.lean#L357</a></p>



<a name="203045040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203045040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203045040">(Jul 06 2020 at 21:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="298376">Pedro Minicz</span> <a href="#narrow/stream/113489-new-members/topic/Substitution.20notation/near/203044249">said</a>:</p>
<blockquote>
<p>The issue is the mismatch between Lean's parser and printer. I've expanded the example, should make things clearer.</p>
</blockquote>
<p>I see.  It doesn't seem to be a good thing that the parser/pretty-printer doesn't round trip here.  I've modified your example a bit to demonstrate the issue a little clearer:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">axiom</span> <span class="n">term</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kn">axiom</span> <span class="n">shift</span> <span class="o">:</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>
<span class="kn">axiom</span> <span class="n">subst</span> <span class="o">:</span> <span class="o">(</span><span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span><span class="o">)</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="n">term</span>
<span class="kn">axiom</span> <span class="n">Ïƒ</span> <span class="o">:</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span> <span class="bp">â†’</span> <span class="bp">â„•</span> <span class="bp">â†’</span> <span class="n">term</span>

<span class="kn">notation</span> <span class="n">M</span> <span class="bp">`</span><span class="o">[</span><span class="bp">`</span> <span class="n">x</span> <span class="bp">`</span> <span class="o">:=</span> <span class="bp">`</span> <span class="n">L</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">subst</span> <span class="o">(</span><span class="n">Ïƒ</span> <span class="n">x</span> <span class="n">L</span><span class="o">)</span> <span class="n">M</span>

<span class="kn">axiom</span> <span class="n">problematic</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">â„•</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">âˆƒ</span> <span class="n">R</span><span class="o">,</span> <span class="n">shift</span> <span class="o">(</span><span class="n">L</span><span class="o">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">L</span><span class="o">])</span> <span class="bp">=</span> <span class="n">R</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">problematic</span> <span class="c1">-- âˆ€ (x : â„•) (L : term), âˆƒ (R : term), shift L[x := L] = R</span>

<span class="kn">axiom</span> <span class="n">problematic&#39;</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">â„•</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">term</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">âˆƒ</span> <span class="n">R</span><span class="o">,</span> <span class="n">shift</span> <span class="n">L</span><span class="o">[</span><span class="n">x</span> <span class="o">:=</span> <span class="n">L</span><span class="o">]</span> <span class="bp">=</span> <span class="n">R</span>

<span class="bp">#</span><span class="kn">check</span> <span class="n">problematic&#39;</span> <span class="c1">-- âˆ€ (x : â„•) (L : term), âˆƒ (R : term), (shift L)[x := L] = R</span>
</code></pre></div>



<a name="203045241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203045241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203045241">(Jul 06 2020 at 21:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/113489-new-members/topic/Substitution.20notation/near/203044206">said</a>:</p>
<blockquote>
<p>and was it left-binding or right-binding?</p>
</blockquote>
<p>I am not sure.</p>



<a name="203045328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Substitution%20notation/near/203045328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Substitution.20notation.html#203045328">(Jul 06 2020 at 21:54)</a>:</h4>
<p>Changing the precedence of <code>[</code> to <code>std.prec.max_plus</code> solved the issue. Maybe the printer/parser mismatch should be investigated further.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>