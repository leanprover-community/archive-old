---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/unfold.20and.20let.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html">unfold and let</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197342745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197342745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197342745">(May 12 2020 at 21:33)</a>:</h4>
<p>I'm unclear how the <code>let</code> operator works especially in regards to unfolding a definition that uses it. I tried unfolding the definition of a recursive function called <code>anno</code> that uses <code>let</code> and I get something like <code>anno._match_1 ...</code> which I have no clue what to do with. Any ideas? I can provide some code if need be, but it's embedded in a bunch of dependencies so I may have to extract a MWE.</p>



<a name="197342818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197342818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197342818">(May 12 2020 at 21:34)</a>:</h4>
<p>Is this <code>let</code> in term mode or tactic mode?</p>



<a name="197342886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197342886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197342886">(May 12 2020 at 21:34)</a>:</h4>
<p>It's used as part of the recursive definition in term mode.</p>



<a name="197343000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197343000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197343000">(May 12 2020 at 21:35)</a>:</h4>
<p>If you get things compiling with <code>sorry</code> then you can just #check <code>anno._match_1</code> to see what it is. It will be part of the recursive definition.</p>



<a name="197343819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197343819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197343819">(May 12 2020 at 21:43)</a>:</h4>
<p>Hmm... I'm not sure what to do with that information now that I have it. Here's a excerpt of the definition (there are more cases):</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">anno</span> <span class="o">:</span> <span class="n">Term</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="n">AnnoTerm</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">asp</span> <span class="n">x</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">aasp</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">att</span> <span class="n">p</span> <span class="n">x</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">x</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
    <span class="o">(</span><span class="n">j</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">aatt</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">p</span> <span class="n">a</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">lseq</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">x</span> <span class="n">i</span> <span class="k">in</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">y</span> <span class="n">j</span> <span class="k">in</span>
    <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">alseq</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">k</span><span class="o">)</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">bseq</span> <span class="n">s</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">x</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">y</span> <span class="n">j</span> <span class="k">in</span>
    <span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">abseq</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">s</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">bpar</span> <span class="n">s</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">x</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">y</span> <span class="n">j</span> <span class="k">in</span>
    <span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">abpar</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">k</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">s</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>


<p>#check <code>anno._match_1</code> tells me its type is Plc → ℕ → ℕ × AnnoTerm → ℕ × AnnoTerm. </p>
<p>Basically, I'm trying to prove a property about <code>anno</code> by induction. The unfolding gives me a goal with <code>anno._match_1</code>which can't be unfolded further to reduce it to the inductive hypothesis.</p>



<a name="197344337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344337">(May 12 2020 at 21:48)</a>:</h4>
<p>triple backticks give you nicer code blocks, like this </p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">anno</span> <span class="o">:</span> <span class="n">Term</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="n">AnnoTerm</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">asp</span> <span class="n">x</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">aasp</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">att</span> <span class="n">p</span> <span class="n">x</span><span class="o">)</span> <span class="n">i</span> <span class="o">:=</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="n">anno</span> <span class="n">x</span> <span class="o">(</span><span class="n">i</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
    <span class="o">(</span><span class="n">j</span><span class="bp">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">aatt</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">p</span> <span class="n">a</span><span class="o">)</span>
</code></pre></div>



<a name="197344349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344349">(May 12 2020 at 21:48)</a>:</h4>
<p>(also full definitions are usually more useful than excerpts)</p>



<a name="197344393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344393">(May 12 2020 at 21:49)</a>:</h4>
<p>as in:</p>
<div class="codehilite"><pre><span></span><code><span class="bp">```</span>
<span class="o">[</span><span class="n">code</span> <span class="n">goes</span> <span class="n">here</span><span class="o">]</span>
<span class="bp">```</span>
</code></pre></div>



<a name="197344574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344574">(May 12 2020 at 21:50)</a>:</h4>
<p>Haha. Yeah. I was trying to do that but messed it up. It's formatted better now, and I added the rest of the definition.</p>



<a name="197344711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344711">(May 12 2020 at 21:52)</a>:</h4>
<p>my advice is to avoid <code>let</code> unless necessary</p>



<a name="197344735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344735">(May 12 2020 at 21:52)</a>:</h4>
<p>actually maybe it is necessary in this case</p>



<a name="197344819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197344819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197344819">(May 12 2020 at 21:53)</a>:</h4>
<p>can you also post the code where your induction proof is failing?</p>



<a name="197345022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345022">(May 12 2020 at 21:55)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/wiki/Minimum-Working-Example-&#40;MWE&#41;">#mwe</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">fib2</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span>     <span class="o">:=</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fib2</span> <span class="n">n</span> <span class="k">in</span> <span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span><span class="bp">+</span><span class="n">b</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">fib2</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span>

<span class="kn">theorem</span> <span class="n">fib_add_two</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="n">fib</span> <span class="n">n</span> <span class="o">:=</span>
<span class="n">sorry</span>
</code></pre></div>



<a name="197345027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345027">(May 12 2020 at 21:55)</a>:</h4>
<p>I actually don't know how to solve this myself</p>



<a name="197345042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345042">(May 12 2020 at 21:55)</a>:</h4>
<p>Here's the code. I'm doing things <strong>very</strong> explicitly for learning purposes.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">anno_range</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="n">x</span> <span class="n">i</span><span class="o">,</span>
    <span class="n">range</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">snd</span> <span class="o">(</span><span class="n">anno</span> <span class="n">x</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">anno</span> <span class="n">x</span> <span class="n">i</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="n">intro</span> <span class="n">x</span><span class="o">,</span> <span class="n">induction</span> <span class="n">x</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">i</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">anno</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">prod</span><span class="bp">.</span><span class="n">snd</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">prod</span><span class="bp">.</span><span class="n">fst</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">range</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">i</span><span class="o">,</span> <span class="n">unfold</span> <span class="n">anno</span><span class="o">,}</span>
</code></pre></div>


<p>I end up with the following goal: </p>
<div class="codehilite"><pre><span></span><code><span class="mi">1</span> <span class="n">goal</span>
<span class="n">x_a</span> <span class="o">:</span> <span class="n">Plc</span><span class="o">,</span>
<span class="n">x_a_1</span> <span class="o">:</span> <span class="n">Term</span><span class="o">,</span>
<span class="n">x_ih</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">range</span> <span class="o">(</span><span class="n">anno</span> <span class="n">x_a_1</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">snd</span> <span class="bp">=</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">anno</span> <span class="n">x_a_1</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">fst</span><span class="o">),</span>
<span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span>
<span class="err">⊢</span> <span class="n">range</span> <span class="o">(</span><span class="n">anno</span><span class="bp">._</span><span class="n">match_1</span> <span class="n">x_a</span> <span class="n">i</span> <span class="o">(</span><span class="n">anno</span> <span class="n">x_a_1</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span><span class="bp">.</span><span class="n">snd</span> <span class="bp">=</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">anno</span><span class="bp">._</span><span class="n">match_1</span> <span class="n">x_a</span> <span class="n">i</span> <span class="o">(</span><span class="n">anno</span> <span class="n">x_a_1</span> <span class="o">(</span><span class="n">i</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span>
</code></pre></div>



<a name="197345043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345043">(May 12 2020 at 21:55)</a>:</h4>
<p><code>unfold</code> and <code>rw</code> and <code>dsimp only</code> all give me <code>._match_1</code></p>



<a name="197345097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345097">(May 12 2020 at 21:56)</a>:</h4>
<p>I remember being told that <code>let</code> works fine with other things</p>



<a name="197345099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345099">(May 12 2020 at 21:56)</a>:</h4>
<p><span class="user-mention" data-user-id="300396">@Paul Rowe</span>  <code>anno._match_1</code> is probably the function <code>\lam (j, a), (j+1, aatt (i, j+1) p a)</code> representing the remainder of the <code>att</code> case after the <code>let</code></p>



<a name="197345105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345105">(May 12 2020 at 21:56)</a>:</h4>
<p>but my experience tells me to avoid it</p>



<a name="197345172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345172">(May 12 2020 at 21:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> what tactic would you use for my theorem?</p>



<a name="197345176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345176">(May 12 2020 at 21:56)</a>:</h4>
<p>In order to unfold it, the last argument to the auxiliary function must be a pair</p>



<a name="197345186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345186">(May 12 2020 at 21:57)</a>:</h4>
<p>because you pattern matched on it being a pair</p>



<a name="197345361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345361">(May 12 2020 at 21:58)</a>:</h4>
<p>aha</p>



<a name="197345365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345365">(May 12 2020 at 21:58)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">fib2</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span>     <span class="o">:=</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fib2</span> <span class="n">n</span> <span class="k">in</span> <span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span><span class="bp">+</span><span class="n">b</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">fib2</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span>

<span class="kn">theorem</span> <span class="n">fib_add_two</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="n">fib</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">fib</span> <span class="n">fib2</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">fib2</span> <span class="n">n</span> <span class="k">with</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span>
  <span class="c1">-- ⊢ (fib2._match_1 (fib2._match_1 (a, b))).fst = (fib2._match_1 (a, b)).fst + (a, b).fst</span>
  <span class="n">unfold</span> <span class="n">fib2</span><span class="o">,</span>
  <span class="c1">-- ⊢ (a + b, b + (a + b)).fst = (b, a + b).fst + (a, b).fst</span>
  <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">add_comm</span>
<span class="kn">end</span>
</code></pre></div>



<a name="197345407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345407">(May 12 2020 at 21:59)</a>:</h4>
<p><span class="user-mention" data-user-id="300396">@Paul Rowe</span> after you make the input a pair you can actually use <code>unfold fib2</code></p>



<a name="197345418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345418">(May 12 2020 at 21:59)</a>:</h4>
<p>I just discovered this today</p>



<a name="197345441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345441">(May 12 2020 at 21:59)</a>:</h4>
<p>as in, instead of <code>unfold fib2._match_1</code> or something like that</p>



<a name="197345654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345654">(May 12 2020 at 22:01)</a>:</h4>
<p>Oh neat, it made an equational lemma for matching on the let:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fib2</span><span class="bp">._</span><span class="n">match_1</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">fib2</span><span class="bp">._</span><span class="n">match_1</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>



<a name="197345701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345701">(May 12 2020 at 22:01)</a>:</h4>
<p>And indeed <code>unfold</code> is</p>
<blockquote>
<p>Given defined constants <code>e₁ ... eₙ</code>, <code>unfold e₁ ... eₙ</code> iteratively unfolds all occurrences in the target of the main goal, using <strong>equational lemmas</strong> associated with the definitions.</p>
</blockquote>



<a name="197345763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197345763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197345763">(May 12 2020 at 22:02)</a>:</h4>
<p><span class="user-mention" data-user-id="300396">@Paul Rowe</span> you might want to try <code>#print prefix anno</code> just to find out all the things which Lean has created under the hood</p>



<a name="197346207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346207">(May 12 2020 at 22:06)</a>:</h4>
<p>Maybe I'm just being slow at the end of long day. What do I need to do to get the pair as an argument to further unfold?</p>



<a name="197346237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346237">(May 12 2020 at 22:06)</a>:</h4>
<p>Whatever is necessary to know that it is a pair</p>



<a name="197346252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346252">(May 12 2020 at 22:06)</a>:</h4>
<p>Like, what do you expect it to unfold to?</p>



<a name="197346290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346290">(May 12 2020 at 22:07)</a>:</h4>
<p>oh I see your example now</p>



<a name="197346324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346324">(May 12 2020 at 22:07)</a>:</h4>
<p>oh but I can't run it</p>



<a name="197346346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346346" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346346">(May 12 2020 at 22:07)</a>:</h4>
<p>Ah ok! I got it.</p>



<a name="197346476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346476">(May 12 2020 at 22:09)</a>:</h4>
<p>I used <code>cases (anno x_a_1 (i+1)) with a b</code> and that allowed me to further unfold the definition to produce the inductive hypothesis</p>



<a name="197346735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Paul Rowe <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346735">(May 12 2020 at 22:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Yeah, I'm trying to port another project over from Coq as a learning method, so there are just too many dependencies to create a working example out of the real code. Thanks, <span class="user-mention" data-user-id="110064">@Kenny Lau</span> for posting a more self-contained example! And thanks to everyone who chimed in! You saved from finishing my work day in a bad mood :)</p>



<a name="197346818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197346818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197346818">(May 12 2020 at 22:12)</a>:</h4>
<p>I'm glad what was at best a very vague answer of mine helped you <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="197347232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197347232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197347232">(May 12 2020 at 22:17)</a>:</h4>
<p>Not sure if this is the easiest proof, but this works:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">fib2</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span>     <span class="o">:=</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">:=</span> <span class="k">let</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">fib2</span> <span class="n">n</span> <span class="k">in</span> <span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span><span class="bp">+</span><span class="n">b</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">fib2</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span>

<span class="kn">theorem</span> <span class="n">fib_add_two</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="n">fib</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">fib2</span> <span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">fib</span> <span class="n">n</span><span class="o">,</span> <span class="n">fib</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)),</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">n</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">fib</span><span class="o">,</span> <span class="n">fib</span><span class="o">,</span> <span class="n">fib2</span><span class="o">],</span> <span class="n">cases</span> <span class="n">fib2</span> <span class="n">n</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">fib2</span><span class="o">]</span> <span class="o">},</span>
  <span class="k">have</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">this</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">fib2</span><span class="o">,</span> <span class="n">this</span><span class="o">,</span> <span class="n">fib2</span><span class="o">,</span> <span class="n">add_comm</span> <span class="o">(</span><span class="n">fib</span> <span class="n">n</span><span class="o">)]</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">injection</span> <span class="n">H</span> <span class="k">with</span> <span class="bp">_</span> <span class="n">H</span><span class="o">,</span> <span class="n">exact</span> <span class="n">H</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="197347303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/unfold%20and%20let/near/197347303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/unfold.20and.20let.html#197347303">(May 12 2020 at 22:17)</a>:</h4>
<p>the interesting step is <code>rw [fib2]</code> on the second line, which could also be <code>unfold fib2</code>, <code>simp [fib2]</code> or <code>refl</code></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>