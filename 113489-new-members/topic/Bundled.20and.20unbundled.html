---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Bundled.20and.20unbundled.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html">Bundled and unbundled</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="202411164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202411164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202411164">(Jun 30 2020 at 09:11)</a>:</h4>
<p>What exactly do "bundled" and "unbundled" mean in the context of lean? Is there a [Note: ...] or manual pages somewhere that summarizes how to choose between them when designing structure?</p>
<p>I've seen some posts here suggesting that <code>extends another_type_class</code> is a bundled type class and <code>[another_type_class]</code> is an unbundled one. I've seem some other discussions suggesting that <code>struct</code> is bundled and <code>class</code> is unbundled.</p>
<p>Is this a mathematics term that I'm unfamiliar with, or a lean concept?</p>



<a name="202411302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202411302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202411302">(Jun 30 2020 at 09:12)</a>:</h4>
<p>It's not maths. It's about the amount of things that you package into your structure vs keeping them as arguments.</p>



<a name="202411385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202411385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202411385">(Jun 30 2020 at 09:13)</a>:</h4>
<p>The version with more things in the structure is considered the bundled one?</p>



<a name="202413840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202413840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202413840">(Jun 30 2020 at 09:40)</a>:</h4>
<p>As for my second point then, is there anything in the lean / mathlib docs about how those choices are made internally? In particular, how there seem to be large swathes of deprecated "unbundled" code - it would be nice to learn and apply the same rationale elsewhere</p>



<a name="202414481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202414481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202414481">(Jun 30 2020 at 09:48)</a>:</h4>
<p>The <code>deprecated</code> directory primarily contains unbundled homs, which have been discussed on Zulip many times before</p>



<a name="202414560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202414560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202414560">(Jun 30 2020 at 09:48)</a>:</h4>
<p>We're trying to move away from <code>[is_group_hom (f : G -&gt; H)]</code> to <code>(f : G -&gt;* H)</code></p>



<a name="202414815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202414815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202414815">(Jun 30 2020 at 09:51)</a>:</h4>
<p>Is there anything I can read to understand the motivation? Perhaps some notable zulip threads?<br>
(I'm not saying I disagree with it, I just want to avoid making the same mistake in my own code)</p>



<a name="202414941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202414941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202414941">(Jun 30 2020 at 09:52)</a>:</h4>
<p>The plan has been around for so long (more than a year) that it's tricky finding a good reference</p>



<a name="202414942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202414942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202414942">(Jun 30 2020 at 09:52)</a>:</h4>
<p><a href="#narrow/stream/116395-maths/topic/How.20to.20handle.20transfer.20to.20bundled.20homs">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/How.20to.20handle.20transfer.20to.20bundled.20homs</a></p>



<a name="202414985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202414985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202414985">(Jun 30 2020 at 09:53)</a>:</h4>
<p>I feel like I gained some clarity on these things by reading <a href="https://dl.acm.org/doi/10.1145/3372885.3373824">the mathlib paper</a></p>



<a name="202415126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202415126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202415126">(Jun 30 2020 at 09:54)</a>:</h4>
<p><a href="#narrow/stream/116395-maths/topic/bundling.20mul_homs">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/bundling.20mul_homs</a></p>



<a name="202447725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202447725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202447725">(Jun 30 2020 at 15:01)</a>:</h4>
<p><a href="/user_uploads/3121/RVGrQrjtnR2Yzm3ckfl4chco/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/RVGrQrjtnR2Yzm3ckfl4chco/image.png" title="image.png"><img src="/user_uploads/3121/RVGrQrjtnR2Yzm3ckfl4chco/image.png"></a></div>



<a name="202447917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202447917" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202447917">(Jun 30 2020 at 15:02)</a>:</h4>
<blockquote>
<p>We primarily use semi-bundled definitions for type classes in mathlib, with all operations being bundled except for the carrier types.</p>
</blockquote>



<a name="202524366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202524366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202524366">(Jul 01 2020 at 02:21)</a>:</h4>
<p>When entering the bundled world, I wonder if we need to worry about <a href="#narrow/stream/113488-general/topic/old_structure_cmd/near/162644647">the old/new or nested/flat structure thing</a> at this stage? I felt reluctant to enter the bundled world ( and using inheritance ) because I read about these technical issues, and they don't look pretty or natural when reading the code in mathlib. And my goal was to make Lean code look like ordinary math as much as possible.</p>
<p>Also, I can't tell when to worry about <a href="https://leanprover-community.github.io/mathlib_docs/notes.html#lower%20instance%20priority">lower instance priority</a> either.</p>



<a name="202535548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202535548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202535548">(Jul 01 2020 at 06:40)</a>:</h4>
<p>The linter will tell you about instance priority issues. And you will have to make a decision about old/new structures, but it's one decision per structure. The general rule of thumb is to make everything an old structure. The changes were made because of a scaling issue which we don't really see in mathematical structures so a lot of mathlib still uses old structures</p>



<a name="202574272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202574272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Utensil Song <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202574272">(Jul 01 2020 at 14:20)</a>:</h4>
<p>It seems a whole lot of algebra stuff in mathlib is using the new structure (nested) and my code heavily relies on algebra part so I might stay new for now. And it frightens me that old structures struggle to extend new structures (<a href="#narrow/stream/116395-maths/topic/DVRs/near/200764626">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/DVRs/near/200764626</a>).</p>



<a name="202582277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202582277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202582277">(Jul 01 2020 at 15:22)</a>:</h4>
<p>Kinda related to this conversation - can a type class be fully unbundled (have no fields)?</p>



<a name="202582372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202582372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202582372">(Jul 01 2020 at 15:23)</a>:</h4>
<p>There are typeclasses which extend other classes and have no fields.</p>



<a name="202582546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202582546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202582546">(Jul 01 2020 at 15:24)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">comm_ring</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">ring</span> <span class="n">α</span><span class="o">,</span> <span class="n">comm_semigroup</span> <span class="n">α</span>
</code></pre></div>


<p>(that's it)</p>



<a name="202582583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202582583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202582583">(Jul 01 2020 at 15:25)</a>:</h4>
<p>Is <code>class comm_ring (α : Type u) [ring α] [comm_semigroup α]</code> legal?</p>



<a name="202582640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202582640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202582640">(Jul 01 2020 at 15:25)</a>:</h4>
<p>I should think so.</p>



<a name="202582864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202582864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202582864">(Jul 01 2020 at 15:27)</a>:</h4>
<p>But then if you wanted a commutative ring you'd have to write <code>[ring R] [comm_semigroup R] [comm_ring R]</code></p>



<a name="202583250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202583250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202583250">(Jul 01 2020 at 15:30)</a>:</h4>
<p>You've predicted exactly the trouble I was about to run into</p>



<a name="202583368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202583368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202583368">(Jul 01 2020 at 15:31)</a>:</h4>
<p>What's the rule for picking between <code>class comm_ring (α : Type u) extends ring α</code> and <code>class comm_ring (α : Type u) := (r : s ring α)</code>?</p>



<a name="202583475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202583475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202583475">(Jul 01 2020 at 15:32)</a>:</h4>
<p>This is a computer science question. I don't really understand these issues properly at all.</p>



<a name="202583506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202583506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202583506">(Jul 01 2020 at 15:32)</a>:</h4>
<p>Seems in my case that only the latter is legal, so lets try that approach</p>



<a name="202583673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202583673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202583673">(Jul 01 2020 at 15:34)</a>:</h4>
<p>Once you've actually got your use case compiling, you might want to run it past the people in <a class="stream" data-stream-id="116395" href="/#narrow/stream/116395-maths">#maths</a> to see what the experts think of it. (<a href="#narrow/stream/116395-maths/topic/local.20ring.20refactor/near/201959509">me doing this last week</a>)</p>



<a name="202584354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584354">(Jul 01 2020 at 15:40)</a>:</h4>
<p>Good idea, thanks</p>



<a name="202584439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584439">(Jul 01 2020 at 15:41)</a>:</h4>
<p>On the note of compiling... If there's one type class argument that lean is having trouble inferring, can I specify it explicitly without having to insert a tonne of placeholders to pad all the arguments that lean guesses correctly?</p>



<a name="202584539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584539" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584539">(Jul 01 2020 at 15:42)</a>:</h4>
<p>Not in Lean 3 as far as I know, but there's hope that the syntax for this will be better in Lean 4.</p>



<a name="202584564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584564">(Jul 01 2020 at 15:42)</a>:</h4>
<p>You only have to pad the ones to the left of the one that Lean had trouble inferring.</p>



<a name="202584613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584613">(Jul 01 2020 at 15:43)</a>:</h4>
<p>How do I deal with cases where lean wants a <code>ring R</code> but I have <code>comm_ring R</code>?</p>



<a name="202584615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584615">(Jul 01 2020 at 15:43)</a>:</h4>
<p>But there are other workarounds. For example <code>haveI</code> or <code>letI</code> in tactic mode.</p>



<a name="202584640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584640">(Jul 01 2020 at 15:43)</a>:</h4>
<p>If you have a comm_ring, Lean's type class inference system should have no trouble inferring the ring structure.</p>



<a name="202584654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584654">(Jul 01 2020 at 15:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">module</span> <span class="o">(</span><span class="n">A</span> <span class="mi">0</span><span class="o">)</span> <span class="n">G</span>
<span class="n">term</span>
  <span class="n">graded_algebra_components</span><span class="bp">.</span><span class="n">zc</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">comm_ring</span> <span class="o">(</span><span class="n">A</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">ring</span> <span class="o">(</span><span class="n">A</span> <span class="mi">0</span><span class="o">)</span>
</code></pre></div>



<a name="202584721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584721">(Jul 01 2020 at 15:44)</a>:</h4>
<p>I've had to pass the type class explicitly because I was attempting to bundle it</p>



<a name="202584737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584737">(Jul 01 2020 at 15:44)</a>:</h4>
<p>That's not what I interpreted your question as meaning</p>



<a name="202584758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584758">(Jul 01 2020 at 15:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">R</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
</code></pre></div>



<a name="202584890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584890">(Jul 01 2020 at 15:45)</a>:</h4>
<p>I'm taking about the first question in combination with the second one</p>



<a name="202584994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202584994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202584994">(Jul 01 2020 at 15:45)</a>:</h4>
<p>This is xy. You shouldn't be passing explicit proofs that something is a ring. The whole point of the type class inference system is to do this for you.</p>



<a name="202585186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585186">(Jul 01 2020 at 15:46)</a>:</h4>
<p>This is "what happens if I try what I asked in <a href="#narrow/stream/113489-new-members/topic/Bundled.20and.20unbundled/near/202583368">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/Bundled.20and.20unbundled/near/202583368</a>"</p>



<a name="202585187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585187">(Jul 01 2020 at 15:46)</a>:</h4>
<p>The answer to the question you asked is to run that example above but instead give it a name and then #print it so you know what the function which eats a comm_ring and spits out a ring is called.</p>



<a name="202585254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585254">(Jul 01 2020 at 15:46)</a>:</h4>
<p>But the real issue is that nobody should need to know the name of that function, so if you need to know it then there is something more fundamentally wrong</p>



<a name="202585303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585303">(Jul 01 2020 at 15:47)</a>:</h4>
<p>Type class inference will fill in that field, and if it doesn't, then don't fill it in manually, but instead figure out why it didn't, and fix the actual problem</p>



<a name="202585491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585491">(Jul 01 2020 at 15:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Bundled.20and.20unbundled/near/202585186">said</a>:</p>
<blockquote>
<p>This is "what happens if I try what I asked in <a href="#narrow/stream/113489-new-members/topic/Bundled.20and.20unbundled/near/202583368">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/topic/Bundled.20and.20unbundled/near/202583368</a>"</p>
</blockquote>
<p>There is a typo in what you posted (a random s) but assuming it's not supposed to be there then instead of the round brackets you should make them square brackets, and you might have to manually tag the structure projection with <code>@[instance]</code></p>



<a name="202585537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585537">(Jul 01 2020 at 15:49)</a>:</h4>
<p>What I'm saying is that the infrastructure is there, I believe, to make the set-up work.</p>



<a name="202585762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585762">(Jul 01 2020 at 15:51)</a>:</h4>
<p>The full repro is:</p>
<div class="codehilite"><pre><span></span><code><span class="n">class</span> <span class="n">graded_algebra_components</span>
  <span class="c1">-- a type for each grade.</span>
  <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="o">:=</span>
  <span class="c1">-- (A 0) is the scalar type</span>
  <span class="o">[</span><span class="n">zc</span><span class="o">:</span> <span class="n">comm_ring</span> <span class="o">(</span><span class="n">A</span> <span class="mi">0</span><span class="o">)]</span>

  <span class="c1">-- all the types form commutative vector spaces</span>
  <span class="o">[</span><span class="n">b</span><span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">add_comm_group</span> <span class="o">(</span><span class="n">A</span> <span class="n">n</span><span class="o">)]</span>
  <span class="o">[</span><span class="n">c</span><span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">module</span> <span class="o">(</span><span class="n">A</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="n">n</span><span class="o">)]</span>


<span class="n">class</span> <span class="n">graded_algebra_hom</span>
  <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
  <span class="o">[</span><span class="n">g</span> <span class="o">:</span> <span class="n">graded_algebra_components</span> <span class="n">A</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">G</span><span class="o">]</span>
  <span class="o">[</span><span class="bp">@</span><span class="n">module</span> <span class="o">(</span><span class="n">A</span> <span class="mi">0</span><span class="o">)</span> <span class="n">G</span> <span class="k">begin</span> <span class="n">haveI</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">g</span><span class="bp">.</span><span class="n">zc</span><span class="o">,</span> <span class="n">apply_instance</span> <span class="kn">end</span> <span class="bp">_</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="bp">∀</span><span class="n">n</span><span class="o">,</span> <span class="n">A</span> <span class="n">n</span> <span class="bp">→</span><span class="err">ₗ</span><span class="o">[</span><span class="n">A</span> <span class="mi">0</span><span class="o">]</span> <span class="n">G</span><span class="o">)</span>
</code></pre></div>


<p>Your <code>apply_instance</code> and <code>haveI</code> tip was enough to get it to compile, thanks</p>



<a name="202585791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585791">(Jul 01 2020 at 15:51)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">universe</span> <span class="n">u</span>

<span class="n">class</span> <span class="n">comm_ring&#39;</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">[</span><span class="n">r</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">α</span><span class="o">]</span>

<span class="bp">#</span><span class="kn">print</span> <span class="kn">prefix</span> <span class="n">comm_ring&#39;</span>

<span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">comm_ring&#39;</span><span class="bp">.</span><span class="n">r</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring&#39;</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">R</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- works</span>
</code></pre></div>



<a name="202585847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585847">(Jul 01 2020 at 15:52)</a>:</h4>
<p>Oh nice</p>



<a name="202585852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585852">(Jul 01 2020 at 15:52)</a>:</h4>
<p>Thanks!</p>



<a name="202585933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585933">(Jul 01 2020 at 15:52)</a>:</h4>
<p>Is there an inline syntax for that?</p>



<a name="202585969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202585969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202585969">(Jul 01 2020 at 15:53)</a>:</h4>
<p>That solves my problem perfectly</p>



<a name="202586742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202586742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202586742">(Jul 01 2020 at 15:57)</a>:</h4>
<p>I don't know an inline syntax -- you mean making <code>zc</code> (and b and c) an instance whilst defining <code>graded_algebra_components</code>? I don't know.</p>



<a name="202586768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Bundled%20and%20unbundled/near/202586768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Bundled.20and.20unbundled.html#202586768">(Jul 01 2020 at 15:57)</a>:</h4>
<p>Yeah, some kind of <code>@[instance]</code> marker</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>