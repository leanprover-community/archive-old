---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html">How to get familiar enough with Mathlib to use it</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198667302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198667302" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keefer Rowan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198667302">(May 25 2020 at 13:13)</a>:</h4>
<p>I have been learning Lean for a few weeks now; I started with the natural numbers game, then Theorem Proving in Lean, and have since written around 3000 lines of Lean formalizing basic topological facts and the necessary set theory/function theory/logic for them. But I really failed to use libraries for this (failing even to use Lean's core library); if I needed a basic logic fact for a <code>rw</code>, I just proved it. Similarly for sets, functions, etc. After spending about 1000 lines giving a definition of finite (bijection with <code>{0,1,...,n}</code>) and showing the subsets of finite sets are finite and union of finite is finite, I thought I might want to start using facts from libraries and going about more doing "proper math". So I saw that no one has formalized basic facts about Hilbert spaces, and I thought I try my hand at that. But then I realized I'd need a working knowledge of (parts of) the libraries on real and complex numbers, metric space topology, linear algebra, normed spaces, etc. This seems totally impossible to get, so I would appreciate any advice on how to start familiarizing myself with the libraries enough to start building on them.</p>



<a name="198667531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198667531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198667531">(May 25 2020 at 13:15)</a>:</h4>
<p>We currently don't have a better answering than reading the <a href="https://leanprover-community.github.io/mathlib_docs">#docs</a> . There are projects to improve on this, but time is scarce.</p>



<a name="198667605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198667605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198667605">(May 25 2020 at 13:16)</a>:</h4>
<p>But see also <a href="https://leanprover-community.github.io/mathlib-overview.html">https://leanprover-community.github.io/mathlib-overview.html</a></p>



<a name="198668033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198668033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198668033">(May 25 2020 at 13:21)</a>:</h4>
<p>I'm pretty sure that when I started formalising undergraduate level mathematics I had no working knowledge of the libraries, and proved a bunch of things myself. The point which I had not understood back then, and do understand now, is the "library philosophy". Is this obscure result in the library? No. Can its proof be broken up into a small number of simple steps, each of which is natural? Yes. Are each of the simple steps in the library? Probably, and I can look for them by abstracting what I'm after and trying <code>library_search</code>, or just reading the library files and getting a feel for the kind of theorems which are proved. </p>
<p>I found finding my own proofs a lot of fun, even crappy proofs which were inefficient, because I would get a buzz and some confidence out of finding my own proof of something. But if you want to do Hilbert spaces then you should just start, and think clearly, and expect that standard natural results are already proved. I formalised basic 1st year undergrad stuff for 3000 lines like you, and then I started on schemes despite the fact that I was woefully underprepared in some sense, and I asked a lot of questions here, and we got there in the end. People will help you if you are asking questions about Hilbert spaces, there are plenty of people here that would love to see Hilbert spaces in mathlib and these people are going to be happy to help.</p>



<a name="198668433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198668433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198668433">(May 25 2020 at 13:24)</a>:</h4>
<p>It still feels pretty pointless to start on Hilbert spaces without having a look at <a href="https://leanprover-community.github.io/mathlib_docs/linear_algebra/sesquilinear_form.html">https://leanprover-community.github.io/mathlib_docs/linear_algebra/sesquilinear_form.html</a> and <a href="https://leanprover-community.github.io/mathlib_docs/analysis/normed_space/banach.html">https://leanprover-community.github.io/mathlib_docs/analysis/normed_space/banach.html</a></p>



<a name="198668833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198668833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198668833">(May 25 2020 at 13:28)</a>:</h4>
<p>And, as soon as definitions are there, also look at <a href="https://leanprover-community.github.io/mathlib_docs/analysis/normed_space/complemented.html">https://leanprover-community.github.io/mathlib_docs/analysis/normed_space/complemented.html</a> and <a href="https://leanprover-community.github.io/mathlib_docs/analysis/convex/basic.html">https://leanprover-community.github.io/mathlib_docs/analysis/convex/basic.html</a> (working towards projection lemmas)</p>



<a name="198669191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198669191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198669191">(May 25 2020 at 13:32)</a>:</h4>
<blockquote>
<p>But then I realized I'd need a working knowledge of (parts of) the libraries on real and complex numbers, metric space topology, linear algebra, normed spaces, etc. This seems totally impossible to get</p>
</blockquote>
<p>This isn't totally impossible to get at all. The library files are not scary. Skip the definitions because you know what they are supposed to say -- instead, read the docstrings. Skip the proofs because you can look them up in a book; they are not written to be human-readable anyway. Look at the theorem statements. Make sure you understand them -- they are what you will need. Learn the various ways of searching for them (e.g. the ctrl-space trick, learning naming conventions, <code>library_search</code>). Don't be scared by the library files. If you find one without a docstring and you really can't get your head around it, mention it here and someone might write one. Start where Patrick suggests. Mathlib is not scary -- people who think it's scary are just reading it wrong.</p>



<a name="198669372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198669372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Keefer Rowan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198669372">(May 25 2020 at 13:34)</a>:</h4>
<p>I'll start working on it.</p>



<a name="198686862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198686862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198686862">(May 25 2020 at 16:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it/near/198669191">said</a>:</p>
<blockquote>
<blockquote>
<p>But then I realized I'd need a working knowledge of (parts of) the libraries on real and complex numbers, metric space topology, linear algebra, normed spaces, etc. This seems totally impossible to get</p>
</blockquote>
<p>This isn't totally impossible to get at all. The library files are not scary. Skip the definitions because you know what they are supposed to say -- instead, read the docstrings. Skip the proofs because you can look them up in a book; they are not written to be human-readable anyway. Look at the theorem statements. Make sure you understand them -- they are what you will need. Learn the various ways of searching for them (e.g. the ctrl-space trick, learning naming conventions, <code>library_search</code>). Don't be scared by the library files. If you find one without a docstring and you really can't get your head around it, mention it here and someone might write one. Start where Patrick suggests. Mathlib is not scary -- people who think it's scary are just reading it wrong.</p>
</blockquote>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> should this become a blogpost “How to learn the library”?</p>



<a name="198686884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198686884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198686884">(May 25 2020 at 16:54)</a>:</h4>
<p>Perhaps when I've finished my marking :-) But I'll definitely consider it! I had no idea what was going on when I first tried to read the library.</p>



<a name="198688497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198688497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198688497">(May 25 2020 at 17:20)</a>:</h4>
<p>I also hope that the new mathlib overview will be helpful when it will exist.</p>



<a name="198721572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198721572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> ROCKY KAMEN-RUBIO <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198721572">(May 26 2020 at 05:21)</a>:</h4>
<p>“Suggest” and “library_search” have been very useful to me. Sometimes they work better if you open a new goal state for the specific theorem you want.</p>



<a name="198745507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198745507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Filippo A. E. Nuccio <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198745507">(May 26 2020 at 10:54)</a>:</h4>
<p>I had the same feeling yesterday, when had to prove (to complete Kevin's homework) that the norm of a complex number is non-negative. I realised that someone must have proved that the square of a real is always non-negative, but after much time spent around I ended up with a trick (and I copy-paste here in case someone is willing to give me an opinion on how poor it is..):<br>
<code>lemma norm_sq_nonneg (z : ℂ) : 0 ≤ norm_sq z := 
begin rw norm_sq,
have h: ∀ a : ℝ, 0 ≤ a*a ,
    intro,
    cases le_total 0 a with posa nega,
    apply mul_nonneg posa posa,
    apply mul_nonneg_of_nonpos_of_nonpos nega nega,
    apply add_nonneg,
all_goals {apply h},
end</code></p>
<p>So I also believe that a tutorial on how to properly search and browse the library would be great!</p>
<p>Added: I have eventually realized that in his solutions, Kevin complains that CS told him that "reals were almost entirely developed" but that he quite disagrees...</p>



<a name="198746479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198746479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198746479">(May 26 2020 at 11:04)</a>:</h4>
<p>For what it's worth, this lemma is included as <code>mul_self_nonneg : ∀ a, a * a ≥ 0</code> in <code>algebra/ordered_ring.lean</code>, but <code>library_search</code> or <code>suggest</code> don't seem to find it...</p>



<a name="198747067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198747067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198747067">(May 26 2020 at 11:10)</a>:</h4>
<p>As I suspected, it's fixed when we switch the <code>≥</code> in the type of <code>mul_self_nonneg</code> to <code>≤</code>. Let me make a PR...</p>



<a name="198747715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198747715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198747715">(May 26 2020 at 11:19)</a>:</h4>
<p>You don't even have to PR core, and wait for a new version of Lean... [/self-indulgence]</p>



<a name="198748312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198748312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198748312">(May 26 2020 at 11:27)</a>:</h4>
<p>Hmm, I don't see why that would matter to <code>library_search</code>--isn't it perfectly happy to give correct but conceptually nonsensical proofs that rely on unfolding semireducible things?</p>



<a name="198749876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198749876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198749876">(May 26 2020 at 11:45)</a>:</h4>
<p>I believe the problem arises because <code>library_search</code> only unfolds the goal, not all the lemmas in scope. So to solve a goal <code>a * a ≥ 0</code>, it unfolds it to <code>0 ≤ a * a</code> and looks for lemmas that return something with <code>≤</code>. The head symbol for this lemma is <code>≥</code> which doesn't get unfolded further and we get a mismatch.</p>



<a name="198749951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198749951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198749951">(May 26 2020 at 11:46)</a>:</h4>
<p>This is tricky, unfolding more stuff could make library_search slower</p>



<a name="198750152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198750152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198750152">(May 26 2020 at 11:49)</a>:</h4>
<p>Ah, it's a bit more nuanced. It's because the function <code>head_symbol</code>, used to compute the head symbol of the goal, contains a special case to map <code>&gt;</code> to <code>&lt;</code> and <code>≥</code> to <code>≤</code>, while <code>match_head_symbol</code>, used to find the lemmas with this head symbol, doesn't perform this mapping</p>



<a name="198750458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198750458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198750458">(May 26 2020 at 11:52)</a>:</h4>
<p>Oh, I didn't realize it used any kind of symbol matching, I thought it just tried to <code>apply</code> everything</p>



<a name="198753081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198753081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198753081">(May 26 2020 at 12:16)</a>:</h4>
<p>It's pretty lame: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/suggest.lean#L61">https://github.com/leanprover-community/mathlib/blob/master/src/tactic/suggest.lean#L61</a></p>



<a name="198753285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198753285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198753285">(May 26 2020 at 12:19)</a>:</h4>
<p>How about using one function <code>normalize_synonym</code> that we apply to the goal and to the lemmas? I believe it's sufficient to map <code>&gt;</code> to <code>&lt;</code>, <code>≥</code> to <code>≤</code> and <code>not</code> to <code>false</code> to preserve the current behaviour</p>



<a name="198753473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198753473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198753473">(May 26 2020 at 12:21)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">meta</span> <span class="n">def</span> <span class="n">normalize_synonym</span> <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">name</span>
<span class="bp">|</span> <span class="bp">`</span><span class="n">gt</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">has_lt</span><span class="bp">.</span><span class="n">lt</span>
<span class="bp">|</span> <span class="bp">`</span><span class="n">ge</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span>
<span class="bp">|</span> <span class="bp">`</span><span class="n">not</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">false</span>
<span class="bp">|</span> <span class="n">n</span>   <span class="o">:=</span> <span class="n">n</span>

<span class="c">/-</span><span class="cm">- compute the head symbol of an expression, but normalise synonyms -/</span>
<span class="c1">-- We may want to tweak this further?</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">head_symbol</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">name</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">t</span><span class="o">)</span> <span class="o">:=</span> <span class="n">head_symbol</span> <span class="n">t</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="n">f</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">head_symbol</span> <span class="n">f</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">n</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">normalize_synonym</span> <span class="n">n</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="bp">`_</span>

<span class="c1">-- snip --</span>

<span class="c">/-</span><span class="cm">- Determine if, and in which way, a given expression matches the specified head symbol. -/</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">match_head_symbol</span> <span class="o">(</span><span class="n">hs</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">option</span> <span class="n">head_symbol_match</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">t</span><span class="o">)</span> <span class="o">:=</span> <span class="n">match_head_symbol</span> <span class="n">t</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">a</span> <span class="bp">↔</span> <span class="err">%%</span><span class="n">b</span><span class="o">)</span>      <span class="o">:=</span> <span class="k">if</span> <span class="bp">`</span><span class="n">iff</span> <span class="bp">=</span> <span class="n">hs</span> <span class="k">then</span> <span class="n">some</span> <span class="n">ex</span> <span class="k">else</span>
                       <span class="k">match</span> <span class="o">(</span><span class="n">match_head_symbol</span> <span class="n">a</span><span class="o">,</span> <span class="n">match_head_symbol</span> <span class="n">b</span><span class="o">)</span> <span class="k">with</span>
                       <span class="bp">|</span> <span class="o">(</span><span class="n">some</span> <span class="n">ex</span><span class="o">,</span> <span class="n">some</span> <span class="n">ex</span><span class="o">)</span> <span class="o">:=</span>
                           <span class="n">some</span> <span class="n">both</span>
                       <span class="bp">|</span> <span class="o">(</span><span class="n">some</span> <span class="n">ex</span><span class="o">,</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">mpr</span>
                       <span class="bp">|</span> <span class="o">(</span><span class="bp">_</span><span class="o">,</span> <span class="n">some</span> <span class="n">ex</span><span class="o">)</span> <span class="o">:=</span> <span class="n">some</span> <span class="n">mp</span>
                       <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">none</span>
                       <span class="kn">end</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="n">f</span> <span class="bp">_</span><span class="o">)</span>    <span class="o">:=</span> <span class="n">match_head_symbol</span> <span class="n">f</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">n</span> <span class="bp">_</span><span class="o">)</span>  <span class="o">:=</span> <span class="k">if</span> <span class="n">hs</span> <span class="bp">=</span> <span class="n">normalize_synonym</span> <span class="n">n</span> <span class="k">then</span> <span class="n">some</span> <span class="n">ex</span> <span class="k">else</span> <span class="n">none</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">hs</span> <span class="bp">=</span> <span class="bp">`_</span> <span class="k">then</span> <span class="n">some</span> <span class="n">ex</span> <span class="k">else</span> <span class="n">none</span>
</code></pre></div>



<a name="198761307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198761307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198761307">(May 26 2020 at 13:28)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span>, did you try this out (e.g. run the tests file)? I'm certainly game to change this.</p>



<a name="198762069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198762069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198762069">(May 26 2020 at 13:34)</a>:</h4>
<p>I just finished testing it, and I'm happy enough with the results. I didn't notice any changes in running time, but I haven't checked whether there are any benchmarks. Apart from <code>&gt;</code> versus <code>&lt;</code>, the change also improves on <code>¬</code> versus <code>false</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">lemma_with_false_in_head</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">P</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">silence_library_search</span> <span class="n">false</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">P</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">library_search</span>
<span class="c1">-- Try this: `exact lemma_with_false_in_head a b h1 h2`</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span> <span class="o">(</span><span class="n">P</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">library_search</span>
<span class="c1">-- Try this: `exact lemma_with_false_in_head a b h1`</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span> <span class="o">(</span><span class="n">P</span> <span class="n">a</span><span class="o">)</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">library_search</span>
<span class="c1">-- Try this: `exact lemma_with_false_in_head a b h1`</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">P</span> <span class="n">a</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span> <span class="o">(</span><span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">library_search</span>
<span class="c1">-- fails - do we want this to work too?</span>
</code></pre></div>



<a name="198764371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/How%20to%20get%20familiar%20enough%20with%20Mathlib%20to%20use%20it/near/198764371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/How.20to.20get.20familiar.20enough.20with.20Mathlib.20to.20use.20it.html#198764371">(May 26 2020 at 13:52)</a>:</h4>
<p>I've made a PR out of the changes: <a href="https://github.com/leanprover-community/mathlib/pull/2829">https://github.com/leanprover-community/mathlib/pull/2829</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>