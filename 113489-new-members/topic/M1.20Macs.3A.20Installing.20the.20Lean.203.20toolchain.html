---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html">M1 Macs: Installing the Lean 3 toolchain</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="254299189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/254299189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trevor Fancher <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#254299189">(Sep 22 2021 at 00:39)</a>:</h4>
<h1>Installing Lean on an M1 based Mac</h1>
<h2>Changelog</h2>
<ul>
<li>21 September 2021 - First version. Known to work on my M1 MacBook Air running Big Sur (macOS 11.6 build 20G165)</li>
</ul>
<h2>Install <code>brew</code> and <code>leanproject</code></h2>
<p>Install <a href="https://brew.sh/">Homebrew</a> by running the following command in in <a href="http://Terminal.app">Terminal.app</a> (found in the <code>/Applications/Utilities/</code> folder)</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>/bin/bash -c <span class="s2">"</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="k">)</span><span class="s2">"</span>
</code></pre></div>
<p>Now run the following command to install <a href="https://leanprover-community.github.io/leanproject.html">leanproject</a>. This may take a few minutes because the <code>mathlibtools</code> packages has many dependecies that <code>brew</code> will automatically install.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>brew update
brew install mathlibtools
</code></pre></div>
<h3>Install <code>elan</code> from source</h3>
<p>Do not install <code>elan</code> from <code>brew</code>. It won't work. Instead, we must build it from source. Start by installing some dependencies</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>brew install git
brew install gmp
brew install coreutils
brew install rust
</code></pre></div>
<p>Now we need to get the sources. I put most things like this in my <code>~/repos</code> folder, but feel free to put the sources where you want. (Note that <code>v1.0.8</code> is the newest release of <code>elan</code>, but it fails with the following error message, so <code>v1.0.7</code> it is for now)</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>elan v1.0.8 error message</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>error: failed to run custom build command for <code>elan-dist v1.11.0 (/Users/trevor/repos/elan/src/elan-dist)</code></p>
<p>Caused by:<br>
  process didn't exit successfully: <code>/Users/trevor/repos/elan/target/debug/build/elan-dist-cf4fa37c4a1b6d17/build-script-build</code> (exit status: 101)<br>
  --- stderr<br>
  thread 'main' panicked at 'called <code>Result::unwrap()</code> on an <code>Err</code> value: NotPresent', src/elan-dist/build.rs:8:50<br>
  note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace</p>
</div></div>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>mkdir -p ~/repos/
<span class="nb">cd</span> ~/repos
git clone https://github.com/leanprover/elan.git
git checkout v1.0.7
<span class="nb">cd</span> elan
</code></pre></div>
<p>Now we need to build and install <code>elan</code>. The <code>cargo</code> command comes from installing <code>rust</code> above. It builds and pulls in the dependencies for <code>elan</code>.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cargo build
cargo install
<span class="nb">cd</span> target/release/
./elan-init
</code></pre></div>
<p>You'll probably just want to "Proceed with installation (default)" by pressing 1 then the return key. Now run</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">source</span> <span class="nv">$HOME</span>/.elan/env
</code></pre></div>
<p>so that your current Terminal session can find <code>elan</code>. This won't be neccesary in any newly open Terminal sessions.</p>
<h2>Replace the Lean binaries</h2>
<p>If you type <code>lean</code> in your Terminal you will get an error. While most apps work fine under Apple's emulation layer, for some reason <code>lean</code> and/or <code>brew</code> work together to confuse the emulation. So what we are going to do is build <code>lean</code> and its related commands from source and replace those files in the folder where <code>elan</code> stores its various binaries. Here we go:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">cd</span> ~/repos/
git clone https://github.com/leanprover-community/lean.git
<span class="nb">cd</span> lean
cat ~/.elan/update-hashes/stable
</code></pre></div>
<p>You should see something like <code>https://github.com/leanprover-community/lean/releases/tag/v3.33.0</code> printed out now. Take the last part after the <code>/tag/</code> (here it is <code>v3.33.0</code>) and run</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>git checkout v3.33.0
mkdir -p build/release
<span class="nb">cd</span> build/release
brew install cmake
cmake ../../src
make
</code></pre></div>
<p>This takes only 6 minutes with your new fancy M1 chip. Now we copy the built files where <code>elan</code> can find them. Note, you may have to type <code>y</code> to confirm deleting the Lean files.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">cd</span> ../../
rm ~/.elan/toolchains/stable/bin/lean
rm ~/.elan/toolchains/stable/bin/leanchecker
rm ~/.elan/toolchains/stable/bin/leanpkg
cp bin/lean ~/.elan/toolchains/stable/bin
cp bin/leanpkg ~/.elan/toolchains/stable/bin
cp build/release/checker/leanchecker ~/.elan/toolchains/stable/bin
</code></pre></div>
<p>You should be able to run</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>lean -v
leanchcker -v
leanpkg -v
</code></pre></div>
<p>to verify everything is running correctly. Congratulations, you have <code>lean</code> installed now.</p>
<h2>Install VSCode</h2>
<p>You may want to run</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>brew install --cask visual-studio-code
code --install-extension jroesch.lean
</code></pre></div>
<p>to get VSCode and the Lean extension installed.</p>
<h2>Install other Lean version</h2>
<p>Lets say you run</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>mkdir -p ~/projects/
<span class="nb">cd</span> ~/projects/
leanproject get ImperialCollegeLondon/formalising-mathematics
</code></pre></div>
<p>so that you can install the wonderful <a href="https://github.com/ImperialCollegeLondon/formalising-mathematics">Formalising Mathematics</a> workshop files. When doing this you'll get the error</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>dyld: Library not loaded: /usr/local/opt/gmp/lib/libgmp.10.dylib
  Referenced from: /Users/trevor/.elan/toolchains/leanprover-community--lean---3.24.0/bin/lean
  Reason: image not found
Command '['leanpkg', 'configure']' died with &lt;Signals.SIGABRT: 6&gt;.
</code></pre></div>
<p>because this Lean project requires a different version of Lean that we installed before. To fix this, we may do the following (note the <code>leanprover-community--lean---3.24.0</code> part from the error message)</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>cat ~/.elan/update-hashes/leanprover-community--lean---3.24.0
</code></pre></div>
<p>which, unsurprisingly, tells us that the correct <code>git</code> tag is <code>v3.24.0</code> for this version of Lean. So now we run</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">cd</span> ~/repos/lean
git checkout v3.24.0
mkdir -p build/release
<span class="nb">cd</span> build/release
brew install cmake
cmake ../../src
make
</code></pre></div>
<p>and wait about 6 more minutes for Lean to build. Then we run </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">cd</span> ../../
rm ~/.elan/toolchains/leanprover-community--lean---3.24.0/bin/lean
rm ~/.elan/toolchains/leanprover-community--lean---3.24.0/bin/leanchecker
rm ~/.elan/toolchains/leanprover-community--lean---3.24.0/bin/leanpkg
cp bin/lean ~/.elan/toolchains/leanprover-community--lean---3.24.0/bin
cp bin/leanpkg ~/.elan/toolchains/leanprover-community--lean---3.24.0/bin
cp build/release/checker/leanchecker ~/.elan/toolchains/leanprover-community--lean---3.24.0/bin
</code></pre></div>
<p>and now we have Lean 3.24.0 installed as well. I recommend first deleting the failed <code>formalising-mathematics</code> folder from before before continuing. So something like</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="nb">cd</span> ~/projects/
rm -rf formalising-mathematics
leanproject get ImperialCollegeLondon/formalising-mathematics
code formalising-mathematics
</code></pre></div>
<p>and you should be up and running.</p>



<a name="259720762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259720762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chiu Tim <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259720762">(Oct 30 2021 at 09:30)</a>:</h4>
<p>When deleting the Lean files here, I get the error message No such file or directory</p>
<p>lean % cd ../../<br>
rm ~/.elan/toolchains/stable/bin/lean<br>
rm ~/.elan/toolchains/stable/bin/leanchecker<br>
rm ~/.elan/toolchains/stable/bin/leanpkg<br>
cp bin/lean ~/.elan/toolchains/stable/bin<br>
cp bin/leanpkg ~/.elan/toolchains/stable/bin<br>
cp build/release/checker/leanchecker ~/.elan/toolchains/stable/bin<br>
override r-xr-xr-x  timchiu/staff for /Users/timchiu/.elan/toolchains/stable/bin/lean? y<br>
override r-xr-xr-x  timchiu/staff for /Users/timchiu/.elan/toolchains/stable/bin/leanchecker? y<br>
override r-xr-xr-x  timchiu/staff for /Users/timchiu/.elan/toolchains/stable/bin/leanpkg? y<br>
cp: bin/lean: No such file or directory<br>
cp: bin/leanpkg: No such file or directory<br>
cp: build/release/checker/leanchecker: No such file or directory</p>
<p>Any help would be appreciated</p>



<a name="259720776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259720776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259720776">(Oct 30 2021 at 09:31)</a>:</h4>
<p>don't delete the Lean files?</p>



<a name="259721179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259721179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259721179">(Oct 30 2021 at 09:40)</a>:</h4>
<p>Kevin is saying: we don't know what you're doing, or why. Please give us some context.</p>



<a name="259721238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259721238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259721238">(Oct 30 2021 at 09:42)</a>:</h4>
<p>I can tell you what the errors mean -- <code>cp bin/lean ~/.elan/toolchains/stable/bin</code> means "make a copy of the file <code>bin/lean</code> some place or other" and the error <code>cp: bin/lean: No such file or directory</code> means "...but there is no file <code>bin/lean</code> so I can't do this"</p>



<a name="259721319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259721319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259721319">(Oct 30 2021 at 09:44)</a>:</h4>
<p>aah got it -- you're cutting and pasting some code from the post above! Perhaps my last message is helpful then. You need your working directory to be in a place where there's a directory called <code>bin</code> with a file called <code>lean</code> in it.</p>



<a name="259721412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259721412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259721412">(Oct 30 2021 at 09:47)</a>:</h4>
<p>You might want to post the output of <code>pwd</code> and <code>ls -al</code>, maybe all that's happening is that things are fine but you're in the wrong directory for some reason.</p>



<a name="259721619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259721619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chiu Tim <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259721619">(Oct 30 2021 at 09:52)</a>:</h4>
<p>timchiu@192 lean % pwd<br>
/Users/timchiu/repos/lean<br>
timchiu@192 lean % ls -al<br>
total 72<br>
drwxr-xr-x  22 timchiu  staff   704 30 Oct 10:17 .<br>
drwxr-xr-x   4 timchiu  staff   128 30 Oct 10:15 ..<br>
-rw-r--r--   1 timchiu  staff    49 30 Oct 10:15 .clang-format<br>
-rw-r--r--   1 timchiu  staff   153 30 Oct 10:15 .codecov.yml<br>
drwxr-xr-x  12 timchiu  staff   384 30 Oct 10:47 .git<br>
-rw-r--r--   1 timchiu  staff    27 30 Oct 10:15 .gitattributes<br>
drwxr-xr-x   5 timchiu  staff   160 30 Oct 10:15 .github<br>
-rw-r--r--   1 timchiu  staff   315 30 Oct 10:15 .gitignore<br>
-rw-r--r--   1 timchiu  staff  9160 30 Oct 10:15 LICENSE<br>
-rw-r--r--   1 timchiu  staff  3322 30 Oct 10:15 README.md<br>
drwxr-xr-x   7 timchiu  staff   224 30 Oct 10:21 bin<br>
-rw-r--r--   1 timchiu  staff   308 30 Oct 10:15 bors.toml<br>
drwxr-xr-x   3 timchiu  staff    96 30 Oct 10:17 build<br>
drwxr-xr-x  14 timchiu  staff   448 30 Oct 10:15 doc<br>
drwxr-xr-x   3 timchiu  staff    96 30 Oct 10:15 extras<br>
drwxr-xr-x   4 timchiu  staff   128 30 Oct 10:15 images<br>
drwxr-xr-x   7 timchiu  staff   224 30 Oct 10:15 leanpkg<br>
drwxr-xr-x   9 timchiu  staff   288 30 Oct 10:15 library<br>
drwxr-xr-x  28 timchiu  staff   896 30 Oct 10:15 script<br>
drwxr-xr-x  19 timchiu  staff   608 30 Oct 10:15 src<br>
drwxr-xr-x   4 timchiu  staff   128 30 Oct 10:15 tests<br>
drwxr-xr-x  12 timchiu  staff   384 30 Oct 10:15 tmp</p>



<a name="259721655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259721655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chiu Tim <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259721655">(Oct 30 2021 at 09:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/259721319">said</a>:</p>
<blockquote>
<p>aah got it -- you're cutting and pasting some code from the post above! Perhaps my last message is helpful then. You need your working directory to be in a place where there's a directory called <code>bin</code> with a file called <code>lean</code> in it.</p>
</blockquote>
<p>Yes, I am just copying code and I have no idea what any this means <span aria-label="joy" class="emoji emoji-1f602" role="img" title="joy">:joy:</span></p>



<a name="259728922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259728922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259728922">(Oct 30 2021 at 12:42)</a>:</h4>
<p>When you get this working, since I assume you are on a new M1 pro/max chip, I’d love to hear how long that <code>make</code> step above took.</p>



<a name="259746902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259746902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Chiu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259746902">(Oct 30 2021 at 19:21)</a>:</h4>
<p>Yes I'm on the M1 pro, it took 5 minutes and 20 seconds</p>



<a name="259756122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259756122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259756122">(Oct 30 2021 at 22:53)</a>:</h4>
<p>So it looks like you have a bin directory. What does <code>ls -l bin/</code> return?</p>



<a name="259882558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259882558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Chiu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259882558">(Nov 01 2021 at 16:04)</a>:</h4>
<p>No such file or directory</p>



<a name="259882602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259882602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259882602">(Nov 01 2021 at 16:04)</a>:</h4>
<p>yeah but before you had a bin directory</p>



<a name="259882662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259882662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259882662">(Nov 01 2021 at 16:05)</a>:</h4>
<p>do you know about the command line? Sorry if I'm telling you things you already know</p>



<a name="259882769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259882769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259882769">(Nov 01 2021 at 16:06)</a>:</h4>
<p>You can navigate around through directories etc on a mac using a file explorer. I think the mac one is called "finder"? At any point the explorer is "in" a given directory, and you can go into subdirectories and back up out of them etc</p>



<a name="259883011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259883011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259883011">(Nov 01 2021 at 16:07)</a>:</h4>
<p>The command line is just the same. You typed a command <code>cp bin/lean ~/.elan/toolchains/stable/bin</code>, which means "copy a file into a directory", and it didn't work, the error was <code>cp: bin/lean: No such file or directory</code>. Either that file is somewhere on your system and we can try to find it, or the file is not on your system and something went wrong earlier.</p>



<a name="259883122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259883122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259883122">(Nov 01 2021 at 16:08)</a>:</h4>
<p>The thing about <code>bin/lean</code> is that it is a <em>relative</em> path. It means "start where we are now, then go into the <code>bin</code> directory and get the file called <code>lean</code> in that directory".</p>



<a name="259883181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259883181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259883181">(Nov 01 2021 at 16:08)</a>:</h4>
<p>So for example if you close your terminal and then open it again, you're screwed, because when you open a new terminal it won't be pointing to the directory which your old terminal was in.</p>



<a name="259883234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259883234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259883234">(Nov 01 2021 at 16:09)</a>:</h4>
<p>This is why it's funny that you're telling me the error 2 days after our last conversation, because on my computer most terminals don't last two days</p>



<a name="259883376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259883376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259883376">(Nov 01 2021 at 16:10)</a>:</h4>
<p>If you open a new terminal, and type <code>cd /Users/timchiu/repos/lean</code> and then <code>cd bin</code> and then <code>ls</code>, what happens?</p>



<a name="259990342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259990342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Chiu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259990342">(Nov 02 2021 at 12:50)</a>:</h4>
<p>Right!  I got :<br>
lean        lean-gdb.py leanpkg     leanpkg.bat</p>



<a name="259992778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259992778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259992778">(Nov 02 2021 at 13:10)</a>:</h4>
<p>Oh great -- <code>lean</code> is there! So go back up with <code>cd /Users/timchiu/repos/lean</code> again and then try cutting and pasting precisely the part which didn't work before, i.e.:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">cp</span> <span class="n">bin</span><span class="bp">/</span><span class="n">lean</span> <span class="bp">~/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">bin</span>
<span class="n">cp</span> <span class="n">bin</span><span class="bp">/</span><span class="n">leanpkg</span> <span class="bp">~/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">bin</span>
<span class="n">cp</span> <span class="n">build</span><span class="bp">/</span><span class="n">release</span><span class="bp">/</span><span class="n">checker</span><span class="bp">/</span><span class="n">leanchecker</span> <span class="bp">~/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">bin</span>
</code></pre></div>
<p>If this works then you can continue with the instructions. But don't ever close your terminal and then come back to it later because this action will move the directory which the terminal is pointing out, and it moves around during the process.</p>



<a name="259992964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/259992964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#259992964">(Nov 02 2021 at 13:12)</a>:</h4>
<p>In fact it seems to me that if those commands above work when your terminal is in the <code>/Users/timchiu/repos/lean</code> directory then you're all set. By the way, "work" means "returns no output". If you get an error then post it here.</p>



<a name="260028408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/260028408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tim Chiu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#260028408">(Nov 02 2021 at 17:19)</a>:</h4>
<p>Thank you so much! It's all working now.</p>



<a name="260462782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/260462782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Qiye Tan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#260462782">(Nov 05 2021 at 20:48)</a>:</h4>
<p>It seems that I could not build elan in 2021 M1 Macbook.</p>
<p><a href="/user_uploads/3121/_ini4VV4gxrClDqiSm_azJVe/image.png">image.png</a><br>
<a href="/user_uploads/3121/iUWDK2DE9xamXfMLfwSYtIy6/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/_ini4VV4gxrClDqiSm_azJVe/image.png" title="image.png"><img src="/user_uploads/3121/_ini4VV4gxrClDqiSm_azJVe/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/3121/iUWDK2DE9xamXfMLfwSYtIy6/image.png" title="image.png"><img src="/user_uploads/3121/iUWDK2DE9xamXfMLfwSYtIy6/image.png"></a></div><p>It seems that there is something wrong with the linking process?<br>
Any help is appreciated</p>



<a name="260525430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/260525430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#260525430">(Nov 06 2021 at 17:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="455437">Qiye Tan</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/260462782">said</a>:</p>
<blockquote>
<p>It seems that I could not build elan in 2021 M1 Macbook.</p>
</blockquote>
<p>(As a general rule, it's always better to provide plain text rather than, or as well as, screenshots - someone who is debugging the problem may very well want to copy-paste some of the output.)</p>



<a name="260595380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/260595380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Qiye Tan <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#260595380">(Nov 07 2021 at 21:01)</a>:</h4>
<p>Thx~ I think it is caused by curl-rust (libcurl bindings for Rust).</p>



<a name="261643235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/261643235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> boris <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#261643235">(Nov 16 2021 at 13:53)</a>:</h4>
<p>EDIT: Same issue as @Qiye Tan above.<br>
Unfortunately, the elan installation is not working for me. <br>
Proceeding without elan and seeing how far it gets me. </p>
<p>I'm on a 2021 M1 Macbook OS12.0.1<br>
The error I'm getting after <code>git checkout v1.0.7 &amp;&amp; cargo build</code>is the following. I tried with a couple later version as well with no luck. </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">error</span><span class="o">:</span> <span class="n">linking</span> <span class="k">with</span> <span class="bp">`</span><span class="n">cc</span><span class="bp">`</span> <span class="n">failed</span><span class="o">:</span> <span class="n">exit</span> <span class="n">status</span><span class="o">:</span> <span class="mi">1</span>
  <span class="bp">|</span>
  <span class="bp">=</span> <span class="n">note</span><span class="o">:</span> <span class="s2">"cc"</span> <span class="s2">"-arch"</span> <span class="s2">"arm64"</span>
<span class="bp">...</span>
<span class="o">[</span><span class="n">lots</span> <span class="n">of</span> <span class="n">lines</span> <span class="n">of</span> <span class="n">stuff</span><span class="o">]</span>
<span class="bp">...</span>
 <span class="bp">=</span> <span class="n">note</span><span class="o">:</span> <span class="n">ld</span><span class="o">:</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">symbol</span> <span class="o">(</span><span class="n">which</span> <span class="n">has</span> <span class="n">not</span> <span class="n">been</span> <span class="n">assigned</span> <span class="n">an</span> <span class="n">address</span><span class="o">)</span> <span class="n">__ZN4curl4init9INIT_CTOR17h0f90fe9ed6126500E</span> <span class="k">in</span> <span class="bp">'</span><span class="n">__ZN4curl4init17h5336e02b4d062249E'</span> <span class="k">from</span> <span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">boris</span><span class="bp">/</span><span class="n">repos</span><span class="bp">/</span><span class="n">elan</span><span class="bp">/</span><span class="n">target</span><span class="bp">/</span><span class="n">debug</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">libcurl</span><span class="bp">-</span><span class="mi">40</span><span class="n">c3b5b867aaff40.rlib</span><span class="o">(</span><span class="n">curl</span><span class="bp">-</span><span class="mi">40</span><span class="n">c3b5b867aaff40.curl.1df23e43</span><span class="bp">-</span><span class="n">cgu.2.rcgu.o</span><span class="o">)</span> <span class="n">for</span> <span class="n">architecture</span> <span class="n">arm64</span>
          <span class="n">clang</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">linker</span> <span class="n">command</span> <span class="n">failed</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span> <span class="o">(</span><span class="n">use</span> <span class="bp">-</span><span class="n">v</span> <span class="n">to</span> <span class="n">see</span> <span class="n">invocation</span><span class="o">)</span><span class="bp">```</span>
</code></pre></div>



<a name="261663503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/261663503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#261663503">(Nov 16 2021 at 16:02)</a>:</h4>
<p>For what it's worth, installing elan the usual way Just Worked for me after choosing the correct shell</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">curl</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">raw.githubusercontent.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">/</span><span class="n">elan</span><span class="bp">/</span><span class="n">master</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">init.sh</span> <span class="bp">-</span><span class="n">sSf</span> <span class="bp">|</span> <span class="n">arch</span> <span class="bp">-</span><span class="n">x86_64</span> <span class="n">sh</span>
</code></pre></div>



<a name="261666910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/261666910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#261666910">(Nov 16 2021 at 16:24)</a>:</h4>
<p>You have a different arch though right? They appear to have been building native ARM binaries.</p>



<a name="262048642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/262048642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> boris <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#262048642">(Nov 19 2021 at 10:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/261663503">said</a>:</p>
<blockquote>
<p>For what it's worth, installing elan the usual way Just Worked for me after choosing the correct shell</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">curl</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">raw.githubusercontent.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">/</span><span class="n">elan</span><span class="bp">/</span><span class="n">master</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">init.sh</span> <span class="bp">-</span><span class="n">sSf</span> <span class="bp">|</span> <span class="n">arch</span> <span class="bp">-</span><span class="n">x86_64</span> <span class="n">sh</span>
</code></pre></div><br>
</p>
</blockquote>
<p>This works. However, one has to install Homebrew this way too. To check that you are using the right install of Homebrew you can do </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">%</span> <span class="n">which</span> <span class="n">brew</span>
<span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">brew</span>
</code></pre></div>
<p>If you see</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">%</span> <span class="n">which</span> <span class="n">brew</span>
<span class="bp">/</span><span class="n">opt</span><span class="bp">/</span><span class="n">homebrew</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">brew</span>
</code></pre></div>
<p>you are pointing to the wrong Homebrew. </p>
<p>In fact, it appears to be common to have 2 Homebrew versions or even just preferring the <code>arch -x86_64</code> version. <br>
I've opted for the approach of having an "Open with Rosetta" duplicate version of iTerm. See google for more, e.g. <a href="https://gist.github.com/progrium/b286cd8c82ce0825b2eb3b0b3a0720a0">this</a> or <a href="https://seannicdao.com/2021/02/dual-install-homebrew-nvm-and-node-on-apple-m1/">this</a>.</p>
<p>I recommend this approach to new M1 Mac installers as general installation instructions apply once you run everything with Rosetta.</p>



<a name="262832039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/262832039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Fedor Pavutnitskiy <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#262832039">(Nov 26 2021 at 20:17)</a>:</h4>
<p>Thanks Sebastian and boris, just finished setting up lean 3 on the fresh macbook M1 using this approach and it works great. Here are the steps I've used:</p>
<ol>
<li>
<p>open new terminal window and install xcode command line tools and rosetta 2 using <code>xcode-select --install</code> and <code>softwareupdate --install-rosetta</code>.</p>
</li>
<li>
<p>switch to the x86 architechture in the current terminal window by <code>arch -x86_64 zsh </code> as boris suggests. Everything below should happen in the same window.</p>
</li>
<li>
<p>install brew with <code>/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</code></p>
</li>
<li>
<p>the same steps as described in <a href="https://leanprover-community.github.io/install/macos_details.html">controlled installation for macos</a>:</p>
</li>
</ol>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">brew</span> <span class="n">install</span> <span class="n">elan</span> <span class="n">mathlibtools</span>
<span class="n">elan</span> <span class="n">toolchain</span> <span class="n">install</span> <span class="n">stable</span>
<span class="n">elan</span> <span class="n">default</span> <span class="n">stable</span>
</code></pre></div>
<ol start="5">
<li>
<p>use <code>leanproject get</code> to get the repositories needed.</p>
</li>
<li>
<p>after that I've installed vs-code from the website and set it up as usual.</p>
</li>
</ol>
<p>Looks like <code>leanproject</code> should always be called from <code>arch -x86_64</code>. Also I have no idea about performance downsides of using lean under rosetta vs natively.</p>



<a name="263609174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/263609174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#263609174">(Dec 03 2021 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="436061">@Trevor Fancher</span> I followed your instructions and they worked - thank you very much. After having played around with the formalising-mathematics project, I decided to try the tutorials project using "leanproject get tutorials". This gave me the same error as in your guide (when you tried to get formalising-mathematics), but with 3.35.1 instead of 3.24.0, so I tried using the same solution, replacing 3.24.0 with 3.35.1, but this didn't work. As a workaround, I've just copied the contents of the lean files into the formalising-mathematics project, which seems to work, but obviously that's not a great fix. Do you have any idea what might have gone wrong?</p>



<a name="263653045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/263653045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#263653045">(Dec 03 2021 at 21:06)</a>:</h4>
<p>This really stinks. I'm seeing undergraduates with "congratulations on getting to university here's a new Mac" laptops and they're having the same sort of problem too.</p>



<a name="263730400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/263730400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leon2k2k2k <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#263730400">(Dec 04 2021 at 20:43)</a>:</h4>
<p>Hi new here, I am having the same problem: I can download everything but terminal can't find lean project...</p>



<a name="263730803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/263730803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leon2k2k2k <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#263730803">(Dec 04 2021 at 20:53)</a>:</h4>
<p>never mind haha, I tried to install everything again and it works now!</p>



<a name="264579004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579004">(Dec 11 2021 at 19:09)</a>:</h4>
<p>Following Fedor's instructions after trying to follow the instructions at the top of the page and failing to build elan like others. After installing homebrew again in the new architecture /usr/local/bin/brew now exists, but which brew still points to /opt/homebrew/bin/brew</p>



<a name="264579110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579110">(Dec 11 2021 at 19:11)</a>:</h4>
<p>If it is indeed important to use the right brew here, it might be nice for Trevor to update the top comment again, or for Fedor's comment to specify the full path to the correct brew in its instructions.</p>



<a name="264579188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579188">(Dec 11 2021 at 19:13)</a>:</h4>
<p>I would urge people to update the community website rather than random zulip posts. People getting stuck trying to install Lean 3 on one of these cursed new macs is becoming a weekly occurrence amongst Imperial people.</p>



<a name="264579284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579284">(Dec 11 2021 at 19:15)</a>:</h4>
<p>"I want to get involved" -- "great, install lean by following the instructions on the community website to the letter" -- "but I have a new mac and I need help" -- [I now have to stop what I'm doing which is typically teaching someone how to use Lean at Xena or on the discord]</p>



<a name="264579425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579425">(Dec 11 2021 at 19:18)</a>:</h4>
<p>Let me just confirm Fedor's instructions work, then I'll make a PR to update the site</p>



<a name="264579752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579752">(Dec 11 2021 at 19:25)</a>:</h4>
<p>Thank you so much. I wish I could help (because this is a pain point for me) but I don't have access to a new Mac, so all I do is moan :-(</p>



<a name="264579809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579809">(Dec 11 2021 at 19:26)</a>:</h4>
<p>Hehe, I am using my mom's, she has one and I don't and I wanted to try lean out on it!</p>



<a name="264579813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264579813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264579813">(Dec 11 2021 at 19:26)</a>:</h4>
<p>An MSc student who is fully signed-up to do her MSc project with me starting in January needs help with this, and now we've moved back to online so I can't even take her mac off her and <del>throw it in the trash</del> help her to install Lean on it</p>



<a name="264582195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264582195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264582195">(Dec 11 2021 at 20:16)</a>:</h4>
<p>Hmm, I can actually still call <code>leanproject</code>, even after restarting the terminal window, without rerunning the architecture change. Nevertheless, Fedor's instructions work, and I can use lean from VSCode. Worryingly, when trying to build mathlib from scratch using <code>lean --make src</code>, I did run into memory issues.</p>



<a name="264582240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264582240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264582240">(Dec 11 2021 at 20:17)</a>:</h4>
<p>Do you have to build mathlib from scratch??</p>



<a name="264582311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264582311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264582311">(Dec 11 2021 at 20:18)</a>:</h4>
<p>Why can't you use leanproject to download the oleans? Anyone would have memory issues if they tried to build mathlib from scratch nowadays. On one of my computers building mathlib from scratch reliably freezes it.</p>



<a name="264582764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264582764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264582764">(Dec 11 2021 at 20:27)</a>:</h4>
<p>No I don't have to build it from scratch - let me be clear. I just wanted to see if the M1 is as fast as they say by building mathlib on it.</p>



<a name="264582952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264582952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264582952">(Dec 11 2021 at 20:31)</a>:</h4>
<p><code>leanproject get-m</code> works fine with this installation process, so it should be perfectly possible to use mathlib without building it. Perhaps you're right - it seems like building mathlib takes a lot of memory even on my intel Mac.</p>



<a name="264582977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264582977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264582977">(Dec 11 2021 at 20:31)</a>:</h4>
<p>You can use flags such as -M6000 if building on the command line</p>



<a name="264583036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264583036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264583036">(Dec 11 2021 at 20:32)</a>:</h4>
<p>Ah, I see that command will cut down the memory usage. Thanks!</p>



<a name="264583618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264583618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264583618">(Dec 11 2021 at 20:44)</a>:</h4>
<p><a href="https://github.com/leanprover-community/leanprover-community.github.io/pull/231">Pull Request</a></p>



<a name="264626377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/264626377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#264626377">(Dec 12 2021 at 14:35)</a>:</h4>
<p>Thank you so much!</p>



<a name="265255566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265255566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265255566">(Dec 17 2021 at 05:23)</a>:</h4>
<p>Okay, so some updates - I just tried this on a new MBP (Lean took 5"14 to build here, which isn't too bad!) and I can confirm that the new instructions work for an Intel build. I seem to also be able to build from source and follow the build instructions from the top on that step, but Activity Monitor still reports it as an Intel arch build - I'll look into this tomorrow. And finally, most importantly as it relates to the comments on the PR, I installed all other components with the M1 homebrew, and it worked fine.</p>



<a name="265292324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265292324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265292324">(Dec 17 2021 at 13:01)</a>:</h4>
<blockquote>
<p>I seem to also be able to build from source and follow the build instructions from the top on that step, but Activity Monitor still reports it as an Intel arch build</p>
</blockquote>
<p>If you share what you ran happy to help with this -- just to be sure, you didn't run it from within the <code>arch -x86_64 zsh</code> shell hopefully? Otherwise what I run is <code>rm -rf build; mkdir -p build/release; cd build/release; cmake -DCMAKE_PREFIX_PATH=/opt/homebrew/ -DCMAKE_INSTALL_PREFIX=/Users/julian/.local/share/lean/lean-"$(git name-rev HEAD --tags | sed 's;.*/v;;')"-darwin/ ../../src &amp;&amp; make -j4</code> -- as long as you're not in an x86 shell that should work (or also don't set <code>ARCHPREFERENCES=x84</code>, etc)</p>



<a name="265292442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265292442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265292442">(Dec 17 2021 at 13:02)</a>:</h4>
<p>You can confirm you get an ARM build out of that from running <code>file shell/lean</code>, which should say it's an ARM executable if everything went well.</p>



<a name="265292513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265292513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265292513">(Dec 17 2021 at 13:03)</a>:</h4>
<p>Perhaps we should split the Zulip thread though for those stubborn enough to want ARM builds, I think there's already enough confusion on the above (and the PR is likely ready to merge so I'll put my token LGTM on it)</p>



<a name="265296373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265296373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anne Baanen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265296373">(Dec 17 2021 at 13:41)</a>:</h4>
<p>I went ahead and merged the instructions. Thank you all very much for writing and trying them out <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="265324010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265324010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265324010">(Dec 17 2021 at 16:40)</a>:</h4>
<p>ahh, I see what happened - I copied the wrong Lean installation over (I copied to <code>stable</code>, instead of <code>leanprover-community-lean-3.35.1</code>). I may make a little script that does this all correctly for me automatically, and learn some shell scripting for proper</p>



<a name="265328252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265328252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265328252">(Dec 17 2021 at 17:10)</a>:</h4>
<p>If you want to automate this more I'd instead recommend writing yourself a homebrew formula personally (one you use with your ARM brew). I have one for Lean 4 but I haven't cared enough to do so for Lean 3. Happy to share one too.</p>



<a name="265328615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265328615" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265328615">(Dec 17 2021 at 17:13)</a>:</h4>
<p>mind sharing it? it's probably helpful to others and can base the lean3 one off it sort of (although I guess it'll be quite different with lake and all)</p>



<a name="265328852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265328852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265328852">(Dec 17 2021 at 17:15)</a>:</h4>
<p>Sure. It's here: <a href="https://github.com/Julian/homebrew-tap/blob/master/Formula/lean%404.rb">https://github.com/Julian/homebrew-tap/blob/master/Formula/lean%404.rb</a></p>



<a name="265328875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265328875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265328875">(Dec 17 2021 at 17:15)</a>:</h4>
<p>(And it's essentially directly copied from the upstream lean formula)</p>



<a name="265328978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265328978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265328978">(Dec 17 2021 at 17:16)</a>:</h4>
<p>A lean 3 one would be the same, the build process doesn't care much about lake</p>



<a name="265329105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329105">(Dec 17 2021 at 17:17)</a>:</h4>
<p>(Keep in mind you'd need one of these for each Lean 3 version you want obviously, which is why people like elan fully handling the install)</p>



<a name="265329621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329621">(Dec 17 2021 at 17:20)</a>:</h4>
<p>can't you make it take an argument with the version? my idea was, if you run it in the directory with the lean installation, <code>elan which lean</code> gives you the right lean version, then you can make your lean locally and copy it into the right place</p>



<a name="265329666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329666">(Dec 17 2021 at 17:21)</a>:</h4>
<p>also tbf, it's only a minor inconvenience right now, as rosetta seems to be able to deal with lean these days just fine</p>



<a name="265329692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329692">(Dec 17 2021 at 17:21)</a>:</h4>
<p>if you made the version be an argument homebrew won't let you install multiple separate invocations</p>



<a name="265329726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329726">(Dec 17 2021 at 17:21)</a>:</h4>
<p>yes, I'd say if you're happy with rosetta I would not bother personally</p>



<a name="265329759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329759">(Dec 17 2021 at 17:22)</a>:</h4>
<p>the only reason I do so is because I don't have or want an x86 homebrew install for any other reason</p>



<a name="265329805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329805">(Dec 17 2021 at 17:22)</a>:</h4>
<p>ahh, I see; don't really understand how homebrew works (still my first rodeo in OSX)</p>



<a name="265329892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265329892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265329892">(Dec 17 2021 at 17:22)</a>:</h4>
<p>don't worry no one does :P (let alone me)</p>



<a name="265390589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265390589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265390589">(Dec 18 2021 at 04:07)</a>:</h4>
<p>OK, cool, so I've got this little shell script now:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="ch">#!/bin/zsh</span>

<span class="nb">set</span> -x

<span class="nv">version</span><span class="o">=</span><span class="s2">"v"</span>
<span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>elan which lean<span class="k">)</span> <span class="o">=</span>~ <span class="s2">"leanprover-community--lean---(.*)\/bin\/lean</span>$<span class="s2">"</span> <span class="o">]]</span> <span class="k">then</span>
  <span class="nv">version</span><span class="o">+=</span><span class="nv">$match</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">version</span> <span class="o">==</span> <span class="s2">"v"</span> <span class="o">]]</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"elan which lean reported an unsupported Lean path:"</span>
  <span class="nb">echo</span> <span class="k">$(</span>elan which lean<span class="k">)</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">lenloc</span><span class="o">=</span><span class="k">$(</span>elan which lean<span class="k">)</span>
<span class="nv">chkloc</span><span class="o">=</span><span class="k">$(</span>elan which leanchecker<span class="k">)</span>
<span class="nv">pkgloc</span><span class="o">=</span><span class="k">$(</span>elan which leanpkg<span class="k">)</span>

<span class="c1"># Set this to a local clone of leanprover-community/lean (that you don't mind being messed with!)</span>
<span class="nb">cd</span> ~/repos/lean
<span class="c1"># Note that this is very destructive!!!</span>
git clean -fdx
git switch master
git pull
git checkout <span class="nv">$version</span>
mkdir -p build/release
<span class="nb">cd</span> build/release
cmake -DCMAKE_PREFIX_PATH<span class="o">=</span>/opt/homebrew/ -DCMAKE_INSTALL_PREFIX<span class="o">=</span>~/repos/lean/ ../../src
make bin_lean  -j10
<span class="nb">cd</span> ../../
cp bin/lean <span class="nv">$lenloc</span>
cp bin/leanpkg <span class="nv">$pkgloc</span>
cp build/release/checker/leanchecker <span class="nv">$chkloc</span>
</code></pre></div>
</div></div>
<p>I'd really appreciate if people could try this and tell me how well it works; the idea is that after you <code>leanproject get</code> some repo, and <code>elan</code> installs the x86 version of <code>leanprover-community</code> lean required to run it, this replaces the relevant binaries with the ARM version (i.e. the workflow I use is <code>leanproject get mathlib; cd mathlib; this_script</code>)</p>
<p>Firstly, wow Lean builds in a minute - my poor 3600X was taking like 4 minutes with -j12...</p>
<p>Secondly, this is actually not perfect; I don't know the right <code>make</code> target that will make just <code>lean</code>, <code>leanpkg</code> and <code>leanchecker</code>. If you just leave it on default, it'll build all of the stdlib for no real reason; but <code>bin_lean</code> doesn't make <code>leanchecker</code>; please let me know if anyone knows!</p>
<p>And also, lastly, currently this script seems to need <code>sudo</code> to copy the files at the end? Which isn't great... I feel like I got wrong permissions somewhere, but this is my first time using a Unix-like OS. If someone can tell me how I can fix that, that'd be much appreciated.</p>



<a name="265391336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265391336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265391336">(Dec 18 2021 at 04:25)</a>:</h4>
<p>Ahh, I see the permissions issue. <code>elan</code> downloads <code>lean(pkg|checker)?</code> as <code>r-xr-xr-x</code>, so I can't <code>cp</code> on top of them. my current idea for a workaround (as we should own these files) are <code>chmod u+w lean, cp blah, chmod u-w lean</code>; is there a better way to do that?</p>



<a name="265391391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265391391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265391391">(Dec 18 2021 at 04:26)</a>:</h4>
<p>anyways, I can finally get to maths, which is the happy thing :D</p>



<a name="265426420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265426420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265426420">(Dec 18 2021 at 16:18)</a>:</h4>
<p>I followed <span class="user-mention" data-user-id="460215">@Fedor Pavutnitskiy</span>'s instructions and have it now semi-working. I've been able to use <code>leanproject get tutorials</code> and <code>leanproject get ImperialCollegeLondon/formalising-mathematics</code> and have both projects working successful. However, when I try to run <code>leanproject new test_project</code> I get a very long error that ends with <code>Command '['leanpkg', 'new', 'test_project']' returned non-zero exit status 1.</code>. I have tried restarting my computer and it hasn't made any difference.</p>



<a name="265426424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265426424" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265426424">(Dec 18 2021 at 16:18)</a>:</h4>
<p>Does anyone know how I can fix this?</p>



<a name="265426439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265426439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265426439">(Dec 18 2021 at 16:19)</a>:</h4>
<p>Can you post the error? Do you have write access to the directory where you ran the command?</p>



<a name="265426985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265426985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265426985">(Dec 18 2021 at 16:30)</a>:</h4>
<p>Sadly the error is over a million characters, and Zulip only lets me post ten thousand</p>



<a name="265426994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265426994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265426994">(Dec 18 2021 at 16:30)</a>:</h4>
<p>I'm pretty sure I do have access</p>



<a name="265427003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265427003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265427003">(Dec 18 2021 at 16:30)</a>:</h4>
<p>Here are the first few lines of the error </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">o.is_some</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="n">bool</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">type</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">o.is_some</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="n">bool</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean</span><span class="o">:</span><span class="mi">149</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="kd">instance</span> <span class="n">name</span><span class="o">,</span> <span class="n">name</span> <span class="n">should</span> <span class="n">be</span> <span class="n">provided</span> <span class="n">explicitly</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean</span><span class="o">:</span><span class="mi">322</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">function</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">f</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="n">expr</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean</span><span class="o">:</span><span class="mi">353</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">function</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">e</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="n">expr</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">local_context.lean</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">pexpr.lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">has_reflect.lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr_address.lean</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">declaration.lean</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr_address.lean</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">local_context.lean</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">environment.lean</span><span class="o">:</span><span class="mi">8</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">interaction_monad.lean</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">interaction_monad.lean</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">tactic.lean</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="n">data</span><span class="bp">/</span><span class="n">option</span><span class="bp">/</span><span class="n">basic.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">tactic.lean</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">imported</span> <span class="n">file</span> <span class="bp">'/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">expr.lean'</span> <span class="n">uses</span> <span class="gr">sorry</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">sebastianmonnet</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">stable</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">library</span><span class="bp">/</span><span class="n">init</span><span class="bp">/</span><span class="kd">meta</span><span class="bp">/</span><span class="n">tactic.lean</span><span class="o">:</span><span class="mi">1578</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">function</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="n">expr.const</span> <span class="o">(</span><span class="n">name.mk_string</span> <span class="s2">"dite"</span> <span class="n">name.anonymous</span><span class="o">)</span> <span class="o">[</span><span class="n">tgt_u</span><span class="o">]</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
</code></pre></div>



<a name="265427699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265427699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265427699">(Dec 18 2021 at 16:45)</a>:</h4>
<p>Oh you've posted enough! What does <code>elan show</code> print out? Maybe <code>elan default leanprover-community-lean-3.30.0</code> will help? I doubt it will do much harm. I'm wondering if your default lean toolchain is lean 4.</p>



<a name="265427753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265427753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265427753">(Dec 18 2021 at 16:46)</a>:</h4>
<p>elan show prints out </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">installed</span> <span class="n">toolchains</span>
<span class="c1">--------------------</span>

<span class="n">stable</span> <span class="o">(</span><span class="n">default</span><span class="o">)</span>
<span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">lean</span><span class="o">:</span><span class="mi">3</span><span class="bp">.</span><span class="mi">24</span><span class="bp">.</span><span class="mi">0</span>
<span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">lean</span><span class="o">:</span><span class="mi">3</span><span class="bp">.</span><span class="mi">35</span><span class="bp">.</span><span class="mi">1</span>

<span class="n">active</span> <span class="n">toolchain</span>
<span class="c1">----------------</span>

<span class="n">stable</span> <span class="o">(</span><span class="n">default</span><span class="o">)</span>
<span class="n">Lean</span> <span class="o">(</span><span class="n">version</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">33</span><span class="bp">.</span><span class="mi">0</span><span class="o">,</span> <span class="n">commit</span> <span class="n">a0fb1e8c7ac8</span><span class="o">,</span> <span class="n">Release</span><span class="o">)</span>
</code></pre></div>



<a name="265427758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265427758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265427758">(Dec 18 2021 at 16:46)</a>:</h4>
<p>So I guess it's not that?</p>



<a name="265428309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428309">(Dec 18 2021 at 16:58)</a>:</h4>
<p>can you try get the first few lines of the errors?</p>



<a name="265428472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428472">(Dec 18 2021 at 17:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/265428309">said</a>:</p>
<blockquote>
<p>can you try get the first few lines of the errors?</p>
</blockquote>
<p>What do you mean? Is that not what I posted above?</p>



<a name="265428486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428486">(Dec 18 2021 at 17:01)</a>:</h4>
<p>this looks like the sort of errors I get when Lean didn't want to compile properly when you're compiling from source, but Fedor's instructions don't seem to</p>



<a name="265428492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428492">(Dec 18 2021 at 17:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="460212">Sebastian Monnet</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/265428472">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/265428309">said</a>:</p>
<blockquote>
<p>can you try get the first few lines of the errors?</p>
</blockquote>
<p>What do you mean? Is that not what I posted above?</p>
</blockquote>
<p>oh, what?! that's almost weirder...</p>



<a name="265428504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428504">(Dec 18 2021 at 17:01)</a>:</h4>
<p>what arch terminal are you running <code>leanproject</code> from?</p>



<a name="265428583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428583">(Dec 18 2021 at 17:03)</a>:</h4>
<p>I've tried both the default and the x86 one from Fedor's instructions</p>



<a name="265428678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428678">(Dec 18 2021 at 17:04)</a>:</h4>
<p>can you post a full shell-log on something like pastebin or gists</p>



<a name="265428950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265428950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265428950">(Dec 18 2021 at 17:10)</a>:</h4>
<p><a href="https://gist.github.com/SebastianMonnet/a2d6531bfc7e588d3e928f84a4e851d5">https://gist.github.com/SebastianMonnet/a2d6531bfc7e588d3e928f84a4e851d5</a></p>



<a name="265430253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430253">(Dec 18 2021 at 17:35)</a>:</h4>
<p>can you try setting the <code>elan</code> default to a lean install that you've used in some other context, e.g. 3.35.1?</p>



<a name="265430276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430276">(Dec 18 2021 at 17:35)</a>:</h4>
<p>i'm not too sure what's going on but my first idea is that <code>leanpkg</code> is written in lean itself, so that may have something to do with it</p>



<a name="265430375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430375">(Dec 18 2021 at 17:38)</a>:</h4>
<p>Okay I just did this</p>



<a name="265430416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430416">(Dec 18 2021 at 17:38)</a>:</h4>
<p>Will try making a leanproject</p>



<a name="265430423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430423">(Dec 18 2021 at 17:38)</a>:</h4>
<p>ooh</p>



<a name="265430427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430427">(Dec 18 2021 at 17:38)</a>:</h4>
<p>It's doing something different now!</p>



<a name="265430431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430431">(Dec 18 2021 at 17:38)</a>:</h4>
<p>Seems to be working</p>



<a name="265430432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430432" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430432">(Dec 18 2021 at 17:38)</a>:</h4>
<p>Will report back once it's done</p>



<a name="265430442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430442">(Dec 18 2021 at 17:39)</a>:</h4>
<p>another bruised and battered user struggles to the top of the "installing Lean 3 on an M1" mountain</p>



<a name="265430503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430503">(Dec 18 2021 at 17:40)</a>:</h4>
<p>Do we need to add some comments about setting default elan toolchain? I am a bit confused about why this is happening -- changing my default toolchain between lean 3 versions shouldn't break <code>leanproject</code> right?</p>



<a name="265430595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430595">(Dec 18 2021 at 17:42)</a>:</h4>
<p>Yes the project works</p>



<a name="265430598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430598">(Dec 18 2021 at 17:42)</a>:</h4>
<p>I think the oleans or something is broken, I personally haven't tried <code>stable</code> so i'm going to run some tests to see what's going on</p>



<a name="265430602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Monnet <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430602">(Dec 18 2021 at 17:42)</a>:</h4>
<p>Thank you both for your help</p>



<a name="265430621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430621">(Dec 18 2021 at 17:43)</a>:</h4>
<p>For me the only thing which changes if I change my default toolchain is that at the very beginning of the output with <code>leanproject new</code> I get a different default branch (which is deleted later on):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">leanproject</span> <span class="n">new</span> <span class="n">test1</span>
<span class="bp">&gt;</span> <span class="n">cd</span> <span class="n">test1</span>
<span class="bp">&gt;</span> <span class="n">git</span> <span class="n">init</span> <span class="bp">-</span><span class="n">q</span>
<span class="bp">&gt;</span> <span class="n">git</span> <span class="n">checkout</span> <span class="bp">-</span><span class="n">b</span> <span class="n">lean</span><span class="bp">-</span><span class="mi">3</span><span class="bp">.</span><span class="mi">33</span><span class="bp">.</span><span class="mi">0</span>
<span class="n">Switched</span> <span class="n">to</span> <span class="n">a</span> <span class="n">new</span> <span class="n">branch</span> <span class="bp">'</span><span class="n">lean</span><span class="bp">-</span><span class="mi">3</span><span class="bp">.</span><span class="mi">33</span><span class="bp">.</span><span class="mi">0</span><span class="bp">'</span>
<span class="n">configuring</span> <span class="n">test1</span> <span class="mi">0</span><span class="bp">.</span><span class="mi">1</span>
<span class="n">Adding</span> <span class="n">mathlib</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">cloning</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">_target</span><span class="bp">/</span><span class="n">deps</span><span class="bp">/</span><span class="n">mathlib</span>
<span class="bp">...</span>
</code></pre></div>
<p>As far as I know that 3.33 stuff (which is irrelevant) is the only thing affected by the default toolchain</p>



<a name="265430677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430677">(Dec 18 2021 at 17:44)</a>:</h4>
<p><code>leanpkg</code> is run on <code>lean</code> itself, it's not a python program or anything so if that Lean install is borked then it will blow up</p>



<a name="265430679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430679">(Dec 18 2021 at 17:44)</a>:</h4>
<p>Note that mathlib master is on 3.35.1 right now and the project works fine, it's just that one random bit at the beginning; that's the only way you can tell what your default toolchain is in the process.</p>



<a name="265430689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430689">(Dec 18 2021 at 17:44)</a>:</h4>
<p>Oh so you're suggesting that Sebastian has a borked 3.33 install?</p>



<a name="265430705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430705">(Dec 18 2021 at 17:45)</a>:</h4>
<p>Not that this matters much any more</p>



<a name="265430712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265430712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265430712">(Dec 18 2021 at 17:45)</a>:</h4>
<p>that's my only idea so far, yeah, or the 3.33 install doesn't work on M1 for some reason; something'sdefinitely weird because I just reinstalled <code>stable</code> on my elan and it came as 3.35.1</p>



<a name="265446775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/265446775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#265446775">(Dec 18 2021 at 22:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/265390589">said</a>:</p>
<blockquote>
<p>OK, cool, so I've got this little shell script now:</p>
<div class="spoiler-block"><div class="spoiler-header">
</div><div class="spoiler-content" aria-hidden="true">
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="ch">#!/bin/zsh</span>

<span class="nb">set</span> -x

<span class="nv">version</span><span class="o">=</span><span class="s2">"v"</span>
<span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>elan which lean<span class="k">)</span> <span class="o">=</span>~ <span class="s2">"leanprover-community--lean---(.*)\/bin\/lean</span>$<span class="s2">"</span> <span class="o">]]</span> <span class="k">then</span>
  <span class="nv">version</span><span class="o">+=</span><span class="nv">$match</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">version</span> <span class="o">==</span> <span class="s2">"v"</span> <span class="o">]]</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"elan which lean reported an unsupported Lean path:"</span>
  <span class="nb">echo</span> <span class="k">$(</span>elan which lean<span class="k">)</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">lenloc</span><span class="o">=</span><span class="k">$(</span>elan which lean<span class="k">)</span>
<span class="nv">chkloc</span><span class="o">=</span><span class="k">$(</span>elan which leanchecker<span class="k">)</span>
<span class="nv">pkgloc</span><span class="o">=</span><span class="k">$(</span>elan which leanpkg<span class="k">)</span>

<span class="c1"># Set this to a local clone of leanprover-community/lean (that you don't mind being messed with!)</span>
<span class="nb">cd</span> ~/repos/lean
<span class="c1"># Note that this is very destructive!!!</span>
git clean -fdx
git switch master
git pull
git checkout <span class="nv">$version</span>
mkdir -p build/release
<span class="nb">cd</span> build/release
cmake -DCMAKE_PREFIX_PATH<span class="o">=</span>/opt/homebrew/ -DCMAKE_INSTALL_PREFIX<span class="o">=</span>~/repos/lean/ ../../src
make -j10
<span class="nb">cd</span> ../../
chmod u+w <span class="nv">$lenloc</span> <span class="nv">$pkgloc</span> <span class="nv">$chkloc</span>
cp bin/lean <span class="nv">$lenloc</span>
cp bin/leanpkg <span class="nv">$pkgloc</span>
cp build/release/checker/leanchecker <span class="nv">$chkloc</span>
chmod u-w <span class="nv">$lenloc</span> <span class="nv">$pkgloc</span> <span class="nv">$chkloc</span>
</code></pre></div>
</div></div>
<p>I'd really appreciate if people could try this and tell me how well it works; the idea is that after you <code>leanproject get</code> some repo, and <code>elan</code> installs the x86 version of <code>leanprover-community</code> lean required to run it, this replaces the relevant binaries with the ARM version (i.e. the workflow I use is <code>leanproject get mathlib; cd mathlib; this_script</code>)</p>
<p>Firstly, wow Lean builds in a minute - my poor 3600X was taking like 4 minutes with -j12...</p>
<p>Secondly, this is actually not perfect; I don't know the right <code>make</code> target that will make just <code>lean</code>, <code>leanpkg</code> and <code>leanchecker</code>. If you just leave it on default, it'll build all of the stdlib for no real reason; but <code>bin_lean</code> doesn't make <code>leanchecker</code>; please let me know if anyone knows!</p>
<p>~~And also, lastly, currently this script seems to need <code>sudo</code> to copy the files at the end? Which isn't great... I feel like I got wrong permissions somewhere, but this is my first time using a Unix-like OS. If someone can tell me how I can fix that, that'd be much appreciated.~ ~ see below</p>
</blockquote>
<p>I've updated to one that shouldn't run into permission issues - if someone knows a better way to write the shell script lmk! Would also appreciate someone else testing it to see if it's worth using.</p>



<a name="273095961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/273095961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Louis Theran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#273095961">(Feb 24 2022 at 14:29)</a>:</h4>
<p>I was a little worried that the solutions above were beyond my competence, since I don't really understand how lean installs itself.  As an alternative, which might be better for beginners, I used Docker and the dev container setup from <a href="https://github.com/danielbush/lean-remote-containers">https://github.com/danielbush/lean-remote-containers</a>.</p>
<p>This more or less worked out of the box, presumably because the Docker images are Linux, which elan supports.</p>
<p>I did run into one problem, which is that, if you start with a "bare" directory, lean complains about not having a leanpkg.toml file.  My rather unsightly solution was to run leanproject and  then restart.</p>



<a name="273096537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/273096537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#273096537">(Feb 24 2022 at 14:33)</a>:</h4>
<p>Welcome, Louis! Great to see you here!</p>



<a name="273097253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/273097253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#273097253">(Feb 24 2022 at 14:38)</a>:</h4>
<p>I don't have an M1 mac so I haven't tested them but I think the current recommended instructions are here; did you try these / have any trouble with them? <a href="https://leanprover-community.github.io/install/macos.html#m1-macs--apple-silicon">https://leanprover-community.github.io/install/macos.html#m1-macs--apple-silicon</a></p>



<a name="273220761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/M1%20Macs%3A%20Installing%20the%20Lean%203%20toolchain/near/273220761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Louis Theran <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain.html#273220761">(Feb 25 2022 at 12:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="123965">Bryan Gin-ge Chen</span> <a href="#narrow/stream/113489-new-members/topic/M1.20Macs.3A.20Installing.20the.20Lean.203.20toolchain/near/273097253">said</a>:</p>
<blockquote>
<p>I don't have an M1 mac so I haven't tested them but I think the current recommended instructions are here; did you try these / have any trouble with them? <a href="https://leanprover-community.github.io/install/macos.html#m1-macs--apple-silicon">https://leanprover-community.github.io/install/macos.html#m1-macs--apple-silicon</a></p>
</blockquote>
<p>I didn't so far, since I got a little scared off by having to install a second homebrew for a different architecture.</p>
<p>Since just running in Docker works more or less perfectly, I didn't try anything else.  (Though I can easily imagine a more refined version where one doesn't need devcontainers and just uses "docker run lean" as the executable.)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>