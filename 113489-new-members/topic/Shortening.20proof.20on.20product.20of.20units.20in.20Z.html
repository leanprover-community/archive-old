---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html">Shortening proof on product of units in Z</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="204398529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204398529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204398529">(Jul 20 2020 at 08:44)</a>:</h4>
<p>Hi all, I've been trying to write a tactic proof of the fact that <code>m * n = 1 ↔ m = 1 ∧ n = 1 ∨ m = -1 ∧ n = -1</code> over the integers. I've managed to muddle this together:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">mul_eq_one_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">cases</span> <span class="o">(</span><span class="n">is_unit_of_mul_eq_one</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span><span class="o">)</span> <span class="k">with</span> <span class="n">a_unit</span> <span class="n">h_a</span><span class="o">,</span>

  <span class="k">have</span> <span class="n">h_a_one_or_neg_one</span> <span class="o">:</span> <span class="n">a_unit</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">a_unit</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">int</span><span class="bp">.</span><span class="n">units_eq_one_or</span> <span class="n">a_unit</span><span class="o">,</span>
  <span class="n">simpa</span> <span class="o">[</span><span class="err">←</span><span class="n">h_a</span><span class="o">,</span> <span class="n">units</span><span class="bp">.</span><span class="n">ext_iff</span><span class="o">]</span> <span class="kn">using</span> <span class="n">h_a_one_or_neg_one</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">mul_eq_one</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">m</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">↔</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">m</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>

    <span class="c1">-- use result that a * b = 1 → a = 1 ∨ a = -1</span>
    <span class="c1">-- on m and n</span>
    <span class="k">have</span> <span class="n">hm</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">hn</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="n">h</span><span class="o">,</span>

    <span class="c1">-- enumerate combos of m, n = {1, -1}</span>
    <span class="n">cases</span> <span class="n">hm</span><span class="o">,</span> <span class="n">cases</span> <span class="n">hn</span><span class="o">,</span>
    <span class="c1">-- m = 1, n = 1</span>
    <span class="n">left</span><span class="o">,</span> <span class="n">exact</span> <span class="bp">⟨</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="c1">-- m = 1, n = -1 → false</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="n">linarith</span><span class="o">,</span>
    <span class="n">cases</span> <span class="n">hn</span><span class="o">,</span>
    <span class="c1">-- m = -1, n = 1 → false</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="n">linarith</span><span class="o">,</span>
    <span class="c1">-- m = -1, n = -1</span>
    <span class="n">right</span><span class="o">,</span> <span class="n">exact</span> <span class="bp">⟨</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="bp">⟩</span><span class="o">,</span>

    <span class="c1">-- prove other direction of iff</span>
    <span class="c1">-- i.e. 1 * 1 = 1 and -1 * -1 = 1</span>
    <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">repeat</span> <span class="o">{</span> <span class="n">rcases</span> <span class="n">h</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="o">]</span> <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>


<p>which works OK, but feels very length for a result that I feel like should follow quite easily from <code>int.units_eq_one_or</code> and <code>is_unit_of_mul_eq_one</code>? Is my approach here silly? Am I missing any approaches to shorten/clean up this proof?</p>



<a name="204399146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204399146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204399146">(Jul 20 2020 at 08:52)</a>:</h4>
<p>Your code doesn't run as it stands. Can you add the relevant imports/opens etc?</p>



<a name="204399163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204399163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204399163">(Jul 20 2020 at 08:53)</a>:</h4>
<p><code>import tactic</code> is enough</p>



<a name="204399537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204399537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204399537">(Jul 20 2020 at 08:58)</a>:</h4>
<p>Ah yes, sorry, it's missing an <code>import tactic</code> at the start</p>



<a name="204399599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204399599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204399599">(Jul 20 2020 at 08:59)</a>:</h4>
<p>The easy direction looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">theorem</span> <span class="n">mul_eq_one&#39;</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">m</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="bp">→</span> <span class="n">m</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rintros</span> <span class="o">(</span><span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="bp">|</span> <span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">)</span><span class="bp">;</span>
  <span class="n">norm_num</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204404854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204404854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204404854">(Jul 20 2020 at 10:03)</a>:</h4>
<p>The trick is that <code>rintros</code> will let you use <code>rfl</code> to mean "don't just make a new hypothesis <code>h : m = 1</code>, but define m to be 1 and then eliminate it, replacing all m's with 1's"</p>



<a name="204405530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204405530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204405530">(Jul 20 2020 at 10:13)</a>:</h4>
<p>You can eliminate the second <code>cases hn</code> by using a semicolon to separate the first two cases</p>



<a name="204405666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204405666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204405666">(Jul 20 2020 at 10:15)</a>:</h4>
<p>For the harder way, I think some units.coe lemmas are maybe missing?</p>



<a name="204406285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204406285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204406285">(Jul 20 2020 at 10:24)</a>:</h4>
<p>You can golf the harder way to:</p>
<div class="codehilite"><pre><span></span><code>        <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>

        <span class="c1">-- use result that a * b = 1 → a = 1 ∨ a = -1</span>
        <span class="c1">-- on m and n</span>
        <span class="k">obtain</span> <span class="n">hm</span> <span class="bp">|</span> <span class="n">hm</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="n">h</span><span class="bp">;</span>
        <span class="k">obtain</span> <span class="n">hn</span> <span class="bp">|</span> <span class="n">hn</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="o">(</span><span class="k">by</span> <span class="n">rwa</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span><span class="bp">;</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="bp">;</span>
        <span class="n">tauto</span><span class="o">,</span>
</code></pre></div>



<a name="204406304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204406304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204406304">(Jul 20 2020 at 10:25)</a>:</h4>
<p>Not that that really addresses your concerns</p>



<a name="204406319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204406319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204406319">(Jul 20 2020 at 10:25)</a>:</h4>
<p>I think that these are missing from the <code>units</code> API:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">namespace</span> <span class="n">units</span>

<span class="kn">universe</span> <span class="n">u</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">M</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">to_additive</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">coe_eq_coe</span> <span class="o">{</span><span class="n">u</span> <span class="n">v</span> <span class="o">:</span> <span class="n">units</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="n">v</span> <span class="bp">↔</span> <span class="n">u</span> <span class="bp">=</span> <span class="n">v</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="k">by</span> <span class="n">ext</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">h</span><span class="bp">⟩</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">to_additive</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">coe_eq_one</span> <span class="o">{</span><span class="n">u</span> <span class="o">:</span> <span class="n">units</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">↔</span> <span class="n">u</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="err">←</span><span class="n">units</span><span class="bp">.</span><span class="n">coe_one</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">coe_eq_coe</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204406405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204406405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204406405">(Jul 20 2020 at 10:26)</a>:</h4>
<p><code>norm_cast</code> should help here but I don't really know how to steer it.</p>



<a name="204407441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204407441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204407441">(Jul 20 2020 at 10:40)</a>:</h4>
<p>Oh, <code>coe_eq_coe</code> is <code>ext_iff.symm</code></p>



<a name="204407859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204407859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204407859">(Jul 20 2020 at 10:46)</a>:</h4>
<p>and <code>ext.eq_iff</code>. It should probably be tagged <code>norm_cast</code> I guess?</p>



<a name="204411142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204411142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204411142">(Jul 20 2020 at 11:30)</a>:</h4>
<p><span class="user-mention" data-user-id="248283">@Alex Peattie</span>, if you feel like making a PR with Kevin's suggestions here, that would be great! :-) (See <a href="https://leanprover-community.github.io/contribute/index.html">#contrib</a>.)</p>



<a name="204412112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204412112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204412112">(Jul 20 2020 at 11:42)</a>:</h4>
<p>Yes I'd be happy to take a crack at it <span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="204412248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204412248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204412248">(Jul 20 2020 at 11:44)</a>:</h4>
<p><span class="user-mention" data-user-id="248283">@Alex Peattie</span> What's your github username? Then we can give you push access</p>



<a name="204412276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204412276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204412276">(Jul 20 2020 at 11:44)</a>:</h4>
<p>It's <code>alexpeattie</code></p>



<a name="204412355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204412355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204412355">(Jul 20 2020 at 11:45)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/invitations">https://github.com/leanprover-community/mathlib/invitations</a></p>



<a name="204441181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204441181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204441181">(Jul 20 2020 at 16:01)</a>:</h4>
<p>PR is here - <a href="https://github.com/leanprover-community/mathlib/pull/3472">https://github.com/leanprover-community/mathlib/pull/3472</a></p>
<p>Incidentally, I don't think I've quite wrapped my head around how to use the extra coe lemmas on units to simplify things <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> ? I'm guessing it allows getting rid of the <code>simpa [←h_a, units.ext_iff]</code> part, and maybe using <code>norm_cast</code> instead?</p>



<a name="204445596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204445596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204445596">(Jul 20 2020 at 16:41)</a>:</h4>
<p>Yeah I couldn't get them to do anything useful. I don't really know how <code>norm_cast</code> works any more. The docstring for <code>norm_cast</code> used to have a bunch of information on what kind of lemmas to tag with what attribute, but then it all got simplified and the helpful docstring disappeared because it was all supposed to be easier -- "tag everything with <code>norm_cast</code>". The upshot is that I now don't really know what to tag with <code>norm_cast</code> because I can't see the examples any more.</p>



<a name="204448551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204448551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204448551">(Jul 20 2020 at 17:07)</a>:</h4>
<p>Ah OK, thanks. I've just seen from the build on my PR that for some reason <code>coe_eq_one</code> seems to be causing <code>int.units_eq_one_or</code> to timeout during build, but I'm afraid it's well beyond my limited Lean skills to see why...</p>



<a name="204450783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204450783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204450783">(Jul 20 2020 at 17:26)</a>:</h4>
<p>Try removing the <code>simp</code> tag from <code>coe_eq_one</code>?</p>



<a name="204450848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204450848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204450848">(Jul 20 2020 at 17:26)</a>:</h4>
<p>I'll take a look</p>



<a name="204451475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204451475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204451475">(Jul 20 2020 at 17:33)</a>:</h4>
<p><span class="user-mention" data-user-id="248283">@Alex Peattie</span> Here's what you could do to "fix" <code>int.units_eq_one_or</code>:</p>
<p>(1) add <code>, - units.coe_eq_one</code> to the arguments of <code>simpa</code><br>
(2) turn the <code>simpa</code> into a <code>simpa only</code>.</p>



<a name="204451487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204451487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204451487">(Jul 20 2020 at 17:33)</a>:</h4>
<p>I pushed a commit that does (2).</p>



<a name="204451846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204451846" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204451846">(Jul 20 2020 at 17:36)</a>:</h4>
<p>Thank you <span class="user-mention" data-user-id="112680">@Johan Commelin</span> and <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> . So just so I understand, the <code>simp</code> tag on <code>coe_eq_one</code> is the "culprit" but based on Johan's suggestions I guess that it's still useful to have it there, so a better solution is being more specific in the <code>simpa</code> call in <code>units_eq_one_or</code>?</p>



<a name="204451878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204451878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204451878">(Jul 20 2020 at 17:36)</a>:</h4>
<p>I'm sure <code>norm_cast</code> should be helpful here. If <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> is a ring then there's a <code>has_neg</code> instance on <code>units R</code>, as well as a <code>has_one</code> instance.</p>



<a name="204452391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204452391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204452391">(Jul 20 2020 at 17:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">mul_eq_one_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">rcases</span> <span class="o">(</span><span class="n">is_unit_of_mul_eq_one</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span><span class="o">)</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">a_unit</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">int</span><span class="bp">.</span><span class="n">units_eq_one_or</span> <span class="n">a_unit</span> <span class="k">with</span> <span class="n">h</span> <span class="n">h</span><span class="o">,</span>
  <span class="c1">-- now what?</span>
  <span class="c">/-</span><span class="cm"></span>
<span class="cm">  case or.inl</span>
<span class="cm">b: ℤ</span>
<span class="cm">a_unit: units ℤ</span>
<span class="cm">h: ↑a_unit * b = 1</span>
<span class="cm">h: a_unit = 1</span>
<span class="cm">⊢ ↑a_unit = 1 ∨ ↑a_unit = -1</span>
<span class="cm">case or.inr</span>
<span class="cm">b: ℤ</span>
<span class="cm">a_unit: units ℤ</span>
<span class="cm">h: ↑a_unit * b = 1</span>
<span class="cm">h: a_unit = -1</span>
<span class="cm">⊢ ↑a_unit = 1 ∨ ↑a_unit = -1</span>
<span class="cm">-/</span>
  <span class="n">sorry</span><span class="o">,</span> <span class="n">sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204452519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204452519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204452519">(Jul 20 2020 at 17:42)</a>:</h4>
<p>I want to run <code>norm_cast</code> on the goal and turn it to <code>a_unit = 1 \or a_unit = -1</code></p>



<a name="204453193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453193">(Jul 20 2020 at 17:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> it seems like <code>rw h, left, norm_cast</code> closes the first goal, but <code>rw h, right, norm_cast</code> doesn't close the second goal...</p>



<a name="204453263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453263">(Jul 20 2020 at 17:49)</a>:</h4>
<p>so it seems like <code>norm_cast</code> gets stuck with <code>↑-1 = -1</code>?</p>



<a name="204453385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453385">(Jul 20 2020 at 17:50)</a>:</h4>
<p>It might need to be taught about that lemma...</p>



<a name="204453438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453438">(Jul 20 2020 at 17:51)</a>:</h4>
<p><span class="user-mention" data-user-id="248283">@Alex Peattie</span> Does <code>push_cast</code> instead of <code>norm_cast</code> help you?</p>



<a name="204453458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453458">(Jul 20 2020 at 17:51)</a>:</h4>
<p>It "goes the other way"</p>



<a name="204453509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453509">(Jul 20 2020 at 17:51)</a>:</h4>
<p><code>norm_cast</code> tries to pull coercions as far out as possible (and tries to strip them away if they get all the way to the outside).</p>



<a name="204453619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453619">(Jul 20 2020 at 17:52)</a>:</h4>
<p><code>push_cast</code> tries to <em>push</em> coercions to the inside of expressions... and there they might cancel because of lemmas like <code>↑1 = 1</code></p>



<a name="204453784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204453784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204453784">(Jul 20 2020 at 17:54)</a>:</h4>
<p>Ah OK, interesting. <code>push_cast</code> in place of <code>norm_cast</code> the way I'm using it (i.e. <code>rw h, right, norm_cast</code>) doesn't seem to make progress, no.</p>



<a name="204454950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204454950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204454950">(Jul 20 2020 at 18:03)</a>:</h4>
<p>This was what I couldn't fathom out, because</p>
<div class="codehilite"><pre><span></span><code><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">]</span> <span class="kn">protected</span> <span class="kn">theorem</span> <span class="n">coe_neg</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">units</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="err">↑</span><span class="bp">-</span><span class="n">u</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="n">u</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="204455133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455133">(Jul 20 2020 at 18:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> But if you apply that to <code>1</code>, it doesn't work, because you would need a <code>\u</code> before the <code>1</code> on the RHS.</p>



<a name="204455197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455197">(Jul 20 2020 at 18:05)</a>:</h4>
<p>So we maybe need a coe_neg_one?</p>



<a name="204455572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455572">(Jul 20 2020 at 18:08)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">units</span><span class="bp">.</span><span class="n">ext_iff</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">units</span> <span class="n">α</span><span class="o">},</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">↔</span> <span class="err">↑</span><span class="n">a</span> <span class="bp">=</span> <span class="err">↑</span><span class="n">b</span>
</code></pre></div>


<p>Should either that, or its <code>symm</code>, be <code>@[norm_cast]</code>? This is exactly the sort of question which used to be answered in the docstring (or somewhere describing <code>norm_cast</code>) and no longer is (or at least I can't find it)</p>



<a name="204455645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455645">(Jul 20 2020 at 18:09)</a>:</h4>
<p>When all the attributes were normalised, the examples were removed (or at least moved) (or at least I can't find them any more)</p>



<a name="204455670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455670">(Jul 20 2020 at 18:09)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/attributes.html#norm_cast%20attributes">https://leanprover-community.github.io/mathlib_docs/attributes.html#norm_cast%20attributes</a></p>



<a name="204455732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455732">(Jul 20 2020 at 18:09)</a>:</h4>
<p>Thanks Rob! I was looking under "tactics", and not under "attributes"</p>



<a name="204455969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204455969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204455969">(Jul 20 2020 at 18:11)</a>:</h4>
<p>My main problem now is that I'm on a machine with a screen that isn't wide enough to read the link  without scrolling to the bottom and dragging from left to right and then scrolling back up again :-)</p>



<a name="204457598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204457598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204457598">(Jul 20 2020 at 18:25)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="c1">-- should be in mathlib</span>
<span class="kn">namespace</span> <span class="n">units</span>

<span class="kn">universe</span> <span class="n">u</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">M</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">to_additive</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">coe_eq_coe</span> <span class="o">{</span><span class="n">u</span> <span class="n">v</span> <span class="o">:</span> <span class="n">units</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="n">v</span> <span class="bp">↔</span> <span class="n">u</span> <span class="bp">=</span> <span class="n">v</span> <span class="o">:=</span>
<span class="n">ext</span><span class="bp">.</span><span class="n">eq_iff</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">to_additive</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">coe_eq_one</span> <span class="o">{</span><span class="n">u</span> <span class="o">:</span> <span class="n">units</span> <span class="n">M</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">↔</span> <span class="n">u</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">norm_cast</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">coe_neg_one</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">units</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">end</span> <span class="n">units</span>
<span class="c1">-- end of mathlib stuff</span>

<span class="kn">theorem</span> <span class="n">mul_eq_one_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">rcases</span> <span class="o">(</span><span class="n">is_unit_of_mul_eq_one</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span><span class="o">)</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">a_unit</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">int</span><span class="bp">.</span><span class="n">units_eq_one_or</span> <span class="n">a_unit</span> <span class="k">with</span> <span class="n">h2</span> <span class="n">h2</span><span class="bp">;</span>
  <span class="n">rw</span> <span class="n">h2</span><span class="o">,</span>
  <span class="n">left</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">right</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">mul_eq_one</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">↔</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">m</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">obtain</span> <span class="n">hm</span> <span class="bp">|</span> <span class="n">hm</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="n">h</span><span class="bp">;</span>
    <span class="k">obtain</span> <span class="n">hn</span> <span class="bp">|</span> <span class="n">hn</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="o">(</span><span class="k">by</span> <span class="n">rwa</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span><span class="bp">;</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="bp">;</span>
    <span class="n">tauto</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintros</span> <span class="o">(</span><span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="bp">|</span> <span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">)</span><span class="bp">;</span>
    <span class="n">norm_num</span> <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>


<p>OK so this is looking in better shape. I am a bit confused about which of the proposed mathlib lemmas should be <code>simp</code> lemmas (I'm not very good at <code>simp</code>) but perhaps I've managed to get the <code>norm_cast</code> lemmas into good shape.</p>



<a name="204470479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204470479" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204470479">(Jul 20 2020 at 20:14)</a>:</h4>
<p>OK the PR's merged so <code>coe_eq_coe</code> and <code>coe_eq_one</code> should be in mathlib now, I'll do a new PR tomorrow to add <code>coe_neg_one</code> <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="204471666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204471666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204471666">(Jul 20 2020 at 20:25)</a>:</h4>
<p>Oh, nice! You're a fast mover :-)</p>



<a name="204652839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204652839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204652839">(Jul 22 2020 at 11:10)</a>:</h4>
<p>OK <code>coe_neg_one</code> is in the latest mathlib now <span aria-label="ok" class="emoji emoji-1f44c" role="img" title="ok">:ok:</span></p>



<a name="204652890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204652890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204652890">(Jul 22 2020 at 11:11)</a>:</h4>
<p>In case it's of interest to anyone, I originally wanted to prove the theorem above on my way to proving that 0 and 1 are the only consecutive perfect squares:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kn">theorem</span> <span class="n">mul_eq_one_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">a</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span> <span class="k">begin</span>
  <span class="n">rcases</span> <span class="o">(</span><span class="n">is_unit_of_mul_eq_one</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span><span class="o">)</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">a_unit</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">int</span><span class="bp">.</span><span class="n">units_eq_one_or</span> <span class="n">a_unit</span> <span class="k">with</span> <span class="n">h2</span> <span class="n">h2</span><span class="bp">;</span>
  <span class="n">rw</span> <span class="n">h2</span><span class="o">,</span>
  <span class="n">left</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">,</span>
  <span class="n">right</span><span class="o">,</span> <span class="n">norm_cast</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">mul_eq_one</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">}</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">↔</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">∨</span> <span class="n">m</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="bp">∧</span> <span class="n">n</span> <span class="bp">=</span> <span class="bp">-</span><span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">split</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">assume</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">obtain</span> <span class="n">hm</span> <span class="bp">|</span> <span class="n">hm</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="n">h</span><span class="bp">;</span>
    <span class="k">obtain</span> <span class="n">hn</span> <span class="bp">|</span> <span class="n">hn</span> <span class="o">:=</span> <span class="n">mul_eq_one_left</span> <span class="o">(</span><span class="k">by</span> <span class="n">rwa</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span><span class="bp">;</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">hm</span><span class="o">,</span> <span class="n">hn</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span><span class="bp">;</span>
    <span class="n">tauto</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rintros</span> <span class="o">(</span><span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="bp">|</span> <span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">)</span><span class="bp">;</span>
    <span class="n">norm_num</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">zero_one_only_consec_perfect_squares</span>
  <span class="o">(</span><span class="n">a</span><span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span><span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span>
  <span class="o">:</span> <span class="n">a</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">-</span> <span class="n">b</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">→</span> <span class="n">b</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">a</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">h</span><span class="o">,</span>
  <span class="k">obtain</span> <span class="bp">⟨</span><span class="n">h_ab</span><span class="o">,</span> <span class="bp">_⟩</span> <span class="bp">|</span> <span class="bp">⟨</span><span class="n">h_ab</span><span class="o">,</span> <span class="bp">_⟩</span> <span class="o">:=</span> <span class="n">mul_eq_one</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="k">by</span> <span class="o">{</span>
    <span class="n">ring</span><span class="o">,</span> <span class="n">assumption</span>
  <span class="o">}</span> <span class="o">:</span> <span class="o">((</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">-</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">))</span><span class="bp">;</span>
  <span class="o">{</span>
    <span class="k">have</span> <span class="n">h_b0</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">linarith</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">h_b0</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">add_zero</span> <span class="n">at</span> <span class="n">h_ab</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">h_ab</span><span class="o">,</span> <span class="n">ring</span><span class="o">,</span> <span class="n">use</span> <span class="bp">⟨</span><span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span>
  <span class="o">}</span>
<span class="kn">end</span>
</code></pre></div>



<a name="204723020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204723020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204723020">(Jul 22 2020 at 21:05)</a>:</h4>
<p>Nice :-) Now can you prove that there are no integer solutions to 4a^2=b^3+1 in integers is a=0 and b=-1?</p>



<a name="204723045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/204723045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#204723045">(Jul 22 2020 at 21:05)</a>:</h4>
<p>That's more challenging.</p>



<a name="206496625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/206496625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#206496625">(Aug 10 2020 at 18:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z/near/204723020">said</a>:</p>
<blockquote>
<p>Nice :-) Now can you prove that there are no integer solutions to 4a^2=b^3+1 in integers is a=0 and b=-1?</p>
</blockquote>
<p>I managed to prove this in the end. As you say much more challenging - it took me 500 or so lines, although I'm sure lots of parts are very "golfable" <span aria-label="smiling face" class="emoji emoji-263a" role="img" title="smiling face">:smiling_face:</span>. I'll clean up and the comment the proof, then stick it on Github</p>



<a name="206496746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/206496746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#206496746">(Aug 10 2020 at 18:40)</a>:</h4>
<p>I'm not sure the main result is very applicable elsewhere, but hopefully (once cleaned up) a couple of the lemmas I proved along the way might be useful mathlib additions</p>



<a name="206501669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/206501669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#206501669">(Aug 10 2020 at 19:17)</a>:</h4>
<p>I'm sure the main result is not of much use in some sense, but if you managed to get Lean to do it then that's great -- you probably learnt a lot about Lean along the way! And indeed you might have found some holes in mathlib. You should make a level at codewars :-)</p>



<a name="206502636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Shortening%20proof%20on%20product%20of%20units%20in%20Z/near/206502636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex Peattie <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Shortening.20proof.20on.20product.20of.20units.20in.20Z.html#206502636">(Aug 10 2020 at 19:27)</a>:</h4>
<p>Yes is seems the best way to learn Lean is to just throw yourself into trying to prove things! I hadn't realised there was a Lean section on Codewars, I'll take a look <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> !</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>