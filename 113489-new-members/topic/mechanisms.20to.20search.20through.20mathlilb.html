---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html">mechanisms to search through mathlilb</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="213190903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213190903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213190903">(Oct 13 2020 at 17:39)</a>:</h4>
<p>How frequently do more experienced Leaners use <code>library_search</code> or <code>suggest</code>? Personally, I find myself using <code>library_search</code> a lot, and not so much <code>suggest</code>. Just in the general situation of, hmmm this seems like it could be a lemma in mathlib but I don't know if it is exactly. I'm wondering if it were possible to speed up or improve the depth of <code>library_search</code> if many people would use that. So I'm curious if:</p>
<ol>
<li>Most people just remember all the relevant lemmas</li>
<li>People use <code>library_search</code> a lot</li>
<li>People usually just look through the documentation for relevant lemmas</li>
<li>People use some other similar tactic that I'm not familiar with</li>
</ol>



<a name="213191520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213191520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213191520">(Oct 13 2020 at 17:44)</a>:</h4>
<p>Being familiar with the <a href="https://leanprover-community.github.io/contribute/naming.html">naming conventions</a> helps a lot with being able to guess enough of a name to get the Lean server's auto-complete to do the rest.</p>



<a name="213192629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213192629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213192629">(Oct 13 2020 at 17:53)</a>:</h4>
<p>I use <code>library_search</code> mostly in the middle of tactic proofs for little things which I know should (or at least ought to) be in mathlib.</p>



<a name="213192977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213192977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213192977">(Oct 13 2020 at 17:56)</a>:</h4>
<p>I don't think I've ever actually used <code>suggest</code>, but I know it's there.</p>



<a name="213195757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213195757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213195757">(Oct 13 2020 at 18:17)</a>:</h4>
<p>I rarely use <code>library_search</code> or <code>suggest</code>, since finding something by name or by guessing which file it should be in is often faster for me. The <code>Ctrl-T</code> search gets me what i want most of the time, and I use VSCode search otherwise. Sometimes I use the docs when I want to get an overview of a file.</p>
<p>Using <code>library_search</code> to find instance definitions can be a bit slow, so I just use <code>by show_term {apply_instance}</code> when I want to find the definition of an instance.</p>



<a name="213196813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213196813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213196813">(Oct 13 2020 at 18:25)</a>:</h4>
<p>Apart from regular <code>library_search</code> usage, I sometimes use <code>suggest</code> to see what related constructors might be present in the imported namespace</p>



<a name="213197070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213197070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213197070">(Oct 13 2020 at 18:27)</a>:</h4>
<p>ok, this is very enlightening for me as I was not considering vscode autocomplete as a logical tool for comparison, but that makes total sense now that you bring it up</p>



<a name="213197318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213197318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213197318">(Oct 13 2020 at 18:29)</a>:</h4>
<p>my takeaway is that <code>library_search</code> has some utility, but the latency is not competitive enough with vscode language features to supplant them</p>



<a name="213198370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213198370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213198370">(Oct 13 2020 at 18:36)</a>:</h4>
<p>An additional search mechanism I use (in VSCode) is use <code>suggest</code> or <code>library_search</code> to prove something related or simpler, then F12 to go to definition in the file of that newly found lemma, and read the lemmas and proofs to get a sense of what the API is. Which is more involved than just a doc search,  but a lot more informative for me.</p>



<a name="213204180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213204180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213204180">(Oct 13 2020 at 19:16)</a>:</h4>
<p>I use library search a lot, even in situations where I'm reasonably sure I can work out the name / order of arguments, or even in place of <code>assumption</code> quite often. If you dont have too many imports it can be quicker in my experience just to do that / less mental energy. <code>suggest</code> I use when I want to find a possible <code>rw</code> as well as things to apply, as the rewrite-able lemmas come up as <code>blah_iff_blah.mp</code>.</p>



<a name="213223321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213223321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213223321">(Oct 13 2020 at 22:11)</a>:</h4>
<p>Does anybody use the <code>library_search</code> "hole command"? I have not been able to get it to work, but I only found out about its existence from looking at the code, so I'm not sure if it's in general use</p>



<a name="213223593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213223593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213223593">(Oct 13 2020 at 22:13)</a>:</h4>
<p>Hole commands don't work in tactic mode, unfortunately.</p>



<a name="213223655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213223655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213223655">(Oct 13 2020 at 22:14)</a>:</h4>
<p>So you'd have to do something like <code>example : true := {! !}</code> and then try to trigger the whole command there.</p>



<a name="213223830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213223830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213223830">(Oct 13 2020 at 22:16)</a>:</h4>
<p>I got that far, but I haven't been able to get it to work outside tactic mode either. the <code>library_search</code> hole command at least seems to spit out some extra characters</p>



<a name="213223844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213223844" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213223844">(Oct 13 2020 at 22:16)</a>:</h4>
<p>but, it seems like it isn't generally what people are using anyway</p>



<a name="213224114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224114">(Oct 13 2020 at 22:20)</a>:</h4>
<p>Oh, you're right. There's a bug with the <code>library_search</code> hole command right now. </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span> <span class="o">{</span><span class="bp">!!</span><span class="o">}</span>
<span class="c1">-- triggering the hole command leads to:</span>
<span class="c1">-- example : true := is: exact trivial</span>
</code></pre></div>



<a name="213224253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224253">(Oct 13 2020 at 22:22)</a>:</h4>
<p>yeah i was just looking into this - i bet the string chopping here in <code>suggest.lean</code> is the problem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[hole_command]</span> <span class="kd">meta</span> <span class="kd">def</span> <span class="n">library_search_hole_cmd</span> <span class="o">:</span> <span class="n">hole_command</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="s2">"library_search"</span><span class="o">,</span>
  <span class="n">descr</span> <span class="o">:=</span> <span class="s2">"Use `library_search` to complete the goal."</span><span class="o">,</span>
  <span class="n">action</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="k">do</span>
    <span class="n">script</span> <span class="bp">←</span> <span class="n">library_search</span><span class="o">,</span>
    <span class="c1">-- Is there a better API for dropping the 'exact ' prefix on this string?</span>
    <span class="n">return</span> <span class="o">[((</span><span class="n">script.mk_iterator.remove</span> <span class="mi">6</span><span class="o">)</span><span class="bp">.</span><span class="n">to_string</span><span class="o">,</span> <span class="s2">"by library_search"</span><span class="o">)]</span> <span class="o">}</span>
</code></pre></div>



<a name="213224308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224308">(Oct 13 2020 at 22:22)</a>:</h4>
<p>do you know if lean tactic language has a way to split strings on a string match? or just like, typical string manipulation library stuff</p>



<a name="213224328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224328">(Oct 13 2020 at 22:23)</a>:</h4>
<p>Yep, I was about to make a PR.</p>



<a name="213224343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224343">(Oct 13 2020 at 22:23)</a>:</h4>
<p>ok cool go for it</p>



<a name="213224354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224354">(Oct 13 2020 at 22:23)</a>:</h4>
<p>Not off the top of my head, I was just going to change 6 to 16.</p>



<a name="213224360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224360">(Oct 13 2020 at 22:23)</a>:</h4>
<p>lol</p>



<a name="213224471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224471">(Oct 13 2020 at 22:24)</a>:</h4>
<p>everyone has all of these aesthetic principles when it comes to the mathematical proofs, but when it comes to splitting a string on a word, bah let's hard code in the length of the string prefix <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="213224588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224588">(Oct 13 2020 at 22:26)</a>:</h4>
<p>Hah. Well, I'm now digging around in the string API at the moment so there you go.</p>



<a name="213224605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224605">(Oct 13 2020 at 22:26)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/string.split">docs#string.split</a> ?</p>



<a name="213224620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224620">(Oct 13 2020 at 22:26)</a>:</h4>
<p>Splits on a character/character list it seems</p>



<a name="213224768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213224768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213224768">(Oct 13 2020 at 22:28)</a>:</h4>
<p><code>#eval "exact library_search".split (= ' ')</code></p>



<a name="213226967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213226967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213226967">(Oct 13 2020 at 22:49)</a>:</h4>
<p>I started working on splitting strings and decided it wasn't worth my time - but that's why there are now lemmas relating <a href="https://leanprover-community.github.io/mathlib_docs/find/list.inits">docs#list.inits</a> and <a href="https://leanprover-community.github.io/mathlib_docs/find/list.tails">docs#list.tails</a>.</p>



<a name="213228405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213228405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213228405">(Oct 13 2020 at 23:05)</a>:</h4>
<p>I ended up going with a <code>list</code> function instead. See <a href="https://github.com/leanprover-community/mathlib/issues/4609">#4609</a>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.list.defs</span>

<span class="kd">def</span> <span class="n">script</span> <span class="o">:=</span> <span class="s2">"Try this: exact trivial"</span>
<span class="kd">def</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">script.to_list</span>
<span class="k">#eval</span> <span class="o">((</span><span class="n">s.get_rest</span> <span class="s2">"Try this: exact "</span><span class="bp">.</span><span class="n">to_list</span><span class="o">)</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">as_string</span>
</code></pre></div>



<a name="213232176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213232176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213232176">(Oct 13 2020 at 23:58)</a>:</h4>
<p>Didn't see <a href="https://leanprover-community.github.io/mathlib_docs/find/list.get_rest">docs#list.get_rest</a>, that's not so bad</p>



<a name="213320173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213320173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213320173">(Oct 14 2020 at 16:57)</a>:</h4>
<p>Heh, I missed <a href="https://leanprover-community.github.io/mathlib_docs/find/string.get_rest">docs#string.get_rest</a> ... <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.list.defs</span>

<span class="kd">def</span> <span class="n">script</span> <span class="o">:=</span> <span class="s2">"Try this: exact trivial"</span>
<span class="k">#eval</span> <span class="o">(</span><span class="n">script.get_rest</span> <span class="s2">"Try this: exact "</span><span class="bp">.</span><span class="n">to_list</span><span class="o">)</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="n">script</span>
</code></pre></div>



<a name="213334609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213334609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213334609">(Oct 14 2020 at 18:46)</a>:</h4>
<p>I use <code>suggest</code> a lot, as it is faster than <code>library_search</code> and doesn't fail if it can't close the goal. There is also a tactic named <code>hint</code> if I am not mistaken, but I seldom use it.</p>



<a name="213356279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213356279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213356279">(Oct 14 2020 at 22:06)</a>:</h4>
<p><code>hint</code> is completely different: it just tries a list of popular tactics and tells you if any close the goal, and if none do it tells you which ones "make progress".</p>



<a name="213356309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213356309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213356309">(Oct 14 2020 at 22:07)</a>:</h4>
<p><code>library_search</code> could likely be made a <em>lot</em> faster with some attention from a good meta-programmer.</p>



<a name="213356363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213356363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213356363">(Oct 14 2020 at 22:07)</a>:</h4>
<p>The basic balance is between just relying on the fact that Leo made <code>apply</code> (i.e. unification) <em>really</em> fast, and so just try all the lemmas, vs doing some amount of analysis of the current goal and only applying a subset of the lemmas.</p>



<a name="213356439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213356439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213356439">(Oct 14 2020 at 22:08)</a>:</h4>
<p>Currently we look at the head symbol of the goal, and filter the lemmas by that (after a bit of munging, to handle things like <code>&gt;</code> vs <code>&lt;</code>).</p>



<a name="213356448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213356448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213356448">(Oct 14 2020 at 22:08)</a>:</h4>
<p>Perhaps there is scope for more caching here?</p>



<a name="213356574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213356574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213356574">(Oct 14 2020 at 22:10)</a>:</h4>
<p><code>library_search</code> tends to be extra slow with <code>=</code> goals, because unsurprisingly there are a great many lemmas that talk about <code>=</code>, and so <code>library_search</code> tries them all with <code>apply</code>, even if the types are wrong. Now unification is smart and so most of these fail very fast --- perhaps so fast that any amount of filtering in <code>meta</code> code is actually going to be a slow down. But it's not completely clear to me; particularly if someone can think up a good way to cache tables of lemmas.</p>



<a name="213357771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213357771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213357771">(Oct 14 2020 at 22:25)</a>:</h4>
<p>yeah, I was looking through it to profile it and see which parts are slow. I cannot currently claim to be "a good meta-programmer" though ;-) it seems like more time is being spent in <code>solve_by_elim</code> than in <code>apply</code> but they are both significant and it probably depends a lot on context.</p>



<a name="213358132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213358132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213358132">(Oct 14 2020 at 22:29)</a>:</h4>
<p>is <code>apply</code> fast because it's basically a wrapper around <code>apply_core</code> which is in c++? I think someone mentioned that lean 4 might allow c++ extensions, which might be nice for something like a tree search</p>



<a name="213358313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213358313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213358313">(Oct 14 2020 at 22:31)</a>:</h4>
<p>when a <code>library_search</code> is doing a million object allocations, it kind of seems like the most obvious performance thing is to push more of the logic into c++.</p>



<a name="213360248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213360248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213360248">(Oct 14 2020 at 22:52)</a>:</h4>
<p>Nowadays, the most common way that I search through mathlib is using the Search function of mathlib docs. It just searches through the names of theorems, so you need to know the naming convention a bit for it to use it well, but its fuzzy matching is really good. For example if I search<br>
<a href="https://leanprover-community.github.io/mathlib_docs/find/continuous_implies_measurable">https://leanprover-community.github.io/mathlib_docs/find/continuous_implies_measurable</a><br>
I get <a href="https://leanprover-community.github.io/mathlib_docs/find/continuous.measurable">docs#continuous.measurable</a> as third result. A common strategy is that if I want a theorem that involves both <code>foo</code> and <code>bar</code> I just search for <code>foo_bar</code> using this serach function. For example <a href="https://leanprover-community.github.io/mathlib_docs/find/tendsto_comp">https://leanprover-community.github.io/mathlib_docs/find/tendsto_comp</a> gives <a href="https://leanprover-community.github.io/mathlib_docs/find/filter.tendsto.comp">docs#filter.tendsto.comp</a> (after some other suggestions).<br>
In Chrome you can add <code>http://leanprover-community.github.io/mathlib_docs/find/%s</code> as search engine, with a keyword. In my case I just have to type <code>ml tendsto_comp</code> in the search bar to do the above search.</p>
<p>The other way I search is the regular search (<code>ctrl+F</code>) or search through all files (<code>ctrl+shift+F</code>) in VSCode.<br>
I don't know how well these strategies translate to tips to beginners/intermediate users, because they probably work less well if you don't know the naming scheme well.</p>



<a name="213365221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213365221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Pedro Minicz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213365221">(Oct 14 2020 at 23:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="238605">Kevin Lacker</span> <a href="#narrow/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb/near/213358313">said</a>:</p>
<blockquote>
<p>when a <code>library_search</code> is doing a million object allocations, it kind of seems like the most obvious performance thing is to push more of the logic into c++.</p>
</blockquote>
<p>I haven't written C++ in years and don't plan to break my streak, but I would love a fastar <code>library_search</code>!</p>



<a name="213373922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213373922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213373922">(Oct 15 2020 at 02:28)</a>:</h4>
<p>I'd be curious to see examples where <code>solve_by_elim</code> is taking the majority of the time. This means that <em>many</em> lemmas are successfully unifying with the goal, and so there are then many calls to <code>solve_by_elim</code> to "clean up the mess", i.e. enforce that all new goals can be solved from existing hypotheses.</p>



<a name="213373941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213373941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213373941">(Oct 15 2020 at 02:28)</a>:</h4>
<p>It may be there are good heuristics for avoiding calling solve_by_elim (or just using <code>assumption</code>)</p>



<a name="213373947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213373947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213373947">(Oct 15 2020 at 02:28)</a>:</h4>
<p>I had always assumed it was being called infrequently enough this wasn't worth optimising.</p>



<a name="213374140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213374140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213374140">(Oct 15 2020 at 02:33)</a>:</h4>
<p>Also, if we had easier support for parallelism, <code>library_search</code> is embarrassingly parallelizable.</p>



<a name="213451300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213451300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213451300">(Oct 15 2020 at 16:27)</a>:</h4>
<p>here's an example i was profiling:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.nat.basic</span>

<span class="kd">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="c1">-- set_option trace.suggest true</span>

<span class="kd">lemma</span> <span class="n">foo</span> <span class="o">{</span><span class="n">j</span> <span class="n">k</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">h3</span> <span class="o">:</span> <span class="n">j</span> <span class="bp">≠</span> <span class="n">k</span><span class="o">)</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">*</span> <span class="n">j</span> <span class="bp">≥</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">library_search</span>
</code></pre></div>



<a name="213451469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213451469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213451469">(Oct 15 2020 at 16:29)</a>:</h4>
<p>47% of the time is in solve_by_elim, 36% spent in the apply that's called directly from <code>suggest.lean</code></p>



<a name="213451526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213451526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213451526">(Oct 15 2020 at 16:29)</a>:</h4>
<p>it's a bit tricky to measure because <code>solve_by_elim</code> itself calls apply - do you know if the profiler is capable of outputting tree-style profiles? - but i mucked around renaming things to separate them out</p>



<a name="213451685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213451685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213451685">(Oct 15 2020 at 16:30)</a>:</h4>
<p>parallelism is a good point - are there any mechanisms for spawning a thread or similar things in lean?</p>



<a name="213518578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/mechanisms%20to%20search%20through%20mathlilb/near/213518578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/mechanisms.20to.20search.20through.20mathlilb.html#213518578">(Oct 16 2020 at 04:49)</a>:</h4>
<p>I guess <code>io.cmd</code> <em>sort</em> of lets you do parallelism, but it seems kinda terrible to do that</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>