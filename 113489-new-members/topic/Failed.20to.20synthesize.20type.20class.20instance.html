---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html">Failed to synthesize type class instance</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="197186829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197186829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197186829">(May 11 2020 at 18:39)</a>:</h4>
<p>Defining the set of all powers of p dividing n:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">times_p</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">pos</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">p</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat</span> <span class="err">↪</span> <span class="n">nat</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">i</span> <span class="bp">*</span> <span class="n">p</span><span class="o">,</span>
  <span class="n">inj</span> <span class="o">:=</span> <span class="k">begin</span> <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">prod</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="n">prod</span><span class="o">,</span> <span class="n">exact</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">mul_right_inj</span> <span class="n">pos</span><span class="o">)</span><span class="bp">.</span><span class="n">mp</span> <span class="n">prod</span><span class="o">,</span> <span class="kn">end</span>
<span class="o">}</span>

<span class="n">def</span> <span class="n">powers_dividing</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">prime</span> <span class="n">p</span><span class="o">],</span> <span class="n">finset</span> <span class="n">nat</span>
<span class="bp">|</span> <span class="n">n</span> <span class="n">p</span> <span class="n">is_prime</span> <span class="o">:=</span> <span class="k">have</span> <span class="n">n</span> <span class="bp">/</span> <span class="n">p</span> <span class="bp">&lt;</span> <span class="n">n</span><span class="o">,</span> <span class="k">from</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="k">if</span> <span class="n">p</span> <span class="err">∣</span> <span class="n">n</span> <span class="k">then</span>
    <span class="n">insert</span> <span class="mi">1</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">times_p</span> <span class="n">p</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">prime</span><span class="bp">.</span><span class="n">pos</span> <span class="n">is_prime</span><span class="o">))</span> <span class="o">(</span><span class="n">powers_dividing</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/</span> <span class="n">p</span><span class="o">)</span> <span class="n">p</span> <span class="n">is_prime</span><span class="o">))</span>
  <span class="k">else</span>
    <span class="n">finset</span><span class="bp">.</span><span class="n">singleton</span> <span class="mi">1</span>
</code></pre></div>


<p>But Lean fails at the recursive call to <code>powers_dividing</code> to synthesise the type class instance that results in <code>nat.prime p</code>, even though it's right there in scope, it's <code>is_prime</code>. Can I tell it any harder to use <code>is_prime</code>?</p>



<a name="197186916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197186916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197186916">(May 11 2020 at 18:40)</a>:</h4>
<p>Actually now I type this, I realise I can probably look at the Sylow theorems to find something like this</p>



<a name="197187179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187179">(May 11 2020 at 18:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="117987">Patrick Stevens</span> <a href="#narrow/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance/near/197186829">said</a>:</p>
<blockquote>
<p>Can I tell it any harder to use <code>is_prime</code>?</p>
</blockquote>
<p>Yes, several ways</p>



<a name="197187270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187270">(May 11 2020 at 18:43)</a>:</h4>
<p>But the easiest is to move the <code>(p) [nat.prime p]</code> left of the colon</p>



<a name="197187284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187284">(May 11 2020 at 18:43)</a>:</h4>
<p>since it doesn't seem to be changing anyways</p>



<a name="197187411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187411">(May 11 2020 at 18:44)</a>:</h4>
<p>Stuff like <code>[nat.prime p]</code> to the right of the colon is not added to the typeclass database.</p>



<a name="197187476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187476">(May 11 2020 at 18:45)</a>:</h4>
<p>The <code>[]</code> only affects how somebody calls your function and not what is available for instance search.</p>



<a name="197187512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187512">(May 11 2020 at 18:45)</a>:</h4>
<p>Ah, of course - thanks</p>



<a name="197187518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187518">(May 11 2020 at 18:45)</a>:</h4>
<p><code>def powers_dividing (n : nat) (p : nat) [nat.prime p] : finset nat := ...</code></p>



<a name="197187627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187627">(May 11 2020 at 18:46)</a>:</h4>
<p>In this case I do need things on the right of the colon, because I need to recurse, I think - but I can certainly move the prime bits over</p>



<a name="197187663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187663">(May 11 2020 at 18:46)</a>:</h4>
<p>If you're really committed to this order of function arguments, then there are other options</p>



<a name="197187723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187723">(May 11 2020 at 18:46)</a>:</h4>
<p>My next question was "suppose I do need to change <code>p</code> as I go, what do I do then", which  comes under the same banner</p>



<a name="197187746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187746">(May 11 2020 at 18:47)</a>:</h4>
<p>You can use <code>letI</code> and <code>haveI</code>  to register instances</p>



<a name="197187755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187755">(May 11 2020 at 18:47)</a>:</h4>
<p>But <code>def powers_dividing (p : nat) [is_prime : nat.prime p] : nat → finset nat</code> is perfect for my current function</p>



<a name="197187760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187760">(May 11 2020 at 18:47)</a>:</h4>
<p><code>by exactI</code> is one (this will make all local variables available as instances), otherwise <code>@</code> can help you out</p>



<a name="197187775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Stevens <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187775">(May 11 2020 at 18:47)</a>:</h4>
<p>Thanks!</p>



<a name="197187925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/197187925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#197187925">(May 11 2020 at 18:48)</a>:</h4>
<p>I assume <code>@</code> also works with recursive calls although I'm not sure I ever tried it.</p>



<a name="201133985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201133985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201133985">(Jun 17 2020 at 12:32)</a>:</h4>
<p>Hi - I'm using the <code>instance</code> keyword for the first time, and don't really understand what the error message is telling me. My #mve is</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">group_theory</span><span class="bp">.</span><span class="n">subgroup</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">pi_instances</span>

<span class="n">def</span> <span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">g</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span> <span class="bp">|</span> <span class="n">g</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">snd</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="n">subgroup_</span><span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨</span> <span class="k">begin</span>
    <span class="n">simp_rw</span> <span class="n">prod</span><span class="bp">.</span><span class="k">forall</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">prod</span><span class="bp">.</span><span class="n">inv_mk</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">h</span><span class="o">,</span>
    <span class="n">rw</span> <span class="err">Δ</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
    <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
    <span class="n">exact</span> <span class="n">h</span><span class="o">,</span>
<span class="kn">end</span> <span class="bp">⟩</span>
</code></pre></div>


<p>which gives</p>
<div class="codehilite"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">synthesize</span> <span class="n">type</span> <span class="n">class</span> <span class="kn">instance</span> <span class="n">for</span>
<span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="err">?</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">group</span> <span class="n">G</span>
<span class="err">⊢</span> <span class="n">is_submonoid</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span>
</code></pre></div>


<p>I can't work out what I'm being asked to add here. Could you show me where to insert a <code>sorry</code> to make the error go away, so that I can work out what I'm supposed to do?</p>



<a name="201134625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201134625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201134625">(Jun 17 2020 at 12:39)</a>:</h4>
<p>I think is_subgroup might be deprecated, and I don't use it, but if it's a class then after := you might want to type <code>{! !}</code>, click on the bulb, select the bottom but one option (the one about structures) and see what lean wants you to prove</p>



<a name="201134757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201134757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201134757">(Jun 17 2020 at 12:40)</a>:</h4>
<p>I think the correct thing to do nowadays though is to make a term of type <code>subgroup (G \times G)</code> with Delta as the carrier</p>



<a name="201136111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201136111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201136111">(Jun 17 2020 at 12:52)</a>:</h4>
<p>Is <code>{!</code> equivalent to a unicode character?</p>



<a name="201136160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201136160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201136160">(Jun 17 2020 at 12:53)</a>:</h4>
<p>no</p>



<a name="201136200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201136200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201136200">(Jun 17 2020 at 12:53)</a>:</h4>
<p>Just tried it out - that was super helpful, thanks @kbuzzard!</p>



<a name="201136305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201136305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jalex Stark <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201136305">(Jun 17 2020 at 12:54)</a>:</h4>
<p><code>suggest</code> should also give you the the thing that <code>{! !}</code> gives you, in addition to lemmas that let you do the construction with fewer arguments</p>



<a name="201136321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201136321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201136321">(Jun 17 2020 at 12:55)</a>:</h4>
<p>If you have a super recent Lean (maybe even too recent for mathlib? not sure) then I hear you can use <code>_</code> in place of this <code>{! !}</code> thing.</p>



<a name="201137349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201137349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201137349">(Jun 17 2020 at 13:03)</a>:</h4>
<p>A follow-up question - given my definition of <code>subgroup_Δ</code> above, how can I construct a <code>normal_subgroup</code>? Do I have to copy the fields over elementwise?</p>



<a name="201137470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201137470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201137470">(Jun 17 2020 at 13:04)</a>:</h4>
<p>I think Yury bundled normal_subgroup recently so you might want to look at any constructors he made for that</p>



<a name="201137657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201137657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201137657">(Jun 17 2020 at 13:06)</a>:</h4>
<p>Here's what I'm trying that is giving me a type mismatch:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">normal_</span><span class="err">Δ</span><span class="bp">_</span><span class="n">iff_comm</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">normal_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">g</span> <span class="bp">*</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">h</span> <span class="bp">*</span> <span class="n">g</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span>
        <span class="n">sorry</span>
    <span class="o">},</span>
    <span class="o">{</span>
        <span class="n">intro</span> <span class="n">h_comm</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">j</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">),</span> <span class="n">n</span> <span class="err">∈</span> <span class="err">Δ</span> <span class="n">G</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">),</span> <span class="n">g</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">g</span><span class="bp">⁻¹</span> <span class="err">∈</span> <span class="err">Δ</span> <span class="n">G</span> <span class="o">:=</span> <span class="k">by</span> <span class="o">{</span>
            <span class="n">sorry</span>
        <span class="o">},</span>
        <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="n">is_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="n">subgroup_</span><span class="err">Δ</span> <span class="n">G</span><span class="o">,</span>
        <span class="n">exact</span> <span class="o">{</span> <span class="n">one_mem</span> <span class="o">:=</span> <span class="n">h</span><span class="bp">.</span><span class="n">one_mem</span><span class="o">,</span>
                <span class="n">mul_mem</span> <span class="o">:=</span> <span class="n">h</span><span class="bp">.</span><span class="n">mul_mem</span><span class="o">,</span>
                <span class="n">inv_mem</span> <span class="o">:=</span> <span class="n">h</span><span class="bp">.</span><span class="n">inv_mem</span><span class="o">,</span>
                <span class="n">normal</span> <span class="o">:=</span> <span class="n">j</span> <span class="o">},</span>
    <span class="o">}</span>

<span class="kn">end</span>
</code></pre></div>



<a name="201137712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201137712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201137712">(Jun 17 2020 at 13:06)</a>:</h4>
<p>It seems unhappy with the <code>have h :</code> line.</p>



<a name="201139764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201139764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201139764">(Jun 17 2020 at 13:24)</a>:</h4>
<p>I think begin/end is a bad way to make terms of a structure</p>



<a name="201139884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201139884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201139884">(Jun 17 2020 at 13:25)</a>:</h4>
<p>Right, but the structure here is a term in a larger proof</p>



<a name="201139897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201139897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201139897">(Jun 17 2020 at 13:25)</a>:</h4>
<p>Oh I see you're doing something else. I'm not at lean right now. I would look at the definition of normal subgroup in the library and find the constructor you need</p>



<a name="201140448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201140448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201140448">(Jun 17 2020 at 13:29)</a>:</h4>
<p>I think my issue now is less that my piecewise constructor is ugly, and more that I can't work out how to leverage my previous <code>subgroup_Δ</code> <code>instance</code>.</p>



<a name="201140646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201140646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201140646">(Jun 17 2020 at 13:30)</a>:</h4>
<p>Did you fix that instance? Earlier Lean was complaining.</p>



<a name="201140679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201140679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201140679">(Jun 17 2020 at 13:31)</a>:</h4>
<p>Yes, I fixed that.</p>



<a name="201140698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201140698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201140698">(Jun 17 2020 at 13:31)</a>:</h4>
<p>But we can pretend it's just implemented as <code>sorry</code>, right?</p>



<a name="201140752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201140752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201140752">(Jun 17 2020 at 13:31)</a>:</h4>
<p>Well, something appears to be introducing an extra universe parameter</p>



<a name="201140942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201140942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201140942">(Jun 17 2020 at 13:33)</a>:</h4>
<p>Oh, you're right. Replacing my instance delcaration with <code>sorry</code> makes the error go away</p>



<a name="201141144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201141144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201141144">(Jun 17 2020 at 13:34)</a>:</h4>
<p>so, it sounds like the issue is in code you haven't shown us <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="201141378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201141378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201141378">(Jun 17 2020 at 13:36)</a>:</h4>
<p>Indeed. Here's the reduced case:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="n">subgroup_</span><span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">one_mem</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">mul_mem</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">simp_rw</span> <span class="n">prod</span><span class="bp">.</span><span class="k">forall</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span>
    <span class="n">simp_rw</span> <span class="n">prod</span><span class="bp">.</span><span class="k">forall</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">c</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">hab</span> <span class="n">hcd</span><span class="o">,</span>
    <span class="c1">-- rw prod.mk_mul_mk,</span>
    <span class="n">sorry</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">inv_mem</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
<span class="bp">#</span><span class="kn">check</span> <span class="n">subgroup_</span><span class="err">Δ</span>
</code></pre></div>


<p>Uncommenting that  commented line introduces the unwanted universe parameter</p>



<a name="201141741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201141741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201141741">(Jun 17 2020 at 13:39)</a>:</h4>
<p>It looks like <code>prod.mk_mul_mk</code> is not inferring the type arguments in the way I want. Passing <code>G G</code> explicitly solves it.</p>



<a name="201141754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201141754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201141754">(Jun 17 2020 at 13:39)</a>:</h4>
<p>I don't know what's going on but combining your snippets doesn't work for me.</p>



<a name="201141876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201141876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201141876">(Jun 17 2020 at 13:40)</a>:</h4>
<p>Let me try and reduce the whole thing to just the bit that can't infer arguments to <code>mk_mul_mk</code></p>



<a name="201141992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201141992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201141992">(Jun 17 2020 at 13:41)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a></p>



<a name="201142060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201142060" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201142060">(Jun 17 2020 at 13:41)</a>:</h4>
<p>Indeed</p>



<a name="201143783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201143783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201143783">(Jun 17 2020 at 13:54)</a>:</h4>
<p>ok I seem to have found the issue, and it is a real issue that needs fixing; let me gather my thoughts</p>



<a name="201143861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201143861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201143861">(Jun 17 2020 at 13:55)</a>:</h4>
<p>Wonderful, thanks. I got distracted fighting with an outdated lean on codewars which does not consider <code>∈</code> and <code>set.mem</code> as equivalent...</p>



<a name="201144573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201144573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201144573">(Jun 17 2020 at 14:00)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">group_theory</span><span class="bp">.</span><span class="n">subgroup</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">pi_instances</span>

<span class="n">def</span> <span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">g</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span> <span class="bp">|</span> <span class="n">g</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">snd</span> <span class="o">}</span>
<span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">universes</span> <span class="n">true</span>
<span class="kn">instance</span> <span class="n">is_subgroup_</span><span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">one_mem</span> <span class="o">:=</span> <span class="n">rfl</span><span class="o">,</span>
  <span class="n">mul_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span> <span class="n">hp</span> <span class="n">hq</span><span class="o">,</span> <span class="k">show</span> <span class="n">p</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">q</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">p</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">q</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="k">by</span> <span class="n">congr&#39;</span><span class="o">,</span>
  <span class="n">inv_mem</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">simp_rw</span> <span class="n">prod</span><span class="bp">.</span><span class="k">forall</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="c1">-- (a, b) ∈ Δ.{?l_1} G → (a, b)⁻¹ ∈ Δ.{?l_1} G</span>
    <span class="n">rw</span> <span class="n">prod</span><span class="bp">.</span><span class="n">inv_mk</span><span class="o">,</span> <span class="c1">-- (a, b) ∈ Δ.{(max ?l_1 ?l_2)} G → (a⁻¹, b⁻¹) ∈ Δ.{(max ?l_1 ?l_2)} G</span>
    <span class="c1">-- intros h,</span>
    <span class="c1">-- rw Δ at *,</span>
    <span class="c1">-- simp at *,</span>
    <span class="c1">-- exact h,</span>
    <span class="n">sorry</span>
<span class="kn">end</span> <span class="o">}</span>
<span class="bp">#</span><span class="kn">check</span> <span class="bp">@</span><span class="n">prod</span><span class="bp">.</span><span class="n">inv_mk</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">prod.inv_mk.{u_1 u_2} :</span>
<span class="cm">  ∀ {G : Type u_1} {H : Type u_2} [_inst_1 : has_inv.{u_1} G] [_inst_2 : has_inv.{u_2} H] (a : G) (b : H),</span>
<span class="cm">    (a, b)⁻¹ = (a⁻¹, b⁻¹)</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="201144589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201144589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201144589">(Jun 17 2020 at 14:00)</a>:</h4>
<p>somehow <code>rw prod.inv_mk</code> brought into existence a new universe variable</p>



<a name="201144627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201144627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201144627">(Jun 17 2020 at 14:01)</a>:</h4>
<p>(it is noteworthy that avoiding <code>Type*</code> and using explicit universe variables avoids the problem completely</p>



<a name="201144696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201144696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201144696">(Jun 17 2020 at 14:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="201144862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201144862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201144862">(Jun 17 2020 at 14:02)</a>:</h4>
<p>Oh right, so one perhaps surprising thing is that <code>instance</code> is treated as a <code>def</code> even when (as here) we're proving a <code>Prop</code>; and this means that the body is used to elaborate the statement</p>



<a name="201144944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201144944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201144944">(Jun 17 2020 at 14:03)</a>:</h4>
<p>and <code>Type*</code> makes no claim about the universe level</p>



<a name="201145132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201145132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kenny Lau <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201145132">(Jun 17 2020 at 14:04)</a>:</h4>
<p>for the time being OP can use this (use <code>haveI</code> for instances instead of <code>have</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">group_theory</span><span class="bp">.</span><span class="n">subgroup</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">pi_instances</span>

<span class="n">def</span> <span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">g</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span> <span class="bp">|</span> <span class="n">g</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">snd</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="n">is_subgroup_</span><span class="err">Δ</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">one_mem</span> <span class="o">:=</span> <span class="n">rfl</span><span class="o">,</span>
  <span class="n">mul_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span> <span class="n">hp</span> <span class="n">hq</span><span class="o">,</span> <span class="k">show</span> <span class="n">p</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">q</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">p</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">q</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="k">by</span> <span class="n">congr&#39;</span><span class="o">,</span>
  <span class="n">inv_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">hp</span><span class="o">,</span> <span class="k">show</span> <span class="n">p</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">p</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="k">by</span> <span class="n">congr&#39;</span> <span class="o">}</span>

<span class="kn">theorem</span> <span class="n">normal_</span><span class="err">Δ</span><span class="bp">_</span><span class="n">iff_comm</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">:</span> <span class="n">normal_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="n">g</span> <span class="n">h</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">g</span> <span class="bp">*</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">h</span> <span class="bp">*</span> <span class="n">g</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="n">split</span><span class="o">,</span>
    <span class="o">{</span>
        <span class="n">sorry</span>
    <span class="o">},</span>
    <span class="o">{</span>
        <span class="n">intro</span> <span class="n">h_comm</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">j</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">),</span> <span class="n">n</span> <span class="err">∈</span> <span class="err">Δ</span> <span class="n">G</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">×</span> <span class="n">G</span><span class="o">),</span> <span class="n">g</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">g</span><span class="bp">⁻¹</span> <span class="err">∈</span> <span class="err">Δ</span> <span class="n">G</span> <span class="o">:=</span> <span class="k">by</span> <span class="o">{</span>
            <span class="n">sorry</span>
        <span class="o">},</span>
        <span class="n">haveI</span> <span class="n">h</span> <span class="o">:</span> <span class="n">is_subgroup</span> <span class="o">(</span><span class="err">Δ</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="n">is_subgroup_</span><span class="err">Δ</span> <span class="n">G</span><span class="o">,</span>
        <span class="n">exact</span> <span class="o">{</span> <span class="n">normal</span> <span class="o">:=</span> <span class="n">j</span> <span class="o">},</span>
    <span class="o">}</span>

<span class="kn">end</span>
</code></pre></div>



<a name="201145227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201145227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201145227">(Jun 17 2020 at 14:05)</a>:</h4>
<p><code>Type*</code> is asking for trouble really</p>



<a name="201145295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201145295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201145295">(Jun 17 2020 at 14:05)</a>:</h4>
<p>Note that the definition of Δ came from <a href="https://www.codewars.com/kata/5eb806b4e7c54e00246f70e1">https://www.codewars.com/kata/5eb806b4e7c54e00246f70e1</a></p>



<a name="201145847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201145847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201145847">(Jun 17 2020 at 14:09)</a>:</h4>
<p>I think using <code>Type*</code> in top-level <code>variables</code> should be "safe", although it probably won't be in Lean 4 from what I hear</p>



<a name="201146453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201146453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201146453">(Jun 17 2020 at 14:13)</a>:</h4>
<p>Indeed, if you move <code>(G : Type*)</code> from <code>instance is_subgroup_Δ</code> to a top-level <code>variables</code>, then the extra universes disappear.</p>



<a name="201147075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201147075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201147075">(Jun 17 2020 at 14:17)</a>:</h4>
<p>That said, the behavior Kenny showed also looks quite odd to me.</p>



<a name="201147291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201147291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201147291">(Jun 17 2020 at 14:19)</a>:</h4>
<p>Oh, here's another thing I don't understand. If you put your cursor on the <code>prod.inv_mk</code> at the end of Kenny's file, it displays</p>
<div class="codehilite"><pre><span></span><code><span class="n">prod</span><span class="bp">.</span><span class="n">inv_mk</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_3</span><span class="o">}</span> <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_4</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">has_inv</span><span class="bp">.</span><span class="o">{</span><span class="n">u_3</span><span class="o">}</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">has_inv</span><span class="bp">.</span><span class="o">{</span><span class="n">u_4</span><span class="o">}</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">H</span><span class="o">),</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="n">b</span><span class="bp">⁻¹</span><span class="o">)</span>
</code></pre></div>


<p>but the one in the line <code>rw prod.inv_mk</code> gives</p>
<div class="codehilite"><pre><span></span><code><span class="n">prod</span><span class="bp">.</span><span class="n">inv_mk</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">G</span> <span class="n">H</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u_1</span> <span class="n">u_2</span><span class="o">)}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">has_inv</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u_1</span> <span class="n">u_2</span><span class="o">)}</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">has_inv</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u_1</span> <span class="n">u_2</span><span class="o">)}</span> <span class="n">H</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">H</span><span class="o">),</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">,</span> <span class="n">b</span><span class="bp">⁻¹</span><span class="o">)</span>
</code></pre></div>



<a name="201148050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201148050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201148050">(Jun 17 2020 at 14:24)</a>:</h4>
<p>this is actually two things I don't understand, namely?</p>
<ul>
<li>why doesn't Lean just always show me the type of the declaration <code>prod.inv_mk</code>? what kind of local processing does it do?</li>
<li>how did it arrive at this idea of using the universe <code>max u_1 u_2</code>, but not unifying <code>G</code> and <code>H</code> or <code>u_1</code> and <code>u_2</code>?</li>
</ul>



<a name="201261634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201261634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Donald Sebastian Leung <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201261634">(Jun 18 2020 at 12:40)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> Note that you can request for the latest Lean version <a href="https://github.com/codewars/codewars-runner-cli/issues/new?template=request-language-version.md">over at Codewars/codewars-runner-cli</a></p>



<a name="201262876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/201262876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Donald Sebastian Leung <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#201262876">(Jun 18 2020 at 12:52)</a>:</h4>
<p>BTW we have a <a class="stream" data-stream-id="238266" href="/#narrow/stream/238266-Codewars">#Codewars</a> stream for Codewars-specific questions, if you'd like to take a look. I also created a topic there on upgrading Lean on Codewars to the latest version.</p>



<a name="282766274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Failed%20to%20synthesize%20type%20class%20instance/near/282766274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xavier Roblot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Failed.20to.20synthesize.20type.20class.20instance.html#282766274">(May 18 2022 at 10:11)</a>:</h4>
<p>In my quest to learn Lean, I am trying to prove a result from one of my papers. Here is an excerpt of the proof :</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">group_theory.p_group</span>
<span class="kn">import</span> <span class="n">group_theory.subgroup.basic</span>
<span class="kn">import</span> <span class="n">group_theory.quotient_group</span>

<span class="kd">universes</span> <span class="n">u</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">nontrivial</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">G</span><span class="o">]</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">[</span><span class="n">hp</span> <span class="o">:</span> <span class="n">fact</span> <span class="o">(</span><span class="n">nat.prime</span> <span class="n">p</span><span class="o">)]</span>
<span class="kn">include</span> <span class="n">hp</span>

<span class="kd">lemma</span> <span class="n">lemma1</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">is_p_group</span> <span class="n">p</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">G</span> <span class="bp">≠</span> <span class="n">subgroup.center</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">s</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="bp">∉</span> <span class="n">subgroup.center</span> <span class="n">G</span><span class="o">)</span> <span class="bp">∧</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">g</span> <span class="o">:</span> <span class="n">G</span><span class="o">,</span> <span class="n">s</span><span class="bp">*</span><span class="n">g</span><span class="bp">*</span><span class="n">s</span><span class="bp">⁻¹*</span><span class="n">g</span><span class="bp">⁻¹</span> <span class="bp">∈</span> <span class="n">subgroup.center</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">let</span> <span class="n">Z</span> <span class="o">:=</span> <span class="n">subgroup.center</span> <span class="n">G</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">Q</span> <span class="o">:=</span> <span class="n">G</span> <span class="bp">⧸</span> <span class="n">Z</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">t₀</span> <span class="o">:</span> <span class="n">is_p_group</span> <span class="n">p</span> <span class="n">Q</span><span class="o">,</span> <span class="k">from</span> <span class="n">is_p_group.to_quotient</span> <span class="n">h₁</span> <span class="n">Z</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">ZQ</span> <span class="o">:=</span> <span class="n">subgroup.center</span> <span class="n">Q</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">tt</span> <span class="o">:</span> <span class="n">nontrivial</span> <span class="n">Q</span><span class="o">,</span> <span class="k">from</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">rr</span> <span class="o">:</span> <span class="n">fintype</span> <span class="n">Q</span><span class="o">,</span> <span class="k">from</span> <span class="gr">sorry</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">nontrivial</span> <span class="o">(</span><span class="n">subgroup.center</span> <span class="n">G</span><span class="o">)</span> <span class="o">:=</span> <span class="n">is_p_group.center_nontrivial</span> <span class="n">h₁</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">zz</span> <span class="o">:</span> <span class="n">nontrivial</span> <span class="o">(</span><span class="n">subgroup.center</span> <span class="n">Q</span><span class="o">)</span> <span class="o">:=</span> <span class="n">is_p_group.center_nontrivial</span> <span class="n">t₀</span><span class="o">,</span>
  <span class="gr">sorry</span>
<span class="kd">end</span>
</code></pre></div>
<p>The first call to <code>is_p_group.center_nontrivial</code> works fine, but the second one yields an error : failed to synthesize type class instance</p>
<p>The problem seems to be that <code>nontrivial Q</code> is not proved, but I did prove it (well, admit it) just before. </p>
<p>What I am doing wrong?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>