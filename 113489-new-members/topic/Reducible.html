---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Reducible.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html">Reducible</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="245224486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245224486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245224486">(Jul 07 2021 at 18:42)</a>:</h4>
<p>If I introduce a type synonym with <code>@[reducible] def</code>, I know type class instances will lift from the underlying type to the type synonym, but is it true that instances declared on the type synonym will descend on the underlying type? I used to think not but in <a href="https://github.com/leanprover-community/mathlib/issues/7803">#7803</a> it seems instances are descending...</p>



<a name="245225741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245225741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245225741">(Jul 07 2021 at 18:50)</a>:</h4>
<p>It wouldn't surprise me if they descend. I thinkthat in practice it's better to write <code>@[derive [add_comm_group, topological_space]]</code> before a semireducible def.</p>



<a name="245229047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229047">(Jul 07 2021 at 19:17)</a>:</h4>
<p>Usually the whole point of a type synonym is to _not_ be reducible so that you can pick a different instance implementation</p>



<a name="245229520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229520">(Jul 07 2021 at 19:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245229047">said</a>:</p>
<blockquote>
<p>Usually the whole point of a type synonym is to _not_ be reducible so that you can pick a different instance implementation</p>
</blockquote>
<p>But then I'd need to rewrite a lot of instances: I need all the instances to lift and I whish there were a way to do so automatically</p>



<a name="245229549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229549">(Jul 07 2021 at 19:21)</a>:</h4>
<p>why do you need a synonym at all then?</p>



<a name="245229560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229560">(Jul 07 2021 at 19:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245225741">said</a>:</p>
<blockquote>
<p>It wouldn't surprise me if they descend. I thinkthat in practice it's better to write <code>@[derive [add_comm_group, topological_space]]</code> before a semireducible def.</p>
</blockquote>
<p>What is a semireducible def?</p>



<a name="245229611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229611">(Jul 07 2021 at 19:22)</a>:</h4>
<p>The default.</p>



<a name="245229672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229672">(Jul 07 2021 at 19:22)</a>:</h4>
<p>And hopefully the derive handler can take care of most of the instances in just 1 line.</p>



<a name="245229739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229739">(Jul 07 2021 at 19:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245229672">said</a>:</p>
<blockquote>
<p>And hopefully the derive handler can take care of most of the instances in just 1 line.</p>
</blockquote>
<p>Ok thanks do I need to list the ones I need or is there a way to get them all?</p>



<a name="245229837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229837">(Jul 07 2021 at 19:23)</a>:</h4>
<p>No, you need to list everything you need.</p>



<a name="245229849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229849">(Jul 07 2021 at 19:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245229549">said</a>:</p>
<blockquote>
<p>why do you need a synonym at all then?</p>
</blockquote>
<p>Because I need to declare instances that I do not want to descend: the type synonym I want is for a Pi type and if the instances descend then mathlib breaks</p>



<a name="245229935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229935">(Jul 07 2021 at 19:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245229837">said</a>:</p>
<blockquote>
<p>No, you need to list everything you need.</p>
</blockquote>
<p>Ok thanks</p>



<a name="245229951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229951">(Jul 07 2021 at 19:24)</a>:</h4>
<p>Can you use a regular Pi type with a local instance?</p>



<a name="245229993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245229993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245229993">(Jul 07 2021 at 19:25)</a>:</h4>
<p>So instead of <code>instance foobar</code> you write <code>def foobar</code> and then <code>local attribute [instance] foobar</code> below it.</p>



<a name="245230047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245230047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245230047">(Jul 07 2021 at 19:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245229951">said</a>:</p>
<blockquote>
<p>Can you use a regular Pi type with a local instance?</p>
</blockquote>
<p>No I need instances to be permanent: all this is for sections of vector bundles implemented with pi types, I need to do things once for all</p>



<a name="245230074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245230074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245230074">(Jul 07 2021 at 19:25)</a>:</h4>
<p>Right, I was unclear: type synonym are for when you want <em>some</em> instances to be different</p>



<a name="245230301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245230301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245230301">(Jul 07 2021 at 19:27)</a>:</h4>
<p>A good example in the library is <a href="https://leanprover-community.github.io/mathlib_docs/find/finsupp">docs#finsupp</a> vs <a href="https://leanprover-community.github.io/mathlib_docs/find/monoid_algebra">docs#monoid_algebra</a>, which have different choices of <code>*</code> but agree on<code>+</code></p>



<a name="245230332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245230332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245230332">(Jul 07 2021 at 19:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245230074">said</a>:</p>
<blockquote>
<p>Right, I was unclear: type synonym are for when you want <em>some</em> instances to be different</p>
</blockquote>
<p>Oh in this case I do not need instances to be different, I just need to add more instances that cannot be declared on generic pi types (and even if they could it would not makes sense to have them on generic pi types)</p>



<a name="245230405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245230405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245230405">(Jul 07 2021 at 19:28)</a>:</h4>
<p>What would you do in such case? I'm persuaded by Johan to use derive</p>



<a name="245231123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245231123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245231123">(Jul 07 2021 at 19:33)</a>:</h4>
<p><code>derive</code> is the best tool for the job when it works</p>



<a name="245231225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245231225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245231225">(Jul 07 2021 at 19:34)</a>:</h4>
<p>Sometimes you can't use it though; if your instance is something like "additionally, when the domain is a field provide this other instance" you have to add those instances by hand</p>



<a name="245231293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245231293" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245231293">(Jul 07 2021 at 19:35)</a>:</h4>
<p>See for instance <a href="https://leanprover-community.github.io/mathlib_docs/find/monoid_algebra.is_scalar_tower/src">src#monoid_algebra.is_scalar_tower</a> where the copy is manual</p>



<a name="245231975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245231975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245231975">(Jul 07 2021 at 19:40)</a>:</h4>
<p>Can you elaborate on what the instance is, and why it doesn't make sense to put it on generic pi types? (A line link to a PR is fine)</p>



<a name="245262941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245262941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245262941">(Jul 08 2021 at 01:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245231225">said</a>:</p>
<blockquote>
<p>Sometimes you can't use it though; if your instance is something like "additionally, when the domain is a field provide this other instance" you have to add those instances by hand</p>
</blockquote>
<p>Oh yes this is totally my case... I feel it will be a pain copying instances by hand</p>



<a name="245263062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245263062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245263062">(Jul 08 2021 at 01:18)</a>:</h4>
<p>This is the link <a href="https://github.com/leanprover-community/mathlib/pull/7803/files#r665803546">https://github.com/leanprover-community/mathlib/pull/7803/files#r665803546</a></p>



<a name="245263088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245263088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245263088">(Jul 08 2021 at 01:19)</a>:</h4>
<p>You can see all the problems it creates by checking the linter check on the same PR</p>



<a name="245263187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245263187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245263187">(Jul 08 2021 at 01:21)</a>:</h4>
<p>(since <code>bundle_section</code> is reducible, it changes nothing when the bare pi type is used instead)</p>



<a name="245263211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245263211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245263211">(Jul 08 2021 at 01:21)</a>:</h4>
<p>Let me know if you have ideas to solve the problem</p>



<a name="245278871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245278871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245278871">(Jul 08 2021 at 07:09)</a>:</h4>
<p>Do you really need a coercion there? Or would <code>.to_right_inv</code> be acceptable as a spelling instead?</p>



<a name="245279549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245279549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245279549">(Jul 08 2021 at 07:17)</a>:</h4>
<p>Ignoring instances for a moment, the statement seems quite weird - you're saying that for any <code>f</code>, <code> λ x, sigma.mk x (f x)</code> is a right inverse to <code>sigma.fst</code></p>



<a name="245295929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245295929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245295929">(Jul 08 2021 at 10:37)</a>:</h4>
<p>Yes I'd need a coercion. Basically I want sections for vector bundles to be recognized as sections for fiber bundles</p>



<a name="245296026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245296026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245296026">(Jul 08 2021 at 10:38)</a>:</h4>
<p>Why is the statement weird? It seems natural to me</p>



<a name="245301864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245301864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245301864">(Jul 08 2021 at 11:45)</a>:</h4>
<p>I've realized that the coercion you're after can be broken down into one that almost already exists (<a href="https://leanprover-community.github.io/mathlib_docs/find/lift_fn_range">docs#lift_fn_range</a>), and one that doesn't:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.lint</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
<span class="sd">/-- Should this be a `lift` instead? Or maybe this should work on a type alias of</span>
<span class="sd">`sigma`, which I think you have already. -/</span>
<span class="kd">instance</span> <span class="n">has_coe_to_sigma</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">)</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">sigma.mk</span> <span class="n">i</span><span class="o">⟩</span>

<span class="sd">/-- A dependent version of `lift_fn_range`. It's easy to argue this should exist,</span>
<span class="sd">but note it uses `has_lift` not `has_coe`, so the `↑` is required. -/</span>
<span class="kd">instance</span> <span class="n">lift_fn_range'</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>


<span class="c1">-- the coercion lean finds is the one you're asking for, it seems</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">sigma</span> <span class="n">A</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="245303177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303177">(Jul 08 2021 at 11:59)</a>:</h4>
<p>Is the only difference between <code>has_coe</code> and <code>has_lift</code> for <code>has_lift</code> you need to put the arrow yourself whereas for <code>has_coe</code> Lean does automatically?</p>



<a name="245303310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303310">(Jul 08 2021 at 12:00)</a>:</h4>
<p>Also I never understood what <code>has_lift_t</code> is, since "theorem proving in Lean" only says transitive closure which I do not know what it is...</p>



<a name="245303626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303626">(Jul 08 2021 at 12:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245301864">said</a>:</p>
<blockquote>
<p>I've realized that the coercion you're after can be broken down into one that almost already exists (<a href="https://leanprover-community.github.io/mathlib_docs/find/lift_fn_range">docs#lift_fn_range</a>), and one that doesn't:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.lint</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
<span class="sd">/-- Should this be a `lift` instead? Or maybe this should work on a type alias of</span>
<span class="sd">`sigma`, which I think you have already. -/</span>
<span class="kd">instance</span> <span class="n">has_coe_to_sigma</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">)</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">sigma.mk</span> <span class="n">i</span><span class="o">⟩</span>

<span class="sd">/-- A dependent version of `lift_fn_range`. It's easy to argue this should exist,</span>
<span class="sd">but note it uses `has_lift` not `has_coe`, so the `↑` is required. -/</span>
<span class="kd">instance</span> <span class="n">lift_fn_range'</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>


<span class="c1">-- the coercion lean finds is the one you're asking for, it seems</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">sigma</span> <span class="n">A</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div><br>
</p>
</blockquote>
<p>The first coercion here already exists (for the type Alias)</p>



<a name="245303646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303646">(Jul 08 2021 at 12:03)</a>:</h4>
<p>Looking at the instances for <a href="https://leanprover-community.github.io/mathlib_docs/find/has_coe_t">docs#has_coe_t</a> may help understand what transitivity means here</p>



<a name="245303720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303720">(Jul 08 2021 at 12:04)</a>:</h4>
<p>In particular, <a href="https://leanprover-community.github.io/mathlib_docs/find/coe_trans">docs#coe_trans</a> is the key</p>



<a name="245303827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303827">(Jul 08 2021 at 12:05)</a>:</h4>
<p>Which says "if A is convertible to B and B is <em>transitively</em> convertible to C, then A is transitively convertible to C"</p>



<a name="245303862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303862">(Jul 08 2021 at 12:05)</a>:</h4>
<p>The other half of this "induction" rule is <a href="https://leanprover-community.github.io/mathlib_docs/find/coe_base">docs#coe_base</a>, which says "if A is convertible to B then if A is transitively convertible to B"</p>



<a name="245303877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303877">(Jul 08 2021 at 12:05)</a>:</h4>
<p>What does transitively means?</p>



<a name="245303959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245303959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245303959">(Jul 08 2021 at 12:06)</a>:</h4>
<p>That definition is self-referencing, it means what it defines it to mean</p>



<a name="245304014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304014" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304014">(Jul 08 2021 at 12:07)</a>:</h4>
<p>Oh I see</p>



<a name="245304063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304063">(Jul 08 2021 at 12:07)</a>:</h4>
<p>That's not the whole picture, but it's hopefully enough to get an idea</p>



<a name="245304073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304073">(Jul 08 2021 at 12:07)</a>:</h4>
<p>So it is something that is just internal to Lean, the user should never declare <code>has_coe_t</code> themselves</p>



<a name="245304197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304197">(Jul 08 2021 at 12:08)</a>:</h4>
<p>No, you declare <code>has_coe_t</code> instead of <code>has_coe</code> if you don't want your coercion to take place anywhere but at the end of transitive coercions</p>



<a name="245304256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304256" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304256">(Jul 08 2021 at 12:09)</a>:</h4>
<p>for example, iirc, the ℕ → arbitrary semiring coe is defined as <code>has_coe_t</code></p>



<a name="245304262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304262">(Jul 08 2021 at 12:09)</a>:</h4>
<p>Either because otherwise the search would be too big (the linter will usually catch this), or because it doesn't make sense</p>



<a name="245304295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304295">(Jul 08 2021 at 12:10)</a>:</h4>
<p>There's a library note about that, right <span class="user-mention" data-user-id="284160">@Eric Rodriguez</span>?</p>



<a name="245304355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304355">(Jul 08 2021 at 12:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245304197">said</a>:</p>
<blockquote>
<p>No, you declare <code>has_coe_t</code> instead of <code>has_coe</code> if you don't want your coercion to take place anywhere but at the end of transitive coercions</p>
</blockquote>
<p>Oh I see, I guess this is also the reason why is it useful to distinguish between <code>has_coe_t</code> and <code>has_coe</code> and they cannot all be <code>has_coe</code></p>



<a name="245304392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304392">(Jul 08 2021 at 12:10)</a>:</h4>
<p>yes I think so</p>



<a name="245304607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304607">(Jul 08 2021 at 12:13)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/notes.html#coercion%20into%20rings">https://leanprover-community.github.io/mathlib_docs/notes.html#coercion%20into%20rings</a> here we are!</p>



<a name="245304847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245304847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245304847">(Jul 08 2021 at 12:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245301864">said</a>:</p>
<blockquote>
<p>I've realized that the coercion you're after can be broken down into one that almost already exists (<a href="https://leanprover-community.github.io/mathlib_docs/find/lift_fn_range">docs#lift_fn_range</a>), and one that doesn't:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.lint</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>
<span class="sd">/-- Should this be a `lift` instead? Or maybe this should work on a type alias of</span>
<span class="sd">`sigma`, which I think you have already. -/</span>
<span class="kd">instance</span> <span class="n">has_coe_to_sigma</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">)</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">sigma.mk</span> <span class="n">i</span><span class="o">⟩</span>

<span class="sd">/-- A dependent version of `lift_fn_range`. It's easy to argue this should exist,</span>
<span class="sd">but note it uses `has_lift` not `has_coe`, so the `↑` is required. -/</span>
<span class="kd">instance</span> <span class="n">lift_fn_range'</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>


<span class="c1">-- the coercion lean finds is the one you're asking for, it seems</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">↑</span><span class="n">f</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">sigma</span> <span class="n">A</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I wonder why this code would work: is <code>B → E</code> just syntactic sugar for <code>Π x: B, E</code>? Otherwise how does Lean recognize a function as a dependent type?</p>



<a name="245305021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245305021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245305021">(Jul 08 2021 at 12:17)</a>:</h4>
<p>A connected question: should then</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">lift_fn_range'</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>
</code></pre></div>
<p>completely replace <code>lift_fn_range</code>?</p>



<a name="245305259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245305259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245305259">(Jul 08 2021 at 12:20)</a>:</h4>
<p>Yes, it is just syntactic sugar</p>



<a name="245305418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245305418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245305418">(Jul 08 2021 at 12:21)</a>:</h4>
<p>I think it might still be worth having both; dependent typed instances create more work for the elaborator, and having a non-dependent variant will both provide a possible shortcut, and allow the user to disable the slower instance separately.</p>



<a name="245305485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245305485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245305485">(Jul 08 2021 at 12:22)</a>:</h4>
<p>I don't think there's much harm to having both, at any rate</p>



<a name="245305715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245305715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245305715">(Jul 08 2021 at 12:24)</a>:</h4>
<p>Ok isn't there a coe version of <code>lift_fn_range</code>? I was so convinced there was...</p>



<a name="245306711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245306711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245306711">(Jul 08 2021 at 12:34)</a>:</h4>
<p>No, and that's a deliberate choice I think</p>



<a name="245313350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245313350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245313350">(Jul 08 2021 at 13:36)</a>:</h4>
<p>Where would you place your <code>lift_fn_range</code>?</p>



<a name="245314145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245314145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245314145">(Jul 08 2021 at 13:42)</a>:</h4>
<p>I'd probably make a PR against lean core to add it next to <code>lift_fn_range</code></p>



<a name="245314173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245314173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245314173">(Jul 08 2021 at 13:42)</a>:</h4>
<p>Alternatively, <code>logic.function.basic</code> would be reasonable</p>



<a name="245315840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245315840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245315840">(Jul 08 2021 at 13:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245314145">said</a>:</p>
<blockquote>
<p>I'd probably make a PR against lean core to add it next to <code>lift_fn_range</code></p>
</blockquote>
<p>Yeah I'm not sure I would know how to do this... should I PR to a different repo than that of mathlib?</p>



<a name="245316005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245316005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245316005">(Jul 08 2021 at 13:55)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/">https://github.com/leanprover-community/lean/</a> ?</p>



<a name="245318494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245318494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245318494">(Jul 08 2021 at 14:11)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/lift_fn_range/src">src#lift_fn_range</a> should tell you where the file is that needs changing</p>



<a name="245319025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245319025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245319025">(Jul 08 2021 at 14:15)</a>:</h4>
<p>If you edit that file, changing a few <code>/- -/</code>s to <code>/-! -/</code> would make them appear in the web docs</p>



<a name="245320625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245320625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245320625">(Jul 08 2021 at 14:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245316005">said</a>:</p>
<blockquote>
<p><a href="https://github.com/leanprover-community/lean/">https://github.com/leanprover-community/lean/</a> ?</p>
</blockquote>
<p>Ok thanks</p>



<a name="245321019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245321019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245321019">(Jul 08 2021 at 14:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245319025">said</a>:</p>
<blockquote>
<p>If you edit that file, changing a few <code>/- -/</code>s to <code>/-! -/</code> would make them appear in the web docs</p>
</blockquote>
<p>Do you have specific ones I should change or most of them?</p>



<a name="245341738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245341738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245341738">(Jul 08 2021 at 17:04)</a>:</h4>
<p>Mainly the one at the top of the file</p>



<a name="245342193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245342193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245342193">(Jul 08 2021 at 17:08)</a>:</h4>
<p>L7: <code>/-!</code></p>
<p>L101 L118 L140 L150 (maybe L168): <code>/--</code></p>



<a name="245342486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245342486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245342486">(Jul 08 2021 at 17:10)</a>:</h4>
<p>Should I fork or can I get permission to contribute so to open a new branch?</p>



<a name="245342524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245342524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245342524">(Jul 08 2021 at 17:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245342193">said</a>:</p>
<blockquote>
<p>L7: <code>/-!</code></p>
<p>L101 L118 L140 L150 (maybe L168): <code>/--</code></p>
</blockquote>
<p>Ok thanks</p>



<a name="245342606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245342606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245342606">(Jul 08 2021 at 17:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="267205">Nicolò Cavalleri</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245342486">said</a>:</p>
<blockquote>
<p>Should I fork or can I get permission to contribute so to open a new branch?</p>
</blockquote>
<p>I'll give you permission, 1 sec.</p>



<a name="245342617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245342617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245342617">(Jul 08 2021 at 17:11)</a>:</h4>
<p>Ok thanks</p>



<a name="245342776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245342776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245342776">(Jul 08 2021 at 17:12)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/invitations">https://github.com/leanprover-community/lean/invitations</a></p>



<a name="245343034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245343034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245343034">(Jul 08 2021 at 17:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="267205">Nicolò Cavalleri</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245303877">said</a>:</p>
<blockquote>
<p>What does transitively means?</p>
</blockquote>
<p>From a certain point of view, the coercion typeclasses define a relation on types/sorts, but rather than being <code>Prop</code>-valued, given types <code>a</code> and <code>b</code>, then there either is or is not an instance for <code>has_coe a b</code> (the relation is determined by the typeclass resolution algorithm rather than something more mathy).</p>
<p>Transitive closure then means what it does for relations: take the smallest transitive relation containing the original relation.</p>



<a name="245343578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245343578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245343578">(Jul 08 2021 at 17:19)</a>:</h4>
<p>For normal mathy relations, you can use some inductive type to construct a transitive closure, but because the relation is implemented at the level of typeclasses, it's instead implemented using the <code>coe_trans</code> instance.</p>
<p>You can almost think of this as being one of the constructors of a <code>Prop</code>-valued inductive type <code>has_coe_t</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">coe_trans</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u₁</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u₂</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u₃</span><span class="o">}</span> <span class="o">[</span><span class="n">has_coe_t</span> <span class="n">b</span> <span class="n">c</span><span class="o">]</span> <span class="o">[</span><span class="n">has_coe</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="n">a</span> <span class="n">c</span>
</code></pre></div>



<a name="245345364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245345364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245345364">(Jul 08 2021 at 17:33)</a>:</h4>
<p>Is this the correct form to write it?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">lift_pi_range</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span> <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>
</code></pre></div>



<a name="245346510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245346510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245346510">(Jul 08 2021 at 17:44)</a>:</h4>
<p>Seems fine to me.  You might use the universe variables defined in the file, just to clarify they're all different:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">lift_pi_range</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">ua</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">ub</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>
</code></pre></div>
<p>(also, newlines for line length reasons, though the first line is still over 100 characters)</p>



<a name="245347113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245347113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245347113">(Jul 08 2021 at 17:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245346510">said</a>:</p>
<blockquote>
<p>Seems fine to me.  You might use the universe variables defined in the file, just to clarify they're all different:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">lift_pi_range</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">ua</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">ub</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>
</code></pre></div>
<p>(also, newlines for line length reasons)</p>
</blockquote>
<p>Ok for the universes, as for the length I saw that the convention in the file is to write everything on one line and many other lines are much longer than the one I wrote</p>



<a name="245347752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245347752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245347752">(Jul 08 2021 at 17:53)</a>:</h4>
<p>I suppose mathlib style guidelines probably don't carry over to lean core, but if I were writing it I would probably use the new guidelines for new code (leaving everything else alone).  Of course, it's up to you and the reviewers.</p>



<a name="245348178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245348178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245348178">(Jul 08 2021 at 17:56)</a>:</h4>
<p>Once it will build in the Lean repo, how will we know it does not break anything in Mathlib?</p>



<a name="245348688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245348688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245348688">(Jul 08 2021 at 18:00)</a>:</h4>
<p>Mathlib has to be manually bumped to new lean versions</p>



<a name="245348771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245348771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245348771">(Jul 08 2021 at 18:01)</a>:</h4>
<p>Anyway, now that you've made the PR, someone more involved in lean releases than me should know what's best.</p>



<a name="245348781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245348781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245348781">(Jul 08 2021 at 18:01)</a>:</h4>
<p>Thanks!</p>



<a name="245349306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245349306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245349306">(Jul 08 2021 at 18:05)</a>:</h4>
<p>(For the record, the PR is at <a href="https://github.com/leanprover-community/lean/issues/590">lean#590</a>.)</p>



<a name="245430821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245430821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245430821">(Jul 09 2021 at 11:28)</a>:</h4>
<p>Ok with this modification of Lean core, there is still a problem in my code, as shown in the following example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">topology.topological_fiber_bundle</span>

<span class="kn">open</span> <span class="n">bundle</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="o">(</span><span class="n">total_space</span> <span class="n">E</span><span class="o">)]</span>

<span class="kd">instance</span> <span class="n">lift_fn_range''</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">has_lift_t</span> <span class="o">(</span><span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">B</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">has_lift</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">A</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="n">B</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="bp">↑</span><span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)⟩</span>

<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">bundle_section'</span> <span class="o">(</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Π</span> <span class="n">x</span><span class="o">,</span> <span class="n">E</span> <span class="n">x</span>

<span class="kd">structure</span> <span class="n">continuous_bundle_section'</span> <span class="o">(</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="o">(</span><span class="n">total_space</span> <span class="n">E</span><span class="o">)]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">bundle_section</span> <span class="n">E</span><span class="o">)</span>
<span class="o">(</span><span class="n">continuous_to_fun</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">))</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">continuous_bundle_section'</span> <span class="n">E</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">continuous_bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">continuous_bundle_section'.to_fun</span><span class="o">⟩</span>

<span class="c1">-- works</span>
<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous'</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">s.continuous_to_fun</span>

<span class="c1">-- does not work... Why!? `has_lift_t` should be transitive!!</span>
<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous''</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="n">s</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span> <span class="n">s.continuous_to_fun</span>
</code></pre></div>



<a name="245434739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245434739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245434739">(Jul 09 2021 at 12:13)</a>:</h4>
<p>I suspect this is behaving strangely for you because <code>has_coe_to_fun</code> is getting involved here too</p>



<a name="245434757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245434757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245434757">(Jul 09 2021 at 12:14)</a>:</h4>
<p>But I haven't tried it out myself so am only guessing.</p>



<a name="245442173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245442173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245442173">(Jul 09 2021 at 13:21)</a>:</h4>
<p>What <code>has_coe_to_fun</code> are you referring to? there's none in the code!</p>



<a name="245464644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245464644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245464644">(Jul 09 2021 at 16:25)</a>:</h4>
<p>I haven't taken any time to understand what's going on, but I did find this fix:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">has_lift</span> <span class="o">(</span><span class="n">continuous_bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">continuous_bundle_section'.to_fun</span><span class="o">⟩</span>

<span class="c1">-- works</span>
<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous'</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="bp">↑</span><span class="n">s</span> <span class="o">:</span> <span class="n">bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">s.continuous_to_fun</span>

<span class="c1">-- works, too</span>
<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous''</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="n">s</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span> <span class="n">s.continuous_to_fun</span>
</code></pre></div>



<a name="245469742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245469742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245469742">(Jul 09 2021 at 17:05)</a>:</h4>
<p>Would this be acceptable?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">topology.topological_fiber_bundle</span>

<span class="kn">open</span> <span class="n">bundle</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">topological_space</span> <span class="o">(</span><span class="n">total_space</span> <span class="n">E</span><span class="o">)]</span>

<span class="kd">@[reducible]</span> <span class="kd">def</span> <span class="n">bundle_section</span> <span class="o">(</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Π</span> <span class="n">x</span><span class="o">,</span> <span class="n">E</span> <span class="n">x</span>

<span class="kd">def</span> <span class="n">bundle_section.to_total</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">bundle_section</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="o">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">s</span> <span class="n">b</span><span class="o">⟩</span>

<span class="kd">structure</span> <span class="n">continuous_bundle_section'</span> <span class="o">(</span><span class="n">E</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="o">(</span><span class="n">total_space</span> <span class="n">E</span><span class="o">)]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">bundle_section</span> <span class="n">E</span><span class="o">)</span>
<span class="o">(</span><span class="n">continuous_to_fun</span> <span class="o">:</span> <span class="n">continuous</span> <span class="n">to_fun.to_total</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">continuous_bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">bundle_section</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">continuous_bundle_section'.to_fun</span><span class="o">⟩</span>

<span class="kd">variables</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">continuous_bundle_section'</span> <span class="n">E</span><span class="o">)</span>

<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous'</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="n">bundle_section.to_total</span> <span class="n">s</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">s.continuous_to_fun</span>
</code></pre></div>



<a name="245470484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245470484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245470484">(Jul 09 2021 at 17:11)</a>:</h4>
<p>It seems like basically you want every instance that <code>Π x, E x</code> already has (to give the space of sections structure when the fibers have that structure), so it's worth having <code>bundle_section</code> be <code>reducible</code>. But, it's fraught with peril to add additional instances to this.  Dot notation here is used to add this <code>to_total</code> function to the pre-existing type when it's being thought of as a <code>bundle_section</code>.</p>
<p>(Also, I know there are a bunch of coercions that implement <code>to_total</code>, but I found it hard to follow the chain to figure out what it was doing! It only takes 13 characters to write the definition, so it seems clearer to just write it.)</p>



<a name="245471114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245471114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245471114">(Jul 09 2021 at 17:16)</a>:</h4>
<p>How did the original lift work? The confusing thing to me is that <code>total_space</code> is semireducible, so I would have thought typeclass resolution wouldn't have found the <code>has_coe_to_sigma</code> instance.</p>



<a name="245552322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245552322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245552322">(Jul 10 2021 at 14:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/113489-new-members/topic/Reducible/near/245464644">said</a>:</p>
<blockquote>
<p>I haven't taken any time to understand what's going on, but I did find this fix:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">has_lift</span> <span class="o">(</span><span class="n">continuous_bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">(</span><span class="n">bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">⟨</span><span class="n">continuous_bundle_section'.to_fun</span><span class="o">⟩</span>

<span class="c1">-- works</span>
<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous'</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="o">(</span><span class="bp">↑</span><span class="n">s</span> <span class="o">:</span> <span class="n">bundle_section'</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">s.continuous_to_fun</span>

<span class="c1">-- works, too</span>
<span class="kd">@[continuity]</span> <span class="kd">lemma</span> <span class="n">continuous''</span> <span class="o">:</span> <span class="n">continuous</span> <span class="o">(</span><span class="bp">↑</span><span class="n">s</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">total_space</span> <span class="n">E</span><span class="o">)</span> <span class="o">:=</span> <span class="n">s.continuous_to_fun</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Ok this is weird: why does it work as with <code>has_lift</code> but not with <code>has_coe</code>?</p>



<a name="245555795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245555795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245555795">(Jul 10 2021 at 15:10)</a>:</h4>
<p>I might have found a solution for the coercion to work</p>



<a name="245556521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245556521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245556521">(Jul 10 2021 at 15:24)</a>:</h4>
<p>Btw, <a href="https://github.com/leanprover-community/lean/issues/590">lean#590</a> is ready for review!</p>



<a name="245861392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Reducible/near/245861392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Nicolò Cavalleri <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Reducible.html#245861392">(Jul 13 2021 at 17:47)</a>:</h4>
<p><code>reducible</code> is behaving weirdly <a href="https://github.com/leanprover-community/mathlib/pull/8154#discussion_r667506387">here</a>. Are either <code>simp</code> or <code>rw</code> supposed to see through reducible defs?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>