---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/modifying.20exists.20prop.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html">modifying exists prop</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="291525670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291525670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291525670">(Aug 01 2022 at 02:23)</a>:</h4>
<p>Is there a simple way to rewrite (or map over) the prop within an existential without using <code>conv</code>?</p>
<p>Like if I have a hypothesis <code>∃ (c : ℕ), b = 2 * c</code> and I want to rewrite it to <code>∃ (c : ℕ), 2 * c = b</code>, is there a simple way to do that? I know it can be accomplished by going into <code>conv</code> mode (or just unpacking it with <code>cases</code> and operating on the contents directly), but I was wondering if there was an even easier way to do it.</p>
<p>I tried messing around with <code>exists_congr</code> and <code>eq_comm</code> but I couldn't get it to work that well.</p>



<a name="291526939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291526939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291526939">(Aug 01 2022 at 02:49)</a>:</h4>
<p>it would be cool if I could do something like <code>h.map eq.symm</code> (where <code>h</code> is the name of an existential hypothesis)</p>
<p><strong>Edit:</strong> that seems to be what <code>exists_imp_exists</code> is, so I just need to make it work with <code>eq.symm</code></p>



<a name="291527957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291527957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291527957">(Aug 01 2022 at 03:11)</a>:</h4>
<p>hmm, it looks like <code>exists_congr</code> and <code>exists_imp_exists</code> actually work as long as they're given explicit typing, though that can be kind of cumbersome</p>



<a name="291528266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291528266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xavier Roblot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291528266">(Aug 01 2022 at 03:19)</a>:</h4>
<p>It looks like <code>simp_rw eq_comm</code> works here.</p>



<a name="291528454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291528454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291528454">(Aug 01 2022 at 03:23)</a>:</h4>
<p>ah nice!</p>



<a name="291528495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291528495" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291528495">(Aug 01 2022 at 03:24)</a>:</h4>
<p>I knew there had to be a trick somewhere</p>



<a name="291528517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291528517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xavier Roblot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291528517">(Aug 01 2022 at 03:24)</a>:</h4>
<p><code>simp_rw</code> is really powerful and can work in many cases where <code>rw</code> does not.</p>



<a name="291529044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291529044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291529044">(Aug 01 2022 at 03:37)</a>:</h4>
<p><span class="user-mention" data-user-id="488648">@Xavier Roblot</span> I'm running into an issue with this... here's a mwe:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.basic</span>

<span class="kd">def</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="mi">1</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="n">eq_comm</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">h</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="n">eq_comm</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">h</span>
<span class="kd">end</span>
</code></pre></div>
<p>The first works but the second fails, and the only difference is the ordering of the left and right sides of the equation.</p>
<p>(Not a big deal as I can just rewrite from the other direction, of course.)</p>



<a name="291529614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291529614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Xavier Roblot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291529614">(Aug 01 2022 at 03:50)</a>:</h4>
<p>Well, you reached (quite rapidly) the limits of my knowledge of Lean. Still, I think what happens is that Lean has some rules to decide if an expression is simpler than another one so that the <code>simp</code> process converges and does end up in an infinite loop. Thus, <code>b = 2 * c</code> is simpler than <code>2 * c = b</code> and therefore the simplification part is failing in your second example. As you noticed, in this case, you can just do <code>simp_rw [eq_comm] at h</code> instead and the proof works then. <br>
I guess somebody with a better knowledge of Lean can confirm or correct my explanation.</p>



<a name="291529845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291529845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291529845">(Aug 01 2022 at 03:56)</a>:</h4>
<p>Another workaround is to give lean a bit more information</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="o">[(</span><span class="n">eq_comm</span> <span class="o">:</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">_</span> <span class="bp">*</span> <span class="n">_</span> <span class="bp">↔</span> <span class="n">_</span><span class="o">)],</span>
  <span class="n">exact</span> <span class="n">h</span>
<span class="kd">end</span>
</code></pre></div>
<p>I guess this breaks the symmetry so that it doesn't do the infinite loop thing Xavier mentions.</p>



<a name="291530871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291530871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matt Diamond <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291530871">(Aug 01 2022 at 04:22)</a>:</h4>
<p>Thanks for the replies!</p>
<p>For the record, it didn't enter an infinite loop... it completed with the error message <code>simplify tactic failed to simplify</code>. Based on the fact that Alex's version works, I think it was just a case of being unable to match (unify?) <code>eq_comm</code> with the existing equation without further hints.</p>



<a name="291531548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291531548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291531548">(Aug 01 2022 at 04:39)</a>:</h4>
<p>What Xavier mentioned is the mechanism for avoiding infinite loops, simp makes a somewhat arbitrary decision that one way round of your equality is the right one, and refuses to simplify the other way round as it thinks your expression is the best possible already. <code>simp_rw</code> is fairly close to calling <code>simp only</code>.</p>



<a name="291531662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291531662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291531662">(Aug 01 2022 at 04:41)</a>:</h4>
<p>If you do <code>set_option trace.simplify</code> you can see a bunch of what is going on under the hood:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">set_option</span> <span class="n">trace.simplify</span> <span class="n">true</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="n">eq_comm</span><span class="o">],</span>
  <span class="c1">-- simp_rw [(eq_comm : _ = _ * _ ↔ _)],</span>
  <span class="n">exact</span> <span class="n">h</span>
<span class="kd">end</span>
</code></pre></div>
<p>tells us a bunch of stuff including</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">simplify.perm</span><span class="o">]</span> <span class="n">perm</span> <span class="n">rejected</span><span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">!&lt;</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span>
</code></pre></div>



<a name="291531714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291531714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291531714">(Aug 01 2022 at 04:42)</a>:</h4>
<p>Rather amusingly instead <code>simp_rw [(eq_comm : _ ↔ _)],</code> does seem to enter an infinite loop...</p>



<a name="291533080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291533080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291533080">(Aug 01 2022 at 05:11)</a>:</h4>
<p>On the topic of loops in <code>simp/simp_rw</code>, there was also <a href="#narrow/stream/113488-general/topic/simp_rw.20weirdness">this recent thread</a>.</p>



<a name="291544255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291544255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291544255">(Aug 01 2022 at 08:21)</a>:</h4>
<p>Does <code>h.imp eq.symm</code> work?</p>



<a name="291547378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291547378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291547378">(Aug 01 2022 at 08:57)</a>:</h4>
<p>This works: </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span> <span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="bp">@</span><span class="n">eq_comm</span> <span class="n">_</span> <span class="n">b</span><span class="o">],</span>
  <span class="n">exact</span> <span class="n">h</span>
<span class="kd">end</span>
</code></pre></div>



<a name="291585700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291585700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Johnson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291585700">(Aug 01 2022 at 14:49)</a>:</h4>
<p><code>@eq_comm _ b</code> doesn't work if both sides of the equality contain bound variables:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">}</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">g</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">x</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">simp_rw</span> <span class="o">[</span><span class="bp">@</span><span class="n">eq_comm</span> <span class="o">(</span><span class="n">f</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="n">_</span><span class="o">)],</span> <span class="c1">-- fails</span>
  <span class="n">simp_rw</span> <span class="o">[(</span><span class="n">eq_comm</span> <span class="o">:</span> <span class="n">f</span> <span class="n">_</span> <span class="bp">=</span> <span class="n">g</span> <span class="n">_</span> <span class="bp">↔</span> <span class="n">_</span><span class="o">)],</span> <span class="c1">-- works</span>
  <span class="n">exact</span> <span class="n">h</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="291586560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/modifying%20exists%20prop/near/291586560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/modifying.20exists.20prop.html#291586560">(Aug 01 2022 at 14:56)</a>:</h4>
<p>There's also <a href="https://leanprover-community.github.io/mathlib_docs/find/Exists.imp">docs#Exists.imp</a>, which I think trivialises this a lpt</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>