---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html">Coding style – splitting long proofs</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="293991157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/293991157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#293991157">(Aug 17 2022 at 22:48)</a>:</h4>
<p>Soft question (coding style):</p>
<p>Do you split long proofs into several lemmata just because the proof is too long? Even if they aren't logically independent pieces by using only a small subset of the propositions that are present inside the proof?</p>



<a name="294001007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294001007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294001007">(Aug 18 2022 at 01:13)</a>:</h4>
<p>For mathlib, I would say "generally not." However, unless the proof is about a deep result, there is often a way to split it up into pieces, even if it means a major rewrite, or using other parts of the library better. That being said, there can always be exceptions to both statements above.</p>



<a name="294002158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294002158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294002158">(Aug 18 2022 at 01:24)</a>:</h4>
<p>One reason to split up a large proof is if it improves compile times</p>



<a name="294002182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294002182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294002182">(Aug 18 2022 at 01:25)</a>:</h4>
<p>lemmas are processed in parallel, and additionally a long proof can involve a large local context which makes all other tactics slower</p>



<a name="294002254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294002254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294002254">(Aug 18 2022 at 01:26)</a>:</h4>
<p>it's also just easier to work with when you are writing the proof since the response time is smaller</p>



<a name="294002361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294002361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294002361">(Aug 18 2022 at 01:28)</a>:</h4>
<p>that last reason is probably the most direct reason to split a long proof, it just gets too annoying to write otherwise</p>



<a name="294149989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294149989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294149989">(Aug 18 2022 at 18:55)</a>:</h4>
<p>I think I made a mistake that I was taking only the logical structure into account but not the length of the respective parts. I made a few levels of decomposition, after which I basically stopped breaking things apart. As a result, I have a proof that consists of 36 lemmata; many of them are under 10 lines, but some of them are longer, and one of them is a monstrous lemma with a proof of 1100 lines.</p>
<p>The response time <em>cries in Lean</em> was really annoying.</p>



<a name="294151701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294151701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294151701">(Aug 18 2022 at 19:05)</a>:</h4>
<p>A proof of 1100 lines is certainly a good enough reason to split it. Are you sure that lemma can't be deconstructed further? It seems very surprising to me. We have a few long proofs in mathlib, but I'm not sure I know of any that are over say, 200 lines [other community members please insert links to counterexamples here].</p>



<a name="294151975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294151975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294151975">(Aug 18 2022 at 19:07)</a>:</h4>
<p>I think there are counterexamples, but I generally associate ultra-long proofs with folks who haven't quite learned the coding style yet</p>



<a name="294152186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294152186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294152186">(Aug 18 2022 at 19:08)</a>:</h4>
<p>It would be nice if someone could do some statistics on mathlib proof length distribution and outliers</p>



<a name="294152646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294152646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294152646">(Aug 18 2022 at 19:11)</a>:</h4>
<p>unfortunately <code>environment.decl_pos</code> only has the start position and not the end</p>



<a name="294152971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294152971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294152971">(Aug 18 2022 at 19:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="197836">Jireh Loreaux</span> <a href="#narrow/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs/near/294151701">said</a>:</p>
<blockquote>
<p>A proof of 1100 lines is certainly a good enough reason to split it. Are you sure that lemma can't be deconstructed further? It seems very surprising to me. We have a few long proofs in mathlib, but I'm not sure I know of any that are over say, 200 lines [other community members please insert links to counterexamples here].</p>
</blockquote>
<p>It can be. I just made a mistake that I stopped after a few levels of decomposition.</p>



<a name="294153105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294153105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294153105">(Aug 18 2022 at 19:14)</a>:</h4>
<p>After which I was splitting things only if they were using only a small subset of propositions in the place where they were used.</p>



<a name="294153163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294153163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Dvořák <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294153163">(Aug 18 2022 at 19:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs/near/294151975">said</a>:</p>
<blockquote>
<p>(...) folks who haven't quite learned the coding style yet</p>
</blockquote>
<p>Yep, this is me!</p>



<a name="294153639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294153639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294153639">(Aug 18 2022 at 19:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> As a first approximation, you could just subtract successive <code>environment.decl_pos</code> values. It wouldn't be accurate because of variable declarations, section headings, but I think only really long docstrings would feed into the outliers, and these might be small enough in number to discard manually.</p>



<a name="294153811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294153811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294153811">(Aug 18 2022 at 19:19)</a>:</h4>
<p>I just wrote a fix for lean so that the .ast.json stores command ends correctly, so if we update lean and run it on mathlib we can get accurate data here</p>



<a name="294154365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Coding%20style%20%E2%80%93%20splitting%20long%20proofs/near/294154365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Coding.20style.20.E2.80.93.20splitting.20long.20proofs.html#294154365">(Aug 18 2022 at 19:23)</a>:</h4>
<p><a href="https://github.com/leanprover-community/lean/pull/756">lean#756</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>