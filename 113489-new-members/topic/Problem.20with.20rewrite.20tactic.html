---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html">Problem with rewrite tactic</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="198437635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198437635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Syx Pek <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198437635">(May 22 2020 at 12:54)</a>:</h4>
<p>Hello there, I am working through the proof that left identity and left inverse implies a group from <br>
<a href="https://leanprover-community.github.io/mathematics_in_lean/">https://leanprover-community.github.io/mathematics_in_lean/</a></p>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">mul_right_inv</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="k">have</span> <span class="n">h₁</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h₂</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">a</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="k">calc</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span>
        <span class="bp">=</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span>          <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">h₂</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">1</span>                        <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">mul_left_inv</span>
<span class="kn">end</span>
</code></pre></div>


<p>But I face some difficulty. I don't see why line 6 fails.</p>



<a name="198437899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198437899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason KY. <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198437899">(May 22 2020 at 12:57)</a>:</h4>
<p>The left arrow means you want to rewrite using <code>h₂</code> from <code>a</code> to <code>(a⁻¹)⁻¹</code>. Using just <code>rw h₂</code> works fine!</p>



<a name="198437960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198437960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason KY. <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198437960">(May 22 2020 at 12:58)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">theorem</span> <span class="n">mul_right_inv</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="k">have</span> <span class="n">h₁</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span> <span class="bp">*</span> <span class="n">a</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">h₂</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">=</span> <span class="n">a</span><span class="o">,</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="k">calc</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="bp">⁻¹</span>
        <span class="bp">=</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span><span class="bp">⁻¹</span><span class="o">)</span>          <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">h₂</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="mi">1</span>                        <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">mul_left_inv</span>
<span class="kn">end</span>
</code></pre></div>



<a name="198438317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198438317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Syx Pek <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198438317">(May 22 2020 at 13:02)</a>:</h4>
<p>I see. But why doesn't the approach I suggested would fail. It says in the documentation, that it rewrites only the first copy of it, but it seems to rewrite all copies?</p>



<a name="198438607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198438607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198438607">(May 22 2020 at 13:05)</a>:</h4>
<p>Out of interest where did you read that it rewrites only the first copy?</p>



<a name="198438674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198438674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason KY. <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198438674">(May 22 2020 at 13:06)</a>:</h4>
<p>In my experience it normally rewrites every instance :/</p>



<a name="198438702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198438702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198438702">(May 22 2020 at 13:06)</a>:</h4>
<p>I <em>think</em> that it'll rewrite all copies of the first instance it finds, if that makes sense. That is, if you do <code>rw add_comm</code> and your term has a bunch of <code>a + b</code> and <code>c + d</code>, it'll change all of the <code>a+b</code> to <code>b+a</code> but none of the <code>c+d</code></p>



<a name="198438877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198438877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Syx Pek <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198438877">(May 22 2020 at 13:09)</a>:</h4>
<p>It says "Sometimes the left-hand side of an identity can match more than one subterm in the pattern, in which case the rewrite tactic chooses the first match it finds when traversing the term. If that is not the one you want, you can use additional arguments to specify the appropriate subterm." on <a href="https://leanprover.github.io/theorem_proving_in_lean/tactics.html">https://leanprover.github.io/theorem_proving_in_lean/tactics.html</a></p>



<a name="198439058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198439058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198439058">(May 22 2020 at 13:10)</a>:</h4>
<p>Yeah, so seemingly it chooses the first match and applies that one as much as it can</p>



<a name="198439111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198439111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198439111">(May 22 2020 at 13:11)</a>:</h4>
<p>Yes, it is a confusing description of a confusing behavior</p>



<a name="198449384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198449384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198449384">(May 22 2020 at 14:43)</a>:</h4>
<p>There is also <code>nth_rewrite</code> if you want control over this. (As well as the <code>occs</code> configuration argument for <code>rw</code>, which is even more confusingly specified.)</p>



<a name="198449405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Problem%20with%20rewrite%20tactic/near/198449405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Problem.20with.20rewrite.20tactic.html#198449405">(May 22 2020 at 14:43)</a>:</h4>
<p>But usually <code>conv</code> to zoom into the place you're interested in is clearer and more maintainable.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>