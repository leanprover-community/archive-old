---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html">Underlying coefficients from span</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="200924976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/200924976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#200924976">(Jun 15 2020 at 18:05)</a>:</h4>
<p>I'm trying to establish the existence of the underlying coefficients of an element of a submodule spanned by a finite set, specifically:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">noetherian</span>
<span class="kn">open</span> <span class="n">submodule</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="n">def</span> <span class="n">my_set</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">x</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span><span class="o">:</span> <span class="n">c</span> <span class="err">∈</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">erase</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="bp">⟩</span><span class="o">),</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">c</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">c</span><span class="bp">.</span><span class="mi">1</span> <span class="o">}</span>

<span class="kn">lemma</span> <span class="n">mwe</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s_non_zero</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="n">R</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h_f</span><span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>


<p>It looks like <code>finsupp.mem_span_iff_total</code> might be relevant, but I can't seem to get it to work <span aria-label="cold sweat" class="emoji emoji-1f630" role="img" title="cold sweat">:cold_sweat:</span></p>



<a name="201179852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201179852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201179852">(Jun 17 2020 at 18:12)</a>:</h4>
<p>My first reaction is that maybe we should try to apply a bit more "force" to make <code>finsupp.mem_span_iff_total</code> behave.</p>



<a name="201179872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201179872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201179872">(Jun 17 2020 at 18:13)</a>:</h4>
<p>Let me try</p>



<a name="201180271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201180271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201180271">(Jun 17 2020 at 18:16)</a>:</h4>
<p><span class="user-mention" data-user-id="300547">@Barinder Singh Banwait</span> Voila:</p>
<div class="codehilite"><pre><span></span><code><span class="k">begin</span>
  <span class="n">intro</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">val_image_univ</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">)</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mem_span_iff_total</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201180366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201180366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201180366">(Jun 17 2020 at 18:17)</a>:</h4>
<p>The trick is that <code>mem_span_iff_total</code> wants to work with an indexed family, instead of a subset. So we replace <code>my_set</code> with the family indexed by <code>my_set</code>.</p>



<a name="201180592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201180592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201180592">(Jun 17 2020 at 18:18)</a>:</h4>
<p>huh, somehow that's not accomplishing the goal for me ... probably because i haven't git pulled mathlib in a while</p>



<a name="201181404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201181404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201181404">(Jun 17 2020 at 18:25)</a>:</h4>
<p>Hmm, this part of mathlib didn't change, I think.</p>



<a name="201181422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201181422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201181422">(Jun 17 2020 at 18:25)</a>:</h4>
<p>What kind of error do you get?</p>



<a name="201181795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201181795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201181795">(Jun 17 2020 at 18:28)</a>:</h4>
<p>it's not an error per se, it's just an unsolved goal. i thought that pulling latest mathlib might fix it, but still not; i've got this in my tactic state:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Tactic</span> <span class="n">State</span>
<span class="mi">1</span> <span class="n">goal</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">integral_domain</span> <span class="n">R</span><span class="o">,</span>
<span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span>
<span class="n">s_non_zero</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">H</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">subtype</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">)</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">l</span> <span class="err">∈</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">supported</span> <span class="n">R</span> <span class="n">R</span> <span class="n">set</span><span class="bp">.</span><span class="n">univ</span><span class="o">),</span>
    <span class="err">⇑</span><span class="o">(</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">total</span> <span class="o">(</span><span class="n">subtype</span> <span class="o">(</span><span class="n">my_set</span> <span class="n">R</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="n">R</span> <span class="n">R</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">n</span>
<span class="err">⊢</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h_f</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
    <span class="err">∑</span> <span class="o">(</span><span class="n">ij</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="n">snd</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">=</span> <span class="mi">0</span>
</code></pre></div>



<a name="201182618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182618">(Jun 17 2020 at 18:34)</a>:</h4>
<p>where are the coefficients in the statement of <code>H</code>? In the goal they're encoded by <code>f : ℕ → R</code>, but in <code>H</code> I can't quite figure out where they are ... is it the <code>l : subtype (my_set R r s n) →₀ R</code>?</p>



<a name="201182736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182736">(Jun 17 2020 at 18:34)</a>:</h4>
<p>Ooh, sure... I didn't prove the lemma</p>



<a name="201182745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182745">(Jun 17 2020 at 18:34)</a>:</h4>
<p>I only did the first step (-;</p>



<a name="201182794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182794">(Jun 17 2020 at 18:35)</a>:</h4>
<p>You can now do <code>cases H</code>, or </p>
<div class="codehilite"><pre><span></span><code><span class="n">rcases</span> <span class="n">H</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="bp">__</span><span class="n">garbage</span><span class="o">,</span> <span class="n">hf</span><span class="bp">⟩</span><span class="o">,</span>
</code></pre></div>



<a name="201182828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182828">(Jun 17 2020 at 18:35)</a>:</h4>
<p>I think that it might be better to change <code>my_set</code>.</p>



<a name="201182857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182857">(Jun 17 2020 at 18:35)</a>:</h4>
<p>right ok, thanks for clarifying and for setting me on the right path!</p>



<a name="201182955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182955">(Jun 17 2020 at 18:36)</a>:</h4>
<p>Everything might become easier, if you make it a function on a suitable indexing set, and then take the span of the image of a suitable subset.</p>



<a name="201182987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201182987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201182987">(Jun 17 2020 at 18:36)</a>:</h4>
<p>Let me try something</p>



<a name="201183127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201183127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201183127">(Jun 17 2020 at 18:38)</a>:</h4>
<p>hmmm ok, well i'm open to changing <code>my_set</code>, though doing that will surely mean other things in my project will need fixing!</p>



<a name="201183513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201183513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201183513">(Jun 17 2020 at 18:40)</a>:</h4>
<p>Something like</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">noetherian</span>
<span class="kn">open</span> <span class="n">submodule</span>

<span class="n">open_locale</span> <span class="n">big_operators</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span>

<span class="n">def</span> <span class="n">my_set</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">erase</span> <span class="bp">⟨</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">aux</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">ℕ</span> <span class="bp">×</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="bp">→</span> <span class="n">R</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">c</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">c</span><span class="bp">.</span><span class="mi">1</span>

<span class="kn">lemma</span> <span class="n">mwe</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s_non_zero</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="n">R</span> <span class="o">(</span><span class="n">aux</span> <span class="n">r</span> <span class="n">s</span> <span class="err">&#39;&#39;</span> <span class="err">↑</span><span class="o">(</span><span class="n">my_set</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h_f</span><span class="o">:</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mem_span_iff_total</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rcases</span> <span class="n">H</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="bp">__</span><span class="n">garbage</span><span class="o">,</span> <span class="n">hf</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="c1">-- sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201183548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201183548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201183548">(Jun 17 2020 at 18:41)</a>:</h4>
<p>As you can see, this also make <code>mem_span_iff_total</code> work without complaining</p>



<a name="201183838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201183838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201183838">(Jun 17 2020 at 18:43)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">mwe</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s_non_zero</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="n">R</span> <span class="o">(</span><span class="n">aux</span> <span class="n">r</span> <span class="n">s</span> <span class="err">&#39;&#39;</span> <span class="err">↑</span><span class="o">(</span><span class="n">my_set</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h_f</span><span class="o">:</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mem_span_iff_total</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rcases</span> <span class="n">H</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="bp">__</span><span class="n">garbage</span><span class="o">,</span> <span class="n">hf</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">g</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="k">else</span> <span class="mi">1</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hg1</span> <span class="o">:</span> <span class="n">g</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">g</span><span class="o">],</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_neg</span><span class="o">],</span> <span class="n">exact</span> <span class="n">lt_irrefl</span> <span class="n">n</span> <span class="o">},</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">g</span><span class="o">,</span> <span class="n">hg1</span><span class="o">],</span>
  <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="n">n</span><span class="o">)</span> <span class="err">∈</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">mem_antidiagonal</span><span class="o">,</span> <span class="n">erw</span> <span class="n">zero_add</span><span class="o">,</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">finset</span><span class="bp">.</span><span class="n">insert_erase</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_insert</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">not_mem_erase</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">),</span>
  <span class="n">erw</span> <span class="o">[</span><span class="n">hg1</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">pow_zero</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">],</span>
  <span class="c1">-- sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201183888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201183888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201183888">(Jun 17 2020 at 18:44)</a>:</h4>
<p>Now we need to extract some juice out of <code>hf</code></p>



<a name="201184073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184073" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184073">(Jun 17 2020 at 18:45)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">total_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum</span><span class="o">]</span> <span class="n">at</span> <span class="n">hf</span><span class="o">,</span>
</code></pre></div>



<a name="201184146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184146">(Jun 17 2020 at 18:46)</a>:</h4>
<p>woah, there's loads here that I don't know!!! dsimp, not_mem_erase, lt_irrefl</p>



<a name="201184289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184289">(Jun 17 2020 at 18:47)</a>:</h4>
<p>Oooh, also, because of this change <code>__garbage</code> is no longer garbage, but actually useful (-;</p>



<a name="201184304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184304">(Jun 17 2020 at 18:47)</a>:</h4>
<p>So it deserves a prettier name (-;</p>



<a name="201184371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184371">(Jun 17 2020 at 18:48)</a>:</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">mwe</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">[</span><span class="n">integral_domain</span> <span class="n">R</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="n">s</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">s_non_zero</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">r</span><span class="bp">^</span><span class="n">n</span> <span class="err">∈</span> <span class="n">span</span> <span class="n">R</span> <span class="o">(</span><span class="n">aux</span> <span class="n">r</span> <span class="n">s</span> <span class="err">&#39;&#39;</span> <span class="err">↑</span><span class="o">(</span><span class="n">my_set</span> <span class="n">r</span> <span class="n">s</span> <span class="n">n</span><span class="o">))</span> <span class="bp">→</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">h_f</span><span class="o">:</span> <span class="n">f</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">),</span>
  <span class="err">∑</span> <span class="n">ij</span> <span class="k">in</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span> <span class="n">f</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">r</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">s</span> <span class="bp">^</span> <span class="n">ij</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mem_span_iff_total</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rcases</span> <span class="n">H</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">hf_support</span><span class="o">,</span> <span class="n">hf</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">g</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">R</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">if</span> <span class="n">hi</span> <span class="o">:</span> <span class="n">i</span> <span class="bp">&lt;</span> <span class="n">n</span> <span class="k">then</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">i</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="k">else</span> <span class="mi">1</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">hg1</span> <span class="o">:</span> <span class="n">g</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">g</span><span class="o">],</span> <span class="n">rw</span> <span class="o">[</span><span class="n">dif_neg</span><span class="o">],</span> <span class="n">exact</span> <span class="n">lt_irrefl</span> <span class="n">n</span> <span class="o">},</span>
  <span class="n">use</span> <span class="o">[</span><span class="n">g</span><span class="o">,</span> <span class="n">hg1</span><span class="o">],</span>
  <span class="k">have</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="n">n</span><span class="o">)</span> <span class="err">∈</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">antidiagonal</span> <span class="n">n</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">mem_antidiagonal</span><span class="o">,</span> <span class="n">erw</span> <span class="n">zero_add</span><span class="o">,</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="err">←</span> <span class="n">finset</span><span class="bp">.</span><span class="n">insert_erase</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_insert</span> <span class="o">(</span><span class="n">finset</span><span class="bp">.</span><span class="n">not_mem_erase</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">),</span>
  <span class="n">erw</span> <span class="o">[</span><span class="n">hg1</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">pow_zero</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">total_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum</span><span class="o">]</span> <span class="n">at</span> <span class="n">hf</span><span class="o">,</span>
  <span class="n">erw</span> <span class="err">←</span> <span class="n">hf</span><span class="o">,</span>
  <span class="c1">-- sorry</span>
<span class="kn">end</span>
</code></pre></div>



<a name="201184400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184400">(Jun 17 2020 at 18:48)</a>:</h4>
<p>Now I first need to vacuum clean the living room(-;</p>



<a name="201184481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Barinder Singh Banwait <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184481">(Jun 17 2020 at 18:49)</a>:</h4>
<p>you've been a massive help Johan! i'm going need to digest all of this</p>



<a name="201184570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Underlying%20coefficients%20from%20span/near/201184570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Underlying.20coefficients.20from.20span.html#201184570">(Jun 17 2020 at 18:49)</a>:</h4>
<p>Btw, I hope I got the <code>(n - i, i)</code> right. You might need to swap things somewhere...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>