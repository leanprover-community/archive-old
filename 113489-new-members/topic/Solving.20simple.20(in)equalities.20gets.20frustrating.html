---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html">Solving simple (in)equalities gets frustrating</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="220251116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220251116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220251116">(Dec 17 2020 at 14:43)</a>:</h4>
<p>Hi,</p>
<p>I am working on a proof of Euler summation, which is now complete up to general facts on definite integrals (essentially, FTC2 as called in here, just for continuous functions).  There has been lots of frustration when doing apparently simple manipulations, and my feeling is that someone good at tactic writing should look at how to improve the situation. Here are three examples that have I have taken from <code>calc</code> proofs and that I thought would require one or two lines only. Each has taken me quite a bit of both lines and time. Of course I could golf the proof of each of them, but that wouldn't reduce the time. The first involves simple manipulations with the reals, but ring/field_simp combinations didn't do the trick at all. The other two are inequalities that should be very easy (especially the last one) but took a bit too much. Any comments are welcome.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.real.basic</span>
<span class="kn">import</span> <span class="n">analysis.special_functions.trigonometric</span>
<span class="kn">open</span> <span class="n">real</span>


<span class="kd">lemma</span> <span class="n">original_difficult_inequality</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">-</span><span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span>
         <span class="o">(</span><span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span>
            <span class="bp">↑</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="bp">↑</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">))</span> <span class="bp">-</span>
      <span class="bp">↑</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">sorry</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">difficult_equality</span> <span class="o">{</span><span class="n">x</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span>
  <span class="bp">-</span><span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span>
         <span class="o">(</span><span class="n">c</span><span class="bp">^</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span>
            <span class="o">((</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">c</span><span class="bp">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="n">c</span><span class="bp">^</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">((</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span><span class="bp">^</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">))</span> <span class="bp">-</span>
      <span class="o">((</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span><span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:=</span>
<span class="kd">begin</span>
    <span class="n">sorry</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">annoying_inequality</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">quo_pos</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">B</span> <span class="bp">/</span> <span class="n">A</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">B</span> <span class="bp">/</span> <span class="n">A</span> <span class="bp">≤</span> <span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:</span>
  <span class="bp">-</span><span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">≤</span>
    <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">B</span> <span class="bp">/</span> <span class="n">A</span> <span class="bp">-</span> <span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
    <span class="n">sorry</span>
<span class="kd">end</span>

<span class="kd">lemma</span> <span class="n">simple_inequality</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
    <span class="n">sorry</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220251327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220251327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220251327">(Dec 17 2020 at 14:44)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a> ? ;-)</p>



<a name="220251464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220251464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220251464">(Dec 17 2020 at 14:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">difficult_equality</span> <span class="o">{</span><span class="n">x</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span>
  <span class="bp">-</span><span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span>
         <span class="o">(</span><span class="n">c</span><span class="bp">^</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span>
            <span class="o">((</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">c</span><span class="bp">^</span><span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="n">c</span><span class="bp">^</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">((</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span><span class="bp">^</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">))</span> <span class="bp">-</span>
      <span class="o">((</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">c</span><span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">ring_exp</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220251618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220251618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220251618">(Dec 17 2020 at 14:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220251327">said</a>:</p>
<blockquote>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a> ? ;-)</p>
</blockquote>
<p>I copy/pasted for a file I had made to prepare this question, and forgot the two first lines! I fixed it now...</p>



<a name="220251671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220251671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220251671">(Dec 17 2020 at 14:47)</a>:</h4>
<p>Oh! <code>ring_exp</code>! Just learned a new tactic...</p>



<a name="220252504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220252504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220252504">(Dec 17 2020 at 14:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220251464">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">begin</span>
  <span class="n">ring_exp</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I've updated the original question with a <code>original_difficult_equality</code> challenge, which was what I encountered originally. Of course, once you have <code>difficult_equality</code> then you can solve the origional one with <code>exact_mod_cast @difficult_equality  x (cos x) n</code>. But is there an easier tactic way for this? You just need to use that cos x is real...</p>



<a name="220252653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220252653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220252653">(Dec 17 2020 at 14:55)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">simple_inequality</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">convert</span> <span class="n">mul_le_mul_of_nonneg_left</span> <span class="n">h2</span>
    <span class="o">(</span><span class="k">show</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">≤</span> <span class="mi">2</span><span class="o">,</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">),</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">nat.succ_ne_zero</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_div_assoc'</span><span class="o">,</span> <span class="n">div_eq_div_iff</span><span class="o">],</span>
  <span class="o">{</span> <span class="n">ring</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">mul_ne_zero</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">assumption_mod_cast</span><span class="o">)</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="n">mul_ne_zero</span> <span class="o">(</span><span class="kd">by</span> <span class="n">norm_num</span><span class="o">)</span> <span class="o">(</span><span class="kd">by</span> <span class="n">assumption_mod_cast</span><span class="o">)</span> <span class="o">},</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220253175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220253175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220253175">(Dec 17 2020 at 14:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>  Are you implying that I should consider this an admissible proof for an argument that is just "divide both sides by 2" ?</p>



<a name="220253176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220253176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220253176">(Dec 17 2020 at 14:59)</a>:</h4>
<p>(I would be surprised if <code>analysis.special_functions.trigonometric</code> didn't import <code>data.real.basic</code> ;-) )</p>



<a name="220253349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220253349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220253349">(Dec 17 2020 at 15:00)</a>:</h4>
<p>yeah I'm sure we can do better with that one. What's the lemma? <del><code>a/(2*b)=2*a/b</code> right?</del> I totally agree.</p>



<a name="220253735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220253735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220253735">(Dec 17 2020 at 15:03)</a>:</h4>
<p>It's <code>a &lt;= b / (d * c) -&gt; d * a &lt;= b / c</code> or something. I bet that's not in there. But a &lt;= x/d -&gt; d * a &lt;= x will be. Division is hard, you have to prove you're not dividing by zero. You omitted that part in your argument. What I'm saying is that in your _statement_ there is already some mathematics, namely the implicit assertion that what you write makes sense. As a mathematician you forget that this is part of the argument.</p>



<a name="220253847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220253847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220253847">(Dec 17 2020 at 15:04)</a>:</h4>
<p>"Just dividing both sides by 2" is under half of the proof. The rest is making sure that what you write has mathematical meaning.</p>



<a name="220253850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220253850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220253850">(Dec 17 2020 at 15:04)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">simple_inequality</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">8</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="bp">↑</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">le_div_iff</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">le_div_iff</span> <span class="n">at</span> <span class="n">h2</span><span class="o">,</span>
  <span class="o">{</span><span class="n">linarith</span><span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">norm_cast</span><span class="o">,</span> <span class="n">linarith</span><span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220254050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254050">(Dec 17 2020 at 15:06)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">le_div_iff</span> <span class="n">at</span> <span class="bp">⊢</span> <span class="n">h2</span><span class="o">,</span>
  <span class="o">{</span><span class="n">linarith</span><span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">norm_cast</span><span class="o">,</span> <span class="n">linarith</span><span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220254094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254094">(Dec 17 2020 at 15:06)</a>:</h4>
<p>I like these a bit better <span class="user-mention" data-user-id="110596">@Rob Lewis</span> and <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> ...</p>



<a name="220254135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254135">(Dec 17 2020 at 15:07)</a>:</h4>
<p><code>le_div_iff</code> gives <code>a &lt;= x/d -&gt; a * d &lt;= x</code> which is what I should have used in the first place.</p>



<a name="220254201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254201">(Dec 17 2020 at 15:08)</a>:</h4>
<p>Yes, I was now trying to add <code>0 &lt; 2</code> to the list of assumptions and see if Lean could figure out the proof by itself.</p>



<a name="220254278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254278">(Dec 17 2020 at 15:08)</a>:</h4>
<p>One and a half more to go ;-).</p>



<a name="220254282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254282">(Dec 17 2020 at 15:08)</a>:</h4>
<p>it would be great if we could have some sort of <code>tidy_ineq_basher</code> that would "try the obvious things" and call <code>norm_num</code> and <code>linarith</code> when needed. And then spit out a proof-script that is reasonably fast.</p>



<a name="220254286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254286">(Dec 17 2020 at 15:08)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">original_difficult_inequality</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">-</span><span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span>
         <span class="o">(</span><span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">-</span>
            <span class="bp">↑</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">*</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="bp">↑</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span><span class="o">))</span> <span class="bp">-</span>
      <span class="bp">↑</span><span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">^</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">generalize</span> <span class="o">:</span> <span class="n">cos</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">c</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="n">ring_exp</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220254394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254394">(Dec 17 2020 at 15:09)</a>:</h4>
<p><del>Is <code>annoying_inequality</code> true? What's the maths proof?</del> Oh, I missed the x on the denominator, I thought we had an x^3 not cancelling with an x^2</p>



<a name="220254653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254653">(Dec 17 2020 at 15:11)</a>:</h4>
<p>Two new tactics today, I didn't know about <code>generalize</code> either, it looks like it's really handy to remove clutter...</p>



<a name="220254855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254855">(Dec 17 2020 at 15:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220254282">said</a>:</p>
<blockquote>
<p>it would be great if we could have some sort of <code>tidy_ineq_basher</code> that would "try the obvious things" and call <code>norm_num</code> and <code>linarith</code> when needed. And then spit out a proof-script that is reasonably fast.</p>
</blockquote>
<p>I was thinking about this... also for <code>field_simp</code> it would be useful that it gave you feedback on which things it tried to invert but failed because it didn't know they were nonzero. You could then try to add those manually.</p>



<a name="220254908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220254908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220254908">(Dec 17 2020 at 15:13)</a>:</h4>
<p><code>field_simp</code> does give you that feedback -- just look at the denominators it leaves behind.</p>



<a name="220255245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255245">(Dec 17 2020 at 15:15)</a>:</h4>
<p>Well, it doesn't try very hard at those. You'd expect that it'd know that (2:\R) was nonzero. But fine, I know that "this is not the job of field_simp"...</p>



<a name="220255349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255349">(Dec 17 2020 at 15:16)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">annoying_inequality</span> <span class="o">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">(</span><span class="n">quo_pos</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">B</span> <span class="bp">/</span> <span class="n">A</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">B</span> <span class="bp">/</span> <span class="n">A</span> <span class="bp">≤</span> <span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="o">:</span>
  <span class="bp">-</span><span class="o">(</span><span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">*</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">≤</span>
    <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">^</span><span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">B</span> <span class="bp">/</span> <span class="n">A</span> <span class="bp">-</span> <span class="n">x</span><span class="bp">^</span><span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">h24</span> <span class="o">:</span> <span class="o">(</span><span class="mi">24</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span><span class="o">,</span>
    <span class="n">field_simp</span> <span class="o">[</span><span class="n">hx</span><span class="o">,</span> <span class="n">h24</span><span class="o">],</span> <span class="n">ring</span><span class="o">,</span>
  <span class="n">linarith</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220255514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255514">(Dec 17 2020 at 15:17)</a>:</h4>
<p>Of course some part of Lean's system can prove easily that 2 isn't 0. But not all parts of Lean's system talk to all other parts at all times, because this would just cause chaos. You are falling into a trap which I used to fall into a lot -- "it's obvious, so why doesn't Lean do it automatically?". Making Lean do all obvious things automatically would just make it stop working, because there are 10000 things which are obvious to you as a professional number theorist.</p>



<a name="220255516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255516">(Dec 17 2020 at 15:17)</a>:</h4>
<p>It's not the job of <code>field_simp</code>, but that doesn't mean that there can't be another tactic that does this for us.</p>



<a name="220255666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255666">(Dec 17 2020 at 15:18)</a>:</h4>
<p>It just means that we need higher-level "conductor" tactics, that direct the lower-level ones</p>



<a name="220255740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255740">(Dec 17 2020 at 15:18)</a>:</h4>
<p>Those "conductor" tactics will probably be slow. So they should have a <code>?</code> option to print the proof-script they found in lower-level tactics.</p>



<a name="220255813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255813">(Dec 17 2020 at 15:19)</a>:</h4>
<p>Like Mario says about metamath: you don't want <code>omega</code> in your proof. You should run it once, and store the output.</p>



<a name="220255953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255953">(Dec 17 2020 at 15:20)</a>:</h4>
<p>Unfortunately, I have no idea how to write these conductor-tactics. But I think they will be a huge win for these kinds of computations.</p>



<a name="220255974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220255974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220255974">(Dec 17 2020 at 15:20)</a>:</h4>
<p>Kevin, I understand your point, I had read it from you somewhere else. But as Johan says, there should be higher-level tactics that do this. The examples I gave you showed up as simple calc steps, I already broke it up in simple bits. But these ones caused a lot of pain.</p>



<a name="220256090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256090">(Dec 17 2020 at 15:21)</a>:</h4>
<p><span class="user-mention" data-user-id="254058">@Marc Masdeu</span> if you want to learn how to write a tactic, then you could write <code>field_simp2</code> which was <code>field_simp</code> but in addition looked through the local context to find any hypotheses of the form <code>x ≠ 0</code> and added them to some list, and also looked through all denominators which were nonzero numerals  and added them automatically to the list, and then applied <code>field_simp</code> with that list. And then the moment you did this you'd have someone complainining that they have a hypothesis <code>A != B</code> and your stupid tactic didn't know that <code>A - B</code> was non-zero. So then you fix this and you have someone else complaining that your stupid tactic doesn't know that <code>x^2+37 != 0</code> where x is a rational. Can't you see? It never ends! If you learn how to write tactics you can write your own tactics which are minor extensions of the basic ones, and these minor extensions are not hard to write.</p>



<a name="220256192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256192">(Dec 17 2020 at 15:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220255953">said</a>:</p>
<blockquote>
<p>Unfortunately, I have no idea how to write these conductor-tactics. But I think they will be a huge win for these kinds of computations.</p>
</blockquote>
<p>My feeling is that this would allow more people to jump in and proving things. I have 900-line proof of this very simple result (Euler summation). On a pdf it takes 3 pages, which could easily be condensed to one or two. I tell this to my colleagues and they laugh at it...</p>



<a name="220256257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256257">(Dec 17 2020 at 15:22)</a>:</h4>
<p>But this is the second time in the last few days that numerals being non-zero not being known by <code>field_simp</code> has come up and it would not be hard to fix.</p>



<a name="220256300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256300">(Dec 17 2020 at 15:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> "it never ends" but we should do it anyway</p>



<a name="220256309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256309">(Dec 17 2020 at 15:22)</a>:</h4>
<p>Take the LaTeX file and compare it to the size of the Lean file. What's the ratio?</p>



<a name="220256358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256358">(Dec 17 2020 at 15:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> is this something for <code>norm_num</code> plugins? Or should it rather be a new higher-level tactic?</p>



<a name="220256384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256384">(Dec 17 2020 at 15:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220256309">said</a>:</p>
<blockquote>
<p>Take the LaTeX file and compare it to the size of the Lean file. What's the ratio?</p>
</blockquote>
<p>After <code>gzip</code>ing right?</p>



<a name="220256452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256452">(Dec 17 2020 at 15:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220256309">said</a>:</p>
<blockquote>
<p>Take the LaTeX file and compare it to the size of the Lean file. What's the ratio?</p>
</blockquote>
<p>It's not the size, but how long it takes to type up what matters. And I better not tell you how long it has taken me to type the proof up...</p>



<a name="220256467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256467">(Dec 17 2020 at 15:23)</a>:</h4>
<p>Usually these things are around 4. But also remember that you are an expert in writing pdfs and a relative newcomer for writing Lean proofs.</p>



<a name="220256565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256565">(Dec 17 2020 at 15:24)</a>:</h4>
<p>Writing Lean proofs like this is a really good way to learn though.</p>



<a name="220256613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256613">(Dec 17 2020 at 15:24)</a>:</h4>
<p>(relative newcomer in the sense that you've been doing maths in LaTeX for a <em>lot</em> longer!)</p>



<a name="220256725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256725">(Dec 17 2020 at 15:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220256613">said</a>:</p>
<blockquote>
<p>(relative newcomer in the sense that you've been doing maths in LaTeX for a <em>lot</em> longer!)</p>
</blockquote>
<p>Don't worry, I wouldn't take offense <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="220256741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256741">(Dec 17 2020 at 15:25)</a>:</h4>
<p><span class="user-mention" data-user-id="254058">@Marc Masdeu</span> we should think more carefully about how to make <code>field_simp</code> better because I absolutely do agree that you have a point.</p>



<a name="220256830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256830">(Dec 17 2020 at 15:26)</a>:</h4>
<p>I mostly agree this because it's the second time it has come up in the last week.</p>



<a name="220256895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256895">(Dec 17 2020 at 15:26)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">have</span> <span class="n">h24</span> <span class="o">:</span> <span class="o">(</span><span class="mi">24</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span><span class="o">,</span>
    <span class="n">field_simp</span> <span class="o">[</span><span class="n">hx</span><span class="o">,</span> <span class="n">h24</span><span class="o">],</span> <span class="n">ring</span><span class="o">,</span>
</code></pre></div>
<p>takes four tactics to solve</p>



<a name="220256945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220256945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220256945">(Dec 17 2020 at 15:27)</a>:</h4>
<p>And I'd like to learn how to write tactics. I hoped that by giving some challenges the tactic-writers would take the hint...</p>



<a name="220257170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220257170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220257170">(Dec 17 2020 at 15:28)</a>:</h4>
<p>It's difficult for me to know how hard these are in practice because I am not a tactic-writer. In the first part of one of my whingey messages above I was saying that all you have to do in this case is to look for (a) things of the form "x \ne 0" in the local context, and (b) nonzero numerals in the local context, but maybe it's even easier.</p>



<a name="220257219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220257219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220257219">(Dec 17 2020 at 15:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220256830">said</a>:</p>
<blockquote>
<p>I mostly agree this because it's the second time it has come up in the last week.</p>
</blockquote>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> make sure that it wasn't a close relative of mine who came up with the problem...</p>



<a name="220257475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220257475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220257475">(Dec 17 2020 at 15:30)</a>:</h4>
<p>One could envisage a general "prove that this is non-zero" tactic, which given a hypothesis <code>hx : x != 0</code> manages to prove automatically that <code>24*x != 0</code> and, because this is a denominator in the goal, feeds this into <code>field_simp</code> which makes <code>field_simp</code> work better.</p>



<a name="220257738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220257738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220257738">(Dec 17 2020 at 15:32)</a>:</h4>
<p>I guess that one could try to write a tactic that decides formulas in the language of real closed fields... but this sounds like quite a big effort. And it will be slow if it isn't written by an expert. Also, it might not give short witnesses that can replace the tactic call.</p>



<a name="220257745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220257745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220257745">(Dec 17 2020 at 15:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="254058">Marc Masdeu</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220256945">said</a>:</p>
<blockquote>
<p>And I'd like to learn how to write tactics. I hoped that by giving some challenges the tactic-writers would take the hint...</p>
</blockquote>
<p>You should make an issue on mathlib's github page (tagged with meta, and easy / medium or something) then so the hint isan't lost to time!</p>



<a name="220257762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220257762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Masdeu <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220257762">(Dec 17 2020 at 15:32)</a>:</h4>
<p>I'll look at the tactics videos that are around and see if I can make sense of it...</p>



<a name="220258041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258041">(Dec 17 2020 at 15:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> We should probably have a <code>IMOkid</code> tactic that just knows all the standard IMO tricks for solving inequalities.<br>
That tactic doesn't need to be able to tackle every IMO inequality ever. If it tackles 70% that will already be very helpful.</p>



<a name="220258084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258084">(Dec 17 2020 at 15:34)</a>:</h4>
<p>Opportunistic automation.</p>



<a name="220258141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258141">(Dec 17 2020 at 15:34)</a>:</h4>
<p>I see. I think I am proposing a <code>clear_denom</code> tactic, which acts on goals of the form <code>a / b = c / d</code> or <code>a / b = c</code> and tries to reduce them to the form <code>a * d = b * c</code> or <code>a * c = b</code>, closing the auxiliary goals which show up (denominators != 0) by applying a simple <code>show_nonzero</code> tactic which looks through the local context, applies things like <code>mul_nonzero</code> and that numerals other than zero are non-zero. And then there's a natural <code>field</code> tactic, which applies <code>field_simp</code> and then <code>clear_denom</code> and then <code>ring</code>. <span class="user-mention" data-user-id="110596">@Rob Lewis</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> is this as simple as it looks or am I missing something? Of course it won't work in every case but it might be a step in the right direction for people like Marc.</p>



<a name="220258245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258245">(Dec 17 2020 at 15:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220256358">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> is this something for <code>norm_num</code> plugins? Or should it rather be a new higher-level tactic?</p>
</blockquote>
<p>Is what? I see a lot of things in this thread, but not much that is actionable as a tactic-writer. What's the tactic supposed to do?</p>



<a name="220258273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258273">(Dec 17 2020 at 15:35)</a>:</h4>
<p>We already have <code>nlinarith</code> which is surprisingly good! Rob was just "well I'll assume squares are non-negative and that's it" and I'm thinking "that won't buy us much" but actually it bought us lots!</p>



<a name="220258428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258428">(Dec 17 2020 at 15:36)</a>:</h4>
<p><code>show_nonzero</code> is an opportunistic attempt to show things are non-zero by checking they're a product of things known to be nonzero. <code>clear_denom</code> clears denominators using <code>show_nonzero</code>.</p>



<a name="220258510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258510">(Dec 17 2020 at 15:37)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> My understanding was that this is what field_simp is supposed to do</p>



<a name="220258553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258553">(Dec 17 2020 at 15:37)</a>:</h4>
<p>but it doesn't seem to deal with denominators.</p>



<a name="220258748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258748">(Dec 17 2020 at 15:38)</a>:</h4>
<p>it deals with them, if you pass proofs that things are nonzero.<br>
Kevin wants a tactic that is like <code>field_simp</code>, but proves by itself that denoms are nonzero.</p>



<a name="220258760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258760">(Dec 17 2020 at 15:38)</a>:</h4>
<p>In the docstring it says "If the goal is an equality, this simpset will also clear the denominators" but it won't deal with <code>24*x</code> if <code>x != 0</code> is in the local context, because it doesn't know 24 != 0 and it's irritating to have to tell it this -- <code>ring</code> doesn't need to be told it.</p>



<a name="220258879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258879">(Dec 17 2020 at 15:39)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">24</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span> <span class="c1">-- works</span>
</code></pre></div>



<a name="220258915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258915">(Dec 17 2020 at 15:40)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">24</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">field_simp</span><span class="o">,</span> <span class="c1">-- simplify tactic failed to simplify</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220258965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220258965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220258965">(Dec 17 2020 at 15:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220258245">said</a>:</p>
<blockquote>
<p>Is what? I see a lot of things in this thread, but not much that is actionable as a tactic-writer. What's the tactic supposed to do?</p>
</blockquote>
<p>we just want a tactic that takes the goals that Marc posted above, and outputs the proof scripts that Kevin wrote himself (also posted above)</p>



<a name="220259007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259007">(Dec 17 2020 at 15:40)</a>:</h4>
<p>Okay so show_nonzero is something like <code>apply_rules</code> with:</p>
<ul>
<li><code>a != 0 -&gt; b != 0 -&gt; a * b != 0</code></li>
<li><code>n != 0</code> for n a numeral -&gt; call norm_num</li>
<li><code> \u a != 0</code> -&gt; call norm_cast</li>
</ul>



<a name="220259032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259032">(Dec 17 2020 at 15:40)</a>:</h4>
<p>and also look in the local context?</p>



<a name="220259077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259077">(Dec 17 2020 at 15:41)</a>:</h4>
<p>and <code>assumption</code> at every stage</p>



<a name="220259094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259094">(Dec 17 2020 at 15:41)</a>:</h4>
<p>got it</p>



<a name="220259461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259461">(Dec 17 2020 at 15:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220258965">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220258245">said</a>:</p>
<blockquote>
<p>Is what? I see a lot of things in this thread, but not much that is actionable as a tactic-writer. What's the tactic supposed to do?</p>
</blockquote>
<p>we just want a tactic that takes the goals that Marc posted above, and outputs the proof scripts that Kevin wrote himself (also posted above)</p>
</blockquote>
<p>I suspected you would say that. That's not what I would call actionable, because I'm not clever enough to invent an algorithm that will solve arbitrarily complicated combinations of things</p>



<a name="220259534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259534">(Dec 17 2020 at 15:44)</a>:</h4>
<p>Kevin's suggestion looks like a tactic though</p>



<a name="220259734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259734">(Dec 17 2020 at 15:45)</a>:</h4>
<p>Can someone remind me how to write a tactic which just runs a tactic script? For example if I want to write a tactic which does <code>rw add_comm, simp, ring</code>, how do I make that into one tactic?</p>



<a name="220259862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shing Tak Lam <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259862">(Dec 17 2020 at 15:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220259734">said</a>:</p>
<blockquote>
<p>Can someone remind me how to write a tactic which just runs a tactic script? For example if I want to write a tactic which does <code>rw add_comm, simp, ring</code>, how do I make that into one tactic?</p>
</blockquote>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span><span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ring</span><span class="o">]</span>
</code></pre></div>



<a name="220259870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259870">(Dec 17 2020 at 15:46)</a>:</h4>
<p>There is some ludicrously simple way to do this involving some number of backticks but I can never remember where it is and my</p>



<a name="220259884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220259884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220259884">(Dec 17 2020 at 15:47)</a>:</h4>
<p>thanks</p>



<a name="220260053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220260053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220260053">(Dec 17 2020 at 15:48)</a>:</h4>
<p>...my last attempt to get an example such as this into <code>extras/tactic_writing.html</code> failed for some reason I can't remember</p>



<a name="220260104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220260104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220260104">(Dec 17 2020 at 15:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220257738">said</a>:</p>
<blockquote>
<p>I guess that one could try to write a tactic that decides formulas in the language of real closed fields... but this sounds like quite a big effort. And it will be slow if it isn't written by an expert. Also, it might not give short witnesses that can replace the tactic call.</p>
</blockquote>
<p>This is certainly a big effort, will probably be slow even if written by an expert, and I'm not aware of a good certificate format. <a href="https://www.cl.cam.ac.uk/~jrh13/papers/cade05.pdf">https://www.cl.cam.ac.uk/~jrh13/papers/cade05.pdf</a></p>



<a name="220260350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220260350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220260350">(Dec 17 2020 at 15:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220260053">said</a>:</p>
<blockquote>
<p>...my last attempt to get an example such as this into <code>extras/tactic_writing.html</code> failed for some reason I can't remember</p>
</blockquote>
<p><a href="https://leanprover-community.github.io/extras/tactic_writing.html#marios-backtick-cheat-sheet">https://leanprover-community.github.io/extras/tactic_writing.html#marios-backtick-cheat-sheet</a> last bullet point?</p>



<a name="220260608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220260608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220260608">(Dec 17 2020 at 15:52)</a>:</h4>
<p>How can I tell <code>apply_rules</code> to try <code>norm_num</code>?</p>



<a name="220260776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220260776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220260776">(Dec 17 2020 at 15:53)</a>:</h4>
<blockquote>
<p><a href="https://leanprover-community.github.io/extras/tactic_writing.html#marios-backtick-cheat-sheet">https://leanprover-community.github.io/extras/tactic_writing.html#marios-backtick-cheat-sheet</a> last bullet point?</p>
</blockquote>
<p>I would have noticed it if there had been an example, I suspect. Maybe I should write one!</p>



<a name="220260899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220260899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220260899">(Dec 17 2020 at 15:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220260608">said</a>:</p>
<blockquote>
<p>How can I tell <code>apply_rules</code> to try <code>norm_num</code>?</p>
</blockquote>
<p>hmm, maybe I should just do it afterwards.</p>



<a name="220261297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261297">(Dec 17 2020 at 15:56)</a>:</h4>
<p>i would be very happy if field_simp could solve things like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">1</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">a</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span><span class="bp">-</span><span class="n">a</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">field_simp</span> <span class="o">[</span><span class="n">h</span><span class="o">],</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220261388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261388">(Dec 17 2020 at 15:57)</a>:</h4>
<p>and also <code>a - 1</code>? :-/</p>



<a name="220261451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261451">(Dec 17 2020 at 15:57)</a>:</h4>
<p>?</p>



<a name="220261545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261545">(Dec 17 2020 at 15:58)</a>:</h4>
<p>If <code>h : A != B</code> then you want to know both that <code>A - B != 0</code> and that <code>B - A != 0</code></p>



<a name="220261566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261566">(Dec 17 2020 at 15:58)</a>:</h4>
<p>Oh yeah sure :)</p>



<a name="220261588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261588">(Dec 17 2020 at 15:58)</a>:</h4>
<p>and tomorrow you'll want to know that if <code>A &lt; B</code> then also <code>A - B != 0</code> and <code>B - A != 0</code></p>



<a name="220261757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261757">(Dec 17 2020 at 16:00)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.real.basic</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">rw</span> <span class="n">div_eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">rw</span> <span class="n">eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span> <span class="n">ring</span> <span class="o">},</span>
  <span class="n">apply_rules</span> <span class="o">[</span><span class="n">mul_ne_zero</span><span class="o">],</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">norm_num</span><span class="o">}},</span>
<span class="kd">end</span> <span class="c1">-- works</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">clear_denoms</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">rw</span> <span class="n">div_eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">rw</span> <span class="n">eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span> <span class="n">ring</span> <span class="o">},</span>
  <span class="n">apply_rules</span> <span class="o">[</span><span class="n">mul_ne_zero</span><span class="o">],</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">norm_num</span><span class="o">}},</span>
<span class="o">]</span> <span class="c1">-- incomprehensible error</span>
</code></pre></div>
<p>:-(</p>



<a name="220261913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220261913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220261913">(Dec 17 2020 at 16:00)</a>:</h4>
<p>aah, it's the trailing <code>,</code></p>



<a name="220262551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220262551" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220262551">(Dec 17 2020 at 16:05)</a>:</h4>
<p>nice!</p>



<a name="220262580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220262580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220262580">(Dec 17 2020 at 16:05)</a>:</h4>
<p>this should probably be plugged into the generic machinery that Scott wrote for tidy</p>



<a name="220262660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220262660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220262660">(Dec 17 2020 at 16:06)</a>:</h4>
<p>Like, <code>tidy</code> is implemented using <code>tactic.chain</code>, and maybe this should also use that.</p>



<a name="220263283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220263283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220263283">(Dec 17 2020 at 16:10)</a>:</h4>
<p>lol there's already a <code>field</code> tactic!</p>



<a name="220263307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220263307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220263307">(Dec 17 2020 at 16:11)</a>:</h4>
<p>Not sure it's the same fields though</p>



<a name="220264277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220264277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220264277">(Dec 17 2020 at 16:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220263283">said</a>:</p>
<blockquote>
<p>lol there's already a <code>field</code> tactic!</p>
</blockquote>
<p>It's completely undocumented <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span></p>



<a name="220264310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220264310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220264310">(Dec 17 2020 at 16:16)</a>:</h4>
<p>From the tests:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">my_semigroup</span> <span class="o">:=</span> <span class="n">semigroup</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">mul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">false</span><span class="o">)</span> <span class="o">:</span> <span class="n">my_semigroup</span> <span class="n">α</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">refine_struct</span> <span class="o">{</span> <span class="n">mul</span> <span class="o">:=</span> <span class="n">mul</span><span class="o">,</span> <span class="bp">..</span> <span class="o">},</span>
  <span class="n">field</span> <span class="n">mul_assoc</span> <span class="o">{</span>
    <span class="n">guard_target</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">mul</span> <span class="o">(</span><span class="n">mul</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">mul</span> <span class="n">a</span> <span class="o">(</span><span class="n">mul</span> <span class="n">b</span> <span class="n">c</span><span class="o">),</span>
    <span class="n">exact</span> <span class="n">h.elim</span> <span class="o">}</span>
<span class="kd">end</span>
</code></pre></div>



<a name="220264349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220264349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220264349">(Dec 17 2020 at 16:16)</a>:</h4>
<p>But it has no doc of its own and it's not mentioned in the docs for <code>refine_struct</code></p>



<a name="220264442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220264442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220264442">(Dec 17 2020 at 16:17)</a>:</h4>
<p>Do we have a tactic which turns <code>a/b*c*d/e*f</code> into X/Y?</p>



<a name="220264725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220264725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220264725">(Dec 17 2020 at 16:18)</a>:</h4>
<p>oh forget that, I think <code>field_simp</code> is fine</p>



<a name="220265052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220265052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220265052">(Dec 17 2020 at 16:21)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic</span>
<span class="kn">import</span> <span class="n">data.real.basic</span>

<span class="kn">namespace</span> <span class="n">tactic.interactive</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">show_nonzero</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span>
  <span class="n">apply_rules</span> <span class="o">[</span>
    <span class="n">mul_ne_zero</span><span class="o">,</span>
    <span class="n">sub_ne_zero.2</span><span class="o">,</span>
    <span class="n">ne.symm</span><span class="o">,</span>
    <span class="n">ne_of_gt</span><span class="o">,</span>
    <span class="n">ne_of_lt</span>
    <span class="o">],</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">try</span> <span class="o">{</span><span class="n">norm_num</span><span class="o">}}</span>
<span class="o">]</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">clear_denoms</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">rw</span> <span class="n">div_eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">rw</span> <span class="n">eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">symmetry</span><span class="o">,</span> <span class="n">rw</span> <span class="n">eq_div_iff</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span> <span class="n">ring_exp</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">show_nonzero</span><span class="o">}</span>
<span class="o">]</span>

<span class="kd">meta</span> <span class="kd">def</span> <span class="n">discrete_field</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">field_simp</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">clear_denoms</span><span class="o">},</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">ring_exp</span><span class="o">}</span>
<span class="o">]</span>

<span class="kd">end</span> <span class="n">tactic.interactive</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">discrete_field</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">field</span> <span class="n">K</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≠</span> <span class="mi">1</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">a</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span><span class="bp">-</span><span class="n">a</span><span class="o">)</span><span class="bp">⁻¹</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">inv_eq_one_div</span><span class="o">,</span>
  <span class="n">discrete_field</span><span class="o">,</span>
<span class="kd">end</span>
</code></pre></div>
<p><span class="user-mention" data-user-id="254058">@Marc Masdeu</span> <span class="user-mention" data-user-id="243562">@Adam Topaz</span></p>



<a name="220265232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220265232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220265232">(Dec 17 2020 at 16:22)</a>:</h4>
<p>just ignore the "maximal iterations reached" stuff, I have no idea what that means but the goal gets closed</p>



<a name="220267583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220267583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220267583">(Dec 17 2020 at 16:39)</a>:</h4>
<p>Not really relevant here, but with only outermost universal quantifiers it should be possible to produce proof certificates based on the Positivstellensatz.</p>



<a name="220267643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220267643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220267643">(Dec 17 2020 at 16:39)</a>:</h4>
<p>I say it's not relevant because these problems are not really any harder than checking the proof certificates</p>



<a name="220272684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220272684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220272684">(Dec 17 2020 at 17:17)</a>:</h4>
<p>in theory it seems like this should be solvable using brute force, without any mathematical understanding of this specific problem. it takes 4 tactics to solve, lean doesn't have <em>that</em> many tactics....</p>



<a name="220277916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220277916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220277916">(Dec 17 2020 at 17:51)</a>:</h4>
<p>I have already said this several times, but I'll  say it again and again, hoping it percolates to someone who can implement that. In Isabelle, there is something called simprocs: baby tactics that are applied by simp under the right conditions. Checking that a numeral is nonzero would be a perfect simproc. With this, no need for a new tactic, <code>field_simp</code> would work fine as it is just <code>simp</code> with an additional simpset.</p>



<a name="220278411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220278411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Frédéric Dupuis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220278411">(Dec 17 2020 at 17:55)</a>:</h4>
<p>I think this is one situation where Lean 4's default arguments will turn out to be very useful: we'll be able to put <code>by prove_its_nonzero</code> as the default argument in those division lemmas.</p>



<a name="220278546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220278546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Rob Lewis <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220278546">(Dec 17 2020 at 17:56)</a>:</h4>
<p>In this case it could be achieved by using a different discharger in <code>field_simp</code>, right? Not a full simp proc. If <code>field_simp</code> were something like <code>simp only using field_simps {discharger := prove_its_nonzero &lt;|&gt; default_discharger}</code> wouldn't that achieve what you want?</p>



<a name="220281645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220281645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220281645">(Dec 17 2020 at 18:21)</a>:</h4>
<p>simprocs are a rather fundamental change to the way simp works, and so I don't expect it to happen in lean 3. Perhaps we should put that on the todo list for lean 4 <code>simp</code></p>



<a name="220295801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220295801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220295801">(Dec 17 2020 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating/near/220278546">said</a>:</p>
<blockquote>
<p>In this case it could be achieved by using a different discharger in <code>field_simp</code>, right? Not a full simp proc. If <code>field_simp</code> were something like <code>simp only using field_simps {discharger := prove_its_nonzero &lt;|&gt; default_discharger}</code> wouldn't that achieve what you want?</p>
</blockquote>
<p>I didn't even know this existed!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">field_simp</span> <span class="o">[</span><span class="bp">-</span><span class="n">mul_eq_zero</span><span class="o">,</span> <span class="n">mul_ne_zero</span><span class="o">]</span> <span class="o">{</span><span class="n">discharger</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">[</span><span class="n">assumption</span> <span class="bp">&lt;|&gt;</span> <span class="n">norm_num</span><span class="o">]},</span>
  <span class="n">ring</span>
<span class="kd">end</span>
</code></pre></div>
<p>works fine.</p>



<a name="220297000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220297000" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220297000">(Dec 17 2020 at 20:23)</a>:</h4>
<p>I didn't know this existed either!  Is there any reason not to rewrite <code>field_simp</code> so that this "discharger" is there by default?  I would say that 50% of the time I use <code>field_simp</code> there's a numeric constant around which I need to use <code>norm_num</code> for.</p>



<a name="220297555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220297555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220297555">(Dec 17 2020 at 20:28)</a>:</h4>
<p>I'm on it. I need to practice a little bit my tactic fu, but I'll get there :-)</p>



<a name="220298679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220298679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220298679">(Dec 17 2020 at 20:36)</a>:</h4>
<p>Will this make things easier, though?  Currently I would solve a goal like this as follows:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">3</span> <span class="bp">*</span> <span class="mi">2</span> <span class="bp">/</span> <span class="o">(</span><span class="mi">24</span> <span class="bp">*</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">/</span> <span class="mi">6</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="o">(</span><span class="mi">24</span><span class="o">:</span><span class="n">ℝ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="o">(</span><span class="mi">6</span><span class="o">:</span><span class="n">ℝ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">norm_num</span><span class="o">,</span>
  <span class="n">field_simp</span> <span class="o">[</span><span class="n">hx</span><span class="o">,</span> <span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">],</span>
  <span class="n">ring</span>
<span class="kd">end</span>
</code></pre></div>
<p>and in particular there's no need to remember the names of the lemmas <code>mul_eq_zero</code> and <code>mul_ne_zero</code>; <code>field_simp</code> takes care of this for me.  In the new version of the tactic, does one need to mention such lemmas explicitly?</p>



<a name="220299170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220299170" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220299170">(Dec 17 2020 at 20:40)</a>:</h4>
<p>It will just be <code>by { field_simp, ring }</code>.</p>



<a name="220300694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220300694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220300694">(Dec 17 2020 at 20:52)</a>:</h4>
<p>And will it still be possible to pass extra nonzero-facts as hypotheses?  <code>field_simp [ne_of_gt (norm_pos_iff.mpr ha)]</code>, etc.</p>



<a name="220300733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220300733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220300733">(Dec 17 2020 at 20:52)</a>:</h4>
<p>Sure.</p>



<a name="220300776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220300776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220300776">(Dec 17 2020 at 20:52)</a>:</h4>
<p>OK, great!</p>



<a name="220353363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220353363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220353363">(Dec 18 2020 at 09:54)</a>:</h4>
<p>I'm late to the party, but I want to write that I agree with everything Marc wrote. All this is incredibly painful, and the fact that we can golf the proofs is not at all the right measure of performance of Lean+mathlib here. Formalization time is the right one. This is simply yet another proof that we are very very far from having a usable tool.</p>



<a name="220360750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220360750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220360750">(Dec 18 2020 at 11:22)</a>:</h4>
<p>To add to this data point, I met with Ashvni this morning who is doing some combinatorial stuff related to Bernouilli numbers, and she wanted an identity of products of binomial coefficients which turned into an equality of ratios of factorials which was trivial modulo <code>factorial_ne_zero</code> applied four times. Maybe some <code>ne_zero</code> lemmas could be tagged in some way and fed into this?</p>



<a name="220371558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220371558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220371558">(Dec 18 2020 at 13:28)</a>:</h4>
<p>If you have a mwe, I can check if tagging <code>factorial_ne_zero</code> with <code>field_simp</code> is enough here. Or you can try it yourself, with <code>attribute [field_simps] factorial_ne_zero</code>.</p>



<a name="220372763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Solving%20simple%20%28in%29equalities%20gets%20frustrating/near/220372763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Solving.20simple.20(in)equalities.20gets.20frustrating.html#220372763">(Dec 18 2020 at 13:40)</a>:</h4>
<p>I don't think <code>norm_num</code> should literally be the discharger. That entry point includes a lot of unnecessary simp. I think the discharger should be custom built to identify <code>numeral != 0</code> goals and call the internal norm_num function for this directly</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>