---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/Help.20with.20lean.2Envim.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html">Help with lean.nvim</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="286529247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Jacobsson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529247">(Jun 17 2022 at 18:53)</a>:</h4>
<p>I am trying to use the lean.nvim plugin for Neovim (0.7), but when typing <code>:LeanGoal</code> in Neovim, I get an error message <code>"LSP server not connected"</code>.</p>
<p>I have followed <a href="https://github.com/Julian/lean.nvim/tree/20a963c7601d019b3d69edbaabc22ba9ef5e4016">this</a> guide for setting up the plugin, and then also, since I didn't have a "preferred setup which includes LSP key mappings and (auto)completion", I have followed <a href="https://github.com/Julian/lean.nvim/wiki/Getting-Started">this</a> guide for setting up my <code>lean.lua</code>.</p>
<p>One guess is that there is something wrong with my lean-language-server. If I type <code>lean-language-server</code> into the terminal, I get the following message back:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">simon</span><span class="bp">@</span><span class="n">orvar</span><span class="o">:</span><span class="bp">~$</span> <span class="n">lean</span><span class="bp">-</span><span class="n">language</span><span class="bp">-</span><span class="n">server</span>
<span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="n">language</span><span class="bp">-</span><span class="n">server</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">-</span><span class="n">languageserver</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">main.js</span><span class="o">:</span><span class="mi">185</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="o">(</span><span class="bp">'</span><span class="n">Connection</span> <span class="n">input</span> <span class="n">stream</span> <span class="n">is</span> <span class="n">not</span> <span class="n">set.</span> <span class="bp">'</span> <span class="bp">+</span> <span class="n">commandLineMessage</span><span class="o">)</span><span class="bp">;</span>
        <span class="bp">^</span>

<span class="n">Error</span><span class="o">:</span> <span class="n">Connection</span> <span class="n">input</span> <span class="n">stream</span> <span class="n">is</span> <span class="n">not</span> <span class="n">set.</span> <span class="n">Use</span> <span class="n">arguments</span> <span class="n">of</span> <span class="n">createConnection</span> <span class="n">or</span> <span class="n">set</span> <span class="n">command</span> <span class="n">line</span> <span class="kd">parameters</span><span class="o">:</span> <span class="bp">'</span><span class="c1">--node-ipc', '--stdio' or '--socket={number}'</span>
    <span class="n">at</span> <span class="n">_createConnection</span> <span class="o">(</span><span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="n">language</span><span class="bp">-</span><span class="n">server</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">-</span><span class="n">languageserver</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">main.js</span><span class="o">:</span><span class="mi">185</span><span class="o">:</span><span class="mi">15</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Object.createConnection</span> <span class="o">(</span><span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="n">language</span><span class="bp">-</span><span class="n">server</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">-</span><span class="n">languageserver</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">main.js</span><span class="o">:</span><span class="mi">132</span><span class="o">:</span><span class="mi">12</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Object.</span><span class="bp">&lt;</span><span class="n">anonymous</span><span class="bp">&gt;</span> <span class="o">(</span><span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">node_modules</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="n">language</span><span class="bp">-</span><span class="n">server</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">index.js</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mi">27</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Module._compile</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">modules</span><span class="bp">/</span><span class="n">cjs</span><span class="bp">/</span><span class="n">loader</span><span class="o">:</span><span class="mi">1105</span><span class="o">:</span><span class="mi">14</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Module._extensions..js</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">modules</span><span class="bp">/</span><span class="n">cjs</span><span class="bp">/</span><span class="n">loader</span><span class="o">:</span><span class="mi">1159</span><span class="o">:</span><span class="mi">10</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Module.load</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">modules</span><span class="bp">/</span><span class="n">cjs</span><span class="bp">/</span><span class="n">loader</span><span class="o">:</span><span class="mi">981</span><span class="o">:</span><span class="mi">32</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Module._load</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">modules</span><span class="bp">/</span><span class="n">cjs</span><span class="bp">/</span><span class="n">loader</span><span class="o">:</span><span class="mi">827</span><span class="o">:</span><span class="mi">12</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Function.executeUserEntryPoint</span> <span class="o">[</span><span class="n">as</span> <span class="n">runMain</span><span class="o">]</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">modules</span><span class="bp">/</span><span class="n">run_main</span><span class="o">:</span><span class="mi">77</span><span class="o">:</span><span class="mi">12</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">main</span><span class="bp">/</span><span class="n">run_main_module</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mi">47</span>

<span class="n">Node.js</span> <span class="n">v18.2.0</span>
</code></pre></div>
<p>Possibly related, I get an error message when typing <code>&lt;LocalLeader&gt;s</code> in Neovim:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">E5108</span><span class="o">:</span> <span class="n">Error</span> <span class="n">executing</span> <span class="n">lua</span> <span class="bp">...</span><span class="n">n</span><span class="bp">/.</span><span class="n">vim</span><span class="bp">/</span><span class="n">plugged_for_nvim_0.7</span><span class="bp">/</span><span class="n">lean.nvim</span><span class="bp">/</span><span class="n">lua</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="gr">sorry</span><span class="bp">.</span><span class="n">lua</span><span class="o">:</span><span class="mi">25</span><span class="o">:</span> <span class="n">bad</span>
<span class="n">argument</span> <span class="bp">#</span><span class="mi">1</span> <span class="n">to</span> <span class="bp">'</span><span class="n">pairs'</span> <span class="o">(</span><span class="n">table</span> <span class="n">expected</span><span class="o">,</span> <span class="n">got</span> <span class="n">nil</span><span class="o">)</span>
<span class="n">stack</span> <span class="n">traceback</span><span class="o">:</span>
        <span class="o">[</span><span class="n">C</span><span class="o">]:</span> <span class="k">in</span> <span class="n">function</span> <span class="bp">'</span><span class="n">pairs'</span>
        <span class="bp">...</span><span class="n">n</span><span class="bp">/.</span><span class="n">vim</span><span class="bp">/</span><span class="n">plugged_for_nvim_0.7</span><span class="bp">/</span><span class="n">lean.nvim</span><span class="bp">/</span><span class="n">lua</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="gr">sorry</span><span class="bp">.</span><span class="n">lua</span><span class="o">:</span><span class="mi">25</span><span class="o">:</span> <span class="k">in</span> <span class="n">function</span> <span class="bp">'</span><span class="n">fill'</span>
        <span class="o">[</span><span class="n">string</span> <span class="s2">":lua"</span><span class="o">]:</span><span class="mi">1</span><span class="o">:</span> <span class="k">in</span> <span class="n">main</span> <span class="n">chunk</span>
</code></pre></div>
<p>Below is the <code>init.vim</code> I'm using.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">let</span> <span class="n">g</span><span class="o">:</span><span class="n">plugged_home</span> <span class="bp">=</span> <span class="bp">'~/.</span><span class="n">vim</span><span class="bp">/</span><span class="n">plugged_for_nvim_0.7'</span>

<span class="n">call</span> <span class="n">plug</span><span class="bp">#</span><span class="kd">begin</span><span class="o">(</span><span class="n">g</span><span class="o">:</span><span class="n">plugged_home</span><span class="o">)</span>
    <span class="n">Plug</span> <span class="bp">'</span><span class="n">Julian</span><span class="bp">/</span><span class="n">lean.nvim'</span>
    <span class="n">Plug</span> <span class="bp">'</span><span class="n">neovim</span><span class="bp">/</span><span class="n">nvim</span><span class="bp">-</span><span class="n">lspconfig'</span>
    <span class="n">Plug</span> <span class="bp">'</span><span class="n">nvim</span><span class="bp">-</span><span class="n">lua</span><span class="bp">/</span><span class="n">plenary.nvim'</span>
    <span class="n">Plug</span> <span class="bp">'</span><span class="n">hrsh7th</span><span class="bp">/</span><span class="n">nvim</span><span class="bp">-</span><span class="n">compe'</span>
<span class="n">call</span> <span class="n">plug</span><span class="bp">#</span><span class="kd">end</span><span class="o">()</span>

<span class="n">autocmd</span> <span class="n">FileType</span> <span class="n">lean</span> <span class="k">let</span> <span class="n">maplocalleader</span><span class="bp">=</span><span class="s2">"+"</span>
</code></pre></div>



<a name="286529276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Jacobsson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529276">(Jun 17 2022 at 18:53)</a>:</h4>
<p><span class="user-mention" data-user-id="321696">@Julian Berman</span></p>



<a name="286529559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529559">(Jun 17 2022 at 18:55)</a>:</h4>
<p>The <code>lean-language-server</code> error seems fine, unfortunately language servers occasionally have this tendency to be pretty unhelpful if you run them interactively and don't know what the right way to invoke them is. In this case, one needs to run <code>lean-language-server --stdio</code>, which <code>neovim</code> is going to do.</p>



<a name="286529635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529635">(Jun 17 2022 at 18:56)</a>:</h4>
<p>I'm about to jump on a call, so I may have to come back, but just to confirm, you're running <code>:LeanGoal</code> after having opened a lean file right?</p>



<a name="286529648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529648">(Jun 17 2022 at 18:56)</a>:</h4>
<p>Not just from an empty buffer?</p>



<a name="286529859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529859">(Jun 17 2022 at 18:58)</a>:</h4>
<p>Before I run, a possible problem from the crystal ball :P is you're probably opening a single file somewhere? That works fine, but the default version of Lean will be Lean 4 in that case, which you may not have installed. If I'm correct and you're just doing <code>nvim foo.lean</code>, either try first opening a file in a mathlib clone (follow the <code>leanproject get</code> instructions from the site), and if that works, we'll either be able to tell <code>lean.nvim</code> you want Lean 3 by default or you should create a project with <code>leanproject new</code>, which <code>lean.nvim</code> will then realize means you're using Lean 3.</p>



<a name="286529867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286529867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286529867">(Jun 17 2022 at 18:58)</a>:</h4>
<p>And if all the above is wrong, I'll help later.</p>



<a name="286530140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286530140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286530140">(Jun 17 2022 at 19:00)</a>:</h4>
<p>Also idly, you don't want to set <code>maplocalleader</code> in an <code>autocmd</code> like that -- I'm not even 100% sure it'll work, the way <code>localleader</code> works is via this funny macro expansion, so it's probably going to be defined too late -- but also, you almost certainly want to use the same local leader key for all your filetypes</p>



<a name="286530203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286530203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286530203">(Jun 17 2022 at 19:01)</a>:</h4>
<p>So just do it globally, e.g.: <a href="https://github.com/Julian/dotfiles/blob/main/.config/nvim/init.vim#L4">https://github.com/Julian/dotfiles/blob/main/.config/nvim/init.vim#L4</a></p>



<a name="286531834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286531834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Jacobsson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286531834">(Jun 17 2022 at 19:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321696">Julian Berman</span> <a href="#narrow/stream/113489-new-members/topic/Help.20with.20lean.2Envim/near/286529559">said</a>:</p>
<blockquote>
<p>The <code>lean-language-server</code> error seems fine, unfortunately language servers occasionally have this tendency to be pretty unhelpful if you run them interactively and don't know what the right way to invoke them is. In this case, one needs to run <code>lean-language-server --stdio</code>, which <code>neovim</code> is going to do.</p>
</blockquote>
<p>Yes, running 'lean-language-server --stdio' didn't give me any error messages.</p>



<a name="286533034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286533034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Jacobsson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286533034">(Jun 17 2022 at 19:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321696">Julian Berman</span> <a href="#narrow/stream/113489-new-members/topic/Help.20with.20lean.2Envim/near/286529859">said</a>:</p>
<blockquote>
<p>Before I run, a possible problem from the crystal ball :P is you're probably opening a single file somewhere? That works fine, but the default version of Lean will be Lean 4 in that case, which you may not have installed. If I'm correct and you're just doing <code>nvim foo.lean</code>, either try first opening a file in a mathlib clone (follow the <code>leanproject get</code> instructions from the site), and if that works, we'll either be able to tell <code>lean.nvim</code> you want Lean 3 by default or you should create a project with <code>leanproject new</code>, which <code>lean.nvim</code> will then realize means you're using Lean 3.</p>
</blockquote>
<p>You were right!<br>
I ran<code>leanproject get tutorials</code> and opened a file from there. Now I get the continuous compilation and I can go to definitions. <code>&lt;LocalLeader&gt;s</code> now also does what it should.</p>



<a name="286533556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286533556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Simon Jacobsson <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286533556">(Jun 17 2022 at 19:32)</a>:</h4>
<p>thanks alot :D</p>
<p>I did not know about <code>leanproject</code> but it seems like a sane tool.</p>



<a name="286539307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Help%20with%20lean.nvim/near/286539307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/Help.20with.20lean.2Envim.html#286539307">(Jun 17 2022 at 20:31)</a>:</h4>
<p>Great, glad to hear it. Enjoy.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>