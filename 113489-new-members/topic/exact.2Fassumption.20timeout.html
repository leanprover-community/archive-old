---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/exact.2Fassumption.20timeout.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html">exact/assumption timeout</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="270751801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270751801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270751801">(Feb 04 2022 at 18:12)</a>:</h4>
<p>In the middle of the attempted proof of <code>full_faith_surj_equiv</code> below, I get to this goal state:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">filter</span><span class="o">:</span> <span class="n">no</span> <span class="n">filter</span>
<span class="bp">▶</span> <span class="mi">1</span> <span class="n">goal</span>

<span class="n">C</span> <span class="o">:</span> <span class="n">cat</span>
<span class="n">D</span> <span class="o">:</span> <span class="n">cat</span>
<span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span>
<span class="n">fullF</span> <span class="o">:</span> <span class="n">full</span> <span class="n">F</span>
<span class="n">faithfulF</span> <span class="o">:</span> <span class="n">faithful</span> <span class="n">F</span>
<span class="n">surjF</span> <span class="o">:</span> <span class="n">essentially_surjective</span> <span class="n">F</span>
<span class="n">Ftransport</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">iso</span> <span class="n">D</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)</span> <span class="bp">→</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">c</span> <span class="n">c'</span> <span class="o">:=</span> <span class="n">full_faith_transport_iso</span> <span class="n">F</span> <span class="n">fullF</span> <span class="n">faithfulF</span>
<span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span>
<span class="n">xx</span> <span class="o">:</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">D.Id</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">))</span> <span class="bp">=</span> <span class="n">F.m</span> <span class="n">f</span>
<span class="bp">⊢</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">D.Id</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">))</span> <span class="bp">=</span> <span class="n">F.m</span> <span class="n">f</span>
</code></pre></div>
<p>Looks good. But then, using <code>assumption</code> or <code>exact xx</code> or similar gives a deterministic timeout. I'm confused by this. My impression is that the way to help with timeouts is to break things out into lemmas, which I'll try. Is there something easier that might work? Also, I'm surprised and confused that it's possible to have a term in the context with type equal to the goal <code>Prop</code>, and yet <code>assumption</code> and similar don't work easily. What's going on? Is it similar/related to "motive is not type correct" errors with <code>rw</code>? Is there some <code>eq.rec</code> kind of stuff going on in the background or something? Are definitions being unfolded for some reason? (I would guess not since there aren't any defined things in the goal... but maybe they're being hidden somehow, or maybe xx is being unfolded for some reason...?) How is it even possible for <code>exact sorry</code> to not succeed immediately? Does that mean Lean somehow doesn't know what type is supposed to go there, or something? (Replacing the whole term being worked on with <code>sorry</code> works fine, see comment.) Sorry for the long example, I don't get what's going on so I don't know how to make a smaller one.</p>
<p>(Note: the below is not the version I posted originally, it's changed to reflect changes I've made to my code at Alex B.'s suggestion.)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.ext</span>
<span class="kn">import</span> <span class="n">data.finset</span>
<span class="kd">universes</span> <span class="n">v</span> <span class="n">v1</span> <span class="n">v2</span> <span class="n">u</span> <span class="n">u1</span> <span class="n">u2</span> <span class="n">w</span>

<span class="kd">def</span> <span class="n">reverse_compose</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span>
<span class="kd">infix</span> <span class="bp">`</span>  <span class="bp">⨟</span> <span class="bp">`</span><span class="o">:</span><span class="mi">50</span> <span class="o">:=</span> <span class="n">reverse_compose</span>

<span class="c1">---- Categories and Functors</span>

<span class="kd">structure</span> <span class="n">cat</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">obj</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">)</span>
<span class="o">(</span><span class="n">hom</span> <span class="o">:</span> <span class="n">obj</span> <span class="bp">→</span> <span class="n">obj</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="o">(</span><span class="n">seq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">obj</span><span class="o">}</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">Id</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">obj</span><span class="o">),</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">id_before</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">obj</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">seq</span> <span class="o">(</span><span class="n">Id</span> <span class="n">a</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">id_after</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">obj</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">seq</span> <span class="n">f</span> <span class="o">(</span><span class="n">Id</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">assoc</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">obj</span><span class="o">}:</span> <span class="bp">∀</span>  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">b</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">),</span> <span class="n">seq</span> <span class="o">(</span><span class="n">seq</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">seq</span> <span class="n">f</span> <span class="o">(</span><span class="n">seq</span> <span class="n">g</span> <span class="n">h</span><span class="o">))</span>


<span class="kd">@[ext]</span> <span class="kd">structure</span> <span class="n">Funct</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat.</span><span class="o">{</span><span class="n">v1</span> <span class="n">u1</span><span class="o">})</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">cat.</span><span class="o">{</span><span class="n">v2</span> <span class="n">u2</span><span class="o">})</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">o</span> <span class="o">:</span> <span class="n">C.obj</span> <span class="bp">→</span> <span class="n">D.obj</span><span class="o">)</span>
<span class="o">(</span><span class="n">m</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">o</span> <span class="n">b</span><span class="o">))</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">c</span><span class="o">),</span> <span class="n">m</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="n">g</span><span class="o">))</span>
<span class="o">(</span><span class="n">id</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">m</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">o</span> <span class="n">c</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">Fseq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">D</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">E</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="n">F.o</span> <span class="bp">⨟</span> <span class="n">G.o</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="n">f</span><span class="o">,</span> <span class="n">G.m</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">}</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">F.comm</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">G.comm</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">g</span><span class="o">)])</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="kd">begin</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">F.id</span><span class="o">,</span> <span class="n">G.id</span><span class="o">],</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">CatId</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">cat_id_before</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">Fseq</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">C</span><span class="o">)</span> <span class="n">F</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Fseq</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">cat_id_after</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">Fseq</span> <span class="n">F</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">D</span><span class="o">)</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Fseq</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span>

<span class="kd">structure</span> <span class="n">iso</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">inv</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">finv</span><span class="o">:</span>  <span class="n">C.seq</span> <span class="n">f</span> <span class="n">inv</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">invf</span><span class="o">:</span>  <span class="n">C.seq</span> <span class="n">inv</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">b</span><span class="o">)</span>

<span class="c1">---- Natural transformations</span>
<span class="kd">@[ext]</span> <span class="kd">structure</span> <span class="n">NT</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">G.o</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">η</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">η</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">G.m</span> <span class="n">f</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">NTId</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="n">NT.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">D.id_before</span><span class="o">,</span> <span class="n">D.id_after</span><span class="o">])</span>

<span class="kd">def</span> <span class="n">NTseq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">}</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">G</span> <span class="n">H</span><span class="o">)</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">NT.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">N.η</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">M.η</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">D.assoc</span><span class="o">,</span> <span class="n">N.comm</span><span class="o">,</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">M.comm</span><span class="o">,</span> <span class="n">D.assoc</span><span class="o">])</span>

<span class="kd">theorem</span> <span class="n">NT_component_eq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="n">M</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">ee</span> <span class="o">:</span> <span class="n">N.η</span> <span class="bp">=</span> <span class="n">M.η</span><span class="o">)</span> <span class="o">:</span> <span class="n">N</span> <span class="bp">=</span> <span class="n">M</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span><span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">congr_fun</span> <span class="n">ee</span> <span class="n">x</span><span class="o">}</span>

<span class="kd">theorem</span> <span class="n">NT_idbefore</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">NTseq</span> <span class="o">(</span><span class="n">NTId</span> <span class="n">F</span><span class="o">)</span> <span class="n">N</span> <span class="bp">=</span> <span class="n">N</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">delta</span> <span class="n">NTId</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.id_before</span><span class="o">]</span> <span class="kd">end</span>

<span class="kd">theorem</span> <span class="n">NT_idafter</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">NTseq</span> <span class="n">N</span> <span class="o">(</span><span class="n">NTId</span> <span class="n">G</span><span class="o">)</span> <span class="bp">=</span> <span class="n">N</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">delta</span> <span class="n">NTId</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.id_after</span><span class="o">]</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">FunctCat</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT</span><span class="o">)</span>
<span class="o">(</span><span class="bp">@</span><span class="n">NTseq</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">NTId</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT_idbefore</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT_idafter</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">delta</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.assoc</span><span class="o">]</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">Types</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="kt">Type</span> <span class="n">_</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">A</span> <span class="n">B</span><span class="o">,</span> <span class="o">(</span><span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">f</span> <span class="bp">⨟</span> <span class="n">g</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="c1">-- isomorphic objects -&gt; isomorphic homsets</span>
<span class="kd">theorem</span> <span class="n">iso_objects_iso_hom</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">a'</span> <span class="n">b</span> <span class="n">b'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">isoaa'</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">a</span> <span class="n">a'</span><span class="o">)</span> <span class="o">(</span><span class="n">isobb'</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">b</span> <span class="n">b'</span><span class="o">)</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">Types</span> <span class="o">(</span><span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">C.hom</span> <span class="n">a'</span> <span class="n">b'</span><span class="o">)</span> <span class="o">:=</span> <span class="n">iso.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">C.seq</span> <span class="n">isoaa'.inv</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">isobb'.f</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">C.seq</span> <span class="n">isoaa'.f</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">isobb'.inv</span><span class="o">))</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Types</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isobb'.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_after</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isoaa'.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_before</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Types</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isobb'.invf</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_after</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isoaa'.invf</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_before</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">iso_objects_iso_hom_pres_id</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">isoab</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">iso_objects_iso_hom</span> <span class="n">C</span> <span class="n">a</span> <span class="n">b</span> <span class="n">a</span> <span class="n">b</span> <span class="n">isoab</span> <span class="n">isoab</span><span class="o">)</span><span class="bp">.</span><span class="n">f</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">begin</span>
<span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.id_before</span><span class="o">,</span> <span class="n">isoab.invf</span> <span class="o">],</span> <span class="kd">end</span>


<span class="kd">structure</span> <span class="n">cat_equivalence</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">Inv</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">D</span> <span class="n">C</span><span class="o">)</span>
<span class="o">(</span><span class="n">FInv</span> <span class="o">:</span> <span class="n">iso</span> <span class="o">(</span><span class="n">FunctCat</span> <span class="n">C</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">Fseq</span> <span class="n">F</span> <span class="n">Inv</span><span class="o">)</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">C</span><span class="o">)</span> <span class="o">)</span>
<span class="o">(</span><span class="n">InvF</span> <span class="o">:</span> <span class="n">iso</span> <span class="o">(</span><span class="n">FunctCat</span> <span class="n">D</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">Fseq</span> <span class="n">Inv</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">D</span><span class="o">)</span> <span class="o">)</span>


<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span>
<span class="kd">structure</span> <span class="n">full</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>  <span class="o">:=</span>
<span class="o">(</span><span class="n">pre</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">df</span> <span class="o">:</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)),</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">c'</span><span class="o">)</span>
<span class="o">(</span><span class="n">preimage</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">df</span> <span class="o">:</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)),</span> <span class="n">F.m</span> <span class="o">(</span><span class="n">pre</span> <span class="n">df</span><span class="o">)</span> <span class="bp">=</span> <span class="n">df</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">faithful</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">{</span><span class="n">cf</span> <span class="n">cf'</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">c'</span><span class="o">}</span> <span class="o">(</span><span class="n">Fcf</span> <span class="o">:</span> <span class="n">F.m</span> <span class="n">cf</span> <span class="bp">=</span> <span class="n">F.m</span> <span class="n">cf'</span><span class="o">),</span>  <span class="o">(</span><span class="n">cf</span> <span class="bp">=</span> <span class="n">cf'</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">essentially_surjective</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">D.obj</span><span class="o">),</span> <span class="bp">Σ</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">iso</span> <span class="n">D</span> <span class="n">d</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span>

<span class="c1">-- set_option pp.all true</span>

<span class="kd">theorem</span> <span class="n">full_faith_transport_iso</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">fullF</span> <span class="o">:</span> <span class="n">full</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">:</span> <span class="n">faithful</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">isoFcFc'</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">D</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">))</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">c</span> <span class="n">c'</span> <span class="o">:=</span> <span class="n">iso.mk</span>
<span class="o">(</span><span class="n">fullF.pre</span> <span class="n">isoFcFc'.f</span><span class="o">)</span>
<span class="o">(</span><span class="n">fullF.pre</span> <span class="n">isoFcFc'.inv</span><span class="o">)</span>
<span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span> <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span> <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.f</span><span class="o">),</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.inv</span><span class="o">),</span> <span class="n">rw</span> <span class="n">isoFcFc'.finv</span><span class="o">,</span> <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span> <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span> <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.f</span><span class="o">),</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.inv</span><span class="o">),</span> <span class="n">rw</span> <span class="n">isoFcFc'.invf</span><span class="o">,</span> <span class="kd">end</span><span class="o">))</span>

<span class="kd">theorem</span> <span class="n">full_faith_surj_equiv</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">fullF</span> <span class="o">:</span> <span class="n">full</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">:</span> <span class="n">faithful</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">:</span> <span class="n">essentially_surjective</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat_equivalence</span> <span class="n">C</span> <span class="n">D</span> <span class="o">:=</span> <span class="n">cat_equivalence.mk</span>
<span class="n">F</span>
<span class="o">(</span><span class="n">Funct.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">d</span><span class="o">,</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">d</span> <span class="n">d'</span> <span class="n">df</span><span class="o">,</span> <span class="o">(</span><span class="n">fullF.pre</span> <span class="o">((</span><span class="n">iso_objects_iso_hom</span> <span class="n">D</span> <span class="n">d</span> <span class="o">(</span><span class="n">F.o</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="n">d'</span> <span class="o">(</span><span class="n">F.o</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d'</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d'</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="o">)</span><span class="bp">.</span><span class="n">f</span> <span class="n">df</span><span class="o">)))</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
         <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
         <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span>
         <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">D.assoc</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="n">snd.f</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.id_before</span><span class="o">,</span>
      <span class="kd">end</span><span class="o">)</span> <span class="kd">end</span><span class="o">)</span>
   <span class="o">(</span><span class="kd">begin</span>
      <span class="n">intro</span> <span class="n">d</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">iso_objects_iso_hom_pres_id</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
         <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span>
      <span class="kd">end</span><span class="o">)</span>
      <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="n">iso.mk</span>
<span class="o">(</span><span class="k">let</span> <span class="n">Ftransport</span> <span class="o">:=</span> <span class="o">(</span><span class="n">full_faith_transport_iso</span> <span class="n">F</span> <span class="o">(</span><span class="bp">@</span><span class="n">fullF</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">faithfulF</span><span class="o">))</span> <span class="k">in</span> <span class="n">NT.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="o">(</span><span class="n">Ftransport</span> <span class="n">c</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">inv</span><span class="o">)</span>

<span class="c1">-- sorry</span>
<span class="c1">-- start of term /-</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span>
   <span class="n">delta</span> <span class="n">Fseq</span><span class="o">,</span>
<span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">,</span> <span class="n">eq_mpr_eq_cast</span><span class="o">,</span> <span class="n">cast_eq</span><span class="o">],</span>
   <span class="n">delta</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">],</span>
   <span class="n">exact</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">F.comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Ftransport</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">full_faith_transport_iso</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">D.assoc</span><span class="o">],</span>
      <span class="n">exact</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">D.seq</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.inv</span><span class="o">)</span>
      <span class="o">(</span><span class="kd">begin</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">],</span>
         <span class="k">have</span> <span class="n">xx</span><span class="o">,</span> <span class="k">from</span> <span class="n">D.id_after</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">),</span>
<span class="n">dsimp</span><span class="o">,</span>
<span class="c1">-- these give: (deterministic) timeout</span>
<span class="c1">-- exact xx,</span>
<span class="c1">-- convert xx,</span>
<span class="c1">-- assumption,</span>
         <span class="kd">end</span><span class="o">)</span>
   <span class="kd">end</span><span class="o">)),</span>
   <span class="kd">end</span><span class="o">)</span>

<span class="c1">-- end of term  -/</span>
   <span class="o">)</span>
<span class="gr">sorry</span>
<span class="gr">sorry</span>
<span class="gr">sorry</span><span class="o">)</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="270752082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270752082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270752082">(Feb 04 2022 at 18:15)</a>:</h4>
<p>If you set <code>set_option pp.all true</code> before the lemma can you find any differences between <code>xx</code> and the goal in that spot. It might be quite long and difficult to see but this is probably a case where there is some difference that isn't shown in the prettty printed representation of the terms</p>



<a name="270752630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270752630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270752630">(Feb 04 2022 at 18:19)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">dsimp</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">xx</span><span class="o">,</span>
</code></pre></div>
<p>works for me, but still takes a while</p>



<a name="270752668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270752668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270752668">(Feb 04 2022 at 18:19)</a>:</h4>
<p>Thanks. Well, <code>xx</code> and the goal definitely aren't identical when fully printed.</p>



<a name="270753002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270753002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270753002">(Feb 04 2022 at 18:22)</a>:</h4>
<p>Hm, I still get a deterministic timeout with <br>
<code>dsimp,
exact xx,</code></p>



<a name="270753089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270753089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270753089">(Feb 04 2022 at 18:23)</a>:</h4>
<p>I did use <code>squeeze_simp</code> to find out that most of the simps in your proof were really <code>simp only [something]</code> this is good practice to do anyway and helps speed up long proofs</p>



<a name="270753219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270753219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270753219">(Feb 04 2022 at 18:24)</a>:</h4>
<p>Ok I'll try that.</p>



<a name="270753571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270753571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270753571">(Feb 04 2022 at 18:27)</a>:</h4>
<p>It also looks like you might be using tactic mode to produce data (def-like things rather than theorem-like things) this often produces terms that are very hard to handle as tactics often generate a lot of extra things in the term</p>



<a name="270754041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270754041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270754041">(Feb 04 2022 at 18:30)</a>:</h4>
<p>Yeah, I use tactic mode for the first argument to <code>NT.mk</code>, which is data.</p>



<a name="270754936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270754936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270754936">(Feb 04 2022 at 18:36)</a>:</h4>
<p>I'm still getting a timeout. That term now looks like: </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- start of term /-</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span>
   <span class="n">delta</span> <span class="n">Fseq</span><span class="o">,</span>
<span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">,</span> <span class="n">eq_mpr_eq_cast</span><span class="o">,</span> <span class="n">cast_eq</span><span class="o">],</span>
   <span class="n">delta</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">],</span>
   <span class="n">exact</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">F.comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Ftransport</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">full_faith_transport_iso</span><span class="o">,</span>
<span class="c1">-- squeeze_simp,</span>
<span class="c1">--       simp,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">D.assoc</span><span class="o">],</span>
      <span class="n">exact</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">D.seq</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.inv</span><span class="o">)</span>
      <span class="o">(</span><span class="kd">begin</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">],</span>
         <span class="k">have</span> <span class="n">xx</span><span class="o">,</span> <span class="k">from</span> <span class="n">D.id_after</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">),</span>
<span class="n">dsimp</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">xx</span><span class="o">,</span>

<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--            assumption,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--           convert xx,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--          exact xx,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--          rw xx,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--           exact sorry</span>
         <span class="kd">end</span><span class="o">)</span>
   <span class="kd">end</span><span class="o">)),</span>
   <span class="kd">end</span><span class="o">)</span>

<span class="c1">-- end of term  -/</span>
</code></pre></div>



<a name="270755101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270755101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270755101">(Feb 04 2022 at 18:37)</a>:</h4>
<p>I'll try rewriting the data term.</p>



<a name="270755310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270755310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270755310">(Feb 04 2022 at 18:39)</a>:</h4>
<p>(Alex, are you sure it succeeded for you? The error message appears at the first line of the theorem statement.)</p>



<a name="270755724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270755724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270755724">(Feb 04 2022 at 18:42)</a>:</h4>
<p>The data term (the previous argument)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="kd">begin</span> <span class="n">delta</span> <span class="n">Fseq</span><span class="o">,</span><span class="n">delta</span>  <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">delta</span> <span class="n">CatId</span><span class="o">,</span>  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">],</span>
<span class="n">exact</span> <span class="o">(</span><span class="n">Ftransport</span> <span class="n">c</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">inv</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
</code></pre></div>
<p>can be replaced with </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>   <span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="o">(</span><span class="n">Ftransport</span> <span class="n">c</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">inv</span><span class="o">)</span>
</code></pre></div>
<p>but I still get a timeout.</p>



<a name="270758069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270758069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270758069">(Feb 04 2022 at 19:00)</a>:</h4>
<p>I've rewritten all the <code>simp</code>s to <code>simp only</code>, and now <code>xx</code> and the goal are identical with <code>set_option pp.all true</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">xx</span> <span class="o">:</span> <span class="bp">@</span><span class="n">eq.</span><span class="o">{</span><span class="n">u_3</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="n">D.hom</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">))</span> <span class="o">(</span><span class="bp">@</span><span class="n">cat.seq.</span><span class="o">{</span><span class="n">u_3</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">D</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.m.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">D.Id</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">)))</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.m.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">)</span>
<span class="bp">⊢</span> <span class="bp">@</span><span class="n">eq.</span><span class="o">{</span><span class="n">u_3</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="n">D.hom</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">))</span> <span class="o">(</span><span class="bp">@</span><span class="n">cat.seq.</span><span class="o">{</span><span class="n">u_3</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">D</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.m.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">D.Id</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.o.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">b</span><span class="o">)))</span> <span class="o">(</span><span class="bp">@</span><span class="n">Funct.m.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">u_3</span> <span class="n">u_2</span> <span class="n">u_4</span><span class="o">}</span> <span class="n">C</span> <span class="n">D</span> <span class="n">F</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">)</span>
</code></pre></div>
<p>But I still get a timeout! Here's the current text of the theorem:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">full_faith_surj_equiv</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">fullF</span> <span class="o">:</span> <span class="n">full</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">:</span> <span class="n">faithful</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">:</span> <span class="n">essentially_surjective</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat_equivalence</span> <span class="n">C</span> <span class="n">D</span> <span class="o">:=</span> <span class="n">cat_equivalence.mk</span>
<span class="n">F</span>
<span class="o">(</span><span class="n">Funct.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">d</span><span class="o">,</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">d</span> <span class="n">d'</span> <span class="n">df</span><span class="o">,</span> <span class="o">(</span><span class="n">fullF.pre</span> <span class="o">((</span><span class="n">iso_objects_iso_hom</span> <span class="n">D</span> <span class="n">d</span> <span class="o">(</span><span class="n">F.o</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="n">d'</span> <span class="o">(</span><span class="n">F.o</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d'</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d'</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="o">)</span><span class="bp">.</span><span class="n">f</span> <span class="n">df</span><span class="o">)))</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
         <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
         <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span>
         <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">D.assoc</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="n">snd.f</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.id_before</span><span class="o">,</span>
      <span class="kd">end</span><span class="o">)</span> <span class="kd">end</span><span class="o">)</span>
   <span class="o">(</span><span class="kd">begin</span>
      <span class="n">intro</span> <span class="n">d</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">iso_objects_iso_hom_pres_id</span><span class="o">,</span>
      <span class="n">exact</span> <span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
         <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span>
      <span class="kd">end</span><span class="o">)</span>
      <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="n">iso.mk</span>
<span class="o">(</span><span class="k">let</span> <span class="n">Ftransport</span> <span class="o">:=</span> <span class="o">(</span><span class="n">full_faith_transport_iso</span> <span class="n">F</span> <span class="o">(</span><span class="bp">@</span><span class="n">fullF</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">faithfulF</span><span class="o">))</span> <span class="k">in</span> <span class="n">NT.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="o">(</span><span class="n">Ftransport</span> <span class="n">c</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">inv</span><span class="o">)</span>

<span class="c1">-- sorry</span>
<span class="c1">-- start of term /-</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span>
   <span class="n">delta</span> <span class="n">Fseq</span><span class="o">,</span>
<span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">,</span> <span class="n">eq_mpr_eq_cast</span><span class="o">,</span> <span class="n">cast_eq</span><span class="o">],</span>
   <span class="n">delta</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">],</span>
   <span class="n">exact</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">F.comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Ftransport</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">full_faith_transport_iso</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">D.assoc</span><span class="o">],</span>
      <span class="n">exact</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">D.seq</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.inv</span><span class="o">)</span>
      <span class="o">(</span><span class="kd">begin</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">],</span>
         <span class="k">have</span> <span class="n">xx</span><span class="o">,</span> <span class="k">from</span> <span class="n">D.id_after</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">),</span>
<span class="n">dsimp</span><span class="o">,</span>
<span class="c1">-- these give: (deterministic) timeout</span>
<span class="c1">-- exact xx,</span>
<span class="c1">-- convert xx,</span>
<span class="n">assumption</span><span class="o">,</span>
         <span class="kd">end</span><span class="o">)</span>
   <span class="kd">end</span><span class="o">)),</span>
   <span class="kd">end</span><span class="o">)</span>

<span class="c1">-- end of term  -/</span>
   <span class="o">)</span>
<span class="gr">sorry</span>
<span class="gr">sorry</span>
<span class="gr">sorry</span><span class="o">)</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="270758935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270758935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270758935">(Feb 04 2022 at 19:06)</a>:</h4>
<p>Yeah it does eventually work for me, maybe I just have a higher timeout setting, but changing your settings is not a solution <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> we shouldn't have to wait several seconds to check theorems ideally.</p>



<a name="270758965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270758965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270758965">(Feb 04 2022 at 19:06)</a>:</h4>
<p>One other thing that might help is avoiding nested tactic blocks</p>



<a name="270759118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270759118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270759118">(Feb 04 2022 at 19:07)</a>:</h4>
<p>E.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.ext</span>
<span class="kn">import</span> <span class="n">data.finset</span>
<span class="kd">universes</span> <span class="n">v</span> <span class="n">v1</span> <span class="n">v2</span> <span class="n">u</span> <span class="n">u1</span> <span class="n">u2</span> <span class="n">w</span>

<span class="kd">def</span> <span class="n">reverse_compose</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span>
<span class="kd">infix</span> <span class="bp">`</span>  <span class="bp">⨟</span> <span class="bp">`</span><span class="o">:</span><span class="mi">50</span> <span class="o">:=</span> <span class="n">reverse_compose</span>

<span class="c1">---- Categories and Functors</span>

<span class="kd">structure</span> <span class="n">cat</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">obj</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">)</span>
<span class="o">(</span><span class="n">hom</span> <span class="o">:</span> <span class="n">obj</span> <span class="bp">→</span> <span class="n">obj</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="o">(</span><span class="n">seq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">obj</span><span class="o">}</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">Id</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">obj</span><span class="o">),</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">id_before</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">obj</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">seq</span> <span class="o">(</span><span class="n">Id</span> <span class="n">a</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">id_after</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">obj</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">seq</span> <span class="n">f</span> <span class="o">(</span><span class="n">Id</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">assoc</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">obj</span><span class="o">}:</span> <span class="bp">∀</span>  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">b</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">),</span> <span class="n">seq</span> <span class="o">(</span><span class="n">seq</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">seq</span> <span class="n">f</span> <span class="o">(</span><span class="n">seq</span> <span class="n">g</span> <span class="n">h</span><span class="o">))</span>
<span class="k">#print</span> <span class="n">cat.id_before</span>

<span class="kd">@[ext]</span> <span class="kd">structure</span> <span class="n">Funct</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat.</span><span class="o">{</span><span class="n">v1</span> <span class="n">u1</span><span class="o">})</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">cat.</span><span class="o">{</span><span class="n">v2</span> <span class="n">u2</span><span class="o">})</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">o</span> <span class="o">:</span> <span class="n">C.obj</span> <span class="bp">→</span> <span class="n">D.obj</span><span class="o">)</span>
<span class="o">(</span><span class="n">m</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">o</span> <span class="n">b</span><span class="o">))</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">c</span><span class="o">),</span> <span class="n">m</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="n">g</span><span class="o">))</span>
<span class="o">(</span><span class="n">id</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">m</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">o</span> <span class="n">c</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">Fseq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">D</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">E</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="n">F.o</span> <span class="bp">⨟</span> <span class="n">G.o</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="n">f</span><span class="o">,</span> <span class="n">G.m</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">}</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">F.comm</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">G.comm</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">g</span><span class="o">)])</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="kd">begin</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">F.id</span><span class="o">,</span> <span class="n">G.id</span><span class="o">],</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">CatId</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">cat_id_before</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">Fseq</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">C</span><span class="o">)</span> <span class="n">F</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Fseq</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">cat_id_after</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">Fseq</span> <span class="n">F</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">D</span><span class="o">)</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Fseq</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span>

<span class="kd">structure</span> <span class="n">iso</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">inv</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">finv</span><span class="o">:</span>  <span class="n">C.seq</span> <span class="n">f</span> <span class="n">inv</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">invf</span><span class="o">:</span>  <span class="n">C.seq</span> <span class="n">inv</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">b</span><span class="o">)</span>

<span class="c1">---- Natural transformations</span>
<span class="kd">@[ext]</span> <span class="kd">structure</span> <span class="n">NT</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">G.o</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">η</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">η</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">G.m</span> <span class="n">f</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">NTId</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="n">NT.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">D.id_before</span><span class="o">,</span> <span class="n">D.id_after</span><span class="o">])</span>

<span class="kd">def</span> <span class="n">NTseq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">}</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">G</span> <span class="n">H</span><span class="o">)</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">NT.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">N.η</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">M.η</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">D.assoc</span><span class="o">,</span> <span class="n">N.comm</span><span class="o">,</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">M.comm</span><span class="o">,</span> <span class="n">D.assoc</span><span class="o">])</span>

<span class="kd">theorem</span> <span class="n">NT_component_eq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="n">M</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">ee</span> <span class="o">:</span> <span class="n">N.η</span> <span class="bp">=</span> <span class="n">M.η</span><span class="o">)</span> <span class="o">:</span> <span class="n">N</span> <span class="bp">=</span> <span class="n">M</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span><span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">congr_fun</span> <span class="n">ee</span> <span class="n">x</span><span class="o">}</span>

<span class="kd">theorem</span> <span class="n">NT_idbefore</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">NTseq</span> <span class="o">(</span><span class="n">NTId</span> <span class="n">F</span><span class="o">)</span> <span class="n">N</span> <span class="bp">=</span> <span class="n">N</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">delta</span> <span class="n">NTId</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.id_before</span><span class="o">]</span> <span class="kd">end</span>

<span class="kd">theorem</span> <span class="n">NT_idafter</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">NTseq</span> <span class="n">N</span> <span class="o">(</span><span class="n">NTId</span> <span class="n">G</span><span class="o">)</span> <span class="bp">=</span> <span class="n">N</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">delta</span> <span class="n">NTId</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.id_after</span><span class="o">]</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">FunctCat</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT</span><span class="o">)</span>
<span class="o">(</span><span class="bp">@</span><span class="n">NTseq</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">NTId</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT_idbefore</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT_idafter</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">delta</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.assoc</span><span class="o">]</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">Types</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="kt">Type</span> <span class="n">_</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">A</span> <span class="n">B</span><span class="o">,</span> <span class="o">(</span><span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">f</span> <span class="bp">⨟</span> <span class="n">g</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="c1">-- isomorphic objects -&gt; isomorphic homsets</span>
<span class="kd">theorem</span> <span class="n">iso_objects_iso_hom</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">a'</span> <span class="n">b</span> <span class="n">b'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">isoaa'</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">a</span> <span class="n">a'</span><span class="o">)</span> <span class="o">(</span><span class="n">isobb'</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">b</span> <span class="n">b'</span><span class="o">)</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">Types</span> <span class="o">(</span><span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">C.hom</span> <span class="n">a'</span> <span class="n">b'</span><span class="o">)</span> <span class="o">:=</span> <span class="n">iso.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">C.seq</span> <span class="n">isoaa'.inv</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">isobb'.f</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">C.seq</span> <span class="n">isoaa'.f</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">isobb'.inv</span><span class="o">))</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Types</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isobb'.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_after</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isoaa'.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_before</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Types</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isobb'.invf</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_after</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">C.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">isoaa'.invf</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_before</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">iso_objects_iso_hom_pres_id</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">isoab</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">iso_objects_iso_hom</span> <span class="n">C</span> <span class="n">a</span> <span class="n">b</span> <span class="n">a</span> <span class="n">b</span> <span class="n">isoab</span> <span class="n">isoab</span><span class="o">)</span><span class="bp">.</span><span class="n">f</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">b</span> <span class="o">:=</span> <span class="kd">begin</span>
<span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.id_before</span><span class="o">,</span> <span class="n">isoab.invf</span> <span class="o">],</span> <span class="kd">end</span>


<span class="kd">structure</span> <span class="n">cat_equivalence</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">Inv</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">D</span> <span class="n">C</span><span class="o">)</span>
<span class="o">(</span><span class="n">FInv</span> <span class="o">:</span> <span class="n">iso</span> <span class="o">(</span><span class="n">FunctCat</span> <span class="n">C</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">Fseq</span> <span class="n">F</span> <span class="n">Inv</span><span class="o">)</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">C</span><span class="o">)</span> <span class="o">)</span>
<span class="o">(</span><span class="n">InvF</span> <span class="o">:</span> <span class="n">iso</span> <span class="o">(</span><span class="n">FunctCat</span> <span class="n">D</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">Fseq</span> <span class="n">Inv</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">D</span><span class="o">)</span> <span class="o">)</span>


<span class="kd">variables</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span>
<span class="kd">structure</span> <span class="n">full</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>  <span class="o">:=</span>
<span class="o">(</span><span class="n">pre</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">df</span> <span class="o">:</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)),</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">c'</span><span class="o">)</span>
<span class="o">(</span><span class="n">preimage</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">df</span> <span class="o">:</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)),</span> <span class="n">F.m</span> <span class="o">(</span><span class="n">pre</span> <span class="n">df</span><span class="o">)</span> <span class="bp">=</span> <span class="n">df</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">faithful</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">{</span><span class="n">cf</span> <span class="n">cf'</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">c'</span><span class="o">}</span> <span class="o">(</span><span class="n">Fcf</span> <span class="o">:</span> <span class="n">F.m</span> <span class="n">cf</span> <span class="bp">=</span> <span class="n">F.m</span> <span class="n">cf'</span><span class="o">),</span>  <span class="o">(</span><span class="n">cf</span> <span class="bp">=</span> <span class="n">cf'</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">essentially_surjective</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">D.obj</span><span class="o">),</span> <span class="bp">Σ</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">iso</span> <span class="n">D</span> <span class="n">d</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">full_faith_transport_iso</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">fullF</span> <span class="o">:</span> <span class="n">full</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">:</span> <span class="n">faithful</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">isoFcFc'</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">D</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">))</span> <span class="o">:</span> <span class="n">iso</span> <span class="n">C</span> <span class="n">c</span> <span class="n">c'</span> <span class="o">:=</span> <span class="n">iso.mk</span>
<span class="o">(</span><span class="n">fullF.pre</span> <span class="n">isoFcFc'.f</span><span class="o">)</span>
<span class="o">(</span><span class="n">fullF.pre</span> <span class="n">isoFcFc'.inv</span><span class="o">)</span>
<span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span> <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span> <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.f</span><span class="o">),</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.inv</span><span class="o">),</span> <span class="n">rw</span> <span class="n">isoFcFc'.finv</span><span class="o">,</span> <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="n">faithfulF</span> <span class="o">(</span><span class="kd">begin</span> <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span> <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.f</span><span class="o">),</span> <span class="n">rw</span> <span class="o">(</span><span class="n">fullF.preimage</span> <span class="n">isoFcFc'.inv</span><span class="o">),</span> <span class="n">rw</span> <span class="n">isoFcFc'.invf</span><span class="o">,</span> <span class="kd">end</span><span class="o">))</span>

<span class="c1">-- set_option pp.all true</span>
<span class="kd">theorem</span> <span class="n">full_faith_surj_equiv</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">fullF</span> <span class="o">:</span> <span class="n">full</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="o">:</span> <span class="n">faithful</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">:</span> <span class="n">essentially_surjective</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat_equivalence</span> <span class="n">C</span> <span class="n">D</span> <span class="o">:=</span> <span class="n">cat_equivalence.mk</span>
<span class="n">F</span>
<span class="o">(</span><span class="n">Funct.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">d</span><span class="o">,</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">d</span> <span class="n">d'</span> <span class="n">df</span><span class="o">,</span> <span class="o">(</span><span class="n">fullF.pre</span> <span class="o">((</span><span class="n">iso_objects_iso_hom</span> <span class="n">D</span> <span class="n">d</span> <span class="o">(</span><span class="n">F.o</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="n">d'</span> <span class="o">(</span><span class="n">F.o</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d'</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">d'</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="o">)</span><span class="bp">.</span><span class="n">f</span> <span class="n">df</span><span class="o">)))</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">faithfulF</span> <span class="n">_</span><span class="o">,</span>
         <span class="n">rw</span> <span class="n">F.comm</span><span class="o">,</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
         <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span>
         <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">rw</span> <span class="bp">←</span><span class="n">D.assoc</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="n">snd.f</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">surjF</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">,</span> <span class="n">rw</span> <span class="n">D.id_before</span><span class="o">,</span>
     <span class="kd">end</span><span class="o">)</span>
   <span class="o">(</span><span class="kd">begin</span>
      <span class="n">intro</span> <span class="n">d</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">iso_objects_iso_hom_pres_id</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">faithfulF</span> <span class="n">_</span><span class="o">,</span>
         <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
         <span class="n">rw</span> <span class="n">F.id</span><span class="o">,</span>
      <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="n">iso.mk</span>
<span class="o">(</span><span class="k">let</span> <span class="n">Ftransport</span> <span class="o">:=</span> <span class="o">(</span><span class="n">full_faith_transport_iso</span> <span class="n">F</span> <span class="o">(</span><span class="bp">@</span><span class="n">fullF</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">faithfulF</span><span class="o">))</span> <span class="k">in</span> <span class="n">NT.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span>
<span class="o">(</span><span class="n">Ftransport</span> <span class="n">c</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">.</span><span class="n">inv</span><span class="o">)</span>
<span class="c1">-- sorry</span>
<span class="c1">-- start of term /-</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span>
   <span class="n">delta</span> <span class="n">Fseq</span><span class="o">,</span>
   <span class="n">delta</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">id.def</span><span class="o">],</span>
   <span class="n">refine</span> <span class="o">(</span><span class="n">faithfulF</span> <span class="n">_</span><span class="o">),</span>
      <span class="n">simp_rw</span> <span class="o">[</span><span class="n">F.comm</span><span class="o">],</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">iso_objects_iso_hom</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Ftransport</span><span class="o">],</span>
      <span class="n">delta</span> <span class="n">full_faith_transport_iso</span><span class="o">,</span>
      <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">fullF.preimage</span><span class="o">],</span>
      <span class="n">simp_rw</span> <span class="n">D.assoc</span><span class="o">,</span>
      <span class="n">refine</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">D.seq</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.inv</span><span class="o">)</span> <span class="n">_</span><span class="o">,</span>
         <span class="n">simp_rw</span> <span class="o">(</span><span class="n">surjF</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">))</span><span class="bp">.</span><span class="n">snd.finv</span><span class="o">,</span>
         <span class="n">dsimp</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">D.id_after</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">),</span>
        <span class="c1">--  exact xx,</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--            assumption,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--           convert xx,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--          exact xx,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--          rw xx,</span>
<span class="c1">--</span>
<span class="c1">--          gives: (deterministic) timeout</span>
<span class="c1">--           exact sorry</span>
   <span class="kd">end</span><span class="o">)</span>

<span class="c1">-- end of term  -/</span>
   <span class="o">)</span>
<span class="gr">sorry</span>
<span class="gr">sorry</span>
<span class="gr">sorry</span><span class="o">)</span>
<span class="gr">sorry</span>
</code></pre></div>



<a name="270759148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270759148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270759148">(Feb 04 2022 at 19:08)</a>:</h4>
<p>But it is still slow even with this</p>



<a name="270773075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270773075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270773075">(Feb 04 2022 at 21:10)</a>:</h4>
<p>Thanks. I've rewritten it like that. But now... I can't figure out how to set <code>timeout</code> :(. I've run "lean --timeout=100000"; and I've changed some line in /lean.nvim/lua/lean/_util.lua from <code>timeout = timeout or 10000</code> to <code>timeout = timeout or 100000</code>; and I've tried the tactic    <code>try_for 1000000 {   exact xx  }</code>; and I've tried <code>set_option timeout 100000</code> before the theorem; still, it fails with a timeout after apparently the same amount of time (about 10 seconds or so). </p>
<p>I'm in neovim; Lean version 3.38.0.</p>



<a name="270774481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270774481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270774481">(Feb 04 2022 at 21:22)</a>:</h4>
<p>Timeout isn't a literal time for lean, rather a maximum number of memory allocations mine is set to <code>3000000</code>, so maybe you just need to try bigger values ?</p>



<a name="270774552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270774552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270774552">(Feb 04 2022 at 21:23)</a>:</h4>
<p>It should be set on the command line  when initiating the server, but hopefully the lean.nvim plugin will have a configurable option</p>



<a name="270775485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270775485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270775485">(Feb 04 2022 at 21:31)</a>:</h4>
<p>That's the wrong place (lsp/_util), but sorry that the docs don't make this example clear. Right now you do this by:</p>
<div class="codehilite" data-code-language="Lua"><pre><span></span><code><span class="nb">require</span><span class="p">(</span><span class="s1">'lean'</span><span class="p">).</span><span class="n">setup</span><span class="p">{</span>
  <span class="c1">-- whatever other options you set</span>
  <span class="n">lsp3</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'lean-language-server'</span><span class="p">,</span> <span class="s1">'--stdio'</span><span class="p">,</span> <span class="s1">'--'</span><span class="p">,</span> <span class="s1">'-M'</span><span class="p">,</span> <span class="s1">'4096'</span><span class="p">,</span> <span class="s1">'-T'</span><span class="p">,</span> <span class="s1">'3000000'</span> <span class="p">},</span>
    <span class="c1">-- on_attach = on_attach or whatever else you set here</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>



<a name="270775638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270775638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270775638">(Feb 04 2022 at 21:32)</a>:</h4>
<p>An issue asking for better docs on how to modify the timeout is definitely welcome, as of course is a PR adding that example, or feel free to add it in the wiki here: <a href="https://github.com/Julian/lean.nvim/wiki/Configuring-&amp;-Extending">https://github.com/Julian/lean.nvim/wiki/Configuring-&amp;-Extending</a></p>



<a name="270775984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270775984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270775984">(Feb 04 2022 at 21:34)</a>:</h4>
<p>(Also welcome would be if sufficient folks think the default timeout should be higher we could change it, but I think I copied the VSCode default)</p>



<a name="270776207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270776207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270776207">(Feb 04 2022 at 21:34)</a>:</h4>
<p>Ha, I was just writing an email to you! (Yeah I'd figured that was probably the wrong place, on reflection.) Ok great I'll try that out.</p>



<a name="270776327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270776327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270776327">(Feb 04 2022 at 21:35)</a>:</h4>
<p>Well hello there then :) yeah let me know how it goes!</p>



<a name="270777208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270777208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270777208">(Feb 04 2022 at 21:44)</a>:</h4>
<p>Success! The timeout is longer, and the proof goes through! Thanks both. I'll add an entry to that wiki page.</p>



<a name="270887783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270887783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270887783">(Feb 06 2022 at 12:36)</a>:</h4>
<p>So, I bumped into another instance of this sort of very slow proof. Can someone point me to stuff to look at (exposition about how Lean works, or parts of the source code maybe) to understand  enough of what's going on under the hood that I can make educated guesses about why proofs take a really long time to be checked? I'm confused how a proof that basically looks like <code>delta</code> <code>simp only</code> <code>delta</code> <code>simp only</code>....  , and then ends with <code>exact</code>, takes so long. Like, I run these tactics, and in the background Lean is setting up some function from [the rest of the proof] to [the final actual proof term], and somehow that can lead to explosively large proof terms, but, like, how can just unfolding definitions and doing seemingly simple (e.g., seemingly linear or linear-ish) beta reductions and similar lead to huge terms? Is there in general something wrong with writing lots of nested definitions?</p>
<p>Here's another example of the sort of proof I mean; this takes over a minute to check, for me. (This is NOT a MWE, there's a MWE above; this is just to illustrate more what I mean by this sort of proof.)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">cone_to_FtoX_full</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">full</span> <span class="o">(</span><span class="n">conecat_to_FtoXcat</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span> <span class="n">full.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span> <span class="n">c'</span> <span class="n">f</span><span class="o">,</span> <span class="o">⟨</span><span class="n">f.sourcef</span><span class="o">,</span><span class="kd">begin</span>
<span class="k">have</span> <span class="n">fcomm</span><span class="o">,</span> <span class="k">from</span> <span class="n">f.comm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">conecat_to_FtoXcat</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">Diagonal</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">objFunct</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">comm_square</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">FunctCat</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">NTseq</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">delta</span> <span class="n">NTId</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">simp_rw</span> <span class="n">C.id_after</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="k">have</span> <span class="n">xx</span><span class="o">,</span> <span class="k">from</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">congr_fun</span> <span class="n">fcomm</span> <span class="n">j</span><span class="o">),</span>
<span class="n">dsimp</span> <span class="n">only</span> <span class="n">at</span> <span class="n">xx</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">xx</span><span class="o">,</span>
<span class="kd">end</span>
<span class="o">⟩)</span>
<span class="o">(</span><span class="kd">begin</span>
<span class="gr">sorry</span>
<span class="kd">end</span><span class="o">)</span>
</code></pre></div>



<a name="270888114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270888114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270888114">(Feb 06 2022 at 12:45)</a>:</h4>
<p>One naive guess I can make is that there's some stuff hidden by the pretty printer; then, when I do <code>delta X</code>, there's some <code>X</code>s in the hidden stuff, and those get invisibly unfolded in the background; and that expands out. Is that a likely scenario? Is there some way to unfold definitions more conservatively (like "only in the term I'm looking at in the pretty printer" or something)?</p>



<a name="270888184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/270888184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#270888184">(Feb 06 2022 at 12:46)</a>:</h4>
<p>Am I supposed to make more things <code>irreducible</code>?</p>



<a name="271036447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271036447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271036447">(Feb 07 2022 at 20:19)</a>:</h4>
<p>Ok apparently using <code>dunfold</code> instead of <code>delta</code> is WAY faster (in the above example, that replacement makes the checking go from &gt;1 min to ~1 sec for me).</p>



<a name="271038658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271038658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271038658">(Feb 07 2022 at 20:38)</a>:</h4>
<p>Whoa nice find! That's news to me. This definitely seems like something worth getting to the bottom of and writing about on the community documentation pages, as it could definitely be catching a lot of people out without them realizing</p>



<a name="271040642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271040642" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271040642">(Feb 07 2022 at 20:57)</a>:</h4>
<p>By the way, have you tried using the mathlib linters? You just type <code>#lint</code> at the bottom of the file (assuming you have <code>tactic.lint</code> imported somehow) and it inspects your work for common mistakes, some of them can be ignored if you aren't worried about PRing stuff to mathlib.<br>
It highlights a couple of potential problems in the code you posted before, some defs that should be lemmas and also some universe issues. These might be contributing to the bad performance you are seeing</p>



<a name="271041887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271041887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271041887">(Feb 07 2022 at 21:07)</a>:</h4>
<p>Not sure how to get to the bottom of things. Maybe someone who knows how Lean works can take a look? Here's a working example; see the two versions of the theorem at the end. </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.ext</span>
<span class="kn">import</span> <span class="n">data.finset</span>
<span class="kd">universes</span> <span class="n">v</span> <span class="n">v1</span> <span class="n">v2</span> <span class="n">u</span> <span class="n">u1</span> <span class="n">u2</span> <span class="n">w</span>

<span class="kd">def</span> <span class="n">reverse_compose</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">B</span> <span class="bp">→</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span>
<span class="kd">infix</span> <span class="bp">`</span>  <span class="bp">⨟</span> <span class="bp">`</span><span class="o">:</span><span class="mi">50</span> <span class="o">:=</span> <span class="n">reverse_compose</span>

<span class="c1">---- categories, functors, natural transformations</span>
<span class="c1">---- Categories and Functors</span>
<span class="kd">structure</span> <span class="n">cat</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">obj</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">)</span>
<span class="o">(</span><span class="n">hom</span> <span class="o">:</span> <span class="n">obj</span> <span class="bp">→</span> <span class="n">obj</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="o">(</span><span class="n">seq</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">obj</span><span class="o">}</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="n">Id</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">obj</span><span class="o">),</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">id_before</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">obj</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">seq</span> <span class="o">(</span><span class="n">Id</span> <span class="n">a</span><span class="o">)</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">id_after</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">obj</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">seq</span> <span class="n">f</span> <span class="o">(</span><span class="n">Id</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span><span class="o">)</span>
<span class="o">(</span><span class="n">assoc</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">obj</span><span class="o">}:</span> <span class="bp">∀</span>  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">b</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">),</span> <span class="n">seq</span> <span class="o">(</span><span class="n">seq</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">seq</span> <span class="n">f</span> <span class="o">(</span><span class="n">seq</span> <span class="n">g</span> <span class="n">h</span><span class="o">))</span>


<span class="kd">@[ext]</span> <span class="kd">structure</span> <span class="n">Funct</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat.</span><span class="o">{</span><span class="n">v1</span> <span class="n">u1</span><span class="o">})</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">cat.</span><span class="o">{</span><span class="n">v2</span> <span class="n">u2</span><span class="o">})</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">o</span> <span class="o">:</span> <span class="n">C.obj</span> <span class="bp">→</span> <span class="n">D.obj</span><span class="o">)</span>
<span class="o">(</span><span class="n">m</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">o</span> <span class="n">b</span><span class="o">))</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">c</span><span class="o">),</span> <span class="n">m</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="n">g</span><span class="o">))</span>
<span class="o">(</span><span class="n">id</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">m</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">o</span> <span class="n">c</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">Fseq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="n">E</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">D</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">E</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="n">F.o</span> <span class="bp">⨟</span> <span class="n">G.o</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="n">f</span><span class="o">,</span> <span class="n">G.m</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">}</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">F.comm</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">G.comm</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">g</span><span class="o">)])</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="kd">begin</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">F.id</span><span class="o">,</span> <span class="n">G.id</span><span class="o">],</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">CatId</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">cat_id_before</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">Fseq</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">C</span><span class="o">)</span> <span class="n">F</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Fseq</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">cat_id_after</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="n">Fseq</span> <span class="n">F</span> <span class="o">(</span><span class="n">CatId</span> <span class="n">D</span><span class="o">)</span> <span class="bp">=</span> <span class="n">F</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">ext</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">exact</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">intro</span><span class="o">,</span> <span class="n">delta</span> <span class="n">Fseq</span> <span class="n">CatId</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">Cat</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="n">cat</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">),</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">C</span> <span class="n">D</span> <span class="n">E</span><span class="o">,</span> <span class="n">Fseq</span><span class="o">)</span>
<span class="o">(</span><span class="n">CatId</span><span class="o">)</span>
<span class="o">(</span><span class="n">cat_id_before</span><span class="o">)</span>
<span class="o">(</span><span class="n">cat_id_after</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">delta</span> <span class="n">Fseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">reverse_compose</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">intros</span><span class="o">,</span> <span class="n">trivial</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">structure</span> <span class="n">iso</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
<span class="o">(</span><span class="n">inv</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">finv</span><span class="o">:</span>  <span class="n">C.seq</span> <span class="n">f</span> <span class="n">inv</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">a</span><span class="o">)</span>
<span class="o">(</span><span class="n">invf</span><span class="o">:</span>  <span class="n">C.seq</span> <span class="n">inv</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">C.Id</span> <span class="n">b</span><span class="o">)</span>

<span class="c1">---- Natural transformations</span>
<span class="kd">def</span> <span class="n">preNT</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">G.o</span> <span class="n">x</span><span class="o">)</span>

<span class="kd">@[ext]</span> <span class="kd">structure</span> <span class="n">NT</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">preNT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">F.m</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">η</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">η</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">G.m</span> <span class="n">f</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">NTId</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span> <span class="n">NT.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="kd">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">D.id_before</span><span class="o">,</span> <span class="n">D.id_after</span><span class="o">])</span>

<span class="kd">def</span> <span class="n">NTseq</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">{</span><span class="n">F</span> <span class="n">G</span> <span class="n">H</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">}</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">G</span> <span class="n">H</span><span class="o">)</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span> <span class="n">NT.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">D.seq</span> <span class="o">(</span><span class="n">N.η</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">M.η</span> <span class="n">x</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="n">f</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span><span class="n">D.assoc</span><span class="o">,</span> <span class="n">N.comm</span><span class="o">,</span> <span class="n">D.assoc</span><span class="o">,</span> <span class="n">M.comm</span><span class="o">,</span> <span class="n">D.assoc</span><span class="o">])</span>

<span class="kd">theorem</span> <span class="n">NT_idbefore</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">NTseq</span> <span class="o">(</span><span class="n">NTId</span> <span class="n">F</span><span class="o">)</span> <span class="n">N</span> <span class="bp">=</span> <span class="n">N</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">delta</span> <span class="n">NTId</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.id_before</span><span class="o">]</span> <span class="kd">end</span>

<span class="kd">theorem</span> <span class="n">NT_idafter</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="n">G</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="o">:</span> <span class="n">NT</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">NTseq</span> <span class="n">N</span> <span class="o">(</span><span class="n">NTId</span> <span class="n">G</span><span class="o">)</span> <span class="bp">=</span> <span class="n">N</span> <span class="o">:=</span>
<span class="kd">begin</span> <span class="n">delta</span> <span class="n">NTId</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.id_after</span><span class="o">]</span> <span class="kd">end</span>

<span class="kd">def</span> <span class="n">FunctCat</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT</span><span class="o">)</span>
<span class="o">(</span><span class="bp">@</span><span class="n">NTseq</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">NTId</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT_idbefore</span><span class="o">)</span>
<span class="o">(</span><span class="n">NT_idafter</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">delta</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">D.assoc</span><span class="o">]</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">isSingleton</span> <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">y</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span>
<span class="kd">def</span> <span class="n">isInitial</span>  <span class="o">{</span><span class="n">C</span><span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">isSingleton</span> <span class="o">(</span><span class="n">C.hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">isTerminal</span> <span class="o">{</span><span class="n">C</span><span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">isSingleton</span> <span class="o">(</span><span class="n">C.hom</span> <span class="n">d</span> <span class="n">c</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">Terminal</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span>  <span class="bp">//</span> <span class="n">isTerminal</span> <span class="n">c</span> <span class="o">}</span>
<span class="kd">def</span> <span class="n">Initial</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span>  <span class="bp">//</span> <span class="n">isInitial</span> <span class="n">c</span> <span class="o">}</span>

<span class="kd">def</span> <span class="n">Nonempty</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">:=</span> <span class="n">inhabited</span> <span class="n">C.obj</span>

<span class="kd">def</span> <span class="n">Types</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="kt">Type</span> <span class="n">_</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">A</span> <span class="n">B</span><span class="o">,</span> <span class="o">(</span><span class="n">A</span> <span class="bp">→</span> <span class="n">B</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">f</span> <span class="bp">⨟</span> <span class="n">g</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">tidy</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="c1">---- Comma categories</span>
<span class="kd">def</span> <span class="n">comm_square</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">{</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">ab</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">bd</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">d</span><span class="o">)</span> <span class="o">(</span><span class="n">ac</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">cd</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="n">C.seq</span> <span class="n">ab</span> <span class="n">bd</span> <span class="bp">=</span> <span class="n">C.seq</span> <span class="n">ac</span> <span class="n">cd</span>

<span class="kd">theorem</span> <span class="n">comp_comm_square</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">{</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span><span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">{</span><span class="n">ab</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="o">{</span><span class="n">bd</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">b</span> <span class="n">d</span><span class="o">}</span> <span class="o">{</span><span class="n">ac</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">a</span> <span class="n">c</span><span class="o">}</span> <span class="o">{</span><span class="n">cd</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">d</span><span class="o">}</span> <span class="o">{</span><span class="n">df</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">d</span> <span class="n">f</span><span class="o">}</span> <span class="o">{</span><span class="n">ce</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">e</span><span class="o">}</span> <span class="o">{</span><span class="n">ef</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">e</span> <span class="n">f</span><span class="o">}</span>
<span class="o">(</span><span class="n">abcd</span> <span class="o">:</span> <span class="n">comm_square</span> <span class="n">ab</span> <span class="n">bd</span> <span class="n">ac</span> <span class="n">cd</span><span class="o">)</span> <span class="o">(</span><span class="n">cdef</span> <span class="o">:</span> <span class="n">comm_square</span> <span class="n">cd</span> <span class="n">df</span> <span class="n">ce</span> <span class="n">ef</span><span class="o">)</span> <span class="o">:</span> <span class="n">comm_square</span> <span class="n">ab</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">bd</span> <span class="n">df</span><span class="o">)</span> <span class="o">(</span><span class="n">C.seq</span> <span class="n">ac</span> <span class="n">ce</span><span class="o">)</span> <span class="n">ef</span> <span class="o">:=</span>
<span class="kd">begin</span>
<span class="n">unfold</span> <span class="n">comm_square</span><span class="o">,</span>
<span class="n">unfold</span> <span class="n">comm_square</span> <span class="n">at</span> <span class="n">abcd</span><span class="o">,</span>
<span class="n">unfold</span> <span class="n">comm_square</span> <span class="n">at</span> <span class="n">cdef</span><span class="o">,</span>
<span class="n">rw</span> <span class="o">[</span><span class="n">C.assoc</span><span class="o">,</span> <span class="bp">←</span><span class="n">cdef</span><span class="o">,</span> <span class="bp">←</span><span class="n">C.assoc</span><span class="o">,</span> <span class="n">abcd</span><span class="o">,</span> <span class="n">C.assoc</span><span class="o">],</span>
<span class="kd">end</span>

<span class="kd">theorem</span> <span class="n">funct_id</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">),</span> <span class="n">F.m</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">c</span><span class="o">)</span> <span class="bp">=</span> <span class="n">D.Id</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
<span class="n">intro</span> <span class="n">c</span><span class="o">,</span>
<span class="n">rw</span> <span class="o">[</span><span class="n">F.id</span> <span class="n">c</span><span class="o">],</span>
<span class="kd">end</span>


<span class="kd">variables</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">A</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">T</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">B</span> <span class="n">C</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">CommaObj</span> <span class="o">:=</span> <span class="bp">Σ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A.obj</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">B.obj</span><span class="o">),</span> <span class="n">C.hom</span> <span class="o">(</span><span class="n">S.o</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">T.o</span> <span class="n">b</span><span class="o">)</span>

<span class="kd">@[ext]</span>
<span class="kd">structure</span> <span class="n">CommaHom</span> <span class="o">(</span><span class="n">ar1</span> <span class="n">ar2</span> <span class="o">:</span> <span class="n">CommaObj</span> <span class="n">C</span> <span class="n">S</span> <span class="n">T</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">sourcef</span> <span class="o">:</span> <span class="n">A.hom</span> <span class="n">ar1.1</span> <span class="n">ar2.1</span><span class="o">)</span>
<span class="o">(</span><span class="n">targetf</span> <span class="o">:</span> <span class="n">B.hom</span> <span class="n">ar1.2.1</span> <span class="n">ar2.2.1</span><span class="o">)</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="n">comm_square</span> <span class="n">ar1.2.2</span> <span class="o">(</span><span class="n">T.m</span> <span class="n">targetf</span><span class="o">)</span> <span class="o">(</span><span class="n">S.m</span> <span class="n">sourcef</span><span class="o">)</span> <span class="n">ar2.2.2</span> <span class="o">)</span>

<span class="kd">def</span> <span class="n">Comma</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="n">CommaObj</span> <span class="n">C</span> <span class="n">S</span> <span class="n">T</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">ar1</span> <span class="n">ar2</span><span class="o">,</span> <span class="n">CommaHom</span> <span class="n">C</span> <span class="n">S</span> <span class="n">T</span> <span class="n">ar1</span> <span class="n">ar2</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">ar1</span> <span class="n">ar2</span> <span class="n">ar3</span> <span class="n">m12</span> <span class="n">m23</span><span class="o">,</span> <span class="n">CommaHom.mk</span> <span class="o">(</span><span class="n">A.seq</span> <span class="n">m12.sourcef</span> <span class="n">m23.sourcef</span><span class="o">)</span> <span class="o">(</span><span class="n">B.seq</span> <span class="n">m12.targetf</span> <span class="n">m23.targetf</span><span class="o">)</span> <span class="o">(</span><span class="kd">begin</span>
   <span class="n">rw</span> <span class="o">[</span><span class="n">T.comm</span><span class="o">,</span><span class="n">S.comm</span><span class="o">],</span> <span class="n">exact</span> <span class="n">comp_comm_square</span> <span class="n">m12.comm</span> <span class="n">m23.comm</span><span class="o">,</span> <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">ar</span><span class="o">,</span> <span class="n">CommaHom.mk</span> <span class="o">(</span><span class="n">A.Id</span> <span class="n">ar.1</span><span class="o">)</span> <span class="o">(</span><span class="n">B.Id</span> <span class="n">ar.2.1</span><span class="o">)</span> <span class="o">(</span><span class="kd">begin</span> <span class="n">rw</span> <span class="o">[</span><span class="n">funct_id</span><span class="o">,</span> <span class="n">funct_id</span><span class="o">],</span> <span class="n">unfold</span> <span class="n">comm_square</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.id_before</span><span class="o">,</span> <span class="n">C.id_after</span><span class="o">],</span> <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">A.id_before</span><span class="o">,</span> <span class="n">B.id_before</span><span class="o">],</span> <span class="n">ext</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">A.id_after</span><span class="o">,</span> <span class="n">B.id_after</span><span class="o">],</span> <span class="n">ext</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span> <span class="n">split</span><span class="o">,</span> <span class="n">apply</span> <span class="n">A.assoc</span><span class="o">,</span> <span class="n">apply</span> <span class="n">B.assoc</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="c1">---- Discrete</span>
<span class="kd">inductive</span> <span class="n">Star</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span>
<span class="bp">|</span> <span class="n">star</span> <span class="o">:</span> <span class="n">Star</span>

<span class="kd">def</span> <span class="n">One</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="n">Star</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">Star</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">Star.star</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">refl</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">induction</span> <span class="n">f</span><span class="o">,</span> <span class="n">refl</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">refl</span> <span class="kd">end</span><span class="o">)</span>

<span class="c1">---- Universal morphism</span>

<span class="kd">def</span> <span class="n">constFunct</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">J</span> <span class="o">:</span> <span class="n">cat</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">C.Id</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="kd">by</span> <span class="o">{</span><span class="n">rw</span> <span class="o">[</span><span class="n">C.id_before</span><span class="o">],</span> <span class="n">intros</span><span class="o">,</span> <span class="n">refl</span><span class="o">})</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">objFunct</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">One</span> <span class="n">C</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">C.Id</span> <span class="n">x</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">,</span> <span class="n">eq.symm</span> <span class="o">(</span><span class="n">C.id_before</span> <span class="n">x</span> <span class="n">x</span> <span class="o">(</span><span class="n">C.Id</span> <span class="n">x</span><span class="o">)))</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">rfl</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">FtoXCat</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="o">(</span><span class="n">Comma</span> <span class="n">C</span> <span class="n">F</span> <span class="o">(</span><span class="n">objFunct</span> <span class="n">x</span><span class="o">))</span>
<span class="kd">def</span> <span class="n">FfromXCat</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="o">(</span><span class="n">Comma</span> <span class="n">C</span> <span class="o">(</span><span class="n">objFunct</span> <span class="n">x</span><span class="o">)</span> <span class="n">F</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">universal_FtoX</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">Terminal</span> <span class="o">(</span><span class="n">FtoXCat</span> <span class="n">F</span> <span class="n">x</span><span class="o">)</span>
<span class="kd">def</span> <span class="n">universal_FfromX</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">Initial</span> <span class="o">(</span><span class="n">FfromXCat</span> <span class="n">F</span> <span class="n">x</span><span class="o">)</span>

<span class="c1">---- Limits</span>
<span class="kd">def</span> <span class="n">Diagonal</span> <span class="o">(</span><span class="n">C</span> <span class="n">J</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="o">(</span><span class="n">FunctCat</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">constFunct</span> <span class="n">J</span> <span class="n">c</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="n">NT.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">_</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">delta</span> <span class="n">constFunct</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_before</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_after</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span> <span class="n">delta</span> <span class="n">FunctCat</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">NTseq</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span><span class="o">,</span>  <span class="n">delta</span> <span class="n">FunctCat</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">NTId</span><span class="o">,</span> <span class="n">ext</span><span class="o">,</span> <span class="n">simp</span><span class="o">,</span> <span class="n">delta</span> <span class="n">constFunct</span><span class="o">,</span><span class="n">simp</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">limit_univ_morphism</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span> <span class="n">universal_FtoX</span> <span class="o">(</span><span class="n">Diagonal</span> <span class="n">C</span> <span class="n">J</span><span class="o">)</span> <span class="n">F</span>
<span class="kd">def</span> <span class="n">colimit_univ_morphism</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span> <span class="n">universal_FfromX</span> <span class="o">(</span><span class="n">Diagonal</span> <span class="n">C</span> <span class="n">J</span><span class="o">)</span> <span class="n">F</span>

<span class="kd">structure</span> <span class="n">Cone</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">)</span>
<span class="o">(</span><span class="n">proj</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J.obj</span><span class="o">),</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="o">(</span><span class="n">D.o</span> <span class="n">j</span><span class="o">))</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">J.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">J.hom</span> <span class="n">a</span> <span class="n">b</span><span class="o">),</span> <span class="n">C.seq</span> <span class="o">(</span><span class="n">proj</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">D.m</span> <span class="n">m</span><span class="o">)</span> <span class="bp">=</span> <span class="n">proj</span> <span class="n">b</span><span class="o">)</span>

<span class="kd">structure</span> <span class="n">ConeHom</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">c1</span> <span class="n">c2</span> <span class="o">:</span> <span class="n">Cone</span> <span class="n">D</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span> <span class="o">:</span> <span class="n">C.hom</span> <span class="n">c1.c</span> <span class="n">c2.c</span><span class="o">)</span>
<span class="o">(</span><span class="n">comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J.obj</span><span class="o">),</span> <span class="n">c1.proj</span> <span class="n">j</span> <span class="bp">=</span> <span class="n">C.seq</span> <span class="n">map</span> <span class="o">(</span><span class="n">c2.proj</span> <span class="n">j</span><span class="o">))</span>

<span class="kd">def</span> <span class="n">ConeCat</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">cat</span> <span class="o">:=</span> <span class="n">cat.mk</span>
<span class="o">(</span><span class="n">Cone</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c1</span> <span class="n">c2</span><span class="o">,</span> <span class="n">ConeHom</span> <span class="n">D</span> <span class="n">c1</span> <span class="n">c2</span><span class="o">)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="o">⟨</span><span class="n">C.seq</span> <span class="n">f.1</span> <span class="n">g.1</span><span class="o">,</span> <span class="kd">begin</span> <span class="n">intros</span> <span class="n">j</span><span class="o">,</span> <span class="n">cases</span> <span class="n">g</span><span class="o">,</span> <span class="n">cases</span> <span class="n">f</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">f_comm</span> <span class="n">j</span><span class="o">,</span> <span class="n">g_comm</span> <span class="n">j</span><span class="o">,</span> <span class="n">C.assoc</span><span class="o">],</span> <span class="kd">end</span><span class="o">⟩)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="o">⟨</span><span class="n">C.Id</span> <span class="n">c.1</span><span class="o">,</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">j</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.id_before</span><span class="o">],</span> <span class="kd">end</span><span class="o">⟩)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="n">cases</span> <span class="n">f</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.id_before</span><span class="o">],</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="n">cases</span> <span class="n">f</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.id_after</span><span class="o">],</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">g</span><span class="o">,</span> <span class="n">cases</span> <span class="n">f</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">C.assoc</span><span class="o">],</span> <span class="kd">end</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">limit_cone</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Terminal</span> <span class="o">(</span><span class="n">ConeCat</span> <span class="n">F</span><span class="o">)</span>

<span class="kd">def</span> <span class="n">conecat_to_FtoXcat</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">Funct</span> <span class="o">(</span><span class="n">ConeCat</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">FtoXCat</span> <span class="o">(</span><span class="n">Diagonal</span> <span class="n">C</span> <span class="n">J</span><span class="o">)</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span> <span class="n">Funct.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">cone</span><span class="o">,</span> <span class="o">⟨</span><span class="n">cone.c</span><span class="o">,⟨</span><span class="n">Star.star</span><span class="o">,</span> <span class="n">NT.mk</span>
   <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">cone.proj</span> <span class="n">j</span><span class="o">)</span>
   <span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="n">dunfold</span> <span class="n">Diagonal</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">dunfold</span> <span class="n">constFunct</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">rw</span> <span class="n">C.id_before</span><span class="o">,</span> <span class="n">dunfold</span> <span class="n">objFunct</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">cone.comm</span> <span class="n">f</span><span class="o">),</span> <span class="kd">end</span><span class="o">)</span> <span class="o">⟩⟩)</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span><span class="o">,</span> <span class="n">CommaHom.mk</span> <span class="n">f.map</span> <span class="n">Star.star</span> <span class="o">(</span><span class="kd">begin</span>
<span class="n">cases</span> <span class="n">f</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span> <span class="n">ext1</span><span class="o">,</span> <span class="n">ext1</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">FunctCat</span><span class="o">,</span> <span class="n">dunfold</span> <span class="n">objFunct</span><span class="o">,</span> <span class="n">dunfold</span> <span class="n">Diagonal</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">NTseq</span><span class="o">,</span> <span class="n">NTId</span><span class="o">],</span> <span class="n">rw</span> <span class="n">C.id_after</span><span class="o">,</span> <span class="n">rw</span> <span class="o">(</span><span class="n">f_comm</span> <span class="n">x</span><span class="o">),</span>
<span class="kd">end</span><span class="o">))</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>
<span class="o">(</span><span class="kd">begin</span> <span class="n">intro</span> <span class="n">c</span><span class="o">,</span> <span class="n">refl</span><span class="o">,</span> <span class="kd">end</span><span class="o">)</span>

<span class="k">#check</span> <span class="mi">1</span>

<span class="kd">structure</span> <span class="n">full</span> <span class="o">{</span><span class="n">C</span> <span class="n">D</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">C</span> <span class="n">D</span><span class="o">)</span>  <span class="o">:=</span>
<span class="o">(</span><span class="n">pre</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">df</span> <span class="o">:</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)),</span> <span class="n">C.hom</span> <span class="n">c</span> <span class="n">c'</span><span class="o">)</span>
<span class="o">(</span><span class="n">preimage</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">c</span> <span class="n">c'</span> <span class="o">:</span> <span class="n">C.obj</span><span class="o">}</span> <span class="o">(</span><span class="n">df</span> <span class="o">:</span> <span class="n">D.hom</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">F.o</span> <span class="n">c'</span><span class="o">)),</span> <span class="n">F.m</span> <span class="o">(</span><span class="n">pre</span> <span class="n">df</span><span class="o">)</span> <span class="bp">=</span> <span class="n">df</span><span class="o">)</span>

<span class="c1">--- fast version</span>
<span class="c1">-- /-</span>
<span class="kd">theorem</span> <span class="n">cone_to_FtoX_full</span> <span class="o">{</span><span class="n">J</span> <span class="n">C</span> <span class="o">:</span> <span class="n">cat</span><span class="o">}</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">Funct</span> <span class="n">J</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="n">full</span> <span class="o">(</span><span class="n">conecat_to_FtoXcat</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span> <span class="n">full.mk</span>
<span class="o">(</span><span class="bp">λ</span> <span class="n">c</span> <span class="n">c'</span> <span class="n">f</span><span class="o">,</span> <span class="o">⟨</span><span class="n">f.sourcef</span><span class="o">,</span><span class="kd">begin</span>
<span class="k">have</span> <span class="n">fcomm</span><span class="o">,</span> <span class="k">from</span> <span class="n">f.comm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">conecat_to_FtoXcat</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">Diagonal</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">objFunct</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">comm_square</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">FunctCat</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">NTseq</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">NTId</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">simp_rw</span> <span class="n">C.id_after</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="k">have</span> <span class="n">xx</span><span class="o">,</span> <span class="k">from</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="n">congr_fun</span> <span class="n">fcomm</span> <span class="n">j</span><span class="o">),</span>
<span class="n">dsimp</span> <span class="n">only</span> <span class="n">at</span> <span class="n">xx</span><span class="o">,</span>
<span class="n">exact</span> <span class="n">xx</span><span class="o">,</span>
<span class="kd">end</span><span class="o">⟩)</span>
<span class="gr">sorry</span>
<span class="c1">-- -/</span>

<span class="c1">--- super slow version (same as above, but s/dunfold/delta)</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">theorem cone_to_FtoX_full {J C : cat} (F : Funct J C) : full (conecat_to_FtoXcat F) := full.mk</span>
<span class="cm">(λ c c' f, ⟨f.sourcef,begin</span>
<span class="cm">have fcomm, from f.comm,</span>
<span class="cm">delta conecat_to_FtoXcat at fcomm,</span>
<span class="cm">delta Diagonal at fcomm,</span>
<span class="cm">delta objFunct at fcomm,</span>
<span class="cm">dsimp at fcomm,</span>
<span class="cm">delta comm_square at fcomm,</span>
<span class="cm">delta FunctCat at fcomm,</span>
<span class="cm">dsimp at fcomm,</span>
<span class="cm">delta NTseq at fcomm,</span>
<span class="cm">dsimp at fcomm,</span>
<span class="cm">delta NTId at fcomm,</span>
<span class="cm">dsimp at fcomm,</span>
<span class="cm">simp_rw C.id_after at fcomm,</span>
<span class="cm">have xx, from (λ j, congr_fun fcomm j),</span>
<span class="cm">dsimp only at xx,</span>
<span class="cm">exact xx,</span>
<span class="cm">end⟩)</span>
<span class="cm">sorry</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="271041932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271041932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271041932">(Feb 07 2022 at 21:07)</a>:</h4>
<p>Not sure how to boil this down to a small example.</p>



<a name="271042002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271042002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271042002">(Feb 07 2022 at 21:08)</a>:</h4>
<p>No I didn't know about <code>#lint</code>, thanks, I'll try that out!</p>



<a name="271049989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271049989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271049989">(Feb 07 2022 at 22:11)</a>:</h4>
<p>These multiple <code>dunfold</code>s in proofs indicate to me that you are missing some API.</p>



<a name="271054343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271054343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271054343">(Feb 07 2022 at 22:43)</a>:</h4>
<p>API? Do you mean something like, if I define <code>bar</code> in terms of <code>foo</code>, and then <code>baz</code> in terms of <code>bar</code>, I should also define <code>baz</code> in an elementary way, and then prove that the definitions are equivalent, so that I don't have to unpack all the way to <code>foo</code> when dealing with <code>baz</code>?</p>



<a name="271054371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271054371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tsvi Benson-Tilsen <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271054371">(Feb 07 2022 at 22:43)</a>:</h4>
<p>And like prove lemmas about <code>baz</code>?</p>



<a name="271055237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/exact/assumption%20timeout/near/271055237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/exact.2Fassumption.20timeout.html#271055237">(Feb 07 2022 at 22:52)</a>:</h4>
<p>I have not looked at your code in detail, but my gut feeling is that</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">dunfold</span> <span class="n">conecat_to_FtoXcat</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">Diagonal</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dunfold</span> <span class="n">objFunct</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
<span class="n">dsimp</span> <span class="n">at</span> <span class="n">fcomm</span><span class="o">,</span>
</code></pre></div>
<p>should be replaced with <code>rw how_it_started_eq_how_it_ends at fcomm</code> where <code>how_it_started_eq_how_it_ends</code> is an independent lemma proved beforehand with <code>refl</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>