---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html">weird clear behaviour?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="299133487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133487">(Sep 16 2022 at 10:39)</a>:</h4>
<p>Dear All,</p>
<p>I do not normally use <code>clear</code>, but decided to try it.  Should I be surprised by the beviour in the following example?</p>
<p>Thanks!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">algebra.order.monoid</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">ordered_cancel_add_comm_monoid</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>

<span class="c1">--  works</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">exact</span> <span class="n">le_rfl</span><span class="o">,</span>
<span class="kd">end</span>

<span class="kn">include</span> <span class="n">h</span>

<span class="c1">--  fails</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">clear</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">le_rfl</span><span class="o">,</span>
<span class="kd">end</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">invalid type ascription, term has type</span>
<span class="cm">  ?m_3 ≤ ?m_3</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  n ≤ n</span>
<span class="cm">state:</span>
<span class="cm">α : Type,</span>
<span class="cm">n : ℕ</span>
<span class="cm">⊢ n ≤ n</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="299133773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133773">(Sep 16 2022 at 10:40)</a>:</h4>
<p>not particularly; what it's complaining about is that <code>le_rfl</code> doesn't have a preorder instance</p>



<a name="299133851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133851">(Sep 16 2022 at 10:41)</a>:</h4>
<p>How does it even let you clear <code>h</code>?</p>



<a name="299133852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133852">(Sep 16 2022 at 10:41)</a>:</h4>
<p>But don't naturals have it, like the earlier example shows?</p>



<a name="299133886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133886">(Sep 16 2022 at 10:41)</a>:</h4>
<p>Yaël, I <code>include</code>d it</p>



<a name="299133893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133893" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133893">(Sep 16 2022 at 10:41)</a>:</h4>
<p>oh, I see that stuff is a bit different than expected!</p>



<a name="299133909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299133909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299133909">(Sep 16 2022 at 10:42)</a>:</h4>
<p>a : N!</p>



<a name="299134029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134029">(Sep 16 2022 at 10:42)</a>:</h4>
<p><code>resetI</code> after the clear works, but why that is necessary boggles the mind...</p>



<a name="299134036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134036">(Sep 16 2022 at 10:42)</a>:</h4>
<p>Right, the statement is the same, I only artificially included <code>h</code> (and <code>\a</code>), remove the artificial <code>h</code> and the same left-over proof fails.</p>



<a name="299134064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134064">(Sep 16 2022 at 10:42)</a>:</h4>
<p>maybe Lean detects that the instance cache has changed and so decides to shut down</p>



<a name="299134129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134129">(Sep 16 2022 at 10:43)</a>:</h4>
<p>Does this suggest that <code>clear</code> should do <code>resetI</code> after it is currently done?</p>



<a name="299134259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134259">(Sep 16 2022 at 10:44)</a>:</h4>
<p>that would be slow, but I feel like clearing a frozen instance should maybe not be possible</p>



<a name="299134297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134297">(Sep 16 2022 at 10:44)</a>:</h4>
<p><span class="user-mention" data-user-id="387244">@Yaël Dillies</span> what happened to your instance colour thing?</p>



<a name="299134339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134339">(Sep 16 2022 at 10:44)</a>:</h4>
<p>It's still over at <a href="https://github.com/leanprover-community/mathlib/pull/15959">#15959</a></p>



<a name="299134368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134368">(Sep 16 2022 at 10:44)</a>:</h4>
<p>The same happens if you <code>clear_except</code> (and of course, <code>a</code> stays, but <code>\a h</code> disappear).</p>



<a name="299134382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134382">(Sep 16 2022 at 10:45)</a>:</h4>
<p>Just something to fix in the HTML and that should be good to go?</p>



<a name="299134627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134627">(Sep 16 2022 at 10:46)</a>:</h4>
<p>so the instance that it usually grabs is <code>nat.ordered_semiring</code> and then precipitates that down to a <code>preorder</code></p>



<a name="299134655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299134655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299134655">(Sep 16 2022 at 10:47)</a>:</h4>
<p>for some reason, typeclass doesn't even bother checking that instance after the <code>clear</code></p>



<a name="299135066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299135066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299135066">(Sep 16 2022 at 10:50)</a>:</h4>
<p>Small disclosure: I found out about this after a <code>clear_except ...</code>.  I think that if you on purpose <code>clear</code> a typeclass assumption, then you should be ready for some weirdness.  But I did not like that doing a <code>clear_except ...</code>  removed instances for me and then made my goals harder to prove!</p>



<a name="299138535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/weird%20clear%20behaviour%3F/near/299138535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Damiano Testa <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/weird.20clear.20behaviour.3F.html#299138535">(Sep 16 2022 at 11:14)</a>:</h4>
<p>I reduced a little the imports in the example above and also changed the name of the <code>nat</code> to <code>n</code>.</p>
<p>It turns out that the instance that you <code>clear</code> should contain some order relation for the error to arise, but not any relation.  <code>[h : has_le α]</code> can be cleared, but <code>[h : preorder α]</code> cannot.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>