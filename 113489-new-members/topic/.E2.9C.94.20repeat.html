---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113489-new-members/topic/.E2.9C.94.20repeat.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/index.html">new members</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html">âœ” repeat</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="252131556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/252131556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#252131556">(Sep 06 2021 at 06:19)</a>:</h4>
<p>To answer my own question, after a bit of experimentation, it seems to be the former.</p>



<a name="252131563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/252131563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#252131563">(Sep 06 2021 at 06:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="282271">Bolton Bailey</span> has marked this topic as resolved.</p>



<a name="253897305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897305" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897305">(Sep 18 2021 at 22:13)</a>:</h4>
<p>So clarify for me. If repeat encounters a state where all goals are solved, and I call try something on that state, will repeat loop forever? It doesn't know even that the state is done?</p>



<a name="253897368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897368">(Sep 18 2021 at 22:14)</a>:</h4>
<p>Presumably one could fix this by making the first tactic in the repeat block a tactic that fails iff the state is done. Is there a tactic like that?</p>



<a name="253897382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897382">(Sep 18 2021 at 22:14)</a>:</h4>
<p><code>repeat { t }</code> calls <code>t</code> until it fails</p>



<a name="253897396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897396">(Sep 18 2021 at 22:15)</a>:</h4>
<p>if <code>t</code> fails on no goals, then it will stop</p>



<a name="253897402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897402">(Sep 18 2021 at 22:15)</a>:</h4>
<p>Maybe <code>fail_if_success done</code> is what's needed at the top then?</p>



<a name="253897410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897410">(Sep 18 2021 at 22:15)</a>:</h4>
<p>sure</p>



<a name="253897468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897468">(Sep 18 2021 at 22:16)</a>:</h4>
<p>What is the reason for the <code>done &lt;|&gt;</code> here?</p>



<a name="253897470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897470">(Sep 18 2021 at 22:16)</a>:</h4>
<p>couldn't you just get rid of that?</p>



<a name="253897481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897481">(Sep 18 2021 at 22:16)</a>:</h4>
<p>most regular tactics fail on no goals</p>



<a name="253897582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897582">(Sep 18 2021 at 22:19)</a>:</h4>
<p>Well in cases where the simplifications solved the goal, I didn't want the failure of the cases to revert that solution.</p>



<a name="253897676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897676">(Sep 18 2021 at 22:20)</a>:</h4>
<p>you could do something like <code>repeat { id { simp, try { clear } } &lt;|&gt;  id { cases; rw } }</code></p>



<a name="253897695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897695">(Sep 18 2021 at 22:21)</a>:</h4>
<p>Now that I think about it, what you're saying doesn't jive with the other things I've seen. Based on what you were saying, my code block should have looped forever no matter what, but</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">repeat</span> <span class="o">{</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span> <span class="k">with</span> <span class="n">integral_domain_simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">},</span>
  <span class="n">done</span> <span class="bp">&lt;|&gt;</span> <span class="n">cases_type</span> <span class="n">or</span><span class="o">,</span> <span class="o">},</span>
</code></pre></div>
<p>Was working for some of my goals.</p>



<a name="253897779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897779">(Sep 18 2021 at 22:23)</a>:</h4>
<p>Can I get a definitive answer to my earlier question? You said "If <code>t</code> fails on no goals, it will stop". I want to know what happens when <code>t</code> succeeds on no goals.</p>



<a name="253897784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897784">(Sep 18 2021 at 22:23)</a>:</h4>
<p>it will not stop</p>



<a name="253897787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897787">(Sep 18 2021 at 22:23)</a>:</h4>
<p><code>repeat</code> has a very simple definition</p>



<a name="253897833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897833">(Sep 18 2021 at 22:24)</a>:</h4>
<p>it's just a while loop</p>



<a name="253897887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253897887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253897887">(Sep 18 2021 at 22:25)</a>:</h4>
<p>That can't be right,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">repeat</span> <span class="o">{</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span> <span class="k">with</span> <span class="n">integral_domain_simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">},</span>
  <span class="n">done</span> <span class="bp">&lt;|&gt;</span> <span class="n">cases_type</span> <span class="n">or</span><span class="o">,</span> <span class="o">},</span>
</code></pre></div>
<p>Succeeds in resolving my goal completely in another part of my code.</p>



<a name="253898059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898059">(Sep 18 2021 at 22:29)</a>:</h4>
<p>hm, actually <code>repeat</code>  is a little more complicated. <code>iterate { tac }</code> is just a while loop but <code>repeat { tac }</code> is more like <code>try { any_goals { tac; repeat { tac } } }</code></p>



<a name="253898167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898167">(Sep 18 2021 at 22:31)</a>:</h4>
<p>which means that if <code>tac</code> produces no goals then <code>repeat</code> will stop without re-running <code>tac</code></p>



<a name="253898176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898176">(Sep 18 2021 at 22:31)</a>:</h4>
<p>because it calls <code>tac</code> on all goals produced by <code>tac</code></p>



<a name="253898344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898344">(Sep 18 2021 at 22:34)</a>:</h4>
<p>Ok,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">iterate</span> <span class="o">{</span>
  <span class="n">try</span> <span class="o">{</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span> <span class="k">with</span> <span class="n">integral_domain_simp</span> <span class="n">at</span> <span class="bp">*</span><span class="o">},</span>
  <span class="n">done</span> <span class="bp">&lt;|&gt;</span> <span class="n">cases_type</span> <span class="n">or</span><span class="o">,</span> <span class="o">},</span>
</code></pre></div>
<p>Also succeeds in resolving my goal. So that can't be a true while loop either.</p>



<a name="253898467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898467">(Sep 18 2021 at 22:37)</a>:</h4>
<p>does it take a really long time?</p>



<a name="253898470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898470">(Sep 18 2021 at 22:37)</a>:</h4>
<p>Nope</p>



<a name="253898476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898476">(Sep 18 2021 at 22:37)</a>:</h4>
<p>It's not actually an infinite loop, it calls <code>tac</code> at most 100000 times</p>



<a name="253898529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898529">(Sep 18 2021 at 22:38)</a>:</h4>
<p>It takes about a minute</p>



<a name="253898534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898534">(Sep 18 2021 at 22:38)</a>:</h4>
<p>but there is no goal handling or funny business though, so I think it is actually doing that</p>



<a name="253898569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898569">(Sep 18 2021 at 22:39)</a>:</h4>
<p><code>simp</code> will fail right away without any goals, and <code>done</code> will also succeed immediately, so I guess it's not crazy that you can loop that many times in a minute</p>



<a name="253898588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898588">(Sep 18 2021 at 22:39)</a>:</h4>
<p>Yeah, I see, once there are no goals it just chews through the iterations.</p>



<a name="253898636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898636">(Sep 18 2021 at 22:40)</a>:</h4>
<p>(It could be an actual infinite loop but that can cause the server to hang)</p>



<a name="253898650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898650">(Sep 18 2021 at 22:40)</a>:</h4>
<p>Let me put <code>fail_if_success done</code> in front and see if that causes less time</p>



<a name="253898778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253898778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bolton Bailey <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253898778">(Sep 18 2021 at 22:43)</a>:</h4>
<p>Yup, <code>fail_if_success { done, },</code> makes it take less time, mystery solved.</p>



<a name="253899745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%E2%9C%94%20repeat/near/253899745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/113489-new-members/topic/.E2.9C.94.20repeat.html#253899745">(Sep 18 2021 at 23:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="282271">Bolton Bailey</span> has marked this topic as resolved.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>