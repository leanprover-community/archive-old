[
    {
        "content": "<p>The tactic <code>congr'</code> is supposed to be a more precise version of <code>congr</code>.  You can specify the number of levels you want <code>congr</code> to break down an equality on, if you don't want it to go all the way.  But sometimes a single level number is not precise enough, if there's a \"tree\" of matching with different desired levels on different branches.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congr'</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">congr</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congr'</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">congr</span><span class=\"o\">,</span>\n    <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">congr'</span> <span class=\"mi\">1</span><span class=\"o\">,</span>\n    <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n    <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">}</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282252485,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652451214
    },
    {
        "content": "<p>What would people think of a more precise syntax for <code>congr'</code>, modelled on <code>change</code>?</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"c1\">-- desired syntax</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congr'</span> <span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">}</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n\n<span class=\"c1\">-- desired syntax</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congr'</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">}</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>(I used these <code>true → a = b</code> hypotheses to mimic examples where each individual equality would be closed by some tactic, since <code>congr'</code> automatically picks up and applies equality hypotheses.).</p>",
        "id": 282252628,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652451269
    },
    {
        "content": "<p>This sounds a lot like the suggested <code>congr</code> macro from another thread</p>",
        "id": 282254144,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1652451925
    },
    {
        "content": "<p>Namely, this one: <a href=\"#narrow/stream/144837-PR-reviews/topic/.2313979.20arbitrary.20proof.20terms.20in.20.60linear_combination.60/near/281627870\">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/.2313979.20arbitrary.20proof.20terms.20in.20.60linear_combination.60/near/281627870</a></p>",
        "id": 282254276,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1652451971
    },
    {
        "content": "<p>(which is to say; I like this suggestion but wonder if we can combine the two somehow)</p>",
        "id": 282254568,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1652452092
    },
    {
        "content": "<p>I was aware of this issue when I first designed the syntax; my reasoning was that if you want an asymmetric descent you can use <code>congr' 1</code> and then <code>congr' n</code> again in the subgoals</p>",
        "id": 282255751,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1652452604
    },
    {
        "content": "<p>By the way you can compress this into one line using <code>congr' 1; [congr, skip]</code> and <code>congr' 1; [congr, congr' 1]</code> in your examples respectively</p>",
        "id": 282256063,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1652452756
    },
    {
        "content": "<p><code>congr f _ = _</code> is a lot more intuitive though.</p>",
        "id": 282257043,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1652453124
    },
    {
        "content": "<p>It might make sense to use a different marker to <code>_</code>, so that we can distinguish \"create a goal out of this hole\" and \"this bit is constant, work it out from the goal\"</p>",
        "id": 282259042,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1652453905
    },
    {
        "content": "<p>I guess to match pattern matching <code>._</code>/ <code>.(_)</code> could be \"don't make a goal out of this\"</p>",
        "id": 282259101,
        "sender_full_name": "Eric Wieser",
        "timestamp": 1652453939
    },
    {
        "content": "<p>yeah that part will be easier in lean 4 with  <code>_</code>/<code>?_</code></p>",
        "id": 282261890,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1652455112
    },
    {
        "content": "<p>I agree <code>_</code> is a bad notation here, especially since in non-contrived examples writing the type of the goal can be really complicated and you want to omit anything you can to avoid spurious type errors</p>",
        "id": 282262042,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1652455182
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/239415-metaprogramming-.2F-tactics/topic/variant.20syntax.20for.20.60congr'.60/near/282259042\">said</a>:</p>\n<blockquote>\n<p>It might make sense to use a different marker to <code>_</code>, so that we can distinguish \"create a goal out of this hole\" and \"this bit is constant, work it out from the goal\"</p>\n</blockquote>\n<p>Yes, I agree this would be useful, although ideally both markers could be only one character long.</p>",
        "id": 282291647,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652468635
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"310045\">Eric Wieser</span> <a href=\"#narrow/stream/239415-metaprogramming-.2F-tactics/topic/variant.20syntax.20for.20.60congr'.60/near/282254144\">said</a>:</p>\n<blockquote>\n<p>This sounds a lot like the suggested <code>congr</code> macro from another thread</p>\n<p>Namely, this one: <a href=\"#narrow/stream/144837-PR-reviews/topic/.2313979.20arbitrary.20proof.20terms.20in.20.60linear_combination.60/near/281627870\">https://leanprover.zulipchat.com/#narrow/stream/144837-PR-reviews/topic/.2313979.20arbitrary.20proof.20terms.20in.20.60linear_combination.60/near/281627870</a></p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"306601\">@Kyle Miller</span>'s idea is for a tactic which acts on hypotheses: given the equality hypotheses <code>H : a = b</code>, <code>H' : c + (f a) = c + (f d)</code>, <code>H'' : f d = f b</code>, it would create a <strong>hypothesis</strong> </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>by writing</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">have</span> <span class=\"o\">:=</span> <span class=\"n\">exact_congr</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">%!</span><span class=\"n\">H</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">%!</span><span class=\"n\">H''</span> <span class=\"bp\">+</span> <span class=\"bp\">%!</span><span class=\"n\">H'</span><span class=\"o\">),</span>\n</code></pre></div>\n<p>whereas my idea is for a tactic which acts on goals: given the <strong>goal</strong> </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span>\n</code></pre></div>\n<p>it would reduce this to goals <code>a = b</code> <code>c + (f a) = c + (f d)</code>, <code>f d = f b</code> by writing</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">congr'</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>I agree that there is some relationship (a bit subtle) and I think they would both be very useful!</p>",
        "id": 282309701,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652478263
    },
    {
        "content": "<p>Maybe my idea amounts to</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">refine</span> <span class=\"n\">exact_congr</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">%!</span><span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"bp\">%!</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"bp\">%!</span><span class=\"n\">_</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>if that will be permitted (although I think it's still nice to have this callable under the tactic name <code>congr'</code>).</p>",
        "id": 282310082,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652478475
    },
    {
        "content": "<p>Heather, what you would like is to unify the input that you give with the target, returning the provided metavariables as side goals, right?</p>",
        "id": 282327169,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652494954
    },
    {
        "content": "<p>Maybe, trying <code>congr</code> on each side goal, would also make the <code>_</code> that were in place to avoid rewriting some part of the expression deal with the \"different\" interpretations that <code>_</code> might have.</p>",
        "id": 282327257,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652495081
    },
    {
        "content": "<p>Sorry <span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span>, I don't follow, can you explain?</p>",
        "id": 282328685,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652497268
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"321459\">Damiano Testa</span> <a href=\"#narrow/stream/239415-metaprogramming-.2F-tactics/topic/variant.20syntax.20for.20.60congr'.60/near/282327169\">said</a>:</p>\n<blockquote>\n<p>Heather, what you would like is to unify the input that you give with the target, returning the provided metavariables as side goals, right?</p>\n</blockquote>\n<p>I'm not sure this is the same as what I'm asking -- the input <code>f (f _) + (f _ + _)</code> I'm suggesting is the \"shared LHS/RHS pattern\" of the target, not the target itself.</p>",
        "id": 282328738,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652497330
    },
    {
        "content": "<p>If I understood correctly, you would like something like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">do</span> <span class=\"n\">t</span> <span class=\"bp\">←</span> <span class=\"n\">target</span><span class=\"o\">,</span>\n <span class=\"n\">unify</span> <span class=\"n\">t</span> <span class=\"o\">(</span><span class=\"n\">expr</span> <span class=\"n\">corresponding</span> <span class=\"n\">that</span> <span class=\"n\">what</span> <span class=\"n\">you</span> <span class=\"n\">provide</span><span class=\"o\">),</span>\n<span class=\"n\">return</span> <span class=\"o\">(</span><span class=\"n\">all</span> <span class=\"n\">metavariable</span> <span class=\"n\">goals</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Is this clearer?  Close to what you wanted?</p>",
        "id": 282328753,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652497399
    },
    {
        "content": "<p>I think it's more like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"k\">do</span> <span class=\"n\">t</span> <span class=\"bp\">←</span> <span class=\"n\">target</span><span class=\"o\">,</span>\n  <span class=\"n\">e</span> <span class=\"bp\">←</span> <span class=\"n\">mk_app</span> <span class=\"n\">eq</span> <span class=\"o\">[(</span><span class=\"n\">expr</span> <span class=\"n\">corresponding</span> <span class=\"n\">that</span> <span class=\"n\">what</span> <span class=\"n\">you</span> <span class=\"n\">provide</span><span class=\"o\">),</span> <span class=\"o\">(</span><span class=\"n\">expr</span> <span class=\"n\">corresponding</span> <span class=\"n\">that</span> <span class=\"n\">what</span> <span class=\"n\">you</span> <span class=\"n\">provide</span><span class=\"o\">)]</span>\n <span class=\"n\">unify</span> <span class=\"n\">t</span> <span class=\"n\">e</span><span class=\"o\">,</span>\n</code></pre></div>\n<p>but I'm not very experienced at metaprogramming, so this is certainly incorrect in a literal sense!</p>",
        "id": 282328821,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652497508
    },
    {
        "content": "<p>Ah, I see!  You are right.  I had understood what you asked, but then messed up.  Yes, in my pseudo-code above, I was thinking of providing </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>which, if I interpreted your version correctly, if what you wanted!</p>",
        "id": 282328977,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652497738
    },
    {
        "content": "<p>But I want more than just the unification, right?  I want to reduce the goal to a series of subgoals, one for each matching LHS/RHS pair of underscores.</p>",
        "id": 282329148,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652498016
    },
    {
        "content": "<p>Yes, I think that you would want each metavariable to be returned as a goal, possibly passed through a <code>congr</code> before that, in case it works.</p>",
        "id": 282329237,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652498115
    },
    {
        "content": "<p>something like <code>match (your expr = your expr) with target, return metavariables as side-goals</code>.  Let me try!</p>",
        "id": 282329295,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652498171
    },
    {
        "content": "<p>(I am very new to meta-programming, so I am not very confident that I will get anywhere, but I like the challenge!)</p>",
        "id": 282329303,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652498197
    },
    {
        "content": "<p>Please go ahead, I'd love to have this tactic!</p>\n<p>As I said in the initial post, I imagine it as a variant of <code>congr'</code> and reusing most of the internals of that tactic.  But it's true that my proposed input syntax provides more information than <code>congr' 3</code> would (it provides the names of the functions, not just the number of function applications), so maybe this unification-based trick you're describing would work too.</p>",
        "id": 282329414,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652498383
    },
    {
        "content": "<p>I think that it will be some combination of <code>match, unify, congr(')</code>.  Maybe!</p>",
        "id": 282329491,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652498488
    },
    {
        "content": "<p>This does not work yet, but seems to go somewhere along the way. It made me realize that there might be a typo in your first desired syntax: an <code>f</code> for a <code>g</code>.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">tactic.interactive</span>\n<span class=\"kn\">open</span> <span class=\"n\">tactic</span> <span class=\"n\">interactive</span>\n<span class=\"n\">setup_tactic_parser</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">mc_arg</span> <span class=\"o\">(</span><span class=\"n\">prec</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">parser</span> <span class=\"n\">pexpr</span> <span class=\"o\">:=</span>\n<span class=\"n\">parser.pexpr</span> <span class=\"n\">prec</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">mca</span> <span class=\"o\">(</span><span class=\"n\">arg</span> <span class=\"o\">:</span> <span class=\"n\">parse</span> <span class=\"o\">(</span><span class=\"n\">mc_arg</span> <span class=\"n\">tac_rbp</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"k\">do</span> <span class=\"n\">tgt</span> <span class=\"bp\">←</span> <span class=\"n\">target</span><span class=\"o\">,</span>\n  <span class=\"o\">(</span><span class=\"n\">lhs</span><span class=\"o\">,</span> <span class=\"n\">rhs</span><span class=\"o\">)</span> <span class=\"bp\">←</span> <span class=\"n\">match_eq</span> <span class=\"n\">tgt</span><span class=\"o\">,</span>\n  <span class=\"n\">gl</span> <span class=\"bp\">←</span> <span class=\"n\">to_expr</span> <span class=\"n\">arg</span><span class=\"o\">,</span>\n  <span class=\"n\">e</span> <span class=\"bp\">←</span> <span class=\"n\">mk_app</span> <span class=\"bp\">`</span><span class=\"n\">eq</span> <span class=\"o\">[</span><span class=\"n\">gl</span><span class=\"o\">,</span> <span class=\"n\">gl</span><span class=\"o\">],</span>\n  <span class=\"n\">e1</span> <span class=\"bp\">←</span> <span class=\"n\">mk_app</span> <span class=\"bp\">`</span><span class=\"n\">eq</span> <span class=\"o\">[</span><span class=\"n\">tgt</span><span class=\"o\">,</span> <span class=\"n\">e</span><span class=\"o\">],</span>\n  <span class=\"n\">n</span> <span class=\"bp\">←</span> <span class=\"n\">get_unused_name</span><span class=\"o\">,</span>\n  <span class=\"n\">assert</span> <span class=\"n\">n</span> <span class=\"n\">e1</span><span class=\"o\">,</span>\n  <span class=\"n\">congr</span>\n<span class=\"kd\">end</span> <span class=\"n\">tactic.interactive</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n\n<span class=\"c1\">-- desired syntax</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">g</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">g</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"o\">:=</span> <span class=\"c1\">-- I changed an `f` to a `g`</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">mca</span> <span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">,</span>  <span class=\"c1\">-- produces the \"right\" goals, but also an unwanted one</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"n\">trivial</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"o\">},</span> <span class=\"c1\">-- works</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"n\">trivial</span><span class=\"o\">)</span><span class=\"bp\">.</span><span class=\"n\">symm</span> <span class=\"o\">},</span> <span class=\"c1\">-- works</span>\n<span class=\"c1\">-- the original goal persists</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282330715,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652500420
    },
    {
        "content": "<p>Ok, maybe it was not a typo in your first example, I think that I might have implemented <code>congr</code> in a less efficient way!  <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span> </p>\n<p>Maybe, instead of the last <code>congr</code>,  I should use <code>congr' 1</code> in some way.</p>\n<p>Or maybe, I should try to unify the <code>lhs</code> and then <code>congr</code> the rhs.</p>",
        "id": 282330822,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652500618
    },
    {
        "content": "<p>Actually, it's an interesting observation that unification does most of the work here. The way I imagine it, you take the expression with holes and elaborate it to an expr with metavariables. Then unify it with the LHS, producing an assignment of the metavariables. Then <em>undo</em> that unification to unassign the metavariables and unify it with the RHS, producing another assignment. Finally, for every metavariable generated by the original expression we take the two assignments to it and equate them, and those are the desired subgoals. (Filter out the ones that are defeq or other trivialities.)</p>",
        "id": 282331996,
        "sender_full_name": "Mario Carneiro",
        "timestamp": 1652502488
    },
    {
        "content": "<p>Yes, I was now trying to parse two exprs simultaneously, matching on whether they were both <code>has_add.add</code> or both <code>expr.app</code> and if so, trying to unify the arguments (failing otherwise).  But it would be useful to maybe have a type of \"repeated exprs\", so that it applies to <code>expr = expr</code> where you want do treat the two <code>expr</code> as equal...</p>",
        "id": 282332421,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652503144
    },
    {
        "content": "<p>(I'm not sure if what I said was comprehensible, I am still struggling with matches...)</p>",
        "id": 282332428,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652503170
    },
    {
        "content": "<p>What I had in mind is a function that takes to <code>expr</code> and returns a <code>tactic (list expr)</code>.  The first <code>expr</code> is the one assumed to have metavariables (eventually arising from the user input), the second one is the \"full pattern\" (eventually arising from the target).</p>",
        "id": 282332485,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652503268
    },
    {
        "content": "<p>Now you scan the two exprs, assuming that, where they differ, it is because there is a metavariable on the left.  When you find a metavariable, you produce a goal between the \"mirror images\" of the actual terms arising from the second expr.</p>",
        "id": 282332536,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652503355
    },
    {
        "content": "<p>It might be simpler to match 3 <code>expr</code>s, assuming that they are \"built in the same way, except that the first one might have mvars instead of actual info\".  Then, you look for places where the first has mvar, and you create a goal of the equality of the corresponding locations in the remaining two.</p>",
        "id": 282332704,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652503686
    },
    {
        "content": "<p>I'm going to have to take a break now, but this is roughly what I had in mind:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">mc</span> <span class=\"o\">:</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span><span class=\"n\">expr</span> <span class=\"bp\">→</span><span class=\"n\">expr</span> <span class=\"bp\">→</span><span class=\"n\">tactic</span> <span class=\"n\">unit</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">expr.mvar</span> <span class=\"n\">n1</span> <span class=\"n\">n2</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:=</span> <span class=\"o\">(</span><span class=\"n\">make</span> <span class=\"n\">equation</span> <span class=\"n\">f</span><span class=\"bp\">=</span><span class=\"n\">g</span><span class=\"o\">)</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">expr.</span><span class=\"bp\">???</span> <span class=\"n\">args</span><span class=\"o\">)</span> <span class=\"n\">same</span> <span class=\"n\">same</span> <span class=\"o\">:=</span> <span class=\"n\">make</span> <span class=\"n\">sure</span> <span class=\"n\">args</span> <span class=\"k\">match</span> <span class=\"n\">and</span> <span class=\"n\">descend</span>\n<span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">:=</span> <span class=\"n\">fail</span> <span class=\"s2\">\"sorry, no match\"</span>\n</code></pre></div>\n<p>This would be applied to <code>(to_expr user_input) target_lhs target_rhs</code>.</p>",
        "id": 282333200,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652504379
    },
    {
        "content": "<p>This is what I have, but does not enter enough into the expressions.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">mc_m</span> <span class=\"o\">:</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">expr.mvar</span> <span class=\"n\">n1</span> <span class=\"n\">n2</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:=</span> <span class=\"k\">do</span> <span class=\"n\">trace</span> <span class=\"s2\">\"mvar\"</span><span class=\"o\">,</span> <span class=\"n\">trace</span> <span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">trace</span> <span class=\"n\">g</span><span class=\"o\">,</span><span class=\"n\">n</span> <span class=\"bp\">←</span> <span class=\"n\">get_unused_name</span><span class=\"o\">,</span>\n                              <span class=\"n\">fg</span> <span class=\"bp\">←</span> <span class=\"n\">mk_app</span> <span class=\"bp\">`</span><span class=\"n\">eq</span> <span class=\"o\">[</span><span class=\"n\">f</span><span class=\"o\">,</span> <span class=\"n\">g</span><span class=\"o\">],</span>\n                              <span class=\"n\">assert</span> <span class=\"n\">n</span> <span class=\"n\">fg</span><span class=\"o\">,</span> <span class=\"n\">target</span> <span class=\"bp\">&gt;&gt;=</span> <span class=\"n\">trace</span><span class=\"o\">,</span>\n                              <span class=\"n\">skip</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">expr.app</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">expr.app</span> <span class=\"n\">g</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">expr.app</span> <span class=\"n\">h</span> <span class=\"n\">c</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">do</span>\n  <span class=\"n\">unify</span> <span class=\"n\">f</span> <span class=\"n\">g</span><span class=\"o\">,</span>\n  <span class=\"n\">mc_m</span> <span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span>\n<span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">:=</span> <span class=\"n\">fail</span> <span class=\"s2\">\"sorry, no match\"</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">ca</span> <span class=\"o\">(</span><span class=\"n\">arg</span> <span class=\"o\">:</span> <span class=\"n\">parse</span> <span class=\"o\">(</span><span class=\"n\">mc_arg</span> <span class=\"n\">tac_rbp</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"k\">do</span> <span class=\"n\">tgt</span> <span class=\"bp\">←</span> <span class=\"n\">target</span><span class=\"o\">,</span>\n  <span class=\"o\">(</span><span class=\"n\">lhs</span><span class=\"o\">,</span> <span class=\"n\">rhs</span><span class=\"o\">)</span> <span class=\"bp\">←</span> <span class=\"n\">match_eq</span> <span class=\"n\">tgt</span><span class=\"o\">,</span>\n  <span class=\"n\">gl</span> <span class=\"bp\">←</span> <span class=\"n\">to_expr</span> <span class=\"n\">arg</span><span class=\"o\">,</span>\n  <span class=\"n\">mc_m</span> <span class=\"n\">gl</span> <span class=\"n\">lhs</span> <span class=\"n\">rhs</span>\n</code></pre></div>\n<p>I leave it here, but I won't be able to work on this further for a few hours.</p>\n<p><code>mc</code> should probably recurse into <code>lam</code> or <code>pi</code>, as well, possibly both?</p>\n<p>After that, it will be a matter of rewriting the correct hypotheses and leave the leftover goals.</p>",
        "id": 282337471,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652511094
    },
    {
        "content": "<p>I <em>almost</em> have it!</p>\n<p>I think that what is missing below is getting Lean to keep working on the \"main\" goal, instead of one of the side goals.  The first \"desired syntax\" works with some permutation (and, once I learn how to choose on which goal to work, the rewrites should be automatable).  The second one fails, but I think that the reason is that Lean starts working on a side-goal, instead of on the main one.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic</span>\n\n<span class=\"kn\">namespace</span> <span class=\"n\">tactic.interactive</span>\n<span class=\"kn\">open</span> <span class=\"n\">tactic</span> <span class=\"n\">interactive</span>\n<span class=\"n\">setup_tactic_parser</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">mc_arg</span> <span class=\"o\">(</span><span class=\"n\">prec</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">parser</span> <span class=\"n\">pexpr</span> <span class=\"o\">:=</span>\n<span class=\"n\">parser.pexpr</span> <span class=\"n\">prec</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">decomp</span> <span class=\"o\">:</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">expr.app</span> <span class=\"n\">f</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">expr.app</span> <span class=\"n\">f0</span> <span class=\"n\">e0</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">expr.app</span> <span class=\"n\">f1</span> <span class=\"n\">e1</span><span class=\"o\">)</span> <span class=\"o\">:=</span> <span class=\"k\">do</span>\n  <span class=\"k\">match</span> <span class=\"n\">e.is_mvar</span> <span class=\"k\">with</span>\n  <span class=\"bp\">|</span> <span class=\"n\">ff</span> <span class=\"o\">:=</span> <span class=\"n\">decomp</span> <span class=\"n\">e</span> <span class=\"n\">e0</span> <span class=\"n\">e1</span>\n  <span class=\"bp\">|</span> <span class=\"n\">tt</span> <span class=\"o\">:=</span> <span class=\"k\">do</span> <span class=\"n\">el</span> <span class=\"bp\">←</span> <span class=\"n\">mk_app</span> <span class=\"bp\">`</span><span class=\"n\">eq</span> <span class=\"o\">[</span><span class=\"n\">e0</span><span class=\"o\">,</span> <span class=\"n\">e1</span><span class=\"o\">],</span>\n             <span class=\"n\">n</span> <span class=\"bp\">←</span> <span class=\"n\">get_unused_name</span> <span class=\"s2\">\"h\"</span><span class=\"o\">,</span>\n             <span class=\"n\">assert</span> <span class=\"n\">n</span> <span class=\"n\">el</span><span class=\"o\">,</span>\n             <span class=\"n\">rotate</span><span class=\"o\">,</span> <span class=\"c1\">-- instead of rotate, I would like to always work on the \"original\" goal</span>\n             <span class=\"n\">decomp</span> <span class=\"n\">f</span> <span class=\"n\">f0</span> <span class=\"n\">f1</span>\n             <span class=\"kd\">end</span>\n<span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">:=</span> <span class=\"n\">trace</span> <span class=\"s2\">\"nothing\"</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">dap</span> <span class=\"o\">(</span><span class=\"n\">arg</span> <span class=\"o\">:</span> <span class=\"n\">parse</span> <span class=\"o\">(</span><span class=\"n\">mc_arg</span> <span class=\"n\">tac_rbp</span><span class=\"o\">))</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span>\n<span class=\"k\">do</span> <span class=\"n\">ta</span> <span class=\"bp\">←</span> <span class=\"n\">to_expr</span> <span class=\"n\">arg</span> <span class=\"n\">tt</span> <span class=\"n\">ff</span><span class=\"o\">,</span>\n  <span class=\"n\">tgt</span> <span class=\"bp\">←</span> <span class=\"n\">target</span><span class=\"o\">,</span>\n  <span class=\"o\">(</span><span class=\"n\">lhs</span><span class=\"o\">,</span> <span class=\"n\">rhs</span><span class=\"o\">)</span> <span class=\"bp\">←</span> <span class=\"n\">match_eq</span> <span class=\"n\">tgt</span><span class=\"o\">,</span>\n  <span class=\"n\">decomp</span> <span class=\"n\">ta</span> <span class=\"n\">lhs</span> <span class=\"n\">rhs</span><span class=\"o\">,</span>\n  <span class=\"n\">try</span> <span class=\"n\">refl</span>\n\n<span class=\"kd\">end</span> <span class=\"n\">tactic.interactive</span>\n\n<span class=\"kd\">variables</span> <span class=\"o\">{</span><span class=\"n\">X</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">[</span><span class=\"n\">has_add</span> <span class=\"n\">X</span><span class=\"o\">]</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"n\">b</span> <span class=\"n\">c</span> <span class=\"n\">d</span> <span class=\"o\">:</span> <span class=\"n\">X</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">X</span> <span class=\"bp\">→</span> <span class=\"n\">X</span><span class=\"o\">)</span>\n\n\n<span class=\"c1\">-- desired syntax</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">f</span> <span class=\"n\">a</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">c</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"n\">rw</span> <span class=\"o\">[</span><span class=\"n\">h</span><span class=\"o\">,</span> <span class=\"n\">h_1</span><span class=\"o\">],</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n\n<span class=\"kd\">end</span>\n\n<span class=\"c1\">-- desired syntax</span>\n<span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282354746,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652537582
    },
    {
        "content": "<p>EDIT: The above code should work!</p>",
        "id": 282358723,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652543354
    },
    {
        "content": "<p>Ok, I think that I got it!</p>\n<p>It needs a lot of testing, but the code above works in the two given examples!</p>\n<p>Note that I have a weird permutation of the goal showing up.</p>",
        "id": 282359253,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544002
    },
    {
        "content": "<p>Btw, Heather, here:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congr'</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"bp\">...</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>did you mean</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">H''</span><span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">b</span>  <span class=\"bp\">&lt;</span><span class=\"c1\">--- removed `f`-application</span>\n</code></pre></div>\n<p>?</p>",
        "id": 282359444,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544136
    },
    {
        "content": "<p>(This is what Lean wants when I run the code above...)</p>",
        "id": 282359496,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544211
    },
    {
        "content": "<p>Maybe I stated my own desired syntax wrong, does it work with</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congr'</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"bp\">...</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282359571,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652544294
    },
    {
        "content": "<p>Yes, this works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282359654,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544370
    },
    {
        "content": "<p>(The permutation thing is still a little iffy.)</p>",
        "id": 282359671,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544391
    },
    {
        "content": "<p>Ok, having found a typo in the proposed syntax test is a good check!</p>",
        "id": 282359708,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544443
    },
    {
        "content": "<p>Obviously, this means that the tactic will <em>always</em> work... <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 282359725,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544465
    },
    {
        "content": "<p>It's very cool, congrats!  One thing that I don't immediately understand:  why does your code also work for functions with multiple inputs like <code>+</code>?</p>",
        "id": 282360108,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652544850
    },
    {
        "content": "<p>Because <code>expr.app</code> plays well with curry!</p>",
        "id": 282360159,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544912
    },
    {
        "content": "<p><code>+</code> is twice <code>expr.app</code>.</p>",
        "id": 282360180,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652544933
    },
    {
        "content": "<p>It has some test with unary and binary.  Should work with <code>n</code>-ary, but I really would want to test it before making a bold statement.</p>",
        "id": 282360248,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545001
    },
    {
        "content": "<p>And what about Eric's idea to allow for holes in the function names, too?  Does it work with </p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282360259,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652545016
    },
    {
        "content": "<p>Not sure about this, I'm skeptical for the code as is...</p>",
        "id": 282360286,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545064
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">placeholders</span> <span class=\"sc\">'_'</span> <span class=\"n\">cannot</span> <span class=\"n\">be</span> <span class=\"n\">used</span> <span class=\"n\">where</span> <span class=\"n\">a</span> <span class=\"n\">function</span> <span class=\"n\">is</span> <span class=\"n\">expected</span>\n</code></pre></div>\n<p>sadly...</p>",
        "id": 282360338,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545108
    },
    {
        "content": "<p>There is some room for getting the two \"different\" <code>_</code>, one where you want to create a goal and one where you want to unify since you know it works.</p>",
        "id": 282360371,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545157
    },
    {
        "content": "<p>I have not played with that, but it should be doable, especially if I learn better how the parser works to distinguish the two.</p>",
        "id": 282360383,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545183
    },
    {
        "content": "<p>Note that you can be sloppy with your pattern matching.  Giving a multiplication to <code>X</code>, this still works:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">_</span><span class=\"o\">)</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">_</span><span class=\"o\">),</span>  <span class=\"bp\">&lt;</span><span class=\"c1\">--- note the `+` instead of `*`!!</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282360487,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545281
    },
    {
        "content": "<p>The pattern that you provide, is really just a canvas.  Since you use function application, you mostly need the right arity and it might work.</p>",
        "id": 282360550,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545332
    },
    {
        "content": "<p>I'm going to do some non-Lean stuff now, but would love to hear more comments!</p>",
        "id": 282360596,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652545401
    },
    {
        "content": "<p>That's funny!  Initially I was actually thinking of suggesting an input syntax as some kind of spelled-out tree, like</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"n\">congr'</span> <span class=\"o\">(((</span><span class=\"n\">x</span><span class=\"o\">))(</span><span class=\"n\">xx</span><span class=\"o\">)))</span>\n</code></pre></div>\n<p>which technically speaking is providing less information to Lean, but which is also much less human-parseable.  I guess what you're saying is that your tactic would also work for that syntax.</p>",
        "id": 282360799,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1652545648
    },
    {
        "content": "<p>I think that it might.  When I'm back at a computer, I'll try with a unary and a binary function from a different type and will see how the matching goes!</p>",
        "id": 282361614,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652546649
    },
    {
        "content": "<p>I just tried it: this works.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">j₂</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">j₁</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">j₂</span> <span class=\"o\">(</span><span class=\"n\">j₁</span> <span class=\"o\">(</span><span class=\"n\">j₁</span> <span class=\"n\">_</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">j₂</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">A</span> <span class=\"o\">:</span> <span class=\"kt\">Type</span><span class=\"bp\">*</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">j₂</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">j₁</span> <span class=\"o\">:</span> <span class=\"n\">A</span> <span class=\"bp\">→</span> <span class=\"n\">A</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">w</span> <span class=\"o\">:</span> <span class=\"n\">A</span><span class=\"o\">)</span>\n  <span class=\"o\">(</span><span class=\"n\">H</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">a</span> <span class=\"bp\">=</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">H'</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">H''</span> <span class=\"o\">:</span> <span class=\"n\">true</span> <span class=\"bp\">→</span> <span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"n\">b</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">d</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">))</span> <span class=\"bp\">=</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">*</span> <span class=\"o\">(</span><span class=\"n\">f</span> <span class=\"n\">b</span> <span class=\"bp\">+</span> <span class=\"o\">(</span><span class=\"n\">c</span> <span class=\"bp\">+</span> <span class=\"n\">f</span> <span class=\"n\">d</span><span class=\"o\">))</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">dap</span> <span class=\"n\">j₂</span> <span class=\"o\">(</span><span class=\"n\">j₁</span> <span class=\"o\">(</span><span class=\"n\">j₁</span> <span class=\"n\">w</span><span class=\"o\">))</span> <span class=\"o\">(</span><span class=\"n\">j₂</span> <span class=\"n\">_</span> <span class=\"n\">_</span><span class=\"o\">),</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H''</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n  <span class=\"o\">{</span> <span class=\"n\">exact</span> <span class=\"n\">H'</span> <span class=\"n\">trivial</span> <span class=\"o\">},</span>\n<span class=\"kd\">end</span>\n</code></pre></div>",
        "id": 282368242,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652556296
    },
    {
        "content": "<p>In fact, I had initially placed some test that there was a compatibility between the pattern in the user-provided input and the one found in the lhs/rhs, but eventually decided against.</p>\n<p>Still, I am amazed at how well Lean understands this very hard to parse statement!</p>",
        "id": 282368298,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652556369
    },
    {
        "content": "<p>Looking back at the code above, I think that replacing <code>rotate_right 1</code> with <code>swap</code> will generate the side goals in reverse order, with respect to the \"obvious\" one.  However, I switched off the computer for the day and am not able to check it.</p>\n<p>If it is a desirable feature, I can try to produce code with \"natural ordering\" of the side-goals.</p>",
        "id": 282370102,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652559142
    },
    {
        "content": "<p>Also, currently the code only descends into function applications.  It will stop with everything else.  It is probably easy to make the matching extend much deeper into the expression, if needed.</p>",
        "id": 282370165,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652559243
    },
    {
        "content": "<p>Just to get some further comments:<br>\n<a href=\"https://github.com/leanprover-community/mathlib/pull/14153\">#14153</a></p>",
        "id": 282393778,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652597622
    },
    {
        "content": "<p>Btw, Gabriel, I am trying to get the <code>apply_eq_congr_core</code> to work, but with little success for now.  I am thinking of extracting the wanted goals and using <code>simp only [extracted equalities]</code> to simplify the initial goal, leaving side-goals to prove the extracted equalities.  Would this be suitable?</p>",
        "id": 282485156,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652702730
    },
    {
        "content": "<p><code>simp only [h]</code> could loop in some cases.</p>",
        "id": 282495207,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1652707971
    },
    {
        "content": "<p>I could do a <code>single_pass</code>...  Although, I feel that I am trying to avoid using the <code>apply_eq_congr_core</code>, mostly because I do not understand it and am unable to get it to work...</p>",
        "id": 282495393,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652708065
    },
    {
        "content": "<p>Another issue.  Say you have the pattern <code>f _ _</code> and the equation <code>f a (a + b) = f b b</code>.  First you rewrite with <code>a = b</code>, this turns the goal into <code>f b (b + b) = f b b</code>.  But now you can no longer rewrite with <code>a + b = b</code> (from the second underscore).</p>",
        "id": 282495477,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1652708114
    },
    {
        "content": "<p>Yes, this is what I was hoping to cure by letting <code>simp</code> do its magic...  <span aria-label=\"upside down\" class=\"emoji emoji-1f643\" role=\"img\" title=\"upside down\">:upside_down:</span></p>",
        "id": 282495553,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652708155
    },
    {
        "content": "<p>And also the reason for extracting all the goals upfront, so that they don't get messed up by the intermediate <code>rw</code>.</p>",
        "id": 282495633,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652708187
    },
    {
        "content": "<p>I will keep trying with <code>apply_eq_congr_core</code>: I agree that it feels more robust, but I do not understand it.</p>",
        "id": 282495678,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652708215
    },
    {
        "content": "<p>Yeah, the API is a bit tricky because you manually need to juggle the arguments and proof terms.  This should work though:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">private</span> <span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">extract_subgoals</span> <span class=\"o\">:</span> <span class=\"n\">list</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">list</span> <span class=\"n\">congr_arg_kind</span> <span class=\"bp\">→</span> <span class=\"n\">list</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span>\n  <span class=\"n\">tactic</span> <span class=\"o\">(</span><span class=\"n\">list</span> <span class=\"o\">(</span><span class=\"n\">expr</span> <span class=\"bp\">×</span> <span class=\"n\">expr</span><span class=\"o\">))</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">g</span> <span class=\"o\">::</span> <span class=\"n\">prf_args</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">congr_arg_kind.eq</span> <span class=\"o\">::</span> <span class=\"n\">kinds</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">pat</span> <span class=\"o\">::</span> <span class=\"n\">pat_args</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">rest</span><span class=\"o\">,</span> <span class=\"o\">(</span><span class=\"n\">g</span><span class=\"o\">,</span> <span class=\"n\">pat</span><span class=\"o\">)</span> <span class=\"o\">::</span> <span class=\"n\">rest</span><span class=\"o\">)</span> <span class=\"bp\">&lt;$&gt;</span> <span class=\"n\">extract_subgoals</span> <span class=\"n\">prf_args</span> <span class=\"n\">kinds</span> <span class=\"n\">pat_args</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">prf_args</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">congr_arg_kind.fixed</span> <span class=\"o\">::</span> <span class=\"n\">kinds</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">pat_args</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"n\">extract_subgoals</span> <span class=\"n\">prf_args</span> <span class=\"n\">kinds</span> <span class=\"n\">pat_args</span>\n<span class=\"bp\">|</span> <span class=\"n\">prf_args</span> <span class=\"o\">(</span><span class=\"n\">congr_arg_kind.fixed_no_param</span> <span class=\"o\">::</span> <span class=\"n\">kinds</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">pat_args</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"n\">extract_subgoals</span> <span class=\"n\">prf_args</span> <span class=\"n\">kinds</span> <span class=\"n\">pat_args</span>\n<span class=\"bp\">|</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">prf_args</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">congr_arg_kind.cast</span> <span class=\"o\">::</span> <span class=\"n\">kinds</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"o\">::</span> <span class=\"n\">pat_args</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n  <span class=\"n\">extract_subgoals</span> <span class=\"n\">prf_args</span> <span class=\"n\">kinds</span> <span class=\"n\">pat_args</span>\n<span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">[]</span> <span class=\"o\">:=</span> <span class=\"n\">pure</span> <span class=\"o\">[]</span>\n<span class=\"bp\">|</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"n\">_</span> <span class=\"o\">:=</span> <span class=\"n\">fail</span> <span class=\"s2\">\"unsupported congr lemma\"</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">equate_with_pattern_core</span> <span class=\"o\">:</span> <span class=\"n\">expr</span> <span class=\"bp\">→</span> <span class=\"n\">tactic</span> <span class=\"o\">(</span><span class=\"n\">list</span> <span class=\"n\">expr</span><span class=\"o\">)</span> <span class=\"bp\">|</span> <span class=\"n\">pat</span> <span class=\"o\">:=</span>\n<span class=\"o\">(</span><span class=\"n\">applyc</span> <span class=\"bp\">``</span><span class=\"n\">subsingleton.elim</span> <span class=\"bp\">&gt;&gt;</span> <span class=\"n\">pure</span> <span class=\"o\">[])</span> <span class=\"bp\">&lt;|&gt;</span>\n<span class=\"o\">(</span><span class=\"n\">applyc</span> <span class=\"bp\">``</span><span class=\"n\">rfl</span> <span class=\"bp\">&gt;&gt;</span> <span class=\"n\">pure</span> <span class=\"o\">[])</span> <span class=\"bp\">&lt;|&gt;</span>\n<span class=\"k\">if</span> <span class=\"n\">pat.is_mvar</span> <span class=\"bp\">||</span> <span class=\"n\">pat.get_delayed_abstraction_locals.is_some</span> <span class=\"k\">then</span>\n  <span class=\"n\">get_goals</span> <span class=\"bp\">&lt;*</span> <span class=\"n\">set_goals</span> <span class=\"o\">[]</span>\n<span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"n\">pat.is_app</span> <span class=\"bp\">&amp;&amp;</span> <span class=\"n\">pat.get_app_fn.is_constant</span> <span class=\"k\">then</span> <span class=\"k\">do</span>\n  <span class=\"n\">cl</span> <span class=\"bp\">←</span> <span class=\"n\">mk_specialized_congr_lemma</span> <span class=\"n\">pat</span><span class=\"o\">,</span>\n  <span class=\"o\">[</span><span class=\"n\">prf</span><span class=\"o\">]</span> <span class=\"bp\">←</span> <span class=\"n\">get_goals</span><span class=\"o\">,</span>\n  <span class=\"n\">tactic.apply</span> <span class=\"n\">cl.proof</span><span class=\"o\">,</span>\n  <span class=\"n\">prf</span> <span class=\"bp\">←</span> <span class=\"n\">instantiate_mvars</span> <span class=\"n\">prf</span><span class=\"o\">,</span>\n  <span class=\"n\">set_goals</span> <span class=\"o\">[],</span>\n  <span class=\"n\">subgoals</span> <span class=\"bp\">←</span> <span class=\"n\">extract_subgoals</span> <span class=\"n\">prf.get_app_args</span> <span class=\"n\">cl.arg_kinds</span> <span class=\"n\">pat.get_app_args</span><span class=\"o\">,</span>\n  <span class=\"n\">subgoals</span> <span class=\"bp\">←</span> <span class=\"n\">subgoals.mmap</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"o\">⟨</span><span class=\"n\">subgoal</span><span class=\"o\">,</span> <span class=\"n\">subpat</span><span class=\"o\">⟩,</span> <span class=\"k\">do</span>\n    <span class=\"n\">set_goals</span> <span class=\"o\">[</span><span class=\"n\">subgoal</span><span class=\"o\">],</span>\n    <span class=\"n\">equate_with_pattern_core</span> <span class=\"n\">subpat</span><span class=\"o\">),</span>\n  <span class=\"n\">pure</span> <span class=\"n\">subgoals.join</span>\n<span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"n\">pat.is_lambda</span> <span class=\"k\">then</span> <span class=\"k\">do</span>\n  <span class=\"n\">applyc</span> <span class=\"bp\">``</span><span class=\"n\">_root_.funext</span><span class=\"o\">,</span>\n  <span class=\"n\">x</span> <span class=\"bp\">←</span> <span class=\"n\">tactic.intro</span> <span class=\"n\">pat.binding_name</span><span class=\"o\">,</span>\n  <span class=\"n\">equate_with_pattern_core</span> <span class=\"bp\">$</span> <span class=\"n\">pat.lambda_body.instantiate_var</span> <span class=\"n\">x</span>\n<span class=\"k\">else</span> <span class=\"k\">do</span>\n  <span class=\"n\">pat</span> <span class=\"bp\">←</span> <span class=\"n\">pp</span> <span class=\"n\">pat</span><span class=\"o\">,</span>\n  <span class=\"n\">fail</span> <span class=\"bp\">$</span> <span class=\"n\">to_fmt</span> <span class=\"s2\">\"unsupported pattern:</span><span class=\"se\">\\n</span><span class=\"s2\">\"</span> <span class=\"bp\">++</span> <span class=\"n\">pat</span>\n\n<span class=\"kd\">meta</span> <span class=\"kd\">def</span> <span class=\"n\">equate_with_pattern</span> <span class=\"o\">(</span><span class=\"n\">pat</span> <span class=\"o\">:</span> <span class=\"n\">expr</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"n\">tactic</span> <span class=\"n\">unit</span> <span class=\"o\">:=</span> <span class=\"k\">do</span>\n<span class=\"n\">congr_subgoals</span> <span class=\"bp\">←</span> <span class=\"n\">tactic.solve1</span> <span class=\"o\">(</span><span class=\"n\">equate_with_pattern_core</span> <span class=\"n\">pat</span><span class=\"o\">),</span>\n<span class=\"n\">gs</span> <span class=\"bp\">←</span> <span class=\"n\">get_goals</span><span class=\"o\">,</span>\n<span class=\"n\">set_goals</span> <span class=\"bp\">$</span> <span class=\"n\">congr_subgoals</span> <span class=\"bp\">++</span> <span class=\"n\">gs</span>\n</code></pre></div>",
        "id": 282517618,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1652717196
    },
    {
        "content": "<p>Gabriel, thank you so much for the code!  I will try to understand this a little and will PR it with some tests, adding you as a coauthor, if that is ok with you.  Or feel free to push to the branch directly, if you prefer.  <span aria-label=\"namaste\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"namaste\">:namaste:</span></p>",
        "id": 282554833,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1652732363
    },
    {
        "content": "<p>Great! I've added some tests and docstrings.</p>",
        "id": 282633522,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1652791380
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic.congrm</span>\n\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"n\">g</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"n\">ℕ</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">h</span> <span class=\"o\">:</span> <span class=\"n\">f</span> <span class=\"bp\">=</span> <span class=\"n\">g</span><span class=\"o\">)</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"bp\">=</span> <span class=\"o\">(</span><span class=\"bp\">λ</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">g</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">begin</span>\n  <span class=\"n\">congrm</span> <span class=\"bp\">λ</span> <span class=\"n\">i</span> <span class=\"n\">j</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">,</span>\n  <span class=\"gr\">sorry</span><span class=\"o\">,</span>\n<span class=\"kd\">end</span>\n</code></pre></div>\n<p>Is it possible to support multiple arguments in lambda expressions?</p>",
        "id": 286209450,
        "sender_full_name": "FR",
        "timestamp": 1655298742
    },
    {
        "content": "<p>Oh, it returns <code>(λ j, f i j) = λ j, g i j</code>.  That's a bug.</p>",
        "id": 286210201,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1655299124
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib/pull/14753\">#14753</a></p>",
        "id": 286211100,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1655299534
    },
    {
        "content": "<p>Dear All,</p>\n<p><a href=\"https://github.com/leanprover-community/mathlib/pull/14532\">#14532</a> introduces \"function underscores\" for use with <code>congrm</code>.  This is to implement one of Heather's suggestions further up in this thread (I'm on mobile and cannot post the exact link).</p>\n<p>The PR introduces notation <code>_ᵢ</code> for an unspecified function with arity <code>i</code>.  Does anyone have any opinion on the matter?</p>\n<p>Thanks!</p>",
        "id": 287380605,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656102234
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"321459\">@Damiano Testa</span> I noticed that the parsing for <code>congrm</code> seems to interpret the <code>;</code> as part of the expression, at least in the following example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic.congrm</span>\n<span class=\"kn\">import</span> <span class=\"n\">tactic.norm_num</span>\n\n<span class=\"c1\">-- fails with `unknown identifier 'norm_num'`</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">8</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">))</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">7</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span><span class=\"bp\">;</span> <span class=\"n\">norm_num</span>\n\n<span class=\"c1\">-- works</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">8</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">))</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">7</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">))</span><span class=\"bp\">;</span> <span class=\"n\">norm_num</span>\n</code></pre></div>\n<p>Is there any way to prevent this behaviour?</p>",
        "id": 287465291,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1656207066
    },
    {
        "content": "<p>Heather, thanks for reporting this!  I will take a look and will try to fix it.  It probably has to do with changing the binding power of some parsed argument.  I hope to have time either today or tomorrow to look at this.</p>",
        "id": 287535005,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656308273
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"260507\">@Heather Macbeth</span> , I have investigated this a bit and I do not know how to fix it.  I think that I have minimized further your example:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic.congrm</span>\n\n<span class=\"c1\">--  unknown identifier 'assumption'</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">pr</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">↔</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">qs</span> <span class=\"o\">:</span> <span class=\"n\">q</span> <span class=\"bp\">↔</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span> <span class=\"bp\">↔</span> <span class=\"n\">r</span> <span class=\"bp\">∧</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"n\">_</span> <span class=\"bp\">∧</span> <span class=\"n\">_</span><span class=\"bp\">;</span> <span class=\"n\">assumption</span>\n\n<span class=\"c1\">--  works</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">p</span> <span class=\"n\">q</span> <span class=\"n\">r</span> <span class=\"n\">s</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">(</span><span class=\"n\">pr</span> <span class=\"o\">:</span> <span class=\"n\">p</span> <span class=\"bp\">↔</span> <span class=\"n\">r</span><span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"n\">qs</span> <span class=\"o\">:</span> <span class=\"n\">q</span> <span class=\"bp\">↔</span> <span class=\"n\">s</span><span class=\"o\">)</span> <span class=\"o\">:</span>\n  <span class=\"n\">p</span> <span class=\"bp\">∧</span> <span class=\"n\">q</span> <span class=\"bp\">↔</span> <span class=\"n\">r</span> <span class=\"bp\">∧</span> <span class=\"n\">s</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">∧</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">;</span> <span class=\"n\">assumption</span>\n</code></pre></div>\n<p>If I had to guess, I think that the priority of <code>∧</code> (as well as <code>∨</code>) interacts badly with the \"right-binding strength\" of the argument to <code>congrm</code>.  Still, I do not know how to fix this.</p>\n<p>Maybe <span class=\"user-mention\" data-user-id=\"110043\">@Gabriel Ebner</span> can help?</p>",
        "id": 288030170,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656596968
    },
    {
        "content": "<p>In fact, I am unable to find where the notation for <a href=\"https://leanprover-community.github.io/mathlib_docs/find/and\">docs#and</a> is defined.</p>",
        "id": 288034315,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656598593
    },
    {
        "content": "<p>Thanks Damiano, this already taught me something!</p>",
        "id": 288034423,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1656598647
    },
    {
        "content": "<p>Glad to hear!</p>\n<p>Although, I would like to get to the bottom of this: after all, the argument to <code>congrm</code> is already a <code>parse texpr</code> which is supposed to terminate with <code>;</code>.  See the docstring to <a href=\"https://leanprover-community.github.io/mathlib_docs/find/interactive.types.texpr\">docs#interactive.types.texpr</a>.  I'm not sure why it does not work.</p>",
        "id": 288035317,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656598977
    },
    {
        "content": "<p><a href=\"https://github.com/leanprover-community/mathlib/pull/15074\">#15074</a> is a <em>partial</em> fix to this issue: the minimized version that I have above is resolved, but Heather's first bug stays.</p>\n<p>Any help is appreciated!  <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 288045338,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656602859
    },
    {
        "content": "<p>Actually, here is something that I had not realized:</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic.congrm</span>\n\n<span class=\"c1\">-- works</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">f</span> <span class=\"o\">:</span> <span class=\"n\">ℕ</span> <span class=\"bp\">→</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">3</span> <span class=\"bp\">+</span> <span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">8</span> <span class=\"bp\">+</span> <span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">))</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">1</span> <span class=\"bp\">+</span> <span class=\"mi\">4</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"mi\">2</span> <span class=\"bp\">+</span> <span class=\"mi\">7</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span> <span class=\"bp\">∨</span> <span class=\"n\">f</span> <span class=\"o\">(</span><span class=\"n\">_</span> <span class=\"bp\">+</span> <span class=\"n\">k</span><span class=\"o\">)</span>\n</code></pre></div>\n<p>Note: no parentheses and side-goals solved by <code>reflexivity</code>.  I do not know why the <code>; norm_num</code> could not be tagged along, but this already \"works\".</p>",
        "id": 288046834,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656603482
    },
    {
        "content": "<p>I guess because equalities between natural numbers are true by definition, if very slowly.  I should have come up with a test case where you truly did need the tactic, sorry!</p>",
        "id": 288047363,
        "sender_full_name": "Heather Macbeth",
        "timestamp": 1656603715
    },
    {
        "content": "<p>I still think that it is interesting that with the parentheses it <em>does</em> work, while without it does not.</p>",
        "id": 288047497,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656603756
    },
    {
        "content": "<p>Notice that <code>congrm</code> attempts <code>rfl</code>, so I think that it should be <code>congrm</code> closing those <code>nat</code> goals, not <code>norm_num</code> in both cases.  The <code>;</code> should simply be informing Lean to apply the following tactic to all, non-existent, remaining goals.</p>\n<p>I do not know why it fails in one case and succeeds in the other.</p>",
        "id": 288047867,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656603910
    },
    {
        "content": "<p>It seems that <code>and</code> does not have much to do with this issue.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">tactic.congrm</span>\n\n<span class=\"c1\">--  works</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"o\">)</span><span class=\"bp\">;</span> <span class=\"n\">refl</span>\n\n<span class=\"c1\">--  fails</span>\n<span class=\"kd\">example</span> <span class=\"o\">{</span><span class=\"n\">a</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">}</span> <span class=\"o\">:</span>\n  <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">,</span> <span class=\"n\">a</span><span class=\"o\">)</span> <span class=\"bp\">↔</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span> <span class=\"o\">:</span> <span class=\"kt\">Prop</span><span class=\"o\">,</span> <span class=\"n\">a</span> <span class=\"o\">:=</span>\n<span class=\"kd\">by</span> <span class=\"n\">congrm</span> <span class=\"bp\">∃</span> <span class=\"n\">k</span><span class=\"o\">,</span> <span class=\"n\">_</span><span class=\"bp\">;</span> <span class=\"n\">refl</span>\n<span class=\"c\">/-</span><span class=\"cm\"></span>\n<span class=\"cm\">type mismatch at application</span>\n<span class=\"cm\">  ?m_4; refl</span>\n<span class=\"cm\">term</span>\n<span class=\"cm\">  refl</span>\n<span class=\"cm\">has type</span>\n<span class=\"cm\">  ∀ (a : ?m_1), ?m_2 a a : Prop</span>\n<span class=\"cm\">but is expected to have type</span>\n<span class=\"cm\">  ?m_1 : Type ?</span>\n<span class=\"cm\">-/</span>\n</code></pre></div>",
        "id": 288052964,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656606205
    },
    {
        "content": "<p>Both of the examples for ∧ work for me.  But the ∃ requires parentheses even with other tactics like <code>have</code> so I don't think we can do much there.</p>\n<div class=\"codehilite\" data-code-language=\"Lean\"><pre><span></span><code><span class=\"kn\">import</span> <span class=\"n\">logic.basic</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"bp\">∃</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">true</span><span class=\"bp\">;</span> <span class=\"n\">simp</span> <span class=\"c1\">-- unknown identifier 'simp'</span>\n<span class=\"kd\">example</span> <span class=\"o\">:</span> <span class=\"mi\">1</span> <span class=\"bp\">=</span> <span class=\"mi\">1</span> <span class=\"o\">:=</span> <span class=\"kd\">by</span> <span class=\"k\">have</span> <span class=\"o\">:</span> <span class=\"o\">(</span><span class=\"bp\">∃</span> <span class=\"n\">x</span> <span class=\"o\">:</span> <span class=\"n\">nat</span><span class=\"o\">,</span> <span class=\"n\">true</span><span class=\"o\">)</span><span class=\"bp\">;</span> <span class=\"n\">simp</span>\n</code></pre></div>",
        "id": 288054776,
        "sender_full_name": "Gabriel Ebner",
        "timestamp": 1656607055
    },
    {
        "content": "<p>Gabriel, thanks for the confirmation!</p>\n<p>I am not sure where I got the issue with <code>∧</code>, maybe some weird problem with old oleans.  They do work now.  I will close the PR then, since this is not really an issue with <code>congrm</code>, then!</p>",
        "id": 288055274,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656607282
    },
    {
        "content": "<p>The ∃ issue might have to do with the fact that <code>,</code> is allowed \"inside\" the ∃ syntax, and then it might get tricky to allow <code>;</code> but not <code>,</code>.</p>\n<p>Anyway, I'm satisfied with the current state!</p>",
        "id": 288056075,
        "sender_full_name": "Damiano Testa",
        "timestamp": 1656607635
    }
]